
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
      
      
      
        <link rel="canonical" href="https://yfy.cqu.ai/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/">
      
      
        <link rel="prev" href="../../../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/">
      
      
        <link rel="next" href="../2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>linux 相关-系统运维 - Rain 的随笔</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#disk-and-filesystem" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Rain 的随笔" class="md-header__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rain 的随笔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              linux 相关-系统运维
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../series/" class="md-tabs__link">
        
  
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tools/" class="md-tabs__link">
        
  
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../archive/2024/" class="md-tabs__link">
          
  
  
  归档

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-tabs__link">
          
  
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Rain 的随笔" class="md-nav__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rain 的随笔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    系列
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    工具
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    个人
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客 &amp; 网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    学习笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    折腾记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    软件工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    阅读
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2022-11-06 18:14:50+00:00" class="md-ellipsis">2022年11月6日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../../category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 27 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linux-分区" class="md-nav__link">
    <span class="md-ellipsis">
      linux 分区
    </span>
  </a>
  
    <nav class="md-nav" aria-label="linux 分区">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fdiskmkfsmount" class="md-nav__link">
    <span class="md-ellipsis">
      fdisk+mkfs+mount
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#swap" class="md-nav__link">
    <span class="md-ellipsis">
      swap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mount" class="md-nav__link">
    <span class="md-ellipsis">
      mount
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#扩展分区-expand-partition" class="md-nav__link">
    <span class="md-ellipsis">
      扩展分区 expand partition
    </span>
  </a>
  
    <nav class="md-nav" aria-label="扩展分区 expand partition">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-or-resource-busy-怎么办" class="md-nav__link">
    <span class="md-ellipsis">
      Device or resource busy 怎么办
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mkswap" class="md-nav__link">
    <span class="md-ellipsis">
      mkswap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-挂载" class="md-nav__link">
    <span class="md-ellipsis">
      linux 挂载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="linux 挂载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#losetup" class="md-nav__link">
    <span class="md-ellipsis">
      losetup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#磁盘镜像" class="md-nav__link">
    <span class="md-ellipsis">
      磁盘镜像
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#测试磁盘速度" class="md-nav__link">
    <span class="md-ellipsis">
      测试磁盘速度
    </span>
  </a>
  
    <nav class="md-nav" aria-label="测试磁盘速度">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dd" class="md-nav__link">
    <span class="md-ellipsis">
      dd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fio" class="md-nav__link">
    <span class="md-ellipsis">
      fio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#机械硬盘例子" class="md-nav__link">
    <span class="md-ellipsis">
      机械硬盘例子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#例子" class="md-nav__link">
    <span class="md-ellipsis">
      例子
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../../tags/#tag:ca" class="md-tag">CA</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:apt" class="md-tag">apt</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:dig" class="md-tag">dig</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:fdisk" class="md-tag">fdisk</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:fio" class="md-tag">fio</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:iwd" class="md-tag">iwd</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:journalctl" class="md-tag">journalctl</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:ldap" class="md-tag">ldap</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:mount" class="md-tag">mount</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:nmcli" class="md-tag">nmcli</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:v4l2" class="md-tag">v4l2</a>
      
    
  </nav>



<p>大纲</p>
<ul>
<li>how linux kernel boot<ul>
<li>kernel parameters</li>
<li>grub</li>
</ul>
</li>
<li>how user space start<ul>
<li>init, systemd</li>
<li>initial RAM filesystem</li>
</ul>
</li>
<li>Shell</li>
<li>Disk and filesystem<ul>
<li>partitioning disk</li>
<li>mount </li>
</ul>
</li>
<li>User identification, authentification, authorization<ul>
<li>identi</li>
<li>user, group 定义</li>
<li>PAM</li>
</ul>
</li>
<li>System configuration<ul>
<li>Logging</li>
<li>Batch jobs</li>
</ul>
</li>
</ul>
<!-- more -->

<h1 id="disk-and-filesystem">Disk and Filesystem<a class="headerlink" href="#disk-and-filesystem" title="Permanent link">&para;</a></h1>
<h2 id="linux-分区">linux 分区<a class="headerlink" href="#linux-分区" title="Permanent link">&para;</a></h2>
<h3 id="fdiskmkfsmount">fdisk+mkfs+mount<a class="headerlink" href="#fdiskmkfsmount" title="Permanent link">&para;</a></h3>
<p><strong>使用 fdisk 给磁盘分区并挂载</strong></p>
<p>列出磁盘信息</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo fdisk -l [device]
</span></code></pre></div>
<p>进入交互模式</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo fdisk [device]
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>m #帮助
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>p #打印当前分区表
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>g #创建gpt分区表
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>n #创建分区
</span></code></pre></div>
<p>fdisk 创建分区后</p>
<ul>
<li>通过<code>mkfs.ext4 /dev/sdb1</code>创建文件 ext4 系统（<em>p.s. 注意：不要使用 sdb，而是 sdb1 指定分区</em>）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>mkfs.bfs     mkfs.cramfs  mkfs.ext2    mkfs.ext3    mkfs.ext4    mkfs.fat     mkfs.minix   mkfs.msdos   mkfs.ntfs    mkfs.vfat
</span></code></pre></div>
<ul>
<li>通过<code>lsblk -f</code>显示 UUID<ul>
<li><code>-f</code>表示打印文件系统</li>
</ul>
</li>
<li>
<p>在<code>/etc/fstab</code>中添加挂载条目，然后<code>mount -a</code>表示挂载 fstab 中的所有条目
  示例</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>UUID=b7ee63d0-6cea-4615-b7ec-63449c8fa566 /mnt/Disk1    ext4    defaults 0 0
</span></code></pre></div>
</li>
</ul>
<ul>
<li>修改挂载点目录权限，默认只有 root 用户可以访问</li>
</ul>
<h3 id="swap">swap<a class="headerlink" href="#swap" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo dd if=/dev/zero of=/swapfile bs=1G count=16
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo mkswap swapfile
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>sudo swapon swapfile
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>#fstab 
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>/swapfile none swap sw 0 0
</span></code></pre></div>
<h3 id="mount">mount<a class="headerlink" href="#mount" title="Permanent link">&para;</a></h3>
<p><a href="https://help.ubuntu.com/community/Fstab">Fstab - Community Help Wiki (ubuntu.com)</a></p>
<p>mount 只能由 root 用户操作，导致 mount 的目录所有者为 root，普通用户无法访问</p>
<p>ext4 mount 选项中也没有指定 uid 的方式挂载（不像smb挂载时）<a href="https://man7.org/linux/man-pages/man5/ext4.5.html#Mount_options_for_ext4">ext4(5) - Linux manual page (man7.org)</a></p>
<p>其实上面根本不是问题，解决办法是：mount 之后使用 chown 命令将挂载的目录改为普通用户。<strong>由于用户信息是写入文件系统的</strong>，所以之后挂载时文件权限仍然是普通用户。</p>
<h3 id="扩展分区-expand-partition">扩展分区 expand partition<a class="headerlink" href="#扩展分区-expand-partition" title="Permanent link">&para;</a></h3>
<p>ext4可以在线扩展分区（注意shrink是不行的）</p>
<p>方法列举：</p>
<ul>
<li>使用gparted（简单，但是遇到device busy的情况也束手无策，不如命令行时知道问题出在哪）</li>
<li>fdisk：需要先删除分区（注意不要删除文件系统signature），然后重新创建，保证起始sector相同。</li>
<li>parted：有resize命令，扩展分区时更容易。但是由于每步操作都会立即执行，没有fdisk那样有安全感，最好还是不使用。</li>
<li>resize2fs：默认是扩展所有空间。</li>
</ul>
<p>fdisk</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>yfy@u22-game:~$<span class="w"> </span>df<span class="w"> </span>-h
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Filesystem<span class="w">      </span>Size<span class="w">  </span>Used<span class="w"> </span>Avail<span class="w"> </span>Use%<span class="w"> </span>Mounted<span class="w"> </span>on
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>/dev/sda3<span class="w">        </span>98G<span class="w">   </span>17G<span class="w">   </span>76G<span class="w">  </span><span class="m">19</span>%<span class="w"> </span>/
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>/dev/sda2<span class="w">       </span>512M<span class="w">  </span><span class="m">6</span>.1M<span class="w">  </span>506M<span class="w">   </span><span class="m">2</span>%<span class="w"> </span>/boot/efi
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>root@u22-game:/home/yfy#<span class="w"> </span>fdisk<span class="w"> </span>/dev/sda
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>p
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>Disk<span class="w"> </span>/dev/sda:<span class="w"> </span><span class="m">120</span><span class="w"> </span>GiB,<span class="w"> </span><span class="m">128849018880</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">251658240</span><span class="w"> </span>sectors
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>Disk<span class="w"> </span>model:<span class="w"> </span>QEMU<span class="w"> </span>HARDDISK
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>Units:<span class="w"> </span>sectors<span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span><span class="nv">512</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>Sector<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>logical/physical<span class="o">)</span>:<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes<span class="w"> </span>/<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>I/O<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>minimum/optimal<span class="o">)</span>:<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes<span class="w"> </span>/<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>Disklabel<span class="w"> </span>type:<span class="w"> </span>gpt
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>Disk<span class="w"> </span>identifier:<span class="w"> </span>43AAA442-6CCE-4AC2-9389-0EE427839D73
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>Device<span class="w">       </span>Start<span class="w">       </span>End<span class="w">   </span>Sectors<span class="w">  </span>Size<span class="w"> </span>Type
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>/dev/sda1<span class="w">     </span><span class="m">2048</span><span class="w">      </span><span class="m">4095</span><span class="w">      </span><span class="m">2048</span><span class="w">    </span>1M<span class="w"> </span>BIOS<span class="w"> </span>boot
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>/dev/sda2<span class="w">     </span><span class="m">4096</span><span class="w">   </span><span class="m">1054719</span><span class="w">   </span><span class="m">1050624</span><span class="w">  </span>513M<span class="w"> </span>EFI<span class="w"> </span>System
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>/dev/sda3<span class="w">  </span><span class="m">1054720</span><span class="w"> </span><span class="m">209713151</span><span class="w"> </span><span class="m">208658432</span><span class="w"> </span><span class="m">99</span>.5G<span class="w"> </span>Linux<span class="w"> </span>filesystem
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>F
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>Unpartitioned<span class="w"> </span>space<span class="w"> </span>/dev/sda:<span class="w"> </span><span class="m">20</span><span class="w"> </span>GiB,<span class="w"> </span><span class="m">21475868160</span><span class="w"> </span>bytes,<span class="w"> </span><span class="m">41945055</span><span class="w"> </span>sectors
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>Units:<span class="w"> </span>sectors<span class="w"> </span>of<span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span><span class="nv">512</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>Sector<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>logical/physical<span class="o">)</span>:<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes<span class="w"> </span>/<span class="w"> </span><span class="m">512</span><span class="w"> </span>bytes
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">    </span>Start<span class="w">       </span>End<span class="w">  </span>Sectors<span class="w"> </span>Size
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="m">209713152</span><span class="w"> </span><span class="m">251658206</span><span class="w"> </span><span class="m">41945055</span><span class="w">  </span>20G
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>d
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">1</span>-3,<span class="w"> </span>default<span class="w"> </span><span class="m">3</span><span class="o">)</span>:
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>Partition<span class="w"> </span><span class="m">3</span><span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>deleted.
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>n
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>Partition<span class="w"> </span>number<span class="w"> </span><span class="o">(</span><span class="m">3</span>-128,<span class="w"> </span>default<span class="w"> </span><span class="m">3</span><span class="o">)</span>:
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>First<span class="w"> </span>sector<span class="w"> </span><span class="o">(</span><span class="m">1054720</span>-251658206,<span class="w"> </span>default<span class="w"> </span><span class="m">1054720</span><span class="o">)</span>:
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>Last<span class="w"> </span>sector,<span class="w"> </span>+/-sectors<span class="w"> </span>or<span class="w"> </span>+/-size<span class="o">{</span>K,M,G,T,P<span class="o">}</span><span class="w"> </span><span class="o">(</span><span class="m">1054720</span>-251658206,<span class="w"> </span>default<span class="w"> </span><span class="m">251658206</span><span class="o">)</span>:<span class="w"> </span>+110G
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>Created<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>partition<span class="w"> </span><span class="m">3</span><span class="w"> </span>of<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s1">&#39;Linux filesystem&#39;</span><span class="w"> </span>and<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">110</span><span class="w"> </span>GiB.
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>Partition<span class="w"> </span><span class="c1">#3 contains a ext4 signature.</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>Do<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>remove<span class="w"> </span>the<span class="w"> </span>signature?<span class="w"> </span><span class="o">[</span>Y<span class="o">]</span>es/<span class="o">[</span>N<span class="o">]</span>o:<span class="w"> </span>N
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>Command<span class="w"> </span><span class="o">(</span>m<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span><span class="o">)</span>:<span class="w"> </span>w
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>The<span class="w"> </span>partition<span class="w"> </span>table<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>altered.
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>Syncing<span class="w"> </span>disks.
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>root@u22-game:~#<span class="w"> </span>df<span class="w"> </span>-h
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Filesystem<span class="w">      </span>Size<span class="w">  </span>Used<span class="w"> </span>Avail<span class="w"> </span>Use%<span class="w"> </span>Mounted<span class="w"> </span>on
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>/dev/sda3<span class="w">        </span>98G<span class="w">   </span>17G<span class="w">   </span>76G<span class="w">  </span><span class="m">19</span>%<span class="w"> </span>/
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>root@u22-game:~#<span class="w"> </span>resize2fs<span class="w"> </span>/dev/sda3
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>resize2fs<span class="w"> </span><span class="m">1</span>.46.5<span class="w"> </span><span class="o">(</span><span class="m">30</span>-Dec-2021<span class="o">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>Filesystem<span class="w"> </span>at<span class="w"> </span>/dev/sda3<span class="w"> </span>is<span class="w"> </span>mounted<span class="w"> </span>on<span class="w"> </span>/<span class="p">;</span><span class="w"> </span>on-line<span class="w"> </span>resizing<span class="w"> </span>required
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="nv">old_desc_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">13</span>,<span class="w"> </span><span class="nv">new_desc_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>The<span class="w"> </span>filesystem<span class="w"> </span>on<span class="w"> </span>/dev/sda3<span class="w"> </span>is<span class="w"> </span>now<span class="w"> </span><span class="m">28835840</span><span class="w"> </span><span class="o">(</span>4k<span class="o">)</span><span class="w"> </span>blocks<span class="w"> </span>long.
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>root@u22-game:~#<span class="w"> </span>df<span class="w"> </span>-h
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>Filesystem<span class="w">      </span>Size<span class="w">  </span>Used<span class="w"> </span>Avail<span class="w"> </span>Use%<span class="w"> </span>Mounted<span class="w"> </span>on
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>/dev/sda3<span class="w">       </span>108G<span class="w">   </span>17G<span class="w">   </span>86G<span class="w">  </span><span class="m">17</span>%<span class="w"> </span>/
</span></code></pre></div>
<p>parted
<a href="https://www.cloudservices.store/cp/knowledgebase/78/How-to-extend-an-EXT4-partition-using-parted-and-resize2fs.html">How to extend an EXT4 partition using parted and resize2fs - Knowledgebase - Cloud Services Store Limited</a>
resize2fs: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/storage_administration_guide/ext4grow">6.3. Resizing an Ext4 File System Red Hat Enterprise Linux 6 | Red Hat Customer Portal</a></p>
<p>千万注意 start sector 需要保持一样。fdisk 有时侯默认并不会保持不变。</p>
<h4 id="device-or-resource-busy-怎么办">Device or resource busy 怎么办<a class="headerlink" href="#device-or-resource-busy-怎么办" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>Command (m for help): w
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>The partition table has been altered.
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Failed to remove partition 3 from system: Device or resource busy
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>Failed to remove partition 4 from system: Device or resource busy
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Failed to update system information about partition 2: Device or resource busy
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>Failed to add partition 3 to system: Device or resource busy
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>The kernel still uses the old partitions. The new table will be used at the next reboot.
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>Syncing disks.
</span></code></pre></div>
<p>我重启后发现，分区已经更新了。resize2fs 即可</p>
<h4 id="mkswap">mkswap<a class="headerlink" href="#mkswap" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>mkswap /dev/sdaX
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>swapon /dev/sdaX
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>swapon --show
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>UUID=xxx none swap sw 0 0
</span></code></pre></div>
<h2 id="linux-挂载">linux 挂载<a class="headerlink" href="#linux-挂载" title="Permanent link">&para;</a></h2>
<h3 id="losetup">losetup<a class="headerlink" href="#losetup" title="Permanent link">&para;</a></h3>
<p>losetup is used to associate <strong>loop devices</strong> with <strong>regular files or block devices</strong>, to detach loop devices, and to query the status of a loop device.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>losetup   # 打印所有挂载的loopback设备
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>losetup -f --show default.img   # 找到第一个未使用的loop设备，并打印，然后挂载default.img
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>losetup -d loopdev      # detach指定loop设备
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>-r, --read-only   # 只读挂载
</span></code></pre></div>
<h3 id="磁盘镜像">磁盘镜像<a class="headerlink" href="#磁盘镜像" title="Permanent link">&para;</a></h3>
<p>用于挂载包含分区表的磁盘镜像</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>sudo kpartx -av 20240702_NanoKVM_Rev1_1_0.img  # 创建 /dev/mapper/loopXpY
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>sudo kpartx -dv 20240702_NanoKVM_Rev1_1_0.img
</span></code></pre></div>
<h2 id="测试磁盘速度">测试磁盘速度<a class="headerlink" href="#测试磁盘速度" title="Permanent link">&para;</a></h2>
<h3 id="dd">dd<a class="headerlink" href="#dd" title="Permanent link">&para;</a></h3>
<p>使用 dd 简单测试速度。可以区分 usb 2.0 和 3.0；可以见识 PCIe 4.0 ssd 的速度。但是要进行更准确的测速，最好使用 fio。</p>
<p>注意需要开启 direct，否则需要从 userspace 复制到 kernel buffer，严重影响速度。block size 对速度影响很大。 <a href="https://stackoverflow.com/questions/33485108/why-is-dd-with-the-direct-o-direct-flag-so-dramatically-faster">Why is dd with the 'direct' (O_DIRECT) flag so dramatically faster?</a></p>
<ul>
<li>bs 影响很大</li>
<li>/dev/null不需要使用oflag=direct</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>root@n5105-pve ➜  dd of=/dev/null if=/mnt/wd-passport/fio.img bs=1M count=2000
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>2000+0 records in
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>2000+0 records out
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>2097152000 bytes (2.1 GB, 2.0 GiB) copied, 21.2453 s, 98.7 MB/s
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>root@n5105-pve ➜  dd if=/dev/zero of=/mnt/wd-passport/fio.img bs=1M count=2000
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>2000+0 records in
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>2000+0 records out
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>2097152000 bytes (2.1 GB, 2.0 GiB) copied, 21.7685 s, 96.3 MB/s
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>root@n5105-pve ➜  dd if=/dev/zero of=/mnt/wd-passport/fio.img bs=1M count=2000 oflag=direct
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>2000+0 records in
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>2000+0 records out
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>2097152000 bytes (2.1 GB, 2.0 GiB) copied, 20.9127 s, 100 MB/s
</span></code></pre></div>
<h3 id="fio">fio<a class="headerlink" href="#fio" title="Permanent link">&para;</a></h3>
<blockquote>
<p>To benchmark <a href="https://cloud.google.com/compute/docs/disks/performance">persistent disk performance</a>, use <a href="https://fio.readthedocs.io/">Flexible I/O tester (FIO)</a> instead of other disk benchmarking tools such as <a href="https://en.wikipedia.org/wiki/Dd_(Unix)"><code>dd</code></a>. By default, <strong><code>dd</code> uses a very low I/O queue depth</strong>, so it is difficult to ensure that the benchmark is generating a sufficient number of I/Os and bytes to accurately test disk performance.</p>
</blockquote>
<ul>
<li>I/O type<ul>
<li>direct, buffered, atomic. : O_DIRECT, O_ATOMIC</li>
<li>readwrite=str, rw=str<ul>
<li>read: Sequential reads.</li>
<li>write: Sequential writes.</li>
<li>randread: Random reads.</li>
<li>randwrite: Random writes.</li>
<li>rw,readwrite: Sequential mixed reads and writes</li>
<li>randrw: Random mixed reads and writes.</li>
<li>trim, randtrim, trimwrite</li>
</ul>
</li>
</ul>
</li>
<li>Block size<ul>
<li>bs: The block size in bytes used for I/O units</li>
</ul>
</li>
<li>Buffer and Memory<ul>
<li>sync=str<ul>
<li>sync: Use synchronous file IO. O_SYNC</li>
<li>dsync: Use synchronous data IO. For the majority of I/O engines, this means using O_DSYNC.</li>
</ul>
</li>
</ul>
</li>
<li>I/O size<ul>
<li>size: The total size of file I/O for each thread of this job. Fio will run until this many bytes has been transferred, unless runtime is limited by  other  options  (such  as  runtime, for instance, or increased/decreased by io_size).</li>
</ul>
</li>
<li>I/O engine<ul>
<li>ioengine=str<ul>
<li>psync: Basic pread(2) or pwrite(2) I/O. Default on all supported operating systems except for Windows</li>
<li>libaio:  Linux native asynchronous I/O. Note that Linux may only support queued behavior with non-buffered  I/O  (set  direct=1 or buffer=0).  This engine defines engine specific options.</li>
</ul>
</li>
</ul>
</li>
<li>I/O depth<ul>
<li>iodepth=int<ul>
<li>Number of I/O units to keep in flight against the file. Note that increasing iodepth beyond 1 will not affect synchronous  ioengines  (except  for  small  degrees  when verify_async is in use). Even async engines may impose OS restrictions causing the desired depth not to be achieved. This may happen on Linux when using libaio and not setting <code>direct=1</code>', since buffered I/O is not async on that OS. Keep  an  eyeon the I/O depth distribution in the fio output to verify that the achieved depth is as expected. Default: 1.</li>
</ul>
</li>
</ul>
</li>
<li>chatgpt4:<ul>
<li>当 <code>iodepth</code> 大于 1 时，<code>fio</code> 会尝试同时发起多个 I/O 请求，以此来模拟并发 I/O 负载。这对于评估存储系统在高并发场景下的性能非常有用。</li>
<li>对于同步 I/O 引擎（如 <code>psync</code>），<code>iodepth</code> 大于 1 的设置影响不大，因为同步 I/O 操作会按顺序一个接一个地执行。但是，在使用 <code>verify_async</code> 选项时，即使是同步引擎，将 <code>iodepth</code> 设置得稍微大于 1 也可能有轻微的影响。</li>
<li>对于异步 I/O 引擎（如 <code>libaio</code>），增加 <code>iodepth</code> 可以显著提高并发度和吞吐量。然而，操作系统和其它因素可能限制实际达到的深度，特别是在不使用直接 I/O（<code>direct=1</code>）的情况下。在 Linux 中，如果不设置 <code>direct=1</code>，<code>libaio</code> 使用的是缓冲 I/O，而这在 Linux 上并不是异步的。</li>
<li><code>fio</code> 输出中的 I/O 深度分布可以帮助你验证实际达到的深度是否符合预期。</li>
</ul>
</li>
</ul>
<p>stonewall
wait_for_previous  Wait for preceding jobs in the job file to exit, before starting this one. Can be used to insert serialization points in the job  file.  A stone  wall  also  implies  starting  a  new  reporting  group,  see  group_reporting.  Optionally you can use <code>stonewall=0</code> to disable or <code>stonewall=1</code> to enable it.</p>
<h4 id="配置文件">配置文件<a class="headerlink" href="#配置文件" title="Permanent link">&para;</a></h4>
<ul>
<li>global 公共部分，影响后面每一个 job</li>
<li><strong>默认 job 是并行的，需要添加 stonewall</strong>等待前面一个完成</li>
<li>filename 指定共同使用一个文件（否则会根据 job 名自动生成）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo fio --directory=/root/ --filename=test.bin ssd-win-likely.fio
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>vim ssd-win-likely.fio #模仿windows下diskmark，测顺序读写和4k随机
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>[global]
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>ioengine=libaio
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>size=10g
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>direct=1
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>runtime=60
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>[seq-read-4m]
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>bs=4M
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>iodepth=32
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>rw=read
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>stonewall
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>[seq-write-4m]
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>bs=4M
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>iodepth=32
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>rw=write
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>stonewall
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>[rand-read-4k]
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>bs=4k
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>iodepth=4
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>rw=randread
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>stonewall
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>[rand-write-4k]
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>bs=4k
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>iodepth=4
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>rw=randwrite
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>stonewall
</span></code></pre></div>
<h4 id="机械硬盘例子">机械硬盘例子<a class="headerlink" href="#机械硬盘例子" title="Permanent link">&para;</a></h4>
<ul>
<li>dd read 时需要添加-iflag=direct，否则测得速度 11GB/s<ul>
<li>O_DIRECT：绕过系统的页缓存，更准确地衡量磁盘本身的性能（</li>
</ul>
</li>
<li>顺序读时，测试/dev/sda1 和 test.img 速度是不同的 120 -&gt; 170 MB/s</li>
<li>iodepth 影响 1 -&gt; 8: 155 -&gt; 180 MB/s</li>
<li>在我测试的机械硬盘上，增加 jobnums 提升没有 iodepth 明显</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>fio --filename=/dev/sda1 --bs=1M --direct=1 --iodepth=8 --numjobs 1 --group_reporting --size=1g --runtime=60 --name SeqRead --rw=read --ioengine=libaio --readonly
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>SeqRead: (g=0): rw=read, bs=(R) 1024KiB-1024KiB, (W) 1024KiB-1024KiB, (T) 1024KiB-1024KiB, ioengine=libaio, iodepth=8
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>fio-3.33
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>Starting 1 process
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>Jobs: 1 (f=1): [R(1)][100.0%][r=166MiB/s][r=166 IOPS][eta 00m:00s]
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>SeqRead: (groupid=0, jobs=1): err= 0: pid=884774: Wed Mar 13 17:09:47 2024
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>  read: IOPS=168, BW=168MiB/s (177MB/s)(1024MiB/6078msec)
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    slat (usec): min=28, max=339, avg=46.65, stdev=27.34
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    clat (msec): min=30, max=240, avg=45.46, stdev=25.37
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>     lat (msec): min=30, max=240, avg=45.51, stdev=25.37
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    clat percentiles (msec):
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>     |  1.00th=[   40],  5.00th=[   40], 10.00th=[   40], 20.00th=[   40],
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>     | 30.00th=[   40], 40.00th=[   40], 50.00th=[   42], 60.00th=[   43],
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>     | 70.00th=[   43], 80.00th=[   45], 90.00th=[   45], 95.00th=[   46],
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>     | 99.00th=[  234], 99.50th=[  241], 99.90th=[  241], 99.95th=[  241],
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>     | 99.99th=[  241]
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>   bw (  KiB/s): min=88064, max=202752, per=99.72%, avg=172032.00, stdev=40726.61, samples=12
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>   iops        : min=   86, max=  198, avg=168.00, stdev=39.77, samples=12
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>  lat (msec)   : 50=96.09%, 100=1.56%, 250=2.34%
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>  cpu          : usr=0.20%, sys=4.67%, ctx=1444, majf=0, minf=2059
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>  IO depths    : 1=0.1%, 2=0.2%, 4=0.4%, 8=99.3%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>     complete  : 0=0.0%, 4=99.9%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>     issued rwts: total=1024,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>     latency   : target=0, window=0, percentile=100.00%, depth=8
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>Run status group 0 (all jobs):
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>   READ: bw=168MiB/s (177MB/s), 168MiB/s-168MiB/s (177MB/s-177MB/s), io=1024MiB (1074MB), run=6078-6078msec
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>Disk stats (read/write):
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>  sda: ios=2108/1, merge=4/0, ticks=106583/0, in_queue=106584, util=95.24%
</span></code></pre></div>
<h4 id="例子">例子<a class="headerlink" href="#例子" title="Permanent link">&para;</a></h4>
<p>aigo P7000Z 2TB pcie 4.0 (标称读 7350, 写 6750 MB/s)
输出</p>
<p>单独分区</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>root@ryzen-pve ➜  fio fio --filename=/dev/nvme0n1p5 ssd-win-likely.fio
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Run status group 0 (all jobs):
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>   READ: bw=7043MiB/s (7385MB/s), 7043MiB/s-7043MiB/s (7385MB/s-7385MB/s), io=10.0GiB (10.7GB), run=1454-1454msec
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>Run status group 1 (all jobs):
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>  WRITE: bw=6392MiB/s (6703MB/s), 6392MiB/s-6392MiB/s (6703MB/s-6703MB/s), io=10.0GiB (10.7GB), run=1602-1602msec
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>Run status group 2 (all jobs):
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>   READ: bw=344MiB/s (361MB/s), 344MiB/s-344MiB/s (361MB/s-361MB/s), io=2048MiB (2147MB), run=5950-5950msec
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>Run status group 3 (all jobs):
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>  WRITE: bw=818MiB/s (857MB/s), 818MiB/s-818MiB/s (857MB/s-857MB/s), io=2048MiB (2147MB), run=2505-2505msec
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>Run status group 4 (all jobs):
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>  WRITE: bw=502MiB/s (526MB/s), 502MiB/s-502MiB/s (526MB/s-526MB/s), io=2048MiB (2147MB), run=4082-4082msec
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>Disk stats (read/write):
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>  nvme0n1: ios=544852/1011542, merge=0/0, ticks=373885/471120, in_queue=845097, util=91.87%
</span></code></pre></div>
<p>zfs dataset, compression=off</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>root@ryzen-pve ➜  fio fio --filename=/pool0/test/fio.img ssd-win-likely.fio
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>Run status group 0 (all jobs):
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>   READ: bw=2201MiB/s (2308MB/s), 2201MiB/s-2201MiB/s (2308MB/s-2308MB/s), io=10.0GiB (10.7GB), run=4653-4653msec
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>Run status group 1 (all jobs):
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>  WRITE: bw=2786MiB/s (2921MB/s), 2786MiB/s-2786MiB/s (2921MB/s-2921MB/s), io=10.0GiB (10.7GB), run=3676-3676msec
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>Run status group 2 (all jobs):
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>   READ: bw=174MiB/s (183MB/s), 174MiB/s-174MiB/s (183MB/s-183MB/s), io=2048MiB (2147MB), run=11739-11739msec
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>Run status group 3 (all jobs):
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>  WRITE: bw=165MiB/s (173MB/s), 165MiB/s-165MiB/s (173MB/s-173MB/s), io=2048MiB (2147MB), run=12393-12393msec
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>Run status group 4 (all jobs):
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>  WRITE: bw=194MiB/s (204MB/s), 194MiB/s-194MiB/s (204MB/s-204MB/s), io=2048MiB (2147MB), run=10530-10530msec
</span></code></pre></div>
<p>samsung pm9a1 zfs dataset compression=off</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>root@ryzen-pve ➜  fio fio --filename=/rpool/test/fio.img ssd-win-likely.fio
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>s
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Run status group 0 (all jobs):
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>   READ: bw=2485MiB/s (2606MB/s), 2485MiB/s-2485MiB/s (2606MB/s-2606MB/s), io=10.0GiB (10.7GB), run=4121-4121msec
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>Run status group 1 (all jobs):
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>  WRITE: bw=2683MiB/s (2813MB/s), 2683MiB/s-2683MiB/s (2813MB/s-2813MB/s), io=10.0GiB (10.7GB), run=3817-3817msec
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>Run status group 2 (all jobs):
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>   READ: bw=171MiB/s (179MB/s), 171MiB/s-171MiB/s (179MB/s-179MB/s), io=2048MiB (2147MB), run=12004-12004msec
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>Run status group 3 (all jobs):
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>  WRITE: bw=207MiB/s (217MB/s), 207MiB/s-207MiB/s (217MB/s-217MB/s), io=2048MiB (2147MB), run=9897-9897msec
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>Run status group 4 (all jobs):
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>  WRITE: bw=243MiB/s (254MB/s), 243MiB/s-243MiB/s (254MB/s-254MB/s), io=2048MiB (2147MB), run=8439-8439msec
</span></code></pre></div>
<h1 id="网络">网络<a class="headerlink" href="#网络" title="Permanent link">&para;</a></h1>
<h2 id="network-相关">network 相关<a class="headerlink" href="#network-相关" title="Permanent link">&para;</a></h2>
<h3 id="常见网络配置方法">常见网络配置方法<a class="headerlink" href="#常见网络配置方法" title="Permanent link">&para;</a></h3>
<p><a href="https://wiki.debian.org/NetworkConfiguration">NetworkConfiguration - Debian Wiki</a></p>
<ul>
<li>ifupdown<ul>
<li>debian 默认的方法</li>
<li>配置文件为：<code>/etc/network/interfaces</code></li>
<li>ifupdown2 是新版，支持更加灵活的配置</li>
</ul>
</li>
<li><a href="https://wiki.debian.org/NetworkManager">NetworkManger</a><ul>
<li>目标是尽可能保证连接到网络。使用自动的规则配置网络，比如检测到有线设备就会连接</li>
<li>常用于桌面发行版</li>
<li>可以使用命令行工具 nmcli 进行配置，也可以使用 TUI 工具 nmtui 进行配置。</li>
</ul>
</li>
<li>systemd<ul>
<li>相关的服务：systemd-networkd, systemd-resolved</li>
<li>配置文件位于<code>/etc/system/network</code>，使用类似于 ini 格式</li>
</ul>
</li>
<li>netplan<ul>
<li>常见于 ubuntu，底层可以基于 systemd-networkd 或 NetworkManager（服务器版和桌面版）</li>
<li>是另一层抽象，使用自己的配置文件<code>/etc/netplan/</code>，使用 yaml 格式。</li>
</ul>
</li>
</ul>
<p><a href="https://unix.stackexchange.com/questions/475146/how-exactly-are-networkmanager-networkd-netplan-ifupdown2-and-iproute2-inter">networking - How exactly are NetworkManager, networkd, netplan, ifupdown2, and iproute2 interacting? - Unix &amp; Linux Stack Exchange</a></p>
<h3 id="dns-配置方法">dns 配置方法<a class="headerlink" href="#dns-配置方法" title="Permanent link">&para;</a></h3>
<ul>
<li>需要区分：有些工具是在本地运行一个 dns 服务器，监听 53 请求。这种可以实现 local dns caching 等功能。</li>
<li>有些工具只是修改 <code>/etc/resolve.conf</code> （通常不直接修改，而是替换该文件为一个软连接）为上游 dns。</li>
<li>有哪些 dns server<ul>
<li>dnsmasq</li>
<li>systemd-resolved </li>
</ul>
</li>
<li>NetworkManger 本身不提供 dns 能力，可以配置使用不同后端：<ul>
<li>default（修改 resolve.conf 包含（所有接口？）上游 dns</li>
<li>dnsmasq 和 systemd-resolved </li>
</ul>
</li>
</ul>
<h4 id="dnsmasq">dnsmasq<a class="headerlink" href="#dnsmasq" title="Permanent link">&para;</a></h4>
<p>openwrt 上比较熟悉</p>
<h3 id="dns-配置方法--systemd-resolved">dns 配置方法 —— systemd-resolved<a class="headerlink" href="#dns-配置方法--systemd-resolved" title="Permanent link">&para;</a></h3>
<p><a href="https://wiki.archlinux.org/title/Systemd-resolved">systemd-resolved - ArchWiki (archlinux.org)</a></p>
<p><em>systemd-resolved</em> has four different modes for handling the file—stub, static, uplink and foreign</p>
<h4 id="设置上游-dns">设置上游 DNS<a class="headerlink" href="#设置上游-dns" title="Permanent link">&para;</a></h4>
<h5 id="自动">自动<a class="headerlink" href="#自动" title="Permanent link">&para;</a></h5>
<p><em>systemd-resolved</em> will work out of the box with a <a href="https://wiki.archlinux.org/title/Network_manager" title="Network manager">network manager</a> using <code>/etc/resolv.conf</code>. No particular configuration is required since <em>systemd-resolved</em> will be detected by following the <code>/etc/resolv.conf</code> symlink. This is going to be the case with <a href="https://wiki.archlinux.org/title/Systemd-networkd" title="Systemd-networkd">systemd-networkd</a>, <a href="https://wiki.archlinux.org/title/NetworkManager" title="NetworkManager">NetworkManager</a>, and <a href="https://wiki.archlinux.org/title/Iwd" title="Iwd">iwd</a>.</p>
<h5 id="手动">手动<a class="headerlink" href="#手动" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>/etc/systemd/resolved.conf.d/dns_servers.conf
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>[Resolve]
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>DNS=192.168.35.1 fd7b:d0bd:7a6e::1
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Domains=~.
</span></code></pre></div>
<h5 id="fallbak">fallbak<a class="headerlink" href="#fallbak" title="Permanent link">&para;</a></h5>
<p>没有 DNS 时，fallbak 到 Cloudflare, Quad9 and Google.</p>
<p>正常情况/etc/resolv.conf为软连接，内容为
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>search ustc.edu.cn
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>nameserver 127.0.0.53
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>options edns0 trust-ad
</span></code></pre></div></p>
<p>手动修复
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ln -s /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf -f
</span></code></pre></div></p>
<h3 id="网络工具">网络工具<a class="headerlink" href="#网络工具" title="Permanent link">&para;</a></h3>
<p><a href="https://www.debian.org/doc/manuals/debian-reference/ch05.en.html">Chapter 5. Network setup (debian.org)</a></p>
<ul>
<li>iproute2</li>
<li>iptables</li>
<li>ethtool</li>
<li>mtr</li>
<li>nmap</li>
<li>tcpdump</li>
<li>dnsutils: nslookup, dig</li>
</ul>
<h2 id="dhcp">dhcp<a class="headerlink" href="#dhcp" title="Permanent link">&para;</a></h2>
<p>测试 dhcp 是否工作</p>
<ul>
<li>netplan（或者重启容器） + tcpdump  + wireshark</li>
</ul>
<ul>
<li>-d: debug 模式，前台运行</li>
<li>-n: 不设置接口</li>
<li>-s: 指定 dhcp server（否则是广播）</li>
<li>-w: 没有找到广播接口时也不退出，用于可插拔网卡。</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a> dhclient -d -n -w -s 192.168.35.1
</span></code></pre></div>
<p>接口放在前面
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>sudo dhclient eth0 -n -v -d
</span></code></pre></div></p>
<h2 id="dns">dns<a class="headerlink" href="#dns" title="Permanent link">&para;</a></h2>
<h3 id="dig">dig<a class="headerlink" href="#dig" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>dig [@server] [-p port] [-t type] [-4] [-6] [+trace] name
</span></code></pre></div>
<ul>
<li>@ 指定 DNS 查询使用的服务器名称或 IP，IP 地址可以是用点分隔的 IPv4 地址也可以是冒号分隔的 IPv6 地址。当参数指定的值是服务器的主机名时，dig 命令会在查询该域名服务器前先解析该主机名；</li>
<li>-p 指定 DNS 查询使用的端口号，默认情况下 DNS 查询使用标准的 53 端口，若使用非端口则需要通过 -p 参数指定，可使用此选项来测试已配置为侦听非标准端口号上的 DNS 服务器；</li>
<li>-t 指定 DNS 查询的记录类型，常用的类型包括：A/AAAA/NS/MX/CNAME 等，缺省查询类型是 A；</li>
<li>-4 指定 dig 命令仅使用 IPv4 查询传输；</li>
<li>-6 指定 dig 命令仅使用 IPv6 查询传输；</li>
<li><strong>+trace</strong> 跟踪从根名称服务器开始的迭代查询过程，缺省情况不使用跟踪。启用跟踪时，dig 命令会执行迭代查询以解析要查询的名称，显示来自用于解析查询的每个服务器的应答。</li>
</ul>
<p>指定解析类型</p>
<ul>
<li>NS 记录：用来指定域名由哪个 DNS 服务器进行解析；</li>
<li>CNAME 记录：用来定义域名的别名，方便实现将多个域名解析到同一个 IP 地址；</li>
<li>A 记录：用来指定主机名对应的 IPv4 地址；</li>
<li>AAAA 记录：用来指定主机名对应的 IPv6 地址；</li>
<li>MX 记录：用来指定收件人域名的邮件服务器，SMTP 协议会根据 MX 记录的值来决定邮件的路由过程；</li>
<li>PTR 记录：常用于反向地址解析，将 IP 地址解析到对应的名称；</li>
<li>SOA 记录：称为起始授权机构记录，不同于 NS 记录用于标识多台域名解析服务器，SOA 记录用于在多台 NS 记录中哪一台是主 DNS 服务器。</li>
</ul>
<p>USTC lug 加群链接</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>dig jointele.ustclug.org TXT
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>;; ANSWER SECTION:
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>jointele.ustclug.org.   600     IN      TXT     &quot;(base64) aHR0cHM6Ly90Lm1lLytYOXg1V09qTVpVbGlZVGRs&quot;
</span></code></pre></div>
<h3 id="查看上游-dns">查看上游 dns<a class="headerlink" href="#查看上游-dns" title="Permanent link">&para;</a></h3>
<p>有多种 dns 设置方式：</p>
<ul>
<li>直接编辑/etc/resolve 设置上游 dns</li>
<li>systemd-resolve 服务（自动设置 dns）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>systemd-resolve --status
</span></code></pre></div>
<p>从 ubuntu22.04 开始</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>resolvectl status
</span></code></pre></div>
<p><a href="https://askubuntu.com/questions/1409726/systemd-resolve-command-not-found-in-ubuntu-22-04-desktop">systemd-resolve command not found in Ubuntu 22.04 desktop - Ask Ubuntu</a></p>
<h2 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h2>
<p>持久化</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>iptables-save &gt; /etc/iptables/rules.v4  # 
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>ip6tables-save &gt; /etc/iptables/rules.v6 
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>iptables-restore &lt; /etc/iptables/rules.v4
</span></code></pre></div>
<p>安装 iptabels-persistent</p>
<h2 id="遇到的问题">遇到的问题<a class="headerlink" href="#遇到的问题" title="Permanent link">&para;</a></h2>
<h3 id="bridge-iptable-不生效">bridge iptable 不生效<a class="headerlink" href="#bridge-iptable-不生效" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>bridge-nf-call-iptables - BOOLEAN
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a> 1 : pass bridged IPv4 traffic to iptables&#39; chains.
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a> 0 : disable this.
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a> Default: 1
</span></code></pre></div>
<h1 id="系统维护">系统维护<a class="headerlink" href="#系统维护" title="Permanent link">&para;</a></h1>
<h2 id="initrd">initrd<a class="headerlink" href="#initrd" title="Permanent link">&para;</a></h2>
<p>ubuntu22.04 intird 69M，全部都是微码。</p>
<p>EFI 分区只有 grub.efi 和 grub 配置
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>root@ryzen ➜  EFI tree -L 2 ubuntu
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>ubuntu
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>├── BOOTX64.CSV
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>├── grub.cfg
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>├── grubx64.efi
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>├── mmx64.efi
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>└── shimx64.efi
</span></code></pre></div>
grub 配置，需要挂载完整的 root 分区，然后去 /boot/grub 中继续
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>search.fs_uuid ff2e2d36-0788-436f-9d42-e390f318f0ec root hd0,gpt3
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>set prefix=($root)&#39;/boot/grub&#39;
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>configfile $prefix/grub.cfg
</span></code></pre></div></p>
<p>pve initrd 59M，包含了 <code>/etc/, /usr/bin, /usr/lib/firmware, /usr/lib/modules/***.ko</code></p>
<p>pve EFI 分区包含了 initrd, vmlinuz
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>root@ryzen-pve ➜  ~ l /boot/efi/EFI/proxmox/6.8.12-2-pve/
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>total 73M
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>-rwxr-xr-x 1 root root 59M Jan 22 14:28 initrd.img-6.8.12-2-pve
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>-rwxr-xr-x 1 root root 14M Sep  5 18:03 vmlinuz-6.8.12-2-pve
</span></code></pre></div></p>
<p>还包含一个 loader 目录（没有使用 grub）
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>root@ryzen-pve ➜  ~ tree -L 3 /boot/efi/loader
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>/boot/efi/loader
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>├── entries
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>│   ├── proxmox-6.5.13-6-pve.conf
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>│   ├── proxmox-6.8.12-2-pve.conf
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>│   └── proxmox-6.8.4-3-pve.conf
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>├── entries.srel
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>├── loader.conf
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>└── random-seed
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a># proxmox-xxx.conf 内容
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>title    Proxmox Virtual Environment
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>version  6.8.12-2-pve
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>options  root=ZFS=rpool/ROOT/pve-1 boot=zfs amd_iommu=on iommu=pt pcie_acs_override=multifunction mitigations=off
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>linux    /EFI/proxmox/6.8.12-2-pve/vmlinuz-6.8.12-2-pve
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>initrd   /EFI/proxmox/6.8.12-2-pve/initrd.img-6.8.12-2-pve
</span></code></pre></div></p>
<p>ubuntu 启动时，grub 启动后，挂载 </p>
<h3 id="使用-lsinitrd-查看">使用 lsinitrd 查看<a class="headerlink" href="#使用-lsinitrd-查看" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>sudo apt install dracut-core
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>root@ryzen ➜  /boot lsinitrd /boot/initrd.img-$(uname -r)
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>Image: /boot/initrd.img-6.8.0-49-generic: 69M
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>========================================================================
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>Early CPIO image
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>========================================================================
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>drwxr-xr-x   3 root     root            0 Dec 18  2019 .
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>drwxr-xr-x   3 root     root            0 Dec 18  2019 kernel
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>drwxr-xr-x   3 root     root            0 Dec 18  2019 kernel/x86
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>drwxr-xr-x   2 root     root            0 Dec 18  2019 kernel/x86/microcode
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>-rw-r--r--   1 root     root        76166 Dec 18  2019 kernel/x86/microcode/AuthenticAMD.bin
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>========================================================================
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>Version:
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a>Arguments:
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>dracut modules:
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>========================================================================
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>drwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>drwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>drwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86/microcode
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>drwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86/microcode/.enuineIntel.align.0123456789abc
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>-rw-r--r--   1 root     root      7979008 Aug 29 20:00 kernel/x86/microcode/GenuineIntel.bin
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>========================================================================
</span></code></pre></div>
<h3 id="解压查看">解压查看<a class="headerlink" href="#解压查看" title="Permanent link">&para;</a></h3>
<p>initrd.img 通常是一个压缩后的 cpio archive。</p>
<ul>
<li>先用 file 查看文件类型，然后解压，再输入给 cpio 提取<ul>
<li>unzstd -c 表示解压到标准输出</li>
<li>cpio -D 解压到指定路径
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>root@ryzen-pve ➜  ~ file /boot/initrd.img-6.8.12-2-pve
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>/boot/initrd.img-6.8.12-2-pve: Zstandard compressed data (v0.8+), Dictionary ID: None
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>unzstd -c /boot/initrd.img-6.8.12-2-pve | cpio -idmv -D /mnt/initrd
</span></code></pre></div></li>
</ul>
</li>
</ul>
<ul>
<li><code>gzip compressed data</code></li>
<li><code>XZ compressed data</code></li>
<li><code>LZMA compressed data</code></li>
<li><code>ASCII cpio archive</code> (This is rare for modern initrds)
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>gunzip -c  # 或 zcat
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>xzcat
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>lzma -d -c
</span></code></pre></div></li>
</ul>
<h2 id="bash-配置">bash 配置<a class="headerlink" href="#bash-配置" title="Permanent link">&para;</a></h2>
<p><strong>1. 登录 Shell (Login Shell)</strong></p>
<p>登录 shell 的加载顺序如下：</p>
<ol>
<li><strong>/etc/profile</strong>：系统级的全局配置文件，对所有用户生效。通常包含系统环境变量的设置、启动程序的脚本等。</li>
<li><strong>/etc/profile.d/*.sh</strong>：<code>/etc/profile.d</code> 目录下的所有 <code>.sh</code> 文件，也是系统级的全局配置，方便管理员添加自定义的配置脚本。</li>
<li><strong>~/.bash_profile</strong>：用户的个人配置文件，仅对当前用户生效。如果该文件存在，则执行该文件，后面的文件不再执行。</li>
<li><strong>~/.bash_login</strong>：如果 <code>~/.bash_profile</code> 不存在，则执行该文件。</li>
<li><strong>~/.profile</strong>：如果 <code>~/.bash_profile</code> 和 <code>~/.bash_login</code> 都不存在，则执行该文件。</li>
<li><strong>~/.bash_logout</strong>：在退出登录 shell 时执行的文件，用于执行一些清理工作。</li>
</ol>
<p>非登录 shell 的加载顺序较为简单：</p>
<ol>
<li><strong>/etc/bashrc</strong>：系统级的全局配置文件，对所有非登录 shell 生效。</li>
<li><strong>~/.bashrc</strong>：用户的个人配置文件，仅对当前用户的非登录 shell 生效。</li>
</ol>
<h2 id="sudoer-设置">sudoer 设置<a class="headerlink" href="#sudoer-设置" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>vim /etc/sudoers
</span></code></pre></div>
<p>将用户添加到 admin 或 sudo 用户组即可</p>
<p>免密码：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>%sudo   ALL=(ALL:ALL) NOPASSWD: ALL
</span></code></pre></div>
<p>sudoers 每项含义（待续）</p>
<h2 id="sshd-设置">sshd 设置<a class="headerlink" href="#sshd-设置" title="Permanent link">&para;</a></h2>
<p>允许 ssh 登录 root</p>
<p>先改为 yes，然后 ssh-copy-id 后，改为禁用密码</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>PermitRootLogin prohibit-password
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>#PermitRootLogin yes
</span></code></pre></div>
<p>禁用密码登录</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>PasswordAuthentication no
</span></code></pre></div>
<p>其它选项</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>PermitRootLogin prohibit-password
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>PubkeyAuthentication yes    # 允许公钥登录
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>PubkeyAcceptedKeyTypes=+ssh-rsa
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>PasswordAuthentication no   # 禁用密码登录
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>ChallengeResponseAuthentication no
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>Accepted password for yfy from 192.168.36.215 port 50342 ssh2
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>Accepted publickey for yfy from 192.168.36.180 port 26464 ssh2: RSA SHA256:z9yheNzateaIikTVkTXN1lmMPRIsp+H0ssbhU4Q8Kfg
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>pam_unix(sshd:session): session opened for user yfy(uid=1000) by (uid=0)
</span></code></pre></div>
<h2 id="setcap">setcap<a class="headerlink" href="#setcap" title="Permanent link">&para;</a></h2>
<p>授予特定二进制文件在不提升用户权限的情况下绑定低端口</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>sudo setcap &#39;cap_net_bind_service=+ep&#39; /usr/bin/python3.10 # 不能是软链接
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>➜<span class="w">  </span>~<span class="w"> </span>sudo<span class="w"> </span>setcap<span class="w"> </span>cap_sys_admin+p<span class="w"> </span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>which<span class="w"> </span>sunshine<span class="k">))</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>➜<span class="w">  </span>~<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>readlink<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>which<span class="w"> </span>sunshine<span class="k">))</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>/usr/bin/sunshine-v0.23.1
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>➜<span class="w">  </span>~<span class="w"> </span>getcap<span class="w"> </span>/usr/bin/sunshine-v0.23.1
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>/usr/bin/sunshine-v0.23.1<span class="w"> </span><span class="nv">cap_sys_admin</span><span class="o">=</span>p
</span></code></pre></div>
<h2 id="ldap">ldap<a class="headerlink" href="#ldap" title="Permanent link">&para;</a></h2>
<p><a href="https://docs.acsalab.com/ldap/">LDAP - ACSA Docs (acsalab.com)</a></p>
<h2 id="systemd">systemd<a class="headerlink" href="#systemd" title="Permanent link">&para;</a></h2>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>list-units<span class="w"> </span>--type<span class="o">=</span>service<span class="w"> </span>--state<span class="o">=</span>running
</span></code></pre></div>
<h2 id="ssh-证书">ssh 证书<a class="headerlink" href="#ssh-证书" title="Permanent link">&para;</a></h2>
<p><a href="https://docs.ustclug.org/infrastructure/sshca/">SSH Certificate Authority - LUG @ USTC (ustclug.org)</a>
<a href="https://ibug.io/blog/2019/12/manage-servers-with-ssh-ca/">Managing servers with OpenSSH Certificate Authority - iBug</a></p>
<ul>
<li>client 验证 server 身份，需要将 server 公钥添加到 known_hosts 中。<ul>
<li>当有多个服务器时，client 需要同意多次（ssh 时的 yes）</li>
<li>当 server 公钥变更时，还得修改 known_hosts</li>
</ul>
</li>
<li>server 验证 client 身份，同样需要将 client public key 添加到 authorized_keys 中。<ul>
<li>多个服务端和客户端，需要将每个 client 公钥复制到每个 server。</li>
<li>修改一个 client 需要修改所有 server</li>
</ul>
</li>
</ul>
<p>SSH CA(Certificate Authority) 是一对受信任的密钥，用于签发证书。</p>
<blockquote>
<p>An SSH Certificate Authority (CA) is a trusted key pair that issues certificates.</p>
</blockquote>
<p>签发的证书可以用来授权 client 或者 server。（通过信任 host CA，client 可以信任所有 server，只要它们有 host CA 签名的证书。同样，通过信任 user CA，server 可以信任所有的 client，只要它们有 user CA 签名的证书。）</p>
<blockquote>
<p>Certificates can be used for authentication on both the server side and the client side</p>
</blockquote>
<p>SSH CA 和 X.509 证书系统不同的是，证书无法签发新的证书（即无法嵌套）</p>
<p><strong>host CA 和 user CA 可以是不同的，也可以是相同的。</strong>
<img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20231124113058.png" /></p>
<h3 id="ssh-ca">SSH CA<a class="headerlink" href="#ssh-ca" title="Permanent link">&para;</a></h3>
<h4 id="创建-ca">创建 CA<a class="headerlink" href="#创建-ca" title="Permanent link">&para;</a></h4>
<p>和创建一个通常的密钥对一样。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a> sudo ssh-keygen -f yfy_ca -t ed25519 -C &quot;yfy CA&quot;
</span></code></pre></div>
<ul>
<li>-t dsa | ecdsa | ecdsa-sk | ed25519 | ed25519-sk | rsa</li>
<li>-C comment：添加到公钥结尾</li>
</ul>
<h4 id="签发证书">签发证书<a class="headerlink" href="#签发证书" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>ssh-keygen<span class="w"> </span>-s<span class="w"> </span>/path/to/ssh_ca<span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">           </span>-I<span class="w"> </span>certificate_identity<span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">           </span>-n<span class="w"> </span>principals<span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">          </span><span class="o">[</span>-O<span class="w"> </span>options<span class="o">]</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">          </span><span class="o">[</span>-V<span class="w"> </span>validity_interval<span class="o">]</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">           </span>public_key_file
</span></code></pre></div>
<h3 id="使用-host-ca-授权-server-端">使用 host CA 授权 server 端<a class="headerlink" href="#使用-host-ca-授权-server-端" title="Permanent link">&para;</a></h3>
<p>给 server 的公钥 ssh_host_rsa_key.pub 签名</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>ssh-keygen -s /path/to/ssh_ca \
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>           -I blog \
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>           -h \
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>           -n blog.s.ustclug.org,blog.p.ustclug.org,10.254.0.15,202.141.176.98,202.141.160.98 \
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>           ssh_host_rsa_key.pub
</span></code></pre></div>
<ul>
<li>-h 表示签发的是 host 证书（server 端）</li>
<li>-n 用于限制该证书只在提供的域名或者 ip 上有效。这样即使该证书被偷了，偷窃者也无法伪造我们的服务器。</li>
</ul>
<p>添加到 sshd 配置中，这样 client 连接时会尝试提供该证书</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a># /etc/ssh/sshd_config
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>HostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub
</span></code></pre></div>
<p>客户端信任 CA 机构</p>
<ul>
<li>将 CA 公钥保存在 my_ca.pub 中</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>printf &quot;@cert-authority * &quot; | cat - my_ca.pub &gt;&gt; ~/.ssh/known_hosts
</span></code></pre></div>
<ul>
<li>保存在 dns 中<ul>
<li>利用{command1 &amp;&amp; command2 }将两条命令合并，将其输出重定向</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>{printf &quot;@cert-authority * &quot; &amp;&amp; dig ca.yfycloud.top TXT +noall +answer | awk -F&#39;TXT&#39; &#39;{print $NF}&#39; |xargs} &gt;&gt; ~/.ssh/known_hosts
</span></code></pre></div>
<p>使用 nslookup(windows bash 下测试)</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>(printf &quot;@cert-authority * &quot; &amp;&amp; nslookup -q=txt ca.yfycloud.top |grep CA | xargs) &gt;&gt; ~/.ssh/known_hosts
</span></code></pre></div>
<h3 id="使用-user-ca-授权-client-端">使用 user CA 授权 client 端<a class="headerlink" href="#使用-user-ca-授权-client-端" title="Permanent link">&para;</a></h3>
<p>服务端信任 user CA</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>TrustedUserCAKeys /etc/ssh/ssh_user_ca
</span></code></pre></div>
<p>给指定用户签发证书</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>ssh-keygen -s my_ca -I &lt;user name&gt; -n root,ubuntu id_rsa.pub
</span></code></pre></div>
<ul>
<li>将生成的 id_rsa-cert.pub 放至 id_rsa.pub 同一目录，ssh 连接服务端时会自动读取。</li>
<li>-n 用于限制允许登录的用户</li>
</ul>
<h3 id="遇到问题">遇到问题<a class="headerlink" href="#遇到问题" title="Permanent link">&para;</a></h3>
<p>mobaxterm连接服务器时报错：<code>No supported authentication methods available (server sent: publickey)</code>
但是我明明是指定的使用ssh key登录，在命令行中也确实是能够用指定的私钥登录的。</p>
<p>后面发现问题是mobaxterm发现了我有一个证书，使用该证书去登录了。但是该证书签名时只principal只指定了root，从而导致登不上。
服务端日志如下，刚开始指定登录root成功，第二次指定fyyuan登录失败</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Mar 29 11:39:26 snode1 sshd[1143073]: Accepted publickey for root from 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23902 ssh2: ED25519-CERT SHA256:oL5HVEHu4AQj4e0d03kjT39A6p5t+3j5SKUKOqLKjwI ID Yuan Fuyan (serial 0) CA ECDSA SHA256:e/hc4wrIaub3Q8UGmQYQI3A2fiiHF/RevFKo0UCG4Tc
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>Mar 29 11:39:26 snode1 sshd[1143073]: pam_unix(sshd:session): session opened for user root by (uid=0)
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>Mar 29 11:39:45 snode1 sshd[1144083]: error: Certificate invalid: name is not a listed principal
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>Mar 29 11:39:45 snode1 sshd[1144083]: error: Received disconnect from 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23929:14: No supported authentication methods available [preauth]
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>Mar 29 11:39:45 snode1 sshd[1144083]: Disconnected from authenticating user fyyuan 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23929 [preauth]
</span></code></pre></div>
<h2 id="包管理器-apt">包管理器 apt<a class="headerlink" href="#包管理器-apt" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>apt show pkg -a #查看包的所有仓库  # APT-Sources:
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>--no-install-recommends
</span></code></pre></div>
<h3 id="sourcelist">source.list<a class="headerlink" href="#sourcelist" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>deb [ option1=value1 option2=value2 ] uri suite [component1] [component2] [...]
</span></code></pre></div>
<p>ONE-LINE-STYLE FORMAT</p>
<blockquote>
<p>If options should be provided they are <strong>separated by spaces</strong> and all of them together are enclosed by square brackets ([]) included in the line after the type separated from it with a space. If an option allows multiple values these are separated from each other with a comma (,). An option name is separated from its value(s) by an equals sign (=). Multivalue options also have -= and += as separators, which instead of replacing the default with the given value(s) modify the default value(s) to remove or include the given values.</p>
</blockquote>
<h3 id="查询文件">查询文件<a class="headerlink" href="#查询文件" title="Permanent link">&para;</a></h3>
<p><a href="https://serverfault.com/questions/96964/list-of-files-installed-from-apt-package">linux - List of files installed from apt package - Server Fault</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>apt install apt-file
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>apt-file update
</span></code></pre></div>
<p>列出包的内容</p>
<ul>
<li>已安裝包：<code>dpkg -L deb</code></li>
<li>未安裝包：<code>apt-file list $package</code></li>
<li>有 deb 文件：<code>dpkg --contents $package.deb</code></li>
</ul>
<p>查询文件位于哪个包中</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>dpkg -S /usr/bin/nvidia-xconfig
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>apt-file search /usr/bin/nvidia-xconfig
</span></code></pre></div>
<h3 id="源优先级">源优先级<a class="headerlink" href="#源优先级" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>apt-cache policy &lt;package&gt;
</span></code></pre></div>
<p>按照 nvidia 官网下载了本地版本的 cuda deb，安装后在<code>/var/cuda-repo-ubuntu2004-12-1-local</code>可以看到 deb 包。但是 apt install 时仍然采用了 nvidia 仓库的。</p>
<p>解决方法：</p>
<ul>
<li>直接注释掉<code>/etc/apt/source.list</code>中的 nvidia 仓库，然后 apt update<ul>
<li>也有可能 source.list 中没有 developer.download.nvidia.com，那么禁用<code>/etc/apt/source.list.d/</code>下的在线 cuda 仓库。如
  <code>mv cuda-ubuntu2004-x86_64.list cuda-ubuntu2004-x86_64.list.bak</code>。</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>vim /etc/apt/preference.d/cuda-repository-pin-600
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a># Priority 越小优先级越高
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>Package: nsight-compute
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>Pin: origin *ubuntu.com*
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>Pin-Priority: -1
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>Package: nsight-systems
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>Pin: origin *ubuntu.com*
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>Pin-Priority: -1
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>Package: *
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>Pin: release l=NVIDIA CUDA
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>Pin-Priority: 600
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>➜  ~ apt-cache policy gnome-shell-extension-ubuntu-dock
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>gnome-shell-extension-ubuntu-dock:
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>  Installed: (none)
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>  Candidate: 72~ubuntu5.22.04.2.1
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>  Version table:
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>     72~ubuntu5.22.04.2.1 500
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>        500 http://mirrors.ustc.edu.cn/ubuntu jammy-updates/main amd64 Packages
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>     72~ubuntu5 500
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>        500 http://mirrors.ustc.edu.cn/ubuntu jammy/main amd64 Packages
</span></code></pre></div>
<h3 id="deb-包与软件源">deb 包与软件源<a class="headerlink" href="#deb-包与软件源" title="Permanent link">&para;</a></h3>
<ul>
<li>deb 包是 ar 文件（不支持目录，ar 格式同样用于静态链接库）</li>
<li>包含
    -  <code>debian-binary</code>：仅包含 deb 版本号的文本文件，目前版本为 <code>2.0</code>。
    - <code>control.tar.xz</code>（或 <code>control.tar.zst</code> ）
        - control：包含软件包的元数据，例如版本，架构，维护者，依赖、描述等
        - md5sum：data.tar.xz 内容的 md5sum
    - <code>data.tar.xz</code>（或 <code>data.tar.zst</code> 等）：包含软件包的实际文件。</li>
</ul>
<p>软件源目录结构：</p>
<p>最简单的需要包含以下部分：</p>
<ul>
<li>deb 包</li>
<li><code>Packages</code>：将所有包的 <code>control</code> 文件连接起来
    - 生成：dpkg-scanpackages . &gt; Packages</li>
<li><code>Release</code>：<strong>软件源</strong>的元数据，包含了生成时间、Label，Origin（域名），Packages和自身文件（头部）的哈希（md5, sha1等等）
    - 使用 <code>apt-ftparchive</code> 生成</li>
</ul>
<p>Debian 或 Ubuntu 官方源 更复杂，仓库的元数据会存储在 <code>dists</code> 目录下，而软件包则存储在 <code>pool</code> 目录下</p>
<ul>
<li><code>Release.gpg</code>：<code>Release</code> 文件的 GPG 签名。</li>
<li><code>InRelease</code>：附加了 GPG 签名的 <code>Release</code> 文件。</li>
<li><code>contrib/</code>, <code>main/</code>, <code>non-free/</code>, <code>non-free-firmware/</code> 是不同的组件（Components）</li>
</ul>
<h3 id="删除-i386">删除 i386<a class="headerlink" href="#删除-i386" title="Permanent link">&para;</a></h3>
<ul>
<li>i386 可以放心删</li>
<li>apt 删除会因为删除 libc:i386 等包而报错，使用 dpkg --force-all</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>sudo dpkg --force-all --purge $(dpkg --list | grep &#39;i386&#39; | awk &#39;{print $2}&#39;)
</span></code></pre></div>
<p>删除完后，可能有一些 x86 的包会依赖 i386 的包，也要删除
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>base) fyyuan@snode2 ➜  ~ sudo dpkg --force-all --purge $(dpkg --list | grep &#39;i386&#39; | awk &#39;{print $2}&#39;)
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>dpkg: warning: overriding problem because --force enabled:
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>dpkg: warning: this is a protected package; it should not be removed
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>dpkg: warning: overriding problem because --force enabled:
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>dpkg: warning: this is a protected package; it should not be removed
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>(Reading database ... 286736 files and directories currently installed.)
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>Removing libc6:i386 (2.35-0ubuntu3.9) ...
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>Purging configuration files for libc6:i386 (2.35-0ubuntu3.9) ...
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>dpkg: warning: overriding problem because --force enabled:
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>dpkg: warning: this is a protected package; it should not be removed
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>Removing libcrypt1:i386 (1:4.4.27-1) ...
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>Removing libgcc-s1:i386 (12.3.0-1ubuntu1~22.04) ...
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>Removing gcc-12-base:i386 (12.3.0-1ubuntu1~22.04) ...
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>dpkg: libc6-i386: dependency problems, but removing anyway as you requested:
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a> libclang-common-6.0-dev depends on libc6-i386 (&gt;= 2.17).
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a> libclang-common-12-dev depends on libc6-i386 (&gt;= 2.34).
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a> libclang-common-10-dev depends on libc6-i386 (&gt;= 2.17).
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a> lib32stdc++6 depends on libc6-i386 (&gt;= 2.34).
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a> lib32gcc-s1 depends on libc6-i386 (&gt;= 2.35).
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a>Removing libc6-i386 (2.35-0ubuntu3.9) ...
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a>Purging configuration files for libc6-i386 (2.35-0ubuntu3.9) ...
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a>Processing triggers for libc-bin (2.35-0ubuntu3.9) ..
</span></code></pre></div></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>
</span></code></pre></div>
<h2 id="用户管理">用户管理<a class="headerlink" href="#用户管理" title="Permanent link">&para;</a></h2>
<p>A multiuser system must provide basic support for user security in three areas: <strong>identification</strong>, <strong>authentication</strong>, and <strong>authorization</strong>. The identification portion of security answers the question of who users are. The authentication piece asks users to prove that they are who they say they are. Finally, authorization is used to define and limit what users are allowed to do.</p>
<h3 id="identification">identification<a class="headerlink" href="#identification" title="Permanent link">&para;</a></h3>
<p>The Linux kernel supports the traditional concept of a Unix user.</p>
<ul>
<li>User: A user is an entity that can run processes and own files.<ul>
<li>kernel only know user id, don't know username</li>
</ul>
</li>
<li>Groups are sets of users. The primary purpose of groups is to allow a user to share file access to other members of a group.</li>
</ul>
<ul>
<li>adduser：交互式添加用户<ul>
<li>useradd 为更底层的命令</li>
</ul>
</li>
<li>usermod -aG sudo user：将用户添加到 sudo 组</li>
<li>gpasswd -d user group: 将用户从组中删除</li>
</ul>
<p>sticky </p>
<h3 id="authentication">authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<p>When it comes to user identification, the Linux kernel knows only the numeric user IDs for process and file ownership. The kernel knows authorization rules for how to run setuid executables and how user IDs may run the setuid() family of system calls to change from one user to another. However, the kernel doesn’t know anything about authentication: usernames, passwords, and so on. Practically everything related to authentication happens in user space.</p>
<h4 id="pam">PAM<a class="headerlink" href="#pam" title="Permanent link">&para;</a></h4>
<p>To accommodate flexibility in user authentication, in 1995 Sun Microsystems proposed a new standard called Pluggable Authentication Modules (PAM), a system of shared libraries for authentication (Open Software Foundation RFC 86.0, October 1995).</p>
<p>You’ll normally find PAM’s application configuration files in the <code>/etc/pam.d</code> directory</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>#/etc/pam.d/chsh
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>auth requisite pam_shells.so
</span></code></pre></div>
<ul>
<li>function type: The function that a user application asks PAM to perform<ul>
<li>auth: Authenticate a user (see if the user is who they say they are).)</li>
<li>account</li>
<li>session</li>
<li>password: Change a user’s password or other credentials.</li>
</ul>
</li>
<li>control arguement: 可以用来表示一个流程图<ul>
<li>sufficient: 成功返回真，否则继续判断</li>
<li>requisite: 成功继续判断、否则返回假</li>
<li>required: 成功则继续判断、否则返回假并进行一次额外操作</li>
</ul>
</li>
<li>module<ul>
<li>pam_shell.so: checks to see if the user’s shell is listed in /etc/shells</li>
<li>pam_unix.so: asks the user for their password and checks it</li>
</ul>
</li>
</ul>
<p>通过 man pam_ 查看各种模块作用。</p>
<h5 id="禁止普通用户执行-su">禁止普通用户执行 su<a class="headerlink" href="#禁止普通用户执行-su" title="Permanent link">&para;</a></h5>
<p>为了方便 IPMI 登陆，root 用户没有密码。因为禁用了密码登录，因此不用担心安全。
但是为了普通用户通过 su 切换到 root 用户，需要额外设置 PAM。</p>
<p>启用 pam_wheel.so 即可，检查用户是否是 root group，不是则授权失败。
<div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>auth       sufficient pam_rootok.so
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>auth       required   pam_wheel.so
</span></code></pre></div></p>
<p>pam_wheel</p>
<ul>
<li>作用：Only permit root access to members of group wheel</li>
<li>参数：<code>pam_wheel.so [debug] [deny] [group=name] [root_only] [trust]</code><ul>
<li>group 参数：Instead of checking the wheel or GID 0 groups, use the name group to perform the authentication.</li>
</ul>
</li>
</ul>
<h3 id="authorization--file-permission">authorization / File permission<a class="headerlink" href="#authorization--file-permission" title="Permanent link">&para;</a></h3>
<p><a href="linux 和 windows 权限模型.md">linux 和 windows 权限模型</a></p>
<p>Lacking execute permission on a directory can limit the other permissions in interesting ways. For example, how can you add a new file to a directory (by leveraging the write permission) if you can't access the directory's metadata to store the information for a new, additional file? You cannot. It is for this reason that directory-type files generally offer execute permission to one or more of the user owner, group owner, or others.</p>
<h2 id="日志journalctl">日志/journalctl<a class="headerlink" href="#日志journalctl" title="Permanent link">&para;</a></h2>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs">How To Use Journalctl to View and Manipulate Systemd Logs | DigitalOcean</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>journalctl --list-boots
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>journalctl -b # 自上次reboot开始log
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>journalctl -b -1 # 上一次reboot
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>journalctl --since &quot;2015-01-10&quot; --until &quot;2015-01-11 03:00&quot;  # YYYY-MM-DD HH:MM:SS
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>journalctl --since yesterday
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>journalctl -S yesterday
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a>journalctl -k # 内核
</span></code></pre></div>
<h3 id="sytemdtime7">sytemd.time(7)<a class="headerlink" href="#sytemdtime7" title="Permanent link">&para;</a></h3>
<h4 id="time-span">time span<a class="headerlink" href="#time-span" title="Permanent link">&para;</a></h4>
<p>Time spans refer to time durations</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>•   usec, us, µs
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>•   msec, ms
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>•   seconds, second, sec, s
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>•   minutes, minute, min, m
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>•   hours, hour, hr, h
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>•   days, day, d
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>•   weeks, week, w
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>•   months, month, M (defined as 30.44 days)
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>•   years, year, y (defined as 365.25 days)
</span></code></pre></div>
<p>example</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>2 h
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>2hours
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>48hr
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>1y 12month
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>55s500ms
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>300ms20s 5day
</span></code></pre></div>
<h4 id="timestamp">timestamp<a class="headerlink" href="#timestamp" title="Permanent link">&para;</a></h4>
<p>Timestamps refer to specific, unique points in time</p>
<p>一般显示格式：<code>Fri 2012-11-23 23:02:15 CET</code></p>
<p>包含毫秒格式（sub-second remainder is expected separated by a full stop from the seconds component.）</p>
<p><code>2014-03-25 03:59:56.654563</code></p>
<p>特殊关键字："now", "today", "yesterday", and "tomorrow"</p>
<p>相对时间，<code>-</code> 表示当前时间减去 timespan，<code>+</code> 则是加上。也可以在结尾使用 <code>ago</code> 和 <code>left</code>（注意需要一个空格）</p>
<p><code>+3h30min → Fri 2012-11-23 21:45:22</code></p>
<p><code>@</code> 表示相对于 UNIX epoch</p>
<blockquote>
<p>Finally, a timespan prefixed with "@" is evaluated relative to the UNIX time epoch 1st Jan, 1970, 00:00.</p>
</blockquote>
<p><code>@1395716396 → Tue 2014-03-25 03:59:56</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>             Fri 2012-11-23 11:12:13 → Fri 2012-11-23 11:12:13
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>                 2012-11-23 11:12:13 → Fri 2012-11-23 11:12:13
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>             2012-11-23 11:12:13 UTC → Fri 2012-11-23 19:12:13
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>                          2012-11-23 → Fri 2012-11-23 00:00:00
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>                            12-11-23 → Fri 2012-11-23 00:00:00
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>                            11:12:13 → Fri 2012-11-23 11:12:13
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>                               11:12 → Fri 2012-11-23 11:12:00
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>                                 now → Fri 2012-11-23 18:15:22
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>                               today → Fri 2012-11-23 00:00:00
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>                           today UTC → Fri 2012-11-23 16:00:00
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>                           yesterday → Fri 2012-11-22 00:00:00
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>                            tomorrow → Fri 2012-11-24 00:00:00
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>           tomorrow Pacific/Auckland → Thu 2012-11-23 19:00:00
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a>                            +3h30min → Fri 2012-11-23 21:45:22
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a>                                 -5s → Fri 2012-11-23 18:15:17
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>                           11min ago → Fri 2012-11-23 18:04:22
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a>                         @1395716396 → Tue 2014-03-25 03:59:56
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>➜  ~ systemd-analyze timestamp now
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>  Original form: now
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>Normalized form: Mon 2024-06-03 18:09:45 CST
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>       (in UTC): Mon 2024-06-03 10:09:45 UTC
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>   UNIX seconds: @1717409385.708355
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a>       From now: 165us ago
</span></code></pre></div>
<h4 id="calendar-event">calendar event<a class="headerlink" href="#calendar-event" title="Permanent link">&para;</a></h4>
<p>Calendar events may be used to refer to one or more points in time in a single expression. They form a <strong>superset</strong> of the absolute timestamps explained above</p>
<p>格式和 timestamps 类似</p>
<p><code>Thu,Fri 2012-*-1,5 11:12:13</code></p>
<p>规则</p>
<ul>
<li><code>*</code> 表示通配符</li>
<li><code>,</code> 逗号分隔表示多个值</li>
<li><code>..</code> 表示连续的一段值</li>
<li>省略 date 表示今天，省略 time 表示 00:00:00</li>
<li><code>start/repetition</code>：从 start 开始，增加 repetition 的倍数的所有值。</li>
<li>date 中可以使用 <code>~</code> 表示倒数的第几天。如 <code>*-02~01</code> 表示 2 月最后一天。<ul>
<li><code>"Mon *-05~07/1"</code> means "the last Monday in May."。~07/1 表示从最后一周开始的每一天，mon 则限制了周一。</li>
</ul>
</li>
</ul>
<p>一些规则的简写</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>               minutely → *-*-* *:*:00
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>                 hourly → *-*-* *:00:00
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>                  daily → *-*-* 00:00:00
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>                monthly → *-*-01 00:00:00
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>                 weekly → Mon *-*-* 00:00:00
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a>                 yearly → *-01-01 00:00:00
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>              quarterly → *-01,04,07,10-01 00:00:00
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>           semiannually → *-01,07-01 00:00:00
</span></code></pre></div>
<p>示例</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>             Sat,Thu,Mon..Wed,Sat..Sun → Mon..Thu,Sat,Sun *-*-* 00:00:00
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>                 Mon,Sun 12-*-* 2,1:23 → Mon,Sun 2012-*-* 01,02:23:00
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>                               Wed *-1 → Wed *-*-01 00:00:00
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>                      Wed..Wed,Wed *-1 → Wed *-*-01 00:00:00
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>                            Wed, 17:48 → Wed *-*-* 17:48:00
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>           Wed..Sat,Tue 12-10-15 1:2:3 → Tue..Sat 2012-10-15 01:02:03
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>                           *-*-7 0:0:0 → *-*-07 00:00:00
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>                                 10-15 → *-10-15 00:00:00
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>                   monday *-12-* 17:00 → Mon *-12-* 17:00:00
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>             Mon,Fri *-*-3,1,2 *:30:45 → Mon,Fri *-*-01,02,03 *:30:45
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>                  12,14,13,12:20,10,30 → *-*-* 12,13,14:10,20,30:00
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>                       12..14:10,20,30 → *-*-* 12..14:10,20,30:00
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a>             mon,fri *-1/2-1,3 *:30:45 → Mon,Fri *-01/2-01,03 *:30:45
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>                        03-05 08:05:40 → *-03-05 08:05:40
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a>                              08:05:40 → *-*-* 08:05:40
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a>                                 05:40 → *-*-* 05:40:00
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a>                Sat,Sun 12-05 08:05:40 → Sat,Sun *-12-05 08:05:40
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a>                      Sat,Sun 08:05:40 → Sat,Sun *-*-* 08:05:40
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a>                      2003-03-05 05:40 → 2003-03-05 05:40:00
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a>            05:40:23.4200004/3.1700005 → *-*-* 05:40:23.420000/3.170001
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a>                        2003-02..04-05 → 2003-02..04-05 00:00:00
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a>                  2003-03-05 05:40 UTC → 2003-03-05 05:40:00 UTC
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#__codelineno-76-23"></a>                            2003-03-05 → 2003-03-05 00:00:00
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#__codelineno-76-24"></a>                                 03-05 → *-03-05 00:00:00
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#__codelineno-76-25"></a>                                hourly → *-*-* *:00:00
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#__codelineno-76-26"></a>                                 daily → *-*-* 00:00:00
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#__codelineno-76-27"></a>                             daily UTC → *-*-* 00:00:00 UTC
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#__codelineno-76-28"></a>                               monthly → *-*-01 00:00:00
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#__codelineno-76-29"></a>                                weekly → Mon *-*-* 00:00:00
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#__codelineno-76-30"></a>               weekly Pacific/Auckland → Mon *-*-* 00:00:00 Pacific/Auckland
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#__codelineno-76-31"></a>                                yearly → *-01-01 00:00:00
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#__codelineno-76-32"></a>                              annually → *-01-01 00:00:00
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#__codelineno-76-33"></a>                                 *:2/3 → *-*-* *:02/3:00
</span></code></pre></div>
<h3 id="日志文件">日志文件<a class="headerlink" href="#日志文件" title="Permanent link">&para;</a></h3>
<ul>
<li><code>/run/log/journal/MACHINE-ID/</code>：存储在内存中，重启消失</li>
<li><code>/var/log/journal/MACHINE-ID</code>：存储在磁盘中</li>
</ul>
<p>查看大小：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>journalctl --disk-usage  # 日志大小，包含归档日志
</span></code></pre></div>
<p><img alt="" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/20230326220602.png" /></p>
<p>清除：</p>
<ul>
<li>vacuum：删除归档的日志（不会删除 active 的）</li>
<li>rotate：将 active 归档。可以合并到上条命令</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>journalctl --rotate
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>journalctl --vacuum-time=1months  # 一个月以前的旧日志。格式：1m, 2h, 2weeks, 4months
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>journalctl --vacuum-size=100M     # 只保留新的100M大小的日志
</span></code></pre></div>
<p>设置最大日志大小：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>/etc/systemd/journald.conf
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>SystemMaxUse=100M
</span></code></pre></div>
<p>SystemMaxUse=, RuntimeMaxUse=</p>
<blockquote>
<p>Enforce size limits on the journal files stored. The options prefixed with "System" apply to the journal files when stored on a persistent file system, more specifically /var/log/journal. The options prefixed with "Runtime" apply to the journal files when stored on a volatile in-memory file system, more specifically /run/log/journal.</p>
</blockquote>
<p>MaxFileSec=</p>
<blockquote>
<p>The maximum time to store entries in a single journal file before rotating to the next one.</p>
</blockquote>
<h3 id="查看重启原因">查看重启原因<a class="headerlink" href="#查看重启原因" title="Permanent link">&para;</a></h3>
<p><a href="https://unix.stackexchange.com/a/278166">https://unix.stackexchange.com/a/278166</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>last -x |tac |less  # last显示最后logged用户，tac将文本逆序
</span></code></pre></div>
<ul>
<li>正常顺序：<ul>
<li>reboot 没有对应的 shutdown 表示非正常关机</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>shutdown system down  ... &lt;-- first the system shuts down   
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>reboot   system boot  ... &lt;-- afterwards the system boots
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>runlevel (to lvl 3)  # runlevel3表示无图形界面，开机桌面环境可能是runlevel 5
</span></code></pre></div>
<p><img alt="" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230424194325.png" /></p>
<h3 id="查看-crontab-日志">查看 crontab 日志<a class="headerlink" href="#查看-crontab-日志" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>grep CRON /var/log/syslog
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>jou -u cron
</span></code></pre></div>
<h2 id="更换内核">更换内核<a class="headerlink" href="#更换内核" title="Permanent link">&para;</a></h2>
<h3 id="编译">编译<a class="headerlink" href="#编译" title="Permanent link">&para;</a></h3>
<p><a href="https://debian-handbook.info/browse/stable/sect.kernel-compilation.html">8.10. Compiling a Kernel (debian-handbook.info)</a></p>
<h4 id="disabling-the-debug-information">disabling the debug information<a class="headerlink" href="#disabling-the-debug-information" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>$ make deb-pkg LOCALVERSION=-falcot KDEB_PKGVERSION=$(make kernelversion)-1
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>[...]
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>$ ls ../*.deb
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>../linux-headers-5.10.46-falcot_5.10.46-1_amd64.deb
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>../linux-image-5.10.46-falcot_5.10.46-1_amd64.deb
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a>../linux-image-5.10.46-falcot-dbg_5.10.46-1_amd64.deb
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a>../linux-libc-dev_5.10.46-1_amd64.deb
</span></code></pre></div>
<blockquote>
<p>The whole process requires around 20 GB of free space, at least 8 GB of RAM, and several hours of compilation (utilizing one core) for a standard amd64 Debian kernel. These requirements can be drastically reduced by disabling the debug information using <code>CONFIG_DEBUG_INFO=n</code>, but this will make it impossible to trace kernel errors (“oops”) using <code>gdb</code> and also stop the creation of the linux-image-<em>version</em>-dbg package.</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a># 获得当前官方kernel编译配置，如/boot/config-5.19.0-35-generic
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>kernel_config=$(ls /boot/config-* | grep generic | sort -Vr | head -n 1) 
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>cp &quot;${kernel_config}&quot; .config
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a># 基于当前.confg，只询问新内核中新功能的配置
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>make oldconfig 
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a># 编译
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>make -j &quot;$(nproc)&quot; bindeb-pkg LOCALVERSION=&quot;${kernel_localversion}&quot; || exit
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a># 安装
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>sudo dpkg -i ../linux-image-${kernel_version}${kernel_localversion}*.deb ../linux-headers-${kernel_version}${kernel_localversion}*.deb
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a># 更新grub，通过GRUB_DEFAULT选择编译的内核
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a>vim /etc/default/grub
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>grub_line=&quot;GRUB_DEFAULT=\&quot;Advanced options for Ubuntu&gt;Ubuntu, with Linux ${kernel_version}${kernel_localversion}\&quot;&quot;
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a>sudo sed -i -e &quot;s/^#GRUB_DEFAULT=.*/\0\n${grub_line}/&quot; &quot;${grub_config}&quot;
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a>sudo update-grub
</span></code></pre></div>
<h4 id="missing-certificate">missing certificate<a class="headerlink" href="#missing-certificate" title="Permanent link">&para;</a></h4>
<blockquote>
<p>Building a custom kernel based on these settings will fail if <code>debian/certs/debian-uefi-certs.pem</code> does not exist. This file can either be obtained from the kernel team's Git repository and placed into the source tree, or it can be replaced by your own certificate(s), or you'll have to disable the setting via <code>CONFIG_SYSTEM_TRUSTED_KEYS=""</code>.</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>sed -i -e &#39;/^CONFIG_SYSTEM_TRUSTED_KEYS=/ c\CONFIG_SYSTEM_TRUSTED_KEYS=\&quot;\&quot;&#39; .config
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>sed -i -e &#39;/^CONFIG_SYSTEM_REVOCATION_KEYS=/ c\CONFIG_SYSTEM_REVOCATION_KEY=\&quot;\&quot;&#39; .config
</span></code></pre></div>
<h3 id="dkms">dkms<a class="headerlink" href="#dkms" title="Permanent link">&para;</a></h3>
<p>使用 patched kernel 后，没有了 zfs，无法启动 lxc。
<a href="https://askubuntu.com/questions/1268519/ubuntu-20-04-building-patched-kernel-results-in-no-zfs-support">Ubuntu 20.04, building patched kernel results in no ZFS support - Ask Ubuntu</a></p>
<p><a href="https://debian-handbook.info/browse/stable/sect.kernel-compilation.html#sect.modules-build">https://debian-handbook.info/browse/stable/sect.kernel-compilation.html#sect.modules-build</a></p>
<ul>
<li>一些模块不能打包到 linux 内核中</li>
<li>使用 dkms 自动化编译这些模块。需要安装了对应的<code>linux-headers-*</code></li>
</ul>
<blockquote>
<p>Compiling External Modules
Some modules are maintained outside of the official Linux kernel. To use them, they must be compiled alongside the matching kernel.
While we could manually extract the tarball and build the module, in practice we prefer to automate all this using the DKMS framework (Dynamic Kernel Module Support). Most modules offer the required DKMS integration in a package ending with a <code>-dkms</code> suffix.  In our case, installing dahdi-dkms is all that is needed to compile the kernel module for the current kernel provided that we have the linux-headers-* package matching the installed kernel. For instance, if you use linux-image-amd64, you would also install linux-headers-amd64.</p>
</blockquote>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zfs-dkms
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>dkms<span class="w"> </span>status
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="c1"># zfs/2.1.5, 5.19.17, x86_64: installed</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a>dkms<span class="w"> </span>build
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>dkms<span class="w"> </span>install
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a>dkms<span class="w"> </span>uninstall<span class="w">  </span>zfs/2.1.5
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a>dkms<span class="w"> </span>add
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a>dkms<span class="w"> </span>remove<span class="w"> </span>zenpower/<span class="k">$(</span>VERSION<span class="k">)</span><span class="w">   </span>--all
</span></code></pre></div>
<p>例子：<a href="https://github.com/Ta180m/zenpower3">Ta180m/zenpower3: Migrated to Gitea (github.com)</a></p>
<ul>
<li>安装 header<ul>
<li>pve 使用自己的内核，因此也是安装自己的 header</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>apt install linux-headers-$(uname -r)
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>#pve
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>apt install proxmox-headers-$(uname -r)
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>dkms-install:
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>        dkms --version &gt;&gt; /dev/null
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>        mkdir -p $(DKMS_ROOT_PATH)
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>        cp $(CURDIR)/dkms.conf $(DKMS_ROOT_PATH)
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>        cp $(CURDIR)/Makefile $(DKMS_ROOT_PATH)
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>        cp $(CURDIR)/zenpower.c $(DKMS_ROOT_PATH)
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>        sed -e &quot;s/@CFLGS@/${MCFLAGS}/&quot; \
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>            -e &quot;s/@VERSION@/$(VERSION)/&quot; \
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>            -i $(DKMS_ROOT_PATH)/dkms.conf
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>        dkms add zenpower/$(VERSION)
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>        dkms build zenpower/$(VERSION)
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>        dkms install zenpower/$(VERSION)
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>dkms-uninstall:
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>        dkms remove zenpower/$(VERSION) --all
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>        rm -rf $(DKMS_ROOT_PATH)
</span></code></pre></div>
<h3 id="删除内核">删除内核<a class="headerlink" href="#删除内核" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>dpkg --get-selections | grep 5.19.17
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>apt remove xxx
</span></code></pre></div>
<p>或者手动删除</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>cd /boot/
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>rm -rf *3.19.8*
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>update-grub
</span></code></pre></div>
<h2 id="内核模块">内核模块<a class="headerlink" href="#内核模块" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>find /lib/modules/$(uname -r) -type f -name &#39;*.ko&#39;
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>modprobe xxx
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>modprobe -r xxx # 删除
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a>lsmod |grep xxx
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a>rmmod xxx
</span></code></pre></div>
<ol>
<li>
<p><code>depmod</code>: 用于更新内核模块依赖信息。<code>depmod</code> 命令会扫描系统中的内核模块，并为它们生成一个依赖关系文件，通常在 <code>/lib/modules/</code> 目录下。这个文件通常被命名为 <code>modules.dep</code>，它列出了每个模块及其依赖的其他模块，以确保内核模块正确加载和卸载。</p>
</li>
<li>
<p><code>lsmod</code>: 用于列出当前加载到内核中的模块。<code>lsmod</code> 命令会显示已加载模块的列表，以及它们的大小、使用次数和依赖关系。</p>
</li>
<li>
<p><code>modprobe</code>: 用于动态加载和卸载内核模块。<code>modprobe</code> 命令可以根据模块名称自动加载模块，并处理其依赖关系。它还可以用于卸载模块，或者通过参数指定模块选项。</p>
</li>
<li>
<p><code>insmod</code>: 用于手动加载一个内核模块。<code>insmod</code> 命令可以直接加载指定的模块文件，但不会处理模块的依赖关系。因此，通常建议使用 <code>modprobe</code> 来加载模块，以确保正确处理依赖关系。</p>
</li>
<li>
<p><code>rmmod</code>: 用于从内核中卸载一个已加载的模块。<code>rmmod</code> 命令接受模块名称作为参数，并会尝试卸载该模块，前提是它没有被其他模块所使用。</p>
</li>
<li>
<p><code>modinfo</code>: 用于获取有关内核模块的信息。<code>modinfo</code> 命令可以列出有关模块的信息，如作者、描述、参数等。</p>
</li>
<li>
<p><code>ls /lib/modules/</code>: 这个命令用于查看系统中可用的内核模块。在 <code>/lib/modules/</code> 目录下，你可以找到与已安装内核版本相关的模块文件和依赖信息。</p>
</li>
</ol>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/" class="md-footer__link md-footer__link--prev" aria-label="上一页: LXC 使用">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                LXC 使用
              </div>
            </div>
          </a>
        
        
          
          <a href="../2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" class="md-footer__link md-footer__link--next" aria-label="下一页: linux 相关-基本命令">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                linux 相关-基本命令
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TheRainstorm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>