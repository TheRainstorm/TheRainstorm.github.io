
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
      
      
      
        <link rel="canonical" href="https://yfy.cqu.ai/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/">
      
      
        <link rel="prev" href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/">
      
      
        <link rel="next" href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>gcc mpi 源码编译 - Rain 的随笔</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gcc" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Rain 的随笔" class="md-header__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rain 的随笔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              gcc mpi 源码编译
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../series/" class="md-tabs__link">
        
  
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tools/" class="md-tabs__link">
        
  
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../archive/2024/" class="md-tabs__link">
          
  
  
  归档

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-tabs__link">
          
  
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Rain 的随笔" class="md-nav__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rain 的随笔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    系列
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    工具
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    个人
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客 &amp; 网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    学习笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    折腾记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    软件工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    阅读
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2022-08-04 16:28:41+00:00" class="md-ellipsis">2022年8月4日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../../category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 10 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gcc" class="md-nav__link">
    <span class="md-ellipsis">
      GCC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GCC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#下载源码" class="md-nav__link">
    <span class="md-ellipsis">
      下载源码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure" class="md-nav__link">
    <span class="md-ellipsis">
      Configure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#解决链接库错误" class="md-nav__link">
    <span class="md-ellipsis">
      解决链接库错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遇到的问题" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#解压源码很慢" class="md-nav__link">
    <span class="md-ellipsis">
      解压源码很慢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcc830-make-失败" class="md-nav__link">
    <span class="md-ellipsis">
      gcc8.3.0 make 失败
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gcc-使用" class="md-nav__link">
    <span class="md-ellipsis">
      GCC 使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GCC 使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#glibc_xxx-not-found" class="md-nav__link">
    <span class="md-ellipsis">
      GLIBC_xxx Not Found
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi-使用" class="md-nav__link">
    <span class="md-ellipsis">
      MPI 使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MPI 使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#遇到的问题_1" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mpi4py-依赖固定路径的-libmpiso" class="md-nav__link">
    <span class="md-ellipsis">
      mpi4py 依赖固定路径的 libmpi.so
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpi" class="md-nav__link">
    <span class="md-ellipsis">
      MPI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MPI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mpich-和-openmpi-对比" class="md-nav__link">
    <span class="md-ellipsis">
      mpich 和 openmpi 对比
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpich-编译" class="md-nav__link">
    <span class="md-ellipsis">
      mpich 编译
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mpich 编译">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-选项" class="md-nav__link">
    <span class="md-ellipsis">
      configure 选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-fast" class="md-nav__link">
    <span class="md-ellipsis">
      enable-fast
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-manger" class="md-nav__link">
    <span class="md-ellipsis">
      Process Manger
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpiexec-选项" class="md-nav__link">
    <span class="md-ellipsis">
      mpiexec 选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遇到的问题_2" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cluster-上执行时使用了错误的-hydra_pmi_proxy" class="md-nav__link">
    <span class="md-ellipsis">
      cluster 上执行时使用了错误的 hydra_pmi_proxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ucx-version" class="md-nav__link">
    <span class="md-ellipsis">
      UCX version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydra" class="md-nav__link">
    <span class="md-ellipsis">
      hydra
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openmpi" class="md-nav__link">
    <span class="md-ellipsis">
      openmpi
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openmpi">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#运行选项" class="md-nav__link">
    <span class="md-ellipsis">
      运行选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遇到的问题_3" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../../tags/#tag:gcc" class="md-tag">gcc</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:mpi" class="md-tag">mpi</a>
      
    
  </nav>



  <h1>gcc mpi 源码编译</h1>

<p>gcc mpi 源码编译过程记录</p>
<!-- more -->

<h2 id="gcc">GCC<a class="headerlink" href="#gcc" title="Permanent link">&para;</a></h2>
<h3 id="下载源码">下载源码<a class="headerlink" href="#下载源码" title="Permanent link">&para;</a></h3>
<ul>
<li>官方<a href="https://www.gnu.org/prep/ftp.html">GNU Mirror List - GNU Project - Free Software Foundation</a><ul>
<li><a href="https://ftp.gnu.org/gnu/">https://ftp.gnu.org/gnu/</a></li>
<li><a href="http://ftp.gnu.org/gnu/">http://ftp.gnu.org/gnu/</a></li>
</ul>
</li>
</ul>
<ul>
<li>国内镜像<ul>
<li><a href="https://mirrors.aliyun.com/gnu/">https://mirrors.aliyun.com/gnu/</a></li>
<li><a href="https://mirrors.ustc.edu.cn/gnu/">https://mirrors.ustc.edu.cn/gnu/</a></li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/gnu/">https://mirrors.tuna.tsinghua.edu.cn/gnu/</a></li>
</ul>
</li>
</ul>
<h3 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h3>
<p>注意：</p>
<ul>
<li>不能在 src 目录 configure，而是应该另外创建一个 build 目录</li>
<li>gcc 提供了依赖安装脚本，不用手动去下载</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>/tmp/dir
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>wget<span class="w"> </span>https://mirrors.ustc.edu.cn/gnu/gcc/gcc-8.5.0/gcc-8.5.0.tar.xz
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>tar<span class="w"> </span>xf<span class="w"> </span>gcc-8.5.0.tar.xz
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">cd</span><span class="w"> </span>gcc-8.5.0
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1">#安装依赖</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>./contrib/download_prerequisites
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1">#在build目录下configure</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nb">cd</span><span class="w"> </span>..
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>mkdir<span class="w"> </span>build
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>../gcc-8.5.0/configure<span class="w"> </span>--disable-multilib<span class="w"> </span>--prefix<span class="o">=</span><span class="nv">$HOME</span>/ENV/gcc-8.5.0<span class="w"> </span>--enable-languages<span class="o">=</span>c,c++
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span>tee<span class="w"> </span>make.log<span class="w"> </span><span class="c1">#32线程编译大概40分钟左右</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>make<span class="w"> </span>install
</span></code></pre></div>
<ul>
<li>--disable-multilib：gcc 默认支持编译 32 位程序 (-m32)，关闭此功能</li>
</ul>
<h3 id="解决链接库错误">解决链接库错误<a class="headerlink" href="#解决链接库错误" title="Permanent link">&para;</a></h3>
<p>原因，程序是动态链接的。运行时使用的是系统的库。而系统的库和编译时使用的库不兼容。</p>
<ul>
<li>
<p>方法一：修改<code>LD_LIBRARY_PATH</code>环境变量</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>export LD_LIBRARY_PATH=$HOME/opt/gcc-9.1.0/lib64
</span></code></pre></div>
</li>
</ul>
<ul>
<li>
<p>方法二：编译时将库搜索路径存在二进制文件中</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>~/opt/gcc-9.1.0/bin/g++ -Wl,-rpath=$HOME/opt/gcc-9.1.0/lib64 --std=c++17 demo.cc -o demo
</span></code></pre></div>
</li>
</ul>
<ul>
<li>
<p>方法三：静态链接</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>~/opt/gcc-9.1.0/bin/g++ --std=c++17 demo.cc -o demo -static-libstdc++ -static-libgcc
</span></code></pre></div>
</li>
</ul>
<h3 id="遇到的问题">遇到的问题<a class="headerlink" href="#遇到的问题" title="Permanent link">&para;</a></h3>
<h4 id="解压源码很慢">解压源码很慢<a class="headerlink" href="#解压源码很慢" title="Permanent link">&para;</a></h4>
<p>服务器上解压 60M 的源码非常慢，解压了 10-20 分钟。不只是解压，cp, rm 源码目录都非常的慢。推测是 NFS 的原因。</p>
<p>解决方法为使用本地目录，如/tmp</p>
<h4 id="gcc830-make-失败">gcc8.3.0 make 失败<a class="headerlink" href="#gcc830-make-失败" title="Permanent link">&para;</a></h4>
<p>[Building gcc 8.3 <a href="https://stackoverflow.com/questions/62435946/building-gcc-8-3-makefile955-all-error-2">Makefile:955: all] Error 2 - Stack Overflow</a></p>
<p>好像是 8.3.0 自身的问题，换用 8.5.0 编译成功</p>
<h2 id="gcc-使用">GCC 使用<a class="headerlink" href="#gcc-使用" title="Permanent link">&para;</a></h2>
<h3 id="glibc_xxx-not-found">GLIBC_xxx Not Found<a class="headerlink" href="#glibc_xxx-not-found" title="Permanent link">&para;</a></h3>
<p>查看 glibc 版本</p>
<ul>
<li>20.04: GLIBC_2.30</li>
<li>22.04: GLIBC_2.35
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>strings /lib/x86_64-linux-gnu/libc.so.6 |grep GLIBC
</span></code></pre></div></li>
</ul>
<p>几乎所有软件都会动态连接到 glibc 库，因此软件如果是在高版本的机器上编译的，那么在低版本机器上运行就会报错。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>strings /staff/fyyuan/install/mpich/lib/libmpi.so.12.4.2 |grep GLIBC |tail
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>__isoc99_fscanf@GLIBC_2.7
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>toupper@GLIBC_2.2.5
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>lseek@GLIBC_2.2.5
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>ferror@GLIBC_2.2.5
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>getifaddrs@GLIBC_2.3
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>clock_getres@GLIBC_2.17
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>openat@GLIBC_2.4
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>qsort@GLIBC_2.2.5
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>lstat@GLIBC_2.33
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>fwrite@GLIBC_2.2.5
</span></code></pre></div>
<h2 id="mpi-使用">MPI 使用<a class="headerlink" href="#mpi-使用" title="Permanent link">&para;</a></h2>
<h3 id="遇到的问题_1">遇到的问题<a class="headerlink" href="#遇到的问题_1" title="Permanent link">&para;</a></h3>
<h4 id="mpi4py-依赖固定路径的-libmpiso">mpi4py 依赖固定路径的 libmpi.so<a class="headerlink" href="#mpi4py-依赖固定路径的-libmpiso" title="Permanent link">&para;</a></h4>
<p>已经确定 PATH、LIB_LIBRARY_PATH 中没有自己编译的路径了。运行一个简单的测试仍然固定依赖于我的 libmpi.so</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>(base) ➜  ~ mpiexec -n 2 python test_mpi2.py
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Traceback (most recent call last):
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  File &quot;test_mpi2.py&quot;, line 1, in &lt;module&gt;
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    from mpi4py import MPI
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>ImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32&#39; not found (required by /staff/fyyuan/install/mpich/lib/libmpi.so.12)
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>Traceback (most recent call last):
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>  File &quot;test_mpi2.py&quot;, line 1, in &lt;module&gt;
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    from mpi4py import MPI
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>ImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32&#39; not found (required by /staff/fyyuan/install/mpich/lib/libmpi.so.12)
</span></code></pre></div>
<p>当前 python 为 conda 的 base，其中 mpi4py 是用 pip 安装的。发现 conda 重新安装即可
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a> pip uninstall mpi4py
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Found existing installation: mpi4py 4.0.0
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>Uninstalling mpi4py-4.0.0:
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>  Would remove:
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    /staff/fyyuan/miniconda3/lib/python3.8/site-packages/mpi4py-4.0.0.dist-info/*
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    /staff/fyyuan/miniconda3/lib/python3.8/site-packages/mpi4py/*
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>Proceed (Y/n)? y
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  Successfully uninstalled mpi4py-4.0.0
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>conda install mpi4py
</span></code></pre></div></p>
<p>神奇的是它把 mpiexec 更改了
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>which mpiexec
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>/staff/fyyuan/miniconda3/bin/mpiexec
</span></code></pre></div></p>
<p>自己编译的
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>~/install/mpich-4.2.2/bin/mpiexec --version
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>HYDRA build details:
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    Version:                                 4.2.2
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    Release Date:                            Wed Jul  3 09:16:22 AM CDT 2024
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    CC:                              gcc
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    Configure options:                       &#39;--disable-option-checking&#39; &#39;--prefix=/staff/fyyuan/install/mpich-4.2.2&#39; &#39;--with-hwloc=embedded&#39; &#39;CC=gcc&#39; &#39;CXX=g++&#39; &#39;--disable-fortran&#39; &#39;--enable-fast=all,O3&#39; &#39;--cache-file=/dev/null&#39; &#39;--srcdir=../../../../mpich-4.2.2/src/pm/hydra&#39; &#39;CFLAGS= -DNDEBUG -DNVALGRIND -O3&#39; &#39;LDFLAGS=&#39; &#39;LIBS=&#39; &#39;CPPFLAGS= -DNETMOD_INLINE=__netmod_inline_ucx__ -I/staff/fyyuan/build/mpich-4.2.2-build/src/mpl/include -I/staff/fyyuan/build/mpich-4.2.2/src/mpl/include -I/staff/fyyuan/build/mpich-4.2.2/modules/json-c -I/staff/fyyuan/build/mpich-4.2.2-build/modules/json-c -I/staff/fyyuan/build/mpich-4.2.2/modules/hwloc/include -I/staff/fyyuan/build/mpich-4.2.2-build/modules/hwloc/include -D_REENTRANT -I/staff/fyyuan/build/mpich-4.2.2-build/src/mpi/romio/include -I/staff/fyyuan/build/mpich-4.2.2/src/pmi/include -I/staff/fyyuan/build/mpich-4.2.2-build/src/pmi/include -I/staff/fyyuan/build/mpich-4.2.2-build/modules/yaksa/src/frontend/include -I/staff/fyyuan/build/mpich-4.2.2/modules/yaksa/src/frontend/include&#39;
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    Process Manager:                         pmi
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    Topology libraries available:            hwloc
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    Resource management kernels available:   user slurm ll lsf sge pbs cobalt
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    Demux engines available:                 poll select
</span></code></pre></div></p>
<p>它的
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>mpiexec --version
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>HYDRA build details:
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    Version:                                 3.3.2
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    Release Date:                            Tue Nov 12 21:23:16 CST 2019
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    CC:                              x86_64-conda_cos6-linux-gnu-cc -I/staff/fyyuan/miniconda3/include -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    CXX:                             x86_64-conda_cos6-linux-gnu-c++ -I/staff/fyyuan/miniconda3/include -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    F77:                             x86_64-conda_cos6-linux-gnu-gfortran -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    F90:                             x86_64-conda_cos6-linux-gnu-gfortran -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    Configure options:                       &#39;--disable-option-checking&#39; &#39;--prefix=/staff/fyyuan/miniconda3&#39; &#39;--disable-dependency-tracking&#39; &#39;--enable-cxx&#39; &#39;--enable-fortran&#39; &#39;--disable-wrapper-rpath&#39; &#39;MPICHLIB_CFLAGS=-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix&#39; &#39;MPICHLIB_CPPFLAGS=-DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -I/staff/fyyuan/miniconda3/include&#39; &#39;MPICHLIB_CXXFLAGS=-fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix&#39; &#39;MPICHLIB_FFLAGS=-fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix&#39; &#39;MPICHLIB_FCFLAGS=-fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix&#39; &#39;CC=x86_64-conda_cos6-linux-gnu-cc&#39; &#39;CFLAGS=-I/staff/fyyuan/miniconda3/include -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2&#39; &#39;LDFLAGS=-L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib&#39; &#39;CPPFLAGS=-I/staff/fyyuan/miniconda3/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -I/staff/fyyuan/miniconda3/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpl/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpl/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/openpa/src -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/openpa/src -D_REENTRANT -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpi/romio/include&#39; &#39;CPP=/staff/fyyuan/miniconda3/bin/x86_64-conda_cos6-linux-gnu-cpp&#39; &#39;CXX=x86_64-conda_cos6-linux-gnu-c++&#39; &#39;CXXFLAGS=-I/staff/fyyuan/miniconda3/include -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2&#39; &#39;FC=x86_64-conda_cos6-linux-gnu-gfortran&#39; &#39;FCFLAGS=-I/staff/fyyuan/miniconda3/include -fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2&#39; &#39;FFLAGS=-I/staff/fyyuan/miniconda3/include -fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2&#39; &#39;--cache-file=/dev/null&#39; &#39;--srcdir=.&#39; &#39;LIBS=&#39; &#39;MPLLIBNAME=mpl&#39;
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    Process Manager:                         pmi
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    Topology libraries available:            hwloc
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    Resource management kernels available:   user slurm ll lsf sge pbs cobalt
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    Checkpointing libraries available:
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    Demux engines available:                 poll select
</span></code></pre></div></p>
<h2 id="mpi">MPI<a class="headerlink" href="#mpi" title="Permanent link">&para;</a></h2>
<p>mpi 运行时需要保证版本一致。而 apt 安装的 mpich 受发行版版本影响，可能不一样。因此最好的方式是自己<strong>从源码编译 mpich</strong>，放在 <strong>NFS</strong> 等公共可以访问的地方。</p>
<p>MPI 编译较快（&lt;半小时），可以编译很多版本使用</p>
<h3 id="mpich-和-openmpi-对比">mpich 和 openmpi 对比<a class="headerlink" href="#mpich-和-openmpi-对比" title="Permanent link">&para;</a></h3>
<p>MPICH：<a href="https://www.mpich.org/documentation/guides/">Guides | MPICH</a></p>
<ul>
<li>支持 mpi2.0，功能强大，效率高</li>
<li>缺点是仅支持以太网</li>
</ul>
<p>OpenMPI：</p>
<ul>
<li>支持 mpi2.0</li>
<li>对于 CPU 核心较多的节点，推荐使用 openmpi</li>
<li>支持各种网络，包括以太网和 infiniband</li>
</ul>
<h3 id="mpich-编译">mpich 编译<a class="headerlink" href="#mpich-编译" title="Permanent link">&para;</a></h3>
<p><em>p.s 切记要在低 GLIBC 版本的机器上编译，因为编译出来的结果都会动态链接到当前平台的 glibc 库（/lib/x86_64/libc.so），如果平台版本高（比如 ubuntu22.04 是 GLIBC 2.2.35），在低版本平台就无法运行 mpi 程序</em></p>
<p>官网有详细文档</p>
<ul>
<li>从源码编译：<a href="https://www.mpich.org/static/downloads/4.2.2/mpich-4.2.2-installguide.pdf">MPICH Installers’ Guide</a> is a guide to help with the installation process of MPICH. Both Unix and Windows installation procedures are outlines.</li>
<li><a href="https://www.mpich.org/static/downloads/4.2.2/mpich-4.2.2-userguide.pdf">MPICH Users’ Guide</a> provides instructions to use MPICH. This manual explains how to run MPI applications after MPICH is installed and working correctly.</li>
</ul>
<p>编译命令</p>
<ul>
<li>需要单独的 build 目录，和 src 目录分离</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>cd /path/to/build_tmp/
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>/path/to/src/configure -prefix=/path/to/install 2&gt;&amp;1 | tee c.txt
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>make -j 2&gt;&amp;1 | tee m.txt   # debug 可以 VERBOSE=1
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>make install 2&gt;&amp;1 | tee mi.txt
</span></code></pre></div>
<p>配置后的例子</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>../mpich-4.2.2/configure --prefix=$HOME/install/mpich-4.2.2 CC=gcc CXX=g++ --disable-fortran --enable-static --enable-fast=all,O3 2&gt;&amp;1 |tee tee c.log
</span></code></pre></div>
<h4 id="configure-选项">configure 选项<a class="headerlink" href="#configure-选项" title="Permanent link">&para;</a></h4>
<ul>
<li><code>--disable-fortran</code><ul>
<li>文档里写的是--disable-f77：禁用 fortran 77，--disable-fc：禁用 Fortran 90（及之后 95, 2003, 2008 版本）但是尝试后无效，仍然会要求你有 fortran 编译器。</li>
</ul>
</li>
<li><code>--enable-fast</code>
  MPICH libraries are built with default compiler optimization, -O2, which can be modified by --enable-fast configure option. For instance, --disable-fast disables the default optimization option. --enable-fast=O sets default compiler optimization as <code>-O&lt;n&gt;</code></li>
<li><code>--enable-static</code>：是否产生 <code>libmpi.a</code> 等文件</li>
<li><code>--enable-shared</code><ul>
<li>mpicc 编译出来的程序使用动态链接，运行时需要设置<code>LD_LIBRARY_PATH</code>。</li>
<li>--disable-shared --enable-static 则不用设置<code>LD_LIBRARY_PATH</code></li>
</ul>
</li>
</ul>
<h4 id="enable-fast">enable-fast<a class="headerlink" href="#enable-fast" title="Permanent link">&para;</a></h4>
<p>Both xFLAGS and MPICHLIB xFLAGS affect the compilation of the MPICH libraries. However, <strong>only xFLAGS is appended to MPI wrapper scripts, <code>mpicc</code> and friends.</strong></p>
<p>MPICH libraries are built with default compiler optimization, -O2, which can be modified by --enable-fast configure option. <code>--enable-fast=O&lt;n&gt;</code> sets default compiler optimization as -On</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>./configure --enable-fast=all,O3
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>./configure --enable-fast=all MPICHLIB_CFLAGS=-O3 \ 
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>            MPICHLIB_FFLAGS=-O3 \ 
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>            MPICHLIB_CXXFLAGS=-O3 \ 
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>            MPICHLIB_FCFLAGS=-O3
</span></code></pre></div>
<p>第二种：This will cause the MPICH libraries to be built with -O3, and -O3 will not be included in the mpicc and other MPI wrapper script</p>
<h4 id="process-manger">Process Manger<a class="headerlink" href="#process-manger" title="Permanent link">&para;</a></h4>
<ul>
<li>--with-pm=hydra</li>
</ul>
<p>MPICH has been designed to work with multiple process managers; that is, although you can start MPICH jobs with mpiexec, there are different mechanisms by which your processes are started. An interface (called PMI) isolates the MPICH library code from the process manager. Currently three process managers are distributed with MPICH</p>
<ul>
<li>hydra: This is the default process manager that natively uses the existing daemons on the system such as ssh, slurm, pbs.</li>
<li>gforker: This is a simple process manager that creates all processes on a single machine. It is useful both for debugging and for running on shared memory multiprocessors.</li>
</ul>
<p><code>–with-pm</code> Select the process manager. The default is hydra; also useful are gforker and remshell. You can build with all three process managers by specifying <code>--with-pm=hydra:gforker:remshell</code></p>
<h3 id="mpiexec-选项">mpiexec 选项<a class="headerlink" href="#mpiexec-选项" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>mpiexec -n 5 -f machinefile /path/to/build_tmp/examples/cpi
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>mpiexec -n 5 -hosts icarus3,icarus4 /path/to/build_tmp/examples/cpi
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Usage: ./mpiexec [global opts] [local opts for exec1] [exec1] [exec1 args] : [local opts for exec2] [exec2] [exec2 args] : ...
</span></code></pre></div>
<ul>
<li>可以一次运行多个 exec，参数使用 <code>:</code> 分隔</li>
<li>global opt 对所有 exec 生效<ul>
<li><code>-f {name}</code>:  file containing the host names</li>
<li><code>-hosts {host list}</code>: comma separated host list</li>
<li>Hydra specific options</li>
</ul>
</li>
<li>local opt 对单个 exec 生效<ul>
<li><code>-n/-np {value}</code>: number of processes</li>
<li><code>{exec_name} {args}</code>: executable name and arguments</li>
</ul>
</li>
</ul>
<h3 id="遇到的问题_2">遇到的问题<a class="headerlink" href="#遇到的问题_2" title="Permanent link">&para;</a></h3>
<h4 id="cluster-上执行时使用了错误的-hydra_pmi_proxy">cluster 上执行时使用了错误的 hydra_pmi_proxy<a class="headerlink" href="#cluster-上执行时使用了错误的-hydra_pmi_proxy" title="Permanent link">&para;</a></h4>
<p>自己编译的 mpich 在 cluster 上执行时报错。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>mpirun -f ~/app/machinefile.i3 -n 64 ~/build/mpich-build/examples/cpi
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>zsh:1: no such file or directory: /usr/bin/hydra_pmi_proxy
</span></code></pre></div>
<p><code>-verbose</code> 可以展示 Hydra 的详细信息（mpiexec --help 查看更多）</p>
<p>可以看到最后执行的命令，由于 <code>/usr/bin/hydra_pmi_proxy</code> 不存在，因此就报错了。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>[mpiexec@icarus4] Launch arguments: /usr/bin/ssh -x icarus3 &quot;/usr/bin/hydra_pmi_proxy&quot; --control-port icarus4:45175 --debug --rmk user --launcher ssh --demux poll --pgid 0 --retries 10 --usize -2 --pmi-port 0 --gpus-per-proc -2 --proxy-id 0
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>zsh:1: no such file or directory: /usr/bin/hydra_pmi_proxy
</span></code></pre></div>
<p>调用<code>/usr/bin/hydra_pmi_proxy</code> 而不是自己编译产生的 hydra_pmi_proxy 的·原因是，没有正确把 PATH 环境变量传递给 remote。</p>
<p>但是我已经在 zshrc 中设置了 PATH 使用编译的 mpich。发现原来是当前的 shell 没有 source bashrc/zshrc 导致的。source 后问题解决。</p>
<h4 id="ucx-version">UCX version<a class="headerlink" href="#ucx-version" title="Permanent link">&para;</a></h4>
<p>configure: error: UCX installation does not meet minimum version requirement (v1.9.0). Please upgrade your installation, or use --with-ucx=embedded</p>
<h4 id="hydra">hydra<a class="headerlink" href="#hydra" title="Permanent link">&para;</a></h4>
<p>make 时报错
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>make[4]: Entering directory &#39;/staff/fyyuan/build/mpich-4.2.2-build/src/pm/hydra&#39;
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  CCLD     mpiexec.hydra
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>/usr/bin/ld: /staff/fyyuan/build/mpich-4.2.2-build/src/pm/hydra/.libs/libhydra.a(topo_hwloc.o): in function `hwloc_get_next_obj_by_type&#39;:
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>/staff/fyyuan/build/mpich-4.2.2/modules/hwloc/include/hwloc/inlines.h:98: undefined reference to `hwloc_get_type_depth&#39;
</span></code></pre></div></p>
<p>对应的 configure
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>../mpich-4.2.2/configure --prefix=$HOME/install/mpich-4.2.2 CC=gcc CXX=g++ --disable-fortran --enable-fast=all,O3 2&gt;&amp;1 |tee tee c.log
</span></code></pre></div></p>
<h3 id="openmpi">openmpi<a class="headerlink" href="#openmpi" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.open-mpi.org/en/v5.0.x/installing-open-mpi/configure-cli-options/index.html">4.7. configure command line options — Open MPI 5.0.x documentation (open-mpi.org)</a></li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>../openmpi-4.1.4/configure --prefix=$HOME/ENV/openmpi-4.1.4 --disable-mpi-fortran CC=gcc CXX=g++
</span></code></pre></div>
<h4 id="运行选项">运行选项<a class="headerlink" href="#运行选项" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>-v verbose
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>-q quiet
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>--use-hwthread-cpus  #使用物理核作为slot数目
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>-H, -host, --host &lt;host1,host2,...,hostN&gt;
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>-hostfile, --hostfile &lt;hostfile&gt;
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>    % cat myhostfile
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>    aa slots=2
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>    bb slots=2
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    cc slots=2
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>-c, -n, --n, -np &lt;#&gt;
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>-cpus-per-proc, --cpus-per-proc &lt;#perproc&gt;
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>-bind-to-core, --bind-to-core
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>-bind-to-socket, --bind-to-socket
</span></code></pre></div>
<h4 id="遇到的问题_3">遇到的问题<a class="headerlink" href="#遇到的问题_3" title="Permanent link">&para;</a></h4>
<h5 id="run">run<a class="headerlink" href="#run" title="Permanent link">&para;</a></h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>➜  workspace mpirun -n 4 ./mpi_hello
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>--------------------------------------------------------------------------
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>By default, for Open MPI 4.0 and later, infiniband ports on a device
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>are not used by default.  The intent is to use UCX for these devices.
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>You can override this policy by setting the btl_openib_allow_ib MCA parameter
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>to true.
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>  Local host:              snode0
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>  Local adapter:           mlx5_0
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>  Local port:              1
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>--------------------------------------------------------------------------
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>--------------------------------------------------------------------------
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>WARNING: There was an error initializing an OpenFabrics device.
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>  Local host:   snode0
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>  Local device: mlx5_0
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>--------------------------------------------------------------------------
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>Hello world from processor snode0, rank 3 out of 4 processors
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>Hello world from processor snode0, rank 0 out of 4 processors
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>Hello world from processor snode0, rank 1 out of 4 processors
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>Hello world from processor snode0, rank 2 out of 4 processors
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>[snode0:2773927] 3 more processes have sent help message help-mpi-btl-openib.txt / ib port not selected
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>[snode0:2773927] Set MCA parameter &quot;orte_base_help_aggregate&quot; to 0 to see all help / error messages
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>[snode0:2773927] 3 more processes have sent help message help-mpi-btl-openib.txt / error in device init
</span></code></pre></div>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/" class="md-footer__link md-footer__link--prev" aria-label="上一页: linux 系统迁移">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                linux 系统迁移
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/" class="md-footer__link md-footer__link--next" aria-label="下一页: openwrt DNS 详解">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                openwrt DNS 详解
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TheRainstorm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>