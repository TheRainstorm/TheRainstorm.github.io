
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
      
      
      
        <link rel="canonical" href="https://yfy.cqu.ai/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/2023/09/15/2023-09-15-PVE/">
      
      
        <link rel="prev" href="../../../../../%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/">
      
      
        <link rel="next" href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>PVE - Rain 的随笔</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#安装" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Rain 的随笔" class="md-header__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rain 的随笔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PVE
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../series/" class="md-tabs__link">
        
  
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tools/" class="md-tabs__link">
        
  
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../archive/2024/" class="md-tabs__link">
          
  
  
  归档

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-tabs__link">
          
  
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Rain 的随笔" class="md-nav__button md-logo" aria-label="Rain 的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Rain 的随笔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    系列
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    工具
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    归档
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    分类
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    个人
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2--%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    博客 &amp; 网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    学习笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    折腾记录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    课程笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    软件工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    阅读
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2023-09-15 20:31:00+00:00" class="md-ellipsis">2023年9月15日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../../category/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/">软件工具</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 56 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#安装" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
    <nav class="md-nav" aria-label="安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pve-配置" class="md-nav__link">
    <span class="md-ellipsis">
      PVE 配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PVE 配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#网络配置" class="md-nav__link">
    <span class="md-ellipsis">
      网络配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interfaces配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      interfaces配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常见网络模式" class="md-nav__link">
    <span class="md-ellipsis">
      常见网络模式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="常见网络模式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bridge" class="md-nav__link">
    <span class="md-ellipsis">
      bridge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routed" class="md-nav__link">
    <span class="md-ellipsis">
      routed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#masqueue" class="md-nav__link">
    <span class="md-ellipsis">
      masqueue
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6相关" class="md-nav__link">
    <span class="md-ellipsis">
      ipv6相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ipv6相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6无法获得地址" class="md-nav__link">
    <span class="md-ellipsis">
      ipv6无法获得地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#禁用-vmbr0-ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      禁用 vmbr0 ipv6
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#手动添加路由" class="md-nav__link">
    <span class="md-ellipsis">
      手动添加路由
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#网络配置-vlannew" class="md-nav__link">
    <span class="md-ellipsis">
      网络配置-vlan（new）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络配置-vlan（new）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pve-几种-vlan-配置方式" class="md-nav__link">
    <span class="md-ellipsis">
      pve 几种 vlan 配置方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tunk-port-和-access-port" class="md-nav__link">
    <span class="md-ellipsis">
      tunk port 和 access port
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#想要实现的效果" class="md-nav__link">
    <span class="md-ellipsis">
      想要实现的效果
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ifupdown-配置" class="md-nav__link">
    <span class="md-ellipsis">
      ifupdown 配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bridge-命令配置" class="md-nav__link">
    <span class="md-ellipsis">
      bridge 命令配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#网络配置-vlan" class="md-nav__link">
    <span class="md-ellipsis">
      网络配置-vlan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络配置-vlan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#旧笔记本pve单网口实现openwrt软路由实例" class="md-nav__link">
    <span class="md-ellipsis">
      旧笔记本PVE单网口，实现openwrt软路由实例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#配置文件" class="md-nav__link">
    <span class="md-ellipsis">
      配置文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#存储配置" class="md-nav__link">
    <span class="md-ellipsis">
      存储配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="存储配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#基础概念" class="md-nav__link">
    <span class="md-ellipsis">
      基础概念
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#配置文件_1" class="md-nav__link">
    <span class="md-ellipsis">
      配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#命令行工具" class="md-nav__link">
    <span class="md-ellipsis">
      命令行工具
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#不同-backend" class="md-nav__link">
    <span class="md-ellipsis">
      不同 backend
    </span>
  </a>
  
    <nav class="md-nav" aria-label="不同 backend">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dir" class="md-nav__link">
    <span class="md-ellipsis">
      dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zfs" class="md-nav__link">
    <span class="md-ellipsis">
      zfs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lvm" class="md-nav__link">
    <span class="md-ellipsis">
      lvm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lvm-thin" class="md-nav__link">
    <span class="md-ellipsis">
      lvm-thin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#证书管理" class="md-nav__link">
    <span class="md-ellipsis">
      证书管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="证书管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trusted-certificates-via-lets-encrypt-acme" class="md-nav__link">
    <span class="md-ellipsis">
      Trusted certificates via Let’s Encrypt (ACME)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootloader" class="md-nav__link">
    <span class="md-ellipsis">
      Bootloader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bootloader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#支持的两个引导程序" class="md-nav__link">
    <span class="md-ellipsis">
      支持的两个引导程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub-配置" class="md-nav__link">
    <span class="md-ellipsis">
      grub 配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-boot-配置" class="md-nav__link">
    <span class="md-ellipsis">
      systemd-boot 配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#其它" class="md-nav__link">
    <span class="md-ellipsis">
      其它
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其它">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startupboot-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      startup/boot scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#开机键" class="md-nav__link">
    <span class="md-ellipsis">
      开机键
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#虚拟机" class="md-nav__link">
    <span class="md-ellipsis">
      虚拟机
    </span>
  </a>
  
    <nav class="md-nav" aria-label="虚拟机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#命令行-qm" class="md-nav__link">
    <span class="md-ellipsis">
      命令行 qm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#直通磁盘" class="md-nav__link">
    <span class="md-ellipsis">
      直通磁盘
    </span>
  </a>
  
    <nav class="md-nav" aria-label="直通磁盘">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#直通分区" class="md-nav__link">
    <span class="md-ellipsis">
      直通分区
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#显示设备" class="md-nav__link">
    <span class="md-ellipsis">
      显示设备
    </span>
  </a>
  
    <nav class="md-nav" aria-label="显示设备">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#介绍" class="md-nav__link">
    <span class="md-ellipsis">
      介绍
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virgl" class="md-nav__link">
    <span class="md-ellipsis">
      virgl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#隐藏-kvm" class="md-nav__link">
    <span class="md-ellipsis">
      隐藏 KVM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建-openwrt-实例" class="md-nav__link">
    <span class="md-ellipsis">
      创建 openwrt 实例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="创建 openwrt 实例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-existing-disk-image" class="md-nav__link">
    <span class="md-ellipsis">
      import existing disk image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uefi-无法启动" class="md-nav__link">
    <span class="md-ellipsis">
      uefi 无法启动
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lxc-容器" class="md-nav__link">
    <span class="md-ellipsis">
      LXC 容器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LXC 容器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#容器镜像" class="md-nav__link">
    <span class="md-ellipsis">
      容器镜像
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pct-命令行" class="md-nav__link">
    <span class="md-ellipsis">
      PCT 命令行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PCT 命令行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-修改-hostname" class="md-nav__link">
    <span class="md-ellipsis">
      set 修改 hostname
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ummanged-os" class="md-nav__link">
    <span class="md-ellipsis">
      ummanged OS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#配置文件_2" class="md-nav__link">
    <span class="md-ellipsis">
      配置文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#特权容器" class="md-nav__link">
    <span class="md-ellipsis">
      特权容器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="特权容器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#特权容器转非特权容器" class="md-nav__link">
    <span class="md-ellipsis">
      特权容器转非特权容器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#路径映射挂载" class="md-nav__link">
    <span class="md-ellipsis">
      路径映射（挂载）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="路径映射（挂载）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#用户映射" class="md-nav__link">
    <span class="md-ellipsis">
      用户映射
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#添加-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      添加 gpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openwrt" class="md-nav__link">
    <span class="md-ellipsis">
      openwrt
    </span>
  </a>
  
    <nav class="md-nav" aria-label="openwrt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#非特权容器开启权限" class="md-nav__link">
    <span class="md-ellipsis">
      非特权容器开启权限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rootfs-获取" class="md-nav__link">
    <span class="md-ellipsis">
      rootfs 获取
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#创建lxc-容器" class="md-nav__link">
    <span class="md-ellipsis">
      创建LXC 容器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pppoe-的坑" class="md-nav__link">
    <span class="md-ellipsis">
      pppoe 的坑
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pppoe 的坑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#调试过程" class="md-nav__link">
    <span class="md-ellipsis">
      调试过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遇到问题" class="md-nav__link">
    <span class="md-ellipsis">
      遇到问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openwrt-pppoe-no_kernel_support" class="md-nav__link">
    <span class="md-ellipsis">
      openwrt pppoe NO_KERNEL_SUPPORT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#无法修改-ssh-端口固定为-22" class="md-nav__link">
    <span class="md-ellipsis">
      无法修改 ssh 端口，固定为 22
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#备份和恢复" class="md-nav__link">
    <span class="md-ellipsis">
      备份和恢复
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#性能优化" class="md-nav__link">
    <span class="md-ellipsis">
      性能优化
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pve显卡直通" class="md-nav__link">
    <span class="md-ellipsis">
      PVE显卡直通
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PVE显卡直通">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#步骤" class="md-nav__link">
    <span class="md-ellipsis">
      步骤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#修改内核参数" class="md-nav__link">
    <span class="md-ellipsis">
      修改内核参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-module" class="md-nav__link">
    <span class="md-ellipsis">
      kernel module
    </span>
  </a>
  
    <nav class="md-nav" aria-label="kernel module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#设置尽早加载" class="md-nav__link">
    <span class="md-ellipsis">
      设置尽早加载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#设置模块参数" class="md-nav__link">
    <span class="md-ellipsis">
      设置模块参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#更新initramfs" class="md-nav__link">
    <span class="md-ellipsis">
      更新initramfs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acs-override" class="md-nav__link">
    <span class="md-ellipsis">
      ACS override
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#遇到的问题" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#boot-gpu直通问题" class="md-nav__link">
    <span class="md-ellipsis">
      boot gpu直通问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amd-6500xt-43错误bios关闭resizable-bar" class="md-nav__link">
    <span class="md-ellipsis">
      amd 6500xt 43错误（BIOS关闭resizable BAR）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows随机蓝屏bosd修改cpu-x86-v3" class="md-nav__link">
    <span class="md-ellipsis">
      windows随机蓝屏BOSD（修改cpu x86-v3）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43错误总结" class="md-nav__link">
    <span class="md-ellipsis">
      43错误总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#直通-ax200-没有蓝牙解决" class="md-nav__link">
    <span class="md-ellipsis">
      直通 AX200 没有蓝牙（解决）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#显卡不能连接多显示器" class="md-nav__link">
    <span class="md-ellipsis">
      显卡不能连接多显示器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#参考资料" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
    <nav class="md-nav" aria-label="参考资料">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gentoo-wiki" class="md-nav__link">
    <span class="md-ellipsis">
      gentoo wiki
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redhat" class="md-nav__link">
    <span class="md-ellipsis">
      redhat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qemu-参数与隐藏虚拟化" class="md-nav__link">
    <span class="md-ellipsis">
      qemu 参数与隐藏虚拟化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="qemu 参数与隐藏虚拟化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参考资料_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qemu-参数研究" class="md-nav__link">
    <span class="md-ellipsis">
      qemu 参数研究
    </span>
  </a>
  
    <nav class="md-nav" aria-label="qemu 参数研究">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-type" class="md-nav__link">
    <span class="md-ellipsis">
      cpu type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hyper-v-enlightenments" class="md-nav__link">
    <span class="md-ellipsis">
      Hyper-V Enlightenments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#让-windows-任务管理器不显示虚拟机最小配置" class="md-nav__link">
    <span class="md-ellipsis">
      让 windows 任务管理器不显示虚拟机最小配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#调节-qemu--cpu-参数" class="md-nav__link">
    <span class="md-ellipsis">
      调节 qemu -cpu 参数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调节 qemu -cpu 参数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#游戏例子" class="md-nav__link">
    <span class="md-ellipsis">
      游戏例子
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pve-anti-cheat-项目" class="md-nav__link">
    <span class="md-ellipsis">
      pve-anti-cheat 项目
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#其它问题" class="md-nav__link">
    <span class="md-ellipsis">
      其它问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其它问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#修改-hostname-寄" class="md-nav__link">
    <span class="md-ellipsis">
      修改 hostname 寄
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#备份单个-disk" class="md-nav__link">
    <span class="md-ellipsis">
      备份单个 disk
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zerotier-无法启动" class="md-nav__link">
    <span class="md-ellipsis">
      zerotier 无法启动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#磁盘测速" class="md-nav__link">
    <span class="md-ellipsis">
      磁盘测速
    </span>
  </a>
  
    <nav class="md-nav" aria-label="磁盘测速">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pcie40-爱国者-2t" class="md-nav__link">
    <span class="md-ellipsis">
      pcie4.0 爱国者 2T
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#三星-981at" class="md-nav__link">
    <span class="md-ellipsis">
      三星 981at
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n5105-铠侠-rc20-500gb" class="md-nav__link">
    <span class="md-ellipsis">
      n5105 铠侠 rc20 500GB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pci-subvendor-id" class="md-nav__link">
    <span class="md-ellipsis">
      pci subvendor id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-时间为-1970" class="md-nav__link">
    <span class="md-ellipsis">
      summary 时间为 1970
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#引导修复" class="md-nav__link">
    <span class="md-ellipsis">
      引导修复
    </span>
  </a>
  
    <nav class="md-nav" aria-label="引导修复">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lvm_1" class="md-nav__link">
    <span class="md-ellipsis">
      lvm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zfs_1" class="md-nav__link">
    <span class="md-ellipsis">
      zfs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#换主板后的一大堆问题" class="md-nav__link">
    <span class="md-ellipsis">
      换主板后的一大堆问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="换主板后的一大堆问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#识别不到启动项" class="md-nav__link">
    <span class="md-ellipsis">
      识别不到启动项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#显卡直通进不了系统" class="md-nav__link">
    <span class="md-ellipsis">
      显卡直通进不了系统
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-磁盘扩充" class="md-nav__link">
    <span class="md-ellipsis">
      windows 磁盘扩充
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows-guest-agent-not-running" class="md-nav__link">
    <span class="md-ellipsis">
      windows guest agent not running
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smartd-发邮件" class="md-nav__link">
    <span class="md-ellipsis">
      Smartd 发邮件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <a href="../../../../../tags/#tag:pve" class="md-tag">pve</a>
      
    
      
      
      
        <a href="../../../../../tags/#tag:虚拟化" class="md-tag">虚拟化</a>
      
    
  </nav>



  <h1>PVE</h1>

<p>PVE 用法、配置个人记录</p>
<!-- more -->

<h2 id="安装">安装<a class="headerlink" href="#安装" title="Permanent link">&para;</a></h2>
<p>安装注意事项</p>
<ul>
<li>之后修改 hostname 很麻烦，因此一开始就确定好</li>
<li>zfs 是我比较推荐的系统盘格式，后面创建虚拟机，lxc 容器，磁盘镜像都会直接使用 zfs 的 zvol 功能，因此可以使用 zfs 自己管理这些磁盘镜像，非常方便。</li>
</ul>
<p>换源：<a href="http://mirrors.ustc.edu.cn/help/proxmox.html">Proxmox 源使用帮助 — USTC Mirror Help 文档</a></p>
<p>常用命令工具：<a href="https://pve.proxmox.com/wiki/Command_Line_Tools">Command Line Tools - Proxmox VE</a></p>
<h4 id="_1"><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<h2 id="pve-配置">PVE 配置<a class="headerlink" href="#pve-配置" title="Permanent link">&para;</a></h2>
<h3 id="网络配置">网络配置<a class="headerlink" href="#网络配置" title="Permanent link">&para;</a></h3>
<p>PVE使用ifupdown2进行网络设置，配置文件位于<code>/etc/network/interfaces</code></p>
<ul>
<li>修改配置文件后，应用更改：<code>ifreload -a</code>
使用GUI设置，apply后自动应用更改</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>/etc/network/interfaces
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>ifreload -a  # 应用更改
</span></code></pre></div>
<h4 id="interfaces配置文件">interfaces配置文件<a class="headerlink" href="#interfaces配置文件" title="Permanent link">&para;</a></h4>
<p>man interfaces(5)</p>
<ul>
<li>auto<ul>
<li>"<strong>auto</strong>" are used to identify the physical interfaces to be brought up when ifup is run with the -a option.</li>
<li>"<strong>allow-</strong>" are used to identify interfaces that should be brought up automatically by various subsystems. This may be done using a command such as "ifup --allow=hotplug  eth0 eth1", which will only bring up eth0 or eth1 if it is listed in an "allow-hotplug" line</li>
</ul>
</li>
<li>iface<ul>
<li>iface is normally given a interface name as its first non-option argument</li>
</ul>
</li>
<li>inet/inet6 + method<ul>
<li>默认：inet/inet6 and static</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>inet or inet6
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>loopback   //This method may be used to define the loopback interface
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a> static    //define ethernet interfaces with statically allocated addresses
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a> dhcp      //This method may be used to obtain an address via DHCP
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>inet6
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a> auto    //This method may be used to obtain an address via SLAAC.
</span></code></pre></div>
<ul>
<li>Additional interface options/attributes can be given on subsequent lines in the iface stanza</li>
</ul>
<h4 id="常见网络模式">常见网络模式<a class="headerlink" href="#常见网络模式" title="Permanent link">&para;</a></h4>
<h5 id="bridge">bridge<a class="headerlink" href="#bridge" title="Permanent link">&para;</a></h5>
<ul>
<li>pve作为一个交换机，pve host和VMs 和外部 物理网络位于一个LAN</li>
</ul>
<p>The <strong>Bridged</strong> model makes the most sense in this case, and this is also the default mode on new Proxmox VE installations. Each of your Guest system will have a virtual interface attached to the Proxmox VE bridge. This is similar in effect to having the Guest network card directly connected to a new switch on your LAN, the Proxmox VE host playing the role of the switch.</p>
<h5 id="routed">routed<a class="headerlink" href="#routed" title="Permanent link">&para;</a></h5>
<ul>
<li>运行商可能不允许同一个物理接口有多个MAC上网。
Most hosting providers do not support the above setup. For security reasons, they disable networking as soon as they detect multiple MAC addresses on a single interface.</li>
</ul>
<h5 id="masqueue">masqueue<a class="headerlink" href="#masqueue" title="Permanent link">&para;</a></h5>
<ul>
<li>VM通过PVE上网</li>
</ul>
<h4 id="ipv6相关">ipv6相关<a class="headerlink" href="#ipv6相关" title="Permanent link">&para;</a></h4>
<h5 id="ipv6无法获得地址">ipv6无法获得地址<a class="headerlink" href="#ipv6无法获得地址" title="Permanent link">&para;</a></h5>
<p><a href="https://github.com/CumulusNetworks/ifupdown2/issues/178">IPv6 Slaac not working · Issue #178 · CumulusNetworks/ifupdown2 (github.com)</a>
添加pre-up行才能够获得ipv6地址</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>auto vmbr0
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>iface vmbr0 inet dhcp
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        bridge-ports enp2s0
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        bridge-stp off
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        bridge-fd 0
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        pre-up echo 2 &gt; /proc/sys/net/ipv6/conf/$IFACE/accept_ra
</span></code></pre></div>
<p>刚开始pve iface enp2s0 inet dhcp无法获得ipv4地址。开启bridge-stp on就可以了
发现还是不行，需要将bridge-fd从0改为更大的值（比如15），才可以
vmbr0: the has_elasticity option has been deprecated and is always 16</p>
<h5 id="禁用-vmbr0-ipv6">禁用 vmbr0 ipv6<a class="headerlink" href="#禁用-vmbr0-ipv6" title="Permanent link">&para;</a></h5>
<p>vmbr0 用于软路由的 wan 口，pve host 自身并不想直接暴露在公网。然而 pve 却总是给 vmbr0 设置 ipv6 地址，即使 vmbr0 配置如下，仍然禁用不掉 ipv6。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a># /etc/network/interfaces
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>auto vmbr0
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>iface vmbr0 inet6 manual
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>iface vmbr0 inet manual
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        bridge-ports enp2s0
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        bridge-stp off
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        bridge-fd 0
</span></code></pre></div>
<p>解决办法为设置 sysctl.conf</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a># /etc/sysctl.d/1-vmbr0-v6.conf
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>net.ipv6.conf.vmbr0.disable_ipv6=1
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>sysctl -p /etc/sysctl.d/1-vmbr0-v6.conf
</span></code></pre></div>
<p>也可以不完全禁用 v6，保留 fe80 地址</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>net.ipv6.conf.vmbr0.disable_ipv6=0
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>net.ipv6.conf.vmbr0.autoconf=0
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>net.ipv6.conf.all.autoconf=0  # 好像也需要把all关了，否则会被覆盖
</span></code></pre></div>
<p>检查是否生效</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>cat /proc/sys/net/ipv6/conf/vmbr0/autoconf
</span></code></pre></div>
<p>参考</p>
<ul>
<li><a href="https://docs.kernel.org/networking/ipv6.html">IPv6 — The Linux Kernel documentation</a></li>
</ul>
<h4 id="手动添加路由">手动添加路由<a class="headerlink" href="#手动添加路由" title="Permanent link">&para;</a></h4>
<p>创建两个 br，居然不支持设置两个 default route。解决办法是在 interface 配置文件中通过 post-up 自己添加</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>auto vmbr0
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>iface vmbr0 inet static
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        address 210.45.76.204/24
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        bridge-ports enp7s0
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>        bridge-stp off
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>        bridge-fd 0
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        post-up ip ru add from 210.45.76.204 lookup vmbr0 prior 3
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        post-up ip ro add table vmbr0 default via 210.45.76.254 dev vmbr0
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        post-up ip ro add default via 210.45.76.254 dev vmbr0 metric 200
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>auto vmbr1
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>iface vmbr1 inet static
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>        address 192.168.35.254/24
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        bridge-ports enxf8e43b0a274a
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        bridge-stp off
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        bridge-fd 0
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        post-up ip ro add default via 192.168.35.1 dev vmbr1 metric 100
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        pre-down ip ro del default dev vmbr1
</span></code></pre></div>
<h3 id="网络配置-vlannew">网络配置-vlan（new）<a class="headerlink" href="#网络配置-vlannew" title="Permanent link">&para;</a></h3>
<h4 id="pve-几种-vlan-配置方式">pve 几种 vlan 配置方式<a class="headerlink" href="#pve-几种-vlan-配置方式" title="Permanent link">&para;</a></h4>
<p><a href="https://pve.proxmox.com/pve-docs/chapter-sysadmin.html#sysadmin_network_vlan">Host System Administration (proxmox.com)</a></p>
<ul>
<li>vlan awarensess on linux bridge<ul>
<li>创建 VM 网卡时指定 vid，虚拟机不需要知道自己连接在 vlan 上。最无感的方式</li>
</ul>
</li>
<li>tranditional： eno1.5 and vmbr0v5<ul>
<li>需要显示地创建多个网卡</li>
</ul>
</li>
<li>guest configured vlan<ul>
<li>在虚拟机内部创建 vlan</li>
</ul>
</li>
</ul>
<p>vlan awareness 方式理解</p>
<ul>
<li>untagged 和 tag 表示<strong>发出</strong>该 vlan 包时是否 打上 tag。</li>
<li>primary id，表示<strong>收到</strong>包时如果没有 vlan id，应该判定为哪个 vlan。</li>
</ul>
<h4 id="tunk-port-和-access-port">tunk port 和 access port<a class="headerlink" href="#tunk-port-和-access-port" title="Permanent link">&para;</a></h4>
<p>tunk 的特点就是复用端口（tg 里大佬认为全 tag 和 tag + untag 都是 trunk）</p>
<p><a href="https://www.n-able.com/blog/vlan-trunking#:~:text=What%20is%20the%20difference%20between%20an%20access%20port%20and%20a%20trunk%20port%3F%C2%A0">https://www.n-able.com/blog/vlan-trunking#:~:text=What%20is%20the%20difference%20between%20an%20access%20port%20and%20a%20trunk%20port%3F%C2%A0</a></p>
<ul>
<li>accessing port 被完全分配给单个 vlan，tagged 流量被丢弃（理解：untagged，并且没有其它 tagged？）</li>
<li>trunk port。a trunk port can transmit data from multiple VLANs.</li>
</ul>
<h4 id="想要实现的效果">想要实现的效果<a class="headerlink" href="#想要实现的效果" title="Permanent link">&para;</a></h4>
<p>问问有大佬知道 pve 的 vlan awareness bridge 怎么配置 untagged 和 primary vlan id 吗？我想实现的就是两个机器通过一根线连接，传输 vlan 10 和 vlan 20 的数据。</p>
<ul>
<li>如果端口上收到的包没有 tag，那么就属于 vlan 10，vlan 10 发出去的包也应该是 untagged的。</li>
<li>对于 vlan 20，则需要收发都带上 tag。</li>
</ul>
<p><img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20240509173603.png" />
这是我 pve 对端的设备，我想实现的其实是左侧的效果。但是目前只能连接右面这个。因为 pve 不知道怎么设置 untagged，这导致它的包都是有 tag 的，没法直接连接笔记本等设备？</p>
<p>看了 bridge vlan show 后，感觉 PVID 和 untagged 的是强绑定的。<strong>因为 pvid 和 untagged 分别对应收和发</strong>，只有是同一个 vlan 才不容易造成混淆。</p>
<p>上图中，左右两侧都设置了 pvid 为 10，那么这个端口无论接收什么样的包都是没问题的。（有 tag 的包可以直接区分 vlan，没有 tag 的判定为 pvid）。但是发送情况则不同，untagged 情况需要对面也设置 pvid 为 10，否则对面可能判定为默认的 pvid=1。好处是可以连接非 vlan 设备（比如笔记本、手机）。tag 情况，则对面不需要设置 pvid，缺点是只能连接开启 vlan 的设备。</p>
<p>总结</p>
<ul>
<li><strong>全 tag 适合连接两个 vlan 设备。不用设置 pvid</strong></li>
<li><strong>untagged + pvid 适合连接普通设备</strong>。但是要想连接 vlan 设备，需要对面也设置 pvid 相同</li>
</ul>
<p>注意到 vlan 的接口的 mac 地址都是相同的，这样会有问题吗？（答：vlan 隔离了，所以没有问题）</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>13: vmbr1.10@vmbr1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    link/ether 7c:2b:e1:13:7e:10 brd ff:ff:ff:ff:ff:ff
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>14: vmbr1.20@vmbr1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    link/ether 7c:2b:e1:13:7e:10 brd ff:ff:ff:ff:ff:ff
</span></code></pre></div>
<h4 id="ifupdown-配置">ifupdown 配置<a class="headerlink" href="#ifupdown-配置" title="Permanent link">&para;</a></h4>
<p><code>man ifupdown-addons-interfaces</code> bridge 部分说明：</p>
<blockquote>
<p>Supports both vlan aware and non vlan aware bridges. For the vlan aware bridge, the port specific attributes must be specified under the port. And for vlan unaware bridge port specific attributes must be specified under the bridge.</p>
</blockquote>
<p>也就是 port 相关的属性（如 enp2s0 的 pvid）需要定义在 port 的配置中，而不是定义在 bridge 的配置中。</p>
<p>可以定义 bridge 支持的 vlan id</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>bridge-vids
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  help: bridge port vids. Can be specified under the bridge or under the port. If specified under the bridge the ports inh erit it unless overridden by a bridge-vids attribuet under the port
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>  required: False
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>  example:
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    bridge-vids 4000
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    bridge-vids 2000 2200-3000
</span></code></pre></div>
<p><strong>可以为每个端口设置 pvid</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>bridge-pvid
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  help: bridge port pvid. Must be specified under the bridge port
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>  required: False
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>  example:
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    bridge-pvid 1
</span></code></pre></div>
<p>没有找到如何定义端口是否 untagged，相反 bridge 一条命令就可以做这两件事，更加方便直观</p>
<h4 id="bridge-命令配置">bridge 命令配置<a class="headerlink" href="#bridge-命令配置" title="Permanent link">&para;</a></h4>
<p><a href="https://unix.stackexchange.com/questions/769448/how-to-create-a-linux-vlan-aware-bridge-with-ingress-packets-untagged-and-egress">networking - How to create a linux vlan aware bridge with ingress packets untagged and egress packets tagged - Unix &amp; Linux Stack Exchange</a></p>
<p>貌似使用 bridge 命令设置更方便？</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>bridge vlan { add | del } dev DEV vid VID [ tunnel_info TUNNEL_ID ] [ pvid ] [ untagged ] [ self ] [ master ]
</span></code></pre></div>
<p>bridge vlan show 非常直观可以看到每个端口的状态</p>
<ul>
<li>对于 vmbr0<ul>
<li>连接了虚拟机 op2 的端口 0（veth100i0）和物理接口 enp2s0</li>
<li>由于不需要 vlan 划分，因此对应端口都是 1 PVID 和 Untagged</li>
</ul>
</li>
<li>对于 vmbr1<ul>
<li>连接了 3 个物理接口和虚拟机 lan1 和 lan2 两个接口</li>
<li>由于 vlan awarensess bridge 的特点就是对虚拟机不可见，因此可以看到所有 veth100ix 的端口都是以自己所在的 vid 为 PVID 并且是 untagged 的。</li>
</ul>
</li>
</ul>
<p>比较神奇的是，物理接口都保留了 vid 1，并且是 untagged。理论上一个 port 是不能有两个 untagged 的。另外，vmbr0 不是实际端口，因此不清楚这里 vmbr0, vmbr1 的输出表示什么。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>root@n5105-pve ➜  ~ brctl show
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>bridge name     bridge id               STP enabled     interfaces
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>vmbr0           8000.7c2be1137e0f       no              enp2s0
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>                                                        veth100i0
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>vmbr1           8000.7c2be1137e10       no              enp3s0
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>                                                        enp4s0
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>                                                        enp5s0
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>                                                        veth100i1
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>                                                        veth100i2
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>root@n5105-pve ➜  ~ bridge vlan show
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>port              vlan-id
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>enp2s0            1 PVID Egress Untagged
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>enp3s0            1 Egress Untagged
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>                  10 PVID Egress Untagged
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>                  20
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>                  99
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>enp4s0            1 Egress Untagged
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>                  10 PVID Egress Untagged
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>                  20
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>                  99
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>enp5s0            1 Egress Untagged
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>                  10 PVID Egress Untagged
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>                  20
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>                  99
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>vmbr0             1 PVID Egress Untagged
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>vmbr1             1 PVID Egress Untagged
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>                  10
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>                  20
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>                  99
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>veth100i0         1 PVID Egress Untagged
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>veth100i1         10 PVID Egress Untagged
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>veth100i2         20 PVID Egress Untagged
</span></code></pre></div>
<p>贴下配置
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>auto vmbr0
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>iface vmbr0 inet6 manual
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>iface vmbr0 inet manual
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>        bridge-ports enp2s0
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        bridge-stp off
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        bridge-fd 0
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>#wan
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>auto vmbr1.10
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>iface vmbr1.10 inet6 auto
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>iface vmbr1.10 inet static
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        address 192.168.36.254/24
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        gateway 192.168.36.1
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>auto vmbr1.20
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>iface vmbr1.20 inet dhcp
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>auto vmbr1.99
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>iface vmbr1.99 inet static
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>        address 192.168.99.1/24
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>auto vmbr1
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>iface vmbr1 inet manual
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>        bridge-ports enp3s0 enp4s0 enp5s0
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>        bridge-stp off
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>        bridge-fd 0
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>        bridge-vlan-aware yes
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>        bridge-vids 10 20 99
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>        post-up   bridge vlan add vid 10 dev enp3s0 pvid untagged
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>        post-up   bridge vlan add vid 10 dev enp4s0 pvid untagged
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>        post-up   bridge vlan add vid 10 dev enp5s0 pvid untagged
</span></code></pre></div></p>
<h3 id="网络配置-vlan">网络配置-vlan<a class="headerlink" href="#网络配置-vlan" title="Permanent link">&para;</a></h3>
<p><a href="https://www.virtualizationhowto.com/2022/09/proxmox-management-interface-vlan-tagging-configuration/">Proxmox Management Interface VLAN tagging configuration - Virtualization Howto</a></p>
<p>两种模式，推荐使用第一种，最简洁</p>
<ul>
<li><strong>VLAN awareness on the Linux bridge</strong><ul>
<li>in this case, each guest’s virtual network card is assigned to a VLAN tag, which is transparently supported by the Linux bridge. Trunk mode is also possible, but that makes configuration in the guest necessary.</li>
</ul>
</li>
<li>traditional” VLAN on the Linux bridge<ul>
<li>creates a VLAN device with associated bridge for each VLAN</li>
</ul>
</li>
<li>Guest configured VLAN<ul>
<li>VLANs are assigned inside the guest. In this case, the setup is completely done inside the guest and can not be influenced from the outside. The benefit is that you can use <strong>more than one VLAN on a single virtual NIC</strong>.</li>
</ul>
</li>
</ul>
<ol>
<li>vmbr0, vlan aware</li>
<li>连接pve的物理交换机（假如有）需要设置成trunk port，这样才能理解tag包</li>
<li>虚拟机设置vlan tag就会加入该vlan。Once we have made the default Linux bridge VLAN aware, virtual machines can also have a VLAN tag associated with their network configuration. It allows the virtual machine to tag VLAN traffic and be placed on that particular VLAN. When you create VMs, you can choose to tag the network traffic with a VLAN ID. <strong>This allows sending the virtual machine traffic</strong> through the physical device VLAN interface to the rest of the physical network.</li>
</ol>
<h4 id="旧笔记本pve单网口实现openwrt软路由实例">旧笔记本PVE单网口，实现openwrt软路由实例<a class="headerlink" href="#旧笔记本pve单网口实现openwrt软路由实例" title="Permanent link">&para;</a></h4>
<p>补图</p>
<p>单网口软路由起码得有两个vlan，一个用于容器openwrt wan，一个用于容器openwrt lan。lan还包括pve host，和pve 下的VM</p>
<p>由于是通过vlan实现单网口软路由。笔记本（用于配置pve）要访问pve，还要访问pve里的虚拟机实在有点不方便。因此配置需要保证一定的顺序，否则就会出现访问不了pve的尴尬局面（还好我的pve还有一个100M的网口，最差情况还能抢救一下）</p>
<ul>
<li>把硬路由器的VLAN设置好（软路由至少需要2个vlan，一个用作wan，一个用作lan）<ul>
<li>硬路由上一个接口（如wan口）用于管理，这样避免访问不了硬路由</li>
<li>另一个接口br-lan.200设置一个静态ip（即软路由lan的网段），虽然可以设置成dhcp client，软路由配置好后自动设置地址，但是静态ip能方便访问硬路由。</li>
</ul>
</li>
<li>给pve host分配一个lan vlan的ip<ul>
<li>可以创建vmbr.200，然后静态分配ip</li>
<li><img alt="" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230717214441.png" /></li>
</ul>
</li>
</ul>
<ul>
<li>连接硬路由和pve的单网口<ul>
<li>这样至少保证能通过硬路由访问pve了（比如笔记本连接硬路由的wifi，由于op虚拟机还没配置好，所以需要连接后手动设置ip）</li>
</ul>
</li>
<li>设置openwrt容器<ul>
<li>添加两个网络设备，可以选择同一个bridge，选择硬路由设置的vlan id。</li>
<li>这里添加额外一个vmbr2，是因为如果eth1没有成功设置ip地址，pve还是无法访问op容器。因此可以添加一个bridge，专门用于连接pve和op容器。用完之后可以删除。
<img alt="" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20230717214456.png" /></li>
</ul>
</li>
</ul>
<ul>
<li>启动openwrt容器<ul>
<li>通过pve web控制台，给op容器设置lan和wan的接口。（也可以通过ssh -L pve端口转发（经过上步，pve可以访问op容器），访问openwrt web进行设置）</li>
</ul>
</li>
</ul>
<ul>
<li>完成配置。软路由启动成功，应该已经可以正常工作了。pve可以上网，笔记本也可以通过硬路由wifi上网。</li>
</ul>
<h4 id="配置文件">配置文件<a class="headerlink" href="#配置文件" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>auto lo
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>iface lo inet loopback
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>iface enp2s0 inet manual
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>iface wlp3s0 inet manual
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>auto enxa0cec8dfd632
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>iface enxa0cec8dfd632 inet manual
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>auto vmbr0
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>iface vmbr0 inet dhcp
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        bridge-ports enp2s0
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        bridge-stp off
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        bridge-fd 0
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        pre-up echo 2 &gt; /proc/sys/net/ipv6/conf/$IFACE/accept_ra
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>auto vmbr1
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>iface vmbr1 inet manual
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        bridge-ports enxa0cec8dfd632
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        bridge-stp off
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        bridge-fd 0
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        bridge-vlan-aware yes
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        bridge-vids 2-4094
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>auto vmbr1.200
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>iface vmbr1.200 inet static
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        address 192.168.36.215/24
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>        gateway 192.168.36.1
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>auto vmbr2
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>iface vmbr2 inet static
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>        address 10.3.0.1/24
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>        bridge-ports none
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>        bridge-stp off
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>        bridge-fd 0
</span></code></pre></div>
<h3 id="存储配置">存储配置<a class="headerlink" href="#存储配置" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/pve-docs/chapter-pvesm.html">Proxmox VE Storage</a></p>
<h4 id="基础概念">基础概念<a class="headerlink" href="#基础概念" title="Permanent link">&para;</a></h4>
<p>storage（池）类型</p>
<ul>
<li>file level：可以存储任何类型内容</li>
<li>block：存储大的 raw images</li>
</ul>
<blockquote>
<p>1: Disk images for VMs are stored in ZFS volume (zvol) datasets, which provide block device functionality.
2: On file based storages, snapshots are possible with the <em>qcow2</em> format.</p>
</blockquote>
<p>存储的数据类型</p>
<p>A storage can support several content types, for example virtual disk images, cdrom iso images, container templates or container root directories. Not all storage types support all content types. One can set this property to select what this storage is used for.</p>
<ul>
<li>images: QEMU/KVM VM images.</li>
<li>rootdir: Allow to store container data.</li>
<li>vztmpl: Container templates.</li>
<li>backup: Backup files (vzdump).</li>
<li>iso: ISO images</li>
<li>snippets: Snippet files, for example guest hook scripts</li>
</ul>
<h4 id="配置文件_1">配置文件<a class="headerlink" href="#配置文件_1" title="Permanent link">&para;</a></h4>
<p>/etc/pve/storage.cfg</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>dir: local
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>        path /var/lib/vz
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        content iso,vztmpl,backup
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a># default image store on ZFS based installation
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>zfspool: local-zfs
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        pool rpool/data
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>        sparse
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>        content images,rootdir
</span></code></pre></div>
<p><strong>local 更像是存储只读的数据</strong>
<strong>local-zfs 则存放读写的数据</strong></p>
<ul>
<li>虚拟机的 disk 为 zvol</li>
<li>lxc 容器的 rootdir 为 dataset</li>
</ul>
<p>Volume id 格式（许多命令都需要该格式参数）</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>local:230/example-image.raw
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>local:iso/debian-501-amd64-netinst.iso
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>local:vztmpl/debian-5.0-joomla_1.5.9-1_i386.tar.gz
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>iscsi-storage:0.0.2.scsi-14f504e46494c4500494b5042546d2d646744372d31616d61
</span></code></pre></div>
<h4 id="命令行工具">命令行工具<a class="headerlink" href="#命令行工具" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>pvesm add &lt;TYPE&gt; &lt;STORAGE_ID&gt; &lt;OPTIONS&gt;
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>pvesm add dir &lt;STORAGE_ID&gt; --path &lt;PATH&gt;
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>pvesm add nfs &lt;STORAGE_ID&gt; --path &lt;PATH&gt; --server &lt;SERVER&gt; --export &lt;EXPORT&gt;
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>pvesm add lvm &lt;STORAGE_ID&gt; --vgname &lt;VGNAME&gt;
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>pvesm add iscsi &lt;STORAGE_ID&gt; --portal &lt;HOST[:PORT]&gt; --target &lt;TARGET&gt;
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>pvesm set &lt;STORAGE_ID&gt; &lt;OPTIONS&gt;
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>pvesm set &lt;STORAGE_ID&gt; --shared 1
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>pvesm set local --format qcow2
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>pvesm set &lt;STORAGE_ID&gt; --content iso
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>pvesm alloc &lt;STORAGE_ID&gt; &lt;VMID&gt; &lt;name&gt; &lt;size&gt; [--format &lt;raw|qcow2&gt;]
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>pvesm alloc local &lt;VMID&gt; &#39;&#39; 4G  # name为空则自动生成
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>pvesm free &lt;VOLUME_ID&gt;
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>pvesm status
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>pvesm list &lt;STORAGE_ID&gt; [--vmid &lt;VMID&gt;]
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>pvesm path &lt;VOLUME_ID&gt; #查看实际路径
</span></code></pre></div>
<h4 id="不同-backend">不同 backend<a class="headerlink" href="#不同-backend" title="Permanent link">&para;</a></h4>
<h5 id="dir">dir<a class="headerlink" href="#dir" title="Permanent link">&para;</a></h5>
<p>可以存储任何类型数据（virtual disk images, containers, templates, ISO images or backup files.）</p>
<blockquote>
<p>You can mount additional storages via standard linux /etc/fstab, and then define a directory storage for that mount point. This way you can use any file system supported by Linux.</p>
</blockquote>
<p>默认 layout</p>
<table>
<thead>
<tr>
<th>Content type</th>
<th>Subdir</th>
</tr>
</thead>
<tbody>
<tr>
<td>VM images</td>
<td><code>images/&lt;VMID&gt;/</code></td>
</tr>
<tr>
<td>ISO images</td>
<td>template/iso/</td>
</tr>
<tr>
<td>Container templates</td>
<td>template/cache/</td>
</tr>
<tr>
<td>Backup files</td>
<td>dump/</td>
</tr>
<tr>
<td>Snippets</td>
<td>snippets/</td>
</tr>
</tbody>
</table>
<p>例子</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>dir: backup
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>        path /mnt/backup
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>        content backup
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>        prune-backups keep-last=7
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>        max-protected-backups 3
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>        content-dirs backup=custom/backup/dir
</span></code></pre></div>
<h5 id="zfs">zfs<a class="headerlink" href="#zfs" title="Permanent link">&para;</a></h5>
<h5 id="lvm">lvm<a class="headerlink" href="#lvm" title="Permanent link">&para;</a></h5>
<p><a href="https://pve.proxmox.com/pve-docs/chapter-pvesm.html#storage_lvm">Proxmox VE Storage</a>
<a href="https://blog.programster.org/proxmox-storage-guide">Proxmox Storage Guide | Programster's Blog</a></p>
<table>
<thead>
<tr>
<th>Content types</th>
<th>Image formats</th>
<th>Shared</th>
<th>Snapshots</th>
<th>Clones</th>
</tr>
</thead>
<tbody>
<tr>
<td>images rootdir</td>
<td>raw</td>
<td>possible</td>
<td>no</td>
<td>no</td>
</tr>
</tbody>
</table>
<h5 id="lvm-thin">lvm-thin<a class="headerlink" href="#lvm-thin" title="Permanent link">&para;</a></h5>
<p>支持 thin provisioning（稀疏分配）</p>
<p>LVM normally allocates blocks when you create a volume. LVM thin pools instead allocates blocks when they are written. This behaviour is called thin-provisioning</p>
<h3 id="证书管理">证书管理<a class="headerlink" href="#证书管理" title="Permanent link">&para;</a></h3>
<p>pve 的 REST API 和 web GUI 是由<code>pveproxy</code>服务提供的，它使用的证书可以是以下几种</p>
<ol>
<li>By default the node-specific certificate in <code>/etc/pve/nodes/NODENAME/pve-ssl.pem</code> is used. This certificate is signed by the cluster CA and therefore not automatically trusted by browsers and operating systems.</li>
<li>use an externally provided certificate (e.g. signed by a commercial CA).</li>
<li>use ACME (Let’s Encrypt) to get a trusted certificate with automatic renewal, this is also integrated in the Proxmox VE API and web interface.
在 2 和 3 的情况下，使用的证书位于<code>/etc/pve/nodes/NODENAME/pveproxy-ssl.pem</code></li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>-rw-r----- 1 root www-data 3.2K Dec  2 14:46 pveproxy-ssl.key
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>-rw-r----- 1 root www-data 5.8K Dec  2 14:46 pveproxy-ssl.pem
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>-rw-r----- 1 root www-data 1.7K Sep 13 21:04 pve-ssl.key
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>-rw-r----- 1 root www-data 1.8K Sep 13 21:04 pve-ssl.pem
</span></code></pre></div>
<p>证书使用 pvenode 命令管理</p>
<h4 id="trusted-certificates-via-lets-encrypt-acme">Trusted certificates via Let’s Encrypt (ACME)<a class="headerlink" href="#trusted-certificates-via-lets-encrypt-acme" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>首先需要注册一个 ACME 账号，仅需要提供邮箱用于接收通知</p>
<ul>
<li>web 界面：Datacenter -&gt; ACME</li>
<li>命令行</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>pvenode acme account register account-name mail@example.com
</span></code></pre></div>
</li>
</ul>
<ul>
<li>然后添加一个 ACME plugin，用于自动申请和更新证书，支持许多 dns 服务商<ul>
<li>plugin ID：自己取一个标识名称，后面为 node 申请证书时需要指定</li>
<li>DNS API：选择自己的 DNS 服务商（如果没有的话，并且有其它支持的域名的话，可以搜索 DNS Validation through CNAME Alias 方案）</li>
<li>后面的数据则根据 API 的不同是不同的<ul>
<li>cloudflare 支持粗粒度的 Global API Key 和 API Token 两种验证方式：<a href="https://dash.cloudflare.com/profile/api-tokens">User API Tokens | Cloudflare</a>
<img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20231202172323.png" /></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>然后就是为 node 添加证书<ul>
<li>Node -&gt; Certificates，ACME 选择 Add</li>
<li>选择 challenge type 并填写证书对应的域名</li>
<li>然后选择 Account 然后 Order Certificates Now 即可
<img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20231202172857.png" /></li>
</ul>
</li>
</ul>
<h3 id="bootloader">Bootloader<a class="headerlink" href="#bootloader" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/wiki/Host_Bootloader">Host Bootloader - Proxmox VE</a></p>
<p>pve 会创建三个分区</p>
<ul>
<li>1M BIOS 分区</li>
<li>512M EFI 分区（也叫 ESP 分区，EFI system partition (ESP)，通常挂载在 /efi/, /boot, 或者 /boot/efi）</li>
<li>剩余大小创建 pve 的 storage</li>
</ul>
<h4 id="支持的两个引导程序">支持的两个引导程序<a class="headerlink" href="#支持的两个引导程序" title="Permanent link">&para;</a></h4>
<ul>
<li>grub<ul>
<li>linux 事实标准</li>
<li>丰富的文档</li>
</ul>
</li>
<li>systemd-boot<ul>
<li>简单</li>
<li><strong>kernel 和 initrd 直接放在 ESP 分区</strong></li>
<li>配置也全部放在 ESP 分区 /loader</li>
</ul>
</li>
</ul>
<p><strong>PVE 对于没有安全启动的 zfs 类型采用 systemd-boot，其余使用 grub。</strong></p>
<p>查看使用的哪个引导程序</p>
<ul>
<li>pve grub 为蓝色界面，界面比较复杂。systemd-boot 为黑白界面，只有简单的 entry 选择。</li>
<li><code>efibootmgr -v</code> 可以查看所有 eif 引导项以及引导顺序。<ul>
<li><code>\EFI\UBUNTU\GRUBX64.EFI</code> 的是 grub</li>
<li><code>\EFI\SYSTEMD\SYSTEMD-BOOTX64.EFI</code> 的是 systemd-boot</li>
</ul>
</li>
</ul>
<h4 id="grub-配置">grub 配置<a class="headerlink" href="#grub-配置" title="Permanent link">&para;</a></h4>
<p><code>/etc/default/grub</code></p>
<p>通过 update-grub 将配置同步到 <code>/boot/grub/grub.cfg</code>，这也是 grub 运行时读取的配置。</p>
<p>修改 kernel cmdline</p>
<blockquote>
<p>The kernel commandline needs to be placed in the variable <code>GRUB_CMDLINE_LINUX_DEFAULT</code> in the file <code>/etc/default/grub</code>. Running <code>update-grub</code> appends its content to all linux entries in <code>/boot/grub/grub.cfg</code>.</p>
</blockquote>
<h4 id="systemd-boot-配置">systemd-boot 配置<a class="headerlink" href="#systemd-boot-配置" title="Permanent link">&para;</a></h4>
<p>位于 ESP 分区的 <code>loader/loader.conf</code>，将 ESP 挂载到 <code>/boot/efi</code> 后即 <code>/boot/efi/loader/loader.conf</code></p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>.
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>├──<span class="w"> </span>EFI
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>├──<span class="w"> </span>loader
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>│<span class="w">   </span>├──<span class="w"> </span>entries
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>proxmox-6.2.16-20-pve.conf
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>proxmox-6.5.13-1-pve.conf
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>│<span class="w">   </span>├──<span class="w"> </span>entries.srel
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>│<span class="w">   </span>├──<span class="w"> </span>loader.conf
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>│<span class="w">   </span>└──<span class="w"> </span>random-seed
</span></code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>root@ryzen-pve<span class="w"> </span>➜<span class="w">  </span>efi<span class="w"> </span>cat<span class="w"> </span>loader/entries/proxmox-6.5.13-1-pve.conf
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>title<span class="w">    </span>Proxmox<span class="w"> </span>Virtual<span class="w"> </span>Environment
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>version<span class="w">  </span><span class="m">6</span>.5.13-1-pve
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>options<span class="w">  </span><span class="nv">root</span><span class="o">=</span><span class="nv">ZFS</span><span class="o">=</span>rpool/ROOT/pve-1<span class="w"> </span><span class="nv">boot</span><span class="o">=</span>zfs<span class="w"> </span><span class="nv">amd_iommu</span><span class="o">=</span>on<span class="w"> </span><span class="nv">iommu</span><span class="o">=</span>pt<span class="w"> </span><span class="nv">pcie_acs_override</span><span class="o">=</span>multifunction
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>linux<span class="w">    </span>/EFI/proxmox/6.5.13-1-pve/vmlinuz-6.5.13-1-pve
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>initrd<span class="w">   </span>/EFI/proxmox/6.5.13-1-pve/initrd.img-6.5.13-1-pve
</span></code></pre></div>
<blockquote>
<p>The kernel commandline needs to be placed as one line in <code>/etc/kernel/cmdline</code>. To apply your changes, run <code>proxmox-boot-tool refresh</code>, which sets it as the option line for all config files in <code>loader/entries/proxmox-*.conf</code>.</p>
</blockquote>
<p><code>proxmox-boot-tool</code> 用于创建、同步 ESP 配置</p>
<blockquote>
<p>proxmox-boot-tool is a utility used to keep the contents of the EFI System Partitions properly configured and synchronized.</p>
</blockquote>
<p>可以管理多个 ESP 分区</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>proxmox-boot-tool<span class="w"> </span>status<span class="w">  </span><span class="c1">#view the currently configured ESPs and their state</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>proxmox-boot-tool<span class="w"> </span>format<span class="w"> </span>/dev/sda2
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>proxmox-boot-tool<span class="w"> </span>init<span class="w"> </span>/dev/sda2
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>proxmox-boot-tool<span class="w"> </span>init<span class="w"> </span>/dev/sda2<span class="w"> </span>grub
</span></code></pre></div>
<h3 id="其它">其它<a class="headerlink" href="#其它" title="Permanent link">&para;</a></h3>
<h4 id="startupboot-scripts">startup/boot scripts<a class="headerlink" href="#startupboot-scripts" title="Permanent link">&para;</a></h4>
<p><a href="https://forum.proxmox.com/threads/start-up-boot-script.111988/">Start-up/boot script | Proxmox Support Forum</a>
因为非特权 lxc openwrt 需要修改 /dev/ppp 权限（我直接 chmod 777），因此需要系统重启后保持。</p>
<h4 id="开机键">开机键<a class="headerlink" href="#开机键" title="Permanent link">&para;</a></h4>
<h2 id="虚拟机">虚拟机<a class="headerlink" href="#虚拟机" title="Permanent link">&para;</a></h2>
<h3 id="命令行-qm">命令行 qm<a class="headerlink" href="#命令行-qm" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/pve-docs/qm.1.html">qm(1) (proxmox.com)</a></p>
<p>不必填所有参数，创建后在 web 中再添加</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>qm create 120 --cores 2 --cpu host --memory 1024 --name u22-test --scsihw virtio-scsi-single --scsi0 local-zfs:vm-120-disk-root 
</span></code></pre></div>
<h3 id="直通磁盘">直通磁盘<a class="headerlink" href="#直通磁盘" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/wiki/Passthrough_Physical_Disk_to_Virtual_Machine_(VM)">Passthrough Physical Disk to Virtual Machine (VM) - Proxmox VE</a></p>
<p>这里的直通不是 pci 设备直通（比如网卡），host 中仍然能看到对应的磁盘，并且能够挂载。如果在 host 修改的话，可能导致数据损坏。 pci 直通是把磁盘控制器（如 nvme 控制器）直通给 VM，host 中对应磁盘驱动绑定到 vifo-pci，因此 host 看不到该磁盘。</p>
<p>这里的直通和使用虚拟镜像基本没区别，都是<strong>给虚拟机提供了一个块设备</strong>。host 将虚拟机的写入翻译到 host 中执行。</p>
<ul>
<li>Hot-Plug/Add physical device as new virtual SCSI disk</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC
</span></code></pre></div>
<ul>
<li>Hot-Unplug/Remove virtual disk</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>qm unlink 592 --idlist scsi2
</span></code></pre></div>
<h4 id="直通分区">直通分区<a class="headerlink" href="#直通分区" title="Permanent link">&para;</a></h4>
<p>只需要把上面 by-id 路径指定具体分区即可</p>
<p><a href="https://forum.proxmox.com/threads/is-it-possible-to-passthrough-a-partition-of-a-drive-to-a-vm-and-not-the-entire-disk.109974/">Is it possible to passthrough a partition of a drive to a VM? and not the entire disk? | Proxmox Support Forum</a></p>
<blockquote>
<p>I think "qm set" disk passthrough should work with partitions too:<br />
<a href="https://pve.proxmox.com/wiki/Passthrough_Physical_Disk_to_Virtual_Machine_(VM)">https://pve.proxmox.com/wiki/Passthrough_Physical_Disk_to_Virtual_Machine_(VM)</a><br />
Then its just for example <code>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC-part3</code> instead of <code>qm set 592 -scsi2 /dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F41BLC</code></p>
</blockquote>
<h3 id="显示设备">显示设备<a class="headerlink" href="#显示设备" title="Permanent link">&para;</a></h3>
<h4 id="介绍">介绍<a class="headerlink" href="#介绍" title="Permanent link">&para;</a></h4>
<p><a href="https://www.kraxel.org/blog/2019/09/display-devices-in-qemu/">VGA and other display devices in qemu | 🇺🇦 kraxel’s news</a></p>
<p>qxl</p>
<ul>
<li>支持 2d 加速，但是该功能现在已经变得不再有用了。软件通常使用 OpenGL 或 Vulkan，3d 渲染。</li>
</ul>
<blockquote>
<p>This device has support for 2D acceleration. This becomes more and more useless though as modern display devices don't have dedicated 2D acceleration support any more and use the 3D engine for everything. The same happens on the software side, modern desktops are rendering with opengl or vulkan instead of using 2D acceleration.</p>
</blockquote>
<p>virtio vga</p>
<ul>
<li>支持硬件辅组的 opengl 加速</li>
<li>目前只有 linux 下有驱动，因此只在 linux 工作</li>
</ul>
<blockquote>
<p>This device has (optional) hardware-assisted opengl acceleration support. This can be enabled using the <code>virgl=on</code> property, which in turn needs opengl support enabled (<code>gl=on</code>) in the qemu display.</p>
</blockquote>
<h4 id="virgl">virgl<a class="headerlink" href="#virgl" title="Permanent link">&para;</a></h4>
<p><a href="https://www.reddit.com/r/VFIO/comments/ufseh1/virgl_vs_gpu_passthrough_vs_virtio_or_qxl/">(7) VirGL vs GPU passthrough vs VirtIO or QXL : VFIO (reddit.com)</a></p>
<blockquote>
<p>为了显示 3D 图形，游戏需要为 GPU 打开一个“上下文”。（无论是 Direct3D，OpenGL，Vulkan 等）。打开此上下文后，他们可以向 GPU 发送命令以上传纹理、运行着色器、渲染内容等。
VirGL 允许访客在主机的 GPU 上打开这些上下文。为此，它需要在 VM 中拥有自己的特殊驱动程序，这些驱动程序独立于底层 GPU 类型。
未来很可能是 GPU-P (or GPU partitioning).。此功能允许物理 GPU 提供多个虚拟分区，允许主机和来宾使用相同的物理 GPU。有几种方法可以做到这一点，但目前它不受官方支持（在消费者卡中）。</p>
</blockquote>
<p>适合轻量的 3d 加速（桌面 compositor）</p>
<blockquote>
<p>if you need 3D accel (eg even for desktop compositor effects, no heavy gaming) this is what you want. Otherwise you go with Intel GVT-g or full GPU passthrough.</p>
</blockquote>
<p>目前还不支持 HW Video 编解码加速</p>
<blockquote>
<p>One feature I would like is being able to use HW video decode too, but presently that requires passing in full GPU or vGPU.</p>
</blockquote>
<p>设置后，在 win10 中样子
<img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20231002160224.png" /></p>
<p><img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20231002161058.png" /></p>
<p>可以玩简单 OpenGL 游戏：测试了东方
不能玩 yuzu 模拟器，选择 OpenGL 时，可以选择 GLSL，但是不能运行游戏。选 vulkan 没有设备。</p>
<h3 id="隐藏-kvm">隐藏 KVM<a class="headerlink" href="#隐藏-kvm" title="Permanent link">&para;</a></h3>
<p>著名二字游戏无法在虚拟机中运行
<img alt="原神无法虚拟机启动.jpg" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/%E5%8E%9F%E7%A5%9E%E6%97%A0%E6%B3%95%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%90%AF%E5%8A%A8.jpg" /></p>
<p><a href="https://forum.proxmox.com/threads/hide-vm-from-guest.34905/post-176978">https://forum.proxmox.com/threads/hide-vm-from-guest.34905/post-176978</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>args: -cpu &#39;host,-hypervisor,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,kvm=off,hv_vendor_id=intel&#39;
</span></code></pre></div>
<blockquote>
<p>Guest operating systems can test bit 31 of ECX of CPUID leaf 0x1, so <strong>-hypervisor</strong> flag prevent this.<br />
I can't add links <img alt=":(" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" title="Frown    :(" />. You can read more about virtual machine detection mechanism in vmware knowledge base. Article is called "Mechanisms to determine if software is running in a VMware virtual machin e"</p>
</blockquote>
<p>更新一点的 2022
<a href="https://forum.proxmox.com/threads/cant-hide-vm-status-in-windows-guest.96779/">Can't hide 'VM' status in Windows guest | Proxmox Support Forum</a></p>
<blockquote>
<p>In VM config:<br />
args: -cpu host,hv_vapic,hv_stimer,+invtsc,[more-flags],-hypervisor</p>
</blockquote>
<p>经尝试上面的命令启动时会报错，需要添加更多 flag</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>root@ryzen-pve ➜  ~ qm start 200
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>kvm: Hyper-V synthetic timers (hv-stimer) requires Hyper-V clocksources (hv-time)
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>start failed: QEMU exited with code 1
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>root@ryzen-pve ➜  ~ vim /etc/pve/qemu-server/200.conf
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>root@ryzen-pve ➜  ~ qm start 200
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>kvm: Hyper-V synthetic timers (hv-stimer) requires Hyper-V synthetic interrupt controller (hv-synic)
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>start failed: QEMU exited with code 1
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>root@ryzen-pve ➜  ~ vim /etc/pve/qemu-server/200.conf
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>root@ryzen-pve ➜  ~ qm start 200
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>kvm: Hyper-V synthetic interrupt controller (hv-synic) requires Hyper-V VP_INDEX MSR (hv-vpindex)
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>start failed: QEMU exited with code 1
</span></code></pre></div>
<p>最后需要补充完整到</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>args: -cpu host,hv_vapic,hv_stimer,hv_time,hv_synic,hv_vpindex,+invtsc,-hypervisor
</span></code></pre></div>
<p>注意，不要再加 cpu: x86-64-v3 这样的参数了。我刚开始加了，导致进入 vm，N 卡驱动报 43 错误</p>
<p>其它</p>
<ul>
<li>virt-manger 中类似方法：<a href="https://forums.unraid.net/topic/126098-%E6%B1%82%E5%8A%A9%EF%BC%81win11-wm-%E6%89%93%E5%BC%80%E5%8E%9F%E7%A5%9E-%E6%98%BE%E7%A4%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8B%E6%97%A0%E6%B3%95%E8%BF%90%E8%A1%8C/">求助！win11 wm 打开原神 显示虚拟机下无法运行 - Chinese / 简体中文 - Unraid</a></li>
<li><a href="https://www.wunote.cn/article/4801/">Proxmox VE(PVE) 虚拟机绕过软件的虚拟机检查来玩原神 - 某咸鱼的笔记 (wunote.cn)</a></li>
</ul>
<h3 id="创建-openwrt-实例">创建 openwrt 实例<a class="headerlink" href="#创建-openwrt-实例" title="Permanent link">&para;</a></h3>
<p>因为 openwrt 的使用场景和普通 linux 发行版不同。并没有提供包含 installer 的 iso 镜像。而是直接提供了一个分好区的磁盘镜像（类似于 dd if=/dev/sda of=openwrt.img）。因此安装 openwrt 的过程就是直接把磁盘镜像 dd 到<strong>整个</strong>磁盘中。</p>
<p>openwrt x86 提供了 UEFI 和 BIOS 两种启动类型，和 ext4 和 squarshfs 两种文件系统，组合下来 4 种的磁盘镜像。这里请参考文档<a href="https://openwrt.org/docs/guide-user/installation/openwrt_x86">[OpenWrt Wiki] OpenWrt on x86 hardware (PC / VM / server)</a>或者</p>
<p>下载镜像</p>
<ul>
<li>combined-efi 既支持 uefi 启动，也支持 BIOS 启动。</li>
</ul>
<h4 id="import-existing-disk-image">import existing disk image<a class="headerlink" href="#import-existing-disk-image" title="Permanent link">&para;</a></h4>
<p>创建虚拟机，需要将 image 镜像直接作为一个磁盘添加到 vm 中。但是 pve web 界面没有这个功能<a href="https://bugzilla.proxmox.com/show_bug.cgi?id=57">57 – KVM: enhance GUI import of disk images (proxmox.com)</a>，只有添加 ISO 镜像，以及创建新的指定大小的空的磁盘的功能。因此需要使用命令行。 google: pve vm add existing disk image
<a href="https://gist.github.com/swuecho/2a37453cb46405495061323c4c78e5d4">Add import existing disk image into Proxmox (github.com)</a></p>
<p>先用 disk import 将镜像作为虚拟磁盘添加到虚拟机，但是这个命令不支持修改磁盘大小。需要额外一条命令 <code>qm disk resize</code></p>
<ul>
<li><code>&lt;storage&gt;</code> 为虚拟磁盘的存储池。默认的 lvm 安装，用于存储磁盘镜像的为 local-lvm。（local 用于存储 iso 等）</li>
<li>import 后，disk 默认是 unused，需要编辑配置文件 /etc/pve/qemu-server/500.conf，将磁盘分配到 scsi0 等控制器上。也可以在 web 中 edit unused 磁盘，选择即可。还可以命令行 <code>qm set --scsi</code></li>
<li>默认磁盘大小是镜像文件大小，之后扩容比较麻烦，可以使用 resize 修改。<strong>resize 是立即生效的</strong>，不用重启 vm。（web 界面 resize 是需要重启的）</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>qm<span class="w"> </span>disk<span class="w"> </span>import<span class="w"> </span>&lt;vmid&gt;<span class="w"> </span>&lt;source&gt;<span class="w"> </span>&lt;storage&gt;<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c1"># qm disk import 500 openwrt-23.05.3-x86-64-generic-squashfs-combined-efi.img local-lvm</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="c1"># pvesm list local-lvm 中可以看到新建的磁盘镜像</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>qm<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">500</span><span class="w"> </span>--scsi0<span class="w"> </span>local-zfs:vm-500-disk-0
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>qm<span class="w"> </span>disk<span class="w"> </span>resize<span class="w"> </span>&lt;vmid&gt;<span class="w"> </span>&lt;disk&gt;<span class="w"> </span>&lt;size&gt;<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="c1"># qm disk resize 500 scsi0 16G</span>
</span></code></pre></div>
<h4 id="uefi-无法启动">uefi 无法启动<a class="headerlink" href="#uefi-无法启动" title="Permanent link">&para;</a></h4>
<p>efi shell 中可以看到 EFI/boot/grubx64.efi。但是启动时 Access denied</p>
<p>兼容 BIOS 启动</p>
<ul>
<li>/boot 下没有 efi 目录
<img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20240527010143.png" /></li>
</ul>
<p>PVE uefi 图形界面手动添加 boot entry
<a href="https://pve.proxmox.com/wiki/OVMF/UEFI_Boot_Entries">OVMF/UEFI Boot Entries - Proxmox VE</a></p>
<p>也有 efi shell 命令行添加的方式<a href="https://blog.stigok.com/2018/06/04/set-efi-boot-entries-uefi-shell.html">Update EFI boot entries with UEFI shell (stigok.com)</a></p>
<ul>
<li>ESC 先进入 bios，再选择进入 efi shell</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>bcfg boot dump -v -b  # List all boot entries (`-v` verbose, `-b` paged)
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>FS1:\&gt; bcfg boot add 0 fs1:\EFI\grub\grubx64.efi grub
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>Target = 0000
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>bcfg: Add Boot0000 as 0
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>FS1:\&gt; reset # reset to reboot
</span></code></pre></div>
<p>参考资料</p>
<ul>
<li>efi 重要命令：<a href="https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface#Important_UEFI_Shell_commands">Unified Extensible Firmware Interface - ArchWiki (archlinux.org)</a></li>
<li>efi intel 手册：<a href="https://web.archive.org/web/20190117223426/https://software.intel.com/en-us/articles/uefi-shell/">UEFI Shell | Intel® Software (archive.org)</a></li>
</ul>
<h2 id="lxc-容器">LXC 容器<a class="headerlink" href="#lxc-容器" title="Permanent link">&para;</a></h2>
<p><a href="https://pve.proxmox.com/wiki/Linux_Container">https://pve.proxmox.com/wiki/Linux_Container</a></p>
<h3 id="容器镜像">容器镜像<a class="headerlink" href="#容器镜像" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a> pveam update
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a> pveam available
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>pveam available --section system
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>pveam download local debian-10.0-standard_10.0-1_amd64.tar.gz
</span></code></pre></div>
<p>导入容器镜像
只能通过 webui upload?</p>
<h3 id="pct-命令行">PCT 命令行<a class="headerlink" href="#pct-命令行" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/wiki/Linux_Container#_managing_containers_with_tt_span_class_monospaced_pct_span_tt">Linux Container - Proxmox VE</a>
<a href="https://pve.proxmox.com/pve-docs/pct.1.html">pct(1) (proxmox.com)</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>pct list
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>pct console &lt;vmid&gt; [OPTIONS]
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>pct enter &lt;vmid&gt;
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>pct start
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>pct destroy 100 --purge # --purge_, if you want to additionally remove the container from replication jobs, backup jobs and HA resource configurations.
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a># pct set 100 -net0 name=eth0,bridge=vmbr0,ip=192.168.15.147/24,gw=192.168.15.1
</span></code></pre></div>
<h4 id="set-修改-hostname">set 修改 hostname<a class="headerlink" href="#set-修改-hostname" title="Permanent link">&para;</a></h4>
<p>在容器内修改 hostname 重启后会失效，需要使用 pct 命令行修改</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>pct set 110 --hostname docker
</span></code></pre></div>
<h4 id="ummanged-os">ummanged OS<a class="headerlink" href="#ummanged-os" title="Permanent link">&para;</a></h4>
<p>网页创建 openwrt 可能遇到以下错误</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>TASK ERROR: unable to create CT 100 - unable to detect OS distribution
</span></code></pre></div>
<p>需要使用<code>ummanged</code>类型，只能使用命令行操作</p>
<blockquote>
<p><em>unmanaged</em> can be used to skip and OS specific setup</p>
</blockquote>
<p>lvm</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>pct create 100 /mnt/ryzen-pve-storage/template/cache/openwrt-23.05.0-x86-64-rootfs.tar.gz \
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>--storage local-lvm \
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>--ostype unmanaged \
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>--unprivileged 1 \
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>--hostname op1 \
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>--rootfs local-lvm:8 \
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>--cores 4 \
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>--memory 1024 \
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>--swap 1024 \
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>--features keyctl=1,nesting=1
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>--password xxxx
</span></code></pre></div>
<p>zfs</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>pct create 700 local:vztmpl/openwrt-23.05.0-x86-64-generic-rootfs.tar.gz \
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>--storage local-zfs \
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>--ostype unmanaged \
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>--unprivileged 1 \
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>--hostname op1 \
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>--rootfs local-zfs:1 \
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>--cores 4 \
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>--memory 1024 \
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>--swap 0 \
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>--features keyctl=1,nesting=1
</span></code></pre></div>
<h3 id="配置文件_2">配置文件<a class="headerlink" href="#配置文件_2" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>/etc/pve/lxc/&lt;CTID&gt;.conf
</span></code></pre></div>
<p>Currently there are three types of mount points: storage backed mount points, bind mounts, and device mounts.</p>
<ul>
<li>Storage Backed Mount Points<ul>
<li>Image based</li>
<li>ZFS subvolumes</li>
<li>Directories</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>pct set 100 -mp0 thin1:10,mp=/path/in/container
</span></code></pre></div>
<ul>
<li>Bind Mount Points: Bind mounts allow you to access arbitrary directories from your Proxmox VE host inside a container</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>pct set 100 -mp0 /mnt/bindmounts/shared,mp=/shared
</span></code></pre></div>
<h3 id="特权容器">特权容器<a class="headerlink" href="#特权容器" title="Permanent link">&para;</a></h3>
<h4 id="特权容器转非特权容器">特权容器转非特权容器<a class="headerlink" href="#特权容器转非特权容器" title="Permanent link">&para;</a></h4>
<p><a href="https://forum.proxmox.com/threads/convert-privileged-to-unprivileged-container.31066/">Convert privileged to unprivileged container | Proxmox Support Forum</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>pct restore 1234 var/lib/vz/dump/vzdump-lxc-1234-2016_03_02-02_31_03.tar.gz -ignore-unpack-errors 1 -unprivileged
</span></code></pre></div>
<p>转个特权级结果这么麻烦。<a href="https://forum.proxmox.com/threads/convert-privileged-to-unprivileged-container.31066/post-261883">community</a>有通过挂载镜像，然后修改其内容的方法，但是看上去貌似有点野，因此还是不使用了。</p>
<p>尝试了</p>
<ul>
<li>编辑配置文件直接添加 unprivileged: yes。但是打开容器后，所有文件都变成了 nobody。（也许手动 chown 以下就可以了？）</li>
<li>尝试按照官方通过 backup 恢复。<ul>
<li>但是恢复后，jellyfin docker 启动不起来，貌似是权限的问题。jellyfin 配置文件不知为何就是无法 chown，root 用户 chown 结果报没有权限。</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>pct restore 111 /var/lib/vz/dump/vzdump-lxc-110-2023_09_29-23_05_38.tar.zst -ignore-unpack-errors 1 -unprivileged --features keyctl=1,nesting=1  --storage local-zfs
</span></code></pre></div>
<p>算了，还是用原来特权容器。</p>
<h3 id="路径映射挂载">路径映射（挂载）<a class="headerlink" href="#路径映射挂载" title="Permanent link">&para;</a></h3>
<p>参考</p>
<ul>
<li><a href="https://itsembedded.com/sysadmin/proxmox_bind_unprivileged_lxc/">Proxmox: bind mountpoint from host to unprivileged LXC container :: It's Embedded! (itsembedded.com)</a></li>
<li><a href="https://pve.proxmox.com/wiki/Unprivileged_LXC_containers">Unprivileged LXC containers - Proxmox VE</a></li>
</ul>
<p>Bind mounting：类似于目录的硬链接（linux 目录不能硬链接）</p>
<p>直接映射（基本上只读）</p>
<ul>
<li>需要重启容器生效</li>
<li>host 创建的文件在 guest 中为 nobody（只要文件权限不严格，应该是可读的）</li>
<li>guest 创建的文件在 host 上为 high-mapped(100000+)  uid</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a># pct命令
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>pct set 300 -mp0 /mnt/Disk2/BT/downloads/links,mp=/media
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a># 配置文件
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>mp0: /mnt/bindmounts/shared,mp=/shared
</span></code></pre></div>
<h4 id="用户映射">用户映射<a class="headerlink" href="#用户映射" title="Permanent link">&para;</a></h4>
<p>编辑容器配置文件</p>
<ul>
<li>0 100000 1005 表示 0 开始的 1005 长度段映射到 host 10000 开始 1005 长度段</li>
<li>以下配置将 1005 单独映射到 host 1005</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a># uid map: from uid 0 map 1005 uids (in the ct) to the range starting 100000 (on the host), so 0..1004 (ct) → 100000..101004 (host)
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>lxc.idmap = u 0 100000 1005
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>lxc.idmap = g 0 100000 1005
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a># we map 1 uid starting from uid 1005 onto 1005, so 1005 → 1005
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>lxc.idmap = u 1005 1005 1
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>lxc.idmap = g 1005 1005 1
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a># we map the rest of 65535 from 1006 upto 101006, so 1006..65535 → 101006..165535
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>lxc.idmap = u 1006 101006 64530
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>lxc.idmap = g 1006 101006 64530
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>lxc.idmap = u 0 100000 1000
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>lxc.idmap = g 0 100000 1000
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>lxc.idmap = u 1000 1000 1
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>lxc.idmap = g 1000 1000 1
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>lxc.idmap = u 1001 101001 64534
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>lxc.idmap = g 1001 101001 64534
</span></code></pre></div>
<p>编辑/etc/suuid(subgid)，使得 root 用户允许使用 1000 的 uid</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>root:100000:65536
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>root:1000:1
</span></code></pre></div>
<p>否则会报如下错误</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>lxc_map_ids: 3701 newuidmap failed to write mapping &quot;newuidmap: uid range [1000-1001) -&gt; [1000-1001) not allowed&quot;: newuidmap 793824 0 100000 1000 1000 1000 1 1001 101001 64534  
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>lxc_spawn: 1788 Failed to set up id mapping.  
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>__lxc_start: 2107  
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>TASK ERROR: startup for container &#39;110&#39; failed
</span></code></pre></div>
<h3 id="添加-gpu">添加 gpu<a class="headerlink" href="#添加-gpu" title="Permanent link">&para;</a></h3>
<p>容器配置文件中添加</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>lxc.cgroup2.devices.allow: c 226:0 rwm
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>lxc.cgroup2.devices.allow: c 226:128 rwm
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>lxc.cgroup2.devices.allow: c 29:0 rwm
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>lxc.mount.entry: /dev/fb0 dev/fb0 none bind,optional,create=file
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>lxc.apparmor.profile: unconfined
</span></code></pre></div>
<p>lxc.cgroup2.devices.allow 设置允许在 LXC 容器中使用的设备规则</p>
<ul>
<li><code>c</code> 表示字符设备。</li>
<li><code>195:*</code> 是一个设备规则，它指定了一组允许的字符设备。在这里，<code>195</code> 是主设备号（major number），而 <code>*</code> 表示允许任何次设备号（minor number），这意味着允许使用主设备号为 195 的所有字符设备。</li>
<li><code>rwm</code> 表示权限设置，<code>r</code> 表示允许读取，<code>w</code> 表示允许写入，<code>m</code> 表示允许创建设备文件。</li>
</ul>
<p><code>lxc.mount.entry: /dev/dri dev/dri none bind,optional,create=dir</code></p>
<ul>
<li>这个配置条目将主机上的 <code>/dev/dri</code> 目录挂载到 LXC 容器内的 <code>dev/dri</code> 目录。</li>
<li><code>none</code> 表示没有特定的文件系统类型。</li>
<li><code>bind</code> 表示使用绑定挂载（bind mount），这意味着容器内的 <code>dev/dri</code> 目录会映射到主机上的 <code>/dev/dri</code> 目录，容器内的操作将影响到主机上的设备。</li>
<li><code>optional</code> 表示这个挂载是可选的，如果 <code>/dev/dri</code> 在主机上不存在，容器仍然会启动。</li>
<li><code>create=dir</code> 表示如果容器内的目录不存在，它将在容器内创建一个目录。</li>
<li><code>create=file</code> 表示如果容器内的文件不存在，它将在容器内创建一个文件</li>
</ul>
<p>AppArmor 是一个 Linux 内核安全模块，用于限制程序的能力，包括容器，以增强安全性。
<code>lxc.apparmor.profile</code> 被设置为 "unconfined"，这意味着容器不受 AppArmor 个人资料的限制。它有更多自由，但也有较少的安全限制。</p>
<h3 id="openwrt">openwrt<a class="headerlink" href="#openwrt" title="Permanent link">&para;</a></h3>
<p>LXC 优点</p>
<ul>
<li>容器内的文件系统在 host 中可以直接看到，虚拟机磁盘是个镜像，需要自己 mount。</li>
<li>不涉及到 boot，备份时只需要保留 rootfs 即可。</li>
</ul>
<h4 id="非特权容器开启权限">非特权容器开启权限<a class="headerlink" href="#非特权容器开启权限" title="Permanent link">&para;</a></h4>
<ul>
<li>ppp (pppoe)</li>
<li>tun(openvpn, clash)</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>lxc.apparmor.profile: unconfined
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>lxc.cgroup.devices.allow: a
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>lxc.cap.drop:
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>lxc.cgroup2.devices.allow: c 10:200 rwm
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>lxc.mount.entry: /dev/net dev/net none bind,create=dir
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>lxc.cgroup2.devices.allow: c 108:0 rwm
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>lxc.mount.entry: /dev/ppp dev/ppp none bind,create=file
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>ppp_async
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>ppp_generic
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>ppp_mppe
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>pppoatm
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>pppoe
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>pppox
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>slhc
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>tun
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>root@n5105-pve ➜  ~ lsmod |grep pp
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>pppoe                  20480  0
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>pptp                   24576  0
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>pppox                  12288  2 pppoe,pptp
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>ppp_synctty            16384  0
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>pppoatm                16384  0
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>atm                    77824  1 pppoatm
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>ppp_async              16384  0
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>ppp_deflate            12288  0
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>ppp_mppe               12288  0
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>libarc4                12288  1 ppp_mppe
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>gre                    12288  3 ip6_gre,ip_gre,pptp
</span></code></pre></div>
<h4 id="rootfs-获取">rootfs 获取<a class="headerlink" href="#rootfs-获取" title="Permanent link">&para;</a></h4>
<ul>
<li>download openwrt 处下载</li>
<li>使用imagebuilder创建</li>
</ul>
<p>导入镜像方法：</p>
<ul>
<li>从web上传</li>
<li>move：<code>mv op2-openwrt-23.05.0-x86-64-generic-rootfs.tar.gz /var/lib/vz/template/cache/</code></li>
</ul>
<h4 id="创建lxc-容器">创建LXC 容器<a class="headerlink" href="#创建lxc-容器" title="Permanent link">&para;</a></h4>
<p>从 openwrt 下载的 rootfs 无法创建 lxc 容器了</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>TASK ERROR: unable to create CT 102 - unable to detect OS distribution
</span></code></pre></div>
<p>必须命令行设置 ostype</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>pct create 102 local:vztmpl/op2-openwrt-23.05.0-x86-64-generic-rootfs.tar.gz \
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>--storage local-zfs \
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>--ostype unmanaged \
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>--unprivileged 1 \
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>--arch amd64 \
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>--hostname op9 \
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>--rootfs local-zfs:1 \
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>--cores 4 \
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>--memory 512 \
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>--swap 0 \
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>--features keyctl=1,nesting=1
</span></code></pre></div>
<h3 id="pppoe-的坑">pppoe 的坑<a class="headerlink" href="#pppoe-的坑" title="Permanent link">&para;</a></h3>
<p>总结</p>
<ul>
<li>host 需要 modprobe 所有 pppoe 的包。可以配置在 <code>/etc/modules</code> 中</li>
<li>非特权 openwrt 容器配置文件需要配置 ppp devices<ul>
<li>默认情况下权限为 600, nobody, nobody，导致 Permission denied 错误<ul>
<li>可以 host <strong>chmod 666 /dev/ppp</strong></li>
<li>或者 device hook（该方法怀疑已经过时，测试 Proxmox VE 8.1.4 x86_64, 6.5.13-1-pve 无法启动容器，报错运行 hook 失败）</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>lxc.hook.autodev: /var/lib/lxc/199/device_hook.sh
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>mkdir -p ${LXC_ROOTFS_MOUNT}/dev/net
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>mknod -m 666 /${LXC_ROOTFS_MOUNT}/dev/ppp c 108 0
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>mknod -m 666 /${LXC_ROOTFS_MOUNT}/dev/net/tun c 10 200
</span></code></pre></div>
<p>systemctl edit fix-ppp</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>[Unit]
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>Description=Fix lxc openwrt pppoe by chmod 666 ppp device
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>After=multi-user.target
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>[Service]
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>Type=oneshot
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>ExecStart=/bin/chmod 666 /dev/ppp
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>RemainAfterExit=true
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>[Install]
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>WantedBy=multi-user.target
</span></code></pre></div>
<p>参考资料</p>
<ul>
<li><a href="https://github.com/fw867/pve-edge-kernel?tab=readme-ov-file">fw867/pve-edge-kernel: Newer Linux kernels for Proxmox VE (github.com)</a><ul>
<li>其中<a href="https://github.com/fw867/pve-edge-kernel/releases/download/V1.0/shell.tar.gz">一些Shell</a>脚本包含许多重要的配置</li>
</ul>
</li>
<li><a href="https://forum.proxmox.com/threads/pve-7-how-to-make-all-new-cts-have-ppp-enabled.95104/">[SOLVED] - PVE 7 - How to make all new CTs have PPP enabled | Proxmox Support Forum</a><ul>
<li>也遇到了 <code>Couldn't open the /dev/ppp device: Operation not permitted</code></li>
<li>提到使用 cgroup2 可以解决</li>
<li>有人补充还需要 host <code>chown 100000:100000 /dev/ppp</code></li>
</ul>
</li>
<li>autodev 已经不需要了，改用 entry 了。<a href="https://www.reddit.com/r/Proxmox/comments/n7jms8/lxcaudodev1_doesnt_work_with_unprivileged_lxc/">lxc.audodev=1 doesn't work with unprivileged LXC container? : r/Proxmox (reddit.com)</a></li>
</ul>
<h4 id="调试过程">调试过程<a class="headerlink" href="#调试过程" title="Permanent link">&para;</a></h4>
<p>刚开始报错如下。这里其实有 <code>no module folders for kernel version 6.5.13-1-pve found</code> 和 <code>Couldn't open the /dev/ppp device: Permission denied</code> 两个错误。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>Wed Jun 12 19:13:54 2024 daemon.notice netifd: Interface &#39;wan&#39; is now down
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>Wed Jun 12 19:13:54 2024 daemon.notice netifd: Interface &#39;wan&#39; is setting up now
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>Wed Jun 12 19:13:54 2024 daemon.err modprobe: no module folders for kernel version 6.5.13-1-pve found
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>Wed Jun 12 19:13:54 2024 daemon.info pppd[143974]: Plugin pppoe.so loaded.
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>Wed Jun 12 19:13:54 2024 daemon.info pppd[143974]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>Wed Jun 12 19:13:54 2024 daemon.err pppd[143974]: Couldn&#39;t open the /dev/ppp device: Permission denied
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>Wed Jun 12 19:13:54 2024 daemon.err pppd[143974]: Sorry - this system lacks PPP kernel support
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>Wed Jun 12 19:13:54 2024 daemon.notice netifd: wan (143974): /usr/sbin/pppd: Sorry - this system lacks PPP kernel support
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>Wed Jun 12 19:13:54 2024 daemon.notice netifd: wan (143974):
</span></code></pre></div>
<p>n4500 上使用了特权容器，因此 600 的权限是没问题的。但是 非特权容器 owner 为 nobody nogroup。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>root@n4500 ➜  ~ l /dev/ppp
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>crw------- 1 root root 108, 0 Jun 11 11:44 /dev/ppp
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>root@op3 ➜  ~ l /dev/ppp
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>crw-------    1 root     root      108,   0 Jun 11 11:45 /dev/ppp
</span></code></pre></div>
<p>尝试改为使用 cgroup2，还是不行。pve <code>chmod 777 /dev/ppp</code> 报错变了。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Wed Jun 12 19:28:09 2024 daemon.warn pppd[149937]: Timeout waiting for PADS packets
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>Wed Jun 12 19:28:09 2024 daemon.err pppd[149937]: Unable to complete PPPoE Discovery
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>Wed Jun 12 19:28:09 2024 daemon.info pppd[149937]: Exit.
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>Wed Jun 12 19:28:09 2024 daemon.info pppd[150272]: Plugin pppoe.so loaded.
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>Wed Jun 12 19:28:09 2024 daemon.info pppd[150272]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>Wed Jun 12 19:28:09 2024 daemon.notice pppd[150272]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>Wed Jun 12 19:28:24 2024 daemon.warn pppd[150272]: Timeout waiting for PADS packets
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>Wed Jun 12 19:28:24 2024 daemon.err pppd[150272]: Unable to complete PPPoE Discovery
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>Wed Jun 12 19:28:24 2024 daemon.info pppd[150272]: Exit.
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>Wed Jun 12 19:28:24 2024 daemon.info pppd[150823]: Plugin pppoe.so loaded.
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>Wed Jun 12 19:28:24 2024 daemon.info pppd[150823]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>Wed Jun 12 19:28:24 2024 daemon.notice pppd[150823]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>Wed Jun 12 19:28:34 2024 daemon.err pppd[150823]: select (waitForPADS): Interrupted system call
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>Wed Jun 12 19:28:34 2024 daemon.warn pppd[150823]: Timeout waiting for PADS packets
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a>Wed Jun 12 19:28:34 2024 daemon.err pppd[150823]: Unable to complete PPPoE Discovery
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a>Wed Jun 12 19:28:34 2024 daemon.info pppd[150823]: Exit.
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a>Wed Jun 12 19:28:34 2024 daemon.info pppd[151126]: Plugin pppoe.so loaded.
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a>Wed Jun 12 19:28:34 2024 daemon.info pppd[151126]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a>Wed Jun 12 19:28:34 2024 daemon.notice pppd[151126]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#__codelineno-60-20"></a>Wed Jun 12 19:28:49 2024 daemon.warn pppd[151126]: Timeout waiting for PADS packets
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#__codelineno-60-21"></a>Wed Jun 12 19:28:49 2024 daemon.err pppd[151126]: Unable to complete PPPoE Discovery
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#__codelineno-60-22"></a>Wed Jun 12 19:28:49 2024 daemon.info pppd[151126]: Exit.
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#__codelineno-60-23"></a>Wed Jun 12 19:28:49 2024 daemon.info pppd[151487]: Plugin pppoe.so loaded.
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#__codelineno-60-24"></a>Wed Jun 12 19:28:49 2024 daemon.info pppd[151487]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#__codelineno-60-25"></a>Wed Jun 12 19:28:49 2024 daemon.notice pppd[151487]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-60-26"><a id="__codelineno-60-26" name="__codelineno-60-26" href="#__codelineno-60-26"></a>Wed Jun 12 19:29:04 2024 daemon.warn pppd[151487]: Timeout waiting for PADS packets
</span><span id="__span-60-27"><a id="__codelineno-60-27" name="__codelineno-60-27" href="#__codelineno-60-27"></a>Wed Jun 12 19:29:04 2024 daemon.err pppd[151487]: Unable to complete PPPoE Discovery
</span><span id="__span-60-28"><a id="__codelineno-60-28" name="__codelineno-60-28" href="#__codelineno-60-28"></a>Wed Jun 12 19:29:04 2024 daemon.info pppd[151487]: Exit.
</span><span id="__span-60-29"><a id="__codelineno-60-29" name="__codelineno-60-29" href="#__codelineno-60-29"></a>Wed Jun 12 19:29:04 2024 daemon.info pppd[151787]: Plugin pppoe.so loaded.
</span><span id="__span-60-30"><a id="__codelineno-60-30" name="__codelineno-60-30" href="#__codelineno-60-30"></a>Wed Jun 12 19:29:04 2024 daemon.info pppd[151787]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-31"><a id="__codelineno-60-31" name="__codelineno-60-31" href="#__codelineno-60-31"></a>Wed Jun 12 19:29:04 2024 daemon.notice pppd[151787]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-60-32"><a id="__codelineno-60-32" name="__codelineno-60-32" href="#__codelineno-60-32"></a>Wed Jun 12 19:29:19 2024 daemon.warn pppd[151787]: Timeout waiting for PADS packets
</span><span id="__span-60-33"><a id="__codelineno-60-33" name="__codelineno-60-33" href="#__codelineno-60-33"></a>Wed Jun 12 19:29:19 2024 daemon.err pppd[151787]: Unable to complete PPPoE Discovery
</span><span id="__span-60-34"><a id="__codelineno-60-34" name="__codelineno-60-34" href="#__codelineno-60-34"></a>Wed Jun 12 19:29:19 2024 daemon.info pppd[151787]: Exit.
</span><span id="__span-60-35"><a id="__codelineno-60-35" name="__codelineno-60-35" href="#__codelineno-60-35"></a>Wed Jun 12 19:29:19 2024 daemon.info pppd[152103]: Plugin pppoe.so loaded.
</span><span id="__span-60-36"><a id="__codelineno-60-36" name="__codelineno-60-36" href="#__codelineno-60-36"></a>Wed Jun 12 19:29:19 2024 daemon.info pppd[152103]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-60-37"><a id="__codelineno-60-37" name="__codelineno-60-37" href="#__codelineno-60-37"></a>Wed Jun 12 19:29:19 2024 daemon.notice pppd[152103]: pppd 2.4.9 started by root, uid 0
</span></code></pre></div>
<p>modprobe 以下 kernel 后解决。（起因是别人的报错中没有 kernel module 相关信息，并且我发现 kernel 目录下有其它 ko 文件）</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>bsd_comp
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>ppp_synctty
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>pptp
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>root@n5105-pve ➜  ~ l /lib/modules/6.5.13-1-pve/kernel/drivers/net/ppp/
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>total 88K
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>-rw-r--r-- 1 root root 22K Feb  5 21:50 bsd_comp.ko
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>-rw-r--r-- 1 root root 29K Feb  5 21:50 ppp_async.ko
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>-rw-r--r-- 1 root root 19K Feb  5 21:50 ppp_deflate.ko
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>-rw-r--r-- 1 root root 22K Feb  5 21:50 ppp_mppe.ko
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>-rw-r--r-- 1 root root 40K Feb  5 21:50 pppoe.ko
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>-rw-r--r-- 1 root root 15K Feb  5 21:50 pppox.ko
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>-rw-r--r-- 1 root root 27K Feb  5 21:50 ppp_synctty.ko
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>-rw-r--r-- 1 root root 28K Feb  5 21:50 pptp.ko
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Terminating on signal 15
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Connect time 2.6 minutes.
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Sent 2342096 bytes, received 636835 bytes.
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>Wed Jun 12 19:35:30 2024 daemon.notice pppd[156589]: Connection terminated.
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Connect time 2.6 minutes.
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Sent 2342096 bytes, received 636835 bytes.
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[156589]: Exit.
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[158315]: Plugin pppoe.so loaded.
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>Wed Jun 12 19:35:30 2024 daemon.info pppd[158315]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>Wed Jun 12 19:35:30 2024 daemon.notice pppd[158315]: pppd 2.4.9 started by root, uid 0
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>Wed Jun 12 19:35:35 2024 daemon.info pppd[158315]: PPP session is 4826
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>Wed Jun 12 19:35:35 2024 daemon.warn pppd[158315]: Connected to 00:00:5e:00:01:98 via interface eth0
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>Wed Jun 12 19:35:35 2024 daemon.info pppd[158315]: Renamed interface ppp0 to pppoe-wan
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>Wed Jun 12 19:35:35 2024 daemon.info pppd[158315]: Using interface pppoe-wan
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>Wed Jun 12 19:35:35 2024 daemon.notice pppd[158315]: Connect: pppoe-wan &lt;--&gt; eth0
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a>Wed Jun 12 19:35:38 2024 daemon.info pppd[158315]: CHAP authentication succeeded: Authentication success,Welcome!
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: CHAP authentication succeeded
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: peer from calling number 00:00:5E:00:01:98 authorized
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: local  LL address fe80::b16e:4c9f:8fb8:4702
</span><span id="__span-63-20"><a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: remote LL address fe80::0200:5eff:fe00:0198
</span><span id="__span-63-21"><a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: local  IP address 100.67.41.202
</span><span id="__span-63-22"><a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: remote IP address 100.67.0.1
</span><span id="__span-63-23"><a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: primary   DNS address 211.138.180.2
</span><span id="__span-63-24"><a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a>Wed Jun 12 19:35:38 2024 daemon.notice pppd[158315]: secondary DNS address 211.138.180.3
</span></code></pre></div>
<h3 id="遇到问题">遇到问题<a class="headerlink" href="#遇到问题" title="Permanent link">&para;</a></h3>
<h4 id="openwrt-pppoe-no_kernel_support">openwrt pppoe NO_KERNEL_SUPPORT<a class="headerlink" href="#openwrt-pppoe-no_kernel_support" title="Permanent link">&para;</a></h4>
<p>luci interface 显示 NO_KERNEL_SUPPORT</p>
<p>logread 报错</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>Fri Feb  2 21:23:28 2024 daemon.info pppd[13110]: Plugin pppoe.so loaded.
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>Fri Feb  2 21:23:28 2024 daemon.info pppd[13110]: PPPoE plugin from pppd 2.4.9
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>Fri Feb  2 21:23:28 2024 daemon.err pppd[13110]: Couldn&#39;t open the /dev/ppp device: Permission denied
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>Fri Feb  2 21:23:28 2024 daemon.err pppd[13110]: Sorry - this system lacks PPP kernel support
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>Fri Feb  2 21:23:28 2024 daemon.notice netifd: wan (13110): /usr/sbin/pppd: Sorry - this system lacks PPP kernel support
</span></code></pre></div>
<p>该问题为 /dev/ppp 权限问题。host 上 chmod 777 是简单的一种解决方式。详情见 <em>pppoe 的坑</em>。</p>
<h4 id="无法修改-ssh-端口固定为-22">无法修改 ssh 端口，固定为 22<a class="headerlink" href="#无法修改-ssh-端口固定为-22" title="Permanent link">&para;</a></h4>
<p>现象：<code>/etc/ssh/sshd_config</code>中设置了非 22 端口，但是 s restart ssh 仍然使用 22 端口（好像文件中配置的禁止密码登录是正确应用了的）。发现 s reload ssh 可以临时将端口改为配置文件中设置的端口（ss -tnlp 同时有 22 和设置的端口），但是 restart 后又变回了 22</p>
<p>解决</p>
<p>google: pve lxc sshd can't port 22
<a href="https://forum.proxmox.com/threads/ssh-doesnt-work-as-expected-in-lxc.54691/post-451843">https://forum.proxmox.com/threads/ssh-doesnt-work-as-expected-in-lxc.54691/post-451843</a></p>
<p>貌似重点在于 ssh.socket 这个</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>systemctl disable ssh.socket
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>systemctl enable ssh
</span></code></pre></div>
<p><strong>不管用</strong></p>
<p>添加以下两行，op 确实出现了 ppp 设备 (c600, nobody, nobody)，但是 logread 仍然报错</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>lxc.cgroup.devices.allow: c 108:0 rwm
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>lxc.mount.entry%3A /dev/ppp dev/ppp none bind,create=file
</span></code></pre></div>
<p>换用特权容器，仍然报错</p>
<p>chmod 777 /dev/ppp，luci报错稍微不同，但仍然是NO_KERNEL_SUPPORT</p>
<p>host modprobe ppp 相关模块</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>modprobe tun  
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>modprobe ppp-compress-18  
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>modprobe ppp_mppe  
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>modprobe ppp_deflate  
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>modprobe ppp_async  
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>modprobe pppoatm  
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>modprobe ppp_generic
</span></code></pre></div>
<p><strong>解决</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>lxc.cgroup.devices.allow: c 108:0 rwm
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>hookscript: local:snippets/hookscript.pl
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>cp /usr/share/pve-docs/examples/guest-example-hookscript.pl /var/lib/vz/snippets/hookscript.pl
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>vim /var/lib/vz/snippets/hookscript.pl
</span></code></pre></div>
<p>添加两行 system 调用</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a># Second phase &#39;post-start&#39; will be executed after the guest
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>    # successfully started.
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>    system(&quot;lxc-device add -n $vmid /dev/ppp&quot;);
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>    system(&quot;lxc-device add -n $vmid /dev/net/tun&quot;);
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>    print &quot;$vmid started successfully.\n&quot;;
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>Fri Feb  2 23:29:27 2024 daemon.info pppd[8111]: Renamed interface ppp0 to pppoe-wan
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>Fri Feb  2 23:29:27 2024 daemon.info pppd[8111]: Using interface pppoe-wan
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>Fri Feb  2 23:29:27 2024 daemon.notice pppd[8111]: Connect: pppoe-wan &lt;--&gt; eth0
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>Fri Feb  2 23:29:28 2024 daemon.info pppd[8111]: Remote message: Radius User Restriction [64|FBB&amp;WiFi]
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>Fri Feb  2 23:29:28 2024 daemon.err pppd[8111]: PAP authentication failed
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>Fri Feb  2 23:29:28 2024 daemon.notice pppd[8111]: Modem hangup
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>Fri Feb  2 23:29:28 2024 daemon.notice pppd[8111]: Connection terminated.
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>Fri Feb  2 23:29:28 2024 daemon.info pppd[8111]: Exit.
</span></code></pre></div>
<p>参考</p>
<ul>
<li>lxc 容器配置文件添加 ppp 108 设备权限：<a href="https://forum.proxmox.com/threads/pve-7-how-to-make-all-new-cts-have-ppp-enabled.95104/">[SOLVED] - PVE 7 - How to make all new CTs have PPP enabled | Proxmox Support Forum</a></li>
<li>解决：<a href="https://www.right.com.cn/forum/thread-8276750-1-1.html">pve lxc安装的openwrt拨号提示NO_KERNEL_SUPPORT，尝试多个固件都拨不上-软路由,x86系统,openwrt(x86),Router OS 等-恩山无线论坛 (right.com.cn)</a> --&gt; 指路：<a href="https://blog.csdn.net/kangzeru/article/details/115373587">ProxmoxVE 7.0 LXC下搭建openwrt软路由_lxc openwrt-CSDN博客</a></li>
</ul>
<h2 id="备份和恢复">备份和恢复<a class="headerlink" href="#备份和恢复" title="Permanent link">&para;</a></h2>
<p><a href="https://pve.proxmox.com/wiki/Backup_and_Restore">Backup and Restore - Proxmox VE</a></p>
<p>LXC</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a> pct restore 100 vzdump-lxc-100-2023_10_03-15_38_23.tar.zst --storage local-zfs
</span></code></pre></div>
<p>qm</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>qmrestore 
</span></code></pre></div>
<h2 id="性能优化">性能优化<a class="headerlink" href="#性能优化" title="Permanent link">&para;</a></h2>
<p><a href="https://forum.proxmox.com/threads/windows-11-vm-best-performance.135614/">Windows 11 VM (Best Performance) | Proxmox Support Forum</a></p>
<ul>
<li>You could use virtio NIC + virtio SCSI.</li>
<li>In case you don't plan to migrate those VMs you could set the CPU type to "host".</li>
<li>Don't overprovision your RAM or CPU cores.</li>
<li>Enable NUMA in case you got a multi-socket server.</li>
<li>If you got a little big CPU architecture it might help to pin a VM to the performance cores.</li>
<li>And in case you trust all your guests you could disable mitigations in the bootloader.</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>/etc/kernel/cmdline  
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>mitigations=off  
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>proxmox-boot-tool refresh
</span></code></pre></div>
<h2 id="pve显卡直通">PVE显卡直通<a class="headerlink" href="#pve显卡直通" title="Permanent link">&para;</a></h2>
<p><a href="https://pve.proxmox.com/wiki/PCI(e)_Passthrough">PCI(e) Passthrough - Proxmox VE</a>
<a href="https://pve.proxmox.com/wiki/PCI_Passthrough">PCI Passthrough - Proxmox VE</a>
<a href="https://www.reddit.com/r/HomeLab/comments/b5xpua/the_ultimate_beginners_guide_to_gpu_passthrough/">(7) The Ultimate Beginner's Guide to GPU Passthrough (Proxmox, Windows 10) : HomeLab (reddit.com)</a></p>
<h3 id="步骤">步骤<a class="headerlink" href="#步骤" title="Permanent link">&para;</a></h3>
<h4 id="修改内核参数">修改内核参数<a class="headerlink" href="#修改内核参数" title="Permanent link">&para;</a></h4>
<p><em>p.s grub和systemd-boot修改方法不一样，这里以systemd-boot为说明</em></p>
<ul>
<li><code>intel_iommu=on | amd_iommu=on</code>：For Intel CPUs, you may also need to enable the IOMMU on the <a href="https://pve.proxmox.com/wiki/Host_Bootloader#sysboot_edit_kernel_cmdline">kernel command line</a> for older (pre-5.15) kernels. For AMD CPUs it should be enabled automatically.</li>
<li><code>iommu=pt</code>：If your hardware supports IOMMU passthrough mode, enabling this mode might increase performance.</li>
</ul>
<ul>
<li>(optional)启用acs override</li>
</ul>
<div class="admonition note">
<p class="admonition-title">非grub修改内核参数方法</p>
<p>我使用zfs，pve8.0 root分区也位于zfs，使用systemd-boot引导。因此内核参数需要在<code>/etc/kernel/cmdline</code>修改。
- Grub：The kernel commandline needs to be placed in the variable GRUB_CMDLINE_LINUX_DEFAULT in the file <code>/etc/default/grub</code>. Running <code>update-grub</code> appends its content to all linux entries in /boot/grub/grub.cfg.</p>
</div>
<ul>
<li>Systemd-boot<ul>
<li>The kernel commandline needs to be placed as one line in <code>/etc/kernel/cmdline</code>. To apply your changes, run <code>proxmox-boot-tool refresh</code>, which sets it as the option line for all config files in <code>loader/entries/proxmox-*.conf</code>.</li>
</ul>
</li>
</ul>
<p>最后的内核参数</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>#/etc/kernel/cmdline
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a>root=ZFS=rpool/ROOT/pve-1 boot=zfs amd_iommu=on iommu=pt pcie_acs_override=downstream,multifunction
</span></code></pre></div>
<p>更新引导参数：<code>proxmox-boot-tool refresh</code></p>
<h4 id="kernel-module">kernel module<a class="headerlink" href="#kernel-module" title="Permanent link">&para;</a></h4>
<h5 id="设置尽早加载">设置尽早加载<a class="headerlink" href="#设置尽早加载" title="Permanent link">&para;</a></h5>
<p>保证以下module尽早加载，将其添加到<code>/etc/modules</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>vfio
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>vfio_iommu_type1
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>vfio_pci
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>vfio_virqfd
</span></code></pre></div>
<h5 id="设置模块参数">设置模块参数<a class="headerlink" href="#设置模块参数" title="Permanent link">&para;</a></h5>
<p>修改一些内核模块的参数，位于<code>/etc/modprobe.d</code></p>
<p>vifo.conf</p>
<ul>
<li>disable_vga后，pve启动时显示器会无法使用（vifo接管显卡后，屏幕便会卡住不变了）</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>options vfio-pci ids=10de:1b81,10de:10f0,10de:1c02,10de:10f1 disable_vga=1
</span></code></pre></div>
<p>kvm.conf</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>options kvm ignore_msrs=1 report_ignored_msrs=0
</span></code></pre></div>
<p>blacklist.conf</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>blacklist nouveau
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>blacklist nvidia*
</span></code></pre></div>
<h5 id="更新initramfs">更新initramfs<a class="headerlink" href="#更新initramfs" title="Permanent link">&para;</a></h5>
<p>每当修改内核模块后，需要重新生成initramfs。
<code>update-initramfs -u</code></p>
<ul>
<li><code>-u</code>: update</li>
<li><code>-k a</code>: 指定一个内核版本或者all指定所有</li>
</ul>
<h3 id="acs-override">ACS override<a class="headerlink" href="#acs-override" title="Permanent link">&para;</a></h3>
<p><a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html">VFIO tips and tricks: VFIO+VGA FAQ</a></p>
<blockquote>
<p>pcie_acs_override =
[PCIE] Override missing PCIe ACS support for:
downstream
All downstream ports - full ACS capabilties
multifunction
All multifunction devices - multifunction ACS subset
id:nnnn:nnnn
Specfic device - full ACS capabilities
Specified as vid:did (vendor/device ID) in hex</p>
</blockquote>
<h3 id="遇到的问题">遇到的问题<a class="headerlink" href="#遇到的问题" title="Permanent link">&para;</a></h3>
<h4 id="boot-gpu直通问题">boot gpu直通问题<a class="headerlink" href="#boot-gpu直通问题" title="Permanent link">&para;</a></h4>
<p>960（第一个槽），需要关闭显示器重启pve，才能正确工作。添加内核参数video=efifb:off后，连接显示器重启没问题？</p>
<blockquote>
<p><code>video=efifb:off</code> and related kernel parameters don't work on Proxmox anymore. Use <a href="https://forum.proxmox.com/posts/478351/">this work-around</a> when doing <a href="https://pve.proxmox.com/pve-docs/pve-admin-guide.html#qm_pci_passthrough">passthrough</a> of the boot (or only) GPU.<br />
Also, <code>amd_iommu=on</code> really does nothing and <code>iommu=pt</code> does mostly nothing. And <a href="https://pve.proxmox.com/pve-docs/pve-admin-guide.html#sysboot_determine_bootloader_used">not all</a> Proxmox installations use GRUB.</p>
<p>What a nice post! I've been looking for a solution to this BAR 3 issues all night. Big Thanks!<br />
By the way, I also found better solution on a reddit post. It is adding "<code>initcall_blacklist=sysfb_init</code>" to kernel parameter. No need "<code>video=efifb:off</code>" or "<code>video=simplefb:off</code>" in kernel parameter. I also tested, it does solve the problem!<br />
Reference:<br />
<a href="https://www.reddit.com/r/VFIO/comments/uud5sx/possible_to_let_simplefb_stay_away_from_the_gpu/?sort=old">https://www.reddit.com/r/VFIO/comme...let_simplefb_stay_away_from_the_gpu/?sort=old</a><br />
<a href="https://www.reddit.com/r/Proxmox/comments/vc9hw3/latest_proxmox_7_the_kernel_breaks_my_gpu/?sort=old">https://www.reddit.com/r/Proxmox/comments/vc9hw3/latest_proxmox_7_the_kernel_breaks_my_gpu/?sort=old</a></p>
</blockquote>
<h4 id="amd-6500xt-43错误bios关闭resizable-bar">amd 6500xt 43错误（BIOS关闭resizable BAR）<a class="headerlink" href="#amd-6500xt-43错误bios关闭resizable-bar" title="Permanent link">&para;</a></h4>
<p>给czw直通6500xt，结果即使安装完amd驱动后仍然报43错误。最后发现是AMD GPU的问题，需要关闭Resizable BAR/Smart Access Memory <a href="https://pve.proxmox.com/wiki/PCI_Passthrough#BIOS_options">https://pve.proxmox.com/wiki/PCI_Passthrough#BIOS_options</a>  </p>
<blockquote>
<p>"Resizable BAR'/'Smart Access Memory': Some AMD GPUs (Vega and up) experience 'Code 43' in Windows guests if this is enabled on the host. It's not supported in VMs either way (yet), so the recommended setting is 'off'."</p>
</blockquote>
<p><a href="https://forum.proxmox.com/threads/gpu-passthrough-radeon-6800xt-and-beyond.86932/post-561971">https://forum.proxmox.com/threads/gpu-passthrough-radeon-6800xt-and-beyond.86932/post-561971</a></p>
<p>总结</p>
<ul>
<li>有用<ul>
<li>关闭bios csm和smart access memory</li>
<li>添加内核参数<code>initcall_blacklist=sysfb_init</code>（<code>video=efifb:off</code>仍然保留），重启pve</li>
</ul>
</li>
<li>无用<ul>
<li>我自己评论的：I firstly tryed another method, since driver 43 error is a common problem when using libvirt to create VM. see <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Video_card_driver_virtualisation_detection">ovmf arch wiki 43</a>.  So I did similar thing: edit guest qemu config file(/etc/pve/qemu-sever/ VM id.conf), modify cpu property to "cpu: host,hidden=1,hv-vender-id=123456789".</li>
</ul>
</li>
</ul>
<h4 id="windows随机蓝屏bosd修改cpu-x86-v3">windows随机蓝屏BOSD（修改cpu x86-v3）<a class="headerlink" href="#windows随机蓝屏bosd修改cpu-x86-v3" title="Permanent link">&para;</a></h4>
<p>VIDEO_DXGKRNL</p>
<ul>
<li>10来分钟就蓝屏，没有触发条件</li>
<li>gfe安装最新驱动，安装完成时黑屏，只能在pve console里操作。<ul>
<li>可以再次点击快速安装安装驱动</li>
<li>可以看到设备管理器中显卡报13错误</li>
<li>重启后显示安装上了，但是如果重新安装又是以上步骤</li>
</ul>
</li>
</ul>
<p>尝试</p>
<ul>
<li>关闭vnc, parsec, 小飞机等可能修改显卡的软件</li>
<li>勾上primay gpu</li>
<li>使用网上下载的msi 公版vbios，设置romfile参数<a href="https://www.techpowerup.com/vgabios/183948/msi-gtx1070-8192-160520">VGA Bios Collection: MSI GTX 1070 8 GB | TechPowerUp</a></li>
<li>安装studio驱动（仍然会有上面问题）</li>
</ul>
<p><a href="https://forum.proxmox.com/threads/urgent-help-windows-10-crash-bsod-video_dxgkrnl_fatal_error.131828/">Urgent Help, Windows 10 Crash!!! BSOD VIDEO_DXGKRNL_FATAL_ERROR | Proxmox Support Forum</a></p>
<p>把下面句子翻译成英文：
我遇到了完全一样的问题，我的win10虚拟机最近开始随机蓝屏。它过去3个星期是很正常的。我尝试了很多方法（reinstall win10, try win11, pass vbios rom file），问题仍没解决。直到我看到了你的帖子，我也尝试把CPU从host改为kvm64，问题居然神奇的解决了。</p>
<p>经过我之前非常多的尝试，我发现了一个能够稳定触发BOSD的方法，那就是使用GPU-Z软件导出GPU的vbios，每次确认导出时，win10系统就会蓝屏。</p>
<p>并且我也发现了一个不太正常的现象。GPU-Z只有在第一次打开时UEFI状态是勾上的，关闭GPU-Z软件然后再打开，UEFI就会变为未勾选状态。并打开GPU-Z软件几秒后，bus interface也会从PCIex16 3.0@x16 3.0变为 PCI。</p>
<p>在将CPU从host换成KVM64后，上面的问题就被解决了。GPU-Z UEFI和bus interface显示的都是正确的。</p>
<p><a href="https://forum.proxmox.com/threads/video_dxgkrnl_fatal_error-in-a-windows-vm-workarounds.94890/">VIDEO_DXGKRNL_FATAL_ERROR in a Windows VM - workarounds? | Proxmox Support Forum</a></p>
<ul>
<li>这个帖子认为是MSI这种软件读取了底层的不存在的寄存器导致系统崩溃</li>
</ul>
<h4 id="43错误总结">43错误总结<a class="headerlink" href="#43错误总结" title="Permanent link">&para;</a></h4>
<ol>
<li>显卡驱动检测虚拟机
最早使用KVM创建虚拟机，遇到的便是这个。安装英伟达最新驱动即可</li>
</ol>
<blockquote>
<p>Video card drivers by AMD incorporate very basic virtual machine detection targeting Hyper-V extensions. Should this detection mechanism trigger, the drivers will refuse to run, resulting in a black screen.
Nvidia guest drivers prior to version 465 exhibited a similar behaviour which resulted in a generic error 43 in the card's device manager status. Systems using these older drivers therefore also need the above modification. In addition, they also require hiding the KVM CPU leaf</p>
</blockquote>
<ol>
<li><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Code_43_while_Resizable_Bar_is_turned_on_in_the_bios">Resizable Bar is turned on in the bios</a></li>
</ol>
<p>If you own a GPU that supports Resizable BAR / SAM and have the corresponding BIOS option enabled, you might get code 43 because this feature is disabled in QEMU <a href="https://github.com/qemu/qemu/commit/3412d8ec9810b819f8b79e8e0c6b87217c876e32">[11]</a>. Linux Kernel release 6.1 added option to manipulate PCIe Resizable BARs through <a href="https://en.wikipedia.org/wiki/sysfs" title="wikipedia:sysfs">sysfs</a>, so you can try permanently resizing it using a <a href="https://wiki.archlinux.org/title/Udev" title="Udev">udev</a> rule:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>/etc/udev/rules.d/01-amd.rules
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>ACTION==&quot;add&quot;, SUBSYSTEM==&quot;pci&quot;, ATTR{vendor}==&quot;0x1002&quot;, ATTR{device}==&quot;0x73bf&quot;, ATTR{resource0_resize}=&quot;14&quot;
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>ACTION==&quot;add&quot;, SUBSYSTEM==&quot;pci&quot;, ATTR{vendor}==&quot;0x1002&quot;, ATTR{device}==&quot;0x73bf&quot;, ATTR{resource2_resize}=&quot;8&quot;
</span></code></pre></div>
<p>Alternatively, to temporarily resize the PCIe BAR, you can write the new size to <code>/sys/bus/pci/devices/_device_address_/resource_number__resize</code>, where <em>device_address</em> is the address of your GPU, such as <code>0000:03:00.0</code> (note that for changing this parameter, no driver can be loaded for the device).</p>
<p>You can confirm values using <code>lspci -vvvxxxx</code>.</p>
<h4 id="直通-ax200-没有蓝牙解决">直通 AX200 没有蓝牙（解决）<a class="headerlink" href="#直通-ax200-没有蓝牙解决" title="Permanent link">&para;</a></h4>
<p><a href="https://forums.unraid.net/topic/120168-%E6%B1%82%E5%8A%A9-vm%E7%9B%B4%E9%80%9Aax210%E8%93%9D%E7%89%99%E9%81%87%E5%88%B0%E9%97%AE%E9%A2%98/">[求助] VM 直通 AX210 蓝牙遇到问题 - Chinese / 简体中文 - Unraid</a></p>
<ul>
<li>看到别人都是 lsusb 能看到集成的蓝牙，但是我的没有。</li>
</ul>
<p><a href="https://bbs.archlinux.org/viewtopic.php?id=272643">[SOLVED] No bluetooth adaptater on AX200 / Kernel &amp; Hardware / Arch Linux Forums</a>
我的输出没有任何 firware load 的信息</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>root@ryzen-pve ➜  ~ dmesg | grep firm
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>[    0.512405] Spectre V2 : Enabling Restricted Speculation for firmware calls
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>[    7.689816] platform regulatory.0: Direct firmware load for regulatory.db failed with error -2
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>root@ryzen-pve ➜  ~ ls /lib/firmware |grep a0
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>iwlwifi-cc-a0-66.ucode.xz
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>iwlwifi-cc-a0-72.ucode.xz
</span></code></pre></div>
<p>我这里没有 AX200 Bluetooth，这是别人的输出</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>[(16:36:45)xeph:~]lsusb
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>Bus 003 Device 003: ID 8087:0029 Intel Corp. AX200 Bluetooth
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>Bus 003 Device 002: ID 046d:c52b Logitech, Inc. Unifying Receiver
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>Bus 002 Device 002: ID 05e3:0620 Genesys Logic, Inc. GL3523 Hub
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>Bus 001 Device 004: ID 048d:c101 Integrated Technology Express, Inc. ITE Device(8910)
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>Bus 001 Device 003: ID 13d3:56ff IMC Networks Integrated Camera
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a>Bus 001 Device 002: ID 05e3:0610 Genesys Logic, Inc. Hub
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span></code></pre></div>
<p>感觉可能是因为绑定了 vifo-pci 导致的？
<a href="https://forums.unraid.net/topic/119920-does-anyone-know-how-to-pass-through-the-wi-fi-6-ax200-network-card-to-a-virtual-machine-with-kali-linux-os/">Does anyone know how to pass through the Wi Fi 6 ax200 network card to a virtual machine with Kali Linux OS? - VM Engine (KVM) - Unraid --- 有谁知道如何通过 Wi Fi 6 ax200 网卡传递到带有 Kali Linux 操作系统的虚拟机？- 虚拟机引擎（KVM） - 取消突袭</a>
<a href="https://forums.unraid.net/bug-reports/prereleases/6100-rc1-onboard-bluetooth-no-longer-able-to-passthrough-to-vm-r1524/">[6.10.0-RC1] Onboard Bluetooth no longer able to passthrough to VM - Prereleases - Unraid --- [6.10.0-RC1]板载蓝牙无法再直通到 VM - 售前赛 - 取消突袭</a></p>
<p>好像和我一样，蓝牙从 usb 中消失
<a href="https://forum.proxmox.com/threads/pve-7-4-home-assistant-intel-ax200-bluetooth-issues.126014/">PVE 7.4 + Home Assistant: Intel AX200 Bluetooth issues | Proxmox Support Forum --- PVE 7.4 + 家庭助理：英特尔 AX200 蓝牙问题 |Proxmox 支持论坛</a></p>
<p>旧笔记本上的 ax200 lsusb 确实能看到设备</p>
<p>update：可能原因确实是绑定了 vifo-pci，导致没有看到 bluetooth。后面不知道怎么能看到 usb 蓝牙了。
但在 win10 虚拟机中，无法识别设备</p>
<p>解决方法为blacklist 蓝牙驱动</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>modprobe -r btusb
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>modprobe -r bluetooth
</span></code></pre></div>
<h4 id="显卡不能连接多显示器">显卡不能连接多显示器<a class="headerlink" href="#显卡不能连接多显示器" title="Permanent link">&para;</a></h4>
<p><img alt="" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/%E6%AD%A4GPU%E6%94%AF%E6%8C%81%E4%B8%80%E5%8F%B0%E6%98%BE%E7%A4%BA%E5%99%A8.png" /></p>
<p>nvidia 控制面板显示该显卡只支持一个显示器。</p>
<p>可能的解决：直通显卡时添加了 rom 文件</p>
<h3 id="参考资料">参考资料<a class="headerlink" href="#参考资料" title="Permanent link">&para;</a></h3>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.1/html/installation_guide/appe-configuring_a_hypervisor_host_for_pci_passthrough">Appendix G. Configuring a Host for PCI Passthrough Red Hat Virtualization 4.1 | Red Hat Customer Portal --- 附录 G. 为 PCI 直通配置主机 红帽虚拟化 4.1 |红帽客户门户</a></p>
<p>iommu=pt 能够提高性能
If <code>intel_iommu=on</code> or <code>amd_iommu=on</code> works, you can try replacing them with <code>iommu=pt</code> or <code>amd_iommu=pt</code>. The <code>pt</code> option <strong>only enables IOMMU for devices used in passthrough and will provide better host performance.</strong> However, the option may not be supported on all hardware. Revert to previous option if the <code>pt</code> option doesn't work for your host.</p>
<p>allow_unsafe_interrupts 选项
If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the <code>allow_unsafe_interrupts</code> option if the virtual machines are trusted. The <code>allow_unsafe_interrupts</code> is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:</p>
<h4 id="gentoo-wiki">gentoo wiki<a class="headerlink" href="#gentoo-wiki" title="Permanent link">&para;</a></h4>
<p><a href="https://wiki.gentoo.org/wiki/GPU_passthrough_with_libvirt_qemu_kvm">GPU passthrough with libvirt qemu kvm - Gentoo wiki</a></p>
<h4 id="redhat">redhat<a class="headerlink" href="#redhat" title="Permanent link">&para;</a></h4>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4">Product Documentation for Red Hat Virtualization 4.4 | Red Hat Customer Portal</a>
<a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/pdf/setting_up_an_nvidia_gpu_for_a_virtual_machine_in_red_hat_virtualization/red_hat_virtualization-4.4-setting_up_an_nvidia_gpu_for_a_virtual_machine_in_red_hat_virtualization-en-us.pdf">Red Hat Virtualization 4.4 Setting up an NVIDIA GPU for a virtual machine in Red Hat Virtualization</a></p>
<h2 id="qemu-参数与隐藏虚拟化">qemu 参数与隐藏虚拟化<a class="headerlink" href="#qemu-参数与隐藏虚拟化" title="Permanent link">&para;</a></h2>
<h3 id="参考资料_1">参考资料<a class="headerlink" href="#参考资料_1" title="Permanent link">&para;</a></h3>
<ul>
<li>方法1 设置 qemu 参数隐藏：<a href="https://docs.vrchat.com/docs/using-vrchat-in-a-virtual-machine#qemu">Using VRChat in a Virtual Machine</a>
    - 启用 <code>hypervisor=on</code> 的情况下的绕过
    - 介绍了一个个启用 <code>hv-foo</code> 和使用 <code>hv-passthrough=on</code> 的区别
    - 有关于 qemu SMBIOS 设置的介绍和脚本</li>
<li>方法2 修改 qemu 源码：<a href="https://github.com/zhaodice/proxmox-ve-anti-detection">zhaodice/proxmox-ve-anti-detection: A patch to hide PVE itself</a></li>
<li>是否可以在 VM 中再运行 WSL2 虚拟机？
    - WLS2 on Win11 VM。25% slower。<a href="https://www.onemarcfifty.com/blog/HyperV-Proxmox/#how-to-run-hyper-v-on-proxmox">Windows 11 with Hyper-V on Proxmox - onemarcfifty</a></li>
</ul>
<h3 id="qemu-参数研究">qemu 参数研究<a class="headerlink" href="#qemu-参数研究" title="Permanent link">&para;</a></h3>
<p>使用如下命令可以查看 pve 运行虚拟机的 qemu 命令
<div class="language-text highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>qm showcmd vmid
</span></code></pre></div></p>
<p>原来x86-64-v3，已经带了这些参数了
<div class="language-text highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>-cpu &#39;qemu64,+abm,+aes,+avx,+avx2,+bmi1,+bmi2,enforce,+f16c,+fma,hv_ipi,hv_relaxed,hv_reset,hv_runtime,hv_spinlocks=0x1fff,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,+kvm_pv_eoi,+kvm_pv_unhalt,+movbe,+pni,+popcnt,+sse4.1,+sse4.2,+ssse3,+xsave&#39;
</span></code></pre></div></p>
<h4 id="cpu-type">cpu type<a class="headerlink" href="#cpu-type" title="Permanent link">&para;</a></h4>
<p><a href="https://qemu-project.gitlab.io/qemu/system/qemu-cpu-models.html">QEMU / KVM CPU model configuration — QEMU documentation</a></p>
<ul>
<li>两种 CPU 方法：
    - host passthrough：无法 live 迁移
    - named model</li>
</ul>
<blockquote>
<p>QEMU comes with a number of predefined named CPU models, that typically refer to specific generations of hardware released by Intel and AMD. These allow the guest VMs to have a degree of isolation from the host CPU, allowing greater flexibility in live migrating between hosts with differing hardware.</p>
</blockquote>
<p>在两种情况下，都可以启用或者禁用一些特性</p>
<blockquote>
<p>In both cases, it is possible to optionally add or remove individual CPU features, to alter what is presented to the guest by default.</p>
</blockquote>
<p>x86-64 兼容等级，传统的操作系统和工具链采用默认的等级（x86-64-v1），但是未来的软件可能采用更高的等级。</p>
<blockquote>
<p>Traditionally most operating systems and toolchains would only target the original baseline ABI. It is expected that in future OS and toolchains are likely to target newer ABIs.</p>
</blockquote>
<p><a href="https://gitlab.com/x86-psABIs/x86-64-ABI/">x86 psABIs / x86-64 psABI · GitLab</a></p>
<h4 id="hyper-v-enlightenments">Hyper-V Enlightenments<a class="headerlink" href="#hyper-v-enlightenments" title="Permanent link">&para;</a></h4>
<p>Hyper-V Enlightenments: <a href="https://www.qemu.org/docs/master/system/i386/hyperv.html#hyper-v-enlightenments">Hyper-V Enlightenments — QEMU documentation</a></p>
<ul>
<li>提示 windows 操作系统加速某些特性，类似于一种半虚拟化。</li>
</ul>
<blockquote>
<p>In some cases when implementing a hardware interface in software is slow, KVM implements its own paravirtualized interfaces. This works well for Linux as guest support for such features is added simultaneously with the feature itself. It may, however, be hard-to-impossible to add support for these interfaces to proprietary OSes, namely, Microsoft Windows.
KVM on x86 implements Hyper-V Enlightenments for Windows guests. These features make Windows and Hyper-V guests think they’re running on top of a Hyper-V compatible hypervisor and use Hyper-V specific features.</p>
</blockquote>
<h4 id="让-windows-任务管理器不显示虚拟机最小配置">让 windows 任务管理器不显示虚拟机最小配置<a class="headerlink" href="#让-windows-任务管理器不显示虚拟机最小配置" title="Permanent link">&para;</a></h4>
<ul>
<li><code>cpu: host,hidden=1</code>：pve CPU 类型加上 hidden 不行</li>
<li><code>-cpu kvm=off</code>：不行
    - <code>kvm=off</code> ：kvm=off don't touch kvm acceleration, just changes visibility of KVM to guests.</li>
</ul>
<p>成功让任务管理器显示非虚拟机</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>args: -cpu &#39;host,-hypervisor,kvm=off,+kvm_pv_unhalt,+kvm_pv_eoi,hv_spinlocks=0x1fff,hv_vapic,hv_time,hv_reset,hv_vpindex,hv_runtime,hv_relaxed,hv_vendor_id=intel&#39;
</span></code></pre></div>
<p><code>hv_vendor_id</code>  可以随便填。并不是表示intel CPU的意思。</p>
<p><img alt="image.png" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/20240723000118.png" /></p>
<p>是否仅需（待测试）：<code>args: -cpu host,-hypervisor,hv_vendor_id=amd</code></p>
<h3 id="调节-qemu--cpu-参数">调节 qemu -cpu 参数<a class="headerlink" href="#调节-qemu--cpu-参数" title="Permanent link">&para;</a></h3>
<p>VRChat 虚拟机运行（居然是官方文档）：<a href="https://docs.vrchat.com/docs/using-vrchat-in-a-virtual-machine#qemu">Using VRChat in a Virtual Machine</a></p>
<ul>
<li>设置1
<div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>-cpu &#39;host,migratable=off,hypervisor=on,topoext=on,hv_relaxed,hv_reset,hv_runtime,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,hv-frequencies,hv-avic,hv-vendor-id=0123456789AB,host-cache-info=on,apic=on,invtsc=on&#39;
</span></code></pre></div></li>
<li>设置2
    - 这个方案启用了 hv-passthrogth，是不推荐的。会启用所有 KVM 支持的 Hyper-V entitlments，可能硬件不支持一些选项
<div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>-cpu host,migratable=off,hypervisor=on,invtsc=on,hv-time=on,hv-passthrough=on
</span></code></pre></div></li>
<li>设置3
    - 增加一些 <code>-smbios type=#,...</code>，使得看得更像真实硬件。
    - 获取脚本：https://gist.github.com/kiler129/5d437a37c07ac6eb1cdf0e595e488fd2</li>
</ul>
<p>设置1 +设置3 可用配置
<div class="language-text highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>args: -cpu &#39;host,kvm=off,migratable=off,hypervisor=on,topoext=on,hv_relaxed,hv_reset,hv_runtime,hv_stimer,hv_synic,hv_time,hv_vapic,hv_vpindex,hv-frequencies,hv-avic,hv-vendor-id=0123456789AB,host-cache-info=on,apic=on,invtsc=on&#39; -smbios &#39;type=0,version=2803,vendor=American Megatrends Inc.,uefi=on,release=5.17,date=04/27/2022&#39; -smbios &#39;type=1,version=System Version,sku=SKU,product=System Product Name,manufacturer=ASUS,uuid=1eb6d23f-6e89-a8c6-1bca-7c10c9a253d8,serial=System Serial Number,family=To be filled by O.E.M.&#39; -smbios &#39;type=2,asset=Default string,version=Rev X.0x,product=TUF GAMING B550M-PLUS (WI-FI),location=Default string,manufacturer=ASUSTeK COMPUTER INC.,serial=210686671502915&#39; -smbios &#39;type=3,asset=Default string,version=Default string,sku=Default string,manufacturer=Default string,serial=Default string&#39; -smbios &#39;type=4,asset=Unknown,version=AMD Ryzen 7 5800X 8-Core Processor             ,part=Zen,manufacturer=Advanced Micro Devices,, Inc.,serial=Unknown,sock_pfx=AM4&#39; -smbios &#39;type=11,value=Default string&#39; -smbios &#39;type=17,bank=Bank 0,asset=Not Specified,part=YPT4U2666D19161C,manufacturer=GLOWAY,speed=3200,serial=31EEBDB8,loc_pfx=DIMM 0&#39;
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>balloon: 0
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a>bios: ovmf
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>boot: order=scsi0;sata0
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>cores: 16
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a>cpu: host,hidden=1
</span></code></pre></div></p>
<h4 id="游戏例子">游戏例子<a class="headerlink" href="#游戏例子" title="Permanent link">&para;</a></h4>
<ul>
<li>EasyAntiCheat（<strong>EAC</strong>）
    - <strong>VRChat</strong>
    - 原神</li>
<li>腾讯 ACE
    - 即使 windows 不显示虚拟机了，仍然反作弊报错。寄，网上找不到解决办法</li>
</ul>
<h3 id="pve-anti-cheat-项目">pve-anti-cheat 项目<a class="headerlink" href="#pve-anti-cheat-项目" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/zhaodice/proxmox-ve-anti-detection">zhaodice/proxmox-ve-anti-detection: A patch to hide PVE itself</a>
<a href="https://github.com/zhaodice/qemu-anti-detection">zhaodice/qemu-anti-detection: A patch to hide qemu itself, bypass mhyprot,EAC,nProtect / VMProtect,VProtect, Themida, Enigma Protector,Safegine Shielden</a>
原理：更改 qemu 字符串，伪装成真实硬件型号</p>
<p>目前支持的反作弊</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Engine</th>
<th>Bypass</th>
</tr>
</thead>
<tbody>
<tr>
<td>AntiCheat</td>
<td>Anti Cheat Expert (ACE)</td>
<td>☑️</td>
</tr>
<tr>
<td>AntiCheat</td>
<td>Easy Anti Cheat (EAC)</td>
<td>☑️</td>
</tr>
<tr>
<td>AntiCheat</td>
<td>Gepard Shield</td>
<td>☑️ (Needs patched kernel on host: <a href="https://github.com/WCharacter/RDTSC-KVM-Handler">https://github.com/WCharacter/RDTSC-KVM-Handler</a> )</td>
</tr>
<tr>
<td>AntiCheat</td>
<td>Mhyprot</td>
<td>☑️</td>
</tr>
<tr>
<td>AntiCheat</td>
<td>nProtect GameGuard (NP)</td>
<td>☑️</td>
</tr>
<tr>
<td>AntiCheat</td>
<td>Roblox</td>
<td>☑️ May work with Hyper-V in the guest: <a href="https://github.com/zhaodice/qemu-anti-detection/issues/56">#56</a></td>
</tr>
<tr>
<td>AntiCheat</td>
<td>Vanguard</td>
<td>‼️(1: Incorrect function)</td>
</tr>
<tr>
<td>Encrypt</td>
<td>Enigma Protector</td>
<td>☑️</td>
</tr>
<tr>
<td>Encrypt</td>
<td>Safegine Shielden</td>
<td>☑️</td>
</tr>
<tr>
<td>Encrypt</td>
<td>Themida</td>
<td>☑️</td>
</tr>
<tr>
<td>Encrypt</td>
<td>VMProtect</td>
<td>☑️</td>
</tr>
<tr>
<td>Encrypt</td>
<td>VProtect</td>
<td>☑️</td>
</tr>
</tbody>
</table>
<p>原版不更新了，支持版本有限，fork 版本
<a href="https://github.com/lixiaoliu666/pve-anti-detection">lixiaoliu666/pve-anti-detection: PVE virtual machine emulates a physical machine to avoid(or anti) detection（pve虚拟机模拟真实机器防检测）</a></p>
<ul>
<li>action 自动编译最新 pve qemu 版本</li>
<li>安装 deb 即可，不需要自己手动编译</li>
</ul>
<p>PVE 8.2.7，仅手动安装 <a href="https://github.com/lixiaoliu666/pve-anti-detection/releases/download/v20250311-225319/pve-qemu-kvm_9.2.0-2_amd64.deb">pve-qemu-kvm_9.2.0-2_amd64.deb</a> 了，win11 虚拟机甚至没重启，居然已经生效了。</p>
<p>cpu 设置为 x86-v3 的情况下，可以启动 VRChat 和 ACE 软件。</p>
<h2 id="其它问题">其它问题<a class="headerlink" href="#其它问题" title="Permanent link">&para;</a></h2>
<h3 id="修改-hostname-寄">修改 hostname 寄<a class="headerlink" href="#修改-hostname-寄" title="Permanent link">&para;</a></h3>
<p><a href="https://web-wilke.de/fix-proxmox-error-after-hostname-ip-change/">Fix Proxmox Error after hostname/ip change (web-wilke.de)</a>
修改了 hostname 后，容器虚拟机都看不见了。尝试修改/etc/hosts 但是不够，最后没弄好，还是改回原来的 hostname 了。</p>
<h3 id="备份单个-disk">备份单个 disk<a class="headerlink" href="#备份单个-disk" title="Permanent link">&para;</a></h3>
<p>zfs 自己备份可以吗？
我创建的 VM 不知为何不支持快照。</p>
<p><a href="https://forum.proxmox.com/threads/backup-single-disk-in-vm.94543/">backup single disk in VM | Proxmox Support Forum</a></p>
<h3 id="zerotier-无法启动">zerotier 无法启动<a class="headerlink" href="#zerotier-无法启动" title="Permanent link">&para;</a></h3>
<p><a href="https://pve.proxmox.com/wiki/OpenVPN_in_LXC">OpenVPN in LXC - Proxmox VE</a></p>
<p>特权容器或添加权限</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>vim /etc/pve/lxc/100.conf
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>...
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>onboot: 1
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a>ostype: unmanaged
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>parent: basic
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>rootfs: local-zfs:subvol-100-disk-0,size=100G
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a>swap: 0
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a>unprivileged: 1
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a>lxc.cgroup2.devices.allow: c 10:200 rwm
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>lxc.mount.entry: /dev/net dev/net none bind,create=dir
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a>[basic]
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a>#%E5%9F%BA%E6%9C%AC%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8Cddns%EF%BC%8Cwg_s2s%E5%8F%AF%E4%BB%A5%E8%BF%9E%E6%8E%A5op1,op3
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a>arch: amd64
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a>cores: 2
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a>hostname: op2
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>chown 100000:100000 /dev/net/tun
</span></code></pre></div>
<h3 id="磁盘测速">磁盘测速<a class="headerlink" href="#磁盘测速" title="Permanent link">&para;</a></h3>
<p>ryzen 虚拟机</p>
<h4 id="pcie40-爱国者-2t">pcie4.0 爱国者 2T<a class="headerlink" href="#pcie40-爱国者-2t" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>➜  fio sudo fio --filename=test.bin ssd-win-likely.fio
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>seq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>seq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>rand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>rand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>fio-3.28
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>Starting 4 processes
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a>seq-read-4m: Laying out IO file (1 file / 10240MiB)
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a>Jobs: 1 (f=1): [_(3),w(1)][68.5%][w=80.5MiB/s][w=20.6k IOPS][eta 01m:10s]
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>seq-read-4m: (groupid=0, jobs=1): err= 0: pid=778450: Fri Sep 29 23:47:57 2023
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a>  read: IOPS=556, BW=2226MiB/s (2334MB/s)(10.0GiB/4600msec)
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a>    slat (usec): min=47, max=7932, avg=478.16, stdev=665.62
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a>    clat (msec): min=8, max=162, avg=56.62, stdev=22.04
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a>     lat (msec): min=8, max=162, avg=57.10, stdev=21.94
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a>    clat percentiles (msec):
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a>     |  1.00th=[   15],  5.00th=[   23], 10.00th=[   28], 20.00th=[   36],
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a>     | 30.00th=[   44], 40.00th=[   51], 50.00th=[   59], 60.00th=[   64],
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a>     | 70.00th=[   69], 80.00th=[   74], 90.00th=[   82], 95.00th=[   91],
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a>     | 99.00th=[  131], 99.50th=[  142], 99.90th=[  159], 99.95th=[  161],
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a>     | 99.99th=[  163]
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a>   bw (  MiB/s): min= 1993, max= 2336, per=99.89%, avg=2223.66, stdev=118.21, samples=8
</span><span id="__span-92-22"><a id="__codelineno-92-22" name="__codelineno-92-22" href="#__codelineno-92-22"></a>   iops        : min=  498, max=  584, avg=555.63, stdev=29.56, samples=8
</span><span id="__span-92-23"><a id="__codelineno-92-23" name="__codelineno-92-23" href="#__codelineno-92-23"></a>  lat (msec)   : 10=0.08%, 20=3.01%, 50=36.45%, 100=58.32%, 250=2.15%
</span><span id="__span-92-24"><a id="__codelineno-92-24" name="__codelineno-92-24" href="#__codelineno-92-24"></a>  cpu          : usr=0.89%, sys=25.74%, ctx=2221, majf=1, minf=32780
</span><span id="__span-92-25"><a id="__codelineno-92-25" name="__codelineno-92-25" href="#__codelineno-92-25"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%
</span><span id="__span-92-26"><a id="__codelineno-92-26" name="__codelineno-92-26" href="#__codelineno-92-26"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-27"><a id="__codelineno-92-27" name="__codelineno-92-27" href="#__codelineno-92-27"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-28"><a id="__codelineno-92-28" name="__codelineno-92-28" href="#__codelineno-92-28"></a>     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-92-29"><a id="__codelineno-92-29" name="__codelineno-92-29" href="#__codelineno-92-29"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-92-30"><a id="__codelineno-92-30" name="__codelineno-92-30" href="#__codelineno-92-30"></a>seq-write-4m: (groupid=1, jobs=1): err= 0: pid=778524: Fri Sep 29 23:47:57 2023
</span><span id="__span-92-31"><a id="__codelineno-92-31" name="__codelineno-92-31" href="#__codelineno-92-31"></a>  write: IOPS=82, BW=330MiB/s (346MB/s)(10.0GiB/31034msec); 0 zone resets
</span><span id="__span-92-32"><a id="__codelineno-92-32" name="__codelineno-92-32" href="#__codelineno-92-32"></a>    slat (usec): min=76, max=221964, avg=1061.67, stdev=5512.31
</span><span id="__span-92-33"><a id="__codelineno-92-33" name="__codelineno-92-33" href="#__codelineno-92-33"></a>    clat (msec): min=4, max=7483, avg=385.10, stdev=1126.37
</span><span id="__span-92-34"><a id="__codelineno-92-34" name="__codelineno-92-34" href="#__codelineno-92-34"></a>     lat (msec): min=5, max=7484, avg=386.16, stdev=1126.51
</span><span id="__span-92-35"><a id="__codelineno-92-35" name="__codelineno-92-35" href="#__codelineno-92-35"></a>    clat percentiles (msec):
</span><span id="__span-92-36"><a id="__codelineno-92-36" name="__codelineno-92-36" href="#__codelineno-92-36"></a>     |  1.00th=[   12],  5.00th=[   22], 10.00th=[   27], 20.00th=[   34],
</span><span id="__span-92-37"><a id="__codelineno-92-37" name="__codelineno-92-37" href="#__codelineno-92-37"></a>     | 30.00th=[   43], 40.00th=[   52], 50.00th=[   64], 60.00th=[   74],
</span><span id="__span-92-38"><a id="__codelineno-92-38" name="__codelineno-92-38" href="#__codelineno-92-38"></a>     | 70.00th=[   96], 80.00th=[  142], 90.00th=[  502], 95.00th=[ 2970],
</span><span id="__span-92-39"><a id="__codelineno-92-39" name="__codelineno-92-39" href="#__codelineno-92-39"></a>     | 99.00th=[ 5604], 99.50th=[ 5604], 99.90th=[ 7483], 99.95th=[ 7483],
</span><span id="__span-92-40"><a id="__codelineno-92-40" name="__codelineno-92-40" href="#__codelineno-92-40"></a>     | 99.99th=[ 7483]
</span><span id="__span-92-41"><a id="__codelineno-92-41" name="__codelineno-92-41" href="#__codelineno-92-41"></a>   bw (  KiB/s): min=65667, max=2682078, per=100.00%, avg=823187.87, stdev=652362.03, samples=24
</span><span id="__span-92-42"><a id="__codelineno-92-42" name="__codelineno-92-42" href="#__codelineno-92-42"></a>   iops        : min=   16, max=  654, avg=200.58, stdev=159.18, samples=24
</span><span id="__span-92-43"><a id="__codelineno-92-43" name="__codelineno-92-43" href="#__codelineno-92-43"></a>  lat (msec)   : 10=0.82%, 20=2.77%, 50=34.80%, 100=32.73%, 250=15.51%
</span><span id="__span-92-44"><a id="__codelineno-92-44" name="__codelineno-92-44" href="#__codelineno-92-44"></a>  lat (msec)   : 500=3.20%, 750=1.64%, 1000=0.55%, 2000=1.41%, &gt;=2000=6.56%
</span><span id="__span-92-45"><a id="__codelineno-92-45" name="__codelineno-92-45" href="#__codelineno-92-45"></a>  cpu          : usr=3.45%, sys=5.12%, ctx=1899, majf=0, minf=15
</span><span id="__span-92-46"><a id="__codelineno-92-46" name="__codelineno-92-46" href="#__codelineno-92-46"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%
</span><span id="__span-92-47"><a id="__codelineno-92-47" name="__codelineno-92-47" href="#__codelineno-92-47"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-48"><a id="__codelineno-92-48" name="__codelineno-92-48" href="#__codelineno-92-48"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-49"><a id="__codelineno-92-49" name="__codelineno-92-49" href="#__codelineno-92-49"></a>     issued rwts: total=0,2560,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-92-50"><a id="__codelineno-92-50" name="__codelineno-92-50" href="#__codelineno-92-50"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-92-51"><a id="__codelineno-92-51" name="__codelineno-92-51" href="#__codelineno-92-51"></a>rand-read-4k: (groupid=2, jobs=1): err= 0: pid=778956: Fri Sep 29 23:47:57 2023
</span><span id="__span-92-52"><a id="__codelineno-92-52" name="__codelineno-92-52" href="#__codelineno-92-52"></a>  read: IOPS=50.4k, BW=197MiB/s (207MB/s)(10.0GiB/51982msec)
</span><span id="__span-92-53"><a id="__codelineno-92-53" name="__codelineno-92-53" href="#__codelineno-92-53"></a>    slat (nsec): min=1170, max=3868.5k, avg=4517.95, stdev=7664.76
</span><span id="__span-92-54"><a id="__codelineno-92-54" name="__codelineno-92-54" href="#__codelineno-92-54"></a>    clat (nsec): min=220, max=1695.1M, avg=74038.40, stdev=2120026.59
</span><span id="__span-92-55"><a id="__codelineno-92-55" name="__codelineno-92-55" href="#__codelineno-92-55"></a>     lat (usec): min=12, max=1695.1k, avg=78.64, stdev=2120.05
</span><span id="__span-92-56"><a id="__codelineno-92-56" name="__codelineno-92-56" href="#__codelineno-92-56"></a>    clat percentiles (usec):
</span><span id="__span-92-57"><a id="__codelineno-92-57" name="__codelineno-92-57" href="#__codelineno-92-57"></a>     |  1.00th=[   18],  5.00th=[   21], 10.00th=[   23], 20.00th=[   26],
</span><span id="__span-92-58"><a id="__codelineno-92-58" name="__codelineno-92-58" href="#__codelineno-92-58"></a>     | 30.00th=[   33], 40.00th=[   76], 50.00th=[   81], 60.00th=[   84],
</span><span id="__span-92-59"><a id="__codelineno-92-59" name="__codelineno-92-59" href="#__codelineno-92-59"></a>     | 70.00th=[   88], 80.00th=[   93], 90.00th=[  105], 95.00th=[  123],
</span><span id="__span-92-60"><a id="__codelineno-92-60" name="__codelineno-92-60" href="#__codelineno-92-60"></a>     | 99.00th=[  210], 99.50th=[  293], 99.90th=[  627], 99.95th=[ 1074],
</span><span id="__span-92-61"><a id="__codelineno-92-61" name="__codelineno-92-61" href="#__codelineno-92-61"></a>     | 99.99th=[ 1975]
</span><span id="__span-92-62"><a id="__codelineno-92-62" name="__codelineno-92-62" href="#__codelineno-92-62"></a>   bw (  KiB/s): min= 5643, max=270960, per=100.00%, avg=205429.51, stdev=34312.15, samples=101
</span><span id="__span-92-63"><a id="__codelineno-92-63" name="__codelineno-92-63" href="#__codelineno-92-63"></a>   iops        : min= 1410, max=67740, avg=51357.30, stdev=8578.07, samples=101
</span><span id="__span-92-64"><a id="__codelineno-92-64" name="__codelineno-92-64" href="#__codelineno-92-64"></a>  lat (nsec)   : 250=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%
</span><span id="__span-92-65"><a id="__codelineno-92-65" name="__codelineno-92-65" href="#__codelineno-92-65"></a>  lat (usec)   : 2=0.01%, 10=0.01%, 20=4.52%, 50=32.03%, 100=50.56%
</span><span id="__span-92-66"><a id="__codelineno-92-66" name="__codelineno-92-66" href="#__codelineno-92-66"></a>  lat (usec)   : 250=12.11%, 500=0.62%, 750=0.08%, 1000=0.02%
</span><span id="__span-92-67"><a id="__codelineno-92-67" name="__codelineno-92-67" href="#__codelineno-92-67"></a>  lat (msec)   : 2=0.05%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%
</span><span id="__span-92-68"><a id="__codelineno-92-68" name="__codelineno-92-68" href="#__codelineno-92-68"></a>  lat (msec)   : 500=0.01%, 2000=0.01%
</span><span id="__span-92-69"><a id="__codelineno-92-69" name="__codelineno-92-69" href="#__codelineno-92-69"></a>  cpu          : usr=7.47%, sys=29.84%, ctx=1440214, majf=0, minf=21
</span><span id="__span-92-70"><a id="__codelineno-92-70" name="__codelineno-92-70" href="#__codelineno-92-70"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-92-71"><a id="__codelineno-92-71" name="__codelineno-92-71" href="#__codelineno-92-71"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-72"><a id="__codelineno-92-72" name="__codelineno-92-72" href="#__codelineno-92-72"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-73"><a id="__codelineno-92-73" name="__codelineno-92-73" href="#__codelineno-92-73"></a>     issued rwts: total=2621440,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-92-74"><a id="__codelineno-92-74" name="__codelineno-92-74" href="#__codelineno-92-74"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-92-75"><a id="__codelineno-92-75" name="__codelineno-92-75" href="#__codelineno-92-75"></a>rand-write-4k: (groupid=3, jobs=1): err= 0: pid=779798: Fri Sep 29 23:47:57 2023
</span><span id="__span-92-76"><a id="__codelineno-92-76" name="__codelineno-92-76" href="#__codelineno-92-76"></a>  write: IOPS=20.3k, BW=79.1MiB/s (83.0MB/s)(4748MiB/60005msec); 0 zone resets
</span><span id="__span-92-77"><a id="__codelineno-92-77" name="__codelineno-92-77" href="#__codelineno-92-77"></a>    slat (nsec): min=1270, max=418621k, avg=6166.83, stdev=381021.38
</span><span id="__span-92-78"><a id="__codelineno-92-78" name="__codelineno-92-78" href="#__codelineno-92-78"></a>    clat (nsec): min=290, max=1815.5M, avg=190356.30, stdev=6618668.74
</span><span id="__span-92-79"><a id="__codelineno-92-79" name="__codelineno-92-79" href="#__codelineno-92-79"></a>     lat (usec): min=16, max=1815.5k, avg=196.62, stdev=6629.88
</span><span id="__span-92-80"><a id="__codelineno-92-80" name="__codelineno-92-80" href="#__codelineno-92-80"></a>    clat percentiles (usec):
</span><span id="__span-92-81"><a id="__codelineno-92-81" name="__codelineno-92-81" href="#__codelineno-92-81"></a>     |  1.00th=[   21],  5.00th=[   26], 10.00th=[   30], 20.00th=[   52],
</span><span id="__span-92-82"><a id="__codelineno-92-82" name="__codelineno-92-82" href="#__codelineno-92-82"></a>     | 30.00th=[   83], 40.00th=[   87], 50.00th=[   91], 60.00th=[   95],
</span><span id="__span-92-83"><a id="__codelineno-92-83" name="__codelineno-92-83" href="#__codelineno-92-83"></a>     | 70.00th=[  102], 80.00th=[  120], 90.00th=[  188], 95.00th=[  318],
</span><span id="__span-92-84"><a id="__codelineno-92-84" name="__codelineno-92-84" href="#__codelineno-92-84"></a>     | 99.00th=[ 1844], 99.50th=[ 2008], 99.90th=[ 4424], 99.95th=[ 7635],
</span><span id="__span-92-85"><a id="__codelineno-92-85" name="__codelineno-92-85" href="#__codelineno-92-85"></a>     | 99.99th=[20579]
</span><span id="__span-92-86"><a id="__codelineno-92-86" name="__codelineno-92-86" href="#__codelineno-92-86"></a>   bw (  KiB/s): min= 1920, max=185240, per=100.00%, avg=88600.73, stdev=62711.61, samples=108
</span><span id="__span-92-87"><a id="__codelineno-92-87" name="__codelineno-92-87" href="#__codelineno-92-87"></a>   iops        : min=  480, max=46310, avg=22150.14, stdev=15677.91, samples=108
</span><span id="__span-92-88"><a id="__codelineno-92-88" name="__codelineno-92-88" href="#__codelineno-92-88"></a>  lat (nsec)   : 500=0.01%, 750=0.01%, 1000=0.01%
</span><span id="__span-92-89"><a id="__codelineno-92-89" name="__codelineno-92-89" href="#__codelineno-92-89"></a>  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.63%, 50=19.19%
</span><span id="__span-92-90"><a id="__codelineno-92-90" name="__codelineno-92-90" href="#__codelineno-92-90"></a>  lat (usec)   : 100=47.74%, 250=25.71%, 500=3.06%, 750=0.44%, 1000=0.25%
</span><span id="__span-92-91"><a id="__codelineno-92-91" name="__codelineno-92-91" href="#__codelineno-92-91"></a>  lat (msec)   : 2=2.46%, 4=0.39%, 10=0.08%, 20=0.02%, 50=0.01%
</span><span id="__span-92-92"><a id="__codelineno-92-92" name="__codelineno-92-92" href="#__codelineno-92-92"></a>  lat (msec)   : 100=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%, 2000=0.01%
</span><span id="__span-92-93"><a id="__codelineno-92-93" name="__codelineno-92-93" href="#__codelineno-92-93"></a>  cpu          : usr=2.85%, sys=12.76%, ctx=889109, majf=0, minf=17
</span><span id="__span-92-94"><a id="__codelineno-92-94" name="__codelineno-92-94" href="#__codelineno-92-94"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-92-95"><a id="__codelineno-92-95" name="__codelineno-92-95" href="#__codelineno-92-95"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-96"><a id="__codelineno-92-96" name="__codelineno-92-96" href="#__codelineno-92-96"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-92-97"><a id="__codelineno-92-97" name="__codelineno-92-97" href="#__codelineno-92-97"></a>     issued rwts: total=0,1215500,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-92-98"><a id="__codelineno-92-98" name="__codelineno-92-98" href="#__codelineno-92-98"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-92-99"><a id="__codelineno-92-99" name="__codelineno-92-99" href="#__codelineno-92-99"></a>
</span><span id="__span-92-100"><a id="__codelineno-92-100" name="__codelineno-92-100" href="#__codelineno-92-100"></a>Run status group 0 (all jobs):
</span><span id="__span-92-101"><a id="__codelineno-92-101" name="__codelineno-92-101" href="#__codelineno-92-101"></a>   READ: bw=2226MiB/s (2334MB/s), 2226MiB/s-2226MiB/s (2334MB/s-2334MB/s), io=10.0GiB (10.7GB), run=4600-4600msec
</span><span id="__span-92-102"><a id="__codelineno-92-102" name="__codelineno-92-102" href="#__codelineno-92-102"></a>
</span><span id="__span-92-103"><a id="__codelineno-92-103" name="__codelineno-92-103" href="#__codelineno-92-103"></a>Run status group 1 (all jobs):
</span><span id="__span-92-104"><a id="__codelineno-92-104" name="__codelineno-92-104" href="#__codelineno-92-104"></a>  WRITE: bw=330MiB/s (346MB/s), 330MiB/s-330MiB/s (346MB/s-346MB/s), io=10.0GiB (10.7GB), run=31034-31034msec
</span><span id="__span-92-105"><a id="__codelineno-92-105" name="__codelineno-92-105" href="#__codelineno-92-105"></a>
</span><span id="__span-92-106"><a id="__codelineno-92-106" name="__codelineno-92-106" href="#__codelineno-92-106"></a>Run status group 2 (all jobs):
</span><span id="__span-92-107"><a id="__codelineno-92-107" name="__codelineno-92-107" href="#__codelineno-92-107"></a>   READ: bw=197MiB/s (207MB/s), 197MiB/s-197MiB/s (207MB/s-207MB/s), io=10.0GiB (10.7GB), run=51982-51982msec
</span><span id="__span-92-108"><a id="__codelineno-92-108" name="__codelineno-92-108" href="#__codelineno-92-108"></a>
</span><span id="__span-92-109"><a id="__codelineno-92-109" name="__codelineno-92-109" href="#__codelineno-92-109"></a>Run status group 3 (all jobs):
</span><span id="__span-92-110"><a id="__codelineno-92-110" name="__codelineno-92-110" href="#__codelineno-92-110"></a>  WRITE: bw=79.1MiB/s (83.0MB/s), 79.1MiB/s-79.1MiB/s (83.0MB/s-83.0MB/s), io=4748MiB (4979MB), run=60005-60005msec
</span><span id="__span-92-111"><a id="__codelineno-92-111" name="__codelineno-92-111" href="#__codelineno-92-111"></a>
</span><span id="__span-92-112"><a id="__codelineno-92-112" name="__codelineno-92-112" href="#__codelineno-92-112"></a>Disk stats (read/write):
</span><span id="__span-92-113"><a id="__codelineno-92-113" name="__codelineno-92-113" href="#__codelineno-92-113"></a>  sdb: ios=2641793/1235910, merge=38/87, ticks=1077282/5674545, in_queue=6778554, util=94.90%
</span></code></pre></div>
<h4 id="三星-981at">三星 981at<a class="headerlink" href="#三星-981at" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>➜  fio sudo fio --directory=/root/ --filename=test.bin ssd-win-likely.fio
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>seq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>seq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>rand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>rand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>fio-3.28
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>Starting 4 processes
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>seq-read-4m: Laying out IO file (1 file / 10240MiB)
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>Jobs: 1 (f=0): [_(3),f(1)][100.0%][w=69.1MiB/s][w=17.7k IOPS][eta 00m:00s]
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>seq-read-4m: (groupid=0, jobs=1): err= 0: pid=787066: Fri Sep 29 23:56:40 2023
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a>  read: IOPS=460, BW=1841MiB/s (1930MB/s)(10.0GiB/5563msec)
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>    slat (usec): min=53, max=9744, avg=478.53, stdev=703.84
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>    clat (msec): min=9, max=889, avg=68.36, stdev=87.28
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>     lat (msec): min=10, max=889, avg=68.84, stdev=87.24
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a>    clat percentiles (msec):
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>     |  1.00th=[   16],  5.00th=[   23], 10.00th=[   28], 20.00th=[   36],
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a>     | 30.00th=[   43], 40.00th=[   51], 50.00th=[   59], 60.00th=[   67],
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>     | 70.00th=[   74], 80.00th=[   82], 90.00th=[   91], 95.00th=[  106],
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a>     | 99.00th=[  743], 99.50th=[  885], 99.90th=[  885], 99.95th=[  885],
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a>     | 99.99th=[  894]
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>   bw (  MiB/s): min=  945, max= 2324, per=100.00%, avg=1988.74, stdev=387.84, samples=10
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a>   iops        : min=  236, max=  581, avg=496.70, stdev=96.92, samples=10
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a>  lat (msec)   : 10=0.04%, 20=2.54%, 50=36.60%, 100=54.69%, 250=4.92%
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a>  lat (msec)   : 750=0.39%, 1000=0.82%
</span><span id="__span-93-25"><a id="__codelineno-93-25" name="__codelineno-93-25" href="#__codelineno-93-25"></a>  cpu          : usr=0.58%, sys=21.22%, ctx=2383, majf=0, minf=32780
</span><span id="__span-93-26"><a id="__codelineno-93-26" name="__codelineno-93-26" href="#__codelineno-93-26"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%
</span><span id="__span-93-27"><a id="__codelineno-93-27" name="__codelineno-93-27" href="#__codelineno-93-27"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-28"><a id="__codelineno-93-28" name="__codelineno-93-28" href="#__codelineno-93-28"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-29"><a id="__codelineno-93-29" name="__codelineno-93-29" href="#__codelineno-93-29"></a>     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-93-30"><a id="__codelineno-93-30" name="__codelineno-93-30" href="#__codelineno-93-30"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-93-31"><a id="__codelineno-93-31" name="__codelineno-93-31" href="#__codelineno-93-31"></a>seq-write-4m: (groupid=1, jobs=1): err= 0: pid=787186: Fri Sep 29 23:56:40 2023
</span><span id="__span-93-32"><a id="__codelineno-93-32" name="__codelineno-93-32" href="#__codelineno-93-32"></a>  write: IOPS=235, BW=940MiB/s (986MB/s)(10.0GiB/10890msec); 0 zone resets
</span><span id="__span-93-33"><a id="__codelineno-93-33" name="__codelineno-93-33" href="#__codelineno-93-33"></a>    slat (usec): min=69, max=73786, avg=783.64, stdev=3051.53
</span><span id="__span-93-34"><a id="__codelineno-93-34" name="__codelineno-93-34" href="#__codelineno-93-34"></a>    clat (msec): min=2, max=2041, avg=135.28, stdev=287.50
</span><span id="__span-93-35"><a id="__codelineno-93-35" name="__codelineno-93-35" href="#__codelineno-93-35"></a>     lat (msec): min=2, max=2042, avg=136.06, stdev=287.42
</span><span id="__span-93-36"><a id="__codelineno-93-36" name="__codelineno-93-36" href="#__codelineno-93-36"></a>    clat percentiles (msec):
</span><span id="__span-93-37"><a id="__codelineno-93-37" name="__codelineno-93-37" href="#__codelineno-93-37"></a>     |  1.00th=[   14],  5.00th=[   21], 10.00th=[   27], 20.00th=[   36],
</span><span id="__span-93-38"><a id="__codelineno-93-38" name="__codelineno-93-38" href="#__codelineno-93-38"></a>     | 30.00th=[   46], 40.00th=[   57], 50.00th=[   68], 60.00th=[   83],
</span><span id="__span-93-39"><a id="__codelineno-93-39" name="__codelineno-93-39" href="#__codelineno-93-39"></a>     | 70.00th=[  102], 80.00th=[  126], 90.00th=[  182], 95.00th=[  326],
</span><span id="__span-93-40"><a id="__codelineno-93-40" name="__codelineno-93-40" href="#__codelineno-93-40"></a>     | 99.00th=[ 2022], 99.50th=[ 2022], 99.90th=[ 2039], 99.95th=[ 2039],
</span><span id="__span-93-41"><a id="__codelineno-93-41" name="__codelineno-93-41" href="#__codelineno-93-41"></a>     | 99.99th=[ 2039]
</span><span id="__span-93-42"><a id="__codelineno-93-42" name="__codelineno-93-42" href="#__codelineno-93-42"></a>   bw (  MiB/s): min=  370, max= 2341, per=100.00%, avg=1198.88, stdev=516.41, samples=16
</span><span id="__span-93-43"><a id="__codelineno-93-43" name="__codelineno-93-43" href="#__codelineno-93-43"></a>   iops        : min=   92, max=  585, avg=299.31, stdev=129.04, samples=16
</span><span id="__span-93-44"><a id="__codelineno-93-44" name="__codelineno-93-44" href="#__codelineno-93-44"></a>  lat (msec)   : 4=0.20%, 10=0.55%, 20=4.14%, 50=29.77%, 100=34.84%
</span><span id="__span-93-45"><a id="__codelineno-93-45" name="__codelineno-93-45" href="#__codelineno-93-45"></a>  lat (msec)   : 250=24.14%, 500=2.30%, 750=1.05%, 2000=1.76%, &gt;=2000=1.25%
</span><span id="__span-93-46"><a id="__codelineno-93-46" name="__codelineno-93-46" href="#__codelineno-93-46"></a>  cpu          : usr=7.14%, sys=12.19%, ctx=1959, majf=0, minf=14
</span><span id="__span-93-47"><a id="__codelineno-93-47" name="__codelineno-93-47" href="#__codelineno-93-47"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%
</span><span id="__span-93-48"><a id="__codelineno-93-48" name="__codelineno-93-48" href="#__codelineno-93-48"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-49"><a id="__codelineno-93-49" name="__codelineno-93-49" href="#__codelineno-93-49"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-50"><a id="__codelineno-93-50" name="__codelineno-93-50" href="#__codelineno-93-50"></a>     issued rwts: total=0,2560,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-93-51"><a id="__codelineno-93-51" name="__codelineno-93-51" href="#__codelineno-93-51"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-93-52"><a id="__codelineno-93-52" name="__codelineno-93-52" href="#__codelineno-93-52"></a>rand-read-4k: (groupid=2, jobs=1): err= 0: pid=787189: Fri Sep 29 23:56:40 2023
</span><span id="__span-93-53"><a id="__codelineno-93-53" name="__codelineno-93-53" href="#__codelineno-93-53"></a>  read: IOPS=42.8k, BW=167MiB/s (175MB/s)(9.79GiB/60001msec)
</span><span id="__span-93-54"><a id="__codelineno-93-54" name="__codelineno-93-54" href="#__codelineno-93-54"></a>    slat (nsec): min=1180, max=378282k, avg=4607.87, stdev=236197.07
</span><span id="__span-93-55"><a id="__codelineno-93-55" name="__codelineno-93-55" href="#__codelineno-93-55"></a>    clat (nsec): min=240, max=1725.2M, avg=87451.41, stdev=4192102.00
</span><span id="__span-93-56"><a id="__codelineno-93-56" name="__codelineno-93-56" href="#__codelineno-93-56"></a>     lat (usec): min=12, max=1725.2k, avg=92.80, stdev=4327.60
</span><span id="__span-93-57"><a id="__codelineno-93-57" name="__codelineno-93-57" href="#__codelineno-93-57"></a>    clat percentiles (usec):
</span><span id="__span-93-58"><a id="__codelineno-93-58" name="__codelineno-93-58" href="#__codelineno-93-58"></a>     |  1.00th=[   18],  5.00th=[   21], 10.00th=[   22], 20.00th=[   26],
</span><span id="__span-93-59"><a id="__codelineno-93-59" name="__codelineno-93-59" href="#__codelineno-93-59"></a>     | 30.00th=[   30], 40.00th=[   47], 50.00th=[   92], 60.00th=[   96],
</span><span id="__span-93-60"><a id="__codelineno-93-60" name="__codelineno-93-60" href="#__codelineno-93-60"></a>     | 70.00th=[   99], 80.00th=[  104], 90.00th=[  115], 95.00th=[  129],
</span><span id="__span-93-61"><a id="__codelineno-93-61" name="__codelineno-93-61" href="#__codelineno-93-61"></a>     | 99.00th=[  212], 99.50th=[  306], 99.90th=[  578], 99.95th=[  742],
</span><span id="__span-93-62"><a id="__codelineno-93-62" name="__codelineno-93-62" href="#__codelineno-93-62"></a>     | 99.99th=[ 1893]
</span><span id="__span-93-63"><a id="__codelineno-93-63" name="__codelineno-93-63" href="#__codelineno-93-63"></a>   bw (  KiB/s): min=13755, max=264232, per=100.00%, avg=183324.63, stdev=52285.27, samples=111
</span><span id="__span-93-64"><a id="__codelineno-93-64" name="__codelineno-93-64" href="#__codelineno-93-64"></a>   iops        : min= 3438, max=66058, avg=45831.09, stdev=13071.34, samples=111
</span><span id="__span-93-65"><a id="__codelineno-93-65" name="__codelineno-93-65" href="#__codelineno-93-65"></a>  lat (nsec)   : 250=0.01%, 500=0.01%, 750=0.01%, 1000=0.01%
</span><span id="__span-93-66"><a id="__codelineno-93-66" name="__codelineno-93-66" href="#__codelineno-93-66"></a>  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=4.54%, 50=35.97%
</span><span id="__span-93-67"><a id="__codelineno-93-67" name="__codelineno-93-67" href="#__codelineno-93-67"></a>  lat (usec)   : 100=31.58%, 250=27.11%, 500=0.66%, 750=0.10%, 1000=0.03%
</span><span id="__span-93-68"><a id="__codelineno-93-68" name="__codelineno-93-68" href="#__codelineno-93-68"></a>  lat (msec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.01%, 50=0.01%
</span><span id="__span-93-69"><a id="__codelineno-93-69" name="__codelineno-93-69" href="#__codelineno-93-69"></a>  lat (msec)   : 500=0.01%, 750=0.01%, 1000=0.01%, 2000=0.01%
</span><span id="__span-93-70"><a id="__codelineno-93-70" name="__codelineno-93-70" href="#__codelineno-93-70"></a>  cpu          : usr=7.24%, sys=27.70%, ctx=1476701, majf=0, minf=20
</span><span id="__span-93-71"><a id="__codelineno-93-71" name="__codelineno-93-71" href="#__codelineno-93-71"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-93-72"><a id="__codelineno-93-72" name="__codelineno-93-72" href="#__codelineno-93-72"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-73"><a id="__codelineno-93-73" name="__codelineno-93-73" href="#__codelineno-93-73"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-74"><a id="__codelineno-93-74" name="__codelineno-93-74" href="#__codelineno-93-74"></a>     issued rwts: total=2567447,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-93-75"><a id="__codelineno-93-75" name="__codelineno-93-75" href="#__codelineno-93-75"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-93-76"><a id="__codelineno-93-76" name="__codelineno-93-76" href="#__codelineno-93-76"></a>rand-write-4k: (groupid=3, jobs=1): err= 0: pid=788193: Fri Sep 29 23:56:40 2023
</span><span id="__span-93-77"><a id="__codelineno-93-77" name="__codelineno-93-77" href="#__codelineno-93-77"></a>  write: IOPS=30.2k, BW=118MiB/s (124MB/s)(7081MiB/60001msec); 0 zone resets
</span><span id="__span-93-78"><a id="__codelineno-93-78" name="__codelineno-93-78" href="#__codelineno-93-78"></a>    slat (nsec): min=1260, max=40475k, avg=6308.96, stdev=55626.04
</span><span id="__span-93-79"><a id="__codelineno-93-79" name="__codelineno-93-79" href="#__codelineno-93-79"></a>    clat (nsec): min=300, max=1630.1M, avg=125086.99, stdev=2894812.01
</span><span id="__span-93-80"><a id="__codelineno-93-80" name="__codelineno-93-80" href="#__codelineno-93-80"></a>     lat (usec): min=17, max=1630.1k, avg=131.50, stdev=2895.61
</span><span id="__span-93-81"><a id="__codelineno-93-81" name="__codelineno-93-81" href="#__codelineno-93-81"></a>    clat percentiles (usec):
</span><span id="__span-93-82"><a id="__codelineno-93-82" name="__codelineno-93-82" href="#__codelineno-93-82"></a>     |  1.00th=[   21],  5.00th=[   25], 10.00th=[   29], 20.00th=[   49],
</span><span id="__span-93-83"><a id="__codelineno-93-83" name="__codelineno-93-83" href="#__codelineno-93-83"></a>     | 30.00th=[   94], 40.00th=[   98], 50.00th=[  101], 60.00th=[  105],
</span><span id="__span-93-84"><a id="__codelineno-93-84" name="__codelineno-93-84" href="#__codelineno-93-84"></a>     | 70.00th=[  111], 80.00th=[  119], 90.00th=[  149], 95.00th=[  221],
</span><span id="__span-93-85"><a id="__codelineno-93-85" name="__codelineno-93-85" href="#__codelineno-93-85"></a>     | 99.00th=[  498], 99.50th=[  758], 99.90th=[ 3163], 99.95th=[ 6063],
</span><span id="__span-93-86"><a id="__codelineno-93-86" name="__codelineno-93-86" href="#__codelineno-93-86"></a>     | 99.99th=[23725]
</span><span id="__span-93-87"><a id="__codelineno-93-87" name="__codelineno-93-87" href="#__codelineno-93-87"></a>   bw (  KiB/s): min=10431, max=171952, per=100.00%, avg=122835.52, stdev=47622.27, samples=112
</span><span id="__span-93-88"><a id="__codelineno-93-88" name="__codelineno-93-88" href="#__codelineno-93-88"></a>   iops        : min= 2607, max=42988, avg=30708.83, stdev=11905.58, samples=112
</span><span id="__span-93-89"><a id="__codelineno-93-89" name="__codelineno-93-89" href="#__codelineno-93-89"></a>  lat (nsec)   : 500=0.01%, 750=0.01%, 1000=0.01%
</span><span id="__span-93-90"><a id="__codelineno-93-90" name="__codelineno-93-90" href="#__codelineno-93-90"></a>  lat (usec)   : 2=0.01%, 4=0.01%, 10=0.01%, 20=0.73%, 50=19.45%
</span><span id="__span-93-91"><a id="__codelineno-93-91" name="__codelineno-93-91" href="#__codelineno-93-91"></a>  lat (usec)   : 100=25.98%, 250=49.77%, 500=3.06%, 750=0.49%, 1000=0.19%
</span><span id="__span-93-92"><a id="__codelineno-93-92" name="__codelineno-93-92" href="#__codelineno-93-92"></a>  lat (msec)   : 2=0.17%, 4=0.07%, 10=0.05%, 20=0.02%, 50=0.01%
</span><span id="__span-93-93"><a id="__codelineno-93-93" name="__codelineno-93-93" href="#__codelineno-93-93"></a>  lat (msec)   : 100=0.01%, 250=0.01%, 750=0.01%, 2000=0.01%
</span><span id="__span-93-94"><a id="__codelineno-93-94" name="__codelineno-93-94" href="#__codelineno-93-94"></a>  cpu          : usr=4.53%, sys=20.36%, ctx=1376235, majf=0, minf=16
</span><span id="__span-93-95"><a id="__codelineno-93-95" name="__codelineno-93-95" href="#__codelineno-93-95"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-93-96"><a id="__codelineno-93-96" name="__codelineno-93-96" href="#__codelineno-93-96"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-97"><a id="__codelineno-93-97" name="__codelineno-93-97" href="#__codelineno-93-97"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-93-98"><a id="__codelineno-93-98" name="__codelineno-93-98" href="#__codelineno-93-98"></a>     issued rwts: total=0,1812637,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-93-99"><a id="__codelineno-93-99" name="__codelineno-93-99" href="#__codelineno-93-99"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-93-100"><a id="__codelineno-93-100" name="__codelineno-93-100" href="#__codelineno-93-100"></a>
</span><span id="__span-93-101"><a id="__codelineno-93-101" name="__codelineno-93-101" href="#__codelineno-93-101"></a>Run status group 0 (all jobs):
</span><span id="__span-93-102"><a id="__codelineno-93-102" name="__codelineno-93-102" href="#__codelineno-93-102"></a>   READ: bw=1841MiB/s (1930MB/s), 1841MiB/s-1841MiB/s (1930MB/s-1930MB/s), io=10.0GiB (10.7GB), run=5563-5563msec
</span><span id="__span-93-103"><a id="__codelineno-93-103" name="__codelineno-93-103" href="#__codelineno-93-103"></a>
</span><span id="__span-93-104"><a id="__codelineno-93-104" name="__codelineno-93-104" href="#__codelineno-93-104"></a>Run status group 1 (all jobs):
</span><span id="__span-93-105"><a id="__codelineno-93-105" name="__codelineno-93-105" href="#__codelineno-93-105"></a>  WRITE: bw=940MiB/s (986MB/s), 940MiB/s-940MiB/s (986MB/s-986MB/s), io=10.0GiB (10.7GB), run=10890-10890msec
</span><span id="__span-93-106"><a id="__codelineno-93-106" name="__codelineno-93-106" href="#__codelineno-93-106"></a>
</span><span id="__span-93-107"><a id="__codelineno-93-107" name="__codelineno-93-107" href="#__codelineno-93-107"></a>Run status group 2 (all jobs):
</span><span id="__span-93-108"><a id="__codelineno-93-108" name="__codelineno-93-108" href="#__codelineno-93-108"></a>   READ: bw=167MiB/s (175MB/s), 167MiB/s-167MiB/s (175MB/s-175MB/s), io=9.79GiB (10.5GB), run=60001-60001msec
</span><span id="__span-93-109"><a id="__codelineno-93-109" name="__codelineno-93-109" href="#__codelineno-93-109"></a>
</span><span id="__span-93-110"><a id="__codelineno-93-110" name="__codelineno-93-110" href="#__codelineno-93-110"></a>Run status group 3 (all jobs):
</span><span id="__span-93-111"><a id="__codelineno-93-111" name="__codelineno-93-111" href="#__codelineno-93-111"></a>  WRITE: bw=118MiB/s (124MB/s), 118MiB/s-118MiB/s (124MB/s-124MB/s), io=7081MiB (7425MB), run=60001-60001msec
</span><span id="__span-93-112"><a id="__codelineno-93-112" name="__codelineno-93-112" href="#__codelineno-93-112"></a>
</span><span id="__span-93-113"><a id="__codelineno-93-113" name="__codelineno-93-113" href="#__codelineno-93-113"></a>Disk stats (read/write):
</span><span id="__span-93-114"><a id="__codelineno-93-114" name="__codelineno-93-114" href="#__codelineno-93-114"></a>  sda: ios=2588374/1830074, merge=92/389, ticks=1241127/2284278, in_queue=3529480, util=95.33%
</span></code></pre></div>
<h4 id="n5105-铠侠-rc20-500gb">n5105 铠侠 rc20 500GB<a class="headerlink" href="#n5105-铠侠-rc20-500gb" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>root@n5105-pve ➜  fio fio --filename=test.bin ssd-win-likely.fio
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>seq-read-4m: (g=0): rw=read, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>seq-write-4m: (g=1): rw=write, bs=(R) 4096KiB-4096KiB, (W) 4096KiB-4096KiB, (T) 4096KiB-4096KiB, ioengine=libaio, iodepth=32
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>rand-read-4k: (g=2): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>rand-write-4k: (g=3): rw=randwrite, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=4
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>fio-3.33
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>Starting 4 processes
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>Jobs: 1 (f=1): [_(3),w(1)][59.0%][w=3081KiB/s][w=770 IOPS][eta 02m:19s]
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a>seq-read-4m: (groupid=0, jobs=1): err= 0: pid=422690: Sat Sep 30 00:46:36 2023
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a>  read: IOPS=140, BW=560MiB/s (588MB/s)(10.0GiB/18274msec)
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a>    slat (usec): min=5966, max=22258, avg=7123.69, stdev=945.70
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a>    clat (usec): min=13, max=331888, avg=219709.66, stdev=21151.42
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a>     lat (msec): min=6, max=338, avg=226.83, stdev=21.36
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a>    clat percentiles (msec):
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a>     |  1.00th=[  180],  5.00th=[  209], 10.00th=[  211], 20.00th=[  213],
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a>     | 30.00th=[  218], 40.00th=[  218], 50.00th=[  220], 60.00th=[  222],
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a>     | 70.00th=[  222], 80.00th=[  222], 90.00th=[  226], 95.00th=[  232],
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a>     | 99.00th=[  296], 99.50th=[  330], 99.90th=[  330], 99.95th=[  330],
</span><span id="__span-94-19"><a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a>     | 99.99th=[  334]
</span><span id="__span-94-20"><a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a>   bw (  KiB/s): min=357840, max=614400, per=99.09%, avg=568612.03, stdev=44133.11, samples=36
</span><span id="__span-94-21"><a id="__codelineno-94-21" name="__codelineno-94-21" href="#__codelineno-94-21"></a>   iops        : min=   87, max=  150, avg=138.75, stdev=10.82, samples=36
</span><span id="__span-94-22"><a id="__codelineno-94-22" name="__codelineno-94-22" href="#__codelineno-94-22"></a>  lat (usec)   : 20=0.04%
</span><span id="__span-94-23"><a id="__codelineno-94-23" name="__codelineno-94-23" href="#__codelineno-94-23"></a>  lat (msec)   : 10=0.04%, 20=0.04%, 50=0.20%, 100=0.23%, 250=95.62%
</span><span id="__span-94-24"><a id="__codelineno-94-24" name="__codelineno-94-24" href="#__codelineno-94-24"></a>  lat (msec)   : 500=3.83%
</span><span id="__span-94-25"><a id="__codelineno-94-25" name="__codelineno-94-25" href="#__codelineno-94-25"></a>  cpu          : usr=0.33%, sys=26.03%, ctx=10676, majf=0, minf=32779
</span><span id="__span-94-26"><a id="__codelineno-94-26" name="__codelineno-94-26" href="#__codelineno-94-26"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.3%, 16=0.6%, 32=98.8%, &gt;=64=0.0%
</span><span id="__span-94-27"><a id="__codelineno-94-27" name="__codelineno-94-27" href="#__codelineno-94-27"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-28"><a id="__codelineno-94-28" name="__codelineno-94-28" href="#__codelineno-94-28"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-29"><a id="__codelineno-94-29" name="__codelineno-94-29" href="#__codelineno-94-29"></a>     issued rwts: total=2560,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-94-30"><a id="__codelineno-94-30" name="__codelineno-94-30" href="#__codelineno-94-30"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-94-31"><a id="__codelineno-94-31" name="__codelineno-94-31" href="#__codelineno-94-31"></a>seq-write-4m: (groupid=1, jobs=1): err= 0: pid=447378: Sat Sep 30 00:46:36 2023
</span><span id="__span-94-32"><a id="__codelineno-94-32" name="__codelineno-94-32" href="#__codelineno-94-32"></a>  write: IOPS=29, BW=118MiB/s (123MB/s)(7168MiB/60944msec); 0 zone resets
</span><span id="__span-94-33"><a id="__codelineno-94-33" name="__codelineno-94-33" href="#__codelineno-94-33"></a>    slat (usec): min=1337, max=3922.2k, avg=33986.69, stdev=277349.50
</span><span id="__span-94-34"><a id="__codelineno-94-34" name="__codelineno-94-34" href="#__codelineno-94-34"></a>    clat (usec): min=13, max=4661.5k, avg=1053752.98, stdev=1375122.08
</span><span id="__span-94-35"><a id="__codelineno-94-35" name="__codelineno-94-35" href="#__codelineno-94-35"></a>     lat (msec): min=54, max=4680, avg=1087.74, stdev=1395.81
</span><span id="__span-94-36"><a id="__codelineno-94-36" name="__codelineno-94-36" href="#__codelineno-94-36"></a>    clat percentiles (msec):
</span><span id="__span-94-37"><a id="__codelineno-94-37" name="__codelineno-94-37" href="#__codelineno-94-37"></a>     |  1.00th=[   63],  5.00th=[   88], 10.00th=[  105], 20.00th=[  109],
</span><span id="__span-94-38"><a id="__codelineno-94-38" name="__codelineno-94-38" href="#__codelineno-94-38"></a>     | 30.00th=[  144], 40.00th=[  205], 50.00th=[  262], 60.00th=[  531],
</span><span id="__span-94-39"><a id="__codelineno-94-39" name="__codelineno-94-39" href="#__codelineno-94-39"></a>     | 70.00th=[ 1028], 80.00th=[ 2970], 90.00th=[ 3574], 95.00th=[ 3809],
</span><span id="__span-94-40"><a id="__codelineno-94-40" name="__codelineno-94-40" href="#__codelineno-94-40"></a>     | 99.00th=[ 4530], 99.50th=[ 4597], 99.90th=[ 4665], 99.95th=[ 4665],
</span><span id="__span-94-41"><a id="__codelineno-94-41" name="__codelineno-94-41" href="#__codelineno-94-41"></a>     | 99.99th=[ 4665]
</span><span id="__span-94-42"><a id="__codelineno-94-42" name="__codelineno-94-42" href="#__codelineno-94-42"></a>   bw (  KiB/s): min= 8208, max=787386, per=100.00%, avg=306489.37, stdev=235225.24, samples=46
</span><span id="__span-94-43"><a id="__codelineno-94-43" name="__codelineno-94-43" href="#__codelineno-94-43"></a>   iops        : min=    2, max=  192, avg=74.54, stdev=57.29, samples=46
</span><span id="__span-94-44"><a id="__codelineno-94-44" name="__codelineno-94-44" href="#__codelineno-94-44"></a>  lat (usec)   : 20=0.06%
</span><span id="__span-94-45"><a id="__codelineno-94-45" name="__codelineno-94-45" href="#__codelineno-94-45"></a>  lat (msec)   : 100=8.37%, 250=37.67%, 500=13.06%, 750=3.18%, 1000=6.19%
</span><span id="__span-94-46"><a id="__codelineno-94-46" name="__codelineno-94-46" href="#__codelineno-94-46"></a>  lat (msec)   : 2000=10.71%, &gt;=2000=20.76%
</span><span id="__span-94-47"><a id="__codelineno-94-47" name="__codelineno-94-47" href="#__codelineno-94-47"></a>  cpu          : usr=0.86%, sys=5.95%, ctx=26464, majf=0, minf=12
</span><span id="__span-94-48"><a id="__codelineno-94-48" name="__codelineno-94-48" href="#__codelineno-94-48"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=0.2%, 8=0.4%, 16=0.9%, 32=98.3%, &gt;=64=0.0%
</span><span id="__span-94-49"><a id="__codelineno-94-49" name="__codelineno-94-49" href="#__codelineno-94-49"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-50"><a id="__codelineno-94-50" name="__codelineno-94-50" href="#__codelineno-94-50"></a>     complete  : 0=0.0%, 4=99.9%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-51"><a id="__codelineno-94-51" name="__codelineno-94-51" href="#__codelineno-94-51"></a>     issued rwts: total=0,1792,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-94-52"><a id="__codelineno-94-52" name="__codelineno-94-52" href="#__codelineno-94-52"></a>     latency   : target=0, window=0, percentile=100.00%, depth=32
</span><span id="__span-94-53"><a id="__codelineno-94-53" name="__codelineno-94-53" href="#__codelineno-94-53"></a>rand-read-4k: (groupid=2, jobs=1): err= 0: pid=449479: Sat Sep 30 00:46:36 2023
</span><span id="__span-94-54"><a id="__codelineno-94-54" name="__codelineno-94-54" href="#__codelineno-94-54"></a>  read: IOPS=2352, BW=9409KiB/s (9634kB/s)(551MiB/60001msec)
</span><span id="__span-94-55"><a id="__codelineno-94-55" name="__codelineno-94-55" href="#__codelineno-94-55"></a>    slat (usec): min=6, max=24639, avg=421.40, stdev=272.49
</span><span id="__span-94-56"><a id="__codelineno-94-56" name="__codelineno-94-56" href="#__codelineno-94-56"></a>    clat (usec): min=2, max=36072, avg=1277.22, stdev=607.71
</span><span id="__span-94-57"><a id="__codelineno-94-57" name="__codelineno-94-57" href="#__codelineno-94-57"></a>     lat (usec): min=374, max=42067, avg=1698.61, stdev=744.53
</span><span id="__span-94-58"><a id="__codelineno-94-58" name="__codelineno-94-58" href="#__codelineno-94-58"></a>    clat percentiles (usec):
</span><span id="__span-94-59"><a id="__codelineno-94-59" name="__codelineno-94-59" href="#__codelineno-94-59"></a>     |  1.00th=[  996],  5.00th=[ 1037], 10.00th=[ 1074], 20.00th=[ 1106],
</span><span id="__span-94-60"><a id="__codelineno-94-60" name="__codelineno-94-60" href="#__codelineno-94-60"></a>     | 30.00th=[ 1139], 40.00th=[ 1156], 50.00th=[ 1188], 60.00th=[ 1237],
</span><span id="__span-94-61"><a id="__codelineno-94-61" name="__codelineno-94-61" href="#__codelineno-94-61"></a>     | 70.00th=[ 1287], 80.00th=[ 1352], 90.00th=[ 1483], 95.00th=[ 1614],
</span><span id="__span-94-62"><a id="__codelineno-94-62" name="__codelineno-94-62" href="#__codelineno-94-62"></a>     | 99.00th=[ 2507], 99.50th=[ 3032], 99.90th=[12518], 99.95th=[15401],
</span><span id="__span-94-63"><a id="__codelineno-94-63" name="__codelineno-94-63" href="#__codelineno-94-63"></a>     | 99.99th=[17695]
</span><span id="__span-94-64"><a id="__codelineno-94-64" name="__codelineno-94-64" href="#__codelineno-94-64"></a>   bw (  KiB/s): min= 1744, max=10080, per=99.99%, avg=9408.22, stdev=1395.59, samples=119
</span><span id="__span-94-65"><a id="__codelineno-94-65" name="__codelineno-94-65" href="#__codelineno-94-65"></a>   iops        : min=  436, max= 2520, avg=2351.96, stdev=348.88, samples=119
</span><span id="__span-94-66"><a id="__codelineno-94-66" name="__codelineno-94-66" href="#__codelineno-94-66"></a>  lat (usec)   : 4=0.01%, 500=0.01%, 750=0.03%, 1000=1.37%
</span><span id="__span-94-67"><a id="__codelineno-94-67" name="__codelineno-94-67" href="#__codelineno-94-67"></a>  lat (msec)   : 2=96.73%, 4=1.58%, 10=0.15%, 20=0.14%, 50=0.01%
</span><span id="__span-94-68"><a id="__codelineno-94-68" name="__codelineno-94-68" href="#__codelineno-94-68"></a>  cpu          : usr=0.87%, sys=9.69%, ctx=141627, majf=0, minf=13
</span><span id="__span-94-69"><a id="__codelineno-94-69" name="__codelineno-94-69" href="#__codelineno-94-69"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-94-70"><a id="__codelineno-94-70" name="__codelineno-94-70" href="#__codelineno-94-70"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-71"><a id="__codelineno-94-71" name="__codelineno-94-71" href="#__codelineno-94-71"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-72"><a id="__codelineno-94-72" name="__codelineno-94-72" href="#__codelineno-94-72"></a>     issued rwts: total=141132,0,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-94-73"><a id="__codelineno-94-73" name="__codelineno-94-73" href="#__codelineno-94-73"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-94-74"><a id="__codelineno-94-74" name="__codelineno-94-74" href="#__codelineno-94-74"></a>rand-write-4k: (groupid=3, jobs=1): err= 0: pid=505899: Sat Sep 30 00:46:36 2023
</span><span id="__span-94-75"><a id="__codelineno-94-75" name="__codelineno-94-75" href="#__codelineno-94-75"></a>  write: IOPS=776, BW=3105KiB/s (3179kB/s)(182MiB/60001msec); 0 zone resets
</span><span id="__span-94-76"><a id="__codelineno-94-76" name="__codelineno-94-76" href="#__codelineno-94-76"></a>    slat (usec): min=8, max=64884, avg=1276.50, stdev=1138.90
</span><span id="__span-94-77"><a id="__codelineno-94-77" name="__codelineno-94-77" href="#__codelineno-94-77"></a>    clat (usec): min=4, max=125427, avg=3870.75, stdev=2918.05
</span><span id="__span-94-78"><a id="__codelineno-94-78" name="__codelineno-94-78" href="#__codelineno-94-78"></a>     lat (usec): min=760, max=168093, avg=5147.25, stdev=3727.98
</span><span id="__span-94-79"><a id="__codelineno-94-79" name="__codelineno-94-79" href="#__codelineno-94-79"></a>    clat percentiles (usec):
</span><span id="__span-94-80"><a id="__codelineno-94-80" name="__codelineno-94-80" href="#__codelineno-94-80"></a>     |  1.00th=[  1680],  5.00th=[  2147], 10.00th=[  2245], 20.00th=[  2376],
</span><span id="__span-94-81"><a id="__codelineno-94-81" name="__codelineno-94-81" href="#__codelineno-94-81"></a>     | 30.00th=[  2507], 40.00th=[  2704], 50.00th=[  3032], 60.00th=[  3982],
</span><span id="__span-94-82"><a id="__codelineno-94-82" name="__codelineno-94-82" href="#__codelineno-94-82"></a>     | 70.00th=[  4817], 80.00th=[  5407], 90.00th=[  5997], 95.00th=[  6521],
</span><span id="__span-94-83"><a id="__codelineno-94-83" name="__codelineno-94-83" href="#__codelineno-94-83"></a>     | 99.00th=[  8848], 99.50th=[ 11338], 99.90th=[ 31065], 99.95th=[ 66323],
</span><span id="__span-94-84"><a id="__codelineno-94-84" name="__codelineno-94-84" href="#__codelineno-94-84"></a>     | 99.99th=[110625]
</span><span id="__span-94-85"><a id="__codelineno-94-85" name="__codelineno-94-85" href="#__codelineno-94-85"></a>   bw (  KiB/s): min= 1405, max= 5016, per=99.72%, avg=3096.45, stdev=976.25, samples=119
</span><span id="__span-94-86"><a id="__codelineno-94-86" name="__codelineno-94-86" href="#__codelineno-94-86"></a>   iops        : min=  351, max= 1254, avg=774.01, stdev=244.12, samples=119
</span><span id="__span-94-87"><a id="__codelineno-94-87" name="__codelineno-94-87" href="#__codelineno-94-87"></a>  lat (usec)   : 10=0.01%, 750=0.01%, 1000=0.01%
</span><span id="__span-94-88"><a id="__codelineno-94-88" name="__codelineno-94-88" href="#__codelineno-94-88"></a>  lat (msec)   : 2=1.54%, 4=58.60%, 10=39.19%, 20=0.46%, 50=0.12%
</span><span id="__span-94-89"><a id="__codelineno-94-89" name="__codelineno-94-89" href="#__codelineno-94-89"></a>  lat (msec)   : 100=0.03%, 250=0.03%
</span><span id="__span-94-90"><a id="__codelineno-94-90" name="__codelineno-94-90" href="#__codelineno-94-90"></a>  cpu          : usr=0.77%, sys=8.83%, ctx=99364, majf=0, minf=10
</span><span id="__span-94-91"><a id="__codelineno-94-91" name="__codelineno-94-91" href="#__codelineno-94-91"></a>  IO depths    : 1=0.1%, 2=0.1%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%
</span><span id="__span-94-92"><a id="__codelineno-94-92" name="__codelineno-94-92" href="#__codelineno-94-92"></a>     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-93"><a id="__codelineno-94-93" name="__codelineno-94-93" href="#__codelineno-94-93"></a>     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%
</span><span id="__span-94-94"><a id="__codelineno-94-94" name="__codelineno-94-94" href="#__codelineno-94-94"></a>     issued rwts: total=0,46570,0,0 short=0,0,0,0 dropped=0,0,0,0
</span><span id="__span-94-95"><a id="__codelineno-94-95" name="__codelineno-94-95" href="#__codelineno-94-95"></a>     latency   : target=0, window=0, percentile=100.00%, depth=4
</span><span id="__span-94-96"><a id="__codelineno-94-96" name="__codelineno-94-96" href="#__codelineno-94-96"></a>
</span><span id="__span-94-97"><a id="__codelineno-94-97" name="__codelineno-94-97" href="#__codelineno-94-97"></a>Run status group 0 (all jobs):
</span><span id="__span-94-98"><a id="__codelineno-94-98" name="__codelineno-94-98" href="#__codelineno-94-98"></a>   READ: bw=560MiB/s (588MB/s), 560MiB/s-560MiB/s (588MB/s-588MB/s), io=10.0GiB (10.7GB), run=18274-18274msec
</span><span id="__span-94-99"><a id="__codelineno-94-99" name="__codelineno-94-99" href="#__codelineno-94-99"></a>
</span><span id="__span-94-100"><a id="__codelineno-94-100" name="__codelineno-94-100" href="#__codelineno-94-100"></a>Run status group 1 (all jobs):
</span><span id="__span-94-101"><a id="__codelineno-94-101" name="__codelineno-94-101" href="#__codelineno-94-101"></a>  WRITE: bw=118MiB/s (123MB/s), 118MiB/s-118MiB/s (123MB/s-123MB/s), io=7168MiB (7516MB), run=60944-60944msec
</span><span id="__span-94-102"><a id="__codelineno-94-102" name="__codelineno-94-102" href="#__codelineno-94-102"></a>
</span><span id="__span-94-103"><a id="__codelineno-94-103" name="__codelineno-94-103" href="#__codelineno-94-103"></a>Run status group 2 (all jobs):
</span><span id="__span-94-104"><a id="__codelineno-94-104" name="__codelineno-94-104" href="#__codelineno-94-104"></a>   READ: bw=9409KiB/s (9634kB/s), 9409KiB/s-9409KiB/s (9634kB/s-9634kB/s), io=551MiB (578MB), run=60001-60001msec
</span><span id="__span-94-105"><a id="__codelineno-94-105" name="__codelineno-94-105" href="#__codelineno-94-105"></a>
</span><span id="__span-94-106"><a id="__codelineno-94-106" name="__codelineno-94-106" href="#__codelineno-94-106"></a>Run status group 3 (all jobs):
</span><span id="__span-94-107"><a id="__codelineno-94-107" name="__codelineno-94-107" href="#__codelineno-94-107"></a>  WRITE: bw=3105KiB/s (3179kB/s), 3105KiB/s-3105KiB/s (3179kB/s-3179kB/s), io=182MiB (191MB), run=60001-60001msec
</span></code></pre></div>
<h4 id="pci-subvendor-id">pci subvendor id<a class="headerlink" href="#pci-subvendor-id" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a>cat /sys/bus/pci/devices/*/uevent
</span></code></pre></div>
<h3 id="summary-时间为-1970">summary 时间为 1970<a class="headerlink" href="#summary-时间为-1970" title="Permanent link">&para;</a></h3>
<p><a href="https://dannyda.com/2021/12/30/how-to-fix-proxmox-ve-pve-keep-asking-request-login-pve-endless-login-web-gui-login-window-pve-rrd-error-statistics-error-not-updating-etc/#2-RRD-Error/RRD-1970/RRDC-update-error-etc.">How to Fix Proxmox VE (PVE) keep asking/request login / PVE endless login/web gui login window (&amp; PVE RRD error, statistics error/not updating etc.) &lt; Blog-D without Nonsense (dannyda.com)</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>systemctl stop rrdcached.service
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>rm -rf /var/lib/rrdcached
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>systemctl start rrdcached.service
</span></code></pre></div>
<h3 id="引导修复">引导修复<a class="headerlink" href="#引导修复" title="Permanent link">&para;</a></h3>
<h4 id="lvm_1">lvm<a class="headerlink" href="#lvm_1" title="Permanent link">&para;</a></h4>
<p><a href="https://pve.proxmox.com/wiki/Recover_From_Grub_Failure">Recover From Grub Failure - Proxmox VE</a>
<a href="https://superuser.com/questions/116617/how-to-mount-an-lvm-volume">linux - How to mount an LVM volume? - Super User</a></p>
<p>prepare</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>yum install lvm2    # debian11 alreay installed
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>modprobe dm-mod     # needed, test on debian1 Live CD
</span></code></pre></div>
<p>activate LVM</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a> vgscan
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a> vgchange -ay
</span></code></pre></div>
<p>mount the the root partition that is inside the LVM container</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>sudo mkdir /media/RESCUE
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>sudo mount /dev/pve/root /media/RESCUE/
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a>sudo mount /dev/sdb2 /media/RESCUE/boot/efi  # mount EFI
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>sudo mount -t proc proc /media/RESCUE/proc
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>sudo mount -t sysfs sys /media/RESCUE/sys
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>sudo mount -o bind /dev /media/RESCUE/dev
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a>sudo mount -o bind /run /media/RESCUE/run  # for LVM and raid
</span></code></pre></div>
<p>install grub</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>update-grub
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>grub-install /dev/sda
</span></code></pre></div>
<h4 id="zfs_1">zfs<a class="headerlink" href="#zfs_1" title="Permanent link">&para;</a></h4>
<p>todo</p>
<h3 id="换主板后的一大堆问题">换主板后的一大堆问题<a class="headerlink" href="#换主板后的一大堆问题" title="Permanent link">&para;</a></h3>
<h4 id="识别不到启动项">识别不到启动项<a class="headerlink" href="#识别不到启动项" title="Permanent link">&para;</a></h4>
<p>主板中也存储了启动项，和EFI分区中的efi文件并不一样。主板通常会自己扫描识别，但是也有丢失的情况。</p>
<p>大概就是进入usb live ubuntu，重新install grub。efimanager</p>
<p>TODO</p>
<h4 id="显卡直通进不了系统">显卡直通进不了系统<a class="headerlink" href="#显卡直通进不了系统" title="Permanent link">&para;</a></h4>
<p>启动后，由于显卡直通了。而由于pci槽变了，所以vm也无法启动成功。网卡又变了，因此也无法通过网络连接pve。</p>
<p>即使进入usb live cd系统，由于使用的zfs，操作起来很不方便。</p>
<p>有一个办法，就是内核参数中临时关闭iommu，这样会禁用所有显卡直通的机器启动。从而可以进入pve的命令行进行操作。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>amd_iommu=off 或intel_iommu=off
</span></code></pre></div>
<h3 id="windows-磁盘扩充">windows 磁盘扩充<a class="headerlink" href="#windows-磁盘扩充" title="Permanent link">&para;</a></h3>
<ol>
<li>pve 中 zfs set volsize</li>
<li>qm set --scsix：用于更新配置文件中磁盘的 size 参数（也许这步是可选的）</li>
<li><strong>关机虚拟机</strong>：必须的，重启虚拟机大小不会改变</li>
<li>启动虚拟机，虚拟机内调整磁盘大小</li>
</ol>
<p>e.g
<div class="language-text highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>zfs set volsize=1200G pool0/data/vm-200-disk-gamessd
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>qm set 201 --scsi4 pool0:vm-200-disk-gamessd,discard=on,iothread=1,ssd=1
</span></code></pre></div></p>
<h3 id="windows-guest-agent-not-running">windows guest agent not running<a class="headerlink" href="#windows-guest-agent-not-running" title="Permanent link">&para;</a></h3>
<p>之前尝试 virtfs 时，下载了 virtio-win-0.1.262 iso 文件，想给 windows 更新新的 virtio 驱动。但是发现安装失败了（感觉是由于 windows 系统就安装在 virtio 盘上，更新驱动会导致冲突）。</p>
<p>安装过程中会卸载原有驱动，甚至导致由于丢失驱动，网络不通的情况，最后通过 zfs 备份恢复系统盘恢复了。</p>
<p>这次给 gamessd 虚拟盘扩容时，又尝试更新驱动，仍然更新不了。并且发现 PVE WebUI 中虚拟机显示的是 guest agent not running， 看不到虚拟机 ip 了。</p>
<p>问题在于驱动丢失了，参考 wiki 修复驱动：<a href="https://pve.proxmox.com/wiki/Qemu-guest-agent">Qemu-guest-agent - Proxmox VE</a></p>
<p>Then install the virtio-serial driver:
1. Attach the ISO to your windows VM (virtio-*.iso)
2. Go to the windows Device Manager
3. Look for "PCI Simple Communications Controller"
4. Right Click -&gt; Update Driver and select on the mounted iso in <code>DRIVE:\vioserial\&lt;OSVERSION&gt;\ where &lt;OSVERSION&gt; is your Windows Version (e.g. 2k12R2 for Windows 2012 R2)</code></p>
<p>测试，没有输出表示成功（这条命令在 qm --help 中都没有显示，zsh 也不会补全）
<div class="language-text highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>qm agent &lt;vmid&gt; ping
</span></code></pre></div></p>
<h3 id="smartd-发邮件">Smartd 发邮件<a class="headerlink" href="#smartd-发邮件" title="Permanent link">&para;</a></h3>
<p>磁盘出现了坏扇区，PVE 每 24 h 发送一封邮件，很烦，并且可能让我错过真正重要的信息。因此想实现，只有在磁盘错误增加时才通知我。</p>
<p><a href="https://manpages.debian.org/unstable/smartmontools/smartd.conf.5.en.html">smartd.conf(5) — smartmontools — Debian unstable — Debian Manpages</a>
<a href="https://www.thomas-krenn.com/de/wiki/Currently_unreadable_(pending)_sectors_-_SMART-Daemon_Proxmox">当前无法读取（待处理）的扇区 - SMART-Daemon Proxmox – Thomas-Krenn-Wiki --- Currently unreadable (pending) sectors - SMART-Daemon Proxmox – Thomas-Krenn-Wiki</a></p>
<p>先简单实现为禁止那块坏盘通知我</p>
<ul>
<li>放在 <code>DEVICESCAN</code> 之前
<div class="language-text highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>/dev/disk/by-id/ata-ST3000DM001-1CH166_Z1F5V8VG -I 197 -I 198
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>DEVICESCAN -d removable -n standby -m root -M exec /usr/share/smartmontools/smartd-runner
</span></code></pre></div></li>
</ul>
<p><code>-I ID</code></p>
<ul>
<li>[ATA only] Ignore device Attribute <strong>ID</strong> when tracking changes in the Attribute values. <strong>ID</strong> must be a decimal integer in the range from 1 to 255. This Directive modifies the behavior of the '-p', '-u', and '-t' tracking Directives and has no effect without one of them.</li>
<li>This is useful, for example, if one of the device Attributes is the disk temperature (usually Attribute 194 or 231). It's annoying to get reports each time the temperature changes. This Directive may appear multiple times for a single device, if you want to ignore multiple Attributes.</li>
</ul>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../../../%E5%8D%9A%E5%AE%A2/2023/09/01/2023-09-01-%E5%86%8D%E6%AC%A1%E7%90%86%E8%A7%A3Cache%E8%AE%BE%E8%AE%A1/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 再次理解 Cache 设计">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                再次理解 Cache 设计
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../../%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/2023/10/30/2023-10-30-openwrt-x86%E5%8D%87%E7%BA%A7/" class="md-footer__link md-footer__link--next" aria-label="下一页: openwrt x86 升级">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                openwrt x86 升级
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TheRainstorm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>